<html><head></head><body><div id="sbo-rt-content"><div id="_idContainer171" class="_idGenObjectStyleOverride-1">&#13;
			<p id="_idParaDest-170" class="Chapter-Title" lang="en-US" xml:lang="en-US"><span class="ChapterMarker">18. </span><a id="_idTextAnchor232"/>Sharing Files between CentOS 8 and Windows Systems with <a id="_idIndexMarker377"/>Samba</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Although Linux has made some inroads into the desktop market, its origins and future are very much server-based. It is not surprising therefore that CentOS 8 has the ability to act as a file server. It is also extremely common for CentOS and Windows systems to be used side by side in networked environments. It is a common requirement, therefore, that files on a CentOS 8 system be accessible to Linux, UNIX and Windows-based systems over network connections. Similarly, shared folders and printers residing on Windows systems may also need to be accessible from CentOS 8 based systems. </p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Windows systems share resources such as file systems and printers using a protocol known as <a id="_idIndexMarker378"/>Server Message Block (<a id="_idIndexMarker379"/>SMB). In order for a CentOS 8 system to serve such resources over a network to a Windows system and vice versa it must, therefore, support SMB. This is achieved using technology called Samba. In addition to providing integration between Linux and Windows systems, Samba may also be used to provide folder sharing between Linux systems (as an alternative to NFS which was covered in the previous chapter). </p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">In this chapter we will look at the steps necessary to share file system resources and printers on a CentOS 8 system with remote Windows and Linux systems, and to access Windows resources from CentOS 8. </p>&#13;
			<p id="_idParaDest-171" class="Heading-1-1" lang="en-US" xml:lang="en-US"><span class="Heading11Marker">18.1 </span><a id="_idTextAnchor233"/>Samba and <a id="_idIndexMarker380"/><a id="_idIndexMarker381"/>Samba Client</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Samba allows both CentOS 8 resources to be shared with Windows systems and Windows resources to be shared with CentOS 8 systems. CentOS accesses Windows resources using the Samba client. CentOS resources, on the other hand, are shared with Windows systems by installing and configuring the Samba service.</p>&#13;
			<p id="_idParaDest-172" class="Heading-1-1" lang="en-US" xml:lang="en-US"><span class="Heading11Marker">18.2 </span><a id="_idTextAnchor234"/>Installing <a id="_idIndexMarker382"/>Samba on a CentOS 8 System </p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">The default settings used during the CentOS 8 installation process do not typically install the necessary Samba packages. Unless you specifically requested that Samba be installed it is unlikely that you have Samba installed on your system. To check whether Samba is installed, open a terminal window and run the following <span class="My-Italic _idGenCharOverride-1">rpm</span> command: </p>&#13;
			<p class="Code"># rpm -q <a id="_idIndexMarker383"/><a id="_idIndexMarker384"/><a id="_idIndexMarker385"/>samba samba-common samba-client</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">If any of the Samba packages are not installed, <span class="My-Italic _idGenCharOverride-1">rpm</span> will return with “package is not installed”. That being the case, these can be installed using the <span class="My-Italic _idGenCharOverride-1">dnf</span> command-line tool:</p>&#13;
			<p class="Code"># dnf install samba samba-common samba-client<span class="CharOverride-1" lang="en-US" xml:lang="en-US"> </span></p>&#13;
			<p id="_idParaDest-173" class="Heading-1-1" lang="en-US" xml:lang="en-US"><span class="Heading11Marker">18.3 </span><a id="_idTextAnchor235"/>Configuring the CentOS 8 Firewall to Enable <a id="_idIndexMarker386"/><a id="_idIndexMarker387"/>Samba </p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Next, the firewall currently protecting the CentOS 8 system needs to be configured to allow Samba traffic. To achieve this, run the <span class="My-Italic _idGenCharOverride-1">firewall-cmd</span> command as follows:</p>&#13;
			<p class="Code"># firewall-cmd --permanent --add-port={139/tcp,445/tcp}</p>&#13;
			<p class="Code"># firewall-cmd --reload</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Before starting the Samba service a number of configuration steps are necessary to define how the CentOS system will appear to Windows systems, and the resources which are to be shared with remote clients. The majority of these configuration tasks take place within the <span class="My-Italic _idGenCharOverride-1">/etc/samba/smb.conf</span> file.</p>&#13;
			<p id="_idParaDest-174" class="Heading-1-1" lang="en-US" xml:lang="en-US"><span class="Heading11Marker">18.4 </span><a id="_idTextAnchor236"/>Configuring the <a id="_idIndexMarker388"/><span class="My-Italic _idGenCharOverride-1">smb.conf</span> File</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><a id="_idIndexMarker389"/>Prior to the introduction of CentOS 6, a user friendly graphical tool named <span class="My-Italic _idGenCharOverride-1">system-config-samba</span> was provided to assist in the configuration of Samba. In CentOS 7 and later, however, this tool has been removed. This means that the Samba environment must be configured manually within the <span class="My-Italic _idGenCharOverride-1">/etc/samba/smb.conf</span> file and using the <a id="_idIndexMarker390"/><a id="_idIndexMarker391"/><span class="My-Italic _idGenCharOverride-1">smbpasswd</span> command-line tool. While the loss of <span class="My-Italic _idGenCharOverride-1">system-config-samba</span> may be mourned by those who relied on it, the tool’s simplicity actually masked many of the more advanced features of Samba. In practice, much more can be achieved by taking the time to understand the intricacies of the <span class="My-Italic _idGenCharOverride-1">smb.conf</span> file.</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Samba is a highly flexible and configurable system that provides many different options for controlling how resources are shared on Windows networks. This flexibility can lead to the sense that Samba is overly complex to work with. In reality, however, many of the configuration options are not needed by the typical installation, and the learning curve to set up a basic configuration is actually quite short.</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">For the purposes of this chapter we will look at joining a CentOS 8 system to a Windows workgroup and setting up a directory as a shared resource that can be accessed by a specific user. This is a configuration known as a <span class="My-Italic _idGenCharOverride-1">standalone</span> Samba server. More advanced configurations such as integrating Samba within an Active Directory environment are also available, though these are outside the scope of this book.</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">The first step in configuring Samba is to edit the <span class="My-Italic _idGenCharOverride-1">/etc/samba/smb.conf</span> file.</p>&#13;
			<p id="_idParaDest-175" class="Heading-1-1-1" lang="en-US" xml:lang="en-US"><span class="Heading111Marker">18.4.1 </span><a id="_idTextAnchor237"/>Configuring the <a id="_idIndexMarker392"/>[global] Section</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">The <span class="My-Italic _idGenCharOverride-1">smb.conf</span> file is divided into sections. The first section is the [global] section where settings can be specified that apply to the entire Samba configuration. While these settings are global, each option may be overridden within other sections of the configuration file.</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><a id="_idIndexMarker393"/>The first task is to define the name of the Windows workgroup on which the CentOS 8 resources are to be shared. This is controlled via the <span class="My-Italic _idGenCharOverride-1">workgroup =</span> directive of the [global] section which by default is configured as follows:</p>&#13;
			<p class="Code">workgroup = SAMBA</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Begin by changing this to the actual name of the workgroup. For example, if the workgroup is named WORKGROUP (the default for most Windows networks):</p>&#13;
			<p class="Code">[global]</p>&#13;
			<p class="Code">        workgroup = WORKGROUP</p>&#13;
			<p class="Code">        security = user</p>&#13;
			<p class="Code"> </p>&#13;
			<p class="Code">        passdb backend = tdbsam</p>&#13;
			<p class="Code">.</p>&#13;
			<p class="Code">.</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">In addition to the workgroup setting, the other settings indicate that this is a standalone server on which the shared resources will be protected by user passwords. Before moving on to configuring the resources to be shared, a number of other parameters also need to be added to the [global] section as follows:</p>&#13;
			<p class="Code">[global]</p>&#13;
			<p class="Code">        workgroup = WORKGROUP</p>&#13;
			<p class="Code">        security = user</p>&#13;
			<p class="Code">        <span class="My-Bold _idGenCharOverride-2">netbios name = LinuxServer</span></p>&#13;
			<p class="Code">        passdb backend = tdbsam</p>&#13;
			<p class="Code">        </p>&#13;
			<p class="Code"><span class="My-Bold _idGenCharOverride-2">        log file = /var/log/samba/%m.log</span></p>&#13;
			<p class="Code"><span class="My-Bold _idGenCharOverride-2">        log level = 1</span></p>&#13;
			<p class="Code">.</p>&#13;
			<p class="Code">.</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">The “netbios name” property specifies the name by which the server will be visible to other systems on the network, while the log settings simply specify a file location into which log output is to be recorded.</p>&#13;
			<p id="_idParaDest-176" class="Heading-1-1-1" lang="en-US" xml:lang="en-US"><span class="Heading111Marker">18.4.2 </span><a id="_idTextAnchor238"/>Configuring a Shared Resource</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><a id="_idIndexMarker394"/>The next step is to configure the shared resources (in other words the resources that will be accessible from other systems on the Windows network). In order to achieve this, the section is given a name by which it will be referred to when shared. For example, if we plan to share the <span class="My-Italic _idGenCharOverride-1">/sampleshare</span> directory of our CentOS 8 system, we might entitle the section [sampleshare]. In this section a variety of configuration options are possible. For the purposes of this example, however, we will simply define the directory that is to be shared, indicate that the directory is both browsable and writable and declare the resource public so that guest users are able to gain access:</p>&#13;
			<p class="Code">[sampleshare]</p>&#13;
			<p class="Code">        comment = Example Samba share</p>&#13;
			<p class="Code">        path = /sampleshare</p>&#13;
			<p class="Code">        browseable = Yes</p>&#13;
			<p class="Code">        public = yes</p>&#13;
			<p class="Code">        writable = yes</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">To restrict access to specific users, the “valid users” property may be used, for example:</p>&#13;
			<p class="Code">valid users = demo, bobyoung, marcewing</p>&#13;
			<p id="_idParaDest-177" class="Heading-1-1-1" lang="en-US" xml:lang="en-US"><span class="Heading111Marker">18.4.3 </span><a id="_idTextAnchor239"/>Removing Unnecessary Shares</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">The <span class="My-Italic _idGenCharOverride-1">smb.conf</span> file is pre-configured with sections for sharing printers and the home folders of the users on the system. If these resources do not need to be shared, the corresponding sections can be commented out so that they are ignored by Samba. In the following example, the [homes] section has been commented out:</p>&#13;
			<p class="Code">.</p>&#13;
			<p class="Code">.</p>&#13;
			<p class="Code">#[homes]</p>&#13;
			<p class="Code">#       comment = Home Directories</p>&#13;
			<p class="Code">#       valid users = %S, %D%w%S</p>&#13;
			<p class="Code">#       browseable = No</p>&#13;
			<p class="Code">#       read only = No</p>&#13;
			<p class="Code">#       inherit acls = Yes</p>&#13;
			<p class="Code">.</p>&#13;
			<p class="Code">.</p>&#13;
			<p id="_idParaDest-178" class="Heading-1-1" lang="en-US" xml:lang="en-US"><span class="Heading11Marker">18.5 </span><a id="_idTextAnchor240"/>Configuring <a id="_idIndexMarker395"/><a id="_idIndexMarker396"/><a id="_idIndexMarker397"/>SELinux for Samba</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">SELinux is a system integrated by default into the Linux kernel on all CentOS 8 systems and which provides an extra layer of security and protection to the operating system and user files. </p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Traditionally, Linux security has been based on the concept of allowing users to decide who has access to their files and other resources for which they have ownership. Consider, for example, a file located in the home directory of, and owned by, a particular user. That user is able to control the access permissions of that file in terms of whether other users on the system are able to read and write to or, in the case of a script or binary, execute the file. This type of security is referred to as <span class="My-Italic _idGenCharOverride-1">discretionary access control</span> since access to resources is left to the discretion of the user.</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">With SELinux, however, access is controlled by the system administrator and cannot be overridden by the user. This is referred to as <a id="_idIndexMarker398"/><a id="_idIndexMarker399"/><a id="_idIndexMarker400"/><a id="_idIndexMarker401"/><span class="My-Italic _idGenCharOverride-1">mandatory access control</span> and is defined by the administrator using SELinux <span class="My-Italic _idGenCharOverride-1">policy</span>. To continue the previous example, the owner of a file is only able to perform tasks on that file if SELinux policy defined either by default by the system, or by the administrator, permits it.</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">The current status of SELinux on a CentOS 8 system may be identified using the <a id="_idIndexMarker402"/><a id="_idIndexMarker403"/><span class="My-Italic _idGenCharOverride-1">sestatus</span> tool as follows:</p>&#13;
			<p class="Code"># sestatus</p>&#13;
			<p class="Code">SELinux status:                 enabled</p>&#13;
			<p class="Code">SELinuxfs mount:                /sys/fs/selinux</p>&#13;
			<p class="Code">SELinux root directory:         /etc/selinux</p>&#13;
			<p class="Code">Loaded policy name:             targeted</p>&#13;
			<p class="Code">Current mode:                   enforcing</p>&#13;
			<p class="Code">Mode from config file:            enforcing</p>&#13;
			<p class="Code">Policy MLS status:              enabled</p>&#13;
			<p class="Code">Policy deny_unknown status:     allowed</p>&#13;
			<p class="Code">Memory protection checking:     actual (secure)</p>&#13;
			<p class="Code">Max kernel policy version:      31</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">SELinux can be run in either <a id="_idIndexMarker404"/><a id="_idIndexMarker405"/><span class="My-Italic _idGenCharOverride-1">enforcing</span> or <span class="My-Italic _idGenCharOverride-1">permissive</span> mode. When enabled, enforcing mode denies all actions that are not permitted by SELinux policy. Permissive mode, on the other hand, allows actions that would normally have been denied to proceed but records the violation in a log file.</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">SELinux security is based on the concept of <a id="_idIndexMarker406"/><a id="_idIndexMarker407"/><span class="My-Italic _idGenCharOverride-1">context labels.</span> All resources on a system (including processes and files) are assigned SELinux context labels consisting of user, role, type and optional security level. The SELinux context of files or folders, for example, may be viewed as follows:</p>&#13;
			<p class="Code">$ ls -Z /home/demo</p>&#13;
			<p class="Code"> unconfined_u:object_r:user_home_t:s0 Desktop</p>&#13;
			<p class="Code"> unconfined_u:object_r:user_home_t:s0 Documents</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Similarly, the <span class="My-Italic _idGenCharOverride-1">ps</span> command may be used to identify the context of a running process, in this case the <span class="My-Italic _idGenCharOverride-1">ls</span> command:</p>&#13;
			<p class="Code">$ ps -eZ | grep ls</p>&#13;
			<p class="Code">unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023 14311 tty1 00:00:18 ls</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">When a process (such as the above<span class="My-Italic _idGenCharOverride-1"> ls</span> command) attempts to access a file or folder, the SELinux system will check the policy to identify whether or not access is permitted. Now consider the context of the Samba service:</p>&#13;
			<p class="Code">$ ps -eZ | grep smb</p>&#13;
			<p class="Code">system_u:system_r:smbd_t:s0     14129 ?        00:00:00 smbd</p>&#13;
			<p class="Code">system_u:system_r:smbd_t:s0     14132 ?        00:00:00 smbd-notifyd</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">SELinux implements security in a number of ways, the most common of which is referred to as <a id="_idIndexMarker408"/><span class="My-Italic _idGenCharOverride-1">type enforcement</span>. In basic terms, when a process attempts to perform a task on an object (for example writing to a file), SELinux checks the context types of both the process and the object and verifies that the security policy allows the action to be taken. If a process of type A, for example, attempts to write to a file of type B, it will only be permitted to do so if SELinux policy specifically states that a process of type A may perform a write operation to a file of type B. In SELinux enforcement, all actions are denied by default unless a rule exists specifically allowing the action to be performed.</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">The issue with SELinux and Samba is that SELinux policy is not configured to allow processes of type <span class="My-Italic _idGenCharOverride-1">smb_t</span> to perform actions on files of any type other than <span class="My-Italic _idGenCharOverride-1">samba_share_t</span>. The <span class="My-Italic _idGenCharOverride-1">/home/demo</span> directory listed above, for example, will be inaccessible to the Samba service because it has a type of <span class="My-Italic _idGenCharOverride-1">user_home_t</span>. To make files or folders on the system accessible to the Samba service, the enforcement type of those specific resources must be changed to <span class="My-Italic _idGenCharOverride-1">samba_share_t</span>.</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">For the purposes of this example, we will create the <span class="My-Italic _idGenCharOverride-1">/sampleshare</span> directory referenced previously in the <span class="My-Italic _idGenCharOverride-1">smb.conf </span>file and change the enforcement type so that it is accessible to the Samba service. Begin by creating the directory as follows:</p>&#13;
			<p class="Code"># mkdir /sampleshare</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Next, check the current SELinux context on the directory:</p>&#13;
			<p class="Code">$ ls -aZ /sampleshare/</p>&#13;
			<p class="Code">unconfined_u:object_r:default_t:s0 .</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">In this instance, the context label of the folder has been assigned a type of <span class="My-Italic _idGenCharOverride-1">default_t</span>. To make the folder sharable by Samba, the enforcement type needs to be set to <span class="My-Italic _idGenCharOverride-1">samba_share_t</span> using the <span class="My-Italic _idGenCharOverride-1">semanage</span> tool as follows:</p>&#13;
			<p class="Code"># semanage fcontext -a -t samba_share_t "/sampleshare(/.*)?"</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Note the use of a wildcard in the <a id="_idIndexMarker409"/><a id="_idIndexMarker410"/><span class="My-Italic _idGenCharOverride-1">semanage</span> command to ensure that the type is applied to any sub-directories and files contained within the <span class="My-Italic _idGenCharOverride-1">/sampleshare</span> directory. Once added, the change needs to be applied using the <a id="_idIndexMarker411"/><a id="_idIndexMarker412"/><span class="My-Italic _idGenCharOverride-1">restorecon</span> command, making use of the -R flag to apply the change recursively through any sub-directories:</p>&#13;
			<p class="Code"># restorecon -R -v /sampleshare</p>&#13;
			<p class="Code">Relabeled /sampleshare from unconfined_u:object_r:default_t:s0 to unconfined_u:object_r:samba_share_t:s0</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Once these changes have been made, the folder is configured to comply with SELinux policy for the smb process and is ready to be shared by Samba.</p>&#13;
			<p id="_idParaDest-179" class="Heading-1-1" lang="en-US" xml:lang="en-US"><span class="Heading11Marker">18.6 </span><a id="_idTextAnchor241"/>Creating a <a id="_idIndexMarker413"/>Samba User</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Any user that requires access to a Samba shared resource must be configured as a Samba User and assigned a password. This task is achieved using the <a id="_idIndexMarker414"/><a id="_idIndexMarker415"/><span class="My-Italic _idGenCharOverride-1">smbpasswd</span> command-line tool. Consider, for example, that a user named <span class="My-Italic _idGenCharOverride-1">demo</span> is required to be able to access the <span class="My-Italic _idGenCharOverride-1">/sampleshare</span> directory of our CentOS 8 system from a Windows system. In order to fulfill this requirement we must add <span class="My-Italic _idGenCharOverride-1">demo</span> as a Samba user as follows:</p>&#13;
			<p class="Code"># smbpasswd -a demo</p>&#13;
			<p class="Code">New SMB password:</p>&#13;
			<p class="Code">Retype new SMB password:</p>&#13;
			<p class="Code">Added user demo.</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Now that we have completed the configuration of a very basic Samba server, it is time to test our configuration file and then start the Samba services.</p>&#13;
			<p id="_idParaDest-180" class="Heading-1-1" lang="en-US" xml:lang="en-US"><span class="Heading11Marker">18.7 </span><a id="_idTextAnchor242"/>Testing the <a id="_idIndexMarker416"/><a id="_idIndexMarker417"/><span class="My-Italic _idGenCharOverride-1">smb.conf</span> File</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">The settings in the <a id="_idIndexMarker418"/><span class="My-Italic _idGenCharOverride-1">smb.conf</span> file may be checked for errors using the <span class="My-Italic _idGenCharOverride-1">testparm</span> command-line tool as follows:</p>&#13;
			<p class="Code"># testparm</p>&#13;
			<p class="Code">Load smb config files from /etc/samba/smb.conf</p>&#13;
			<p class="Code">rlimit_max: increasing rlimit_max (1024) to minimum Windows limit (16384)</p>&#13;
			<p class="Code">Processing section "[sampleshare]"</p>&#13;
			<p class="Code">Processing section "[homes]"</p>&#13;
			<p class="Code">Processing section "[printers]"</p>&#13;
			<p class="Code">Processing section "[print$]"</p>&#13;
			<p class="Code">Loaded services file OK.</p>&#13;
			<p class="Code">Server role: ROLE_STANDALONE</p>&#13;
			<p class="Code"> </p>&#13;
			<p class="Code">Press enter to see a dump of your service definitions</p>&#13;
			<p class="Code"> </p>&#13;
			<p class="Code"># Global parameters</p>&#13;
			<p class="Code">[global]</p>&#13;
			<p class="Code">	log file = /var/log/samba/%m.log</p>&#13;
			<p class="Code">	netbios name = LINUXSERVER</p>&#13;
			<p class="Code">	printcap name = cups</p>&#13;
			<p class="Code">	security = USER</p>&#13;
			<p class="Code">	wins support = Yes</p>&#13;
			<p class="Code">	idmap config * : backend = tdb</p>&#13;
			<p class="Code">	cups options = raw</p>&#13;
			<p class="Code"> </p>&#13;
			<p class="Code">[sampleshare]</p>&#13;
			<p class="Code">	comment = Example Samba share</p>&#13;
			<p class="Code">	guest ok = Yes</p>&#13;
			<p class="Code">	path = /sampleshare</p>&#13;
			<p class="Code">	read only = No</p>&#13;
			<p class="Code"> </p>&#13;
			<p class="Code">[homes]</p>&#13;
			<p class="Code">	browseable = No</p>&#13;
			<p class="Code">	comment = Home Directories</p>&#13;
			<p class="Code">	inherit acls = Yes</p>&#13;
			<p class="Code">	read only = No</p>&#13;
			<p class="Code">	valid users = %S %D%w%S</p>&#13;
			<p class="Code"> </p>&#13;
			<p class="Code">[printers]</p>&#13;
			<p class="Code">	browseable = No</p>&#13;
			<p class="Code">	comment = All Printers</p>&#13;
			<p class="Code">	create mask = 0600</p>&#13;
			<p class="Code">	path = /var/tmp</p>&#13;
			<p class="Code">	printable = Yes</p>&#13;
			<p class="Code"> </p>&#13;
			<p class="Code">[print$]</p>&#13;
			<p class="Code">	comment = Printer Drivers</p>&#13;
			<p class="Code">	create mask = 0664</p>&#13;
			<p class="Code">	directory mask = 0775</p>&#13;
			<p class="Code">	force group = @printadmin</p>&#13;
			<p class="Code">	path = /var/lib/samba/drivers</p>&#13;
			<p class="Code">	write list = @printadmin root</p>&#13;
			<p id="_idParaDest-181" class="Heading-1-1" lang="en-US" xml:lang="en-US"><span class="Heading11Marker">18.8 </span><a id="_idTextAnchor243"/>Starting the Samba and <a id="_idIndexMarker419"/><a id="_idIndexMarker420"/>NetBIOS Name Services</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">In order for a CentOS 8 server to operate within a Windows network both the Samba (SMB) and NetBOIS nameservice (<a id="_idIndexMarker421"/><a id="_idIndexMarker422"/>NMB) services must be started. Optionally, also enable the services so that they start each time the system boots:</p>&#13;
			<p class="Code"># systemctl enable smb</p>&#13;
			<p class="Code"># systemctl start smb</p>&#13;
			<p class="Code"># systemctl enable nmb</p>&#13;
			<p class="Code"># systemctl start nmb</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Before attempting to connect from a Windows system, use the <a id="_idIndexMarker423"/><a id="_idIndexMarker424"/><span class="My-Italic _idGenCharOverride-1">smbclient</span> utility to verify that the share is configured:</p>&#13;
			<p class="Code"># smbclient -U demo -L localhost </p>&#13;
			<p class="Code">Enter WORKGROUP\demo’s password: </p>&#13;
			<p class="Code"> </p>&#13;
			<p class="Code">	Sharename       Type      Comment</p>&#13;
			<p class="Code">	---------       ----      -------</p>&#13;
			<p class="Code">	sampleshare     Disk      Example Samba share</p>&#13;
			<p class="Code">	print$          Disk      Printer Drivers</p>&#13;
			<p class="Code">	IPC$            IPC       IPC Service (Samba 4.9.1)</p>&#13;
			<p class="Code">	demo            Disk      Home Directories</p>&#13;
			<p class="Code">Reconnecting with SMB1 for workgroup listing.</p>&#13;
			<p class="Code"> </p>&#13;
			<p class="Code">	Server               Comment</p>&#13;
			<p class="Code">	---------            -------</p>&#13;
			<p class="Code"> </p>&#13;
			<p class="Code">	Workgroup            Master</p>&#13;
			<p class="Code">	---------            -------</p>&#13;
			<p class="Code">	WORKGROUP            LINUXSERVER</p>&#13;
			<p id="_idParaDest-182" class="Heading-1-1" lang="en-US" xml:lang="en-US"><span class="Heading11Marker">18.9 </span><a id="_idTextAnchor244"/>Accessing Samba Shares</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Now that the Samba resources are configured and the services are running, it is time to access the shared resource from a Windows system. On a suitable Windows system on the same workgroup as the CentOS 8 system, open Windows Explorer and navigate to the Network panel. At this point, explorer should search the network and list any systems using the SMB protocol that it finds. The following figure illustrates a CentOS 8 system named LINUXSERVER located using Windows Explorer on a Windows 10 system:</p>&#13;
			<p class="My-Basic-Paragraph ParaOverride-1" lang="en-US" xml:lang="en-US"><img class="_idGenObjectAttribute-1" src="Images/rhel_8_samba_share_on_windows.png" alt="" width="1100" height="580"/></p>&#13;
			<p class="Figure-Caption" lang="en-US" xml:lang="en-US"><span class="FigureCaptionMarker">Figure 18-1</span></p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Double clicking on the LINUXSERVER host will prompt for the name and password of a user with access privileges. In this case it is the demo account that we configured using the <span class="My-Italic _idGenCharOverride-1">smbpasswd</span> tool:</p>&#13;
			<p class="My-Basic-Paragraph ParaOverride-1" lang="en-US" xml:lang="en-US"><img class="_idGenObjectAttribute-2" src="Images/rhel_8_samba_windows_login.png" alt="" width="701" height="538"/></p>&#13;
			<p class="Figure-Caption" lang="en-US" xml:lang="en-US"><span class="FigureCaptionMarker">Figure 18-2</span></p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Entering the username and password will result in the shared resources configured for that user appearing in the explorer window, including the previously configured <span class="My-Italic _idGenCharOverride-1">/sampleshare</span> resource:</p>&#13;
			<p class="My-Basic-Paragraph ParaOverride-1" lang="en-US" xml:lang="en-US"><img class="_idGenObjectAttribute-3" src="Images/rhel_8_samba_folder_on_windows.png" alt="" width="301" height="108"/></p>&#13;
			<p class="Figure-Caption" lang="en-US" xml:lang="en-US"><span class="FigureCaptionMarker">Figure 18-3</span></p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Double clicking on the <span class="My-Italic _idGenCharOverride-1">/sampleshare</span> shared resource will display a listing of the files and directories contained therein.</p>&#13;
			<p id="_idParaDest-183" class="Heading-1-1" lang="en-US" xml:lang="en-US"><span class="Heading11Marker">18.10 </span><a id="_idTextAnchor245"/>Accessing Windows Shares from CentOS 8</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><a id="_idIndexMarker425"/><a id="_idIndexMarker426"/><a id="_idIndexMarker427"/>As previously mentioned, Samba is a two way street, allowing not only Windows systems to access files and printers hosted on a CentOS 8 system, but also allowing the CentOS 8 system to access shared resources on Windows systems. This is achieved using the samba-client package which was installed at the start of this chapter. If it is not currently installed, install it from a terminal window as follows:</p>&#13;
			<p class="Code"># dnf install samba-client</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Shared resources on a Windows system can be accessed either from the CentOS desktop using the Files application, or from the command-line prompt using the <span class="My-Italic _idGenCharOverride-1">smbclient </span>and <span class="My-Italic _idGenCharOverride-1">mount</span> tools. The steps in this section assume that appropriate network sharing settings have been enabled on the Windows system. </p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">To access any shared resources on a Windows system using the desktop, begin by launching the Files application and selecting the <span class="My-Italic _idGenCharOverride-1">Other Locations</span> option. This will display the screen shown in <a href="../Text/Samba_File_Sharing.xhtml#_idTextAnchor246">Figure 18-4</a> below including an icon for the Windows Network (if one is detected):</p>&#13;
			<p class="My-Basic-Paragraph ParaOverride-1" lang="en-US" xml:lang="en-US"><img class="_idGenObjectAttribute-4" src="Images/rhel_8_connect_to_windows_share.png" alt="" width="907" height="651"/> </p>&#13;
			<p class="Figure-Caption" lang="en-US" xml:lang="en-US"><span class="FigureCaptionMarker">Figure 18-4</span><a id="_idTextAnchor246"/></p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Selecting the Windows Network option will display the Windows systems detected on the network and allow access to any shared resources.</p>&#13;
			<p class="My-Basic-Paragraph ParaOverride-1" lang="en-US" xml:lang="en-US"><img class="_idGenObjectAttribute-5" src="Images/rhel_8_files_windows_10_share.png" alt="" width="854" height="516"/></p>&#13;
			<p class="Figure-Caption" lang="en-US" xml:lang="en-US"><span class="FigureCaptionMarker">Figure 18-5</span></p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Alternatively, the<span class="My-Italic _idGenCharOverride-1"> Connect to Server</span> option may be used to connect to a specific system. Note that the name or IP address of the remote system must be prefixed by <a id="_idIndexMarker428"/><a id="_idIndexMarker429"/><span class="My-Italic _idGenCharOverride-1">smb://</span> and may be followed by the path to a specific shared resource, for example:</p>&#13;
			<p class="Code">smb://WinServer10/Documents</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">In the absence of a desktop environment, a remote Windows share may be mounted from the command-line using the <span class="My-Italic _idGenCharOverride-1">mount</span> command and specifying the <span class="My-Italic _idGenCharOverride-1">cifs</span> filesystem type. The following command, for example, mounts a share named Documents located on a Windows system named WinServer at a local mount point named <span class="My-Italic _idGenCharOverride-1">/winfiles</span>:</p>&#13;
			<p class="Code"># mount -t cifs //WinServer/Documents /winfiles -o user=demo</p>&#13;
			<p id="_idParaDest-184" class="Heading-1-1" lang="en-US" xml:lang="en-US"><span class="Heading11Marker">18.11 </span><a id="_idTextAnchor247"/>Summary</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">In this chapter we have looked at the steps necessary to configure a CentOS 8 system to act as both a Samba client and server allowing the sharing of resources with Windows based systems. Topics covered included the installation of Samba client and server packages and configuration of Samba as a standalone server. In addition, the basic concepts of SELinux were introduced together with the steps to provide Samba with access to a shared resource. </p>&#13;
		</div>&#13;
</div>



  </body></html>