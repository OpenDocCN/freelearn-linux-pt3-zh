<html><head></head><body>
<div class="Basic-Text-Frame" id="_idContainer040">
<h1 class="chapterNumber"><span class="koboSpan" id="kobo.1.1">3</span></h1>
<h1 class="chapterTitle" id="_idParaDest-59"><span class="koboSpan" id="kobo.2.1">Service Management with systemd</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.3.1">In the previous chapter, you learned about how processes work in Linux. </span><span class="koboSpan" id="kobo.3.2">Now it’s time to look at how these processes are wrapped in an additional layer of abstraction: the </span><em class="italic"><span class="koboSpan" id="kobo.4.1">systemd service</span></em><span class="koboSpan" id="kobo.5.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.6.1">The commands you’ve seen so far – </span><code class="inlineCode"><span class="koboSpan" id="kobo.7.1">ls</span></code><span class="koboSpan" id="kobo.8.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.9.1">mv</span></code><span class="koboSpan" id="kobo.10.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.11.1">rm</span></code><span class="koboSpan" id="kobo.12.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.13.1">ps</span></code><span class="koboSpan" id="kobo.14.1">, and others – run in the foreground, attached to your shell session. </span><span class="koboSpan" id="kobo.14.2">You run them, the programs do their job, and then they exit. </span><span class="koboSpan" id="kobo.14.3">However, not all programs run like this.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.15.1">Services, also </span><a id="_idIndexMarker103"/><span class="koboSpan" id="kobo.16.1">frequently called daemons, are</span><a id="_idIndexMarker104"/><span class="koboSpan" id="kobo.17.1"> long-running processes that run in the background. </span><span class="koboSpan" id="kobo.17.2">These can be things like databases and web servers, but also regular system services like your network manager, your desktop environment, and so on. </span><span class="koboSpan" id="kobo.17.3">These long-running </span><a id="_idIndexMarker105"/><span class="koboSpan" id="kobo.18.1">background </span><a id="_idIndexMarker106"/><span class="koboSpan" id="kobo.19.1">services are typically started and controlled via an </span><strong class="keyWord"><span class="koboSpan" id="kobo.20.1">init</span></strong><span class="koboSpan" id="kobo.21.1"> system such as </span><strong class="keyWord"><span class="koboSpan" id="kobo.22.1">systemd</span></strong><span class="koboSpan" id="kobo.23.1">.</span></p>
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.24.1">init</span></strong><span class="koboSpan" id="kobo.25.1"> here refers to the </span><a id="_idIndexMarker107"/><span class="koboSpan" id="kobo.26.1">first process your operating system kernel starts, and it is the job of this process to take care of starting any other processes.</span></p>
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.27.1">systemd</span></strong><span class="koboSpan" id="kobo.28.1"> services</span><a id="_idIndexMarker108"/><span class="koboSpan" id="kobo.29.1"> are controlled using a command line utility called </span><code class="inlineCode"><span class="koboSpan" id="kobo.30.1">systemctl</span></code><span class="koboSpan" id="kobo.31.1">. </span><span class="koboSpan" id="kobo.31.2">It will be used for starting and stopping services, for example, to restart a service that’s misbehaving or to reload one whose configuration has changed.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.32.1">If you’re bouncing around the book and haven’t read the previous chapter yet, you can still get value out of this one. </span><span class="koboSpan" id="kobo.32.2">For now, just think of a process as any running command, application, or service. </span><span class="koboSpan" id="kobo.32.3">When you’re ready to learn about how processes work in more detail, you can read </span><em class="chapterRef"><span class="koboSpan" id="kobo.33.1">Chapter 2</span></em><span class="koboSpan" id="kobo.34.1">, </span><em class="italic"><span class="koboSpan" id="kobo.35.1">Working with Processes</span></em><span class="koboSpan" id="kobo.36.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.37.1">In this chapter, you’ll learn all about:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.38.1">The command you’ll use to interact with </span><code class="inlineCode"><span class="koboSpan" id="kobo.39.1">systemd</span></code><span class="koboSpan" id="kobo.40.1"> services: </span><code class="inlineCode"><span class="koboSpan" id="kobo.41.1">systemctl</span></code></li>
<li class="bulletList"><span class="koboSpan" id="kobo.42.1">A slightly deeper dive into what an init system does, and how </span><code class="inlineCode"><span class="koboSpan" id="kobo.43.1">systemd</span></code><span class="koboSpan" id="kobo.44.1"> specifically fills this role</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.45.1">Managing services with </span><code class="inlineCode"><span class="koboSpan" id="kobo.46.1">systemctl</span></code></li>
<li class="bulletList"><span class="koboSpan" id="kobo.47.1">A few tips for working in container environments (like Docker containers), which usually don’t have the kind of robust service management layer we describe in this chapter</span></li>
</ul>
<div class="note">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.48.1">Note</span></strong></p>
<p class="normal"><span class="koboSpan" id="kobo.49.1">This chapter applies to Linux only – macOS and Windows (and even other Unixes) manage processes using different tools. </span><span class="koboSpan" id="kobo.49.2">In fact, different Linux distributions use different tools, however, </span><code class="inlineCode"><span class="koboSpan" id="kobo.50.1">systemd</span></code><span class="koboSpan" id="kobo.51.1"> is the most widely used one. </span><span class="koboSpan" id="kobo.51.2">While the concepts are similar, knowing how modern Linux environments manage services is most useful for developers.</span></p>
</div>
<h1 class="heading-1" id="_idParaDest-60"><span class="koboSpan" id="kobo.52.1">The basics</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.53.1">Linux services</span><a id="_idIndexMarker109"/><span class="koboSpan" id="kobo.54.1"> are background processes that run on a Linux system to perform specific tasks. </span><span class="koboSpan" id="kobo.54.2">They are similar to Windows services or daemons on macOS.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.55.1">Most non-containerized Linux environments use </span><code class="inlineCode"><span class="koboSpan" id="kobo.56.1">systemd</span></code><span class="koboSpan" id="kobo.57.1"> to manage services. </span><span class="koboSpan" id="kobo.57.2">The two tools you’ll use to interact with </span><code class="inlineCode"><span class="koboSpan" id="kobo.58.1">systemd</span></code><span class="koboSpan" id="kobo.59.1"> are:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.60.1">systemctl</span></code><span class="koboSpan" id="kobo.61.1">: Controls services (called ‘units’ in </span><code class="inlineCode"><span class="koboSpan" id="kobo.62.1">systemd</span></code><span class="koboSpan" id="kobo.63.1"> nomenclature)</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.64.1">journalctl</span></code><span class="koboSpan" id="kobo.65.1">: Lets you</span><a id="_idIndexMarker110"/><span class="koboSpan" id="kobo.66.1"> work with system logs</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.67.1">We’ll cover </span><code class="inlineCode"><span class="koboSpan" id="kobo.68.1">systemctl</span></code><span class="koboSpan" id="kobo.69.1"> in this chapter, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.70.1">journalctl</span></code><span class="koboSpan" id="kobo.71.1"> in </span><em class="chapterRef"><span class="koboSpan" id="kobo.72.1">Chapter 16</span></em><span class="koboSpan" id="kobo.73.1">, </span><em class="italic"><span class="koboSpan" id="kobo.74.1">Monitoring Application Logs</span></em><span class="koboSpan" id="kobo.75.1">, later in the book.</span></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.76.1">systemd</span></code><span class="koboSpan" id="kobo.77.1"> is a</span><a id="_idIndexMarker111"/><span class="koboSpan" id="kobo.78.1"> system and service manager for Linux that provides a standard way to manage services. </span><span class="koboSpan" id="kobo.78.2">It is now widely used as the default init system for most Linux distributions. </span><span class="koboSpan" id="kobo.78.3">Many Linux distributions previously made use of the SysV init systems, which come from Unix and are still used by many modern Unix operating systems. </span><span class="koboSpan" id="kobo.78.4">Others, such as Alpine and Gentoo Linux, use OpenRC as their init systems. </span><span class="koboSpan" id="kobo.78.5">There are many more init systems out there, however, the overwhelming majority of Linux distributions now use </span><code class="inlineCode"><span class="koboSpan" id="kobo.79.1">systemd</span></code><span class="koboSpan" id="kobo.80.1">. </span><span class="koboSpan" id="kobo.80.2">With </span><code class="inlineCode"><span class="koboSpan" id="kobo.81.1">systemd</span></code><span class="koboSpan" id="kobo.82.1">, services can be started, stopped, restarted, enabled (set to start at boot), and disabled, and their status can be checked. </span><span class="koboSpan" id="kobo.82.2">Services are defined by a </span><em class="italic"><span class="koboSpan" id="kobo.83.1">unit file</span></em><span class="koboSpan" id="kobo.84.1">, which specifies exactly how the service should be managed by systemd.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.85.1">To manage services with </span><code class="inlineCode"><a id="_idIndexMarker112"/></code><code class="inlineCode"><span class="koboSpan" id="kobo.86.1">systemd</span></code><span class="koboSpan" id="kobo.87.1">, you can use the following basic commands (we’ll dive into each one later in this chapter):</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.88.1">systemctl start &lt;service&gt;</span></code><span class="koboSpan" id="kobo.89.1">: starts a service.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.90.1">systemctl stop &lt;service&gt;</span></code><span class="koboSpan" id="kobo.91.1">: stops a service.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.92.1">systemctl restart &lt;service&gt;</span></code><span class="koboSpan" id="kobo.93.1">: restarts a service.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.94.1">systemctl status &lt;service&gt;</span></code><span class="koboSpan" id="kobo.95.1">: displays the current status of a service.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.96.1">Remember that only users with root privileges (e.g., using </span><code class="inlineCode"><span class="koboSpan" id="kobo.97.1">sudo</span></code><span class="koboSpan" id="kobo.98.1">) can manage system services with </span><code class="inlineCode"><span class="koboSpan" id="kobo.99.1">systemd</span></code><span class="koboSpan" id="kobo.100.1">.</span></p>
<h2 class="heading-2" id="_idParaDest-61"><span class="koboSpan" id="kobo.101.1">init</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.102.1">Let’s take a quick detour to define a</span><a id="_idIndexMarker113"/><span class="koboSpan" id="kobo.103.1"> common term that you’ll see used often. </span><span class="koboSpan" id="kobo.103.2">In Linux, </span><code class="inlineCode"><span class="koboSpan" id="kobo.104.1">init</span></code><span class="koboSpan" id="kobo.105.1"> – short for ‘initialization’ – is the first process that is started when the system boots up. </span><span class="koboSpan" id="kobo.105.2">Unsurprisingly, you can find it at PID 1. </span><span class="koboSpan" id="kobo.105.3">init is responsible for managing the boot process and starting all other processes and services that have been configured to run on the system. </span><span class="koboSpan" id="kobo.105.4">It also re-parents orphaned processes (processes whose original parent process has died) and keeps them as its own children, to ensure they still behave normally.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.106.1">Like almost everything in the Linux world, there are several different, mutually exclusive programs that can fill this role. </span><span class="koboSpan" id="kobo.106.2">They are all referred to as </span><em class="italic"><span class="koboSpan" id="kobo.107.1">init systems</span></em><span class="koboSpan" id="kobo.108.1">, which is the general name for any software that can fill this important bootstrapping, initializing, and coordinating role. </span><span class="koboSpan" id="kobo.108.2">As </span><a id="_idIndexMarker114"/><span class="koboSpan" id="kobo.109.1">mentioned previously, there are several init systems available for Linux, including </span><strong class="keyWord"><span class="koboSpan" id="kobo.110.1">System V init</span></strong><span class="koboSpan" id="kobo.111.1"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.112.1">SysV</span></strong><span class="koboSpan" id="kobo.113.1">), OpenRC, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.114.1">systemd</span></code><span class="koboSpan" id="kobo.115.1">. </span><span class="koboSpan" id="kobo.115.2">Most modern Linux systems have switched to systemd, which is why that’s the one we’re covering here.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.116.1">Which init system you’re using will determine how services are defined and managed, so keep in mind that everything you see here applies only to systemd.</span></p>
<h1 class="heading-1" id="_idParaDest-62"><span class="koboSpan" id="kobo.117.1">Processes and services</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.118.1">Let’s talk about the subtle difference between processes</span><a id="_idIndexMarker115"/><span class="koboSpan" id="kobo.119.1"> and services. </span><span class="koboSpan" id="kobo.119.2">You can think of a service as some packaging around a piece of software that makes it easier to manage as a running process.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.120.1">A service</span><a id="_idIndexMarker116"/><span class="koboSpan" id="kobo.121.1"> adds convenient features to how a program (and the resulting process spawned by that program) is handled by the system. </span><span class="koboSpan" id="kobo.121.2">For example, it lets you define dependencies between different processes, control startup order, add environment variables for the process to start with, limit resource usage, control permissions, and many other useful things. </span><span class="koboSpan" id="kobo.121.3">To tie a bow around the whole package, a service provides a simple name to reference your program. </span><span class="koboSpan" id="kobo.121.4">We’ll show you how to create your own service in the later </span><em class="chapterRef"><span class="koboSpan" id="kobo.122.1">Chapter 10</span></em><span class="koboSpan" id="kobo.123.1">, </span><em class="italic"><span class="koboSpan" id="kobo.124.1">Configuring Software</span></em><span class="koboSpan" id="kobo.125.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.126.1">In the rest of this chapter, we’ll stick to managing existing services.</span></p>
<h1 class="heading-1" id="_idParaDest-63"><span class="koboSpan" id="kobo.127.1">systemctl commands</span></h1>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.128.1">systemctl</span></code><span class="koboSpan" id="kobo.129.1"> is the tool you’ll use to</span><a id="_idIndexMarker117"/><span class="koboSpan" id="kobo.130.1"> manage the services that have been defined on your system. </span><span class="koboSpan" id="kobo.130.2">These examples will use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.131.1">foobar</span></code><span class="koboSpan" id="kobo.132.1"> service, which doesn’t really exist, as a stand-in for whatever service you might be managing.</span></p>
<h2 class="heading-2" id="_idParaDest-64"><span class="koboSpan" id="kobo.133.1">Checking the status of a service</span></h2>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.134.1">systemctl status &lt;service&gt;</span></code><span class="koboSpan" id="kobo.135.1"> checks the </span><a id="_idIndexMarker118"/><span class="koboSpan" id="kobo.136.1">status of the service. </span><span class="koboSpan" id="kobo.136.2">You’ll get an assortment of data that’s useful for all kinds of troubleshooting tasks. </span><span class="koboSpan" id="kobo.136.3">This is what the output for the nginx web server’s service looks like:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.137.1"><img alt="" role="presentation" src="../Images/B19251_03_01.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.138.1">Figure 3.1: nginx web server service output</span></p>
<p class="normal"><span class="koboSpan" id="kobo.139.1">Let’s dissect the</span><a id="_idIndexMarker119"/><span class="koboSpan" id="kobo.140.1"> information that’s displayed in the dense output that this command produces, line by line:</span></p>
<ul>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.141.1">Service name</span></strong><span class="koboSpan" id="kobo.142.1">: The name of the service as defined in its unit file.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.143.1">Load state</span></strong><span class="koboSpan" id="kobo.144.1">: Whether the service unit file has been successfully loaded and is ready to be started.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.145.1">Active state</span></strong><span class="koboSpan" id="kobo.146.1">: The current state of the service – whether it is running, inactive, or failed – and how long it’s been that way.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.147.1">Docs</span></strong><span class="koboSpan" id="kobo.148.1">: The main page where you can find relevant documentation if it’s been installed.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.149.1">Main PID and child processes:</span></strong><span class="koboSpan" id="kobo.150.1"> The </span><strong class="keyWord"><span class="koboSpan" id="kobo.151.1">process ID</span></strong><span class="koboSpan" id="kobo.152.1"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.153.1">PID</span></strong><span class="koboSpan" id="kobo.154.1">) of the main process associated with the service, with additional entries</span><a id="_idIndexMarker120"/><span class="koboSpan" id="kobo.155.1"> for any child processes that have been launched.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.156.1">Resource usage</span></strong><span class="koboSpan" id="kobo.157.1">: RAM (memory) and CPU time.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.158.1">CGroup</span></strong><span class="koboSpan" id="kobo.159.1">: Details about the control group to which this process belongs.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.160.1">Log preview</span></strong><span class="koboSpan" id="kobo.161.1">: A few loglines from the service’s output, to give you an idea of what’s happening.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.162.1">This information provides a detailed overview of the service and its status and can be useful for debugging issues or checking the health of the service.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.163.1">If the service has failed, the output will usually provide details on why it failed, such as the exit code or a description of the error.</span></p>
<h2 class="heading-2" id="_idParaDest-65"><span class="koboSpan" id="kobo.164.1">Starting a service</span></h2>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.165.1">systemctl start foobar
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.166.1">This starts the service. </span><span class="koboSpan" id="kobo.166.2">If the</span><a id="_idIndexMarker121"/><span class="koboSpan" id="kobo.167.1"> service was already running, this command would have no effect.</span></p>
<h2 class="heading-2" id="_idParaDest-66"><span class="koboSpan" id="kobo.168.1">Stopping a service</span></h2>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.169.1">systemctl stop foobar
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.170.1">This stops the service. </span><span class="koboSpan" id="kobo.170.2">If the </span><a id="_idIndexMarker122"/><span class="koboSpan" id="kobo.171.1">service wasn’t running, then it should have no effect.</span></p>
<h2 class="heading-2" id="_idParaDest-67"><span class="koboSpan" id="kobo.172.1">Restarting a service</span></h2>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.173.1">systemctl restart foobar
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.174.1">This stops and then starts a </span><a id="_idIndexMarker123"/><span class="koboSpan" id="kobo.175.1">service. </span><span class="koboSpan" id="kobo.175.2">It is equivalent to running:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.176.1">systemctl stop foobar
systemctl start foobar
</span></code></pre>
<div class="note">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.177.1">Note</span></strong></p>
<p class="normal"><span class="koboSpan" id="kobo.178.1">Be careful with this command: if a service’s configuration file has changed on disk since it was started, and that config file has a bug that prevents the program from successfully starting, then </span><code class="inlineCode"><span class="koboSpan" id="kobo.179.1">restart</span></code><span class="koboSpan" id="kobo.180.1"> will happily stop your running service and then fail to start it again.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.181.1">This logical but potentially undesirable behavior has bitten many developers over the years, so take care to ensure that your service’s configuration is still valid before restarting.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.182.1">Many popular programs have built-in configuration validation, e.g., for </span><code class="inlineCode"><span class="koboSpan" id="kobo.183.1">nginx</span></code><span class="koboSpan" id="kobo.184.1">, you can run:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.185.1">nginx –t
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.186.1">to test the configuration on disk.</span></p>
</div>
<h2 class="heading-2" id="_idParaDest-68"><span class="koboSpan" id="kobo.187.1">Reloading a service</span></h2>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.188.1">systemctl reload foobar
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.189.1">Not all services</span><a id="_idIndexMarker124"/><span class="koboSpan" id="kobo.190.1"> support this subcommand – it’s up to the person creating the service configuration to implement it. </span><span class="koboSpan" id="kobo.190.2">If a service does have a </span><code class="inlineCode"><span class="koboSpan" id="kobo.191.1">reload</span></code><span class="koboSpan" id="kobo.192.1"> option, it is generally safer than </span><code class="inlineCode"><span class="koboSpan" id="kobo.193.1">restart</span></code><span class="koboSpan" id="kobo.194.1">.</span></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.195.1">U</span></code><span class="koboSpan" id="kobo.196.1">sually, a </span><code class="inlineCode"><span class="koboSpan" id="kobo.197.1">reload</span></code><span class="koboSpan" id="kobo.198.1">:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.199.1">re-checks the configuration on disk to ensure that it’s valid</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.200.1">re-reads the configuration into memory without interrupting the running process, if possible</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.201.1">restarts the process only after validating the config and making sure the process will start successfully after being stopped</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.202.1">Like so many things in Linux, this is a convention rather than a strictly enforced requirement, so you may run into software that:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.203.1">doesn’t implement a </span><code class="inlineCode"><span class="koboSpan" id="kobo.204.1">reload</span></code><span class="koboSpan" id="kobo.205.1"> subcommand</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.206.1">doesn’t implement some of the safety features discussed above (config validation, etc.)</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.207.1">does something else with a </span><code class="inlineCode"><span class="koboSpan" id="kobo.208.1">reload</span></code><span class="koboSpan" id="kobo.209.1">, because the developer or packager thought it was a good idea</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.210.1">In general, when </span><a id="_idIndexMarker125"/><span class="koboSpan" id="kobo.211.1">updating the configuration file for an application, especially in production environments, you should prefer </span><code class="inlineCode"><span class="koboSpan" id="kobo.212.1">reload</span></code><span class="koboSpan" id="kobo.213.1"> over </span><code class="inlineCode"><span class="koboSpan" id="kobo.214.1">restart</span></code><span class="koboSpan" id="kobo.215.1">.</span></p>
<h2 class="heading-2" id="_idParaDest-69"><span class="koboSpan" id="kobo.216.1">Enable and disable</span></h2>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.217.1">systemctl enable foobar</span></code><span class="koboSpan" id="kobo.218.1"> – configures </span><code class="inlineCode"><span class="koboSpan" id="kobo.219.1">foobar</span></code><span class="koboSpan" id="kobo.220.1"> to start automatically on boot. </span><code class="inlineCode"><span class="koboSpan" id="kobo.221.1">systemctl disable foobar</span></code><span class="koboSpan" id="kobo.222.1"> – if </span><code class="inlineCode"><span class="koboSpan" id="kobo.223.1">foobar</span></code><span class="koboSpan" id="kobo.224.1"> is configured to start automatically, gets rid of that configuration and turns</span><a id="_idIndexMarker126"/><span class="koboSpan" id="kobo.225.1"> foobar into a manually managed service.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.226.1">The key difference here is that while </span><code class="inlineCode"><span class="koboSpan" id="kobo.227.1">start</span></code><span class="koboSpan" id="kobo.228.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.229.1">stop</span></code><span class="koboSpan" id="kobo.230.1"> have an immediate effect – they ensure that a service is running (or stopped) </span><em class="italic"><span class="koboSpan" id="kobo.231.1">right now</span></em><span class="koboSpan" id="kobo.232.1">; </span><code class="inlineCode"><span class="koboSpan" id="kobo.233.1">enable</span></code><span class="koboSpan" id="kobo.234.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.235.1">disable</span></code><span class="koboSpan" id="kobo.236.1"> are about future system startups. </span><span class="koboSpan" id="kobo.236.2">However, they have no effect on that service’s ‘running’ status at the time you run the</span><a id="_idIndexMarker127"/><span class="koboSpan" id="kobo.237.1"> command.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.238.1">One common mistake that developers make is to assume that </span><code class="inlineCode"><span class="koboSpan" id="kobo.239.1">enable</span></code><span class="koboSpan" id="kobo.240.1"> will start a service. </span><span class="koboSpan" id="kobo.240.2">It won’t. </span><span class="koboSpan" id="kobo.240.3">If you want to start an </span><code class="inlineCode"><span class="koboSpan" id="kobo.241.1">nginx</span></code><span class="koboSpan" id="kobo.242.1"> web server now and ensure that it automatically starts every time the VM is rebooted, you need to run two commands:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.243.1">systemctl start nginx
systemctl enable nginx
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.244.1">Because of this, </span><code class="inlineCode"><span class="koboSpan" id="kobo.245.1">enable</span></code><span class="koboSpan" id="kobo.246.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.247.1">disable</span></code><span class="koboSpan" id="kobo.248.1"> come with an optional flag that also starts (or stops, in the case of </span><code class="inlineCode"><span class="koboSpan" id="kobo.249.1">disable</span></code><span class="koboSpan" id="kobo.250.1">) the service. </span><span class="koboSpan" id="kobo.250.2">This command is equivalent to the two commands above:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.251.1">systemctl enable --now nginx
</span></code></pre>
<h1 class="heading-1" id="_idParaDest-70"><span class="koboSpan" id="kobo.252.1">A note on Docker</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.253.1">While </span><code class="inlineCode"><span class="koboSpan" id="kobo.254.1">systemctl</span></code><span class="koboSpan" id="kobo.255.1"> is a common tool for managing services on traditional Linux systems, it is generally not used in Docker containers due to containers’ isolated and self-contained nature.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.256.1">Docker</span><a id="_idIndexMarker128"/><span class="koboSpan" id="kobo.257.1"> containers ideally run a single process and therefore don’t require a complex boot phase or process management. </span><span class="koboSpan" id="kobo.257.2">The container, in essence, </span><em class="italic"><span class="koboSpan" id="kobo.258.1">is</span></em><span class="koboSpan" id="kobo.259.1"> the process and doesn’t have access to the host system’s init system (including </span><code class="inlineCode"><span class="koboSpan" id="kobo.260.1">systemd</span></code><span class="koboSpan" id="kobo.261.1">).</span></p>
<p class="normal"><span class="koboSpan" id="kobo.262.1">Although it’s possible to have access to these commands in a Docker container, it’s usually undesirable to use any kind of service-management system inside of them.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.263.1">Docker containers ideally contain a single application and launch a single process when they start. </span><span class="koboSpan" id="kobo.263.2">For this, no service management is needed – the running container is your service package, and your Docker container essentially </span><em class="italic"><span class="koboSpan" id="kobo.264.1">is</span></em><span class="koboSpan" id="kobo.265.1"> your process.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.266.1">We don’t recommend a Docker setup that includes multiple processes or significant internal service management, so we won’t get into it here: much like families, all happy Docker images are alike in the same way, while each unhappy Docker configuration is unhappy in its own way.</span></p>
<h1 class="heading-1" id="_idParaDest-71"><span class="koboSpan" id="kobo.267.1">Conclusion</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.268.1">In this chapter, you learned how services are managed in Linux, and we introduced the practical commands you’ll use to control them. </span><span class="koboSpan" id="kobo.268.2">We gave you the theory you’ll need to make sense of all the terminology you’ll come across on a live system: what init is, what systemd does on Linux systems, and which commands you need to interact with it.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.269.1">In the next chapter, we’ll show you some useful tricks for interacting with your shell and your command history, so you can save time and look like a Unix wizard from your favorite movie (it will also make you faster and more efficient at your day job, but putting it that way just doesn’t make it sound as fun).</span></p>
<h1 class="heading-1"><span class="koboSpan" id="kobo.270.1">Learn more on Discord</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.271.1">To join the Discord community for this book – where you can share feedback, ask questions to the author, and learn about new releases – follow the QR code below:</span></p>
<p class="normal"><a href="https://packt.link/SecNet"><span class="url"><span class="koboSpan" id="kobo.272.1">https://packt.link/SecNet</span></span></a></p>
<p class="normal"><span class="koboSpan" id="kobo.273.1"><img alt="" role="presentation" src="../Images/QR_Code1768422420210094187.png"/></span></p>
</div>
</body></html>