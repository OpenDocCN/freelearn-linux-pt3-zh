<html><head></head><body>
<div id="_idContainer185">
<h1 class="chapter-number" id="_idParaDest-153"><a id="_idTextAnchor182"/><span class="koboSpan" id="kobo.1.1">15</span></h1>
<h1 id="_idParaDest-154"><a id="_idTextAnchor183"/><span class="koboSpan" id="kobo.2.1">Booting Our Custom Embedded Linux</span></h1>
<p><span class="koboSpan" id="kobo.3.1">It’s time! </span><span class="koboSpan" id="kobo.3.2">We are ready to boot our custom-made embedded Linux, as we have learned the required concepts and gained enough knowledge about the Yocto Project and Poky. </span><span class="koboSpan" id="kobo.3.3">In this chapter, we will practice what we have learned so far about using Poky with external BSP layers to generate an image for use with the following machines and boot it using the </span><span class="No-Break"><span class="koboSpan" id="kobo.4.1">SD card:</span></span></p>
<ul>
<li><span class="No-Break"><span class="koboSpan" id="kobo.5.1">BeagleBone Black</span></span></li>
<li><span class="koboSpan" id="kobo.6.1">Raspberry </span><span class="No-Break"><span class="koboSpan" id="kobo.7.1">Pi 4</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.8.1">VisionFive</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.9.1">The concepts in this chapter can be applied to every other board as long as the vendor provides a BSP layer to use with the </span><span class="No-Break"><span class="koboSpan" id="kobo.10.1">Yocto Project.</span></span></p>
<h1 id="_idParaDest-155"><a id="_idTextAnchor184"/><span class="koboSpan" id="kobo.11.1">Discovering the right BSP layer</span></h1>
<p><span class="koboSpan" id="kobo.12.1">In </span><a href="B19361_11.xhtml#_idTextAnchor140"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.13.1">Chapter 11</span></em></span></a><span class="koboSpan" id="kobo.14.1">, </span><em class="italic"><span class="koboSpan" id="kobo.15.1">Exploring External Layers</span></em><span class="koboSpan" id="kobo.16.1">, we learned that the Yocto Project allows for splitting its </span><a id="_idIndexMarker451"/><span class="koboSpan" id="kobo.17.1">metadata among different layers. </span><span class="koboSpan" id="kobo.17.2">It organizes the metadata so we can choose which exact meta layer to add to </span><span class="No-Break"><span class="koboSpan" id="kobo.18.1">our project.</span></span></p>
<p><span class="koboSpan" id="kobo.19.1">The way to find the BSP for a board varies, but generally, we can find it by visiting </span><a href="https://layers.openembedded.org"><span class="koboSpan" id="kobo.20.1">https://layers.openembedded.org</span></a><span class="koboSpan" id="kobo.21.1">. </span><span class="koboSpan" id="kobo.21.2">We can search for the machine name and the website finds which layer contains it in </span><span class="No-Break"><span class="koboSpan" id="kobo.22.1">its database.</span></span></p>
<h2 id="_idParaDest-156"><a id="_idTextAnchor185"/><span class="koboSpan" id="kobo.23.1">Reviewing aspects that impact hardware use</span></h2>
<p><span class="koboSpan" id="kobo.24.1">The boards </span><a id="_idIndexMarker452"/><span class="koboSpan" id="kobo.25.1">used in this chapter are well maintained and straightforward. </span><span class="koboSpan" id="kobo.25.2">However, using a different board is a valid choice, but your mileage </span><span class="No-Break"><span class="koboSpan" id="kobo.26.1">may vary.</span></span></p>
<p><span class="koboSpan" id="kobo.27.1">When we choose a board, the first step is to verify the quality of its software support. </span><span class="koboSpan" id="kobo.27.2">The low-level components comprise </span><span class="No-Break"><span class="koboSpan" id="kobo.28.1">the following:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.29.1">Bootloader (such as U-Boot, GRUB, </span><span class="No-Break"><span class="koboSpan" id="kobo.30.1">or systemd-boot)</span></span></li>
<li><span class="koboSpan" id="kobo.31.1">Linux kernel (with other required drivers such as GPU </span><span class="No-Break"><span class="koboSpan" id="kobo.32.1">or WiFi)</span></span></li>
<li><span class="koboSpan" id="kobo.33.1">User space packages required by </span><span class="No-Break"><span class="koboSpan" id="kobo.34.1">hardware acceleration</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.35.1">Those are critical but are not the only aspects to consider. </span><span class="koboSpan" id="kobo.35.2">The integration inside the Yocto Project, in a BSP layer form, reduces the friction in the board use as it usually provides </span><span class="No-Break"><span class="koboSpan" id="kobo.36.1">the following:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.37.1">A reusable disk partition layout (e.g., a WIC </span><strong class="source-inline"><span class="koboSpan" id="kobo.38.1">.</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.39.1">wks</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.40.1"> template)</span></span></li>
<li><span class="koboSpan" id="kobo.41.1">Ready-to-use </span><span class="No-Break"><span class="koboSpan" id="kobo.42.1">machine definitions</span></span></li>
<li><span class="koboSpan" id="kobo.43.1">User space packages integrated for hardware acceleration (usable out of </span><span class="No-Break"><span class="koboSpan" id="kobo.44.1">the box)</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.45.1">The maturity </span><a id="_idIndexMarker453"/><span class="koboSpan" id="kobo.46.1">level of software enablement, and the Yocto Project BSP, significantly impact the friction involved in using the board and the out-of-the-box experience when using Poky for </span><span class="No-Break"><span class="koboSpan" id="kobo.47.1">different boards.</span></span></p>
<h2 id="_idParaDest-157"><a id="_idTextAnchor186"/><span class="koboSpan" id="kobo.48.1">Taking a look at widely used BSP layers</span></h2>
<p><span class="koboSpan" id="kobo.49.1">We will see a list of widely used BSP layers in this chapter. </span><span class="koboSpan" id="kobo.49.2">This should not be taken as a complete list </span><a id="_idIndexMarker454"/><span class="koboSpan" id="kobo.50.1">or as a definitive one. </span><span class="koboSpan" id="kobo.50.2">Still, we want to facilitate your search for the required layer in case you have one board of a specific vendor next to you. </span><span class="koboSpan" id="kobo.50.3">This list is as follows, in </span><span class="No-Break"><span class="koboSpan" id="kobo.51.1">alphabetic order:</span></span></p>
<ul>
<li><em class="italic"><span class="koboSpan" id="kobo.52.1">Allwinner</span></em><span class="koboSpan" id="kobo.53.1">: This has the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.54.1">meta-allwinner</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.55.1"> layer</span></span></li>
<li><em class="italic"><span class="koboSpan" id="kobo.56.1">AMD</span></em><span class="koboSpan" id="kobo.57.1">: This has the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.58.1">meta-amd</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.59.1"> layer</span></span></li>
<li><em class="italic"><span class="koboSpan" id="kobo.60.1">Intel</span></em><span class="koboSpan" id="kobo.61.1">: This has the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.62.1">meta-intel</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.63.1"> layer</span></span></li>
<li><em class="italic"><span class="koboSpan" id="kobo.64.1">NXP</span></em><span class="koboSpan" id="kobo.65.1">: This has the </span><strong class="source-inline"><span class="koboSpan" id="kobo.66.1">meta-freescale</span></strong><span class="koboSpan" id="kobo.67.1"> and </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.68.1">meta-freescale-3rdparty</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.69.1"> layers</span></span></li>
<li><em class="italic"><span class="koboSpan" id="kobo.70.1">Raspberry Pi</span></em><span class="koboSpan" id="kobo.71.1">: This has the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.72.1">meta-raspberrypi</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.73.1"> layer</span></span></li>
<li><em class="italic"><span class="koboSpan" id="kobo.74.1">RISC-V</span></em><span class="koboSpan" id="kobo.75.1">: This has the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.76.1">meta-riscv</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.77.1"> layer</span></span></li>
<li><em class="italic"><span class="koboSpan" id="kobo.78.1">Texas Instruments</span></em><span class="koboSpan" id="kobo.79.1">: This has </span><a id="_idIndexMarker455"/><span class="koboSpan" id="kobo.80.1">the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.81.1">meta-ti</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.82.1"> layer</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.83.1">In the next sections, we start to work with the </span><span class="No-Break"><span class="koboSpan" id="kobo.84.1">example boards.</span></span></p>
<h1 id="_idParaDest-158"><a id="_idTextAnchor187"/><span class="koboSpan" id="kobo.85.1">Using physical hardware</span></h1>
<p><span class="koboSpan" id="kobo.86.1">To ease the exploration of the Yocto Project’s capabilities, it is good to have a real board so we can enjoy the </span><a id="_idIndexMarker456"/><span class="koboSpan" id="kobo.87.1">experience of booting our customized embedded system. </span><span class="koboSpan" id="kobo.87.2">For this, we have tried to collect the most widely available boards so the chances of you owning one </span><span class="No-Break"><span class="koboSpan" id="kobo.88.1">are higher.</span></span></p>
<p><span class="koboSpan" id="kobo.89.1">The next sections will cover the steps for the </span><span class="No-Break"><span class="koboSpan" id="kobo.90.1">following boards:</span></span></p>
<ul>
<li><em class="italic"><span class="koboSpan" id="kobo.91.1">BeagleBone Black</span></em><span class="koboSpan" id="kobo.92.1">: BeagleBone Black is community-based, with members worldwide. </span><span class="koboSpan" id="kobo.92.2">Further </span><a id="_idIndexMarker457"/><span class="koboSpan" id="kobo.93.1">information is available </span><span class="No-Break"><span class="koboSpan" id="kobo.94.1">at </span></span><a href="https://beagleboard.org/black/"><span class="No-Break"><span class="koboSpan" id="kobo.95.1">https://beagleboard.org/black/</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.96.1">.</span></span></li>
<li><em class="italic"><span class="koboSpan" id="kobo.97.1">Raspberry Pi 4</span></em><span class="koboSpan" id="kobo.98.1">: The most </span><a id="_idIndexMarker458"/><span class="koboSpan" id="kobo.99.1">famous ARM64-based board with the broadest community spread worldwide. </span><span class="koboSpan" id="kobo.99.2">See more details </span><span class="No-Break"><span class="koboSpan" id="kobo.100.1">at </span></span><a href="https://www.raspberrypi.org/"><span class="No-Break"><span class="koboSpan" id="kobo.101.1">https://www.raspberrypi.org/</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.102.1">.</span></span></li>
<li><em class="italic"><span class="koboSpan" id="kobo.103.1">VisionFive</span></em><span class="koboSpan" id="kobo.104.1">: The world’s </span><a id="_idIndexMarker459"/><span class="koboSpan" id="kobo.105.1">first generation of affordable RISC-V boards designed to run Linux. </span><span class="koboSpan" id="kobo.105.2">See more details </span><span class="No-Break"><span class="koboSpan" id="kobo.106.1">at </span></span><a href="https://www.starfivetech.com/en"><span class="No-Break"><span class="koboSpan" id="kobo.107.1">https://www.starfivetech.com/en</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.108.1">.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.109.1">All the boards listed are maintained by non-profit organizations based on education and mentoring, which </span><a id="_idIndexMarker460"/><span class="koboSpan" id="kobo.110.1">makes the community a fertile place to discover the world </span><a id="_idIndexMarker461"/><span class="koboSpan" id="kobo.111.1">of embedded Linux. </span><span class="koboSpan" id="kobo.111.2">The following table summarizes </span><a id="_idIndexMarker462"/><span class="koboSpan" id="kobo.112.1">the boards and their </span><span class="No-Break"><span class="koboSpan" id="kobo.113.1">main features:</span></span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table001-3">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.114.1">Board version</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.115.1">Features</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.116.1">BeagleBone Black</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.117.1">TI AM335x (single-core) 512 </span><span class="No-Break"><span class="koboSpan" id="kobo.118.1">MB RAM</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.119.1">Raspberry </span><span class="No-Break"><span class="koboSpan" id="kobo.120.1">Pi 4</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.121.1">Broadcom BCM2711 64bit CPU (quad-core) 1 GB up to 8 </span><span class="No-Break"><span class="koboSpan" id="kobo.122.1">GB RAM</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.123.1">VisionFive</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.124.1">U74 Dual-Core 8 </span><span class="No-Break"><span class="koboSpan" id="kobo.125.1">GB RAM</span></span></p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.126.1">Table 15.1 – The hardware specification for the covered boards</span></p>
<p><span class="koboSpan" id="kobo.127.1">In the next </span><a id="_idIndexMarker463"/><span class="koboSpan" id="kobo.128.1">sections, we are going to bake and boot the Yocto Project image </span><a id="_idIndexMarker464"/><span class="koboSpan" id="kobo.129.1">for each one of the suggested </span><a id="_idIndexMarker465"/><span class="koboSpan" id="kobo.130.1">machines. </span><span class="koboSpan" id="kobo.130.2">It’s </span><a id="_idIndexMarker466"/><span class="koboSpan" id="kobo.131.1">recommended that you only read the section for the board that you own. </span><span class="koboSpan" id="kobo.131.2">Make sure to consult the board’s documentation in order to understand how to prepare the board for </span><span class="No-Break"><span class="koboSpan" id="kobo.132.1">the operation.</span></span></p>
<h1 id="_idParaDest-159"><a id="_idTextAnchor188"/><span class="koboSpan" id="kobo.133.1">BeagleBone Black</span></h1>
<p><span class="koboSpan" id="kobo.134.1">In the next two sections, we go through the steps for baking and booting an image for the </span><em class="italic"><span class="koboSpan" id="kobo.135.1">BeagleBone </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.136.1">Black</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.137.1"> board.</span></span></p>
<h2 id="_idParaDest-160"><a id="_idTextAnchor189"/><span class="koboSpan" id="kobo.138.1">Baking for BeagleBone Black</span></h2>
<p><span class="koboSpan" id="kobo.139.1">To use this </span><a id="_idIndexMarker467"/><span class="koboSpan" id="kobo.140.1">board, we can rely on the </span><strong class="source-inline"><span class="koboSpan" id="kobo.141.1">meta-yocto-bsp</span></strong><span class="koboSpan" id="kobo.142.1"> layer, which is included by default in Poky. </span><span class="koboSpan" id="kobo.142.2">The </span><a id="_idIndexMarker468"/><span class="koboSpan" id="kobo.143.1">meta layer can be accessed </span><span class="No-Break"><span class="koboSpan" id="kobo.144.1">at </span></span><a href="https://git.yoctoproject.org/meta-yocto/tree/meta-yocto-bsp?h=kirkstone"><span class="No-Break"><span class="koboSpan" id="kobo.145.1">https://git.yoctoproject.org/meta-yocto/tree/meta-yocto-bsp?h=kirkstone</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.146.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.147.1">To create the source structure, please download Poky using the following </span><span class="No-Break"><span class="koboSpan" id="kobo.148.1">command line:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.149.1">
git clone git://git.yoctoproject.org/poky -b kirkstone</span></pre>
<p><span class="koboSpan" id="kobo.150.1">After completing this, we must create the build directory we use for our builds. </span><span class="koboSpan" id="kobo.150.2">We can do this using the following </span><span class="No-Break"><span class="koboSpan" id="kobo.151.1">command line:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.152.1">
source oe-init-build-env build</span></pre>
<p><span class="koboSpan" id="kobo.153.1">After we have the </span><strong class="source-inline"><span class="koboSpan" id="kobo.154.1">build</span></strong><span class="koboSpan" id="kobo.155.1"> directory and the BSP layers properly set up, we can start the build. </span><span class="koboSpan" id="kobo.155.2">Inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.156.1">build</span></strong><span class="koboSpan" id="kobo.157.1"> directory, we must call the </span><span class="No-Break"><span class="koboSpan" id="kobo.158.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.159.1">
MACHINE=beaglebone-yocto bitbake core-image-full-cmdline</span></pre>
<p><span class="koboSpan" id="kobo.160.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.161.1">MACHINE</span></strong><span class="koboSpan" id="kobo.162.1"> variable </span><a id="_idIndexMarker469"/><span class="koboSpan" id="kobo.163.1">can be changed depending on the board we want to use or set </span><span class="No-Break"><span class="koboSpan" id="kobo.164.1">in </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.165.1">build/conf/local.conf</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.166.1">.</span></span></p>
<h2 id="_idParaDest-161"><a id="_idTextAnchor190"/><span class="koboSpan" id="kobo.167.1">Booting BeagleBone Black</span></h2>
<p><span class="koboSpan" id="kobo.168.1">After the build </span><a id="_idIndexMarker470"/><span class="koboSpan" id="kobo.169.1">process is over, the image will be available inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.170.1">build/tmp/deploy/images/beaglebone-yocto/</span></strong><span class="koboSpan" id="kobo.171.1"> directory. </span><span class="koboSpan" id="kobo.171.2">The file we want to use </span><span class="No-Break"><span class="koboSpan" id="kobo.172.1">is </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.173.1">core-image-full-cmdline-beaglebone-yocto.wic</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.174.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.175.1">Make sure you point to the right device and double-check to not write on your </span><span class="No-Break"><span class="koboSpan" id="kobo.176.1">hard disk.</span></span></p>
<p><span class="koboSpan" id="kobo.177.1">To copy the </span><strong class="source-inline"><span class="koboSpan" id="kobo.178.1">core-image-full-cmdline</span></strong><span class="koboSpan" id="kobo.179.1"> image to the SD card, we should use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.180.1">dd</span></strong><span class="koboSpan" id="kobo.181.1"> utility, </span><span class="No-Break"><span class="koboSpan" id="kobo.182.1">as follows:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.183.1">
sudo dd if=core-image-full-cmdline-beaglebone-yocto.wic of=/dev/&lt;media&gt;</span></pre>
<p><span class="koboSpan" id="kobo.184.1">After copying the content to the SD card, insert it into the SD card slot, connect the HDMI cable, and power on the machine. </span><span class="koboSpan" id="kobo.184.2">It should </span><span class="No-Break"><span class="koboSpan" id="kobo.185.1">boot nicely.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.186.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.187.1">The BeagleBone Black boot sequence starts trying to boot from eMMC and only tries to boot from the SD card in case the eMMC boot fails. </span><span class="koboSpan" id="kobo.187.2">Clicking the </span><strong class="bold"><span class="koboSpan" id="kobo.188.1">USER</span></strong><span class="koboSpan" id="kobo.189.1">/</span><strong class="bold"><span class="koboSpan" id="kobo.190.1">BOOT</span></strong><span class="koboSpan" id="kobo.191.1"> button when powering on will temporarily change the boot order, making sure the boot is from the SD card. </span><span class="koboSpan" id="kobo.191.2">To further tailor these instructions for your board, please refer to the documentation </span><span class="No-Break"><span class="koboSpan" id="kobo.192.1">at </span></span><a href="http://www.beagleboard.org/black"><span class="No-Break"><span class="koboSpan" id="kobo.193.1">http://www.beagleboard.org/black</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.194.1">.</span></span></p>
<h1 id="_idParaDest-162"><a id="_idTextAnchor191"/><span class="koboSpan" id="kobo.195.1">Raspberry Pi 4</span></h1>
<p><span class="koboSpan" id="kobo.196.1">In the next two sections, we go through the steps for baking and booting an image for the </span><em class="italic"><span class="koboSpan" id="kobo.197.1">Raspberry Pi </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.198.1">4</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.199.1"> board.</span></span></p>
<h2 id="_idParaDest-163"><a id="_idTextAnchor192"/><span class="koboSpan" id="kobo.200.1">Baking for Raspberry Pi 4</span></h2>
<p><span class="koboSpan" id="kobo.201.1">To add this board </span><a id="_idIndexMarker471"/><span class="koboSpan" id="kobo.202.1">support to our project, we need to include the </span><strong class="source-inline"><span class="koboSpan" id="kobo.203.1">meta-raspberrypi</span></strong><span class="koboSpan" id="kobo.204.1"> meta layer, which is the BSP layer with support for the Raspberry Pi boards, including the Raspberry Pi 4, but not limited to it. </span><span class="koboSpan" id="kobo.204.2">The meta layer </span><a id="_idIndexMarker472"/><span class="koboSpan" id="kobo.205.1">can be accessed </span><span class="No-Break"><span class="koboSpan" id="kobo.206.1">at </span></span><a href="http://git.yoctoproject.org/cgit.cgi/meta-raspberrypi/log/?h=kirkstone"><span class="No-Break"><span class="koboSpan" id="kobo.207.1">http://git.yoctoproject.org/cgit.cgi/meta-raspberrypi/log/?h=kirkstone</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.208.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.209.1">To create the source structure, please download Poky using the following </span><span class="No-Break"><span class="koboSpan" id="kobo.210.1">command line:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.211.1">
git clone git://git.yoctoproject.org/poky -b kirkstone</span></pre>
<p><span class="koboSpan" id="kobo.212.1">After completing this, we must create the </span><strong class="source-inline"><span class="koboSpan" id="kobo.213.1">build</span></strong><span class="koboSpan" id="kobo.214.1"> directory we use for our builds and add the BSP layer. </span><span class="koboSpan" id="kobo.214.2">We can do this using the following </span><span class="No-Break"><span class="koboSpan" id="kobo.215.1">command lines:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.216.1">
source oe-init-build-env build
bitbake-layers layerindex-fetch meta-raspberrypi</span></pre>
<p><span class="koboSpan" id="kobo.217.1">After we have the </span><strong class="source-inline"><span class="koboSpan" id="kobo.218.1">build</span></strong><span class="koboSpan" id="kobo.219.1"> directory and the BSP layers properly set up, we can start the build. </span><span class="koboSpan" id="kobo.219.2">Inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.220.1">build</span></strong><span class="koboSpan" id="kobo.221.1"> directory, we must call the </span><span class="No-Break"><span class="koboSpan" id="kobo.222.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.223.1">
MACHINE=raspberrypi4 bitbake core-image-full-cmdline</span></pre>
<p><span class="koboSpan" id="kobo.224.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.225.1">MACHINE</span></strong><span class="koboSpan" id="kobo.226.1"> variable can be changed depending on the board we want to use or set </span><span class="No-Break"><span class="koboSpan" id="kobo.227.1">in </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.228.1">build/conf/local.conf</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.229.1">.</span></span></p>
<h2 id="_idParaDest-164"><a id="_idTextAnchor193"/><span class="koboSpan" id="kobo.230.1">Booting Raspberry Pi 4</span></h2>
<p><span class="koboSpan" id="kobo.231.1">After the build </span><a id="_idIndexMarker473"/><span class="koboSpan" id="kobo.232.1">process is over, the image will be available inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.233.1">build/tmp/deploy/images/raspberrypi4/</span></strong><span class="koboSpan" id="kobo.234.1"> directory. </span><span class="koboSpan" id="kobo.234.2">The file we want to use </span><span class="No-Break"><span class="koboSpan" id="kobo.235.1">is </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.236.1">core-image-full-cmdline-raspberrypi4.wic.bz2</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.237.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.238.1">Make sure you point to the right device and double-check to not write on your </span><span class="No-Break"><span class="koboSpan" id="kobo.239.1">hard disk.</span></span></p>
<p><span class="koboSpan" id="kobo.240.1">To copy the </span><strong class="source-inline"><span class="koboSpan" id="kobo.241.1">core-image-full-cmdline</span></strong><span class="koboSpan" id="kobo.242.1"> image to the SD card, we should use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.243.1">dd</span></strong><span class="koboSpan" id="kobo.244.1"> utility, </span><span class="No-Break"><span class="koboSpan" id="kobo.245.1">as follows:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.246.1">
bzcat core-image-full-cmdline-raspberrypi4.wic.bz2 | sudo dd of=/dev/&lt;media&gt;</span></pre>
<p><span class="koboSpan" id="kobo.247.1">After copying the </span><a id="_idIndexMarker474"/><span class="koboSpan" id="kobo.248.1">content to the SD card, insert it into the SD card slot, connect the HDMI cable, and power on the machine. </span><span class="koboSpan" id="kobo.248.2">It should </span><span class="No-Break"><span class="koboSpan" id="kobo.249.1">boot nicely.</span></span></p>
<h1 id="_idParaDest-165"><a id="_idTextAnchor194"/><span class="koboSpan" id="kobo.250.1">VisionFive</span></h1>
<p><span class="koboSpan" id="kobo.251.1">In the next two sections, we go through the steps for baking and booting an image for the </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.252.1">VisionFive</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.253.1"> board.</span></span></p>
<h2 id="_idParaDest-166"><a id="_idTextAnchor195"/><span class="koboSpan" id="kobo.254.1">Baking for VisionFive</span></h2>
<p><span class="koboSpan" id="kobo.255.1">To add this board support to our project, we need to include the </span><strong class="source-inline"><span class="koboSpan" id="kobo.256.1">meta-riscv</span></strong><span class="koboSpan" id="kobo.257.1"> meta layer, which is </span><a id="_idIndexMarker475"/><span class="koboSpan" id="kobo.258.1">the BSP layer with support for RISC-V-based </span><a id="_idIndexMarker476"/><span class="koboSpan" id="kobo.259.1">boards, including the VisionFive, but not limited to it. </span><span class="koboSpan" id="kobo.259.2">The meta layer can be accessed </span><span class="No-Break"><span class="koboSpan" id="kobo.260.1">at </span></span><a href="https://github.com/riscv/meta-riscv/tree/kirkstone"><span class="No-Break"><span class="koboSpan" id="kobo.261.1">https://github.com/riscv/meta-riscv/tree/kirkstone</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.262.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.263.1">To create the source structure, please download Poky using the following </span><span class="No-Break"><span class="koboSpan" id="kobo.264.1">command line:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.265.1">
git clone git://git.yoctoproject.org/poky -b kirkstone</span></pre>
<p><span class="koboSpan" id="kobo.266.1">After completing this, we must create the </span><strong class="source-inline"><span class="koboSpan" id="kobo.267.1">build</span></strong><span class="koboSpan" id="kobo.268.1"> directory we’ll use for our builds and add the BSP layer. </span><span class="koboSpan" id="kobo.268.2">We can do this using the following </span><span class="No-Break"><span class="koboSpan" id="kobo.269.1">command lines:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.270.1">
source oe-init-build-env build
bitbake-layers layerindex-fetch meta-riscv</span></pre>
<p><span class="koboSpan" id="kobo.271.1">After we have the </span><strong class="source-inline"><span class="koboSpan" id="kobo.272.1">build</span></strong><span class="koboSpan" id="kobo.273.1"> directory and the BSP layers properly set up, we can start the build. </span><span class="koboSpan" id="kobo.273.2">Inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.274.1">build</span></strong><span class="koboSpan" id="kobo.275.1"> directory, we must call the </span><span class="No-Break"><span class="koboSpan" id="kobo.276.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.277.1">
MACHINE=visionfive bitbake core-image-full-cmdline</span></pre>
<p><span class="koboSpan" id="kobo.278.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.279.1">MACHINE</span></strong><span class="koboSpan" id="kobo.280.1"> variable can be changed depending on the board we want to use or set </span><span class="No-Break"><span class="koboSpan" id="kobo.281.1">in </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.282.1">build/conf/local.conf</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.283.1">.</span></span></p>
<h2 id="_idParaDest-167"><a id="_idTextAnchor196"/><span class="koboSpan" id="kobo.284.1">Booting VisionFive</span></h2>
<p><span class="koboSpan" id="kobo.285.1">After the build </span><a id="_idIndexMarker477"/><span class="koboSpan" id="kobo.286.1">process is over, the image will be available inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.287.1">build/tmp/deploy/images/visionfive/</span></strong><span class="koboSpan" id="kobo.288.1"> directory. </span><span class="koboSpan" id="kobo.288.2">The file we want to use </span><span class="No-Break"><span class="koboSpan" id="kobo.289.1">is </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.290.1">core-image-full-cmdline-visionfive.wic.gz</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.291.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.292.1">Make sure you point to the right device and double-check to not write on your </span><span class="No-Break"><span class="koboSpan" id="kobo.293.1">hard disk.</span></span></p>
<p><span class="koboSpan" id="kobo.294.1">To copy the </span><strong class="source-inline"><span class="koboSpan" id="kobo.295.1">core-image-full-cmdline</span></strong><span class="koboSpan" id="kobo.296.1"> image to the SD card, we should use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.297.1">dd</span></strong><span class="koboSpan" id="kobo.298.1"> utility, </span><span class="No-Break"><span class="koboSpan" id="kobo.299.1">as follows:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.300.1">
zcat core-image-full-cmdline-visionfive.wic.gz | sudo dd of=/dev/&lt;media&gt;</span></pre>
<p><span class="koboSpan" id="kobo.301.1">After copying the content to the SD card, insert it into the SD card slot, connect the HDMI cable, and power on the machine. </span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.302.1">Note </span></p>
<p class="callout"><span class="koboSpan" id="kobo.303.1">VisionFive doesn’t have a default boot target and requires manual intervention to boot. </span><span class="koboSpan" id="kobo.303.2">Please use the following commands inside the U-Boot prompt using a </span><span class="No-Break"><span class="koboSpan" id="kobo.304.1">serial console:</span></span></p>
<p class="callout"><strong class="bold"><span class="koboSpan" id="kobo.305.1">setenv bootcmd “</span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.306.1">run distro_bootcmd”</span></strong></span></p>
<p class="callout"><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.307.1">saveenv</span></strong></span></p>
<p class="callout"><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.308.1">boot</span></strong></span></p>
<p class="callout"><span class="koboSpan" id="kobo.309.1">The command </span><strong class="source-inline"><span class="koboSpan" id="kobo.310.1">saveenv</span></strong><span class="koboSpan" id="kobo.311.1"> is optional to make the new configuration persist so that it can work out of the box </span><span class="No-Break"><span class="koboSpan" id="kobo.312.1">after reboot.</span></span></p>
<p class="callout"><span class="koboSpan" id="kobo.313.1">See how to get the serial console in the </span><em class="italic"><span class="koboSpan" id="kobo.314.1">Quick Start </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.315.1">Guide</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.316.1"> (</span></span><a href="https://doc-en.rvspace.org/VisionFive/Quick_Start_Guide/"><span class="No-Break"><span class="koboSpan" id="kobo.317.1">https://doc-en.rvspace.org/VisionFive/Quick_Start_Guide/</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.318.1">).</span></span></p>
<h1 id="_idParaDest-168"><a id="_idTextAnchor197"/><span class="koboSpan" id="kobo.319.1">Taking the next steps</span></h1>
<p><span class="koboSpan" id="kobo.320.1">Phew! </span><span class="koboSpan" id="kobo.320.2">We got it done! </span><span class="koboSpan" id="kobo.320.3">Now you should know the Yocto Project build system basics and be capable of extending your other areas of knowledge. </span><span class="koboSpan" id="kobo.320.4">We tried covering the most common daily tasks </span><a id="_idIndexMarker478"/><span class="koboSpan" id="kobo.321.1">using the Yocto Project. </span><span class="koboSpan" id="kobo.321.2">There are a few things you might want </span><span class="No-Break"><span class="koboSpan" id="kobo.322.1">to practice:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.323.1">Creating </span><strong class="source-inline"><span class="koboSpan" id="kobo.324.1">bbappend</span></strong><span class="koboSpan" id="kobo.325.1"> files to apply patches or make other changes to </span><span class="No-Break"><span class="koboSpan" id="kobo.326.1">a recipe</span></span></li>
<li><span class="koboSpan" id="kobo.327.1">Making your </span><span class="No-Break"><span class="koboSpan" id="kobo.328.1">custom images</span></span></li>
<li><span class="koboSpan" id="kobo.329.1">Changing the Linux kernel configuration </span><span class="No-Break"><span class="koboSpan" id="kobo.330.1">file (</span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.331.1">defconfig</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.332.1">)</span></span></li>
<li><span class="koboSpan" id="kobo.333.1">Changing the BusyBox configuration and including the configuration fragments to add or remove a feature in </span><span class="No-Break"><span class="koboSpan" id="kobo.334.1">a layer</span></span></li>
<li><span class="koboSpan" id="kobo.335.1">Adding a new recipe for </span><span class="No-Break"><span class="koboSpan" id="kobo.336.1">a package</span></span></li>
<li><span class="koboSpan" id="kobo.337.1">Making a product layer with your product-specific machines, recipes, </span><span class="No-Break"><span class="koboSpan" id="kobo.338.1">and images</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.339.1">Remember, the source code is the ultimate knowledge source, so </span><span class="No-Break"><span class="koboSpan" id="kobo.340.1">use it.</span></span></p>
<p><span class="koboSpan" id="kobo.341.1">When looking for how to do something, finding a similar recipe saves you time testing different approaches to solve </span><span class="No-Break"><span class="koboSpan" id="kobo.342.1">the problem.</span></span></p>
<p><span class="koboSpan" id="kobo.343.1">Eventually, you’ll likely see yourself in a position to fix or enhance something on OpenEmbedded Core, a meta layer, or in a BSP. </span><span class="koboSpan" id="kobo.343.2">So, don’t be afraid – send the patches and take the feedback and requests for changes as an opportunity to learn and improve your way of solving </span><span class="No-Break"><span class="koboSpan" id="kobo.344.1">a problem.</span></span></p>
<h1 id="_idParaDest-169"><a id="_idTextAnchor198"/><span class="koboSpan" id="kobo.345.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.346.1">We learned how to discover the BSP for a board we want to use in our project. </span><span class="koboSpan" id="kobo.346.2">We consolidated our Yocto Project knowledge by adding external BSP layers and using these in real boards with a generated image. </span><span class="koboSpan" id="kobo.346.3">We also consolidated the necessary background information to learn about any other aspect of the Yocto Project you </span><span class="No-Break"><span class="koboSpan" id="kobo.347.1">may need.</span></span></p>
<p><span class="koboSpan" id="kobo.348.1">In the next chapter, we will explore how using QEMU speeds up product development by enabling us to not rely on hardware for every </span><span class="No-Break"><span class="koboSpan" id="kobo.349.1">development cycle.</span></span></p>
</div>
</body></html>