<html><head></head><body>
<div id="_idContainer162">
<h1 class="chapter-number" id="_idParaDest-119"><a id="_idTextAnchor147"/><span class="koboSpan" id="kobo.1.1">12</span></h1>
<h1 id="_idParaDest-120"><a id="_idTextAnchor148"/><span class="koboSpan" id="kobo.2.1">Creating Custom Layers</span></h1>
<p><span class="koboSpan" id="kobo.3.1">In addition to using existing layers from the community or vendors, we will learn how to create layers for our products in this chapter. </span><span class="koboSpan" id="kobo.3.2">Additionally, we will discover how to create a machine definition and distribution and profit from them to organize our source </span><span class="No-Break"><span class="koboSpan" id="kobo.4.1">code better.</span></span></p>
<h1 id="_idParaDest-121"><a id="_idTextAnchor149"/><span class="koboSpan" id="kobo.5.1">Making a new layer</span></h1>
<p><span class="koboSpan" id="kobo.6.1">Before creating our</span><a id="_idIndexMarker365"/><span class="koboSpan" id="kobo.7.1"> layer, it’s always a good idea to check whether a similar one is already available at the following </span><span class="No-Break"><span class="koboSpan" id="kobo.8.1">website: </span></span><a href="http://layers.openembedded.org"><span class="No-Break"><span class="koboSpan" id="kobo.9.1">http://layers.openembedded.org</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.10.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.11.1">If we are still looking for a layer suitable for our needs, the next step is to create the directory. </span><span class="koboSpan" id="kobo.11.2">Usually, the layer name starts with </span><strong class="source-inline"><span class="koboSpan" id="kobo.12.1">meta-</span></strong><span class="koboSpan" id="kobo.13.1">, but this is not a </span><span class="No-Break"><span class="koboSpan" id="kobo.14.1">technical restriction.</span></span></p>
<p><span class="koboSpan" id="kobo.15.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.16.1">&lt;layer&gt;/conf/layer.conf</span></strong><span class="koboSpan" id="kobo.17.1"> file is the layer configuration file required for every layer. </span><span class="koboSpan" id="kobo.17.2">The new layer can be created with a tool called </span><strong class="source-inline"><span class="koboSpan" id="kobo.18.1">bitbake-layers</span></strong><span class="koboSpan" id="kobo.19.1"> from BitBake, provided in Poky, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.20.1">following command:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer148">
<span class="koboSpan" id="kobo.21.1"><img alt="Figure 12.1 – Creating a new layer using bitbake-layers" src="image/Figure_12.01_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.22.1">Figure 12.1 – Creating a new layer using bitbake-layers</span></p>
<p><span class="koboSpan" id="kobo.23.1">After creating the layer, we need to include it in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.24.1">build/conf/bblayers.conf</span></strong><span class="koboSpan" id="kobo.25.1"> file using the </span><span class="No-Break"><span class="koboSpan" id="kobo.26.1">following command:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer149">
<span class="koboSpan" id="kobo.27.1"><img alt="Figure 12.2 – Adding meta-newlayer to build/conf/bblayers.conf" src="image/Figure_12.02_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.28.1">Figure 12.2 – Adding meta-newlayer to build/conf/bblayers.conf</span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.29.1">Tip</span></p>
<p class="callout"><span class="koboSpan" id="kobo.30.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.31.1">bitbake-layers</span></strong><span class="koboSpan" id="kobo.32.1"> tool, by default, generates</span><a id="_idIndexMarker366"/><span class="koboSpan" id="kobo.33.1"> the layer with layer priority 6. </span><span class="koboSpan" id="kobo.33.2">We can still customize the priority </span><span class="No-Break"><span class="koboSpan" id="kobo.34.1">using parameters.</span></span></p>
<p><span class="koboSpan" id="kobo.35.1">The last command generates the layer, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.36.1">following figure:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer150">
<span class="koboSpan" id="kobo.37.1"><img alt="Figure 12.3 – The meta-newlayer layout when created" src="image/Figure_12.03_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.38.1">Figure 12.3 – The meta-newlayer layout when created</span></p>
<p><span class="koboSpan" id="kobo.39.1">The default layer configuration</span><a id="_idIndexMarker367"/><span class="koboSpan" id="kobo.40.1"> file for </span><strong class="source-inline"><span class="koboSpan" id="kobo.41.1">meta-newlayer</span></strong><span class="koboSpan" id="kobo.42.1"> is the minimal configuration to get the layer working. </span><span class="koboSpan" id="kobo.42.2">However, it can be customized to include configurations required in </span><span class="No-Break"><span class="koboSpan" id="kobo.43.1">the future.</span></span></p>
<p><span class="koboSpan" id="kobo.44.1">The following figure shows the content of default </span><strong class="source-inline"><span class="koboSpan" id="kobo.45.1">conf/layer.conf</span></strong><span class="koboSpan" id="kobo.46.1"> for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.47.1">meta-newlayer</span></strong><span class="koboSpan" id="kobo.48.1"> layer we </span><span class="No-Break"><span class="koboSpan" id="kobo.49.1">just created:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer151">
<span class="koboSpan" id="kobo.50.1"><img alt="Figure 12.4 – The meta-newlayer/conf/layer.conf minimal configuration" src="image/Figure_12.04_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.51.1">Figure 12.4 – The meta-newlayer/conf/layer.conf minimal configuration</span></p>
<p><span class="koboSpan" id="kobo.52.1">Some commonly used variables that may need to be added or changed are </span><strong class="source-inline"><span class="koboSpan" id="kobo.53.1">LAYERVERSION</span></strong><span class="koboSpan" id="kobo.54.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.55.1">LAYERDEPENDS</span></strong><span class="koboSpan" id="kobo.56.1">. </span><span class="koboSpan" id="kobo.56.2">Those are useful if our layer requires other layers to work. </span><span class="koboSpan" id="kobo.56.3">Both variables’ names must be suffixed with the layer’s name, </span><span class="No-Break"><span class="koboSpan" id="kobo.57.1">as follows:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.58.1">LAYERVERSION</span></strong><span class="koboSpan" id="kobo.59.1">: This is an optional variable that specifies the version of the layer in a single number. </span><span class="koboSpan" id="kobo.59.2">This </span><a id="_idIndexMarker368"/><span class="koboSpan" id="kobo.60.1">variable is used within the </span><strong class="source-inline"><span class="koboSpan" id="kobo.61.1">LAYERDEPENDS</span></strong><span class="koboSpan" id="kobo.62.1"> variable to depend on a specific layer version – for example, </span><strong class="source-inline"><span class="koboSpan" id="kobo.63.1">LAYERVERSION_meta-newlayer = "</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.64.1">1"</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.65.1">.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.66.1">LAYERDEPENDS</span></strong><span class="koboSpan" id="kobo.67.1">: This lists the layers that the recipes depend upon, separated by spaces – for example, we add the dependency for version </span><strong class="source-inline"><span class="koboSpan" id="kobo.68.1">2</span></strong><span class="koboSpan" id="kobo.69.1"> of </span><strong class="source-inline"><span class="koboSpan" id="kobo.70.1">meta-otherlayer</span></strong><span class="koboSpan" id="kobo.71.1"> with </span><strong class="source-inline"><span class="koboSpan" id="kobo.72.1">LAYERDEPENDS_meta-newlayer += "</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.73.1">meta-otherlayer:2"</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.74.1">.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.75.1">An error is incurred if a dependency cannot be satisfied or the version numbers do not match. </span><span class="koboSpan" id="kobo.75.2">The base of the layer structure is now created. </span><span class="koboSpan" id="kobo.75.3">In the following sections, we will learn how to </span><span class="No-Break"><span class="koboSpan" id="kobo.76.1">extend it.</span></span></p>
<h1 id="_idParaDest-122"><a id="_idTextAnchor150"/><span class="koboSpan" id="kobo.77.1">Adding metadata to the layer</span></h1>
<p><span class="koboSpan" id="kobo.78.1">Layer metadata can </span><a id="_idIndexMarker369"/><span class="koboSpan" id="kobo.79.1">serve two goals – add new software, or feature and modify </span><span class="No-Break"><span class="koboSpan" id="kobo.80.1">existing metadata.</span></span></p>
<p><span class="koboSpan" id="kobo.81.1">We can include several metadata files on a new layer, such as recipes, images, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.82.1">bbappend</span></strong><span class="koboSpan" id="kobo.83.1"> files. </span><span class="koboSpan" id="kobo.83.2">There are several examples of </span><strong class="source-inline"><span class="koboSpan" id="kobo.84.1">bbappend</span></strong><span class="koboSpan" id="kobo.85.1"> files on </span><strong class="source-inline"><span class="koboSpan" id="kobo.86.1">meta-yocto-bsp</span></strong><span class="koboSpan" id="kobo.87.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.88.1">meta-yocto</span></strong><span class="koboSpan" id="kobo.89.1">. </span><span class="koboSpan" id="kobo.89.2">We will explore some of their common uses in </span><a href="B19361_13.xhtml#_idTextAnchor158"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.90.1">Chapter 13</span></em></span></a><span class="koboSpan" id="kobo.91.1">, </span><em class="italic"><span class="koboSpan" id="kobo.92.1">Customizing </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.93.1">Existing Recipes</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.94.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.95.1">In the next sections, we will go through some common modifications to </span><span class="No-Break"><span class="koboSpan" id="kobo.96.1">layer metadata.</span></span></p>
<h2 id="_idParaDest-123"><a id="_idTextAnchor151"/><span class="koboSpan" id="kobo.97.1">Creating an image</span></h2>
<p><span class="koboSpan" id="kobo.98.1">Image files are, in essence, a </span><a id="_idIndexMarker370"/><span class="koboSpan" id="kobo.99.1">set of packages grouped for a purpose and configured in a controlled way. </span><span class="koboSpan" id="kobo.99.2">We can create an image from scratch or create one by reusing an existing one and adding the extra </span><span class="No-Break"><span class="koboSpan" id="kobo.100.1">necessary packages.</span></span></p>
<p><span class="koboSpan" id="kobo.101.1">We should reuse an existing image when possible, making code maintenance more manageable and highlighting the functional differences. </span><span class="koboSpan" id="kobo.101.2">For example, we may want to include an application and remove an </span><a id="_idIndexMarker371"/><span class="koboSpan" id="kobo.102.1">image feature from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.103.1">core-image-full-cmdline</span></strong><span class="koboSpan" id="kobo.104.1"> image file. </span><span class="koboSpan" id="kobo.104.2">In that case, we can create an image in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.105.1">recipes-mine/images/my-image-full-cmdline.bb</span></strong><span class="koboSpan" id="kobo.106.1"> file with the following lines </span><span class="No-Break"><span class="koboSpan" id="kobo.107.1">of code:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer152">
<span class="koboSpan" id="kobo.108.1"><img alt="Figure 12.5 – The content of my-image-full-cmdline.bb" src="image/Figure_12.05_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.109.1">Figure 12.5 – The content of my-image-full-cmdline.bb</span></p>
<p><span class="koboSpan" id="kobo.110.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.111.1">core-image</span></strong><span class="koboSpan" id="kobo.112.1"> class provides image features that offer helpful building blocks of commonly used functionality and should be used when creating an image from scratch. </span><span class="koboSpan" id="kobo.112.2">For example, we can create an image in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.113.1">recipes-mine/images/my-image-strace.bb</span></strong><span class="koboSpan" id="kobo.114.1"> file consisting of the following lines </span><span class="No-Break"><span class="koboSpan" id="kobo.115.1">of code:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer153">
<span class="koboSpan" id="kobo.116.1"><img alt="Figure 12.6 – The content of my-image-strace.bb" src="image/Figure_12.06_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.117.1">Figure 12.6 – The content of my-image-strace.bb</span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.118.1">Tip</span></p>
<p class="callout"><span class="koboSpan" id="kobo.119.1">The list appending operator (</span><strong class="source-inline"><span class="koboSpan" id="kobo.120.1">+=</span></strong><span class="koboSpan" id="kobo.121.1">) guarantees that a new </span><strong class="source-inline"><span class="koboSpan" id="kobo.122.1">EXTRA_IMAGE_FEATURES</span></strong><span class="koboSpan" id="kobo.123.1"> variable can be added </span><span class="No-Break"><span class="koboSpan" id="kobo.124.1">by </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.125.1">build/conf/local.conf</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.126.1">.</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.127.1">CORE_IMAGE_EXTRA_INSTALL</span></strong><span class="koboSpan" id="kobo.128.1"> is the variable we should use to include extra packages in the image when we inherit the </span><strong class="source-inline"><span class="koboSpan" id="kobo.129.1">core-image</span></strong><span class="koboSpan" id="kobo.130.1"> class, which facilitates image creation. </span><span class="koboSpan" id="kobo.130.2">The class adds support for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.131.1">IMAGE_FEATURES</span></strong><span class="koboSpan" id="kobo.132.1"> variable, which avoids duplication </span><span class="No-Break"><span class="koboSpan" id="kobo.133.1">of code.</span></span></p>
<p><span class="koboSpan" id="kobo.134.1">Currently, the following image features are supported, as detailed in the </span><em class="italic"><span class="koboSpan" id="kobo.135.1">Image Features</span></em><span class="koboSpan" id="kobo.136.1"> section of the </span><em class="italic"><span class="koboSpan" id="kobo.137.1">Yocto Project Reference </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.138.1">Manual</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.139.1"> (</span></span><a href="https://docs.yoctoproject.org/4.0.4/ref-manual/features.html#image-features"><span class="No-Break"><span class="koboSpan" id="kobo.140.1">https://docs.yoctoproject.org/4.0.4/ref-manual/features.html#image-features</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.141.1">):</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.142.1">allow-empty-password</span></strong><span class="koboSpan" id="kobo.143.1">: Allows Dropbear and OpenSSH to accept logins from accounts that have an empty </span><span class="No-Break"><span class="koboSpan" id="kobo.144.1">password string.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.145.1">allow-root-login</span></strong><span class="koboSpan" id="kobo.146.1">: Allows Dropbear and OpenSSH to accept </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.147.1">root</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.148.1"> logins.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.149.1">dbg-pkgs</span></strong><span class="koboSpan" id="kobo.150.1">: Installs debug</span><a id="_idIndexMarker372"/><span class="koboSpan" id="kobo.151.1"> symbol packages for all packages installed in a </span><span class="No-Break"><span class="koboSpan" id="kobo.152.1">given image.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.153.1">debug-tweaks</span></strong><span class="koboSpan" id="kobo.154.1">: Makes an image suitable for development (for example, allows root logins, logins without passwords – including root ones, and enables </span><span class="No-Break"><span class="koboSpan" id="kobo.155.1">post-installation logging).</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.156.1">dev-pkgs</span></strong><span class="koboSpan" id="kobo.157.1">: Installs development packages (headers and extra library links) for all packages installed in a </span><span class="No-Break"><span class="koboSpan" id="kobo.158.1">given image.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.159.1">doc-pkgs</span></strong><span class="koboSpan" id="kobo.160.1">: Installs documentation packages for all packages installed in a </span><span class="No-Break"><span class="koboSpan" id="kobo.161.1">given image.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.162.1">empty-root-password</span></strong><span class="koboSpan" id="kobo.163.1">: This feature, or </span><strong class="source-inline"><span class="koboSpan" id="kobo.164.1">debug-tweaks</span></strong><span class="koboSpan" id="kobo.165.1">, is required if you want to allow root login with an </span><span class="No-Break"><span class="koboSpan" id="kobo.166.1">empty password.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.167.1">hwcodecs</span></strong><span class="koboSpan" id="kobo.168.1">: Installs hardware </span><span class="No-Break"><span class="koboSpan" id="kobo.169.1">acceleration codecs.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.170.1">lic-pkgs</span></strong><span class="koboSpan" id="kobo.171.1">: Installs license packages for all packages installed in a </span><span class="No-Break"><span class="koboSpan" id="kobo.172.1">given image.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.173.1">nfs-server</span></strong><span class="koboSpan" id="kobo.174.1">: Installs an </span><span class="No-Break"><span class="koboSpan" id="kobo.175.1">NFS server.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.176.1">overlayfs-etc</span></strong><span class="koboSpan" id="kobo.177.1">: Configures the </span><strong class="source-inline"><span class="koboSpan" id="kobo.178.1">/etc</span></strong><span class="koboSpan" id="kobo.179.1"> directory to be in </span><strong class="source-inline"><span class="koboSpan" id="kobo.180.1">overlayfs</span></strong><span class="koboSpan" id="kobo.181.1">. </span><span class="koboSpan" id="kobo.181.2">This allows you to store device-specific information elsewhere, especially if the root filesystem is configured </span><span class="No-Break"><span class="koboSpan" id="kobo.182.1">as read-only.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.183.1">package-management</span></strong><span class="koboSpan" id="kobo.184.1">: Installs package management tools and preserves the package </span><span class="No-Break"><span class="koboSpan" id="kobo.185.1">manager database.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.186.1">perf</span></strong><span class="koboSpan" id="kobo.187.1">: Installs profiling tools</span><a id="_idIndexMarker373"/><span class="koboSpan" id="kobo.188.1"> such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.189.1">perf</span></strong><span class="koboSpan" id="kobo.190.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.191.1">systemtap</span></strong><span class="koboSpan" id="kobo.192.1">, </span><span class="No-Break"><span class="koboSpan" id="kobo.193.1">and </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.194.1">LTTng</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.195.1">.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.196.1">post-install-logging</span></strong><span class="koboSpan" id="kobo.197.1">: Enables you to log postinstall script runs in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.198.1">/var/log/postinstall.log</span></strong><span class="koboSpan" id="kobo.199.1"> file on the first boot of the image on the </span><span class="No-Break"><span class="koboSpan" id="kobo.200.1">target system.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.201.1">ptest-pkgs</span></strong><span class="koboSpan" id="kobo.202.1">: Installs </span><strong class="source-inline"><span class="koboSpan" id="kobo.203.1">ptest</span></strong><span class="koboSpan" id="kobo.204.1"> packages for all </span><span class="No-Break"><span class="koboSpan" id="kobo.205.1">ptest-enabled recipes.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.206.1">read-only-rootfs</span></strong><span class="koboSpan" id="kobo.207.1">: Creates an image whose root filesystem </span><span class="No-Break"><span class="koboSpan" id="kobo.208.1">is read-only.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.209.1">read-only-rootfs-delayed-postinsts</span></strong><span class="koboSpan" id="kobo.210.1">: When specified in conjunction with </span><strong class="source-inline"><span class="koboSpan" id="kobo.211.1">read-only-rootfs</span></strong><span class="koboSpan" id="kobo.212.1">, it specifies that post-install scripts are </span><span class="No-Break"><span class="koboSpan" id="kobo.213.1">still permitted.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.214.1">serial-autologin-root</span></strong><span class="koboSpan" id="kobo.215.1">: When specified in conjunction with </span><strong class="source-inline"><span class="koboSpan" id="kobo.216.1">empty-root-password</span></strong><span class="koboSpan" id="kobo.217.1">, it will </span><a id="_idIndexMarker374"/><span class="koboSpan" id="kobo.218.1">automatically login as </span><strong class="source-inline"><span class="koboSpan" id="kobo.219.1">root</span></strong><span class="koboSpan" id="kobo.220.1"> on the </span><span class="No-Break"><span class="koboSpan" id="kobo.221.1">serial console.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.222.1">splash</span></strong><span class="koboSpan" id="kobo.223.1">: Enables you to show a splash screen during boot. </span><span class="koboSpan" id="kobo.223.2">By default, this screen is provided by </span><strong class="source-inline"><span class="koboSpan" id="kobo.224.1">psplash</span></strong><span class="koboSpan" id="kobo.225.1">, which does </span><span class="No-Break"><span class="koboSpan" id="kobo.226.1">allow customization.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.227.1">ssh-server-dropbear</span></strong><span class="koboSpan" id="kobo.228.1">: Installs the Dropbear minimal </span><span class="No-Break"><span class="koboSpan" id="kobo.229.1">SSH server.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.230.1">ssh-server-openssh</span></strong><span class="koboSpan" id="kobo.231.1">: Installs the OpenSSH SSH server, which is more full-featured than Dropbear. </span><span class="koboSpan" id="kobo.231.2">Note that if both the OpenSSH SSH server and the Dropbear minimal SSH server are present in </span><strong class="source-inline"><span class="koboSpan" id="kobo.232.1">IMAGE_FEATURES</span></strong><span class="koboSpan" id="kobo.233.1">, then OpenSSH will take precedence and Dropbear will not </span><span class="No-Break"><span class="koboSpan" id="kobo.234.1">be installed.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.235.1">stateless-rootfs</span></strong><span class="koboSpan" id="kobo.236.1">: Specifies that an image should be created as stateless – when using </span><strong class="source-inline"><span class="koboSpan" id="kobo.237.1">systemd</span></strong><span class="koboSpan" id="kobo.238.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.239.1">systemctl-native</span></strong><span class="koboSpan" id="kobo.240.1"> will not be run on the image, leaving the image to be populated at runtime </span><span class="No-Break"><span class="koboSpan" id="kobo.241.1">by </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.242.1">systemd</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.243.1">.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.244.1">staticdev-pkgs</span></strong><span class="koboSpan" id="kobo.245.1">: Installs static development packages, which are static libraries (for example, </span><strong class="source-inline"><span class="koboSpan" id="kobo.246.1">*.a</span></strong><span class="koboSpan" id="kobo.247.1"> files), for all packages installed in a </span><span class="No-Break"><span class="koboSpan" id="kobo.248.1">given image.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.249.1">tools-debug</span></strong><span class="koboSpan" id="kobo.250.1">: Installs debugging tools such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.251.1">strace</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.252.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.253.1">gdb</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.254.1">.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.255.1">tools-sdk</span></strong><span class="koboSpan" id="kobo.256.1">: Installs a full SDK that runs on </span><span class="No-Break"><span class="koboSpan" id="kobo.257.1">a device.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.258.1">tools-testapps</span></strong><span class="koboSpan" id="kobo.259.1">: Installs device testing tools (for example, </span><span class="No-Break"><span class="koboSpan" id="kobo.260.1">touchscreen debugging).</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.261.1">weston</span></strong><span class="koboSpan" id="kobo.262.1">: Installs Weston (a reference </span><span class="No-Break"><span class="koboSpan" id="kobo.263.1">Wayland environment).</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.264.1">x11-base</span></strong><span class="koboSpan" id="kobo.265.1">: Installs the X server with a </span><span class="No-Break"><span class="koboSpan" id="kobo.266.1">minimal environment.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.267.1">x11</span></strong><span class="koboSpan" id="kobo.268.1">: Installs the </span><span class="No-Break"><span class="koboSpan" id="kobo.269.1">X server.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.270.1">x11-sato</span></strong><span class="koboSpan" id="kobo.271.1">: Installs the </span><a id="_idIndexMarker375"/><span class="koboSpan" id="kobo.272.1">OpenedHand </span><span class="No-Break"><span class="koboSpan" id="kobo.273.1">Sato environment.</span></span></li>
</ul>
<h2 id="_idParaDest-124"><a id="_idTextAnchor152"/><span class="koboSpan" id="kobo.274.1">Adding a package recipe</span></h2>
<p><span class="koboSpan" id="kobo.275.1">Poky includes several </span><a id="_idIndexMarker376"/><span class="koboSpan" id="kobo.276.1">classes that makes the process for the most common development tools as projects abstract, based on Autotools, CMake, and Meson. </span><span class="koboSpan" id="kobo.276.2">A package recipe is how we can instruct BitBake to perform the </span><strong class="source-inline"><span class="koboSpan" id="kobo.277.1">fetch</span></strong><span class="koboSpan" id="kobo.278.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.279.1">unpack</span></strong><span class="koboSpan" id="kobo.280.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.281.1">patch</span></strong><span class="koboSpan" id="kobo.282.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.283.1">configure</span></strong><span class="koboSpan" id="kobo.284.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.285.1">compile</span></strong><span class="koboSpan" id="kobo.286.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.287.1">install</span></strong><span class="koboSpan" id="kobo.288.1"> tasks on our application, kernel module, or any software a project provides. </span><span class="koboSpan" id="kobo.288.2">In addition, a list of classes included in Poky can be seen in the </span><em class="italic"><span class="koboSpan" id="kobo.289.1">Classes</span></em><span class="koboSpan" id="kobo.290.1"> section in the </span><em class="italic"><span class="koboSpan" id="kobo.291.1">Yocto Project Reference </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.292.1">Manual</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.293.1"> (</span></span><a href="https://docs.yoctoproject.org/4.0.4/ref-manual/classes.html"><span class="No-Break"><span class="koboSpan" id="kobo.294.1">https://docs.yoctoproject.org/4.0.4/ref-manual/classes.html</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.295.1">).</span></span></p>
<p><span class="koboSpan" id="kobo.296.1">A straightforward recipe that executes the </span><strong class="source-inline"><span class="koboSpan" id="kobo.297.1">compile</span></strong><span class="koboSpan" id="kobo.298.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.299.1">install</span></strong><span class="koboSpan" id="kobo.300.1"> tasks explicitly is provided </span><span class="No-Break"><span class="koboSpan" id="kobo.301.1">as follows:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer154">
<span class="koboSpan" id="kobo.302.1"><img alt="Figure 12.7 – A manually crafted helloworld recipe" src="image/Figure_12.07_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.303.1">Figure 12.7 – A manually crafted helloworld recipe</span></p>
<p><span class="koboSpan" id="kobo.304.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.305.1">do_compile</span></strong><span class="koboSpan" id="kobo.306.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.307.1">do_install</span></strong><span class="koboSpan" id="kobo.308.1"> code blocks provide the Shell Script command for us to build and install the resulting binary into the destination directory, referenced as </span><strong class="source-inline"><span class="koboSpan" id="kobo.309.1">${D}</span></strong><span class="koboSpan" id="kobo.310.1">, which aims to relocate the installation directory to a path inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.311.1">build/tmp/work/</span></strong><span class="koboSpan" id="kobo.312.1"> directory. </span><span class="koboSpan" id="kobo.312.2">Suppose that we are working on an Autotools-based project. </span><span class="koboSpan" id="kobo.312.3">If so, we can avoid a lot of code duplication by using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.313.1">autotools</span></strong><span class="koboSpan" id="kobo.314.1"> class in the stripped example, extracted </span><a id="_idIndexMarker377"/><span class="koboSpan" id="kobo.315.1">from the recipe in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.316.1">poky/meta/recipes-core/dbus-wait/dbus-wait_git.bb</span></strong><span class="koboSpan" id="kobo.317.1"> file, </span><span class="No-Break"><span class="koboSpan" id="kobo.318.1">as follows:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer155">
<span class="koboSpan" id="kobo.319.1"><img alt="Figure 12.8 – The content of poky/meta/recipes-core/dbus-wait/dbus-wait_git.bb" src="image/Figure_12.08_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.320.1">Figure 12.8 – The content of poky/meta/recipes-core/dbus-wait/dbus-wait_git.bb</span></p>
<p><span class="koboSpan" id="kobo.321.1">The simple act of inheriting the </span><strong class="source-inline"><span class="koboSpan" id="kobo.322.1">autotools</span></strong><span class="koboSpan" id="kobo.323.1"> class in </span><em class="italic"><span class="koboSpan" id="kobo.324.1">line 19</span></em><span class="koboSpan" id="kobo.325.1"> is to provide all the code required to do the</span><a id="_idIndexMarker378"/> <span class="No-Break"><span class="koboSpan" id="kobo.326.1">following tasks:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.327.1">Update the </span><strong class="source-inline"><span class="koboSpan" id="kobo.328.1">configure</span></strong><span class="koboSpan" id="kobo.329.1"> script code </span><span class="No-Break"><span class="koboSpan" id="kobo.330.1">and artifacts</span></span></li>
<li><span class="koboSpan" id="kobo.331.1">Update the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.332.1">libtool</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.333.1"> scripts</span></span></li>
<li><span class="koboSpan" id="kobo.334.1">Run the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.335.1">configure</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.336.1"> script</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.337.1">Run </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.338.1">make</span></strong></span></li>
<li><span class="koboSpan" id="kobo.339.1">Run </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.340.1">make install</span></strong></span></li>
</ul>
<p><span class="koboSpan" id="kobo.341.1">The same concepts apply to other</span><a id="_idIndexMarker379"/><span class="koboSpan" id="kobo.342.1"> building tools, as is the case for </span><strong class="bold"><span class="koboSpan" id="kobo.343.1">CMake</span></strong><span class="koboSpan" id="kobo.344.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.345.1">Meson</span></strong><span class="koboSpan" id="kobo.346.1">. </span><span class="koboSpan" id="kobo.346.2">Additionally, the</span><a id="_idIndexMarker380"/><span class="koboSpan" id="kobo.347.1"> number of supported classes is growing in every release to support new build systems and avoid </span><span class="No-Break"><span class="koboSpan" id="kobo.348.1">code duplication.</span></span></p>
<h3><span class="koboSpan" id="kobo.349.1">Automatically creating a base package recipe using devtool</span></h3>
<p><span class="koboSpan" id="kobo.350.1">As we learned in the </span><em class="italic"><span class="koboSpan" id="kobo.351.1">Creating a recipe from an external Git repository</span></em><span class="koboSpan" id="kobo.352.1"> section in </span><a href="B19361_09.xhtml#_idTextAnchor115"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.353.1">Chapter 9</span></em></span></a><span class="koboSpan" id="kobo.354.1">, </span><em class="italic"><span class="koboSpan" id="kobo.355.1">Developing with the Yocto Project</span></em><span class="koboSpan" id="kobo.356.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.357.1">devtool</span></strong><span class="koboSpan" id="kobo.358.1"> automates the process of creating a recipe based on</span><a id="_idIndexMarker381"/><span class="koboSpan" id="kobo.359.1"> an existing project with the </span><span class="No-Break"><span class="koboSpan" id="kobo.360.1">following</span></span><span class="No-Break"><a id="_idIndexMarker382"/></span><span class="No-Break"><span class="koboSpan" id="kobo.361.1"> command:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer156">
<span class="koboSpan" id="kobo.362.1"><img alt="Figure 12.9 – The command line to generate the recipe for bbexample" src="image/Figure_12.09_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.363.1">Figure 12.9 – The command line to generate the recipe for bbexample</span></p>
<p><span class="koboSpan" id="kobo.364.1">Behind the scenes, </span><strong class="source-inline"><span class="koboSpan" id="kobo.365.1">devtool</span></strong><span class="koboSpan" id="kobo.366.1"> ran the </span><strong class="source-inline"><span class="koboSpan" id="kobo.367.1">recipetool</span></strong><span class="koboSpan" id="kobo.368.1"> to generate a recipe and automatically configure all pre-built information into the new recipe file. </span><span class="koboSpan" id="kobo.368.2">The end result is stored in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.369.1">workspace</span></strong><span class="koboSpan" id="kobo.370.1"> directory, a layer maintained by </span><strong class="source-inline"><span class="koboSpan" id="kobo.371.1">devtool</span></strong><span class="koboSpan" id="kobo.372.1">. </span><span class="koboSpan" id="kobo.372.2">To copy the recipe file to the target layer, we can use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.373.1">devtool</span></strong><span class="koboSpan" id="kobo.374.1"> command, as </span><span class="No-Break"><span class="koboSpan" id="kobo.375.1">shown here:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer157">
<span class="koboSpan" id="kobo.376.1"><img alt="Figure 12.10 – The command line to deploy the bbexample recipe to meta-newlayer" src="image/Figure_12.10_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.377.1">Figure 12.10 – The command line to deploy the bbexample recipe to meta-newlayer</span></p>
<p><span class="koboSpan" id="kobo.378.1">The created </span><strong class="source-inline"><span class="koboSpan" id="kobo.379.1">meta-newlayer/recipes-bbexample/bbexample/bbexample_git.bb</span></strong><span class="koboSpan" id="kobo.380.1"> file is shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.381.1">following snippet:</span></span></p>
<p class="IMG---Figure"> </p>
<div>
<div class="IMG---Figure" id="_idContainer158">
<span class="koboSpan" id="kobo.382.1"><img alt="Figure 12.11 – The content of bbexamle_git.bb" src="image/Figure_12.11_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.383.1">Figure 12.11 – The content of bbexamle_git.bb</span></p>
<p><span class="koboSpan" id="kobo.384.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.385.1">devtool</span></strong><span class="koboSpan" id="kobo.386.1"> has created </span><a id="_idIndexMarker383"/><span class="koboSpan" id="kobo.387.1">a base recipe, which should not be </span><a id="_idIndexMarker384"/><span class="koboSpan" id="kobo.388.1">taken as a final recipe. </span><span class="koboSpan" id="kobo.388.2">You should check for compilation options, extra metadata information, and </span><span class="No-Break"><span class="koboSpan" id="kobo.389.1">so on.</span></span></p>
<h2 id="_idParaDest-125"><a id="_idTextAnchor153"/><span class="koboSpan" id="kobo.390.1">Adding support to a new machine definition</span></h2>
<p><span class="koboSpan" id="kobo.391.1">Even though creating a new </span><a id="_idIndexMarker385"/><span class="koboSpan" id="kobo.392.1">machine definition for use in Poky is a straightforward task, it shouldn’t be underestimated. </span><span class="koboSpan" id="kobo.392.2">Depending on the set of features we need to support at the BSP layer, it can involve checking the bootloader, kernel, and hardware </span><span class="No-Break"><span class="koboSpan" id="kobo.393.1">support drivers.</span></span></p>
<p><span class="koboSpan" id="kobo.394.1">The Yocto Project supports ARM, ARM64, x86, x86-64, PowerPC, PowerPC 64, MIPS, MIPS64, RISC-V 32, and RISC-V 64, representing the most currently used </span><span class="No-Break"><span class="koboSpan" id="kobo.395.1">embedded architectures.</span></span></p>
<p><span class="koboSpan" id="kobo.396.1">The prevailing set of variables used in a machine definition is </span><span class="No-Break"><span class="koboSpan" id="kobo.397.1">as follows:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.398.1">TARGET_ARCH</span></strong><span class="koboSpan" id="kobo.399.1">: This sets the machine architecture – for example, ARM </span><span class="No-Break"><span class="koboSpan" id="kobo.400.1">and x86-64</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.401.1">PREFERRED_PROVIDER_virtual/kernel</span></strong><span class="koboSpan" id="kobo.402.1">: This overrides the default kernel (</span><strong class="source-inline"><span class="koboSpan" id="kobo.403.1">linux-yocto</span></strong><span class="koboSpan" id="kobo.404.1">) if you need to use a </span><span class="No-Break"><span class="koboSpan" id="kobo.405.1">specific one</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.406.1">SERIAL_CONSOLES</span></strong><span class="koboSpan" id="kobo.407.1">: This defines serial consoles and </span><span class="No-Break"><span class="koboSpan" id="kobo.408.1">their speeds</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.409.1">MACHINE_FEATURES</span></strong><span class="koboSpan" id="kobo.410.1">: This describes hardware features, so the software stack required is included in the images </span><span class="No-Break"><span class="koboSpan" id="kobo.411.1">by default</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.412.1">KERNEL_IMAGETYPE</span></strong><span class="koboSpan" id="kobo.413.1">: This is used to choose the kernel image type – for example, </span><strong class="source-inline"><span class="koboSpan" id="kobo.414.1">bzImage</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.415.1">or </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.416.1">Image</span></strong></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.417.1">IMAGE_FSTYPES</span></strong><span class="koboSpan" id="kobo.418.1">: This sets the generated filesystem image types – for example, </span><strong class="source-inline"><span class="koboSpan" id="kobo.419.1">tar.gz</span></strong><span class="koboSpan" id="kobo.420.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.421.1">ext4</span></strong><span class="koboSpan" id="kobo.422.1">, </span><span class="No-Break"><span class="koboSpan" id="kobo.423.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.424.1">ubifs</span></strong></span></li>
</ul>
<p><span class="koboSpan" id="kobo.425.1">You can see examples of machine </span><a id="_idIndexMarker386"/><span class="koboSpan" id="kobo.426.1">definition files inside the Poky source code in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.427.1">meta-yocto-bsp/conf/machine/</span></strong><span class="koboSpan" id="kobo.428.1"> directory. </span><span class="koboSpan" id="kobo.428.2">When describing a new machine, we should pay special attention to specific features supported by it in </span><strong class="source-inline"><span class="koboSpan" id="kobo.429.1">MACHINE_FEATURES</span></strong><span class="koboSpan" id="kobo.430.1">. </span><span class="koboSpan" id="kobo.430.2">This way, the software needed to help these features is installed into the images. </span><span class="koboSpan" id="kobo.430.3">The values currently available for </span><strong class="source-inline"><span class="koboSpan" id="kobo.431.1">MACHINE_FEATURES</span></strong><span class="koboSpan" id="kobo.432.1"> are listed </span><span class="No-Break"><span class="koboSpan" id="kobo.433.1">as follows:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.434.1">acpi</span></strong><span class="koboSpan" id="kobo.435.1">: The hardware has ACPI (</span><span class="No-Break"><span class="koboSpan" id="kobo.436.1">x86/x86-64 only)</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.437.1">alsa</span></strong><span class="koboSpan" id="kobo.438.1">: The hardware has ALSA </span><span class="No-Break"><span class="koboSpan" id="kobo.439.1">audio drivers</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.440.1">apm</span></strong><span class="koboSpan" id="kobo.441.1">: The hardware uses APM (or </span><span class="No-Break"><span class="koboSpan" id="kobo.442.1">APM emulation)</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.443.1">bluetooth</span></strong><span class="koboSpan" id="kobo.444.1">: The hardware has </span><span class="No-Break"><span class="koboSpan" id="kobo.445.1">integrated BT</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.446.1">efi</span></strong><span class="koboSpan" id="kobo.447.1">: Support for booting </span><span class="No-Break"><span class="koboSpan" id="kobo.448.1">through EFI</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.449.1">ext2</span></strong><span class="koboSpan" id="kobo.450.1">: The hardware HDD </span><span class="No-Break"><span class="koboSpan" id="kobo.451.1">or microdrive</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.452.1">keyboard</span></strong><span class="koboSpan" id="kobo.453.1">: The hardware has </span><span class="No-Break"><span class="koboSpan" id="kobo.454.1">a keyboard</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.455.1">numa</span></strong><span class="koboSpan" id="kobo.456.1">: The hardware has non-uniform </span><span class="No-Break"><span class="koboSpan" id="kobo.457.1">memory access</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.458.1">pcbios</span></strong><span class="koboSpan" id="kobo.459.1">: Support for booting </span><span class="No-Break"><span class="koboSpan" id="kobo.460.1">through BIOS</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.461.1">pci</span></strong><span class="koboSpan" id="kobo.462.1">: The hardware has a </span><span class="No-Break"><span class="koboSpan" id="kobo.463.1">PCI bus</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.464.1">pcmcia</span></strong><span class="koboSpan" id="kobo.465.1">: The hardware has PCMCIA or </span><span class="No-Break"><span class="koboSpan" id="kobo.466.1">CompactFlash sockets</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.467.1">phone</span></strong><span class="koboSpan" id="kobo.468.1">: Mobile phone (</span><span class="No-Break"><span class="koboSpan" id="kobo.469.1">voice) support</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.470.1">qemu-usermode</span></strong><span class="koboSpan" id="kobo.471.1">: QEMU can support user-mode emulation for </span><span class="No-Break"><span class="koboSpan" id="kobo.472.1">this machine</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.473.1">qvga</span></strong><span class="koboSpan" id="kobo.474.1">: The machine has</span><a id="_idIndexMarker387"/><span class="koboSpan" id="kobo.475.1"> a QVGA (</span><span class="No-Break"><span class="koboSpan" id="kobo.476.1">320x240) display</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.477.1">rtc</span></strong><span class="koboSpan" id="kobo.478.1">: The machine has a </span><span class="No-Break"><span class="koboSpan" id="kobo.479.1">real-time clock</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.480.1">screen</span></strong><span class="koboSpan" id="kobo.481.1">: The hardware has </span><span class="No-Break"><span class="koboSpan" id="kobo.482.1">a screen</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.483.1">serial</span></strong><span class="koboSpan" id="kobo.484.1">: The hardware has serial support (</span><span class="No-Break"><span class="koboSpan" id="kobo.485.1">usually RS232)</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.486.1">touchscreen</span></strong><span class="koboSpan" id="kobo.487.1">: The hardware has </span><span class="No-Break"><span class="koboSpan" id="kobo.488.1">a touchscreen</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.489.1">usbgadget</span></strong><span class="koboSpan" id="kobo.490.1">: The hardware is USB </span><span class="No-Break"><span class="koboSpan" id="kobo.491.1">gadget device-capable</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.492.1">usbhost</span></strong><span class="koboSpan" id="kobo.493.1">: The hardware is </span><span class="No-Break"><span class="koboSpan" id="kobo.494.1">USB host-capable</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.495.1">vfat</span></strong><span class="koboSpan" id="kobo.496.1">: FAT </span><span class="No-Break"><span class="koboSpan" id="kobo.497.1">filesystem support</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.498.1">wifi</span></strong><span class="koboSpan" id="kobo.499.1">: The hardware has </span><span class="No-Break"><span class="koboSpan" id="kobo.500.1">integrated Wi-Fi</span></span></li>
</ul>
<h3><span class="koboSpan" id="kobo.501.1">Wrapping an image for your machine</span></h3>
<p><span class="koboSpan" id="kobo.502.1">Creating a ready-to-use image for a machine should be addressed at the end of any BSP support layer development. </span><span class="koboSpan" id="kobo.502.2">The</span><a id="_idIndexMarker388"/><span class="koboSpan" id="kobo.503.1"> type of image depends on the processor, peripherals included on the board, and </span><span class="No-Break"><span class="koboSpan" id="kobo.504.1">project restrictions.</span></span></p>
<p><span class="koboSpan" id="kobo.505.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.506.1">partitioned image</span></strong><span class="koboSpan" id="kobo.507.1"> is the most frequently </span><a id="_idIndexMarker389"/><span class="koboSpan" id="kobo.508.1">used image for direct use in the storage. </span><span class="koboSpan" id="kobo.508.2">The Yocto Project has a tool called </span><strong class="source-inline"><span class="koboSpan" id="kobo.509.1">wic</span></strong><span class="koboSpan" id="kobo.510.1">, which provides a flexible way to generate this image. </span><span class="koboSpan" id="kobo.510.2">It allows the creation of partitioned images based on a template file (</span><strong class="source-inline"><span class="koboSpan" id="kobo.511.1">.wks</span></strong><span class="koboSpan" id="kobo.512.1">), written in a common language that describes the target image layout. </span><span class="koboSpan" id="kobo.512.2">The language definition can be found in the </span><em class="italic"><span class="koboSpan" id="kobo.513.1">OpenEmbedded Kickstart (.wks) Reference</span></em><span class="koboSpan" id="kobo.514.1"> section from </span><em class="italic"><span class="koboSpan" id="kobo.515.1">The Yocto Project Reference </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.516.1">Manual</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.517.1"> (</span></span><a href="https://docs.yoctoproject.org/4.0.4/ref-manual/kickstart.html#openembedded-kickstart-wks-reference"><span class="No-Break"><span class="koboSpan" id="kobo.518.1">https://docs.yoctoproject.org/4.0.4/ref-manual/kickstart.html#openembedded-kickstart-wks-reference</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.519.1">).</span></span></p>
<p><span class="koboSpan" id="kobo.520.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.521.1">.wks</span></strong><span class="koboSpan" id="kobo.522.1"> file is placed in our layer inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.523.1">wic</span></strong><span class="koboSpan" id="kobo.524.1"> directory. </span><span class="koboSpan" id="kobo.524.2">It is common to have multiple files in this directory to specify different image layouts. </span><span class="koboSpan" id="kobo.524.3">However, it is essential to remember that the chosen structure must match the machine – for example, when considering the use of an i.MX-based machine that boots using U-Boot from an SD card with two partitions, one for the boot files and the other for </span><strong class="source-inline"><span class="koboSpan" id="kobo.525.1">rootfs</span></strong><span class="koboSpan" id="kobo.526.1">. </span><span class="koboSpan" id="kobo.526.2">The respective </span><strong class="source-inline"><span class="koboSpan" id="kobo.527.1">.wks</span></strong><span class="koboSpan" id="kobo.528.1"> file is </span><span class="No-Break"><span class="koboSpan" id="kobo.529.1">shown here:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer159">
<span class="koboSpan" id="kobo.530.1"><img alt="Figure 12.12 – An example of a .wks file for an i.MX device using SPL" src="image/Figure_12.12_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.531.1">Figure 12.12 – An example of a .wks file for an i.MX device using SPL</span></p>
<p><span class="koboSpan" id="kobo.532.1">To enable the </span><strong class="source-inline"><span class="koboSpan" id="kobo.533.1">wic</span></strong><span class="koboSpan" id="kobo.534.1">-based image</span><a id="_idIndexMarker390"/><span class="koboSpan" id="kobo.535.1"> generation, it is a matter of adding </span><strong class="source-inline"><span class="koboSpan" id="kobo.536.1">wic</span></strong><span class="koboSpan" id="kobo.537.1"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.538.1">IMAGE_FSTYPES</span></strong><span class="koboSpan" id="kobo.539.1">. </span><span class="koboSpan" id="kobo.539.2">We can also define the </span><strong class="source-inline"><span class="koboSpan" id="kobo.540.1">.wks</span></strong><span class="koboSpan" id="kobo.541.1"> file to be used by setting the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.542.1">WKS_FILE</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.543.1"> variable.</span></span></p>
<h2 id="_idParaDest-126"><a id="_idTextAnchor154"/><span class="koboSpan" id="kobo.544.1">Using a custom distribution</span></h2>
<p><span class="koboSpan" id="kobo.545.1">The creation of a distribution is</span><a id="_idIndexMarker391"/><span class="koboSpan" id="kobo.546.1"> a mix of simplicity and complexity. </span><span class="koboSpan" id="kobo.546.2">Creating the distribution file is straightforward but significantly impacts Poky’s behavior. </span><span class="koboSpan" id="kobo.546.3">Depending on our options, it may cause a binary incompatibility with previously </span><span class="No-Break"><span class="koboSpan" id="kobo.547.1">built binaries.</span></span></p>
<p><span class="koboSpan" id="kobo.548.1">The distribution is where we define global options, such as the toolchain version, graphical backends, and</span><a id="_idIndexMarker392"/><span class="koboSpan" id="kobo.549.1"> support for </span><strong class="bold"><span class="koboSpan" id="kobo.550.1">OpenGL</span></strong><span class="koboSpan" id="kobo.551.1">. </span><span class="koboSpan" id="kobo.551.2">We should make a distribution only if the default settings provided by Poky fail to fulfill </span><span class="No-Break"><span class="koboSpan" id="kobo.552.1">our requirements.</span></span></p>
<p><span class="koboSpan" id="kobo.553.1">Usually, we intend to change a small set of </span><a id="_idIndexMarker393"/><span class="koboSpan" id="kobo.554.1">options from Poky. </span><span class="koboSpan" id="kobo.554.2">For example, we remove the </span><strong class="bold"><span class="koboSpan" id="kobo.555.1">X11</span></strong><span class="koboSpan" id="kobo.556.1"> support to use a framebuffer instead. </span><span class="koboSpan" id="kobo.556.2">We can easily accomplish this by reusing the Poky distribution and overriding the necessary variables – for example, the sample distribution represented by the </span><strong class="source-inline"><span class="koboSpan" id="kobo.557.1">&lt;layer&gt;/conf/distro/my-distro.conf</span></strong><span class="koboSpan" id="kobo.558.1"> file is </span><span class="No-Break"><span class="koboSpan" id="kobo.559.1">as follows:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer160">
<span class="koboSpan" id="kobo.560.1"><img alt="Figure 12.13 – An example of a custom distribution file" src="image/Figure_12.13_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.561.1">Figure 12.13 – An example of a custom distribution file</span></p>
<p><span class="koboSpan" id="kobo.562.1">To use the distribution just created, we</span><a id="_idIndexMarker394"/><span class="koboSpan" id="kobo.563.1"> need to add the following piece of code to the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.564.1">build/conf/local.conf</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.565.1"> file:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer161">
<span class="koboSpan" id="kobo.566.1"><img alt="Figure 12.14 – The line to set DISTRO on build/conf/local.conf" src="image/Figure_12.14_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.567.1">Figure 12.14 – The line to set DISTRO on build/conf/local.conf</span></p>
<p><span class="koboSpan" id="kobo.568.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.569.1">DISTRO_FEATURES</span></strong><span class="koboSpan" id="kobo.570.1"> variable may influence how the recipes are configured and the packages are installed in images – for example, if we want to use sound in any machine and image, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.571.1">alsa</span></strong><span class="koboSpan" id="kobo.572.1"> features must be present. </span><span class="koboSpan" id="kobo.572.2">The following list shows the present state for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.573.1">DISTRO_FEATURES</span></strong><span class="koboSpan" id="kobo.574.1">-supported values, as detailed in the </span><em class="italic"><span class="koboSpan" id="kobo.575.1">Distro Features</span></em><span class="koboSpan" id="kobo.576.1"> section in the </span><em class="italic"><span class="koboSpan" id="kobo.577.1">Yocto Project Reference </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.578.1">Manual</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.579.1"> (</span></span><a href="https://docs.yoctoproject.org/4.0.4/ref-manual/features.html#distro-features"><span class="No-Break"><span class="koboSpan" id="kobo.580.1">https://docs.yoctoproject.org/4.0.4/ref-manual/features.html#distro-features</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.581.1">):</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.582.1">3g</span></strong><span class="koboSpan" id="kobo.583.1">: Includes support for </span><span class="No-Break"><span class="koboSpan" id="kobo.584.1">cellular data</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.585.1">acl</span></strong><span class="koboSpan" id="kobo.586.1">: Includes Access Control </span><span class="No-Break"><span class="koboSpan" id="kobo.587.1">List support</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.588.1">alsa</span></strong><span class="koboSpan" id="kobo.589.1">: Includes Advanced Linux Sound Architecture support (OSS compatibility kernel modules are installed </span><span class="No-Break"><span class="koboSpan" id="kobo.590.1">if available)</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.591.1">api-documentation</span></strong><span class="koboSpan" id="kobo.592.1">: Enables the generation of API documentation during </span><span class="No-Break"><span class="koboSpan" id="kobo.593.1">recipe builds</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.594.1">bluetooth</span></strong><span class="koboSpan" id="kobo.595.1">: Includes Bluetooth support (integrated </span><span class="No-Break"><span class="koboSpan" id="kobo.596.1">BT only)</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.597.1">cramfs</span></strong><span class="koboSpan" id="kobo.598.1">: Includes </span><span class="No-Break"><span class="koboSpan" id="kobo.599.1">CramFS support</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.600.1">debuginfod</span></strong><span class="koboSpan" id="kobo.601.1">: Includes support for getting ELF debugging information through a </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.602.1">debuginfod</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.603.1"> server</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.604.1">ext2</span></strong><span class="koboSpan" id="kobo.605.1">: Includes tools to support devices with an internal HDD/Microdrive for storing files (instead of </span><span class="No-Break"><span class="koboSpan" id="kobo.606.1">Flash-only devices)</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.607.1">gobject-introspection-data</span></strong><span class="koboSpan" id="kobo.608.1">: Includes data to support </span><span class="No-Break"><span class="koboSpan" id="kobo.609.1">GObject introspection</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.610.1">ipsec</span></strong><span class="koboSpan" id="kobo.611.1">: Includes </span><a id="_idIndexMarker395"/><span class="No-Break"><span class="koboSpan" id="kobo.612.1">IPSec support</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.613.1">ipv4</span></strong><span class="koboSpan" id="kobo.614.1">: Includes </span><span class="No-Break"><span class="koboSpan" id="kobo.615.1">IPv4 support</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.616.1">ipv6</span></strong><span class="koboSpan" id="kobo.617.1">: Includes </span><span class="No-Break"><span class="koboSpan" id="kobo.618.1">IPv6 support</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.619.1">keyboard</span></strong><span class="koboSpan" id="kobo.620.1">: Includes </span><span class="No-Break"><span class="koboSpan" id="kobo.621.1">keyboard support</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.622.1">ldconfig</span></strong><span class="koboSpan" id="kobo.623.1">: Includes support for </span><strong class="source-inline"><span class="koboSpan" id="kobo.624.1">ldconfig</span></strong><span class="koboSpan" id="kobo.625.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.626.1">ld.so.conf</span></strong><span class="koboSpan" id="kobo.627.1"> on </span><span class="No-Break"><span class="koboSpan" id="kobo.628.1">the target</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.629.1">ld-is-gold</span></strong><span class="koboSpan" id="kobo.630.1">: Uses the gold linker instead of the standard GNU </span><span class="No-Break"><span class="koboSpan" id="kobo.631.1">linker (</span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.632.1">bfd</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.633.1">)</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.634.1">lto</span></strong><span class="koboSpan" id="kobo.635.1">: Enables </span><span class="No-Break"><span class="koboSpan" id="kobo.636.1">Link-Time Optimization</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.637.1">multiarch</span></strong><span class="koboSpan" id="kobo.638.1">: Enables you to build applications with multiple </span><span class="No-Break"><span class="koboSpan" id="kobo.639.1">architecture support</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.640.1">nfc</span></strong><span class="koboSpan" id="kobo.641.1">: Includes support for Near </span><span class="No-Break"><span class="koboSpan" id="kobo.642.1">Field Communication</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.643.1">nfs</span></strong><span class="koboSpan" id="kobo.644.1">: Includes </span><a id="_idIndexMarker396"/><span class="koboSpan" id="kobo.645.1">NFS </span><span class="No-Break"><span class="koboSpan" id="kobo.646.1">client support</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.647.1">nls</span></strong><span class="koboSpan" id="kobo.648.1">: Includes </span><strong class="bold"><span class="koboSpan" id="kobo.649.1">Native Language </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.650.1">Support</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.651.1"> (</span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.652.1">NLS</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.653.1">)</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.654.1">opengl</span></strong><span class="koboSpan" id="kobo.655.1">: Includes the Open Graphics Library, a cross-language, multi-platform API, used to render two- and </span><span class="No-Break"><span class="koboSpan" id="kobo.656.1">three-dimensional graphics</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.657.1">overlayfs</span></strong><span class="koboSpan" id="kobo.658.1">: Includes </span><span class="No-Break"><span class="koboSpan" id="kobo.659.1">OverlayFS support</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.660.1">pam</span></strong><span class="koboSpan" id="kobo.661.1">: Includes </span><strong class="bold"><span class="koboSpan" id="kobo.662.1">Pluggable Authentication Module</span></strong><span class="koboSpan" id="kobo.663.1"> (</span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.664.1">PAM</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.665.1">) </span></span><span class="No-Break"><a id="_idIndexMarker397"/></span><span class="No-Break"><span class="koboSpan" id="kobo.666.1">support</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.667.1">pci</span></strong><span class="koboSpan" id="kobo.668.1">: Includes PCI </span><span class="No-Break"><span class="koboSpan" id="kobo.669.1">bus support</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.670.1">pcmcia</span></strong><span class="koboSpan" id="kobo.671.1">: Includes </span><span class="No-Break"><span class="koboSpan" id="kobo.672.1">PCMCIA/CompactFlash support</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.673.1">polkit</span></strong><span class="koboSpan" id="kobo.674.1">: Includes </span><span class="No-Break"><span class="koboSpan" id="kobo.675.1">Polkit support</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.676.1">ppp</span></strong><span class="koboSpan" id="kobo.677.1">: Includes PPP </span><span class="No-Break"><span class="koboSpan" id="kobo.678.1">dial-up support</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.679.1">ptest</span></strong><span class="koboSpan" id="kobo.680.1">: Enables you to build the package tests that were supported by </span><span class="No-Break"><span class="koboSpan" id="kobo.681.1">individual recipes</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.682.1">pulseaudio</span></strong><span class="koboSpan" id="kobo.683.1">: Includes support </span><span class="No-Break"><span class="koboSpan" id="kobo.684.1">for PulseAudio</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.685.1">seccomp</span></strong><span class="koboSpan" id="kobo.686.1">: Enables </span><a id="_idIndexMarker398"/><span class="koboSpan" id="kobo.687.1">you to build applications with </span><strong class="source-inline"><span class="koboSpan" id="kobo.688.1">seccomp</span></strong><span class="koboSpan" id="kobo.689.1"> support, allowing the applications to strictly restrict the system calls that they are allowed </span><span class="No-Break"><span class="koboSpan" id="kobo.690.1">to invoke</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.691.1">selinux</span></strong><span class="koboSpan" id="kobo.692.1">: Includes</span><a id="_idIndexMarker399"/><span class="koboSpan" id="kobo.693.1"> support for </span><strong class="bold"><span class="koboSpan" id="kobo.694.1">Security-Enhanced Linux</span></strong><span class="koboSpan" id="kobo.695.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.696.1">SELinux</span></strong><span class="koboSpan" id="kobo.697.1">) (</span><span class="No-Break"><span class="koboSpan" id="kobo.698.1">requires </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.699.1">meta-selinux</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.700.1">)</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.701.1">smbfs</span></strong><span class="koboSpan" id="kobo.702.1">: Includes SMB network </span><span class="No-Break"><span class="koboSpan" id="kobo.703.1">client support</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.704.1">systemd</span></strong><span class="koboSpan" id="kobo.705.1">: Includes support for this </span><strong class="source-inline"><span class="koboSpan" id="kobo.706.1">init</span></strong><span class="koboSpan" id="kobo.707.1"> manager, a full replacement for </span><strong class="source-inline"><span class="koboSpan" id="kobo.708.1">init</span></strong><span class="koboSpan" id="kobo.709.1">, with parallel starting of services, reduced shell overhead, and </span><span class="No-Break"><span class="koboSpan" id="kobo.710.1">other features</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.711.1">usbgadget</span></strong><span class="koboSpan" id="kobo.712.1">: Includes USB Gadget </span><span class="No-Break"><span class="koboSpan" id="kobo.713.1">Device support</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.714.1">usbhost</span></strong><span class="koboSpan" id="kobo.715.1">: Includes USB </span><span class="No-Break"><span class="koboSpan" id="kobo.716.1">Host support</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.717.1">usrmerge</span></strong><span class="koboSpan" id="kobo.718.1">: Merges the </span><strong class="source-inline"><span class="koboSpan" id="kobo.719.1">/bin</span></strong><span class="koboSpan" id="kobo.720.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.721.1">/sbin</span></strong><span class="koboSpan" id="kobo.722.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.723.1">/lib</span></strong><span class="koboSpan" id="kobo.724.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.725.1">/lib64</span></strong><span class="koboSpan" id="kobo.726.1"> directories into their respective counterparts in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.727.1">/usr</span></strong><span class="koboSpan" id="kobo.728.1"> directory to provide better package and </span><span class="No-Break"><span class="koboSpan" id="kobo.729.1">application compatibility</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.730.1">vfat</span></strong><span class="koboSpan" id="kobo.731.1">: Includes FAT </span><span class="No-Break"><span class="koboSpan" id="kobo.732.1">filesystem support</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.733.1">vulkan</span></strong><span class="koboSpan" id="kobo.734.1">: Includes support for the </span><span class="No-Break"><span class="koboSpan" id="kobo.735.1">Vulkan API</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.736.1">wayland</span></strong><span class="koboSpan" id="kobo.737.1">: Includes the Wayland display server protocol and the library that </span><span class="No-Break"><span class="koboSpan" id="kobo.738.1">supports it</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.739.1">wifi</span></strong><span class="koboSpan" id="kobo.740.1">: Includes Wi-Fi support (</span><span class="No-Break"><span class="koboSpan" id="kobo.741.1">integrated only)</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.742.1">x11</span></strong><span class="koboSpan" id="kobo.743.1">: Includes the X server </span><span class="No-Break"><span class="koboSpan" id="kobo.744.1">and libraries</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.745.1">xattr</span></strong><span class="koboSpan" id="kobo.746.1">: Includes support for extended </span><span class="No-Break"><span class="koboSpan" id="kobo.747.1">file attributes</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.748.1">zeroconf</span></strong><span class="koboSpan" id="kobo.749.1">: Includes </span><a id="_idIndexMarker400"/><span class="koboSpan" id="kobo.750.1">support for </span><span class="No-Break"><span class="koboSpan" id="kobo.751.1">zero-configuration networking</span></span></li>
</ul>
<h1 id="_idParaDest-127"><a id="_idTextAnchor155"/><span class="koboSpan" id="kobo.752.1">MACHINE_FEATURES versus DISTRO_FEATURES</span></h1>
<p><span class="koboSpan" id="kobo.753.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.754.1">DISTRO_FEATURES</span></strong><span class="koboSpan" id="kobo.755.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.756.1">MACHINE_FEATURES</span></strong><span class="koboSpan" id="kobo.757.1"> variables work together to provide feasible support for the</span><a id="_idIndexMarker401"/><span class="koboSpan" id="kobo.758.1"> final system. </span><span class="koboSpan" id="kobo.758.2">When a machine supports a feature, this does not imply that the target system supports it because the distribution must provide its </span><span class="No-Break"><span class="koboSpan" id="kobo.759.1">underlying base.</span></span></p>
<p><span class="koboSpan" id="kobo.760.1">For example, if a machine </span><a id="_idIndexMarker402"/><span class="koboSpan" id="kobo.761.1">supports Wi-Fi but the distribution does not, the applications used by the operating system will be built with Wi-Fi support disabled so that the outcome will be a system without Wi-Fi support. </span><span class="koboSpan" id="kobo.761.2">On the other hand, if the distribution provides Wi-Fi support and a machine does not, the modules and applications needed for the Wi-Fi will not be installed in images built for this machine. </span><span class="koboSpan" id="kobo.761.3">However, the operating system and its modules have support for </span><span class="No-Break"><span class="koboSpan" id="kobo.762.1">Wi-Fi enabled.</span></span></p>
<h1 id="_idParaDest-128"><a id="_idTextAnchor156"/><span class="koboSpan" id="kobo.763.1">Understanding the scope of a variable</span></h1>
<p><span class="koboSpan" id="kobo.764.1">The BitBake metadata</span><a id="_idIndexMarker403"/><span class="koboSpan" id="kobo.765.1"> has thousands of variables, but the scope where these variables are available depends on where it is defined. </span><span class="koboSpan" id="kobo.765.2">There are two kinds of variables, </span><span class="No-Break"><span class="koboSpan" id="kobo.766.1">as follows:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.767.1">Variables defined in configuration files are global to every recipe, also referred to as configuration metadata. </span><span class="koboSpan" id="kobo.767.2">The parsing</span><a id="_idIndexMarker404"/><span class="koboSpan" id="kobo.768.1"> order of the main configuration files is shown </span><span class="No-Break"><span class="koboSpan" id="kobo.769.1">as follows:</span></span><ul><li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.770.1">build/conf/local.conf</span></strong></span></li><li><strong class="source-inline"><span class="koboSpan" id="kobo.771.1">&lt;</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.772.1">layer&gt;/conf/machines/&lt;machine&gt;.conf</span></strong></span></li><li><strong class="source-inline"><span class="koboSpan" id="kobo.773.1">&lt;</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.774.1">layer&gt;/conf/distro/&lt;distro&gt;.conf</span></strong></span></li></ul></li>
<li><span class="koboSpan" id="kobo.775.1">Variables defined within recipe files have recipe visibility scope that is local to the specific recipe only during the execution of </span><span class="No-Break"><span class="koboSpan" id="kobo.776.1">its tasks.</span></span></li>
</ul>
<h1 id="_idParaDest-129"><a id="_idTextAnchor157"/><span class="koboSpan" id="kobo.777.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.778.1">In this chapter, we covered how to create a new layer and metadata. </span><span class="koboSpan" id="kobo.778.2">First, we saw how to create a machine configuration, a distribution definition, and recipe files. </span><span class="koboSpan" id="kobo.778.3">Then, we learned how to make images and include our application in </span><span class="No-Break"><span class="koboSpan" id="kobo.779.1">an image.</span></span></p>
<p><span class="koboSpan" id="kobo.780.1">In the next chapter, we will access some examples of the most common customization cases used by an additional layer, such as modifying existing packages, adding extra options to </span><strong class="source-inline"><span class="koboSpan" id="kobo.781.1">autoconf</span></strong><span class="koboSpan" id="kobo.782.1">, applying a new patch, and including a new file to a package. </span><span class="koboSpan" id="kobo.782.2">We will see how to configure </span><strong class="source-inline"><span class="koboSpan" id="kobo.783.1">BusyBox</span></strong><span class="koboSpan" id="kobo.784.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.785.1">linux-yocto</span></strong><span class="koboSpan" id="kobo.786.1">, the two packages commonly customized when making an </span><span class="No-Break"><span class="koboSpan" id="kobo.787.1">embedded system.</span></span></p>
</div>
</body></html>