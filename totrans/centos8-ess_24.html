<html><head></head><body><div id="sbo-rt-content"><div id="_idContainer218" class="_idGenObjectStyleOverride-1">&#13;
			<p id="_idParaDest-238" class="Chapter-Title" lang="en-US" xml:lang="en-US"><span class="ChapterMarker">26. </span><a id="_idTextAnchor318"/>Working with Containers on CentOS 8</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Now that the basics of Linux Containers have been covered in the previous chapter, the goal of this chapter is to demonstrate how to create and manage containers using the Podman, Skopeo and Buildah tools included with CentOS 8. It is intended that by the end of this chapter you will have a clearer understanding of how to create and manage containers on CentOS 8 and will have gained a knowledge foundation on which to continue exploring the power of Linux Containers.</p>&#13;
			<p id="_idParaDest-239" class="Heading-1-1" lang="en-US" xml:lang="en-US"><span class="Heading11Marker">26.1 </span><a id="_idTextAnchor319"/><a id="_idTextAnchor321"/>Pulling a <a id="_idIndexMarker550"/><a id="_idIndexMarker551"/>Container Image</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">For this example, the CentOS 8 Base image will be pulled from the registry. Before pulling an image, however, information about the image repository can be obtained using the <a id="_idIndexMarker552"/><span class="My-Italic _idGenCharOverride-1">skopeo</span> tool, for example:</p>&#13;
			<p class="Code"># skopeo inspect docker://docker.io/library/centos</p>&#13;
			<p class="Code">{</p>&#13;
			<p class="Code">    "Name": "docker.io/library/centos",</p>&#13;
			<p class="Code">    "Digest": "sha256:f94c1d992c193b3dc09e297ffd54d8a4f1dc946c37cbeceb26d35ce1647f88d9",</p>&#13;
			<p class="Code">    "RepoTags": [</p>&#13;
			<p class="Code">        "5.11",</p>&#13;
			<p class="Code">        "5",</p>&#13;
			<p class="Code">        "6.10",</p>&#13;
			<p class="Code">        "6.6",</p>&#13;
			<p class="Code">        "6.7",</p>&#13;
			<p class="Code">        "6.8",</p>&#13;
			<p class="Code">        "6.9",</p>&#13;
			<p class="Code">        "6",</p>&#13;
			<p class="Code">        "7.0.1406",</p>&#13;
			<p class="Code">        "7.1.1503",</p>&#13;
			<p class="Code">        "7.2.1511",</p>&#13;
			<p class="Code">        "7.3.1611",</p>&#13;
			<p class="Code">        "7.4.1708",</p>&#13;
			<p class="Code">        "7.5.1804",</p>&#13;
			<p class="Code">        "7.6.1810",</p>&#13;
			<p class="Code">        "7.7.1908",</p>&#13;
			<p class="Code">        "7",</p>&#13;
			<p class="Code">        "8",</p>&#13;
			<p class="Code">        "centos5.11",</p>&#13;
			<p class="Code">        "centos5",</p>&#13;
			<p class="Code">        "centos6.10",</p>&#13;
			<p class="Code">        "centos6.6",</p>&#13;
			<p class="Code">        "centos6.7",</p>&#13;
			<p class="Code">        "centos6.8",</p>&#13;
			<p class="Code">        "centos6.9",</p>&#13;
			<p class="Code">        "centos6",</p>&#13;
			<p class="Code">        "centos7.0.1406",</p>&#13;
			<p class="Code">        "centos7.1.1503",</p>&#13;
			<p class="Code">        "centos7.2.1511",</p>&#13;
			<p class="Code">        "centos7.3.1611",</p>&#13;
			<p class="Code">        "centos7.4.1708",</p>&#13;
			<p class="Code">        "centos7.5.1804",</p>&#13;
			<p class="Code">        "centos7.6.1810",</p>&#13;
			<p class="Code">        "centos7.7.1908",</p>&#13;
			<p class="Code">        "centos7",</p>&#13;
			<p class="Code">        "centos8",</p>&#13;
			<p class="Code">        "latest"</p>&#13;
			<p class="Code">    ],</p>&#13;
			<p class="Code">    "Created": "2019-10-01T23:19:57.105928163Z",</p>&#13;
			<p class="Code">    "DockerVersion": "18.06.1-ce",</p>&#13;
			<p class="Code">    "Labels": {</p>&#13;
			<p class="Code">        "org.label-schema.build-date": "20190927",</p>&#13;
			<p class="Code">        "org.label-schema.license": "GPLv2",</p>&#13;
			<p class="Code">        "org.label-schema.name": "CentOS Base Image",</p>&#13;
			<p class="Code">        "org.label-schema.schema-version": "1.0",</p>&#13;
			<p class="Code">        "org.label-schema.vendor": "CentOS"</p>&#13;
			<p class="Code">    },</p>&#13;
			<p class="Code">    "Architecture": "amd64",</p>&#13;
			<p class="Code">    "Os": "linux",</p>&#13;
			<p class="Code">    "Layers": [</p>&#13;
			<p class="Code">        "sha256:729ec3a6ada3a6d26faca9b4779a037231f1762f759ef34c08bdd61bf52cd704"</p>&#13;
			<p class="Code">    ]</p>&#13;
			<p class="Code">}</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Having verified that the repository has the images we need, the podman command can be used to download an image for the required CentOS version using the following syntax where &lt;RepoTag&gt; is replaced by the tag for the CentOS version as shown in the skopeo output:</p>&#13;
			<p class="Code"># podman pull docker://docker.io/library/centos:<span class="My-Italic _idGenCharOverride-2">&lt;RepoTag&gt;</span></p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">For example, to pull the CentOS 7 image:</p>&#13;
			<p class="Code"># podman pull docker://docker.io/library/centos:centos7</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Alternatively, to default to  the latest release of CentOS:</p>&#13;
			<p class="Code"># podman pull docker://docker.io/library/centos:latest</p>&#13;
			<p class="Code">Trying to pull docker://docker.io/library/centos:latest...Getting image source signatures</p>&#13;
			<p class="Code">Skipping blob 729ec3a6ada3 (already present): 68.21 MiB / 68.21 MiB [=======] 0s</p>&#13;
			<p class="Code">Copying config 0f3e07c0138f: 2.13 KiB / 2.13 KiB [==========================] 0s</p>&#13;
			<p class="Code">Writing manifest to image destination</p>&#13;
			<p class="Code">Storing signatures</p>&#13;
			<p class="Code">0f3e07c0138fbe05abcb7a9cc7d63d9bd4c980c3f61fea5efa32e7c4217ef4da</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Verify that the image has been stored by asking <a id="_idIndexMarker553"/><span class="My-Italic _idGenCharOverride-1">podman</span> to list all local images:</p>&#13;
			<p class="Code"># podman images</p>&#13;
			<p class="Code">REPOSITORY                 TAG      IMAGE ID       CREATED       SIZE</p>&#13;
			<p class="Code">docker.io/library/centos   latest   0f3e07c0138f   8 weeks ago   227 MB</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Details about a local image may be obtained by running the <span class="My-Italic _idGenCharOverride-1">podman inspect</span> command:</p>&#13;
			<p class="Code"># podman inspect centos:latest</p>&#13;
			<p id="_idParaDest-240" class="Heading-1-1" lang="en-US" xml:lang="en-US"><span class="Heading11Marker">26.2 </span><a id="_idTextAnchor322"/><a id="_idTextAnchor323"/>Running the Image in a <a id="_idIndexMarker554"/>Container</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">The image pulled from the registry is a fully operational image that is ready to run in a container without modification. To run the image, use the <span class="My-Italic _idGenCharOverride-1">podman run</span> command. In this case the <span class="My-Italic _idGenCharOverride-1">–rm</span> option will be specified to indicate that we want to run the image in a container, execute one command and then have the container exit. In this case, the <span class="My-Italic _idGenCharOverride-1">cat</span> tool will be used to output the content of the <span class="My-Italic _idGenCharOverride-1">/etc/passwd</span> file located on the container root filesystem:</p>&#13;
			<p class="Code"># podman run --rm centos:latest cat /etc/passwd</p>&#13;
			<p class="Code">root:x:0:0:root:/root:/bin/bash</p>&#13;
			<p class="Code">bin:x:1:1:bin:/bin:/sbin/nologin</p>&#13;
			<p class="Code">daemon:x:2:2:daemon:/sbin:/sbin/nologin</p>&#13;
			<p class="Code">adm:x:3:4:adm:/var/adm:/sbin/nologin</p>&#13;
			<p class="Code">lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin</p>&#13;
			<p class="Code">sync:x:5:0:sync:/sbin:/bin/sync</p>&#13;
			<p class="Code">shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown</p>&#13;
			<p class="Code">halt:x:7:0:halt:/sbin:/sbin/halt</p>&#13;
			<p class="Code">mail:x:8:12:mail:/var/spool/mail:/sbin/nologin</p>&#13;
			<p class="Code">operator:x:11:0:operator:/root:/sbin/nologin</p>&#13;
			<p class="Code">games:x:12:100:games:/usr/games:/sbin/nologin</p>&#13;
			<p class="Code">ftp:x:14:50:FTP User:/var/ftp:/sbin/nologin</p>&#13;
			<p class="Code">nobody:x:65534:65534:Kernel Overflow User:/:/sbin/nologin</p>&#13;
			<p class="Code">dbus:x:81:81:System message bus:/:/sbin/nologin</p>&#13;
			<p class="Code">systemd-coredump:x:999:997:systemd Core Dumper:/:/sbin/nologin</p>&#13;
			<p class="Code">systemd-resolve:x:193:193:systemd Resolver:/:/sbin/nologin</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Compare the content of the <span class="My-Italic _idGenCharOverride-1">/etc/passwd</span> file within the container with the <span class="My-Italic _idGenCharOverride-1">/etc/passwd</span> file on the host system and note that it lacks all of the additional users that are present on the host confirming that the <span class="My-Italic _idGenCharOverride-1">cat</span> command was executed within the container environment. Also note that the container started, ran the command and exited all within a matter of seconds. Compare this to the amount of time it takes to start a full operating, perform a task and shutdown a virtual machine and you begin to appreciate the speed and efficiency of containers.</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">To launch a container, keep it running and access the shell, the following command can be used:</p>&#13;
			<p class="Code">$ podman run --name=mycontainer -it centos:latest /bin/bash</p>&#13;
			<p class="Code">[root@965acf617e6e /]#</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Note that an additional command-line option is used to assign the name “mycontainer” to the container. Though optional, this makes the container easier to recognize and reference as an alternative to using the automatically generated container ID.</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">While the container is running, run <a id="_idIndexMarker555"/><span class="My-Italic _idGenCharOverride-1">podman</span> in a different terminal window to see the status of all containers on the system</p>&#13;
			<p class="Code"># podman ps -a</p>&#13;
			<p class="Code">CONTAINER ID  IMAGE                            COMMAND    CREATED             STATUS                 PORTS  NAMES</p>&#13;
			<p class="Code">965acf617e6e  docker.io/library/centos:latest  /bin/bash  About a minute ago  Up About a minute ago         mycontainer</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">To execute a command in a running container from the host, simply use the <span class="My-Italic _idGenCharOverride-1">podman exec</span> command, referencing the name of the running container and the command to be executed. The following command, for example, starts up a second bash session in the container named <span class="My-Italic _idGenCharOverride-1">mycontainer</span>:</p>&#13;
			<p class="Code"># podman exec -it mycontainer /bin/bash</p>&#13;
			<p class="Code">bash-4.4#</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Note that though the above example referenced the container name the same result can be achieved using the container ID as listed by the <a id="_idIndexMarker556"/><span class="My-Italic _idGenCharOverride-1">podman ps -a</span> command:</p>&#13;
			<p class="Code"># podman exec -it 965acf617e6e /bin/bash</p>&#13;
			<p class="Code">bash-4.4#</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Alternatively, the<a id="_idIndexMarker557"/> <span class="My-Italic _idGenCharOverride-1">podman attach</span> command will also attach to a running container and access the shell prompt:</p>&#13;
			<p class="Code"># podman attach mycontainer</p>&#13;
			<p class="Code">bash-4.4#</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Once the container is up and running, any additional configuration changes can be made and packages installed just like any other CentOS 8 system.</p>&#13;
			<p id="_idParaDest-241" class="Heading-1-1" lang="en-US" xml:lang="en-US"><span class="Heading11Marker">26.3 </span><a id="_idTextAnchor324"/>Managing a Container</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Once launched, a container will continue to run until it is stopped via <span class="My-Italic _idGenCharOverride-1">podman</span>, or the command that was launched when the container was run exits. Running the following command on the host, for example, will cause the container to exit:</p>&#13;
			<p class="Code"># <a id="_idIndexMarker558"/>podman stop mycontainer</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Alternatively, pressing the Ctrl-D keyboard sequence within the last remaining bash shell of the container would cause both the shell and container to exit. Once it has exited, the status of the container will change accordingly:</p>&#13;
			<p class="Code"># podman ps -a</p>&#13;
			<p class="Code">CONTAINER ID  IMAGE                            COMMAND    CREATED         STATUS                     PORTS  NAMES</p>&#13;
			<p class="Code">965acf617e6e  docker.io/library/centos:latest  /bin/bash  10 minutes ago  Exited (0) 21 seconds ago         mycontainer</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Although the container is no longer running, it still exists and contains all of the changes that were made to the configuration and file system. If you installed packages, made configuration changes or added files, these changes will persist within “mycontainer”. To verify this, simply restart the container as follows:</p>&#13;
			<p class="Code"># <a id="_idIndexMarker559"/>podman start mycontainer</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">After starting the container, use the <span class="My-Italic _idGenCharOverride-1">podman exec</span> command once again to execute commands within the container as outlined previously. For example, to once again gain access to a shell prompt:</p>&#13;
			<p class="Code"># podman exec -it mycontainer /bin/bash</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">A running container may also be paused and resumed using the <span class="My-Italic _idGenCharOverride-1">podman pause</span> and <span class="My-Italic _idGenCharOverride-1">unpause</span> commands as follows:</p>&#13;
			<p class="Code"># <a id="_idIndexMarker560"/><a id="_idIndexMarker561"/>podman pause my container</p>&#13;
			<p class="Code"># podman unpause my container</p>&#13;
			<p id="_idParaDest-242" class="Heading-1-1" lang="en-US" xml:lang="en-US"><span class="Heading11Marker">26.4 </span><a id="_idTextAnchor325"/>Saving a <a id="_idIndexMarker562"/>Container to an Image</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Once the container guest system is configured to your requirements there is a good chance that you will want to create and run more than one container of this particular type. To do this, the container needs to be saved as an image to local storage so that it can be used as the basis for additional container instances. This is achieved using the <span class="My-Italic _idGenCharOverride-1">podman commit</span> command combined with the name or ID of the container and the name by which the image will be stored, for example:</p>&#13;
			<p class="Code">$ podman commit mycontainer  mycentos_image</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Once the image has been saved, check that it now appears in the list of images in the local repository:</p>&#13;
			<p class="Code">$ podman images</p>&#13;
			<p class="Code">REPOSITORY                 TAG      IMAGE ID       CREATED          SIZE</p>&#13;
			<p class="Code">localhost/mycentos_image   latest   c32c45218143   5 seconds ago    227 MB</p>&#13;
			<p class="Code">docker.io/library/centos   latest   0f3e07c0138f   8 weeks ago      227 MB</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">The saved image can now be used to create additional containers identical to the original:</p>&#13;
			<p class="Code">$ podman run --name=mycontainer2 -it localhost/mycentos_image /bin/bash</p>&#13;
			<p id="_idParaDest-243" class="Heading-1-1" lang="en-US" xml:lang="en-US"><span class="Heading11Marker">26.5 </span><a id="_idTextAnchor326"/>Removing an Image from Local Storage</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">To remove an image from local storage once it is no longer needed, simply run the <span class="My-Italic _idGenCharOverride-1">podman rmi </span>command, referencing either the image name or ID as output by the <span class="My-Italic _idGenCharOverride-1">podman images</span> command. For example, to remove the image named <span class="My-Italic CharOverride-1">mycentos_image</span> created in the previous section, run <span class="My-Italic _idGenCharOverride-1">podman</span> as follows:</p>&#13;
			<p class="Code">$ podman rmi localhost/mycentos_image</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Note before an image can be removed, any containers based on that image must first be removed. </p>&#13;
			<p id="_idParaDest-244" class="Heading-1-1" lang="en-US" xml:lang="en-US"><span class="Heading11Marker">26.6 </span><a id="_idTextAnchor327"/>Removing Containers</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Even when a container has exited or been stopped, it still exists and can be restarted at any time. If a container is no longer needed, it can be deleted using the <span class="My-Italic _idGenCharOverride-1">podman rm</span> command as follows after the container has been stopped:</p>&#13;
			<p class="Code"># <a id="_idIndexMarker567"/>podman rm mycontainer2</p>&#13;
			<p id="_idParaDest-245" class="Heading-1-1" lang="en-US" xml:lang="en-US"><span class="Heading11Marker">26.7 </span><a id="_idTextAnchor328"/>Building a Container with Buildah</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Buildah allows new containers to be built either from existing containers, an image or entirely from scratch. Buildah also includes the ability to mount the file system of a container so that it can be accessed and modified from the host.</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">The following <span class="My-Italic _idGenCharOverride-1">buildah</span> command, for example, will build a container from the CentOS 8 Base image (if the image has not already been pulled from the registry, <span class="My-Italic _idGenCharOverride-1">buildah</span> will download it before creating the container):</p>&#13;
			<p class="Code">$ buildah from docker://docker.io/library/centos:centos8</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">The result of running this command will be a container named <span class="My-Italic CharOverride-1">centos-working-container</span> that is ready to run:</p>&#13;
			<p class="Code">$ buildah run centos-working-container cat /etc/passwd</p>&#13;
			<p id="_idParaDest-246" class="Heading-1-1" lang="en-US" xml:lang="en-US"><span class="Heading11Marker">26.8 </span><a id="_idTextAnchor329"/>Building a <a id="_idIndexMarker568"/>Container from Scratch</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Building a container from scratch essentially creates an empty container. Once created, packages may be installed to meet the requirements of the container. This approach is useful when creating a container that will only need the minimum of packages installed.</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">The first step in building from scratch is to run the following command to build the empty container:</p>&#13;
			<p class="Code"># <a id="_idIndexMarker569"/><a id="_idIndexMarker570"/>buildah from scratch</p>&#13;
			<p class="Code">working-container</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">After the build is complete, a new container will have been created named <span class="My-Italic _idGenCharOverride-1">working-container</span>:</p>&#13;
			<p class="Code">$ buildah containers</p>&#13;
			<p class="Code">CONTAINER ID  BUILDER  IMAGE ID     IMAGE NAME                       CONTAINER NAME</p>&#13;
			<p class="Code">00f81b68f03f     *     0f3e07c0138f docker.io/library/centos:centos8 centos-working-container</p>&#13;
			<p class="Code">d7dd4b652379     *                  scratch                          working-container</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">The empty container is now ready to have some packages installed. Unfortunately this cannot be performed from within the container because not even the <span class="My-Italic _idGenCharOverride-1">bash</span> or <span class="My-Italic _idGenCharOverride-1">dnf</span> tools exist at this point. Instead the container filesystem needs to be mounted on the host system and the installation of the packages performed using <span class="My-Italic _idGenCharOverride-1">dnf</span> with the system root set to the mounted container filesystem. Begin this process by mounting the container’s filesystem as follows:</p>&#13;
			<p class="Code"># <a id="_idIndexMarker572"/>buildah mount working-container</p>&#13;
			<p class="Code">/var/lib/containers/storage/overlay/20b46cf0e2994d1ecdc4487b89f93f6ccf41f72788da63866b6bf80984081d9a/merge</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">If the file system was successfully mounted, <span class="My-Italic _idGenCharOverride-1">buildah</span> will output the mount point for the container file system. Now that we have access to the container filesystem, the <span class="My-Italic _idGenCharOverride-1">dnf</span> command can be used to install packages into the container using the <span class="My-Italic _idGenCharOverride-1">–installroot</span> option to point to the mounted container file system. The following command, for example, installs the bash, CoreUtils and dnf packages on the container filesystem (where <span class="My-Italic _idGenCharOverride-1">&lt;container_fs_mount&gt;</span> is the mount path output previously by the <span class="My-Italic _idGenCharOverride-1">buildah mount</span> command) :</p>&#13;
			<p class="Code"># dnf install --releasever=8 --installroot &lt;container_fs_mount&gt; bash coreutils dnf</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Note that the --releasever option is used to indicate to dnf that the packages for CentOS version 8 are to be installed within the container.</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">After the installation completes, unmount the scratch filesystem as follows:</p>&#13;
			<p class="Code"># buildah umount working-container</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Once <span class="My-Italic _idGenCharOverride-1">dnf</span> has performed the package installation, the container can be run and the bash command prompt accessed as follows:</p>&#13;
			<p class="Code"># <a id="_idIndexMarker573"/>buildah run working-container bash</p>&#13;
			<p class="Code">bash-4.4# </p>&#13;
			<p id="_idParaDest-247" class="Heading-1-1" lang="en-US" xml:lang="en-US"><span class="Heading11Marker">26.9 </span><a id="_idTextAnchor330"/>Container Bridge Networking</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">As outlined in the previous chapter, container networking is implemented using the <a id="_idIndexMarker574"/><a id="_idIndexMarker575"/>Container Networking Interface (CNI) bridged network stack. The following command shows the typical network configuration on a host system on which containers are running:</p>&#13;
			<p class="Code"># ip a</p>&#13;
			<p class="Code">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</p>&#13;
			<p class="Code">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</p>&#13;
			<p class="Code">    inet 127.0.0.1/8 scope host lo</p>&#13;
			<p class="Code">       valid_lft forever preferred_lft forever</p>&#13;
			<p class="Code">    inet6 ::1/128 scope host </p>&#13;
			<p class="Code">       valid_lft forever preferred_lft forever</p>&#13;
			<p class="Code">2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000</p>&#13;
			<p class="Code">    link/ether 08:00:27:20:dc:2f brd ff:ff:ff:ff:ff:ff</p>&#13;
			<p class="Code">    inet 192.168.0.33/24 brd 192.168.0.255 scope global dynamic noprefixroute enp0s3</p>&#13;
			<p class="Code">       valid_lft 3453sec preferred_lft 3453sec</p>&#13;
			<p class="Code">    inet6 2606:a000:4307:f000:aa6:6da1:f8a9:5f95/64 scope global dynamic noprefixroute </p>&#13;
			<p class="Code">       valid_lft 3599sec preferred_lft 3599sec</p>&#13;
			<p class="Code">    inet6 fe80::4275:e186:85e2:d81f/64 scope link noprefixroute </p>&#13;
			<p class="Code">       valid_lft forever preferred_lft forever</p>&#13;
			<p class="Code"><span class="My-Bold _idGenCharOverride-2">3: cni0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000</span></p>&#13;
			<p class="Code"><span class="My-Bold _idGenCharOverride-2">    link/ether 7e:b6:04:22:4f:22 brd ff:ff:ff:ff:ff:ff</span></p>&#13;
			<p class="Code"><span class="My-Bold _idGenCharOverride-2">    inet 10.88.0.1/16 scope global cni0</span></p>&#13;
			<p class="Code"><span class="My-Bold _idGenCharOverride-2">       valid_lft forever preferred_lft forever</span></p>&#13;
			<p class="Code"><span class="My-Bold _idGenCharOverride-2">    inet6 fe80::7cb6:4ff:fe22:4f22/64 scope link </span></p>&#13;
			<p class="Code"><span class="My-Bold _idGenCharOverride-2">       valid_lft forever preferred_lft forever</span></p>&#13;
			<p class="Code">12: veth2a07dc55@if3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master cni0 state UP group default </p>&#13;
			<p class="Code">    link/ether 42:0d:69:13:89:af brd ff:ff:ff:ff:ff:ff link-netns cni-61ba825e-e596-b2ef-a59f-b0743025e448</p>&#13;
			<p class="Code">    inet6 fe80::400d:69ff:fe13:89af/64 scope link </p>&#13;
			<p class="Code">       valid_lft forever preferred_lft forever</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">In the above example, the host has an interface named enp0s3 which is connected to the external network with an IP address of 192.168.0.33. In addition, a virtual interface has been created named cni0 and assigned the IP address of 10.88.0.1. Running the same <span class="My-Italic _idGenCharOverride-1">ip</span> command on a container running on the host might result in the following output:</p>&#13;
			<p class="Code"># ip a</p>&#13;
			<p class="Code">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</p>&#13;
			<p class="Code">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</p>&#13;
			<p class="Code">    inet 127.0.0.1/8 scope host lo</p>&#13;
			<p class="Code">       valid_lft forever preferred_lft forever</p>&#13;
			<p class="Code">    inet6 ::1/128 scope host </p>&#13;
			<p class="Code">       valid_lft forever preferred_lft forever</p>&#13;
			<p class="Code">3: eth0@if12: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </p>&#13;
			<p class="Code">    link/ether 3e:52:22:4b:e0:d8 brd ff:ff:ff:ff:ff:ff link-netnsid 0</p>&#13;
			<p class="Code">    inet 10.88.0.28/16 scope global eth0</p>&#13;
			<p class="Code">       valid_lft forever preferred_lft forever</p>&#13;
			<p class="Code">    inet6 fe80::3c52:22ff:fe4b:e0d8/64 scope link </p>&#13;
			<p class="Code">       valid_lft forever preferred_lft forever</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">In this case, the container has an IP address of 10.88.0.28. Running the <span class="My-Italic _idGenCharOverride-1">ping</span> command on the host will verify that the host and containers are indeed on the same subnet:</p>&#13;
			<p class="Code"># ping 10.88.0.28</p>&#13;
			<p class="Code">PING 10.88.0.28 (10.88.0.28) 56(84) bytes of data.</p>&#13;
			<p class="Code">64 bytes from 10.88.0.28: icmp_seq=1 ttl=64 time=0.056 ms</p>&#13;
			<p class="Code">64 bytes from 10.88.0.28: icmp_seq=2 ttl=64 time=0.039 ms</p>&#13;
			<p class="Code">.</p>&#13;
			<p class="Code">.</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">The CNI configuration settings can be found in the <span class="My-Italic _idGenCharOverride-1">/etc/cni/net.d/87-podman-bridge.conflist</span> file on the host system which, by default, will read as follows:</p>&#13;
			<p class="Code">{</p>&#13;
			<p class="Code">    "cniVersion": "0.3.0",</p>&#13;
			<p class="Code">    "name": "podman",</p>&#13;
			<p class="Code">    "plugins": [</p>&#13;
			<p class="Code">      {</p>&#13;
			<p class="Code">        "type": "bridge",</p>&#13;
			<p class="Code">        "bridge": "cni0",</p>&#13;
			<p class="Code">        "isGateway": true,</p>&#13;
			<p class="Code">        "ipMasq": true,</p>&#13;
			<p class="Code">        "ipam": {</p>&#13;
			<p class="Code">            "type": "host-local",</p>&#13;
			<p class="Code">            "subnet": "10.88.0.0/16",</p>&#13;
			<p class="Code">            "routes": [</p>&#13;
			<p class="Code">                { "dst": "0.0.0.0/0" }</p>&#13;
			<p class="Code">            ]</p>&#13;
			<p class="Code">        }</p>&#13;
			<p class="Code">      },</p>&#13;
			<p class="Code">      {</p>&#13;
			<p class="Code">        "type": "portmap",</p>&#13;
			<p class="Code">        "capabilities": {</p>&#13;
			<p class="Code">          "portMappings": true</p>&#13;
			<p class="Code">        }</p>&#13;
			<p class="Code">      }</p>&#13;
			<p class="Code">    ]</p>&#13;
			<p class="Code">}</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Changes can be made to this file to change the subnet address range, and also to change the plugin type (set to bridge for this example) for implementing different network configurations.</p>&#13;
			<p id="_idParaDest-248" class="Heading-1-1" lang="en-US" xml:lang="en-US"><span class="Heading11Marker">26.10 </span><a id="_idTextAnchor331"/>Summary</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">This chapter has worked through the creation and management of Linux Containers on CentOS 8 using the <span class="My-Italic _idGenCharOverride-1">skopeo</span> and <span class="My-Italic _idGenCharOverride-1">buildah</span> tools, including the use of container images obtained from a repository and the creation of a new image built entirely from scratch.</p>&#13;
		</div>&#13;
</div>



  </body></html>