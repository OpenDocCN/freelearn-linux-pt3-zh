<html><head></head><body>
<div id="_idContainer483" class="calibre2">
<h1 class="chapter-number" id="_idParaDest-161"><a id="_idTextAnchor226" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1.1">11</span></h1>
<h1 id="_idParaDest-162" class="calibre5"><a id="_idTextAnchor227" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.2.1">Performance Tuning Best Practices</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.3.1">Performance tuning system resources is one of the main (or even the most important) tasks of any system administrator. </span><span class="kobospan" id="kobo.3.2">Performance tuning is the process of tweaking a system’s configuration to improve the use of computing resources, data throughput, or user experience. </span><span class="kobospan" id="kobo.3.3">It requires a thorough understanding of the hardware and software components of a system, as well as the many interactions </span><span><span class="kobospan" id="kobo.4.1">between them.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.5.1">Performance tuning is often confused with troubleshooting, but there are significant differences between them. </span><span class="kobospan" id="kobo.5.2">In a troubleshooting process, the main goal is finding and solving a problem to make the system work. </span><span class="kobospan" id="kobo.5.3">In performance tuning, the goal is to get the system running with the best possible performance while taking advantage of the resources and environment it </span><span><span class="kobospan" id="kobo.6.1">operates in.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.7.1">In this chapter, we are going to cover the following main topics on how to get the best performance regarding the key aspects of </span><span><span class="kobospan" id="kobo.8.1">the system:</span></span></p>
<ul class="calibre15">
<li class="calibre14"><span class="kobospan" id="kobo.9.1">Understanding </span><span><span class="kobospan" id="kobo.10.1">kernel tuning</span></span></li>
<li class="calibre14"><span class="kobospan" id="kobo.11.1">Main tuning – CPU </span><span><span class="kobospan" id="kobo.12.1">and memory</span></span></li>
<li class="calibre14"><span class="kobospan" id="kobo.13.1">Don’t ignore </span><span><span class="kobospan" id="kobo.14.1">storage tuning</span></span></li>
<li class="calibre14"><span class="kobospan" id="kobo.15.1">Boosting performance with </span><span><span class="kobospan" id="kobo.16.1">network tuning</span></span></li>
</ul>
<h1 id="_idParaDest-163" class="calibre5"><a id="_idTextAnchor228" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.17.1">Technical requirements</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.18.1">To complete the topics in this chapter, you will need to install the packages indicated in each section. </span><span class="kobospan" id="kobo.18.2">There, you will find instructions for each package that needs to </span><span><span class="kobospan" id="kobo.19.1">be installed.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.20.1">The examples that were created for this chapter can be downloaded from this book’s GitHub </span><span><span class="kobospan" id="kobo.21.1">repository: </span></span><a href="https://github.com/PacktPublishing/Fedora-Linux-System-Administration/tree/main/chapter11" class="pcalibre1 calibre6 pcalibre"><span><span class="kobospan" id="kobo.22.1">https://github.com/PacktPublishing/Fedora-Linux-System-Administration/tree/main/chapter11</span></span></a><span><span class="kobospan" id="kobo.23.1">.</span></span></p>
<h1 id="_idParaDest-164" class="calibre5"><a id="_idTextAnchor229" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.24.1">Understanding kernel tuning</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.25.1">The Linux kernel </span><a id="_idIndexMarker869" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.26.1">exposes </span><em class="italic"><span class="kobospan" id="kobo.27.1">user-space tunable information and configurations</span></em><span class="kobospan" id="kobo.28.1"> through the </span><strong class="source-inline"><span class="kobospan" id="kobo.29.1">/proc</span></strong><span class="kobospan" id="kobo.30.1"> directory. </span><span class="kobospan" id="kobo.30.2">The </span><strong class="source-inline"><span class="kobospan" id="kobo.31.1">/proc</span></strong><span class="kobospan" id="kobo.32.1"> filesystem acts as an interface to the </span><strong class="bold"><span class="kobospan" id="kobo.33.1">kernel</span></strong><span class="kobospan" id="kobo.34.1"> data structures and runtime information. </span><span class="kobospan" id="kobo.34.2">It provides a way to access detailed information about processes, system configuration, hardware, and more, exposing this data through a hierarchy of </span><span><span class="kobospan" id="kobo.35.1">virtual files.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.36.1">The files in the </span><strong class="source-inline"><span class="kobospan" id="kobo.37.1">/proc</span></strong><span class="kobospan" id="kobo.38.1"> directory contain system information such as memory (</span><strong class="source-inline"><span class="kobospan" id="kobo.39.1">meminfo</span></strong><span class="kobospan" id="kobo.40.1">), CPU (</span><strong class="source-inline"><span class="kobospan" id="kobo.41.1">cpuinfo</span></strong><span class="kobospan" id="kobo.42.1">), and </span><span><span class="kobospan" id="kobo.43.1">available filesystems.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.44.1">The </span><strong class="source-inline"><span class="kobospan" id="kobo.45.1">/proc/sys</span></strong><span class="kobospan" id="kobo.46.1"> subdirectory contains configurable parameters to adjust kernel behavior and activity. </span><span class="kobospan" id="kobo.46.2">Most files in </span><strong class="source-inline"><span class="kobospan" id="kobo.47.1">/proc/sys</span></strong><span class="kobospan" id="kobo.48.1"> can be modified by the </span><strong class="source-inline"><span class="kobospan" id="kobo.49.1">root</span></strong><span class="kobospan" id="kobo.50.1"> user. </span><span class="kobospan" id="kobo.50.2">Modifying files in </span><strong class="source-inline"><span class="kobospan" id="kobo.51.1">/proc/sys</span></strong><span class="kobospan" id="kobo.52.1"> causes immediate changes to the </span><span><span class="kobospan" id="kobo.53.1">running system.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.54.1">Note</span></p>
<p class="callout"><span class="kobospan" id="kobo.55.1">Changing the files in </span><strong class="source-inline1"><span class="kobospan" id="kobo.56.1">/proc/sys</span></strong><span class="kobospan" id="kobo.57.1"> could improve the performance of the running system, but it could also degrade it. </span><span class="kobospan" id="kobo.57.2">Be careful when applying any changes to these files. </span><span class="kobospan" id="kobo.57.3">Remember to back up before making any changes </span><span><span class="kobospan" id="kobo.58.1">to them.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.59.1">Within </span><strong class="source-inline"><span class="kobospan" id="kobo.60.1">/proc/sys</span></strong><span class="kobospan" id="kobo.61.1">, the files get organized into a subdirectory tree by tunable </span><span><span class="kobospan" id="kobo.62.1">kernel type:</span></span></p>
<ul class="calibre15">
<li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.63.1">/proc/sys/dev</span></strong><span class="kobospan" id="kobo.64.1">: Contains</span><a id="_idIndexMarker870" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.65.1"> tunables</span><a id="_idIndexMarker871" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.66.1"> for </span><span><strong class="bold"><span class="kobospan" id="kobo.67.1">system devices</span></strong></span></li>
<li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.68.1">/proc/sys/fs</span></strong><span class="kobospan" id="kobo.69.1">: Contains tunable variables </span><a id="_idIndexMarker872" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.70.1">related to </span><span><span class="kobospan" id="kobo.71.1">the </span></span><span><strong class="bold"><span class="kobospan" id="kobo.72.1">filesystem</span></strong></span></li>
<li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.73.1">/proc/sys/kernel</span></strong><span class="kobospan" id="kobo.74.1">: Includes tweaks that</span><a id="_idIndexMarker873" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.75.1"> change the </span><strong class="bold"><span class="kobospan" id="kobo.76.1">internal </span></strong><span><strong class="bold"><span class="kobospan" id="kobo.77.1">kernel operation</span></strong></span></li>
<li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.78.1">/proc/sys/net</span></strong><span class="kobospan" id="kobo.79.1">: Contains tunables that </span><a id="_idIndexMarker874" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.80.1">change the </span><span><strong class="bold"><span class="kobospan" id="kobo.81.1">network configuration</span></strong></span></li>
<li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.82.1">/proc/sys/vm</span></strong><span class="kobospan" id="kobo.83.1">: This contains</span><a id="_idIndexMarker875" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.84.1"> parameters that change the management of the </span><strong class="bold"><span class="kobospan" id="kobo.85.1">virtual memory of </span></strong><span><strong class="bold"><span class="kobospan" id="kobo.86.1">the kernel</span></strong></span></li>
</ul>
<p class="calibre3"><span class="kobospan" id="kobo.87.1">Note</span></p>
<p class="callout"><span class="kobospan" id="kobo.88.1">Remember, not all files in </span><strong class="source-inline1"><span class="kobospan" id="kobo.89.1">/proc/sys</span></strong><span class="kobospan" id="kobo.90.1"> are writable. </span><span class="kobospan" id="kobo.90.2">Some of them only get altered by the operating </span><span><span class="kobospan" id="kobo.91.1">system itself.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.92.1">Let’s see how we can change these </span><span><span class="kobospan" id="kobo.93.1">kernel tunables.</span></span></p>
<h2 id="_idParaDest-165" class="calibre7"><a id="_idTextAnchor230" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.94.1">Tuning kernel parameters</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.95.1">The following </span><a id="_idIndexMarker876" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.96.1">figure illustrates how the kernel parameters can be changed in </span><span><span class="kobospan" id="kobo.97.1">different ways:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer435">
<span class="kobospan" id="kobo.98.1"><img alt="Figure 11.1 – Linux Performance Tuning Tools, by Brendan Gregg (CC BY-SA 4.0)" src="image/B19121_11_1.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.99.1">Figure 11.1 – Linux Performance Tuning Tools, by Brendan Gregg (CC BY-SA 4.0)</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.100.1">As system administrators, the best practice is to make changes through the command line, </span><span><span class="kobospan" id="kobo.101.1">as follows:</span></span></p>
<ul class="calibre15">
<li class="calibre14"><span class="kobospan" id="kobo.102.1">Using a text editor to change </span><strong class="source-inline1"><span class="kobospan" id="kobo.103.1">/</span></strong><span><strong class="source-inline1"><span class="kobospan" id="kobo.104.1">proc/sys</span></strong></span><span><span class="kobospan" id="kobo.105.1"> files</span></span></li>
<li class="calibre14"><span class="kobospan" id="kobo.106.1">Using the </span><strong class="source-inline1"><span class="kobospan" id="kobo.107.1">echo</span></strong><span class="kobospan" id="kobo.108.1"> command to set simple values in </span><span><span class="kobospan" id="kobo.109.1">the tunables</span></span></li>
<li class="calibre14"><span class="kobospan" id="kobo.110.1">Using the </span><strong class="source-inline1"><span class="kobospan" id="kobo.111.1">sysctl</span></strong><span class="kobospan" id="kobo.112.1"> command to set a parameter </span><span><span class="kobospan" id="kobo.113.1">by name</span></span></li>
<li class="calibre14"><span class="kobospan" id="kobo.114.1">Create files with the desired parameters in the </span><strong class="source-inline1"><span class="kobospan" id="kobo.115.1">/</span></strong><span><strong class="source-inline1"><span class="kobospan" id="kobo.116.1">etc/sysctl.d</span></strong></span><span><span class="kobospan" id="kobo.117.1"> directory</span></span></li>
</ul>
<p class="calibre3"><span class="kobospan" id="kobo.118.1">Note</span></p>
<p class="callout"><span class="kobospan" id="kobo.119.1">Changing the configurable values in the kernel tunables directly does not make them </span><em class="italic"><span class="kobospan" id="kobo.120.1">persistent</span></em><span class="kobospan" id="kobo.121.1"> at reboot. </span><span class="kobospan" id="kobo.121.2">To do this, you must use the </span><strong class="source-inline1"><span class="kobospan" id="kobo.122.1">sysctl</span></strong><span class="kobospan" id="kobo.123.1"> command or create a file with the change in the </span><strong class="source-inline1"><span class="kobospan" id="kobo.124.1">/</span></strong><span><strong class="source-inline1"><span class="kobospan" id="kobo.125.1">etc/sysctl.d</span></strong></span><span><span class="kobospan" id="kobo.126.1"> directory.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.127.1">Let’s see an example </span><a id="_idIndexMarker877" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.128.1">of each of the different ways we can do this. </span><span class="kobospan" id="kobo.128.2">Follow </span><span><span class="kobospan" id="kobo.129.1">these steps:</span></span></p>
<ol class="calibre13">
<li class="calibre14"><span class="kobospan" id="kobo.130.1">Review the content of the tunable </span><strong class="source-inline1"><span class="kobospan" id="kobo.131.1">icmp_echo_ignore_all</span></strong><span class="kobospan" id="kobo.132.1"> inside the </span><strong class="source-inline1"><span class="kobospan" id="kobo.133.1">/</span></strong><span><strong class="source-inline1"><span class="kobospan" id="kobo.134.1">proc/sys/net/ipv4</span></strong></span><span><span class="kobospan" id="kobo.135.1"> directory:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.136.1">
# </span><strong class="bold1"><span class="kobospan1" id="kobo.137.1">cat /proc/sys/net/ipv4/icmp_echo_ignore_all</span></strong><span class="kobospan1" id="kobo.138.1">
0</span></pre><p class="calibre3"><span class="kobospan" id="kobo.139.1">This value (</span><strong class="source-inline"><span class="kobospan" id="kobo.140.1">0</span></strong><span class="kobospan" id="kobo.141.1">) indicates that </span><strong class="source-inline"><span class="kobospan" id="kobo.142.1">icmp</span></strong><span class="kobospan" id="kobo.143.1"> (</span><strong class="source-inline"><span class="kobospan" id="kobo.144.1">ping</span></strong><span class="kobospan" id="kobo.145.1">) </span><span><span class="kobospan" id="kobo.146.1">support exists:</span></span></p></li> </ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer436">
<span class="kobospan" id="kobo.147.1"><img alt="Figure 11.2 – The workstation supports ping" src="image/B19121_11_2.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.148.1">Figure 11.2 – The workstation supports ping</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.149.1">Let’s </span><span><span class="kobospan" id="kobo.150.1">change it.</span></span></p>
<ol class="calibre13">
<li value="2" class="calibre14"><span class="kobospan" id="kobo.151.1">Use the </span><strong class="source-inline1"><span class="kobospan" id="kobo.152.1">echo</span></strong><span class="kobospan" id="kobo.153.1"> command to change the value of the tunable from </span><em class="italic"><span class="kobospan" id="kobo.154.1">false</span></em><span class="kobospan" id="kobo.155.1"> (</span><strong class="source-inline1"><span class="kobospan" id="kobo.156.1">0</span></strong><span class="kobospan" id="kobo.157.1">) to </span><span><em class="italic"><span class="kobospan" id="kobo.158.1">true</span></em></span><span><span class="kobospan" id="kobo.159.1"> (</span></span><span><strong class="source-inline1"><span class="kobospan" id="kobo.160.1">1</span></strong></span><span><span class="kobospan" id="kobo.161.1">):</span></span><pre class="source-code"><span class="kobospan1" id="kobo.162.1">
# </span><strong class="bold1"><span class="kobospan1" id="kobo.163.1">echo "1" &gt; /proc/sys/net/ipv4/icmp_echo_ignore_all</span></strong></pre><p class="calibre3"><span class="kobospan" id="kobo.164.1">Confirm the change of </span><span><span class="kobospan" id="kobo.165.1">the tunable:</span></span></p><pre class="source-code"><span class="kobospan1" id="kobo.166.1"># </span><strong class="bold1"><span class="kobospan1" id="kobo.167.1">cat /proc/sys/net/ipv4/icmp_echo_ignore_all</span></strong><span class="kobospan1" id="kobo.168.1">
1</span></pre><p class="calibre3"><span class="kobospan" id="kobo.169.1">As you will see, the</span><a id="_idIndexMarker878" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.170.1"> operating system no longer </span><span><span class="kobospan" id="kobo.171.1">allows </span></span><span><em class="italic"><span class="kobospan" id="kobo.172.1">pinging</span></em></span><span><span class="kobospan" id="kobo.173.1">:</span></span></p></li> </ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer437">
<span class="kobospan" id="kobo.174.1"><img alt="Figure 11.3 – Ping not allowed by the operating system" src="image/B19121_11_3.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.175.1">Figure 11.3 – Ping not allowed by the operating system</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.176.1">This change can also be made using the </span><span><strong class="source-inline"><span class="kobospan" id="kobo.177.1">sysctl</span></strong></span><span><span class="kobospan" id="kobo.178.1"> command.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.179.1">Let’s </span><span><span class="kobospan" id="kobo.180.1">do it.</span></span></p>
<ol class="calibre13">
<li value="3" class="calibre14"><span class="kobospan" id="kobo.181.1">The path of the tunable to change can be represented by replacing the slashes under </span><strong class="source-inline1"><span class="kobospan" id="kobo.182.1">/proc/sys</span></strong><span class="kobospan" id="kobo.183.1"> with dots. </span><span class="kobospan" id="kobo.183.2">In our example, the tunable is </span><span><span class="kobospan" id="kobo.184.1">as follows:</span></span><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.185.1">net.ipv4.icmp_echo_ignore_all</span></strong></pre><p class="calibre3"><span class="kobospan" id="kobo.186.1">Use the </span><strong class="source-inline"><span class="kobospan" id="kobo.187.1">sysctl</span></strong><span class="kobospan" id="kobo.188.1"> command with the </span><strong class="source-inline"><span class="kobospan" id="kobo.189.1">–w</span></strong><span class="kobospan" id="kobo.190.1"> option to </span><span><span class="kobospan" id="kobo.191.1">enable </span></span><span><strong class="source-inline"><span class="kobospan" id="kobo.192.1">ping</span></strong></span><span><span class="kobospan" id="kobo.193.1">:</span></span></p><pre class="source-code"><span class="kobospan1" id="kobo.194.1"># </span><strong class="bold1"><span class="kobospan1" id="kobo.195.1">sysctl -w net.ipv4.icmp_echo_ignore_all="0"</span></strong><span class="kobospan1" id="kobo.196.1">
net.ipv4.icmp_echo_ignore_all = 0</span></pre><p class="calibre3"><span class="kobospan" id="kobo.197.1">Confirm that </span><strong class="source-inline"><span class="kobospan" id="kobo.198.1">ping</span></strong><span class="kobospan" id="kobo.199.1"> support is </span><span><span class="kobospan" id="kobo.200.1">already enabled:</span></span></p></li> </ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer438">
<span class="kobospan" id="kobo.201.1"><img alt="Figure 11.4 – Ping allowed" src="image/B19121_11_4.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.202.1">Figure 11.4 – Ping allowed</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.203.1">However, this</span><a id="_idIndexMarker879" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.204.1"> change is not persistent </span><span><span class="kobospan" id="kobo.205.1">on reboot.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.206.1">Let’s see how to </span><span><span class="kobospan" id="kobo.207.1">do this.</span></span></p>
<ol class="calibre13">
<li value="4" class="calibre14"><span class="kobospan" id="kobo.208.1">On boot, the kernel loads the tunable settings from the configuration files found in </span><span><span class="kobospan" id="kobo.209.1">these directories:</span></span><ul class="calibre17"><li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.210.1">/</span></strong><span><strong class="source-inline1"><span class="kobospan" id="kobo.211.1">etc/sysctl.d/</span></strong></span></li><li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.212.1">/</span></strong><span><strong class="source-inline1"><span class="kobospan" id="kobo.213.1">run/sysctl.d/</span></strong></span></li><li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.214.1">/</span></strong><span><strong class="source-inline1"><span class="kobospan" id="kobo.215.1">usr/lib/sysctl.d/</span></strong></span></li></ul><p class="calibre3"><span class="kobospan" id="kobo.216.1">Create a configuration file with the </span><strong class="source-inline"><span class="kobospan" id="kobo.217.1">.conf</span></strong><span class="kobospan" id="kobo.218.1"> extension, with the tunable set </span><span><span class="kobospan" id="kobo.219.1">to </span></span><span><strong class="source-inline"><span class="kobospan" id="kobo.220.1">true</span></strong></span><span><span class="kobospan" id="kobo.221.1">:</span></span></p><pre class="source-code"><span class="kobospan1" id="kobo.222.1">
# </span><strong class="bold1"><span class="kobospan1" id="kobo.223.1">echo "net.ipv4.icmp_echo_ignore_all=1" &gt; /etc/sysctl.d/ping.conf</span></strong></pre><p class="calibre3"><span class="kobospan" id="kobo.224.1">Use the </span><strong class="source-inline"><span class="kobospan" id="kobo.225.1">sysctl</span></strong><span class="kobospan" id="kobo.226.1"> command with the </span><strong class="source-inline"><span class="kobospan" id="kobo.227.1">-p</span></strong><span class="kobospan" id="kobo.228.1"> option to apply </span><span><span class="kobospan" id="kobo.229.1">the setting:</span></span></p><pre class="source-code"><span class="kobospan1" id="kobo.230.1"># </span><strong class="bold1"><span class="kobospan1" id="kobo.231.1">sysctl -p /etc/sysctl.d/ping.conf</span></strong><span class="kobospan1" id="kobo.232.1">
net.ipv4.icmp_echo_ignore_all = 1</span></pre><p class="calibre3"><span class="kobospan" id="kobo.233.1">Confirm the </span><strong class="source-inline"><span class="kobospan" id="kobo.234.1">ping</span></strong> <span><span class="kobospan" id="kobo.235.1">behavior change:</span></span></p></li> </ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer439">
<span class="kobospan" id="kobo.236.1"><img alt="Figure 11.5 – Ping not allowed" src="image/B19121_11_5.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.237.1">Figure 11.5 – Ping not allowed</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.238.1">These are the </span><a id="_idIndexMarker880" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.239.1">different ways to change the kernel tunables. </span><span class="kobospan" id="kobo.239.2">To get the list of kernel tunables, use the </span><strong class="source-inline"><span class="kobospan" id="kobo.240.1">-a</span></strong><span class="kobospan" id="kobo.241.1"> option of the </span><span><strong class="source-inline"><span class="kobospan" id="kobo.242.1">sysctl</span></strong></span><span><span class="kobospan" id="kobo.243.1"> command:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.244.1">
# </span><strong class="bold1"><span class="kobospan1" id="kobo.245.1">sysctl –a</span></strong></pre> <div class="calibre2">
<div class="img---figure" id="_idContainer440">
<span class="kobospan" id="kobo.246.1"><img alt="Figure 11.6 – Kernel tunables list" src="image/B19121_11_6.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.247.1">Figure 11.6 – Kernel tunables list</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.248.1">Changes that are made to the kernel tunables modify the behavior of the operating system. </span><span class="kobospan" id="kobo.248.2">Now, let’s </span><a id="_idIndexMarker881" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.249.1">take a look at the changes in some specific aspects of the main components of the </span><span><span class="kobospan" id="kobo.250.1">operating system.</span></span></p>
<h1 id="_idParaDest-166" class="calibre5"><a id="_idTextAnchor231" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.251.1">Main tuning – CPU and memory</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.252.1">In the previous section, </span><span><em class="italic"><span class="kobospan" id="kobo.253.1">Figure 11</span></em></span><em class="italic"><span class="kobospan" id="kobo.254.1">.1</span></em><span class="kobospan" id="kobo.255.1"> illustrated the different tools that help us collect performance</span><a id="_idIndexMarker882" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.256.1"> information </span><a id="_idIndexMarker883" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.257.1">on the use of </span><span><span class="kobospan" id="kobo.258.1">system resources.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.259.1">The tools display system information such as free disk space, CPU temperature, and other essential components, as well as network information such as the system’s IP address and current upload and </span><span><span class="kobospan" id="kobo.260.1">download rates.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.261.1">Monitoring the resources of the running system represents one of the many main tasks of a system administrator. </span><span class="kobospan" id="kobo.261.2">The goal of system monitoring is to determine whether the current performance meets the specified </span><span><span class="kobospan" id="kobo.262.1">technical requirements.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.263.1">Monitoring the performance of resources helps us know about the areas that </span><span><span class="kobospan" id="kobo.264.1">need improving.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.265.1">Before changing the CPU and memory usage configuration, let’s take a brief look at the basic monitoring tools included in </span><span><span class="kobospan" id="kobo.266.1">Fedora Linux.</span></span></p>
<h2 id="_idParaDest-167" class="calibre7"><a id="_idTextAnchor232" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.267.1">Overview of monitoring tools</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.268.1">Monitoring tools provide</span><a id="_idIndexMarker884" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.269.1"> per-process statistics and are based on process structures or system-wide statistics from the kernel. </span><span class="kobospan" id="kobo.269.2">Monitoring tools usually become available to </span><em class="italic"><span class="kobospan" id="kobo.270.1">unprivileged users</span></em><span class="kobospan" id="kobo.271.1">, but for a more granular level of detail, system administrator privileges </span><span><span class="kobospan" id="kobo.272.1">are required.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.273.1">The </span><strong class="source-inline"><span class="kobospan" id="kobo.274.1">ps</span></strong><span class="kobospan" id="kobo.275.1"> and </span><strong class="source-inline"><span class="kobospan" id="kobo.276.1">top</span></strong><span class="kobospan" id="kobo.277.1"> commands are the most common commands that provide process statistics, including CPU </span><span><span class="kobospan" id="kobo.278.1">and memory.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.279.1">As the </span><strong class="source-inline"><span class="kobospan" id="kobo.280.1">root</span></strong><span class="kobospan" id="kobo.281.1"> user, running the </span><strong class="source-inline"><span class="kobospan" id="kobo.282.1">ps</span></strong><span class="kobospan" id="kobo.283.1"> command with the </span><strong class="source-inline"><span class="kobospan" id="kobo.284.1">aux</span></strong><span class="kobospan" id="kobo.285.1"> option lists the processes with extended details </span><span><span class="kobospan" id="kobo.286.1">by user:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.287.1">
# </span><strong class="bold1"><span class="kobospan1" id="kobo.288.1">ps aux</span></strong></pre> <div class="calibre2">
<div class="img---figure" id="_idContainer441">
<span class="kobospan" id="kobo.289.1"><img alt="Figure 11.7 – Output of the ps aux command" src="image/B19121_11_7.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.290.1">Figure 11.7 – Output of the ps aux command</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.291.1">The following table describes the</span><a id="_idIndexMarker885" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.292.1"> output of the </span><strong class="source-inline"><span class="kobospan" id="kobo.293.1">ps aux</span></strong><span class="kobospan" id="kobo.294.1"> command column </span><span><span class="kobospan" id="kobo.295.1">by column:</span></span></p>
<table class="no-table-style" id="table001-5">
<colgroup class="calibre10">
<col class="calibre11"/>
<col class="calibre11"/>
</colgroup>
<tbody class="calibre12">
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span><strong class="bold"><span class="kobospan" id="kobo.296.1">Column</span></strong></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span><strong class="bold"><span class="kobospan" id="kobo.297.1">Description</span></strong></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span><strong class="source-inline"><span class="kobospan" id="kobo.298.1">USER</span></strong></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span class="kobospan" id="kobo.299.1">The user running </span><span><span class="kobospan" id="kobo.300.1">the process.</span></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span><strong class="source-inline"><span class="kobospan" id="kobo.301.1">PID</span></strong></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span class="kobospan" id="kobo.302.1">Process ID of </span><span><span class="kobospan" id="kobo.303.1">this process.</span></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><strong class="source-inline"><span class="kobospan" id="kobo.304.1">%</span></strong><span><strong class="source-inline"><span class="kobospan" id="kobo.305.1">CPU</span></strong></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span class="kobospan" id="kobo.306.1">CPU time used (in percent) by </span><span><span class="kobospan" id="kobo.307.1">this process.</span></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><strong class="source-inline"><span class="kobospan" id="kobo.308.1">%</span></strong><span><strong class="source-inline"><span class="kobospan" id="kobo.309.1">MEM</span></strong></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span class="kobospan" id="kobo.310.1">Physical memory used (in percentage) by </span><span><span class="kobospan" id="kobo.311.1">this process.</span></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span><strong class="source-inline"><span class="kobospan" id="kobo.312.1">VSZ</span></strong></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span class="kobospan" id="kobo.313.1">Virtual memory used (in bytes) by </span><span><span class="kobospan" id="kobo.314.1">this process.</span></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span><strong class="source-inline"><span class="kobospan" id="kobo.315.1">RSS</span></strong></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span class="kobospan" id="kobo.316.1">Resident Set Size, </span><em class="italic"><span class="kobospan" id="kobo.317.1">non-swappable</span></em><span class="kobospan" id="kobo.318.1"> physical memory used (in KiB*) by </span><span><span class="kobospan" id="kobo.319.1">this process.</span></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span><strong class="source-inline"><span class="kobospan" id="kobo.320.1">TTY</span></strong></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span class="kobospan" id="kobo.321.1">Terminal from which the </span><span><span class="kobospan" id="kobo.322.1">process started.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.323.1">The </span><em class="italic"><span class="kobospan" id="kobo.324.1">question mark</span></em><span class="kobospan" id="kobo.325.1"> (</span><strong class="source-inline"><span class="kobospan" id="kobo.326.1">?</span></strong><span class="kobospan" id="kobo.327.1">) indicates that the process wasn’t started from </span><span><span class="kobospan" id="kobo.328.1">a terminal.</span></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span><strong class="source-inline"><span class="kobospan" id="kobo.329.1">STAT</span></strong></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span><span class="kobospan" id="kobo.330.1">Process state.</span></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span><strong class="source-inline"><span class="kobospan" id="kobo.331.1">START</span></strong></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span class="kobospan" id="kobo.332.1">Starting time and date of </span><span><span class="kobospan" id="kobo.333.1">the process.</span></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span><strong class="source-inline"><span class="kobospan" id="kobo.334.1">TIME</span></strong></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span class="kobospan" id="kobo.335.1">Total CPU time used by </span><span><span class="kobospan" id="kobo.336.1">this process.</span></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span><strong class="source-inline"><span class="kobospan" id="kobo.337.1">COMMAND</span></strong></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span class="kobospan" id="kobo.338.1">The command, with all its arguments, that started </span><span><span class="kobospan" id="kobo.339.1">the process.</span></span></p>
</td>
</tr>
</tbody>
</table>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.340.1">Table 11.1 – The ps aux command’s output description column by column</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.341.1">*More details </span><a id="_idIndexMarker886" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.342.1">will be</span><a id="_idIndexMarker887" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.343.1"> provided in the </span><span><span class="kobospan" id="kobo.344.1">following section.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.345.1">Note</span></p>
<p class="callout"><span class="kobospan" id="kobo.346.1">For more information about the </span><em class="italic"><span class="kobospan" id="kobo.347.1">process stat codes</span></em><span class="kobospan" id="kobo.348.1">, refer to the </span><strong class="source-inline1"><span class="kobospan" id="kobo.349.1">ps</span></strong><span class="kobospan" id="kobo.350.1"> manual pages. </span><span class="kobospan" id="kobo.350.2">Use the </span><strong class="source-inline1"><span class="kobospan" id="kobo.351.1">man </span></strong><span><strong class="source-inline1"><span class="kobospan" id="kobo.352.1">ps</span></strong></span><span><span class="kobospan" id="kobo.353.1"> command.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.354.1">Unlike the </span><strong class="source-inline"><span class="kobospan" id="kobo.355.1">ps</span></strong><span class="kobospan" id="kobo.356.1"> command, where the output is static, the </span><strong class="source-inline"><span class="kobospan" id="kobo.357.1">top</span></strong><span class="kobospan" id="kobo.358.1"> command provides a real-time report of process activity. </span><span class="kobospan" id="kobo.358.2">It also provides an interface for filtering and manipulating the </span><span><span class="kobospan" id="kobo.359.1">monitoring data:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.360.1">
# </span><strong class="bold1"><span class="kobospan1" id="kobo.361.1">top</span></strong></pre> <div class="calibre2">
<div class="img---figure" id="_idContainer442">
<span class="kobospan" id="kobo.362.1"><img alt="Figure 11.8 – Output of the top command" src="image/B19121_11_8.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.363.1">Figure 11.8 – Output of the top command</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.364.1">The command output header provides general information on the current behavior of </span><span><span class="kobospan" id="kobo.365.1">the system:</span></span></p>
<ul class="calibre15">
<li class="calibre14"><span class="kobospan" id="kobo.366.1">The first line includes the current time, how long the system runs for, the number of users connected, and the average load in the last 1, 5, and </span><span><span class="kobospan" id="kobo.367.1">15 minutes</span></span></li>
<li class="calibre14"><span class="kobospan" id="kobo.368.1">The second line</span><a id="_idIndexMarker888" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.369.1"> shows the number of tasks and their statuses: running, sleeping, stopped, </span><span><span class="kobospan" id="kobo.370.1">or zombies</span></span></li>
<li class="calibre14"><span class="kobospan" id="kobo.371.1">The third line shows different CPU usage values (</span><span><span class="kobospan" id="kobo.372.1">at runtime):</span></span><ul class="calibre17"><li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.373.1">us</span></strong><span class="kobospan" id="kobo.374.1">: Time that </span><strong class="source-inline1"><span class="kobospan" id="kobo.375.1">CPU</span></strong><span class="kobospan" id="kobo.376.1"> spends running processes for users in </span><span><em class="italic"><span class="kobospan" id="kobo.377.1">user space</span></em></span></li><li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.378.1">sy</span></strong><span class="kobospan" id="kobo.379.1">: Time spent running </span><em class="italic"><span class="kobospan" id="kobo.380.1">system kernel </span></em><span><em class="italic"><span class="kobospan" id="kobo.381.1">space</span></em></span><span><span class="kobospan" id="kobo.382.1"> processes</span></span></li><li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.383.1">ni</span></strong><span class="kobospan" id="kobo.384.1">: Time spent running processes with a manually set </span><span><strong class="source-inline1"><span class="kobospan" id="kobo.385.1">nice</span></strong></span><span><span class="kobospan" id="kobo.386.1"> value</span></span></li><li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.387.1">id</span></strong><span class="kobospan" id="kobo.388.1">: </span><strong class="source-inline1"><span class="kobospan" id="kobo.389.1">CPU</span></strong> <span><span class="kobospan" id="kobo.390.1">idle time</span></span></li><li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.391.1">wa</span></strong><span class="kobospan" id="kobo.392.1">: Time that </span><strong class="source-inline1"><span class="kobospan" id="kobo.393.1">CPU</span></strong><span class="kobospan" id="kobo.394.1"> spends waiting for </span><strong class="source-inline1"><span class="kobospan" id="kobo.395.1">I/O</span></strong><span class="kobospan" id="kobo.396.1"> tasks </span><span><span class="kobospan" id="kobo.397.1">to complete</span></span></li><li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.398.1">hi</span></strong><span class="kobospan" id="kobo.399.1">: Time spent servicing </span><span><em class="italic"><span class="kobospan" id="kobo.400.1">hardware interrupts</span></em></span></li><li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.401.1">si</span></strong><span class="kobospan" id="kobo.402.1">: Time spent servicing </span><span><em class="italic"><span class="kobospan" id="kobo.403.1">software interrupts</span></em></span></li><li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.404.1">st</span></strong><span class="kobospan" id="kobo.405.1">: Time lost due to running virtual machines (</span><span><em class="italic"><span class="kobospan" id="kobo.406.1">steal time</span></em></span><span><span class="kobospan" id="kobo.407.1">)</span></span></li></ul></li>
<li class="calibre14"><span class="kobospan" id="kobo.408.1">The fourth line shows the total amount (in KiB) of physical memory, and how much is free, used, and buffered </span><span><span class="kobospan" id="kobo.409.1">or cached</span></span></li>
<li class="calibre14"><span class="kobospan" id="kobo.410.1">The fifth line shows the total amount (in KiB) of swap memory, and how much is free, used, </span><span><span class="kobospan" id="kobo.411.1">and available</span></span></li>
</ul>
<p class="calibre3"><span class="kobospan" id="kobo.412.1">The following table describes </span><a id="_idIndexMarker889" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.413.1">the output</span><a id="_idIndexMarker890" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.414.1"> of the </span><strong class="source-inline"><span class="kobospan" id="kobo.415.1">top</span></strong><span class="kobospan" id="kobo.416.1"> command column </span><span><span class="kobospan" id="kobo.417.1">by column:</span></span></p>
<table class="no-table-style" id="table002-3">
<colgroup class="calibre10">
<col class="calibre11"/>
<col class="calibre11"/>
</colgroup>
<tbody class="calibre12">
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span><strong class="bold"><span class="kobospan" id="kobo.418.1">Column</span></strong></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span><strong class="bold"><span class="kobospan" id="kobo.419.1">Description</span></strong></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span><strong class="source-inline"><span class="kobospan" id="kobo.420.1">PID</span></strong></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span><span class="kobospan" id="kobo.421.1">Process ID</span></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span><strong class="source-inline"><span class="kobospan" id="kobo.422.1">USER</span></strong></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span class="kobospan" id="kobo.423.1">User owner of </span><span><span class="kobospan" id="kobo.424.1">the process</span></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span><strong class="source-inline"><span class="kobospan" id="kobo.425.1">PR</span></strong></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span><span class="kobospan" id="kobo.426.1">Process priority</span></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span><strong class="source-inline"><span class="kobospan" id="kobo.427.1">NI</span></strong></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span class="kobospan" id="kobo.428.1">Nice value of </span><span><span class="kobospan" id="kobo.429.1">the process</span></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span><strong class="source-inline"><span class="kobospan" id="kobo.430.1">VIRT</span></strong></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span class="kobospan" id="kobo.431.1">Virtual memory used by </span><span><span class="kobospan" id="kobo.432.1">the process</span></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span><strong class="source-inline"><span class="kobospan" id="kobo.433.1">RES</span></strong></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span class="kobospan" id="kobo.434.1">Resident memory used by </span><span><span class="kobospan" id="kobo.435.1">the process</span></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span><strong class="source-inline"><span class="kobospan" id="kobo.436.1">SHR</span></strong></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span class="kobospan" id="kobo.437.1">Shared memory used by </span><span><span class="kobospan" id="kobo.438.1">the process</span></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><strong class="source-inline"><span class="kobospan" id="kobo.439.1">S</span></strong></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span class="kobospan" id="kobo.440.1">Status of </span><span><span class="kobospan" id="kobo.441.1">the process</span></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><strong class="source-inline"><span class="kobospan" id="kobo.442.1">%</span></strong><span><strong class="source-inline"><span class="kobospan" id="kobo.443.1">CPU</span></strong></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span class="kobospan" id="kobo.444.1">Share of CPU time used (in percentage) by the process since the </span><span><span class="kobospan" id="kobo.445.1">last update</span></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><strong class="source-inline"><span class="kobospan" id="kobo.446.1">%</span></strong><span><strong class="source-inline"><span class="kobospan" id="kobo.447.1">MEM</span></strong></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span class="kobospan" id="kobo.448.1">Share of physical </span><strong class="source-inline"><span class="kobospan" id="kobo.449.1">memory</span></strong><span class="kobospan" id="kobo.450.1"> used (</span><span><span class="kobospan" id="kobo.451.1">in percentage)</span></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span><strong class="source-inline"><span class="kobospan" id="kobo.452.1">TIME+</span></strong></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span class="kobospan" id="kobo.453.1">Total CPU time used by the task in hundredths of </span><span><span class="kobospan" id="kobo.454.1">a second</span></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span><strong class="source-inline"><span class="kobospan" id="kobo.455.1">COMMAND</span></strong></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span class="kobospan" id="kobo.456.1">The command, with all its arguments, that started </span><span><span class="kobospan" id="kobo.457.1">the process</span></span></p>
</td>
</tr>
</tbody>
</table>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.458.1">Table 11.2 – The top command’s output description column by column</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.459.1">Note</span></p>
<p class="callout"><span class="kobospan" id="kobo.460.1">For more information about the process status codes, refer to the </span><strong class="source-inline1"><span class="kobospan" id="kobo.461.1">top</span></strong><span class="kobospan" id="kobo.462.1"> manual pages. </span><span class="kobospan" id="kobo.462.2">Use the </span><strong class="source-inline1"><span class="kobospan" id="kobo.463.1">man top</span></strong><span class="kobospan" id="kobo.464.1"> command to </span><span><span class="kobospan" id="kobo.465.1">do so.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.466.1">Regarding </span><strong class="source-inline"><span class="kobospan" id="kobo.467.1">memory</span></strong><span class="kobospan" id="kobo.468.1">, the </span><strong class="source-inline"><span class="kobospan" id="kobo.469.1">free</span></strong><span class="kobospan" id="kobo.470.1"> command lists the free and used </span><em class="italic"><span class="kobospan" id="kobo.471.1">physical</span></em><span class="kobospan" id="kobo.472.1"> and </span><em class="italic"><span class="kobospan" id="kobo.473.1">swap</span></em> <strong class="source-inline"><span class="kobospan" id="kobo.474.1">memory</span></strong><span class="kobospan" id="kobo.475.1">. </span><span class="kobospan" id="kobo.475.2">By using the </span><strong class="source-inline"><span class="kobospan" id="kobo.476.1">-b</span></strong><span class="kobospan" id="kobo.477.1">, </span><strong class="source-inline"><span class="kobospan" id="kobo.478.1">-k</span></strong><span class="kobospan" id="kobo.479.1">, </span><strong class="source-inline"><span class="kobospan" id="kobo.480.1">-m</span></strong><span class="kobospan" id="kobo.481.1">, and </span><strong class="source-inline"><span class="kobospan" id="kobo.482.1">-g</span></strong><span class="kobospan" id="kobo.483.1"> options, the output will be displayed in bytes, KB, MB, and </span><span><span class="kobospan" id="kobo.484.1">GB, respectively:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.485.1">
# </span><strong class="bold1"><span class="kobospan1" id="kobo.486.1">free</span></strong></pre> <div class="calibre2">
<div class="img---figure" id="_idContainer443">
<span class="kobospan" id="kobo.487.1"><img alt="Figure 11.9 – Outputs after running the different options of the free command" src="image/B19121_11_9.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.488.1">Figure 11.9 – Outputs after running the different options of the free command</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.489.1">The GNOME desktop</span><a id="_idIndexMarker891" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.490.1"> provides a graphical tool for resource monitoring. </span><span class="kobospan" id="kobo.490.2">From the main menu, under </span><strong class="bold"><span class="kobospan" id="kobo.491.1">Activities Overview</span></strong><span class="kobospan" id="kobo.492.1">, type </span><span><strong class="source-inline"><span class="kobospan" id="kobo.493.1">system monitor</span></strong></span><span><span class="kobospan" id="kobo.494.1">:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer444">
<span class="kobospan" id="kobo.495.1"><img alt="Figure 11.10 – GNOME System Monitor from Activities Overview" src="image/B19121_11_10.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.496.1">Figure 11.10 – GNOME System Monitor from Activities Overview</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.497.1">You can also open the utility from the Terminal by running the </span><span><strong class="source-inline"><span class="kobospan" id="kobo.498.1">gnome-system-monitor</span></strong></span><span><span class="kobospan" id="kobo.499.1"> command:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.500.1">
$ </span><strong class="bold1"><span class="kobospan1" id="kobo.501.1">gnome-system-monitor</span></strong></pre> <div class="calibre2">
<div class="img---figure" id="_idContainer445">
<span class="kobospan" id="kobo.502.1"><img alt="Figure 11.11 – GNOME System Monitor" src="image/B19121_11_11.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.503.1">Figure 11.11 – GNOME System Monitor</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.504.1">Fedora Linux, through its</span><a id="_idIndexMarker892" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.505.1"> official repositories, provides a package that integrates several monitoring tools. </span><span class="kobospan" id="kobo.505.2">The </span><strong class="source-inline"><span class="kobospan" id="kobo.506.1">sysstat</span></strong><span class="kobospan" id="kobo.507.1"> package takes the </span><em class="italic"><span class="kobospan" id="kobo.508.1">raw data</span></em><span class="kobospan" id="kobo.509.1"> from the kernel counters and allows you to display and store the metrics in a historical </span><em class="italic"><span class="kobospan" id="kobo.510.1">process </span></em><span><em class="italic"><span class="kobospan" id="kobo.511.1">running</span></em></span><span><span class="kobospan" id="kobo.512.1"> database.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.513.1">The following utilities are included in </span><span><span class="kobospan" id="kobo.514.1">this package:</span></span></p>
<ul class="calibre15">
<li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.515.1">mpstat</span></strong><span class="kobospan" id="kobo.516.1">: Reports individual or combined </span><span><strong class="source-inline1"><span class="kobospan" id="kobo.517.1">CPU</span></strong></span><span><span class="kobospan" id="kobo.518.1">-related statistics</span></span></li>
<li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.519.1">iostat</span></strong><span class="kobospan" id="kobo.520.1">: Reports </span><strong class="source-inline1"><span class="kobospan" id="kobo.521.1">CPU</span></strong><span class="kobospan" id="kobo.522.1"> and I/O statistics for devices, partitions, and the </span><span><span class="kobospan" id="kobo.523.1">network filesystem</span></span></li>
<li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.524.1">pidstat</span></strong><span class="kobospan" id="kobo.525.1">: Reports statistics for processes, including disk </span><strong class="source-inline1"><span class="kobospan" id="kobo.526.1">I/O</span></strong><span class="kobospan" id="kobo.527.1">, </span><strong class="source-inline1"><span class="kobospan" id="kobo.528.1">CPU</span></strong><span class="kobospan" id="kobo.529.1">, and </span><span><strong class="source-inline1"><span class="kobospan" id="kobo.530.1">memory</span></strong></span><span><span class="kobospan" id="kobo.531.1"> usage</span></span></li>
<li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.532.1">cifsiostat</span></strong><span class="kobospan" id="kobo.533.1">: Reports statistics about shared filesystems, printers, or network </span><span><span class="kobospan" id="kobo.534.1">serial ports</span></span></li>
<li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.535.1">sar</span></strong><span class="kobospan" id="kobo.536.1">: Collects, reports, and stores </span><span><span class="kobospan" id="kobo.537.1">system activity</span></span></li>
</ul>
<p class="calibre3"><span class="kobospan" id="kobo.538.1">To install the package, from the Terminal, run the </span><span><span class="kobospan" id="kobo.539.1">following command:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.540.1">
# </span><strong class="bold1"><span class="kobospan1" id="kobo.541.1">dnf install sysstat</span></strong></pre> <p class="calibre3"><span class="kobospan" id="kobo.542.1">All these tools are useful for measuring and storing system resource usage information. </span><span class="kobospan" id="kobo.542.2">And with this, we </span><a id="_idIndexMarker893" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.543.1">can determine which aspect of the resources has points </span><span><span class="kobospan" id="kobo.544.1">for improvement.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.545.1">Let’s start with </span><span><strong class="source-inline"><span class="kobospan" id="kobo.546.1">CPU</span></strong></span><span><span class="kobospan" id="kobo.547.1"> usage.</span></span></p>
</div>


<div id="_idContainer483" class="calibre2">
<h2 id="_idParaDest-168" class="calibre7"><a id="_idTextAnchor233" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.548.1">Improving CPU usage</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.549.1">To find points of improvement</span><a id="_idIndexMarker894" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.550.1"> in CPU usage, first, observe the behavior of the CPU. </span><span class="kobospan" id="kobo.550.2">Let’s learn how to check CPU usage with the different monitoring tools. </span><span class="kobospan" id="kobo.550.3">Follow </span><span><span class="kobospan" id="kobo.551.1">these steps:</span></span></p>
<ol class="calibre13">
<li class="calibre14"><span class="kobospan" id="kobo.552.1">Use the </span><strong class="source-inline1"><span class="kobospan" id="kobo.553.1">ps</span></strong><span class="kobospan" id="kobo.554.1"> command to list the processes with the highest </span><span><span class="kobospan" id="kobo.555.1">CPU usage:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.556.1">
# </span><strong class="bold1"><span class="kobospan1" id="kobo.557.1">ps ax --format pid,%cpu,cmd --sort -%cpu</span></strong></pre></li> </ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer446">
<span class="kobospan" id="kobo.558.1"><img alt="Figure 11.12 – Output of the ps command listing the processes with the highest CPU usage" src="image/B19121_11_12.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.559.1">Figure 11.12 – Output of the ps command listing the processes with the highest CPU usage</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.560.1">This mode of the </span><strong class="source-inline"><span class="kobospan" id="kobo.561.1">ps ax</span></strong><span class="kobospan" id="kobo.562.1"> command formats the output by process identifier (</span><strong class="source-inline"><span class="kobospan" id="kobo.563.1">pid</span></strong><span class="kobospan" id="kobo.564.1">), percentage of CPU usage, and the command that started the process, sorting by the percentage of </span><span><span class="kobospan" id="kobo.565.1">CPU usage.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.566.1">The output shows that the process with the highest CPU usage is SSH, which should be considered normal for </span><span><span class="kobospan" id="kobo.567.1">administrative tasks.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.568.1">In our system, a web server is running. </span><span class="kobospan" id="kobo.568.2">Let’s analyze its </span><span><span class="kobospan" id="kobo.569.1">CPU usage.</span></span></p>
<ol class="calibre13">
<li value="2" class="calibre14"><span class="kobospan" id="kobo.570.1">Use the </span><strong class="source-inline1"><span class="kobospan" id="kobo.571.1">ps</span></strong><span class="kobospan" id="kobo.572.1"> command to</span><a id="_idIndexMarker895" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.573.1"> identify the </span><strong class="source-inline1"><span class="kobospan" id="kobo.574.1">httpd</span></strong><span class="kobospan" id="kobo.575.1"> process and its </span><span><span class="kobospan" id="kobo.576.1">CPU usage:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.577.1">
# </span><strong class="bold1"><span class="kobospan1" id="kobo.578.1">ps auxf | grep "[h]ttpd"</span></strong><span class="kobospan1" id="kobo.579.1">
# </span><strong class="bold1"><span class="kobospan1" id="kobo.580.1">ps ax --format pid,%cpu,cmd --sort -%cpu | grep "[h]ttpd"</span></strong></pre></li> </ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer447">
<span class="kobospan" id="kobo.581.1"><img alt="Figure 11.13 – Identifying the httpd process and its CPU usage" src="image/B19121_11_13.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.582.1">Figure 11.13 – Identifying the httpd process and its CPU usage</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.583.1">Note</span></p>
<p class="callout"><span class="kobospan" id="kobo.584.1">Enclosing the first character of the process in square brackets limits the search, ignoring the </span><strong class="source-inline1"><span class="kobospan" id="kobo.585.1">grep</span></strong><span class="kobospan" id="kobo.586.1"> command itself at </span><span><span class="kobospan" id="kobo.587.1">the output.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.588.1">Note that the CPU usage displayed is not significant, so further research needs to focus on finding the real value of </span><span><span class="kobospan" id="kobo.589.1">CPU usage.</span></span></p>
<ol class="calibre13">
<li value="3" class="calibre14"><span class="kobospan" id="kobo.590.1">Use the process identifier (</span><strong class="source-inline1"><span class="kobospan" id="kobo.591.1">pid</span></strong><span class="kobospan" id="kobo.592.1">) to find the resource usage with the </span><span><strong class="source-inline1"><span class="kobospan" id="kobo.593.1">top</span></strong></span><span><span class="kobospan" id="kobo.594.1"> command:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.595.1">
# </span><strong class="bold1"><span class="kobospan1" id="kobo.596.1">top -p 851,876,881,910</span></strong></pre></li> </ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer448">
<span class="kobospan" id="kobo.597.1"><img alt="Figure 11.14 – Monitoring resource usage with the top command" src="image/B19121_11_14.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.598.1">Figure 11.14 – Monitoring resource usage with the top command</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.599.1">Now, let’s use the utility included in the </span><strong class="source-inline"><span class="kobospan" id="kobo.600.1">sysstat</span></strong><span class="kobospan" id="kobo.601.1"> package to get more information about the </span><span><span class="kobospan" id="kobo.602.1">process’s performance.</span></span></p>
<ol class="calibre13">
<li value="4" class="calibre14"><span class="kobospan" id="kobo.603.1">Use the </span><strong class="source-inline1"><span class="kobospan" id="kobo.604.1">pidstat</span></strong><span class="kobospan" id="kobo.605.1"> command with the process identifier (</span><strong class="source-inline1"><span class="kobospan" id="kobo.606.1">pid</span></strong><span class="kobospan" id="kobo.607.1">) to get the CPU usage of the process </span><a id="_idIndexMarker896" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.608.1">at the </span><span><em class="italic"><span class="kobospan" id="kobo.609.1">1-second interval</span></em></span><span><span class="kobospan" id="kobo.610.1">:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.611.1">
# </span><strong class="bold1"><span class="kobospan1" id="kobo.612.1">pidstat -p 851,876,881,910 1 1</span></strong></pre></li> </ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer449">
<span class="kobospan" id="kobo.613.1"><img alt="Figure 11.15 – Process CPU usage percentage" src="image/B19121_11_15.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.614.1">Figure 11.15 – Process CPU usage percentage</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.615.1">A single CPU can only run </span><em class="italic"><span class="kobospan" id="kobo.616.1">one process at a time</span></em><span class="kobospan" id="kobo.617.1">. </span><span class="kobospan" id="kobo.617.2">To make the Linux system run multiple processes simultaneously, through multitasking, processes interleave their running on </span><span><span class="kobospan" id="kobo.618.1">the CPU.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.619.1">The kernel uses the </span><em class="italic"><span class="kobospan" id="kobo.620.1">process scheduler</span></em><span class="kobospan" id="kobo.621.1"> to determine which process to run at any given time. </span><span class="kobospan" id="kobo.621.2">The process scheduler must balance several options, based on certain criteria, such as determining which process gets the next turn of execution, getting a fair share of CPU time but allowing high-priority processes a larger share and preempting lower-priority processes, or being predictable and scalable under different </span><span><span class="kobospan" id="kobo.622.1">workload conditions.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.623.1">The scheduler controls the order of running based on the scheduling priority policy assigned to each thread or process. </span><span class="kobospan" id="kobo.623.2">These </span><a id="_idIndexMarker897" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.624.1">scheduling policies are divided into</span><a id="_idIndexMarker898" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.625.1"> two groups: </span><strong class="bold"><span class="kobospan" id="kobo.626.1">non-real-time policies</span></strong><span class="kobospan" id="kobo.627.1"> and </span><span><strong class="bold"><span class="kobospan" id="kobo.628.1">real-time policies</span></strong></span><span><span class="kobospan" id="kobo.629.1">.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.630.1">Note</span></p>
<p class="callout"><strong class="bold"><span class="kobospan" id="kobo.631.1">Real-time computing</span></strong><span class="kobospan" id="kobo.632.1"> (</span><strong class="bold"><span class="kobospan" id="kobo.633.1">RTC</span></strong><span class="kobospan" id="kobo.634.1">) guarantees</span><a id="_idIndexMarker899" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.635.1"> the response of a system from the event to the response itself, within specified time constraints. </span><span class="kobospan" id="kobo.635.2">A </span><em class="italic"><span class="kobospan" id="kobo.636.1">real-time system</span></em><span class="kobospan" id="kobo.637.1"> describes a system that controls an environment. </span><span class="kobospan" id="kobo.637.2">It receives data, processes it, and returns the results fast enough to affect the environment at </span><span><span class="kobospan" id="kobo.638.1">that time.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.639.1">The priority of the process </span><a id="_idIndexMarker900" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.640.1">using real-time policies is a value between </span><strong class="source-inline"><span class="kobospan" id="kobo.641.1">1</span></strong><span class="kobospan" id="kobo.642.1"> (</span><em class="italic"><span class="kobospan" id="kobo.643.1">lowest</span></em><span class="kobospan" id="kobo.644.1">) and </span><strong class="source-inline"><span class="kobospan" id="kobo.645.1">99</span></strong><span class="kobospan" id="kobo.646.1"> (</span><em class="italic"><span class="kobospan" id="kobo.647.1">highest</span></em><span class="kobospan" id="kobo.648.1">) and is known as a </span><strong class="bold"><span class="kobospan" id="kobo.649.1">static priority</span></strong><span class="kobospan" id="kobo.650.1">. </span><span class="kobospan" id="kobo.650.2">Processes</span><a id="_idIndexMarker901" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.651.1"> using non-real-time policies that do not use static priorities are set </span><span><span class="kobospan" id="kobo.652.1">to </span></span><span><strong class="source-inline"><span class="kobospan" id="kobo.653.1">0</span></strong></span><span><span class="kobospan" id="kobo.654.1">.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.655.1">The priority of the process could </span><em class="italic"><span class="kobospan" id="kobo.656.1">increase</span></em><span class="kobospan" id="kobo.657.1"> and </span><em class="italic"><span class="kobospan" id="kobo.658.1">decrease</span></em><span class="kobospan" id="kobo.659.1"> during the lifetime of the process; this is known as</span><a id="_idIndexMarker902" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.660.1"> the </span><strong class="bold"><span class="kobospan" id="kobo.661.1">dynamic priority</span></strong><span class="kobospan" id="kobo.662.1">. </span><span class="kobospan" id="kobo.662.2">The value for determining which non-real-time process takes precedence over other non-real-time processes comes under the </span><a id="_idIndexMarker903" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.663.1">name of </span><strong class="bold"><span class="kobospan" id="kobo.664.1">nice value</span></strong><span class="kobospan" id="kobo.665.1">. </span><span class="kobospan" id="kobo.665.2">A user could change the priority of a process by using the </span><strong class="source-inline"><span class="kobospan" id="kobo.666.1">nice</span></strong><span class="kobospan" id="kobo.667.1"> or </span><span><strong class="source-inline"><span class="kobospan" id="kobo.668.1">renice</span></strong></span><span><span class="kobospan" id="kobo.669.1"> commands.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.670.1">Since the static priority of non-real-time processes is set to </span><strong class="source-inline"><span class="kobospan" id="kobo.671.1">0</span></strong><span class="kobospan" id="kobo.672.1">, the nice value determines the </span><em class="italic"><span class="kobospan" id="kobo.673.1">relative scheduling</span></em><span class="kobospan" id="kobo.674.1"> of non-real-time processes. </span><span class="kobospan" id="kobo.674.2">The nice value ranges from </span><strong class="source-inline"><span class="kobospan" id="kobo.675.1">-20</span></strong><span class="kobospan" id="kobo.676.1"> (</span><em class="italic"><span class="kobospan" id="kobo.677.1">highest</span></em><span class="kobospan" id="kobo.678.1">) to </span><span><strong class="source-inline"><span class="kobospan" id="kobo.679.1">19</span></strong></span><span><span class="kobospan" id="kobo.680.1"> (</span></span><span><em class="italic"><span class="kobospan" id="kobo.681.1">lowest</span></em></span><span><span class="kobospan" id="kobo.682.1">).</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.683.1">Fedora Linux provides six scheduling policies divided into two groups: </span><strong class="source-inline"><span class="kobospan" id="kobo.684.1">real-time</span></strong><span class="kobospan" id="kobo.685.1"> and </span><strong class="source-inline"><span class="kobospan" id="kobo.686.1">non-real-time</span></strong><span class="kobospan" id="kobo.687.1"> scheduling classes. </span><span class="kobospan" id="kobo.687.2">The following table lists the policies available in each </span><span><span class="kobospan" id="kobo.688.1">scheduling class:</span></span></p>
<table class="no-table-style" id="table003-1">
<colgroup class="calibre10">
<col class="calibre11"/>
<col class="calibre11"/>
<col class="calibre11"/>
</colgroup>
<tbody class="calibre12">
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span><strong class="bold"><span class="kobospan" id="kobo.689.1">Class</span></strong></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span><strong class="bold"><span class="kobospan" id="kobo.690.1">Policies</span></strong></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span><strong class="bold"><span class="kobospan" id="kobo.691.1">Definition</span></strong></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2" rowspan="2">
<p class="calibre3"><span><span class="kobospan" id="kobo.692.1">Real-time scheduler</span></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span><strong class="source-inline"><span class="kobospan" id="kobo.693.1">SCHED_FIFO</span></strong></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span class="kobospan" id="kobo.694.1">Uses the </span><em class="italic"><span class="kobospan" id="kobo.695.1">first-in</span></em><span class="kobospan" id="kobo.696.1">, </span><em class="italic"><span class="kobospan" id="kobo.697.1">first-out</span></em><span class="kobospan" id="kobo.698.1"> scheduling algorithm </span><span><span class="kobospan" id="kobo.699.1">without timeslices.</span></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span><strong class="source-inline"><span class="kobospan" id="kobo.700.1">SCHED_RR</span></strong></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span class="kobospan" id="kobo.701.1">Uses the </span><em class="italic"><span class="kobospan" id="kobo.702.1">round-robin</span></em><span class="kobospan" id="kobo.703.1"> scheduling algorithm </span><span><span class="kobospan" id="kobo.704.1">with timeslices.</span></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2" rowspan="3">
<p class="calibre3"><strong class="bold"><span class="kobospan" id="kobo.705.1">Completely Fair </span></strong><span><strong class="bold"><span class="kobospan" id="kobo.706.1">Scheduler</span></strong></span><span><span class="kobospan" id="kobo.707.1"> (</span></span><span><strong class="bold"><span class="kobospan" id="kobo.708.1">CFS</span></strong></span><span><span class="kobospan" id="kobo.709.1">)</span></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><strong class="source-inline"><span class="kobospan" id="kobo.710.1">SCHED_NORMAL</span></strong><span class="kobospan" id="kobo.711.1"> (</span><em class="italic"><span class="kobospan" id="kobo.712.1">also known </span></em><span><em class="italic"><span class="kobospan" id="kobo.713.1">as</span></em></span><span> </span><span><strong class="source-inline"><span class="kobospan" id="kobo.714.1">SCHED_OTHER</span></strong></span><span><span class="kobospan" id="kobo.715.1">)</span></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span class="kobospan" id="kobo.716.1">Defines the </span><em class="italic"><span class="kobospan" id="kobo.717.1">round-robin</span></em><span class="kobospan" id="kobo.718.1"> style </span><span><span class="kobospan" id="kobo.719.1">time-sharing schedule.</span></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span><strong class="source-inline"><span class="kobospan" id="kobo.720.1">SCHED_BATCH</span></strong></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span class="kobospan" id="kobo.721.1">Benefits </span><span><em class="italic"><span class="kobospan" id="kobo.722.1">batch-oriented</span></em></span><span><span class="kobospan" id="kobo.723.1"> workloads.</span></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span><strong class="source-inline"><span class="kobospan" id="kobo.724.1">SCHED_IDLE</span></strong></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span class="kobospan" id="kobo.725.1">Benefits running </span><span><span class="kobospan" id="kobo.726.1">low-priority applications.</span></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span><span class="kobospan" id="kobo.727.1">Deadline scheduler</span></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span><strong class="source-inline"><span class="kobospan" id="kobo.728.1">SCHED_DEADLINE</span></strong></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span class="kobospan" id="kobo.729.1">The scheduler guarantees real-time task scheduling, even under high load conditions. </span><span class="kobospan" id="kobo.729.2">It does so by using three parameters – </span><strong class="source-inline"><span class="kobospan" id="kobo.730.1">period</span></strong><span class="kobospan" id="kobo.731.1">, </span><strong class="source-inline"><span class="kobospan" id="kobo.732.1">deadline</span></strong><span class="kobospan" id="kobo.733.1">, and </span><strong class="source-inline"><span class="kobospan" id="kobo.734.1">runtime</span></strong><span class="kobospan" id="kobo.735.1"> – to define a task </span><span><span class="kobospan" id="kobo.736.1">in nanoseconds.</span></span></p>
</td>
</tr>
</tbody>
</table>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.737.1">Table 11.3 – Scheduling policies</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.738.1">Let’s continue using the </span><a id="_idIndexMarker904" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.739.1">previous example of the web server to analyze the priority of its process. </span><span class="kobospan" id="kobo.739.2">Follow </span><span><span class="kobospan" id="kobo.740.1">these steps:</span></span></p>
<ol class="calibre13">
<li class="calibre14"><span class="kobospan" id="kobo.741.1">Use the </span><strong class="source-inline1"><span class="kobospan" id="kobo.742.1">ps</span></strong><span class="kobospan" id="kobo.743.1"> command to list the priority </span><span><span class="kobospan" id="kobo.744.1">of processes:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.745.1">
# </span><strong class="bold1"><span class="kobospan1" id="kobo.746.1">ps axo pid,pri,rtprio,ni,cls,comm | grep -e "PID" -e "[h]ttpd"</span></strong></pre></li> </ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer450">
<span class="kobospan" id="kobo.747.1"><img alt="Figure 11.16 – Reviewing process priority" src="image/B19121_11_16.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.748.1">Figure 11.16 – Reviewing process priority</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.749.1">Here, the </span><strong class="source-inline"><span class="kobospan" id="kobo.750.1">pri</span></strong><span class="kobospan" id="kobo.751.1"> column shows </span><strong class="bold"><span class="kobospan" id="kobo.752.1">static priority</span></strong><span class="kobospan" id="kobo.753.1"> (</span><strong class="source-inline"><span class="kobospan" id="kobo.754.1">19</span></strong><span class="kobospan" id="kobo.755.1">), the </span><strong class="source-inline"><span class="kobospan" id="kobo.756.1">rtprio</span></strong><span class="kobospan" id="kobo.757.1"> column shows real time priority (</span><strong class="source-inline"><span class="kobospan" id="kobo.758.1">-</span></strong><span class="kobospan" id="kobo.759.1">), the </span><strong class="source-inline"><span class="kobospan" id="kobo.760.1">ni</span></strong><span class="kobospan" id="kobo.761.1"> column shows </span><strong class="bold"><span class="kobospan" id="kobo.762.1">nice value</span></strong><span class="kobospan" id="kobo.763.1"> (</span><strong class="source-inline"><span class="kobospan" id="kobo.764.1">0</span></strong><span class="kobospan" id="kobo.765.1">), and the </span><strong class="source-inline"><span class="kobospan" id="kobo.766.1">cls</span></strong><span class="kobospan" id="kobo.767.1"> column shows the </span><strong class="bold"><span class="kobospan" id="kobo.768.1">scheduling policy</span></strong><span class="kobospan" id="kobo.769.1">. </span><span class="kobospan" id="kobo.769.2">Here, </span><strong class="source-inline"><span class="kobospan" id="kobo.770.1">TS</span></strong> <span><span class="kobospan" id="kobo.771.1">represents </span></span><span><strong class="bold"><span class="kobospan" id="kobo.772.1">time-sharing</span></strong></span><span><span class="kobospan" id="kobo.773.1">.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.774.1">The preceding output indicates that the process has low priority in its run. </span><span class="kobospan" id="kobo.774.2">Let’s </span><span><span class="kobospan" id="kobo.775.1">change this.</span></span></p>
<ol class="calibre13">
<li value="2" class="calibre14"><span class="kobospan" id="kobo.776.1">Use the </span><strong class="source-inline1"><span class="kobospan" id="kobo.777.1">chrt</span></strong><span class="kobospan" id="kobo.778.1"> command to</span><a id="_idIndexMarker905" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.779.1"> display the scheduling policy and priority of the web </span><span><span class="kobospan" id="kobo.780.1">server processes:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.781.1">
# </span><strong class="bold1"><span class="kobospan1" id="kobo.782.1">chrt -p [PID]</span></strong></pre></li> </ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer451">
<span class="kobospan" id="kobo.783.1"><img alt="Figure 11.17 – Scheduling the policy and priority of web server processes" src="image/B19121_11_17.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.784.1">Figure 11.17 – Scheduling the policy and priority of web server processes</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.785.1">The scheduled priority of all processes is </span><strong class="source-inline"><span class="kobospan" id="kobo.786.1">0</span></strong><span class="kobospan" id="kobo.787.1"> and their scheduling policy is </span><strong class="source-inline"><span class="kobospan" id="kobo.788.1">SCHED_NORMAL</span></strong><span class="kobospan" id="kobo.789.1"> (or </span><strong class="source-inline"><span class="kobospan" id="kobo.790.1">SCHED_OTHER</span></strong><span class="kobospan" id="kobo.791.1">). </span><span class="kobospan" id="kobo.791.2">Let’s improve the </span><span><span class="kobospan" id="kobo.792.1">process run.</span></span></p>
<ol class="calibre13">
<li value="3" class="calibre14"><span class="kobospan" id="kobo.793.1">Stop the web server service and restart it by changing the scheduled policy to </span><strong class="source-inline1"><span class="kobospan" id="kobo.794.1">SCHED_FIFO</span></strong><span class="kobospan" id="kobo.795.1"> and the scheduled priority to </span><strong class="source-inline1"><span class="kobospan" id="kobo.796.1">38</span></strong><span class="kobospan" id="kobo.797.1">. </span><span class="kobospan" id="kobo.797.2">Use the </span><strong class="source-inline1"><span class="kobospan" id="kobo.798.1">chrt</span></strong><span class="kobospan" id="kobo.799.1"> command and the </span><span><span class="kobospan" id="kobo.800.1">process binary:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.801.1">
# </span><strong class="bold1"><span class="kobospan1" id="kobo.802.1">systemctl stop httpd</span></strong><span class="kobospan1" id="kobo.803.1">
# </span><strong class="bold1"><span class="kobospan1" id="kobo.804.1">chrt -f 38 /usr/sbin/httpd</span></strong></pre></li> </ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer452">
<span class="kobospan" id="kobo.805.1"><img alt="Figure 11.18 – Changing the scheduling policy and priority" src="image/B19121_11_18.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.806.1">Figure 11.18 – Changing the scheduling policy and priority</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.807.1">Review the scheduling </span><a id="_idIndexMarker906" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.808.1">policy and priority of the web </span><span><span class="kobospan" id="kobo.809.1">server processes.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.810.1">Note</span></p>
<p class="callout"><span class="kobospan" id="kobo.811.1">For more information about the </span><strong class="source-inline1"><span class="kobospan" id="kobo.812.1">chrt</span></strong><span class="kobospan" id="kobo.813.1"> command’s options, refer to the manual pages by running the </span><strong class="source-inline1"><span class="kobospan" id="kobo.814.1">man </span></strong><span><strong class="source-inline1"><span class="kobospan" id="kobo.815.1">chrt</span></strong></span><span><span class="kobospan" id="kobo.816.1"> command.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.817.1">This change is temporary. </span><span class="kobospan" id="kobo.817.2">When the process restarts, the scheduled policy and scheduled priority should </span><span><span class="kobospan" id="kobo.818.1">apply again.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.819.1">To set a scheduled policy and priority to improve the performance of the process each time it starts, it must be added to the service’s </span><span><strong class="source-inline"><span class="kobospan" id="kobo.820.1">unit</span></strong></span><span><span class="kobospan" id="kobo.821.1"> file.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.822.1">Let’s </span><span><span class="kobospan" id="kobo.823.1">do it.</span></span></p>
<ol class="calibre13">
<li value="4" class="calibre14"><span class="kobospan" id="kobo.824.1">Create a scheduled configuration file for the </span><strong class="source-inline1"><span class="kobospan" id="kobo.825.1">httpd</span></strong><span class="kobospan" id="kobo.826.1"> service with the </span><span><span class="kobospan" id="kobo.827.1">following content:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.828.1">
# </span><strong class="bold1"><span class="kobospan1" id="kobo.829.1">vim /etc/systemd/system/httpd.service.d/10-scheduler.conf</span></strong><span class="kobospan1" id="kobo.830.1">
[Service]
CPUSchedulingPolicy=rr
CPUSchedulingPriority=10</span></pre></li> </ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer453">
<span class="kobospan" id="kobo.831.1"><img alt="Figure 11.19 – Creating the service configuration file" src="image/B19121_11_19.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.832.1">Figure 11.19 – Creating the service configuration file</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.833.1">Unit configuration </span><a id="_idIndexMarker907" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.834.1">policies are set to change the priority of a service during the boot process. </span><span class="kobospan" id="kobo.834.2">The directives in the </span><strong class="source-inline"><span class="kobospan" id="kobo.835.1">[Service]</span></strong><span class="kobospan" id="kobo.836.1"> section change the scheduling policy </span><span><span class="kobospan" id="kobo.837.1">and priority:</span></span></p>
<ul class="calibre15">
<li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.838.1">CPUSchedulingPriority</span></strong><span class="kobospan" id="kobo.839.1"> (</span><strong class="bold"><span class="kobospan" id="kobo.840.1">Nice</span></strong><span class="kobospan" id="kobo.841.1">): Sets the default </span><strong class="source-inline1"><span class="kobospan" id="kobo.842.1">nice</span></strong><span class="kobospan" id="kobo.843.1"> level for the service. </span><span class="kobospan" id="kobo.843.2">The </span><em class="italic"><span class="kobospan" id="kobo.844.1">nice</span></em><span class="kobospan" id="kobo.845.1"> level is set as a number between </span><strong class="source-inline1"><span class="kobospan" id="kobo.846.1">-20</span></strong><span class="kobospan" id="kobo.847.1"> (</span><em class="italic"><span class="kobospan" id="kobo.848.1">highest priority</span></em><span class="kobospan" id="kobo.849.1">) and </span><strong class="source-inline1"><span class="kobospan" id="kobo.850.1">19</span></strong><span class="kobospan" id="kobo.851.1"> (</span><span><em class="italic"><span class="kobospan" id="kobo.852.1">lowest priority</span></em></span><span><span class="kobospan" id="kobo.853.1">).</span></span></li>
<li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.854.1">CPUSchedulingPolicy</span></strong><span class="kobospan" id="kobo.855.1">: Sets the </span><strong class="source-inline1"><span class="kobospan" id="kobo.856.1">CPU</span></strong><span class="kobospan" id="kobo.857.1"> scheduling policy for the service. </span><span class="kobospan" id="kobo.857.2">The policy is set with the </span><strong class="source-inline1"><span class="kobospan" id="kobo.858.1">other</span></strong><span class="kobospan" id="kobo.859.1">, </span><strong class="source-inline1"><span class="kobospan" id="kobo.860.1">batch</span></strong><span class="kobospan" id="kobo.861.1">, </span><strong class="source-inline1"><span class="kobospan" id="kobo.862.1">idle</span></strong><span class="kobospan" id="kobo.863.1">, </span><strong class="source-inline1"><span class="kobospan" id="kobo.864.1">fifo</span></strong><span class="kobospan" id="kobo.865.1">, and </span><span><strong class="source-inline1"><span class="kobospan" id="kobo.866.1">rr</span></strong></span><span><span class="kobospan" id="kobo.867.1"> values.</span></span></li>
</ul>
<p class="calibre3"><span class="kobospan" id="kobo.868.1">Note</span></p>
<p class="callout"><span class="kobospan" id="kobo.869.1">At the time of writing, the </span><strong class="source-inline1"><span class="kobospan" id="kobo.870.1">CPUSchedulingPolicy </span></strong><span class="kobospan" id="kobo.871.1">variable does not support the </span><strong class="source-inline1"><span class="kobospan" id="kobo.872.1">SCHED_DEADLINE</span></strong> <span><span class="kobospan" id="kobo.873.1">policy setting.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.874.1">Reload the configuration of the services that were loaded in by </span><strong class="source-inline"><span class="kobospan" id="kobo.875.1">systemd</span></strong><span class="kobospan" id="kobo.876.1"> before restarting the web server service. </span><span class="kobospan" id="kobo.876.2">Use the </span><span><strong class="source-inline"><span class="kobospan" id="kobo.877.1">systemctl</span></strong></span><span><span class="kobospan" id="kobo.878.1"> command:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.879.1">
# </span><strong class="bold1"><span class="kobospan1" id="kobo.880.1">systemctl daemon-reload</span></strong></pre> <p class="calibre3"><span class="kobospan" id="kobo.881.1">Restart the service to apply the policy and </span><span><span class="kobospan" id="kobo.882.1">priority changes.</span></span></p>
<ol class="calibre13">
<li value="5" class="calibre14"><span class="kobospan" id="kobo.883.1">Use the </span><strong class="source-inline1"><span class="kobospan" id="kobo.884.1">systemctl</span></strong><span class="kobospan" id="kobo.885.1"> command to restart the web </span><span><span class="kobospan" id="kobo.886.1">server service:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.887.1">
# </span><strong class="bold1"><span class="kobospan1" id="kobo.888.1">systemctl restart httpd</span></strong></pre></li> </ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer454">
<span class="kobospan" id="kobo.889.1"><img alt="Figure 11.20 – Restarting the web server service" src="image/B19121_11_20.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.890.1">Figure 11.20 – Restarting the web server service</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.891.1">Review the scheduling </span><a id="_idIndexMarker908" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.892.1">policy and priority of the web </span><span><span class="kobospan" id="kobo.893.1">server processes.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.894.1">The change of priority and scheduled policy should apply when the service starts. </span><span class="kobospan" id="kobo.894.2">This change improves the performance of </span><span><span class="kobospan" id="kobo.895.1">the service.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.896.1">What we’ve covered here applies to the case of processing. </span><span class="kobospan" id="kobo.896.2">Now, let’s learn how to improve </span><span><span class="kobospan" id="kobo.897.1">memory usage.</span></span></p>
<h2 id="_idParaDest-169" class="calibre7"><a id="_idTextAnchor234" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.898.1">Improving memory usage</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.899.1">The </span><strong class="source-inline"><span class="kobospan" id="kobo.900.1">ps</span></strong><span class="kobospan" id="kobo.901.1"> and </span><strong class="source-inline"><span class="kobospan" id="kobo.902.1">top</span></strong><span class="kobospan" id="kobo.903.1"> utilities differentiate </span><a id="_idIndexMarker909" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.904.1">between two statistics: </span><strong class="source-inline"><span class="kobospan" id="kobo.905.1">VIRT</span></strong><span class="kobospan" id="kobo.906.1"> (or </span><strong class="source-inline"><span class="kobospan" id="kobo.907.1">VSZ</span></strong><span class="kobospan" id="kobo.908.1">), the total amount of virtual memory a process has requested, and </span><strong class="source-inline"><span class="kobospan" id="kobo.909.1">RES</span></strong><span class="kobospan" id="kobo.910.1"> (or </span><strong class="source-inline"><span class="kobospan" id="kobo.911.1">RSS</span></strong><span class="kobospan" id="kobo.912.1">), the total amount of virtual memory a process is currently mapping into physical memory. </span><strong class="source-inline"><span class="kobospan" id="kobo.913.1">RSS</span></strong><span class="kobospan" id="kobo.914.1"> is the most </span><span><span class="kobospan" id="kobo.915.1">critical value.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.916.1">Using the preceding example, observe the virtual memory value mapped to the web server process with the </span><span><strong class="source-inline"><span class="kobospan" id="kobo.917.1">ps</span></strong></span><span><span class="kobospan" id="kobo.918.1"> command:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.919.1">
# </span><strong class="bold1"><span class="kobospan1" id="kobo.920.1">ps -o pid,vsz,rss,comm -C httpd</span></strong></pre> <div class="calibre2">
<div class="img---figure" id="_idContainer455">
<span class="kobospan" id="kobo.921.1"><img alt="Figure 11.21 – Reviewing the virtual memory mapped to the web server" src="image/B19121_11_21.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.922.1">Figure 11.21 – Reviewing the virtual memory mapped to the web server</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.923.1">When a process requests memory, virtual memory addresses get reserved, but the kernel doesn’t allocate them to physical page frames. </span><span class="kobospan" id="kobo.923.2">The kernel only allocates physical page frames when the process starts </span><span><span class="kobospan" id="kobo.924.1">using </span></span><span><strong class="source-inline"><span class="kobospan" id="kobo.925.1">memory</span></strong></span><span><span class="kobospan" id="kobo.926.1">.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.927.1">In the same way that the priority and scheduled policy are changed for processing, the memory that an application consumes </span><span><span class="kobospan" id="kobo.928.1">could change.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.929.1">Follow this step to adjust the </span><strong class="source-inline"><span class="kobospan" id="kobo.930.1">MemoryLimit</span></strong><span class="kobospan" id="kobo.931.1"> parameter of the </span><span><strong class="source-inline"><span class="kobospan" id="kobo.932.1">sshd</span></strong></span><span><span class="kobospan" id="kobo.933.1"> process:</span></span></p>
<ol class="calibre13">
<li class="calibre14"><span class="kobospan" id="kobo.934.1">Using the </span><strong class="source-inline1"><span class="kobospan" id="kobo.935.1">sysctl</span></strong><span class="kobospan" id="kobo.936.1"> command, adjust the </span><span><strong class="source-inline1"><span class="kobospan" id="kobo.937.1">MemoryLimit</span></strong></span><span><span class="kobospan" id="kobo.938.1"> parameter:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.939.1">
# </span><strong class="bold1"><span class="kobospan1" id="kobo.940.1">systemctl set-property sshd.service MemoryLimit=1G</span></strong></pre></li> </ol>
<p class="calibre3"><span class="kobospan" id="kobo.941.1">Note</span></p>
<p class="callout"><span class="kobospan" id="kobo.942.1">A memory size can be specified in kilobytes, megabytes, gigabytes, or terabytes using the </span><strong class="source-inline1"><span class="kobospan" id="kobo.943.1">K</span></strong><span class="kobospan" id="kobo.944.1">, </span><strong class="source-inline1"><span class="kobospan" id="kobo.945.1">M</span></strong><span class="kobospan" id="kobo.946.1">, </span><strong class="source-inline1"><span class="kobospan" id="kobo.947.1">G</span></strong><span class="kobospan" id="kobo.948.1">, or </span><strong class="source-inline1"><span class="kobospan" id="kobo.949.1">T</span></strong> <span><span class="kobospan" id="kobo.950.1">suffix, respectively.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.951.1">This command changes the service startup </span><span><span class="kobospan" id="kobo.952.1">configuration file.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.953.1">Use the </span><strong class="source-inline"><span class="kobospan" id="kobo.954.1">sysctl</span></strong><span class="kobospan" id="kobo.955.1"> command to display the service unit file. </span><span class="kobospan" id="kobo.955.2">Filter the </span><span><strong class="source-inline"><span class="kobospan" id="kobo.956.1">Memory</span></strong></span><span><span class="kobospan" id="kobo.957.1"> parameter:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer456">
<span class="kobospan" id="kobo.958.1"><img alt="Figure 11.22 – Reviewing the MemoryLimit parameter" src="image/B19121_11_22.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.959.1">Figure 11.22 – Reviewing the MemoryLimit parameter</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.960.1">In </span><span><em class="italic"><span class="kobospan" id="kobo.961.1">Figure 11</span></em></span><em class="italic"><span class="kobospan" id="kobo.962.1">.22</span></em><span class="kobospan" id="kobo.963.1">, we find that the kernel assigned the service 10 MB of memory and, by setting the </span><strong class="source-inline"><span class="kobospan" id="kobo.964.1">MemoryLimit</span></strong><span class="kobospan" id="kobo.965.1"> parameter, ensures that it only uses up to </span><span><span class="kobospan" id="kobo.966.1">1 GB.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.967.1">Keeping control of the resources assigned to the services allows them to improve their performance and that of the operating system </span><span><span class="kobospan" id="kobo.968.1">as well.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.969.1">Managing unallocated memory is the task that requires the most intense monitoring in Linux. </span><span class="kobospan" id="kobo.969.2">The kernel uses most of the unallocated memory as a cache to store data that gets read from or written </span><a id="_idIndexMarker910" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.970.1">to disk. </span><span class="kobospan" id="kobo.970.2">The next time a process needs that data, the system fetches it from RAM instead of disk. </span><span class="kobospan" id="kobo.970.3">The caching mechanism improves performance in general since storage is usually much slower than </span><span><span class="kobospan" id="kobo.971.1">physical memory.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.972.1">Besides cache pages, the system uses anonymous pages. </span><span class="kobospan" id="kobo.972.2">Anonymous pages have no data associated with them on disk. </span><span class="kobospan" id="kobo.972.3">These anonymous pages represent the pages that processes allocate and use to store their </span><span><span class="kobospan" id="kobo.973.1">work data.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.974.1">We have different tools and utilities that help us </span><span><span class="kobospan" id="kobo.975.1">monitor both.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.976.1">Let’s have a brief overview of these tools </span><span><span class="kobospan" id="kobo.977.1">and utilities.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.978.1">Inspect the memory usage with the </span><strong class="source-inline"><span class="kobospan" id="kobo.979.1">free</span></strong><span class="kobospan" id="kobo.980.1"> and </span><span><strong class="source-inline"><span class="kobospan" id="kobo.981.1">vmstat</span></strong></span><span><span class="kobospan" id="kobo.982.1"> commands:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.983.1">
# </span><strong class="bold1"><span class="kobospan1" id="kobo.984.1">free –m</span></strong></pre> <div class="calibre2">
<div class="img---figure" id="_idContainer457">
<span class="kobospan" id="kobo.985.1"><img alt="Figure 11.23 – Output of the free command" src="image/B19121_11_23.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.986.1">Figure 11.23 – Output of the free command</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.987.1">In this system, there’s 8 GiB of RAM. </span><span class="kobospan" id="kobo.987.2">The cache pages (the </span><strong class="source-inline"><span class="kobospan" id="kobo.988.1">buff/cache</span></strong><span class="kobospan" id="kobo.989.1"> column) consume </span><span><span class="kobospan" id="kobo.990.1">1 GiB.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.991.1">Let’s compare this with the output of the </span><span><strong class="source-inline"><span class="kobospan" id="kobo.992.1">vmstat</span></strong></span><span><span class="kobospan" id="kobo.993.1"> command:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.994.1">
# </span><strong class="bold1"><span class="kobospan1" id="kobo.995.1">vmstat --unit M 1</span></strong></pre> <div class="calibre2">
<div class="img---figure" id="_idContainer458">
<span class="kobospan" id="kobo.996.1"><img alt="Figure 11.24 – Output of the vmstat command" src="image/B19121_11_24.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.997.1">Figure 11.24 – Output of the vmstat command</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.998.1">From the output of the </span><strong class="source-inline"><span class="kobospan" id="kobo.999.1">vmstat</span></strong><span class="kobospan" id="kobo.1000.1"> command, note</span><a id="_idIndexMarker911" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1001.1"> that the size of the page cache is the sum of the </span><strong class="source-inline"><span class="kobospan" id="kobo.1002.1">buff</span></strong><span class="kobospan" id="kobo.1003.1"> and </span><strong class="source-inline"><span class="kobospan" id="kobo.1004.1">cache</span></strong><span class="kobospan" id="kobo.1005.1"> columns. </span><span class="kobospan" id="kobo.1005.2">Buffers are part of the page cache. </span><span class="kobospan" id="kobo.1005.3">Buffers store blocks of data read </span><em class="italic"><span class="kobospan" id="kobo.1006.1">directly</span></em><span class="kobospan" id="kobo.1007.1"> from a block device, not from </span><span><span class="kobospan" id="kobo.1008.1">the filesystem.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1009.1">Anonymous pages get moved to the swap area when the system is under memory pressure. </span><span class="kobospan" id="kobo.1009.2">The kernel chooses between retrieving anonymous pages or pages from the page cache. </span><span class="kobospan" id="kobo.1009.3">The availability of swap increases the amount of </span><span><span class="kobospan" id="kobo.1010.1">effective memory.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1011.1">From the output of the </span><strong class="source-inline"><span class="kobospan" id="kobo.1012.1">vmstat</span></strong><span class="kobospan" id="kobo.1013.1"> command (</span><span><em class="italic"><span class="kobospan" id="kobo.1014.1">Figure 11</span></em></span><em class="italic"><span class="kobospan" id="kobo.1015.1">.24</span></em><span class="kobospan" id="kobo.1016.1">), in the </span><strong class="source-inline"><span class="kobospan" id="kobo.1017.1">swap</span></strong><span class="kobospan" id="kobo.1018.1"> section, we can see the values of the </span><span><span class="kobospan" id="kobo.1019.1">anonymous pages:</span></span></p>
<ul class="calibre15">
<li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.1020.1">si</span></strong><span class="kobospan" id="kobo.1021.1">: Pages </span><em class="italic"><span class="kobospan" id="kobo.1022.1">swapped in</span></em> <span><span class="kobospan" id="kobo.1023.1">per second</span></span></li>
<li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.1024.1">so</span></strong><span class="kobospan" id="kobo.1025.1">: Pages </span><em class="italic"><span class="kobospan" id="kobo.1026.1">swapped out</span></em> <span><span class="kobospan" id="kobo.1027.1">per second</span></span></li>
</ul>
<p class="calibre3"><span class="kobospan" id="kobo.1028.1">The </span><em class="italic"><span class="kobospan" id="kobo.1029.1">swap area</span></em><span class="kobospan" id="kobo.1030.1"> was a subject of discussion for many years. </span><span class="kobospan" id="kobo.1030.2">At the beginning of the computer era, several myths about how to calculate the swap area were created among system administrators from those days. </span><span class="kobospan" id="kobo.1030.3">They were not only taken as good practices but as a must-have during the creation of the swap area. </span><span class="kobospan" id="kobo.1030.4">This was because, in those days, physical storage </span><span><span class="kobospan" id="kobo.1031.1">was expensive.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1032.1">Nowadays, with new technologies, storage has become cheaper and more affordable. </span><span class="kobospan" id="kobo.1032.2">So, the creation of the swap area is considered under the use </span><span><span class="kobospan" id="kobo.1033.1">case criteria.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1034.1">Red Hat proposes the</span><a id="_idIndexMarker912" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1035.1"> following table as a basis for use cases for sizing when creating the </span><span><span class="kobospan" id="kobo.1036.1">swap area:</span></span></p>
<table class="no-table-style" id="table004-1">
<colgroup class="calibre10">
<col class="calibre11"/>
<col class="calibre11"/>
</colgroup>
<tbody class="calibre12">
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span><strong class="bold"><span class="kobospan" id="kobo.1037.1">RAM</span></strong></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span><strong class="bold"><span class="kobospan" id="kobo.1038.1">Swap Space</span></strong></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span class="kobospan" id="kobo.1039.1">2 GiB </span><span><span class="kobospan" id="kobo.1040.1">or less</span></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><em class="italic"><span class="kobospan" id="kobo.1041.1">Two times</span></em> <span><span class="kobospan" id="kobo.1042.1">the RAM</span></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span class="kobospan" id="kobo.1043.1">Between 2 GiB and </span><span><span class="kobospan" id="kobo.1044.1">8 GiB</span></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span class="kobospan" id="kobo.1045.1">Equal </span><span><span class="kobospan" id="kobo.1046.1">to RAM</span></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span class="kobospan" id="kobo.1047.1">Between 8 GiB and </span><span><span class="kobospan" id="kobo.1048.1">64 GiB</span></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span class="kobospan" id="kobo.1049.1">At least </span><span><span class="kobospan" id="kobo.1050.1">4 GiB</span></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span class="kobospan" id="kobo.1051.1">More than </span><span><span class="kobospan" id="kobo.1052.1">64 GiB</span></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span class="kobospan" id="kobo.1053.1">At least </span><span><span class="kobospan" id="kobo.1054.1">4 GiB</span></span></p>
</td>
</tr>
</tbody>
</table>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1055.1">Table 11.4 – Basic guidance on swap area sizing</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1056.1">Keep in mind that when a process requests memory, the kernel only reserves virtual memory and doesn’t consume any RAM. </span><span class="kobospan" id="kobo.1056.2">Since the kernel only allocates physical page frames when the process starts, this allows applications to allocate more memory than what’s available in the system. </span><span class="kobospan" id="kobo.1056.3">This feature function is called </span><span><span class="kobospan" id="kobo.1057.1">memory overcommitment.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1058.1">The memory overcommit policy of the system can be tuned using the </span><strong class="source-inline"><span class="kobospan" id="kobo.1059.1">sysctl</span></strong><span class="kobospan" id="kobo.1060.1"> variable, </span><strong class="source-inline"><span class="kobospan" id="kobo.1061.1">vm.overcommit_memory</span></strong><span class="kobospan" id="kobo.1062.1">. </span><span class="kobospan" id="kobo.1062.2">You can set it to one of the </span><span><span class="kobospan" id="kobo.1063.1">following values:</span></span></p>
<ul class="calibre15">
<li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.1064.1">0</span></strong><span class="kobospan" id="kobo.1065.1">: The kernel uses a </span><em class="italic"><span class="kobospan" id="kobo.1066.1">heuristic overcommit algorithm</span></em><span class="kobospan" id="kobo.1067.1">. </span><span class="kobospan" id="kobo.1067.2">This is the configured </span><span><span class="kobospan" id="kobo.1068.1">system default.</span></span></li>
<li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.1069.1">1</span></strong><span class="kobospan" id="kobo.1070.1">: The kernel </span><em class="italic"><span class="kobospan" id="kobo.1071.1">always</span></em><span class="kobospan" id="kobo.1072.1"> overcommits memory. </span><span class="kobospan" id="kobo.1072.2">It always grants memory allocations, regardless of whether there is enough </span><span><span class="kobospan" id="kobo.1073.1">free memory.</span></span></li>
<li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.1074.1">2</span></strong><span class="kobospan" id="kobo.1075.1">: The kernel strictly controls memory overcommitment. </span><span class="kobospan" id="kobo.1075.2">It only commits an amount of memory equal to the </span><em class="italic"><span class="kobospan" id="kobo.1076.1">amount of swap space plus a percentage</span></em><span class="kobospan" id="kobo.1077.1"> (the default is 50%) of physical memory. </span><span class="kobospan" id="kobo.1077.2">This percentage gets defined with the </span><span><strong class="source-inline1"><span class="kobospan" id="kobo.1078.1">vm.overcommit_ratio</span></strong></span><span><span class="kobospan" id="kobo.1079.1"> variable.</span></span></li>
</ul>
<p class="calibre3"><span class="kobospan" id="kobo.1080.1">Use the </span><strong class="source-inline"><span class="kobospan" id="kobo.1081.1">sysctl</span></strong><span class="kobospan" id="kobo.1082.1"> command to verify </span><span><span class="kobospan" id="kobo.1083.1">both variables:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.1084.1">
# </span><strong class="bold1"><span class="kobospan1" id="kobo.1085.1">sysctl vm.overcommit_memory</span></strong><span class="kobospan1" id="kobo.1086.1">
# </span><strong class="bold1"><span class="kobospan1" id="kobo.1087.1">sysctl vm.overcommit_ratio</span></strong></pre> <div class="calibre2">
<div class="img---figure" id="_idContainer459">
<span class="kobospan" id="kobo.1088.1"><img alt="Figure 11.25 – Reviewing the memory overcommit variables" src="image/B19121_11_25.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1089.1">Figure 11.25 – Reviewing the memory overcommit variables</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1090.1">Monitoring these basic</span><a id="_idIndexMarker913" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1091.1"> aspects of memory helps improve the performance of the system and the services </span><span><span class="kobospan" id="kobo.1092.1">it provides.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1093.1">Let’s see how to do the same </span><span><span class="kobospan" id="kobo.1094.1">with storage.</span></span></p>
<h1 id="_idParaDest-170" class="calibre5"><a id="_idTextAnchor235" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1095.1">Don’t ignore storage tuning</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.1096.1">Unlike other system </span><a id="_idIndexMarker914" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1097.1">resources, storage may optimize its performance as soon it gets sized. </span><span class="kobospan" id="kobo.1097.2">It can also be tuned when its usage </span><span><span class="kobospan" id="kobo.1098.1">gets analyzed.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1099.1">For this, it is necessary to consider that the correct sizing depends on differentiating the measures used in the storage </span><span><span class="kobospan" id="kobo.1100.1">allocation process.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1101.1">A very common mistake is to size with the wrong storage measurements, causing storage space to go unused </span><span><span class="kobospan" id="kobo.1102.1">or wasted.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1103.1">The key point to consider is how disk manufacturers overcome the challenge of creating a device that lives in two worlds. </span><span class="kobospan" id="kobo.1103.2">A disk is a raw physical device with no virtual or data structures before creating a filesystem. </span><span class="kobospan" id="kobo.1103.3">A raw disk becomes a block disk structure when it gets formatted as a filesystem. </span><span class="kobospan" id="kobo.1103.4">Filesystems are </span><span><span class="kobospan" id="kobo.1104.1">binary structures.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1105.1">This means that we must create a physical device, created under the physical rules of the real world, and turn it into a data structure in the </span><span><span class="kobospan" id="kobo.1106.1">digital world.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1107.1">The </span><strong class="bold"><span class="kobospan" id="kobo.1108.1">International System of Units</span></strong><span class="kobospan" id="kobo.1109.1"> (</span><strong class="bold"><span class="kobospan" id="kobo.1110.1">SI</span></strong><span class="kobospan" id="kobo.1111.1">) is the </span><a id="_idIndexMarker915" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1112.1">most widely used measurement system in the world. </span><span class="kobospan" id="kobo.1112.2">The </span><strong class="bold"><span class="kobospan" id="kobo.1113.1">International Electrotechnical Commission</span></strong><span class="kobospan" id="kobo.1114.1"> (</span><strong class="bold"><span class="kobospan" id="kobo.1115.1">IEC</span></strong><span class="kobospan" id="kobo.1116.1">) constructed</span><a id="_idIndexMarker916" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1117.1"> an alternative standard using the SI decimal prefixes that involves taking the first two letters of the analogous decimal prefix (for example, </span><em class="italic"><span class="kobospan" id="kobo.1118.1">ki</span></em><strong class="source-inline"><span class="kobospan" id="kobo.1119.1">-</span></strong><span class="kobospan" id="kobo.1120.1"> for </span><em class="italic"><span class="kobospan" id="kobo.1121.1">kilo-</span></em><span class="kobospan" id="kobo.1122.1">) and adding the letters </span><strong class="source-inline"><span class="kobospan" id="kobo.1123.1">-</span></strong> <em class="italic"><span class="kobospan" id="kobo.1124.1">bi</span></em> <strong class="source-inline"><span class="kobospan" id="kobo.1125.1">-</span></strong> <span><span class="kobospan" id="kobo.1126.1">for </span></span><span><em class="italic"><span class="kobospan" id="kobo.1127.1">binary</span></em></span><span><span class="kobospan" id="kobo.1128.1">.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1129.1">The point of error</span><a id="_idIndexMarker917" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1130.1"> occurs when the values get confused. </span><span class="kobospan" id="kobo.1130.2">Note the difference in the following </span><span><span class="kobospan" id="kobo.1131.1">comparison table:</span></span></p>
<table class="no-table-style" id="table005-1">
<colgroup class="calibre10">
<col class="calibre11"/>
<col class="calibre11"/>
<col class="calibre11"/>
<col class="calibre11"/>
</colgroup>
<tbody class="calibre12">
<tr class="no-table-style1">
<td class="no-table-style2" colspan="4">
<p class="calibre3"><strong class="bold"><span class="kobospan" id="kobo.1132.1">SI </span></strong><span><strong class="bold"><span class="kobospan" id="kobo.1133.1">decimal prefixes</span></strong></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span><strong class="bold"><span class="kobospan" id="kobo.1134.1">Prefix</span></strong></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span><strong class="bold"><span class="kobospan" id="kobo.1135.1">Nomenclature</span></strong></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span><strong class="bold"><span class="kobospan" id="kobo.1136.1">base</span></strong></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span><strong class="bold"><span class="kobospan" id="kobo.1137.1">Bytes</span></strong></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span><span class="kobospan" id="kobo.1138.1">kilo-</span></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span class="kobospan" id="kobo.1139.1">k</span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span><span class="kobospan" id="kobo.1140.1">10</span></span><span><span class="superscript"><span class="kobospan1" id="kobo.1141.1">3</span></span></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span><span class="kobospan" id="kobo.1142.1">1,000</span></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span><span class="kobospan" id="kobo.1143.1">mega-</span></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span class="kobospan" id="kobo.1144.1">M</span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span><span class="kobospan" id="kobo.1145.1">10</span></span><span><span class="superscript"><span class="kobospan1" id="kobo.1146.1">6</span></span></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span><span class="kobospan" id="kobo.1147.1">1,000,000</span></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span><span class="kobospan" id="kobo.1148.1">giga-</span></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span class="kobospan" id="kobo.1149.1">G</span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span><span class="kobospan" id="kobo.1150.1">10</span></span><span><span class="superscript"><span class="kobospan1" id="kobo.1151.1">9</span></span></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span><span class="kobospan" id="kobo.1152.1">1,000,000,000</span></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span><span class="kobospan" id="kobo.1153.1">tera-</span></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span class="kobospan" id="kobo.1154.1">T</span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span><span class="kobospan" id="kobo.1155.1">10</span></span><span><span class="superscript"><span class="kobospan1" id="kobo.1156.1">12</span></span></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span><span class="kobospan" id="kobo.1157.1">1,000,000,000,000</span></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2" colspan="4">
<p class="calibre3"><strong class="bold"><span class="kobospan" id="kobo.1158.1">IEC </span></strong><span><strong class="bold"><span class="kobospan" id="kobo.1159.1">binary prefixes</span></strong></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span><span class="kobospan" id="kobo.1160.1">kibi-</span></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span><span class="kobospan" id="kobo.1161.1">Ki</span></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span><span class="kobospan" id="kobo.1162.1">2</span></span><span><span class="superscript"><span class="kobospan1" id="kobo.1163.1">10</span></span></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span><span class="kobospan" id="kobo.1164.1">1,024</span></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span><span class="kobospan" id="kobo.1165.1">mebi-</span></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span><span class="kobospan" id="kobo.1166.1">Mi</span></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span><span class="kobospan" id="kobo.1167.1">2</span></span><span><span class="superscript"><span class="kobospan1" id="kobo.1168.1">20</span></span></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span><span class="kobospan" id="kobo.1169.1">1,048,576</span></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span><span class="kobospan" id="kobo.1170.1">gibi-</span></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span><span class="kobospan" id="kobo.1171.1">Gi</span></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span><span class="kobospan" id="kobo.1172.1">2</span></span><span><span class="superscript"><span class="kobospan1" id="kobo.1173.1">30</span></span></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span><span class="kobospan" id="kobo.1174.1">1,073,741,824</span></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span><span class="kobospan" id="kobo.1175.1">tebi-</span></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span><span class="kobospan" id="kobo.1176.1">Ti</span></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span><span class="kobospan" id="kobo.1177.1">2</span></span><span><span class="superscript"><span class="kobospan1" id="kobo.1178.1">40</span></span></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span><span class="kobospan" id="kobo.1179.1">1,099,511,627,776</span></span></p>
</td>
</tr>
</tbody>
</table>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1180.1">Table 11.5 – Prefixes comparison</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1181.1">So, how many bytes are on a 1 </span><span><span class="kobospan" id="kobo.1182.1">TB disk?</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1183.1">1 TB is 1 x 1,012 bytes = </span><span><span class="kobospan" id="kobo.1184.1">1,000,000,000,000.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1185.1">As mentioned previously, to create a filesystem on disk, binary structures use a block size (by default) of 4,096 (4 KiB). </span><span class="kobospan" id="kobo.1185.2">Using this nomenclature, a terabyte means </span><span><span class="kobospan" id="kobo.1186.1">1,012 bytes.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1187.1">Thus, some operating system tools could report in TB, but actually, they measure in binary </span><span><span class="kobospan" id="kobo.1188.1">tebibytes (TiB).</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1189.1">A tool that reports disk size in TB, but measures TB as tebibytes, would report that a 1 TB disk is only 0.91 TB in size (equal to 0.91 TiB), a difference of </span><span><span class="kobospan" id="kobo.1190.1">almost 10%.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1191.1">Thus, it is very important to</span><a id="_idIndexMarker918" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1192.1"> clearly state which units get used to analyze the sizing in a system report – otherwise, significant errors could occur in </span><span><span class="kobospan" id="kobo.1193.1">the analysis.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1194.1">Now, let’s learn how to analyze storage </span><span><span class="kobospan" id="kobo.1195.1">space usage.</span></span></p>
<h2 id="_idParaDest-171" class="calibre7"><a id="_idTextAnchor236" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1196.1">Improving storage space usage</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.1197.1">A big issue in analyzing </span><a id="_idIndexMarker919" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1198.1">storage space usage involves identifying it correctly. </span><span class="kobospan" id="kobo.1198.2">A stable identifier that maps to a filesystem is its </span><strong class="bold"><span class="kobospan" id="kobo.1199.1">UUID</span></strong><span class="kobospan" id="kobo.1200.1">. </span><span class="kobospan" id="kobo.1200.2">This is a hexadecimal number that</span><a id="_idIndexMarker920" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1201.1"> acts as a </span><strong class="bold"><span class="kobospan" id="kobo.1202.1">Universal </span></strong><span><strong class="bold"><span class="kobospan" id="kobo.1203.1">Unique Identifier</span></strong></span><span><span class="kobospan" id="kobo.1204.1">.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1205.1">The UUID is part of the filesystem and remains the same so long as the filesystem is not </span><span><span class="kobospan" id="kobo.1206.1">regenerated again.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1207.1">The utility for listing block devices is the </span><span><strong class="source-inline"><span class="kobospan" id="kobo.1208.1">lsblk</span></strong></span><span><span class="kobospan" id="kobo.1209.1"> command.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1210.1">The </span><strong class="source-inline"><span class="kobospan" id="kobo.1211.1">lsblk</span></strong><span class="kobospan" id="kobo.1212.1"> command with the </span><strong class="source-inline"><span class="kobospan" id="kobo.1213.1">-fp</span></strong><span class="kobospan" id="kobo.1214.1"> option displays the full path to the device, as well as the UUIDs and mount points, plus the filesystem type of the physical </span><span><span class="kobospan" id="kobo.1215.1">disk partition:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.1216.1">
# </span><strong class="bold1"><span class="kobospan1" id="kobo.1217.1">lsblk -fp</span></strong></pre> <div class="calibre2">
<div class="img---figure" id="_idContainer460">
<span class="kobospan" id="kobo.1218.1"><img alt="Figure 11.26 – Output of the lsblk command" src="image/B19121_11_26.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1219.1">Figure 11.26 – Output of the lsblk command</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1220.1">Note</span></p>
<p class="callout"><span class="kobospan" id="kobo.1221.1">If the filesystem is not mounted, the mount point </span><span><span class="kobospan" id="kobo.1222.1">appears blank.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1223.1">The most used tool for obtaining information about total filesystem usage is the </span><strong class="source-inline"><span class="kobospan" id="kobo.1224.1">df</span></strong><span class="kobospan" id="kobo.1225.1"> command. </span><span class="kobospan" id="kobo.1225.2">With the </span><strong class="source-inline"><span class="kobospan" id="kobo.1226.1">-h</span></strong><span class="kobospan" id="kobo.1227.1"> option, the output is displayed in a </span><span><span class="kobospan" id="kobo.1228.1">human-readable format:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.1229.1">
$ </span><strong class="bold1"><span class="kobospan1" id="kobo.1230.1">df –h</span></strong></pre> <div class="calibre2">
<div class="img---figure" id="_idContainer461">
<span class="kobospan" id="kobo.1231.1"><img alt="Figure 11.27 – Output of the df -h command" src="image/B19121_11_27.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1232.1">Figure 11.27 – Output of the df -h command</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1233.1">By installing </span><a id="_idIndexMarker921" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1234.1">the </span><strong class="source-inline"><span class="kobospan" id="kobo.1235.1">sysstat</span></strong><span class="kobospan" id="kobo.1236.1"> package, as mentioned previously, we receive tools for monitoring system performance. </span><span class="kobospan" id="kobo.1236.2">In the case of storage, the </span><strong class="source-inline"><span class="kobospan" id="kobo.1237.1">iostat</span></strong><span class="kobospan" id="kobo.1238.1"> command displays I/O statistics per disk, as well as workload, usage, and </span><span><span class="kobospan" id="kobo.1239.1">saturation metrics.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1240.1">Running the </span><strong class="source-inline"><span class="kobospan" id="kobo.1241.1">iostat</span></strong><span class="kobospan" id="kobo.1242.1"> command without arguments returns the CPU usage and disk </span><span><span class="kobospan" id="kobo.1243.1">I/O metrics:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.1244.1">
# </span><strong class="bold1"><span class="kobospan1" id="kobo.1245.1">iostat</span></strong></pre> <div class="calibre2">
<div class="img---figure" id="_idContainer462">
<span class="kobospan" id="kobo.1246.1"><img alt="Figure 11.28 – Output of the iostat command" src="image/B19121_11_28.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1247.1">Figure 11.28 – Output of the iostat command</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1248.1">By combining the different options of the </span><strong class="source-inline"><span class="kobospan" id="kobo.1249.1">iostat</span></strong><span class="kobospan" id="kobo.1250.1"> command, we can generate very useful statistics for usage</span><a id="_idIndexMarker922" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1251.1"> analysis. </span><span class="kobospan" id="kobo.1251.2">Here’s </span><span><span class="kobospan" id="kobo.1252.1">an example:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.1253.1">
# </span><strong class="bold1"><span class="kobospan1" id="kobo.1254.1">iostat -dyz  1 3</span></strong></pre> <div class="calibre2">
<div class="img---figure" id="_idContainer463">
<span class="kobospan" id="kobo.1255.1"><img alt="Figure 11.29 – Output of the iostat -dyz command" src="image/B19121_11_29.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1256.1">Figure 11.29 – Output of the iostat -dyz command</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1257.1">Let’s look at the options that </span><span><span class="kobospan" id="kobo.1258.1">were used:</span></span></p>
<ul class="calibre15">
<li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.1259.1">-d</span></strong><span class="kobospan" id="kobo.1260.1"> displays the disk I/O </span><span><span class="kobospan" id="kobo.1261.1">usage report</span></span></li>
<li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.1262.1">-y</span></strong><span class="kobospan" id="kobo.1263.1"> skips the first report with statistics since when the </span><span><span class="kobospan" id="kobo.1264.1">system started</span></span></li>
<li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.1265.1">-z</span></strong><span class="kobospan" id="kobo.1266.1"> skips </span><span><span class="kobospan" id="kobo.1267.1">inactive devices</span></span></li>
<li class="calibre14"><span class="kobospan" id="kobo.1268.1">The interval is </span><span><span class="kobospan" id="kobo.1269.1">a second</span></span></li>
<li class="calibre14"><span class="kobospan" id="kobo.1270.1">The count is an output of three reports </span><span><span class="kobospan" id="kobo.1271.1">every interval</span></span></li>
</ul>
<p class="calibre3"><span class="kobospan" id="kobo.1272.1">Note</span></p>
<p class="callout"><span class="kobospan" id="kobo.1273.1">For more information about the </span><strong class="source-inline1"><span class="kobospan" id="kobo.1274.1">iostat</span></strong><span class="kobospan" id="kobo.1275.1"> command options, refer to the manual pages. </span><span class="kobospan" id="kobo.1275.2">You can find them by running the </span><strong class="source-inline1"><span class="kobospan" id="kobo.1276.1">man </span></strong><span><strong class="source-inline1"><span class="kobospan" id="kobo.1277.1">iostat</span></strong></span><span><span class="kobospan" id="kobo.1278.1"> command.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1279.1">As mentioned in the previous section, having swap space increases the effective amount of memory. </span><span class="kobospan" id="kobo.1279.2">Let’s learn how to create a swap space in the system with </span><span><span class="kobospan" id="kobo.1280.1">effective sizing.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1281.1">We’ll use the </span><strong class="source-inline"><span class="kobospan" id="kobo.1282.1">/dev/sdc</span></strong><span class="kobospan" id="kobo.1283.1"> disk we used in </span><a href="B19121_04.xhtml#_idTextAnchor121" class="pcalibre1 calibre6 pcalibre"><span><em class="italic"><span class="kobospan" id="kobo.1284.1">Chapter 4</span></em></span></a><span class="kobospan" id="kobo.1285.1"> to create the filesystem with Stratis. </span><span class="kobospan" id="kobo.1285.2">Please follow the instructions in the aforementioned chapter to remove the pool and wipe the filesystem </span><a id="_idIndexMarker923" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1286.1">from </span><span><span class="kobospan" id="kobo.1287.1">the disk.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1288.1">Then, follow </span><span><span class="kobospan" id="kobo.1289.1">these steps:</span></span></p>
<ol class="calibre13">
<li class="calibre14"><span class="kobospan" id="kobo.1290.1">Use the </span><span><strong class="source-inline1"><span class="kobospan" id="kobo.1291.1">wipefs</span></strong></span><span><span class="kobospan" id="kobo.1292.1"> command:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.1293.1">
# </span><strong class="bold1"><span class="kobospan1" id="kobo.1294.1">wipefs /dev/sdc</span></strong></pre></li> </ol>
<p class="calibre3"><span class="kobospan" id="kobo.1295.1">Note</span></p>
<p class="callout"><span class="kobospan" id="kobo.1296.1">This command destroys the filesystem information of the device. </span><span class="kobospan" id="kobo.1296.2">Please be very careful and verify that the device you wish to wipe is the </span><span><span class="kobospan" id="kobo.1297.1">correct one.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1298.1">Now, let’s create the partition for the </span><span><span class="kobospan" id="kobo.1299.1">swap area.</span></span></p>
<ol class="calibre13">
<li value="2" class="calibre14"><span class="kobospan" id="kobo.1300.1">Inspect the </span><strong class="source-inline1"><span class="kobospan" id="kobo.1301.1">/dev/sdc</span></strong><span class="kobospan" id="kobo.1302.1"> disk to confirm that no partitions have been created. </span><span class="kobospan" id="kobo.1302.2">Use the </span><span><strong class="source-inline1"><span class="kobospan" id="kobo.1303.1">parted</span></strong></span><span><span class="kobospan" id="kobo.1304.1"> command:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.1305.1">
# </span><strong class="bold1"><span class="kobospan1" id="kobo.1306.1">parted /dev/sdc print</span></strong></pre></li> </ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer464">
<span class="kobospan" id="kobo.1307.1"><img alt="Figure 11.30 – Listing the /dev/sdc disk partitions" src="image/B19121_11_30.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1308.1">Figure 11.30 – Listing the /dev/sdc disk partitions</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1309.1">Create a 512 </span><span><span class="kobospan" id="kobo.1310.1">MB partition.</span></span></p>
<ol class="calibre13">
<li value="3" class="calibre14"><span class="kobospan" id="kobo.1311.1">Use </span><a id="_idIndexMarker924" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1312.1">the </span><span><strong class="source-inline1"><span class="kobospan" id="kobo.1313.1">parted</span></strong></span><span><span class="kobospan" id="kobo.1314.1"> command:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.1315.1">
# </span><strong class="bold1"><span class="kobospan1" id="kobo.1316.1">parted /dev/sdc</span></strong></pre></li> </ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer465">
<span class="kobospan" id="kobo.1317.1"><img alt="Figure 11.31 – Creating a swap partition" src="image/B19121_11_31.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1318.1">Figure 11.31 – Creating a swap partition</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1319.1">Using the </span><strong class="source-inline"><span class="kobospan" id="kobo.1320.1">parted</span></strong><span class="kobospan" id="kobo.1321.1"> command</span><a id="_idIndexMarker925" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1322.1"> without a subcommand opens an interactive </span><span><strong class="source-inline"><span class="kobospan" id="kobo.1323.1">parted</span></strong></span><span><span class="kobospan" id="kobo.1324.1"> session.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1325.1">Inside the interactive session, do </span><span><span class="kobospan" id="kobo.1326.1">the following:</span></span></p>
<ol class="calibre13">
<li class="upper-roman"><span class="kobospan" id="kobo.1327.1">Run the </span><strong class="source-inline1"><span class="kobospan" id="kobo.1328.1">mkpart</span></strong><span class="kobospan" id="kobo.1329.1"> subcommand to create </span><span><span class="kobospan" id="kobo.1330.1">the partition.</span></span></li>
<li class="upper-roman"><span class="kobospan" id="kobo.1331.1">Set </span><strong class="source-inline1"><span class="kobospan" id="kobo.1332.1">swap1</span></strong><span class="kobospan" id="kobo.1333.1"> as the </span><span><span class="kobospan" id="kobo.1334.1">partition’s name.</span></span></li>
<li class="upper-roman"><span class="kobospan" id="kobo.1335.1">Set the filesystem type </span><span><span class="kobospan" id="kobo.1336.1">to </span></span><span><strong class="source-inline1"><span class="kobospan" id="kobo.1337.1">linux-swap</span></strong></span><span><span class="kobospan" id="kobo.1338.1">.</span></span></li>
<li class="upper-roman"><span class="kobospan" id="kobo.1339.1">The partition should start at 2,049 KB and end at 513 MB so that the size is </span><span><span class="kobospan" id="kobo.1340.1">512 MB.</span></span></li>
</ol>
<p class="calibre3"><span class="kobospan" id="kobo.1341.1">Note</span></p>
<p class="callout"><span class="kobospan" id="kobo.1342.1">It is important to start a partition in the first block of the underlying storage. </span><span class="kobospan" id="kobo.1342.2">Starting at sector </span><strong class="source-inline1"><span class="kobospan" id="kobo.1343.1">2048</span></strong><span class="kobospan" id="kobo.1344.1"> is the default value for modern Linux and is stored on all storage types. </span><span class="kobospan" id="kobo.1344.2">This is known as the initial offset or </span><span><span class="kobospan" id="kobo.1345.1">partition alignment.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1346.1">Verify that the partition was created by running the </span><span><strong class="source-inline"><span class="kobospan" id="kobo.1347.1">print</span></strong></span><span><span class="kobospan" id="kobo.1348.1"> subcommand.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1349.1">Type </span><strong class="source-inline"><span class="kobospan" id="kobo.1350.1">quit</span></strong><span class="kobospan" id="kobo.1351.1"> to exit the interactive </span><span><strong class="source-inline"><span class="kobospan" id="kobo.1352.1">parted</span></strong></span><span><span class="kobospan" id="kobo.1353.1"> session.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1354.1">Note</span></p>
<p class="callout"><span class="kobospan" id="kobo.1355.1">The </span><strong class="source-inline1"><span class="kobospan" id="kobo.1356.1">parted</span></strong><span class="kobospan" id="kobo.1357.1"> command can display output on a </span><em class="italic"><span class="kobospan" id="kobo.1358.1">binary basis</span></em><span class="kobospan" id="kobo.1359.1"> as well. </span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1360.1">Run the </span><strong class="source-inline"><span class="kobospan" id="kobo.1361.1"># parted /dev/sdc unit MiB </span></strong><span><strong class="source-inline"><span class="kobospan" id="kobo.1362.1">print</span></strong></span><span><span class="kobospan" id="kobo.1363.1"> command:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer466">
<span class="kobospan" id="kobo.1364.1"><img alt="Figure 11.32 – Output of the parted command displayed on a binary basis" src="image/B19121_11_32.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1365.1">Figure 11.32 – Output of the parted command displayed on a binary basis</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1366.1">Ask the system to</span><a id="_idIndexMarker926" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1367.1"> detect the new partition and create the associated device file in the </span><strong class="source-inline"><span class="kobospan" id="kobo.1368.1">/</span></strong><span><strong class="source-inline"><span class="kobospan" id="kobo.1369.1">dev</span></strong></span><span><span class="kobospan" id="kobo.1370.1"> directory.</span></span></p>
<ol class="calibre13">
<li value="4" class="calibre14"><span class="kobospan" id="kobo.1371.1">Run the </span><strong class="source-inline1"><span class="kobospan" id="kobo.1372.1">udevadm settle</span></strong><span class="kobospan" id="kobo.1373.1"> command to observe the </span><strong class="source-inline1"><span class="kobospan" id="kobo.1374.1">udev</span></strong><span class="kobospan" id="kobo.1375.1"> event queue and </span><span><span class="kobospan" id="kobo.1376.1">update it:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.1377.1">
# </span><strong class="bold1"><span class="kobospan1" id="kobo.1378.1">udevadm settle</span></strong></pre><p class="calibre3"><span class="kobospan" id="kobo.1379.1">Now, format </span><span><span class="kobospan" id="kobo.1380.1">the partition.</span></span></p></li> <li class="calibre14"><span class="kobospan" id="kobo.1381.1">Use the </span><span><strong class="source-inline1"><span class="kobospan" id="kobo.1382.1">mkswap</span></strong></span><span><span class="kobospan" id="kobo.1383.1"> command:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.1384.1">
# </span><strong class="bold1"><span class="kobospan1" id="kobo.1385.1">mkswap /dev/sdc1</span></strong></pre></li> </ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer467">
<span class="kobospan" id="kobo.1386.1"><img alt="Figure 11.33 – Formatting the partition" src="image/B19121_11_33.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1387.1">Figure 11.33 – Formatting the partition</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1388.1">Review the swap area of </span><span><span class="kobospan" id="kobo.1389.1">the system.</span></span></p>
<ol class="calibre13">
<li value="6" class="calibre14"><span class="kobospan" id="kobo.1390.1">Use the </span><span><strong class="source-inline1"><span class="kobospan" id="kobo.1391.1">free</span></strong></span><span><span class="kobospan" id="kobo.1392.1"> command:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.1393.1">
# </span><strong class="bold1"><span class="kobospan1" id="kobo.1394.1">free -m</span></strong></pre></li> </ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer468">
<span class="kobospan" id="kobo.1395.1"><img alt="Figure 11.34 – Reviewing swap memory" src="image/B19121_11_34.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1396.1">Figure 11.34 – Reviewing swap memory</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1397.1">Activate the swap </span><a id="_idIndexMarker927" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1398.1">partition in </span><span><span class="kobospan" id="kobo.1399.1">the system.</span></span></p>
<ol class="calibre13">
<li value="7" class="calibre14"><span class="kobospan" id="kobo.1400.1">Use the </span><span><strong class="source-inline1"><span class="kobospan" id="kobo.1401.1">swapon</span></strong></span><span><span class="kobospan" id="kobo.1402.1"> command:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.1403.1">
# </span><strong class="bold1"><span class="kobospan1" id="kobo.1404.1">swapon /dev/sdc1</span></strong></pre></li> </ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer469">
<span class="kobospan" id="kobo.1405.1"><img alt="Figure 11.35 – Activating the swap partition" src="image/B19121_11_35.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1406.1">Figure 11.35 – Activating the swap partition</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1407.1">Now, verify the swap area of </span><span><span class="kobospan" id="kobo.1408.1">the system.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1409.1">The new swap area partition is active and available to the system. </span><span class="kobospan" id="kobo.1409.2">To make it persistently active, we need to create an entry in the </span><strong class="source-inline"><span class="kobospan" id="kobo.1410.1">/</span></strong><span><strong class="source-inline"><span class="kobospan" id="kobo.1411.1">etc/fstab</span></strong></span><span><span class="kobospan" id="kobo.1412.1"> file.</span></span></p>
<ol class="calibre13">
<li value="8" class="calibre14"><span class="kobospan" id="kobo.1413.1">Identify the UUID of the</span><a id="_idIndexMarker928" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1414.1"> swap partition and create an entry in the </span><strong class="source-inline1"><span class="kobospan" id="kobo.1415.1">/etc/fstab</span></strong><span class="kobospan" id="kobo.1416.1"> file. </span><span class="kobospan" id="kobo.1416.2">Use the </span><strong class="source-inline1"><span class="kobospan" id="kobo.1417.1">lsblk</span></strong><span class="kobospan" id="kobo.1418.1"> command to </span><span><span class="kobospan" id="kobo.1419.1">do so:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.1420.1">
# </span><strong class="bold1"><span class="kobospan1" id="kobo.1421.1">lsblk -fp</span></strong></pre></li> </ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer470">
<span class="kobospan" id="kobo.1422.1"><img alt="Figure 11.36 – Identifying the UUID of the swap partition" src="image/B19121_11_36.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1423.1">Figure 11.36 – Identifying the UUID of the swap partition</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1424.1">Add the following line to the </span><strong class="source-inline"><span class="kobospan" id="kobo.1425.1">/</span></strong><span><strong class="source-inline"><span class="kobospan" id="kobo.1426.1">etc/fstab</span></strong></span><span><span class="kobospan" id="kobo.1427.1"> file:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.1428.1">
UUID=6f53144d-fe12-4fc3-bb69-6469012592dc  swap  swap  defaults 0 0</span></pre> <div class="calibre2">
<div class="img---figure" id="_idContainer471">
<span class="kobospan" id="kobo.1429.1"><img alt="Figure 11.37 – Adding the swap partition to the /etc/fstab file" src="image/B19121_11_37.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1430.1">Figure 11.37 – Adding the swap partition to the /etc/fstab file</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1431.1">In this way, the swap partition remains persistently available to the system. </span><span class="kobospan" id="kobo.1431.2">With this, the system’s performance improves since physical memory becomes available. </span><span class="kobospan" id="kobo.1431.3">At this stage, the storage </span><a id="_idIndexMarker929" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1432.1">space is optimized for the </span><span><span class="kobospan" id="kobo.1433.1">swap space.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1434.1">Finally, let’s learn how to improve the performance of the network connection to </span><span><span class="kobospan" id="kobo.1435.1">the system.</span></span></p>
<h1 id="_idParaDest-172" class="calibre5"><a id="_idTextAnchor237" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1436.1">Boosting performance with network tuning</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.1437.1">The network</span><a id="_idIndexMarker930" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1438.1"> represents one of the most complex and </span><a id="_idIndexMarker931" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1439.1">key elements involved in tuning the system. </span><span class="kobospan" id="kobo.1439.2">Being an externally self-organizing element, some network elements could affect performance. </span><span class="kobospan" id="kobo.1439.3">To identify and adjust them, it is necessary to know the flow that a packet follows both when transmitted and received by a system, as well as the tuning options available </span><span><span class="kobospan" id="kobo.1440.1">for them.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1441.1">The transmission and reception flow of the packet is roughly </span><span><span class="kobospan" id="kobo.1442.1">as follows:</span></span></p>
<ul class="calibre15">
<li class="calibre14"><span><strong class="bold"><span class="kobospan" id="kobo.1443.1">Transmission</span></strong></span><span><span class="kobospan" id="kobo.1444.1">:</span></span><ol class="calibre18"><li class="upper-roman"><span class="kobospan" id="kobo.1445.1">Data gets written </span><a id="_idIndexMarker932" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1446.1">to a socket (an object such as a file) and sent to the </span><span><span class="kobospan" id="kobo.1447.1">transmit buffer.</span></span></li><li class="upper-roman"><span class="kobospan" id="kobo.1448.1">The kernel encapsulates the data</span><a id="_idIndexMarker933" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1449.1"> in a </span><strong class="bold"><span class="kobospan" id="kobo.1450.1">protocol data </span></strong><span><strong class="bold"><span class="kobospan" id="kobo.1451.1">unit</span></strong></span><span><span class="kobospan" id="kobo.1452.1"> (</span></span><span><strong class="bold"><span class="kobospan" id="kobo.1453.1">PDU</span></strong></span><span><span class="kobospan" id="kobo.1454.1">).</span></span></li><li class="upper-roman"><span class="kobospan" id="kobo.1455.1">The PDUs go to the device’s </span><span><span class="kobospan" id="kobo.1456.1">transmit queue.</span></span></li><li class="upper-roman"><span class="kobospan" id="kobo.1457.1">The network device driver copies the PDU from the transmit queue header to </span><span><span class="kobospan" id="kobo.1458.1">the NIC.</span></span></li><li class="upper-roman"><span class="kobospan" id="kobo.1459.1">The NIC sends </span><a id="_idIndexMarker934" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1460.1">the data and triggers an interrupt </span><span><span class="kobospan" id="kobo.1461.1">when transmitted.</span></span></li></ol></li>
<li class="calibre14"><span><strong class="bold"><span class="kobospan" id="kobo.1462.1">Reception</span></strong></span><span><span class="kobospan" id="kobo.1463.1">:</span></span><ol class="calibre18"><li class="upper-roman" value="1"><span class="kobospan" id="kobo.1464.1">The NIC receives a</span><a id="_idIndexMarker935" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1465.1"> frame and uses DMA to copy the frame to the </span><span><span class="kobospan" id="kobo.1466.1">receive buffer.</span></span></li><li class="upper-roman"><span class="kobospan" id="kobo.1467.1">The NIC triggers a </span><span><span class="kobospan" id="kobo.1468.1">hard interrupt.</span></span></li><li class="upper-roman"><span class="kobospan" id="kobo.1469.1">The kernel handles the hard interrupt and schedules a soft interrupt to handle </span><span><span class="kobospan" id="kobo.1470.1">the packet.</span></span></li><li class="upper-roman"><span class="kobospan" id="kobo.1471.1">The soft interrupt handles and moves the packet to the </span><span><span class="kobospan" id="kobo.1472.1">IP layer.</span></span></li><li class="upper-roman"><span class="kobospan" id="kobo.1473.1">If the packet is intended for local delivery, the PDU is de-encapsulated and placed in a socket </span><span><span class="kobospan" id="kobo.1474.1">receive buffer:</span></span></li><li class="upper-roman"><span class="kobospan" id="kobo.1475.1">If a process is waiting in this socket, it processes the data in the </span><span><span class="kobospan" id="kobo.1476.1">receive buffer</span></span></li></ol></li>
</ul>
<p class="calibre3"><span class="kobospan" id="kobo.1477.1">The tunables for the case of improving network flow consist of buffer limits. </span><span class="kobospan" id="kobo.1477.2">The kernel adjusts the size of</span><a id="_idIndexMarker936" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1478.1"> these</span><a id="_idIndexMarker937" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1479.1"> buffers based on the current network use but within the limits specified by the kernel tunables. </span><span class="kobospan" id="kobo.1479.2">The default values of these variables get calculated at boot time based on the amount of </span><span><span class="kobospan" id="kobo.1480.1">available memory.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1481.1">The kernel tunables, which could change when running the </span><strong class="source-inline"><span class="kobospan" id="kobo.1482.1">sysctl</span></strong><span class="kobospan" id="kobo.1483.1"> command, are </span><span><span class="kobospan" id="kobo.1484.1">as follows:</span></span></p>
<ul class="calibre15">
<li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.1485.1">net.ipv4.tcp_mem</span></strong><span class="kobospan" id="kobo.1486.1">: This specifies the TCP system memory limits. </span><span class="kobospan" id="kobo.1486.2">It considers three fields: </span><strong class="source-inline1"><span class="kobospan" id="kobo.1487.1">min</span></strong><span class="kobospan" id="kobo.1488.1">, </span><strong class="source-inline1"><span class="kobospan" id="kobo.1489.1">max</span></strong><span class="kobospan" id="kobo.1490.1">, and </span><strong class="source-inline1"><span class="kobospan" id="kobo.1491.1">pressure</span></strong><span class="kobospan" id="kobo.1492.1"> (when the amount of memory used in TCP/UDP exceeds this number, pages get moderated until they drop and return to the </span><strong class="source-inline1"><span class="kobospan" id="kobo.1493.1">min</span></strong><span class="kobospan" id="kobo.1494.1"> value). </span><span class="kobospan" id="kobo.1494.2">These values represent the number of pages, </span><span><span class="kobospan" id="kobo.1495.1">not bytes.</span></span></li>
<li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.1496.1">Net.ipv4.udp_mem</span></strong><span class="kobospan" id="kobo.1497.1">: This specifies the UDP system memory limits. </span><span class="kobospan" id="kobo.1497.2">It considers three fields: </span><strong class="source-inline1"><span class="kobospan" id="kobo.1498.1">min</span></strong><span class="kobospan" id="kobo.1499.1">, </span><strong class="source-inline1"><span class="kobospan" id="kobo.1500.1">max</span></strong><span class="kobospan" id="kobo.1501.1">, and </span><strong class="source-inline1"><span class="kobospan" id="kobo.1502.1">pressure</span></strong><span class="kobospan" id="kobo.1503.1">. </span><span class="kobospan" id="kobo.1503.2">These values represent the number of pages, </span><span><span class="kobospan" id="kobo.1504.1">not bytes.</span></span></li>
<li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.1505.1">net.core.rmem_max</span></strong><span class="kobospan" id="kobo.1506.1">: The maximum network core socket receive/send (</span><strong class="source-inline1"><span class="kobospan" id="kobo.1507.1">read/write</span></strong><span class="kobospan" id="kobo.1508.1">) buffers. </span><span class="kobospan" id="kobo.1508.2">Values are </span><span><span class="kobospan" id="kobo.1509.1">in bytes.</span></span></li>
<li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.1510.1">net.core.wmem_max</span></strong><span class="kobospan" id="kobo.1511.1">: The maximum network core socket receive/send (</span><strong class="source-inline1"><span class="kobospan" id="kobo.1512.1">read/write</span></strong><span class="kobospan" id="kobo.1513.1">) buffers. </span><span class="kobospan" id="kobo.1513.2">Values are </span><span><span class="kobospan" id="kobo.1514.1">in bytes.</span></span></li>
<li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.1515.1">net.ipv4.tcp_rmem</span></strong><span class="kobospan" id="kobo.1516.1">: The maximum TCP socket receive/send (</span><strong class="source-inline1"><span class="kobospan" id="kobo.1517.1">read/write</span></strong><span class="kobospan" id="kobo.1518.1">) buffers. </span><span class="kobospan" id="kobo.1518.2">It considers three fields: </span><strong class="source-inline1"><span class="kobospan" id="kobo.1519.1">min</span></strong><span class="kobospan" id="kobo.1520.1">, </span><strong class="source-inline1"><span class="kobospan" id="kobo.1521.1">default</span></strong><span class="kobospan" id="kobo.1522.1">, and </span><strong class="source-inline1"><span class="kobospan" id="kobo.1523.1">max</span></strong><span class="kobospan" id="kobo.1524.1">. </span><span class="kobospan" id="kobo.1524.2">Values are </span><span><span class="kobospan" id="kobo.1525.1">in bytes.</span></span></li>
<li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.1526.1">net.ipv4.tcp_wmem</span></strong><span class="kobospan" id="kobo.1527.1">: The maximum TCP socket receive/send (</span><strong class="source-inline1"><span class="kobospan" id="kobo.1528.1">read/write</span></strong><span class="kobospan" id="kobo.1529.1">) buffers. </span><span class="kobospan" id="kobo.1529.2">It considers three fields: </span><strong class="source-inline1"><span class="kobospan" id="kobo.1530.1">min</span></strong><span class="kobospan" id="kobo.1531.1">, </span><strong class="source-inline1"><span class="kobospan" id="kobo.1532.1">default</span></strong><span class="kobospan" id="kobo.1533.1">, and </span><strong class="source-inline1"><span class="kobospan" id="kobo.1534.1">max</span></strong><span class="kobospan" id="kobo.1535.1">. </span><span class="kobospan" id="kobo.1535.2">Values are </span><span><span class="kobospan" id="kobo.1536.1">in bytes.</span></span></li>
</ul>
<p class="calibre3"><span class="kobospan" id="kobo.1537.1">Note</span></p>
<p class="callout"><span class="kobospan" id="kobo.1538.1">The change of these values should take place after a </span><span><span class="kobospan" id="kobo.1539.1">behavioral analysis.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1540.1">In general, tunable values should be changed after the system’s behavior has </span><span><span class="kobospan" id="kobo.1541.1">been analyzed.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1542.1">For this purpose, several tools and utilities exist, which we have used throughout </span><span><span class="kobospan" id="kobo.1543.1">this chapter.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1544.1">Now, let’s look at a</span><a id="_idIndexMarker938" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1545.1"> tool </span><a id="_idIndexMarker939" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1546.1">that complements the use of </span><strong class="source-inline"><span class="kobospan" id="kobo.1547.1">sysstat</span></strong><span class="kobospan" id="kobo.1548.1"> and provides a graphical display of the </span><span><span class="kobospan" id="kobo.1549.1">collected metrics.</span></span></p>
<h2 id="_idParaDest-173" class="calibre7"><a id="_idTextAnchor238" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1550.1">Analyzing metrics</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.1551.1">Besides installing</span><a id="_idIndexMarker940" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1552.1"> the </span><strong class="source-inline"><span class="kobospan" id="kobo.1553.1">sysstat</span></strong><span class="kobospan" id="kobo.1554.1"> package to monitor tools, it can also be run as </span><span><span class="kobospan" id="kobo.1555.1">a service:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.1556.1">
# </span><strong class="bold1"><span class="kobospan1" id="kobo.1557.1">systemctl enable --now sysstat</span></strong></pre> <div class="calibre2">
<div class="img---figure" id="_idContainer472">
<span class="kobospan" id="kobo.1558.1"><img alt="Figure 11.38 – Reviewing the status of the sysstat service" src="image/B19121_11_38.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1559.1">Figure 11.38 – Reviewing the status of the sysstat service</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1560.1">The </span><strong class="source-inline"><span class="kobospan" id="kobo.1561.1">sysstat</span></strong><span class="kobospan" id="kobo.1562.1"> service collects, reports, or saves information about system activity. </span><span class="kobospan" id="kobo.1562.2">It stores operating system counters in the </span><strong class="source-inline"><span class="kobospan" id="kobo.1563.1">/var/log/sa/sadd</span></strong><span class="kobospan" id="kobo.1564.1"> file. </span><span class="kobospan" id="kobo.1564.2">From the data that’s been collected, a lot of information about the system can </span><span><span class="kobospan" id="kobo.1565.1">be received:</span></span></p>
<ul class="calibre15">
<li class="calibre14"><span><span class="kobospan" id="kobo.1566.1">CPU usage</span></span></li>
<li class="calibre14"><span class="kobospan" id="kobo.1567.1">Memory paging </span><span><span class="kobospan" id="kobo.1568.1">and usage</span></span></li>
<li class="calibre14"><span class="kobospan" id="kobo.1569.1">Network I/O and </span><span><span class="kobospan" id="kobo.1570.1">transfer statistics</span></span></li>
<li class="calibre14"><span class="kobospan" id="kobo.1571.1">Process </span><span><span class="kobospan" id="kobo.1572.1">creation activity</span></span></li>
<li class="calibre14"><span class="kobospan" id="kobo.1573.1">The activity of all </span><span><span class="kobospan" id="kobo.1574.1">block devices</span></span></li>
<li class="calibre14"><span class="kobospan" id="kobo.1575.1">Interrupts </span><span><span class="kobospan" id="kobo.1576.1">per second</span></span></li>
</ul>
<p class="calibre3"><span class="kobospan" id="kobo.1577.1">We can get the collected data with the </span><span><strong class="source-inline"><span class="kobospan" id="kobo.1578.1">sar</span></strong></span><span><span class="kobospan" id="kobo.1579.1"> command:</span></span></p>
<ul class="calibre15">
<li class="calibre14"><span class="kobospan" id="kobo.1580.1">Use the </span><strong class="source-inline1"><span class="kobospan" id="kobo.1581.1">sar</span></strong><span class="kobospan" id="kobo.1582.1"> command with the </span><strong class="source-inline1"><span class="kobospan" id="kobo.1583.1">-u</span></strong><span class="kobospan" id="kobo.1584.1"> option to get the CPU </span><span><span class="kobospan" id="kobo.1585.1">usage report:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.1586.1">
# </span><strong class="bold1"><span class="kobospan1" id="kobo.1587.1">sar –u 1 3</span></strong></pre></li> </ul>
<div class="calibre2">
<div class="img---figure" id="_idContainer473">
<span class="kobospan" id="kobo.1588.1"><img alt="Figure 11.39 – Output of the sar –u command" src="image/B19121_11_39.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1589.1">Figure 11.39 – Output of the sar –u command</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1590.1">This command is also used to read the history files where the daily data </span><span><span class="kobospan" id="kobo.1591.1">is recorded.</span></span></p>
<ul class="calibre15">
<li class="calibre14"><span class="kobospan" id="kobo.1592.1">Use the </span><strong class="source-inline1"><span class="kobospan" id="kobo.1593.1">sar</span></strong><span class="kobospan" id="kobo.1594.1"> command</span><a id="_idIndexMarker941" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1595.1"> to read one of the log files </span><span><span class="kobospan" id="kobo.1596.1">from </span></span><span><strong class="source-inline1"><span class="kobospan" id="kobo.1597.1">/var/log/sa</span></strong></span><span><span class="kobospan" id="kobo.1598.1">:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.1599.1">
# </span><strong class="bold1"><span class="kobospan1" id="kobo.1600.1">sar –q –f /var/log/sa17</span></strong></pre></li> </ul>
<div class="calibre2">
<div class="img---figure" id="_idContainer474">
<span class="kobospan" id="kobo.1601.1"><img alt="Figure 11.40 – The log file’s content" src="image/B19121_11_40.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1602.1">Figure 11.40 – The log file’s content</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1603.1">Note</span></p>
<p class="callout"><span class="kobospan" id="kobo.1604.1">For more information about </span><strong class="source-inline1"><span class="kobospan" id="kobo.1605.1">sar</span></strong><span class="kobospan" id="kobo.1606.1"> command options, refer to the manual pages by running the </span><strong class="source-inline1"><span class="kobospan" id="kobo.1607.1">man </span></strong><span><strong class="source-inline1"><span class="kobospan" id="kobo.1608.1">sar</span></strong></span><span><span class="kobospan" id="kobo.1609.1"> command.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1610.1">From these files, it is possible to generate graphs and export them as images or even a PDF report. </span><span class="kobospan" id="kobo.1610.2">The most commonly used tool for this </span><span><span class="kobospan" id="kobo.1611.1">is </span></span><span><strong class="source-inline"><span class="kobospan" id="kobo.1612.1">ksar</span></strong></span><span><span class="kobospan" id="kobo.1613.1">.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1614.1">To get </span><strong class="source-inline"><span class="kobospan" id="kobo.1615.1">ksar</span></strong><span class="kobospan" id="kobo.1616.1">, download it </span><a id="_idIndexMarker942" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1617.1">from their website </span><span><span class="kobospan" id="kobo.1618.1">at </span></span><a href="https://sourceforge.net/projects/ksar/" class="pcalibre1 calibre6 pcalibre"><span><span class="kobospan" id="kobo.1619.1">https://sourceforge.net/projects/ksar/</span></span></a><span><span class="kobospan" id="kobo.1620.1">:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer475">
<span class="kobospan" id="kobo.1621.1"><img alt="Figure 11.41 – The ksar website" src="image/B19121_11_41.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1622.1">Figure 11.41 – The ksar website</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1623.1">Note</span></p>
<p class="callout"><span class="kobospan" id="kobo.1624.1">A more updated version of the </span><strong class="source-inline1"><span class="kobospan" id="kobo.1625.1">ksar</span></strong><span class="kobospan" id="kobo.1626.1"> tool can be downloaded from its GitHub </span><span><span class="kobospan" id="kobo.1627.1">repository: </span></span><a href="https://github.com/vlsi/ksar/releases" class="pcalibre1 calibre6 pcalibre"><span><span class="kobospan" id="kobo.1628.1">https://github.com/vlsi/ksar/releases</span></span></a><span><span class="kobospan" id="kobo.1629.1">.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1630.1">The </span><strong class="source-inline"><span class="kobospan" id="kobo.1631.1">ksar</span></strong><span class="kobospan" id="kobo.1632.1"> tool comes as a </span><strong class="source-inline"><span class="kobospan" id="kobo.1633.1">jar</span></strong><span class="kobospan" id="kobo.1634.1"> file, so it requires the </span><strong class="source-inline"><span class="kobospan" id="kobo.1635.1">java-17-openjdk</span></strong><span class="kobospan" id="kobo.1636.1"> package to </span><span><span class="kobospan" id="kobo.1637.1">be installed:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.1638.1">
# </span><strong class="bold1"><span class="kobospan1" id="kobo.1639.1">dnf install java-17-openjdk</span></strong></pre> <p class="calibre3"><span class="kobospan" id="kobo.1640.1">The best practice is to make a copy of the </span><strong class="source-inline"><span class="kobospan" id="kobo.1641.1">log</span></strong><span class="kobospan" id="kobo.1642.1"> files to analyze, either by period or by a known event. </span><span class="kobospan" id="kobo.1642.2">A copy of the file can be used to generate the performance graphs. </span><span class="kobospan" id="kobo.1642.3">Follow </span><span><span class="kobospan" id="kobo.1643.1">these steps:</span></span></p>
<ol class="calibre13">
<li class="calibre14"><span class="kobospan" id="kobo.1644.1">Use the </span><strong class="source-inline1"><span class="kobospan" id="kobo.1645.1">sar</span></strong><span class="kobospan" id="kobo.1646.1"> command to redirect the contents of the log files to a </span><span><span class="kobospan" id="kobo.1647.1">text file:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.1648.1">
# </span><strong class="bold1"><span class="kobospan1" id="kobo.1649.1">LC_ALL=C sar -A &gt; /tmp/sar.data.txt</span></strong></pre></li> <li class="calibre14"><span class="kobospan" id="kobo.1650.1">Use the </span><strong class="source-inline1"><span class="kobospan" id="kobo.1651.1">java</span></strong><span class="kobospan" id="kobo.1652.1"> command to</span><a id="_idIndexMarker943" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1653.1"> open the </span><span><strong class="source-inline1"><span class="kobospan" id="kobo.1654.1">ksar</span></strong></span><span><span class="kobospan" id="kobo.1655.1"> tool:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.1656.1">
$ </span><strong class="bold1"><span class="kobospan1" id="kobo.1657.1">java -jar kSar.jar</span></strong></pre></li> </ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer476">
<span class="kobospan" id="kobo.1658.1"><img alt="Figure 11.42 – The ksar tool’s main window" src="image/B19121_11_42.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1659.1">Figure 11.42 – The ksar tool’s main window</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1660.1">Load the </span><strong class="source-inline"><span class="kobospan" id="kobo.1661.1">data</span></strong><span class="kobospan" id="kobo.1662.1"> file created from the </span><strong class="source-inline"><span class="kobospan" id="kobo.1663.1">log</span></strong><span class="kobospan" id="kobo.1664.1"> files to generate the system </span><span><span class="kobospan" id="kobo.1665.1">performance graphs.</span></span></p>
<ol class="calibre13">
<li value="3" class="calibre14"><span class="kobospan" id="kobo.1666.1">From the </span><strong class="bold"><span class="kobospan" id="kobo.1667.1">Data</span></strong><span class="kobospan" id="kobo.1668.1"> menu, click on </span><strong class="bold"><span class="kobospan" id="kobo.1669.1">Load from a </span></strong><span><strong class="bold"><span class="kobospan" id="kobo.1670.1">text file…</span></strong></span><span><span class="kobospan" id="kobo.1671.1">:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer477">
<span class="kobospan" id="kobo.1672.1"><img alt="Figure 11.43 – The Load from a text file… option" src="image/B19121_11_43.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1673.1">Figure 11.43 – The Load from a text file… option</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1674.1">The file</span><a id="_idIndexMarker944" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1675.1"> selection window </span><span><span class="kobospan" id="kobo.1676.1">will open.</span></span></p>
<ol class="calibre13">
<li value="4" class="calibre14"><span class="kobospan" id="kobo.1677.1">Navigate to the directory where the generated </span><span><span class="kobospan" id="kobo.1678.1">file resides:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer478">
<span class="kobospan" id="kobo.1679.1"><img alt="Figure 11.44 – Selecting the sar file" src="image/B19121_11_44.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1680.1">Figure 11.44 – Selecting the sar file</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1681.1">Select the </span><strong class="source-inline"><span class="kobospan" id="kobo.1682.1">sar</span></strong><span class="kobospan" id="kobo.1683.1"> file and </span><span><span class="kobospan" id="kobo.1684.1">click </span></span><span><strong class="bold"><span class="kobospan" id="kobo.1685.1">Open</span></strong></span><span><span class="kobospan" id="kobo.1686.1">.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1687.1">The file will take</span><a id="_idIndexMarker945" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1688.1"> some time to load, depending on its size and the amount of data </span><span><span class="kobospan" id="kobo.1689.1">to analyze.</span></span></p>
<ol class="calibre13">
<li value="5" class="calibre14"><span class="kobospan" id="kobo.1690.1">After loading finishes, the window will display the data column for filtering </span><span><span class="kobospan" id="kobo.1691.1">by resource:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer479">
<span class="kobospan" id="kobo.1692.1"><img alt="Figure 11.45 – Data analyzed window" src="image/B19121_11_45.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1693.1">Figure 11.45 – Data analyzed window</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1694.1">Navigate to </span><strong class="bold"><span class="kobospan" id="kobo.1695.1">NIC</span></strong><span class="kobospan" id="kobo.1696.1"> to review </span><a id="_idIndexMarker946" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1697.1">the </span><span><span class="kobospan" id="kobo.1698.1">network behavior.</span></span></p>
<ol class="calibre13">
<li value="6" class="calibre14"><span class="kobospan" id="kobo.1699.1">Click </span><strong class="bold"><span class="kobospan" id="kobo.1700.1">Interfaces traffic</span></strong><span class="kobospan" id="kobo.1701.1"> and </span><span><span class="kobospan" id="kobo.1702.1">then </span></span><span><strong class="bold"><span class="kobospan" id="kobo.1703.1">eth0</span></strong></span><span><span class="kobospan" id="kobo.1704.1">:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer480">
<span class="kobospan" id="kobo.1705.1"><img alt="Figure 11.46 – NIC performance graph" src="image/B19121_11_46.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1706.1">Figure 11.46 – NIC performance graph</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1707.1">Note</span></p>
<p class="callout"><span class="kobospan" id="kobo.1708.1">On your system, the device may be different. </span><span class="kobospan" id="kobo.1708.2">Please confirm the device information that we </span><span><span class="kobospan" id="kobo.1709.1">will analyze.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1710.1">This way, the</span><a id="_idIndexMarker947" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1711.1"> behavior could be </span><span><span class="kobospan" id="kobo.1712.1">better visualized.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1713.1">Let’s export </span><span><span class="kobospan" id="kobo.1714.1">these graphs.</span></span></p>
<ol class="calibre13">
<li value="7" class="calibre14"><span class="kobospan" id="kobo.1715.1">Click on the </span><strong class="bold"><span class="kobospan" id="kobo.1716.1">Export</span></strong><span class="kobospan" id="kobo.1717.1"> menu and then </span><strong class="bold"><span class="kobospan" id="kobo.1718.1">Export </span></strong><span><strong class="bold"><span class="kobospan" id="kobo.1719.1">to PDF…</span></strong></span><span><span class="kobospan" id="kobo.1720.1">:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer481">
<span class="kobospan" id="kobo.1721.1"><img alt="Figure 11.47 – The Export menu" src="image/B19121_11_47.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1722.1">Figure 11.47 – The Export menu</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1723.1">The window</span><a id="_idIndexMarker948" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1724.1"> for selecting the data to export </span><span><span class="kobospan" id="kobo.1725.1">will open.</span></span></p>
<ol class="calibre13">
<li value="8" class="calibre14"><span class="kobospan" id="kobo.1726.1">Select the data to export and click the </span><span><strong class="bold"><span class="kobospan" id="kobo.1727.1">OK</span></strong></span><span><span class="kobospan" id="kobo.1728.1"> button:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer482">
<span class="kobospan" id="kobo.1729.1"><img alt="Figure 11.48 – Selecting data to export" src="image/B19121_11_48.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1730.1">Figure 11.48 – Selecting data to export</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1731.1">Name the file, as is best practice, with the system’s name, and save it in the directory of </span><span><span class="kobospan" id="kobo.1732.1">your choice.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1733.1">Note</span></p>
<p class="callout"><span class="kobospan" id="kobo.1734.1">You can get the export report from our GitHub repository </span><span><span class="kobospan" id="kobo.1735.1">at </span></span><a href="https://github.com/PacktPublishing/Fedora-Linux-System-Administration/blob/main/chapter11/workstation.packt.lab.pdf" class="pcalibre1 calibre6 pcalibre"><span><span class="kobospan" id="kobo.1736.1">https://github.com/PacktPublishing/Fedora-Linux-System-Administration/blob/main/chapter11/workstation.packt.lab.pdf</span></span></a><span><span class="kobospan" id="kobo.1737.1">.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1738.1">This concludes the best </span><a id="_idIndexMarker949" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1739.1">practices for improving system performance. </span><span class="kobospan" id="kobo.1739.2">In the next chapter, we will talk about the security provided by </span><span><span class="kobospan" id="kobo.1740.1">Fedora Linux.</span></span></p>
<h1 id="_idParaDest-174" class="calibre5"><a id="_idTextAnchor239" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1741.1">Summary</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.1742.1">In this chapter, we provided an overview of best practices in system tuning. </span><span class="kobospan" id="kobo.1742.2">Beyond configurations, we looked at the tools that are available in Fedora Linux to analyze </span><span><span class="kobospan" id="kobo.1743.1">system behavior.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1744.1">System tuning, in most cases, is performed after a failure incident. </span><span class="kobospan" id="kobo.1744.2">It is at this point that it gets confused with troubleshooting. </span><span class="kobospan" id="kobo.1744.3">System tuning is about more than resolving a failure – it is about collecting metrics and performing analysis using the </span><span><span class="kobospan" id="kobo.1745.1">right tools.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1746.1">First, we learned how to change the kernel tunables using the </span><strong class="source-inline"><span class="kobospan" id="kobo.1747.1">sysctl</span></strong><span class="kobospan" id="kobo.1748.1"> command to understand their origin and the scope of these changes in their </span><span><span class="kobospan" id="kobo.1749.1">original configuration.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1750.1">Then, we learned how to use the system tools and utilities, including the </span><strong class="source-inline"><span class="kobospan" id="kobo.1751.1">ps</span></strong><span class="kobospan" id="kobo.1752.1">, </span><strong class="source-inline"><span class="kobospan" id="kobo.1753.1">top</span></strong><span class="kobospan" id="kobo.1754.1">, and </span><strong class="source-inline"><span class="kobospan" id="kobo.1755.1">free</span></strong><span class="kobospan" id="kobo.1756.1"> commands. </span><span class="kobospan" id="kobo.1756.2">We also covered the suite of utilities provided by installing the </span><strong class="source-inline"><span class="kobospan" id="kobo.1757.1">sysstat</span></strong><span class="kobospan" id="kobo.1758.1"> package, including the </span><strong class="source-inline"><span class="kobospan" id="kobo.1759.1">mpstat</span></strong><span class="kobospan" id="kobo.1760.1">, </span><strong class="source-inline"><span class="kobospan" id="kobo.1761.1">iostat</span></strong><span class="kobospan" id="kobo.1762.1">, </span><strong class="source-inline"><span class="kobospan" id="kobo.1763.1">pidstat</span></strong><span class="kobospan" id="kobo.1764.1">, and </span><span><strong class="source-inline"><span class="kobospan" id="kobo.1765.1">sar</span></strong></span><span><span class="kobospan" id="kobo.1766.1"> commands.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1767.1">After that, we briefly reviewed the </span><em class="italic"><span class="kobospan" id="kobo.1768.1">units of measurement</span></em><span class="kobospan" id="kobo.1769.1">, which cause failures when sizing resources, particularly </span><span><span class="kobospan" id="kobo.1770.1">in storage.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1771.1">Finally, we touched on network tuning and discussed the limitations of the operating system. </span><span class="kobospan" id="kobo.1771.2">While doing so, we learned how to use </span><strong class="source-inline"><span class="kobospan" id="kobo.1772.1">ksar</span></strong><span class="kobospan" id="kobo.1773.1">, a tool that helps us graph the metrics collected by </span><strong class="source-inline"><span class="kobospan" id="kobo.1774.1">sysstat</span></strong><span class="kobospan" id="kobo.1775.1"> when it’s running as </span><span><span class="kobospan" id="kobo.1776.1">a service.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1777.1">In the next chapter, we will take a walk through the hardened security layer offered by Fedora Linux: SELinux. </span><span class="kobospan" id="kobo.1777.2">In most cases, this is not activated due to ignorance of how it works. </span><span class="kobospan" id="kobo.1777.3">We will clarify how it operates so that we can implement it in </span><span><span class="kobospan" id="kobo.1778.1">our systems.</span></span></p>
</div>
</body></html>