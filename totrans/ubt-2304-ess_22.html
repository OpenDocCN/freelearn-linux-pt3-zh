<html><head></head><body>
<div class="_idGenObjectStyleOverride-1" id="_idContainer287">
<p class="Chapter-Title" id="_idParaDest-217" lang="en-US"><span class="ChapterMarker"><span class="koboSpan" id="kobo.1.1">23. </span></span><a id="_idTextAnchor369"/><span class="koboSpan" id="kobo.2.1">Installing KVM Virtualization on Ubuntu 23.04</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.3.1">Earlier versions of Ubuntu provided two virtualization platforms: Kernel-based Virtual Machine (KVM) and Xen. </span><span class="koboSpan" id="kobo.3.2">In recent releases, support for Xen has been removed, leaving KVM as the only bundled virtualization option supplied with Ubuntu. </span><span class="koboSpan" id="kobo.3.3">In addition to KVM, third-party solutions are available in products such as </span><a id="_idIndexMarker570"/><span class="koboSpan" id="kobo.4.1">VMware and Oracle </span><a id="_idIndexMarker571"/><span class="koboSpan" id="kobo.5.1">VirtualBox. </span><span class="koboSpan" id="kobo.5.2">Since KVM is supplied with Ubuntu, however, this virtualization solution will be covered in this and subsequent chapters.</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.6.1">Before plunging into installing and running KVM, it is worth discussing how it fits into the various types of virtualization outlined in the previous chapter.</span></p>
<p class="Heading-1-1" id="_idParaDest-218" lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.7.1">23.1 </span></span><a id="_idTextAnchor370"/><span class="koboSpan" id="kobo.8.1">An Overview of </span><a id="_idIndexMarker572"/><span class="koboSpan" id="kobo.9.1">KVM</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.10.1">KVM is categorized as a Type-1 hypervisor virtualization solution that implements full virtualization with support for unmodified guest operating systems using Intel VT and AMD-V hardware virtualization support.</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.11.1">KVM differs from many other Type-1 solutions in that it turns the host Linux operating system into the hypervisor, allowing bare metal virtualization to be implemented while running a complete, enterprise-level host operating system.</span></p>
<p class="Heading-1-1" id="_idParaDest-219" lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.12.1">23.2 </span></span><a id="_idTextAnchor371"/><a id="_idIndexMarker573"/><span class="koboSpan" id="kobo.13.1">KVM Hardware Requirements</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.14.1">Before proceeding with this chapter, we must discuss the hardware requirements for running virtual machines within a KVM environment. </span><span class="koboSpan" id="kobo.14.2">First and foremost, KVM virtualization is only available on certain processor types. </span><span class="koboSpan" id="kobo.14.3">As previously discussed, these processors must include either Intel VT or AMD-V technology. </span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.15.1">To check for virtualization support, run the</span><a id="_idIndexMarker574"/> <span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.16.1">lscpu</span></span><span class="koboSpan" id="kobo.17.1"> command in a terminal window:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.18.1"># lscpu | grep Virtualization:</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.19.1">If the system contains a CPU with Intel VT support, the above command will provide the following output:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.20.1">Virtualization:      VT-x</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.21.1">Alternatively, the following output will be displayed when a CPU with AMD-V support is detected:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.22.1">Virtualization:      AMD-V</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.23.1">If the CPU does not support virtualization, no output will be displayed by the above </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.24.1">lscpu </span></span><span class="koboSpan" id="kobo.25.1">command.</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.26.1">Note that while the above commands only report whether the processor supports the respective feature, it does not indicate whether it is currently enabled in the BIOS. </span><span class="koboSpan" id="kobo.26.2">This is because, in practice, virtualization support is typically disabled by default in the BIOS of most systems. </span><span class="koboSpan" id="kobo.26.3">Therefore, you should check your BIOS settings to ensure the appropriate virtualization technology is enabled before proceeding with this tutorial. </span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.27.1">Unlike a dual-booting environment, a virtualized environment involves running two or more complete operating systems concurrently on a single computer system. </span><span class="koboSpan" id="kobo.27.2">This means the system must have enough physical memory, disk space, and CPU processing power to comfortably accommodate all these systems in parallel. </span><span class="koboSpan" id="kobo.27.3">Therefore, before beginning the configuration and installation process, check on the minimum system requirements for both Ubuntu and your chosen guest operating systems and verify that your host system has sufficient resources to handle the requirements of both systems.</span></p>
<p class="Heading-1-1" id="_idParaDest-220" lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.28.1">23.3 </span></span><a id="_idTextAnchor372"/><span class="koboSpan" id="kobo.29.1">Preparing Ubuntu for </span><a id="_idIndexMarker575"/><span class="koboSpan" id="kobo.30.1">KVM Virtualization </span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.31.1">Unlike</span><a id="_idIndexMarker576"/><span class="koboSpan" id="kobo.32.1"> Xen, it is not necessary to run a special version of the kernel to support KVM. </span><span class="koboSpan" id="kobo.32.2">As a result, KVM support is already available for use with the standard kernel via installing a KVM kernel module, thereby negating the need to install and boot from a special kernel. </span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.33.1">To avoid conflicts, however, if a Xen-enabled kernel is currently running on the system, reboot the system and select a non-Xen kernel from the boot menu before proceeding with the remainder of this chapter.</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.34.1">The tools required to set up and maintain a KVM-based virtualized system are only installed by default if selected explicitly during the Ubuntu operating system installation process. </span><span class="koboSpan" id="kobo.34.2">To install the KVM tools from the command prompt, execute the following command in a terminal window:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.35.1"># apt install qemu-kvm libvirt-clients libvirt-daemon-system bridge-utils</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.36.1">If you have access to a graphical desktop environment, the </span><a id="_idIndexMarker577"/><a id="_idIndexMarker578"/><a id="_idIndexMarker579"/><a id="_idIndexMarker580"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.37.1">virt-manager</span></span><span class="koboSpan" id="kobo.38.1"> package is also recommended:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.39.1"># apt install virt-manager</span></p>
<p class="Heading-1-1" id="_idParaDest-221" lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.40.1">23.4 </span></span><a id="_idTextAnchor373"/><span class="koboSpan" id="kobo.41.1">Verifying the KVM Installation</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.42.1">It is worthwhile checking that the KVM installation worked correctly before moving forward. </span><span class="koboSpan" id="kobo.42.2">When KVM is installed and running, two modules will have been loaded into the kernel. </span><span class="koboSpan" id="kobo.42.3">The presence or otherwise of these modules can be verified in a terminal window by running the </span><a id="_idIndexMarker581"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.43.1">lsmod</span></span><span class="koboSpan" id="kobo.44.1"> command:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.45.1"># lsmod | grep kvm </span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.46.1">Assuming that the installation was successful, the above command should generate output similar to the following:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.47.1">kvm_intel             438272  0</span></p>
<p class="Code"><span class="koboSpan" id="kobo.48.1">kvm                  1138688  21 kvm_intel</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.49.1">Note that if the system contains an AMD processor, the kvm module will likely read </span><a id="_idIndexMarker582"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.50.1">kvm_amd </span></span><span class="koboSpan" id="kobo.51.1">rather than </span><a id="_idIndexMarker583"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.52.1">kvm_intel</span></span><span class="koboSpan" id="kobo.53.1">.</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.54.1">The installation process should also have configured the</span><a id="_idIndexMarker584"/><span class="koboSpan" id="kobo.55.1"> libvirtd daemon to run in the background. </span><span class="koboSpan" id="kobo.55.2">Once again, using a terminal window, run the following command to ensure libvirtd is running:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.56.1"># systemctl status libvirtd</span></p>
<p class="Code"><span class="koboSpan" id="kobo.57.1">● libvirtd.service - Virtualization daemon</span></p>
<p class="Code"><span class="koboSpan" id="kobo.58.1">     Loaded: loaded (/lib/systemd/system/libvirtd.service; enabled; vendor pres&gt;</span></p>
<p class="Code"><span class="koboSpan" id="kobo.59.1">     Active: active (running) since Wed 2023-07-19 11:15:13 EDT; 21h ago</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.60.1">If the process is not running, start it as follows:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.61.1"># systemctl enable --now libvirtd</span></p>
<p class="Code"><span class="koboSpan" id="kobo.62.1"># systemctl start libvirtd</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.63.1">If the desktop environment is available, run the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.64.1">virt-manager</span></span><span class="koboSpan" id="kobo.65.1"> tool by selecting Activities and entering “virt” into the search box. </span><span class="koboSpan" id="kobo.65.2">When the Virtual Machine Manager icon appears, click it to launch it. </span><span class="koboSpan" id="kobo.65.3">When loaded, the manager should appear as illustrated in the following figure:</span></p>
<p class="My-Basic-Paragraph ParaOverride-1" lang="en-US"><span class="koboSpan" id="kobo.66.1"><img alt="" class="_idGenObjectAttribute-1" src="image/ubuntu_virt-manager.jpg"/></span></p>
<p class="Figure-Caption" lang="en-US"><span class="FigureCaptionMarker"><span class="koboSpan" id="kobo.67.1">Figure 23-1</span></span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.68.1">If the QEMU/KVM entry is not listed, select the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.69.1">File -&gt; Add Connection</span></span><span class="koboSpan" id="kobo.70.1"> menu option and, in the resulting dialog, select the </span><a id="_idIndexMarker585"/><a id="_idIndexMarker586"/><span class="koboSpan" id="kobo.71.1">QEMU/KVM Hypervisor before clicking on the Connect button:</span></p>
<p class="My-Basic-Paragraph ParaOverride-1" lang="en-US"><span class="koboSpan" id="kobo.72.1"><img alt="" class="_idGenObjectAttribute-2" src="image/ubuntu_virt-manager_add_connection.jpg"/></span></p>
<p class="Figure-Caption" lang="en-US"><span class="FigureCaptionMarker"><span class="koboSpan" id="kobo.73.1">Figure 23-2</span></span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.74.1">If the manager is not currently connected to the virtualization processes, right-click on the entry listed and select Connect from the popup menu.</span></p>
<p class="Heading-1-1" id="_idParaDest-222" lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.75.1">23.5 </span></span><a id="_idTextAnchor374"/><span class="koboSpan" id="kobo.76.1">Summary</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.77.1">KVM is a Type-1 hypervisor virtualization solution that implements full virtualization with support for unmodified guest operating systems using Intel VT and AMD-V hardware virtualization support. </span><span class="koboSpan" id="kobo.77.2">It is the default virtualization solution bundled with Ubuntu and can be installed quickly and easily on any Ubuntu system with appropriate processor support. </span><span class="koboSpan" id="kobo.77.3">With KVM support installed and enabled, the following chapters will outline some options for installing and managing virtual machines on an Ubuntu host.</span></p>
</div>
</body></html>