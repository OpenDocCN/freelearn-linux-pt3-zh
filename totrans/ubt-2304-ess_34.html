<html><head></head><body>
<div class="_idGenObjectStyleOverride-1" id="_idContainer390">
<p class="Chapter-Title" id="_idParaDest-323" lang="en-US" xml:lang="en-US"><span class="ChapterMarker"><span class="koboSpan" id="kobo.1.1">35. </span></span><a id="_idTextAnchor516"/><span class="koboSpan" id="kobo.2.1">Adding and Managing Ubuntu Swap Space</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.3.1">An important part of maintaining the performance of an Ubuntu system involves ensuring that adequate swap space is available comparable to the memory demands placed on the system. </span><span class="koboSpan" id="kobo.3.2">The goal of this chapter, therefore, is to provide an overview of swap management on Ubuntu.</span></p>
<p class="Heading-1-1" id="_idParaDest-324" lang="en-US" xml:lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.4.1">35.1 </span></span><a id="_idTextAnchor517"/><span class="koboSpan" id="kobo.5.1">What is Swap Space?</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.6.1">Computer systems have a finite amount of physical memory that is made available to the operating system. </span><span class="koboSpan" id="kobo.6.2">When the operating system begins to approach the limit of the available memory, it frees up space by writing memory pages to disk. </span><span class="koboSpan" id="kobo.6.3">When the operating system requires any of those pages, they are subsequently read back into memory. </span><span class="koboSpan" id="kobo.6.4">The area of the disk allocated for this task is referred to as </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.7.1">swap space</span></span><span class="koboSpan" id="kobo.8.1">.</span></p>
<p class="Heading-1-1" id="_idParaDest-325" lang="en-US" xml:lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.9.1">35.2 </span></span><a id="_idTextAnchor518"/><span class="koboSpan" id="kobo.10.1">Recommended </span><a id="_idIndexMarker807"/><span class="koboSpan" id="kobo.11.1">Swap Space for Ubuntu</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.12.1">The amount of swap recommended for Ubuntu depends on a number of factors including the amount of memory in the system, the workload imposed on that memory and whether the system is required to support hibernation. </span><span class="koboSpan" id="kobo.12.2">The current guidelines for Ubuntu swap space are as follows:</span></p>
<table class="My-Table-Style TableOverride-1" id="table002">
<colgroup>
<col/>
<col/>
<col/>
</colgroup>
<tbody>
<tr class="My-Table-Style _idGenTableRowColumn-1">
<td class="My-Table-Style">
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="My-Bold _idGenCharOverride-1"><span class="koboSpan" id="kobo.13.1">Amount of installed RAM</span></span></p>
</td>
<td class="My-Table-Style">
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="My-Bold _idGenCharOverride-1"><span class="koboSpan" id="kobo.14.1">Recommended swap space</span></span></p>
</td>
<td class="My-Table-Style">
<p class="My-Basic-Paragraph ParaOverride-1" lang="en-US" xml:lang="en-US"><span class="My-Bold _idGenCharOverride-1"><span class="koboSpan" id="kobo.15.1">Recommended swap space if hibernation enabled</span></span></p>
</td>
</tr>
<tr class="My-Table-Style">
<td class="My-Table-Style">
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.16.1">1GB</span></p>
</td>
<td class="My-Table-Style">
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.17.1">1GB</span></p>
</td>
<td class="My-Table-Style">
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.18.1">2GB</span></p>
</td>
</tr>
<tr class="My-Table-Style _idGenTableRowColumn-1">
<td class="My-Table-Style">
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.19.1">2GB</span></p>
</td>
<td class="My-Table-Style">
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.20.1">1GB</span></p>
</td>
<td class="My-Table-Style">
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.21.1">3GB</span></p>
</td>
</tr>
<tr class="My-Table-Style">
<td class="My-Table-Style">
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.22.1">3GB</span></p>
</td>
<td class="My-Table-Style">
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.23.1">2GB</span></p>
</td>
<td class="My-Table-Style">
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.24.1">5GB</span></p>
</td>
</tr>
<tr class="My-Table-Style _idGenTableRowColumn-1">
<td class="My-Table-Style">
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.25.1">4GB</span></p>
</td>
<td class="My-Table-Style">
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.26.1">2GB</span></p>
</td>
<td class="My-Table-Style">
<p class="My-Basic-Paragraph ParaOverride-1" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.27.1">6GB</span></p>
</td>
</tr>
<tr class="My-Table-Style">
<td class="My-Table-Style">
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.28.1">5GB</span></p>
</td>
<td class="My-Table-Style">
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.29.1">2GB</span></p>
</td>
<td class="My-Table-Style">
<p class="My-Basic-Paragraph ParaOverride-1" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.30.1">7GB</span></p>
</td>
</tr>
<tr class="My-Table-Style _idGenTableRowColumn-1">
<td class="My-Table-Style">
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.31.1">6GB</span></p>
</td>
<td class="My-Table-Style">
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.32.1">2GB</span></p>
</td>
<td class="My-Table-Style">
<p class="My-Basic-Paragraph ParaOverride-1" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.33.1">8GB</span></p>
</td>
</tr>
<tr class="My-Table-Style">
<td class="My-Table-Style">
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.34.1">8GB</span></p>
</td>
<td class="My-Table-Style">
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.35.1">3GB</span></p>
</td>
<td class="My-Table-Style">
<p class="My-Basic-Paragraph ParaOverride-1" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.36.1">11GB</span></p>
</td>
</tr>
<tr class="My-Table-Style _idGenTableRowColumn-1">
<td class="My-Table-Style">
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.37.1">12GB</span></p>
</td>
<td class="My-Table-Style">
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.38.1">3GB</span></p>
</td>
<td class="My-Table-Style">
<p class="My-Basic-Paragraph ParaOverride-1" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.39.1">15GB</span></p>
</td>
</tr>
<tr class="My-Table-Style">
<td class="My-Table-Style">
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.40.1">16GB</span></p>
</td>
<td class="My-Table-Style">
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.41.1">4GB</span></p>
</td>
<td class="My-Table-Style">
<p class="My-Basic-Paragraph ParaOverride-1" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.42.1">32GB</span></p>
</td>
</tr>
<tr class="My-Table-Style _idGenTableRowColumn-1">
<td class="My-Table-Style">
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.43.1">24GB</span></p>
</td>
<td class="My-Table-Style">
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.44.1">5GB</span></p>
</td>
<td class="My-Table-Style">
<p class="My-Basic-Paragraph ParaOverride-1" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.45.1">48GB</span></p>
</td>
</tr>
</tbody>
</table>
<p class="Table-Caption" lang="en-US" xml:lang="en-US"><span class="TableCaptionMarker"><span class="koboSpan" id="kobo.46.1">Table 35-1</span></span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.47.1">For systems with memory configurations exceeding 24GB refer to the following web page for swap space guidelines:</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><a href="https://help.ubuntu.com/community/SwapFaq "><span class="Hyperlink CharOverride-1"><span class="koboSpan" id="kobo.48.1">https://help.ubuntu.com/community/SwapFaq</span></span></a></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.49.1">When a system enters </span><a id="_idIndexMarker808"/><span class="koboSpan" id="kobo.50.1">hibernation, the current system state is written to the hard disk, and the host machine is powered off. </span><span class="koboSpan" id="kobo.50.2">When the machine is subsequently powered on, the state of the system is restored from the hard disk drive. </span><span class="koboSpan" id="kobo.50.3">This differs from suspension, where the system state is stored in RAM. </span><span class="koboSpan" id="kobo.50.4">The machine then enters a sleep state whereby power is maintained to the system RAM while other devices are shut down.</span></p>
<p class="Heading-1-1" id="_idParaDest-326" lang="en-US" xml:lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.51.1">35.3 </span></span><a id="_idTextAnchor519"/><span class="koboSpan" id="kobo.52.1">Identifying Current </span><a id="_idIndexMarker809"/><span class="koboSpan" id="kobo.53.1">Swap Space Usage</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.54.1">The current amount of swap used by an Ubuntu system may be identified in a number of ways. </span><span class="koboSpan" id="kobo.54.2">One option is to output the </span><a id="_idIndexMarker810"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.55.1">/proc/swaps</span></span><span class="koboSpan" id="kobo.56.1"> file:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.57.1"># cat /proc/swaps</span></p>
<p class="Code"><span class="koboSpan" id="kobo.58.1">Filename               Type      Size         Used    Priority</span></p>
<p class="Code"><span class="koboSpan" id="kobo.59.1">/swap.img              file		3778556      836928	 -2</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.60.1">Alternatively, the </span><a id="_idIndexMarker811"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.61.1">swapon</span></span><span class="koboSpan" id="kobo.62.1"> command may be used:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.63.1"># swapon</span></p>
<p class="Code"><span class="koboSpan" id="kobo.64.1">NAME      TYPE      SIZE  USED PRIO</span></p>
<p class="Code"><span class="koboSpan" id="kobo.65.1">/swap.img file 3.6G 817.3M   -2</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.66.1">To view the amount of swap space relative to the overall available RAM, the </span><a id="_idIndexMarker812"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.67.1">free</span></span><span class="koboSpan" id="kobo.68.1"> command may be used:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.69.1"># free</span></p>
<p class="Code"><span class="koboSpan" id="kobo.70.1">           total      used        free      shared  buff/cache   available</span></p>
<p class="Code"><span class="koboSpan" id="kobo.71.1">Mem:     3779672   2554028      451216      809132     1839908     1225644</span></p>
<p class="Code"><span class="koboSpan" id="kobo.72.1">Swap:    3778556    836928     2941628</span></p>
<p class="Heading-1-1" id="_idParaDest-327" lang="en-US" xml:lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.73.1">35.4 </span></span><a id="_idTextAnchor520"/><span class="koboSpan" id="kobo.74.1">Adding a </span><a id="_idIndexMarker813"/><span class="koboSpan" id="kobo.75.1">Swap File to an Ubuntu System</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.76.1">Additional swap may be added to the system by creating a file and assigning it as swap. </span><span class="koboSpan" id="kobo.76.2">Begin by creating the swap file using the </span><a id="_idIndexMarker814"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.77.1">dd</span></span><span class="koboSpan" id="kobo.78.1"> command. </span><span class="koboSpan" id="kobo.78.2">The size of the file can be changed by adjusting the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.79.1">count=</span></span><span class="koboSpan" id="kobo.80.1"> variable. </span><span class="koboSpan" id="kobo.80.2">The following command-line, for example, creates a 2.0 GB file:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.81.1"># dd if=/dev/zero of=/newswap bs=1024 count=2000000</span></p>
<p class="Code"><span class="koboSpan" id="kobo.82.1">2000000+0 records in</span></p>
<p class="Code"><span class="koboSpan" id="kobo.83.1">2000000+0 records out</span></p>
<p class="Code"><span class="koboSpan" id="kobo.84.1">2048000000 bytes (2.0 GB, 1.9 GiB) copied, 3.62697 s, 565 MB/s</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.85.1">Before converting the file to a swap file, it is important to make sure the file has secure permissions set:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.86.1"># chmod 0600 /newswap</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.87.1">Once a suitable file has been created, it needs to be converted into a swap file using the </span><a id="_idIndexMarker815"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.88.1">mkswap</span></span><span class="koboSpan" id="kobo.89.1"> command:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.90.1"># mkswap /newswap</span></p>
<p class="Code"><span class="koboSpan" id="kobo.91.1">Setting up swapspace version 1, size = 1.9 GiB (2047995904 bytes)</span></p>
<p class="Code"><span class="koboSpan" id="kobo.92.1">no label, UUID=4ffc238d-7fde-4367-bd98-c5c46407e535</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.93.1">With the swap file created and configured it can be added to the system in real-time using the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.94.1">swapon</span></span><span class="koboSpan" id="kobo.95.1"> utility:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.96.1"># swapon /newswap</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.97.1">Re-running swapon should now report that the new file is now being used as swap:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.98.1"># swapon</span></p>
<p class="Code"><span class="koboSpan" id="kobo.99.1">NAME      TYPE      SIZE USED PRIO</span></p>
<p class="Code"><span class="koboSpan" id="kobo.100.1">/swap.img file 3.6G 832.5M   -2</span></p>
<p class="Code"><span class="koboSpan" id="kobo.101.1">/newswap  file 1.9G     0B   -3</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.102.1">The swap space may be removed dynamically by using the </span><a id="_idIndexMarker816"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.103.1">swapoff </span></span><span class="koboSpan" id="kobo.104.1">utility as follows:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.105.1"># swapoff /newswap</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.106.1">Finally, modify the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.107.1">/etc/fstab</span></span><span class="koboSpan" id="kobo.108.1"> file to automatically add the new swap at system boot time by adding the following line:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.109.1">/newswap    swap    swap   defaults 0 0</span></p>
<p class="Heading-1-1" id="_idParaDest-328" lang="en-US" xml:lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.110.1">35.5 </span></span><a id="_idTextAnchor521"/><span class="koboSpan" id="kobo.111.1">Adding </span><a id="_idIndexMarker817"/><span class="koboSpan" id="kobo.112.1">Swap as a Partition</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.113.1">As an alternative to designating a file as swap space, entire disk partitions may also be designated as swap. </span><span class="koboSpan" id="kobo.113.2">The steps to achieve this are largely the same as those for adding a swap file. </span><span class="koboSpan" id="kobo.113.3">Before allocating a partition to swap, however, make sure that any existing data on the corresponding filesystem is either backed up or no longer needed and that the filesystem has been unmounted. </span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.114.1">Assuming that a partition exists on a disk drive represented by </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.115.1">/dev/sdb1</span></span><span class="koboSpan" id="kobo.116.1">, for example, the first step would be to convert this into a swap partition, once again using the </span><a id="_idIndexMarker818"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.117.1">mkswap</span></span><span class="koboSpan" id="kobo.118.1"> utility:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.119.1"># mkswap /dev/sdb1</span></p>
<p class="Code"><span class="koboSpan" id="kobo.120.1">mkswap: /dev/sdb1: warning: wiping old xfs signature.</span></p>
<p class="Code"><span class="koboSpan" id="kobo.121.1">Setting up swapspace version 1, size = 8 GiB (8587833344 bytes)</span></p>
<p class="Code"><span class="koboSpan" id="kobo.122.1">no label, UUID=a899c8ec-c410-4569-ba18-ddea03370c7f </span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.123.1">Next, add the new partition to the system swap and verify that it has indeed been added:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.124.1"># swapon /dev/sdb1</span></p>
<p class="Code"><span class="koboSpan" id="kobo.125.1"># swapon</span></p>
<p class="Code"><span class="koboSpan" id="kobo.126.1">NAME      TYPE      SIZE USED PRIO</span></p>
<p class="Code"><span class="koboSpan" id="kobo.127.1">/swap.img file 3.6G 832.5M   -2</span></p>
<p class="Code"><span class="koboSpan" id="kobo.128.1">/dev/sdb1 partition   8G   0B   -3</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.129.1">Once again, the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.130.1">/etc/fstab</span></span><span class="koboSpan" id="kobo.131.1"> file may be modified to automatically add the swap partition at boot time as follows:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.132.1">/dev/sdb1    swap    swap   defaults 0 0</span></p>
<p class="Heading-1-1" id="_idParaDest-329" lang="en-US" xml:lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.133.1">35.6 </span></span><a id="_idTextAnchor522"/><span class="koboSpan" id="kobo.134.1">Adding </span><a id="_idIndexMarker819"/><span class="koboSpan" id="kobo.135.1">Space to an Ubuntu LVM Swap Volume</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.136.1">On systems using Logical Volume Management with swap configured as a logical volume, an alternative to adding swap via file or disk partition is to extend the logical volume used for the swap space. </span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.137.1">The first step is to identify the current amount of swap available and the volume group and logical volume used for the swap space using the </span><a id="_idIndexMarker820"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.138.1">lvdisplay</span></span><span class="koboSpan" id="kobo.139.1"> utility (for more information on LVM, refer to the chapter entitled </span><a href="Volume_Groups.xhtml#_idTextAnchor506"><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.140.1">“Adding a New Disk to an Ubuntu 23.04 Volume Group and Logical Volume”</span></span></a><span class="koboSpan" id="kobo.141.1">):</span></p>
<p class="Code"><span class="koboSpan" id="kobo.142.1"># lvdisplay</span></p>
<p class="Code"><span class="koboSpan" id="kobo.143.1">.</span></p>
<p class="Code"><span class="koboSpan" id="kobo.144.1">.</span></p>
<p class="Code"><span class="koboSpan" id="kobo.145.1">  --- Logical volume ---</span></p>
<p class="Code"><span class="koboSpan" id="kobo.146.1">  LV Path                /dev/ubuntu-vg/swap_1</span></p>
<p class="Code"><span class="koboSpan" id="kobo.147.1">  LV Name                swap_1</span></p>
<p class="Code"><span class="koboSpan" id="kobo.148.1">  VG Name                ubuntu-vg</span></p>
<p class="Code"><span class="koboSpan" id="kobo.149.1">  LV UUID                nJPip0-Q6dx-Mfe3-4Aao-gWAa-swDk-7ZiPdP</span></p>
<p class="Code"><span class="koboSpan" id="kobo.150.1">  LV Write Access        read/write</span></p>
<p class="Code"><span class="koboSpan" id="kobo.151.1">  LV Creation host, time ubuntu, 2020-01-13 13:16:18 -0500</span></p>
<p class="Code"><span class="koboSpan" id="kobo.152.1">  LV Status              available</span></p>
<p class="Code"><span class="koboSpan" id="kobo.153.1">  # open                 2</span></p>
<p class="Code"><span class="koboSpan" id="kobo.154.1">  LV Size                5.00 GiB</span></p>
<p class="Code"><span class="koboSpan" id="kobo.155.1">  Current LE             1280</span></p>
<p class="Code"><span class="koboSpan" id="kobo.156.1">  Segments               1</span></p>
<p class="Code"><span class="koboSpan" id="kobo.157.1">  Allocation             inherit</span></p>
<p class="Code"><span class="koboSpan" id="kobo.158.1">  Read ahead sectors     auto</span></p>
<p class="Code"><span class="koboSpan" id="kobo.159.1">  - currently set to     256</span></p>
<p class="Code"><span class="koboSpan" id="kobo.160.1">  Block device           253:1</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.161.1">Clearly, the swap resides on a logical volume named </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.162.1">swap</span></span><span class="My-Italic CharOverride-1"><span class="koboSpan" id="kobo.163.1">_1</span></span><span class="koboSpan" id="kobo.164.1"> which is part of the volume group named ubuntu-vg. </span><span class="koboSpan" id="kobo.164.2">The next step is to verify if there is any space available on the volume group that can be allocated to the swap volume:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.165.1"># vgs</span></p>
<p class="Code"><span class="koboSpan" id="kobo.166.1">  VG        #PV #LV #SN Attr   VSize   VFree </span></p>
<p class="Code"><span class="koboSpan" id="kobo.167.1">  ubuntu-vg   2   3   0 wz--n- 197.66g &lt;22.00g</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.168.1">If the amount of space available is sufficient to meet additional swap requirements, turn off the swap and extend the swap logical volume to use as much of the available space as needed to meet the system’s swap requirements:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.169.1"># lvextend -L+8GB /dev/ubuntu-vg/swap_1</span></p>
<p class="Code"><span class="koboSpan" id="kobo.170.1">    Logical volume ubuntu_vg/swap_1 successfully resized.</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.171.1">Next, reformat the swap volume and turn the swap back on:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.172.1"># mkswap /dev/ubuntu-vg/swap_1</span></p>
<p class="Code"><span class="koboSpan" id="kobo.173.1">mkswap: /dev/ubuntu-vg/swap_1: warning: wiping old swap signature.</span></p>
<p class="Code"><span class="koboSpan" id="kobo.174.1">Setting up swapspace version 1, size = 12 GiB (12754874368 bytes)</span></p>
<p class="Code"><span class="koboSpan" id="kobo.175.1">no label, UUID=241a4818-e51c-4b8c-9bc9-1697fc2ce26e</span></p>
<p class="Code"><span class="koboSpan" id="kobo.176.1"> </span></p>
<p class="Code"><span class="koboSpan" id="kobo.177.1"># swapon /dev/ubuntu-vg/swap_1</span></p>
<p class="Code"><span class="CharOverride-2" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.178.1">Having made the changes, check that the swap space has increased:</span></span></p>
<p class="Code"><span class="koboSpan" id="kobo.179.1"># swapon</span></p>
<p class="Code"><span class="koboSpan" id="kobo.180.1">NAME      TYPE       SIZE USED PRIO</span></p>
<p class="Code"><span class="koboSpan" id="kobo.181.1">/dev/dm-1 partition  12G   0B   -2</span></p>
<p class="Heading-1-1" id="_idParaDest-330" lang="en-US" xml:lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.182.1">35.7 </span></span><a id="_idTextAnchor523"/><span class="koboSpan" id="kobo.183.1">Adding </span><a id="_idIndexMarker821"/><span class="koboSpan" id="kobo.184.1">Swap Space to the Volume Group</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.185.1">In the above section, we extended the swap logical volume to use space that was already available in the volume group. </span><span class="koboSpan" id="kobo.185.2">If no space is available in the volume group, then it will need to be added before the swap can be extended. </span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.186.1">Begin by checking the status of the volume group:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.187.1"># vgs</span></p>
<p class="Code"><span class="koboSpan" id="kobo.188.1">  VG        #PV #LV #SN Attr   VSize   VFree</span></p>
<p class="Code"><span class="koboSpan" id="kobo.189.1">  ubuntu-vg   1   2   0 wz--n- &lt;73.75g    0</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.190.1">The above output indicates that no space is available within the volume group. </span><span class="koboSpan" id="kobo.190.2">Suppose, however, that we have a requirement to add 8 GB to the swap on the system. </span><span class="koboSpan" id="kobo.190.3">Clearly, this will require the addition of more space to the volume group. </span><span class="koboSpan" id="kobo.190.4">For the purposes of this example, it will be assumed that a disk that is 8 GB in size and represented by </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.191.1">/dev/sdb</span></span><span class="koboSpan" id="kobo.192.1"> is available for addition to the volume group. </span><span class="koboSpan" id="kobo.192.2">The first step is to turn this partition into a physical volume:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.193.1"># pvcreate /dev/sdb</span></p>
<p class="Code"><span class="koboSpan" id="kobo.194.1">  Physical volume "/dev/sdb" successfully created.</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.195.1">If the creation fails with a message similar to “Device /dev/sdb excluded by a filter”, it may be necessary to wipe the disk before creating the physical volume:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.196.1"># wipefs -a /dev/sdb</span></p>
<p class="Code"><span class="koboSpan" id="kobo.197.1">/dev/sdb: 8 bytes were erased at offset 0x00000200 (gpt): 45 46 49 20 50 41 52 54</span></p>
<p class="Code"><span class="koboSpan" id="kobo.198.1">/dev/sdb: 8 bytes were erased at offset 0x1fffffe00 (gpt): 45 46 49 20 50 41 52 54</span></p>
<p class="Code"><span class="koboSpan" id="kobo.199.1">/dev/sdb: 2 bytes were erased at offset 0x000001fe (PMBR): 55 aa</span></p>
<p class="Code"><span class="koboSpan" id="kobo.200.1">/dev/sdb: calling ioctl to re-read partition table: Success</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.201.1">Next, the volume group needs to be extended to use this additional physical volume:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.202.1"># vgextend ubuntu-vg /dev/sdb</span></p>
<p class="Code"><span class="koboSpan" id="kobo.203.1">  Volume group "ubuntu-vg" successfully extended</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.204.1">At this point the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.205.1">vgs</span></span><span class="koboSpan" id="kobo.206.1"> command should report the addition of the 10 GB of space to the volume group:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.207.1"># vgs</span></p>
<p class="Code"><span class="koboSpan" id="kobo.208.1">  VG        #PV #LV #SN Attr   VSize  VFree  </span></p>
<p class="Code"><span class="koboSpan" id="kobo.209.1">  ubuntu-vg   2   2   0 wz--n- 83.74g &lt;10.00g</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.210.1">Now that the additional space is available in the volume group, the swap logical volume may be extended to utilize the space. </span><span class="koboSpan" id="kobo.210.2">First, turn off the swap using the </span><a id="_idIndexMarker822"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.211.1">swapoff</span></span><span class="koboSpan" id="kobo.212.1"> utility:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.213.1"># swapoff /dev/ubuntu-vg/swap_1</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.214.1">Next, extend the logical volume to use the new space:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.215.1"># lvextend -L+9.7GB /dev/ubuntu-vg/swap_1</span></p>
<p class="Code"><span class="koboSpan" id="kobo.216.1">  Rounding size to boundary between physical extents: 9.70 GiB.</span></p>
<p class="Code"><span class="koboSpan" id="kobo.217.1">  Size of logical volume ubuntu-vg/swap_1 changed from 980.00 MiB (245 extents) to 10.66 GiB (2729 extents).</span></p>
<p class="Code"><span class="koboSpan" id="kobo.218.1">  Logical volume ubuntu-vg/swap_1 successfully resized.</span></p>
<p class="Code"><span class="CharOverride-2" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.219.1">Re-create the swap on the logical volume:</span></span></p>
<p class="Code"><span class="koboSpan" id="kobo.220.1"># mkswap /dev/ubuntu-vg/swap_1</span></p>
<p class="Code"><span class="koboSpan" id="kobo.221.1">mkswap: /dev/ubuntu-vg/swap_1: warning: wiping old swap signature.</span></p>
<p class="Code"><span class="koboSpan" id="kobo.222.1">Setting up swapspace version 1, size = 10.7 GiB (11446251520 bytes)</span></p>
<p class="Code"><span class="koboSpan" id="kobo.223.1">no label, UUID=447fb9e5-5473-4f2c-96f8-839b1457d3ed</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.224.1">Next, turn swap back on:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.225.1"># swapon /dev/ubuntu-vg/swap_1</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.226.1">Finally, use the</span><span class="My-Italic _idGenCharOverride-1"> </span><span class="My-Italic CharOverride-1"><a id="_idIndexMarker823"/></span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.227.1">swapon</span></span><span class="koboSpan" id="kobo.228.1"> command to verify the addition of the swap space to the system:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.229.1"># swapon</span></p>
<p class="Code"><span class="koboSpan" id="kobo.230.1">NAME      TYPE       SIZE USED PRIO</span></p>
<p class="Code"><span class="koboSpan" id="kobo.231.1">/dev/dm-1 partition 10.7G   0B   -2</span></p>
<p class="Heading-1-1" id="_idParaDest-331" lang="en-US" xml:lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.232.1">35.8 </span></span><a id="_idTextAnchor524"/><span class="koboSpan" id="kobo.233.1">Summary</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.234.1">Swap space is a vital component of just about any operating system in terms of handling situations where memory resources become constrained. </span><span class="koboSpan" id="kobo.234.2">By swapping out areas of memory to disk, the system is able to continue to function and meet the needs of the processes and applications running on it. </span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.235.1">Ubuntu has a set of guidelines recommending the amount of disk-based swap space that should be allocated depending on the amount of RAM installed in the system. </span><span class="koboSpan" id="kobo.235.2">In situations where these recommendations prove to be insufficient, additional swap space can be added to the system, typically without the need to reboot. </span><span class="koboSpan" id="kobo.235.3">As outlined in this chapter, swap space can be added in the form of a file, disk or disk partition or by extending existing logical volumes that have been configured as swap space. </span></p>
</div>
</body></html>