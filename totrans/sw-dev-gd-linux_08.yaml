- en: '8'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Ownership and Permissions
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this chapter, you’ll learn how users and groups are combined with ownership
    and permissions to create the basic Linux security model. This combination of
    primitives is used to control access to just about everything on a Linux system
    – processes, files, network sockets, devices, and more.
  prefs: []
  type: TYPE_NORMAL
- en: 'First, you’ll get a tour of all the important file information you get from
    a long listing (with an emphasis on permissions, naturally). Then we’ll cover
    the common permissions that you’ll encounter on production Linux systems, and
    finally, we’ll show you all the Linux commands you’ll use to set and modify permissions
    on files. Together, we’ll do the following:'
  prefs: []
  type: TYPE_NORMAL
- en: Decipher the output of a long listing
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Learn about file attributes
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Understand how ownership and permissions work
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Understand a common sticking point, the “octal” permission format
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Learn practical commands for changing ownership and permissions
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Deciphering a long listing
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Let’s dive into this topic by way of a long listing.
  prefs: []
  type: TYPE_NORMAL
- en: 'Sometimes, when you’re navigating around a system, seeing only file and directory
    names isn’t enough. When you want more information about the files you’re seeing,
    use `ls` with its “long” option: `ls -l`.'
  prefs: []
  type: TYPE_NORMAL
- en: 'Here is an example of its output when run on the `/lib` directory of a system.
    Open a terminal and type `ls -l /lib/`:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: We see a lot of interesting information here – let’s step through it, field
    by field.
  prefs: []
  type: TYPE_NORMAL
- en: File attributes
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The first field displays a file’s attributes: file type and permissions. In
    other words, this field shows us which type of file we’re looking at, and what
    its file permissions are. The default lists this information in symbolic mode,
    in contrast to numeric mode, which you can view with `-n`.'
  prefs: []
  type: TYPE_NORMAL
- en: File type
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: The first character here indicates the file type. In the listing above, the
    `-` character indicates a regular file. Lines starting with `l` indicate a *symbolic
    link*, which is simply a special file that has no content of its own, and just
    points to another location on the filesystem. You can think of it as a Windows
    shortcut or a macOS file alias.
  prefs: []
  type: TYPE_NORMAL
- en: Other common file types are `d`, indicating a directory, or `c`, which indicates
    that you’re looking at a character file – you’ll mainly find the latter in `/dev`,
    representing hardware input devices such as keyboards. For more on file types,
    see the *Filesystem* section of *Chapter 5*, *Introducing Files*.
  prefs: []
  type: TYPE_NORMAL
- en: Permissions
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: These are the “permission bits,” which determine which users and groups on the
    system are allowed to read, write, and execute this file. We’ll dive deeper into
    this in the *Permissions* section of this chapter.
  prefs: []
  type: TYPE_NORMAL
- en: Number of hardlinks
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: The next field indicates the number of hard links. Hard links are special pointers
    linking file names to an actual file. So in most situations, this will be 1 for
    files. In contrast to a symbolic link (“symlink”), which points to a filepath,
    a hardlink points to an actual file. If you move the file that a symlink points
    to, this makes the symlink invalid; a hardlink will keep pointing to a file even
    if that file is moved around, renamed, or otherwise modified.
  prefs: []
  type: TYPE_NORMAL
- en: You may have noticed that while most files have only one link pointing to them,
    directories have wildly varying numbers of links in this column. This is because
    each file and directory inside of that directory creates another link reference
    to it. Even an empty directory starts with two links, “.” (the shortcut for “this
    directory”) and “..” (the shortcut for “the directory above this one”).
  prefs: []
  type: TYPE_NORMAL
- en: User ownership
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: The third field shows which user owns the file; all files in our example are
    owned by `root`. While you see a username in this example, running `ls` in numeric
    mode – `ls -ln` – will also show a numeric user ID instead of the friendly username
    you see here.
  prefs: []
  type: TYPE_NORMAL
- en: Group ownership
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: The following field shows the owning group, which also happens to be `root`
    in the example listing above.
  prefs: []
  type: TYPE_NORMAL
- en: File size
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: As you might have guessed, the next field displays the file size. When no additional
    flags are specified, it is displayed in bytes. To make it more readable the `-h`
    (“human-readable”) flag can be used.
  prefs: []
  type: TYPE_NORMAL
- en: 'If you’re paying attention, you’ll have noticed that directories all seem to
    have the same file size, 4096:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: Files can take up as much or as little space as they need, but directory storage
    is allocated in discrete filesystem blocks. Because the smallest blocksize on
    most filesystems is 4096, directories will report their size as 4096.
  prefs: []
  type: TYPE_NORMAL
- en: This rabbit hole goes deeper, but we don’t think the information will be useful
    enough in your day-to-day work as a software engineer to warrant including it
    here. If you’re still curious and want to go deeper, start reading about “Linux
    inodes.”
  prefs: []
  type: TYPE_NORMAL
- en: Modification time
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: Next, we see the modification timestamp of the file – the last time this file
    was changed.
  prefs: []
  type: TYPE_NORMAL
- en: Filename
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs: []
  type: TYPE_PRE
- en: Finally, we come to the filename, which is the only thing you’d see if you were
    doing a regular listing instead of a long listing (`ls` instead of `ls -l`). This
    will usually just be a plain file or directory name, except in the case of a symbolic
    link, or symlink – in that case, you’ll see the symlink name, and the file path
    that it links to.
  prefs: []
  type: TYPE_NORMAL
- en: Ownership
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: To change the owner of files or directories, use the `chown` (change owner)
    command. The syntax is `chown user:group path` where `user` is the name of the
    owning user and `group` is the name of the group, while `path` is the full or
    relative part to the file or directory.
  prefs: []
  type: TYPE_NORMAL
- en: You can omit the colon and the group to just change the owning user and leave
    group ownership alone. Of course, the user attempting to change permissions on
    a file needs to have permission to do so, so in most situations this command will
    be run as the `root` user.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE11]'
  prefs: []
  type: TYPE_PRE
- en: Permissions
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Here’s a single file from our `ls -l` file listing earlier. I’ve tweaked the
    permissions to make this example more illustrative:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE12]'
  prefs: []
  type: TYPE_PRE
- en: 'Specifically, look at the permission bits:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE13]'
  prefs: []
  type: TYPE_PRE
- en: 'They are displayed in three groups of three here. Imagine them separated into
    three groups, to make it easier:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE14]'
  prefs: []
  type: TYPE_PRE
- en: 'Each of these triplets represents read (`r`), write (`w`), and execute (`x`)
    permissions for a specific set of users, based on the user and group ownership
    information for that file. If you see a `-` character in place of a letter, that
    action (for the set of users it applies to) is not permitted. Let’s look at them
    in more detail:'
  prefs: []
  type: TYPE_NORMAL
- en: The first three bits represent the permissions of the file owner. In this case,
    the file’s owner (`root`) can read, write, and execute the file – `rwx`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The second three bits represent permissions for the group owner of the file,
    which in this case is also `root`. The permissions here are `r-x`, or read and
    execute (no writing!). But because `root` is also the user-owner of the file,
    those (more permissive) permissions take precedence; `root` can write to this
    file. The reason you often see permissions like this is because a group owner
    is *required* to be set on files, and if you don’t want to share a file with other
    groups, you can just use the owner’s group here. The group permissions on a file
    are usually less permissive than the owner permissions.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The last three bits represent the permissions that all other system users have
    for this file (“the world”). This is almost always the most restrictive set of
    permissions, because most files don’t need to be shared with anyone outside of
    the owner (and sometimes a separate group owner). In this case, we’re looking
    at a shared library file that needs to be accessible by all system users, so the
    permissions are `r-x` (read and execute, no writing allowed).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Numeric/octal
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '“Read,” “write,” and “execute” are terms that make permissions easy to understand,
    but there is another important way that permissions are represented in Linux and
    Unix: octal.'
  prefs: []
  type: TYPE_NORMAL
- en: As a developer, you’re probably familiar with non-decimal number systems – octal
    is simply a base-8 system (instead of the base-10 system – decimal – that we usually
    use as humans, and in contrast to the base-2 system – binary – that computers
    use).
  prefs: []
  type: TYPE_NORMAL
- en: Because there are only eight possible states for each three-bit permission combination,
    octal is a perfectly efficient system for representing them.
  prefs: []
  type: TYPE_NORMAL
- en: Think of our 9 bits, again divided into 3-bit chunks. Each 3-bit permissions-chunk
    can represent an octal number, which requires three bits to represent. These 9
    bits give us exactly the amount of room that we need to represent three octal
    numbers – one for user permissions, one for group permissions, and one for other/world
    permissions.
  prefs: []
  type: TYPE_NORMAL
- en: '| **Octal** | **Binary** | **Meaning** |'
  prefs: []
  type: TYPE_TB
- en: '| 0 | 0 | **No** permissions (`—`) |'
  prefs: []
  type: TYPE_TB
- en: '| 1 | 1 | **Execute** permission (`–x`) |'
  prefs: []
  type: TYPE_TB
- en: '| 2 | 10 | **Write** permission (`-w-`) |'
  prefs: []
  type: TYPE_TB
- en: '| 3 | 11 | **Write and execute** permissions (`-wx`) |'
  prefs: []
  type: TYPE_TB
- en: '| 4 | 100 | **Read** permission (`r–`) |'
  prefs: []
  type: TYPE_TB
- en: '| 5 | 101 | **Read and execute** permissions (`r-x`) |'
  prefs: []
  type: TYPE_TB
- en: '| 6 | 110 | **Read and write** permissions (`rw-`) |'
  prefs: []
  type: TYPE_TB
- en: '| 7 | 111 | **Read, write, and execute** permissions (`rwx`) |'
  prefs: []
  type: TYPE_TB
- en: 'Table 8.1: Octal permissions'
  prefs: []
  type: TYPE_NORMAL
- en: You’ll notice that this is laid out so that octal addition works – adding “read”
    (4) and “execute” (1) together gives you “read and execute” (5).
  prefs: []
  type: TYPE_NORMAL
- en: This may seem strange and arbitrary (and it is!), but you’ll get the hang of
    it quickly. You’ll mostly be using 7 (all), 6 (read/write), 5 (read/execute),
    4 (read), and 0 (no permissions) while working.
  prefs: []
  type: TYPE_NORMAL
- en: Common permissions
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The most common permissions you’ll see are:'
  prefs: []
  type: TYPE_NORMAL
- en: '`-rw-r--r--` (644): Owner can read and write; all others can only read.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`-rwxr-xr-x` (755): Owner can do everything; all others can read/execute the
    file. This is a common one for executable files like scripts and binaries, and
    the default permission for directories.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`-rw------` (600): Only the owner can read and write, no one else can do anything
    with it. This is common for secret keys, files that contain passwords, and other
    sensitive information. SSH, for example, won’t use keys that are group- or world-readable
    until you change their permissions to make them secret.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Changing ownership (chown) and permissions (chmod)
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'You’ll use two commands to change ownership and permissions on files: `chown`
    and `chmod`.'
  prefs: []
  type: TYPE_NORMAL
- en: Chown
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '`chown` (change owner) is used to change the owner and group of a file. It’s
    used in the following way:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE15]'
  prefs: []
  type: TYPE_PRE
- en: 'For example, imagine we have this file:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE16]'
  prefs: []
  type: TYPE_PRE
- en: Change owner
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Let’s change the owner to `chris` (presuming there’s a `chris` user on the
    system):'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE17]'
  prefs: []
  type: TYPE_PRE
- en: Change owner and group
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'We’ve changed the owner, but if we wanted to change the group, too, we could
    have run:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE18]'
  prefs: []
  type: TYPE_PRE
- en: Recursively change owner and group
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'One common task is changing the owner and group for all files in a given directory.
    You can do this with the `-R` or `--recursive` option:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE19]'
  prefs: []
  type: TYPE_PRE
- en: This will recursively set ownership for `/home/dave/` and every file and directory
    inside it.
  prefs: []
  type: TYPE_NORMAL
- en: Chmod
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '`chmod` (change mode) is used to change the permissions of a file. You can
    use regular or octal permissions here:'
  prefs: []
  type: TYPE_NORMAL
- en: '`chmod [OPTION]... MODE[,MODE]... FILE...`'
  prefs: []
  type: TYPE_NORMAL
- en: '`chmod [OPTION]... OCTAL-MODE FILE...`'
  prefs: []
  type: TYPE_NORMAL
- en: 'Your options can be given in the form: `ugo{+,-}rwx`'
  prefs: []
  type: TYPE_NORMAL
- en: '`ugo` (user, group, other – assumed to be all three if you don’t specify).'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '`+` to add permissions, `-` to remove them.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '`rwx` (read, write, execute – any or all of these letters).'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'For example, to add execute permissions for the user who owns the file:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE20]'
  prefs: []
  type: TYPE_PRE
- en: 'To add write and execute permissions for the group and all other users:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE21]'
  prefs: []
  type: TYPE_PRE
- en: 'Oops, we actually wanted to remove all permissions for others:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE22]'
  prefs: []
  type: TYPE_PRE
- en: 'Octal format for permissions can be set just like you’d expect:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE23]'
  prefs: []
  type: TYPE_PRE
- en: 'Actually, let’s make that file read-only:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE24]'
  prefs: []
  type: TYPE_PRE
- en: Using a reference
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Both `chown` and `chmod` allow us to use a `--reference` argument, with which
    we can pass a file from which ownership or permissions will be copied.
  prefs: []
  type: TYPE_NORMAL
- en: Conclusion
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'In this chapter, we covered everything you need to know to solve the most common
    Linux permissions problems: you learned how to view permissions on files and how
    to modify them. More importantly, we showed you how to reason about permissions
    and how they tie in with Linux users and groups, which is where many people stumble.'
  prefs: []
  type: TYPE_NORMAL
- en: Make sure you have a strong grasp of the material in this chapter; a huge percentage
    of the troubleshooting you’ll have to do during your career will revolve around
    file ownership and permission problems. Thankfully, most of these problems arise
    from a simple lack of understanding, which you no longer have. Go forth and troubleshoot!
  prefs: []
  type: TYPE_NORMAL
- en: Learn more on Discord
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'To join the Discord community for this book – where you can share feedback,
    ask questions to the author, and learn about new releases – follow the QR code
    below:'
  prefs: []
  type: TYPE_NORMAL
- en: '[https://packt.link/SecNet](https://packt.link/SecNet)'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/QR_Code1768422420210094187.png)'
  prefs: []
  type: TYPE_IMG
