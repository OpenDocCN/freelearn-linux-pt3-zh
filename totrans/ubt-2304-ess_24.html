<html><head></head><body>
<div class="_idGenObjectStyleOverride-1" id="_idContainer335">
<p class="Chapter-Title" id="_idParaDest-229" lang="en-US"><span class="ChapterMarker"><span class="koboSpan" id="kobo.1.1">25. </span></span><a id="_idTextAnchor389"/><span class="koboSpan" id="kobo.2.1">Creating KVM Virtual Machines on Ubuntu 23.04 using virt-manager</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.3.1">The previous chapter explored how to create KVM virtual machines on Ubuntu using the Cockpit web tool. </span><span class="koboSpan" id="kobo.3.2">With the caveat that </span><a id="_idIndexMarker601"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.4.1">virt-manager</span></span><span class="koboSpan" id="kobo.5.1"> may one day be discontinued once the Virtual Machines Cockpit extension is fully implemented, this chapter will cover using this tool to create new virtual machines.</span></p>
<p class="Heading-1-1" id="_idParaDest-230" lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.6.1">25.1 </span></span><a id="_idTextAnchor390"/><span class="koboSpan" id="kobo.7.1">Starting the Virtual Machine Manager</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.8.1">If you have not already done so, install the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.9.1">virt-manager</span></span><span class="koboSpan" id="kobo.10.1"> package as follows:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.11.1"># apt install virt-manager</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.12.1">Next, launch Virtual Machine Manager from the command line in a terminal window by running </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.13.1">virt-manager</span></span><span class="koboSpan" id="kobo.14.1">. </span><span class="koboSpan" id="kobo.14.2">Once loaded, the virtual machine manager will prompt for the password of the currently active user before displaying the following screen:</span></p>
<p class="My-Basic-Paragraph ParaOverride-1" lang="en-US"><a id="_idTextAnchor391"/><span class="koboSpan" id="kobo.15.1"><img alt="" class="_idGenObjectAttribute-1" src="image/ubuntu_virt-manager1.jpg"/></span></p>
<p class="Figure-Caption" lang="en-US"><span class="FigureCaptionMarker"><span class="koboSpan" id="kobo.16.1">Figure 25-1</span></span><a id="_idTextAnchor392"/></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.17.1">The main screen lists the current virtual machines running on the system. </span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.18.1">By default, the manager should be connected to the system </span><a id="_idIndexMarker602"/><span class="koboSpan" id="kobo.19.1">libvirtd instance. </span><span class="koboSpan" id="kobo.19.2">If it is not, connect to the host system by right-clicking on the entry in the list and selecting </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.20.1">Connect</span></span><span class="koboSpan" id="kobo.21.1"> from the popup menu. </span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.22.1">To manage session-based virtual machines, select the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.23.1">File -&gt; Add Connection...</span></span><span class="koboSpan" id="kobo.24.1"> menu option to display the dialog shown in </span><a href="KVM_virt-manager.xhtml#_idTextAnchor393"><span class="koboSpan" id="kobo.25.1">Figure 25-2</span></a><span class="koboSpan" id="kobo.26.1">:</span></p>
<p class="My-Basic-Paragraph ParaOverride-1" lang="en-US"><span class="koboSpan" id="kobo.27.1"><img alt="" class="_idGenObjectAttribute-2" src="image/ubuntu_virt-manager_add_connection1.jpg"/></span></p>
<p class="Figure-Caption" lang="en-US"><span class="FigureCaptionMarker"><span class="koboSpan" id="kobo.28.1">Figure 25-2</span></span><a id="_idTextAnchor393"/></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.29.1">Select </span><a id="_idIndexMarker603"/><span class="koboSpan" id="kobo.30.1">QEMU/KVM user session from the Hypervisor menu and click the Connect button within this dialog. </span><span class="koboSpan" id="kobo.30.2">On returning to the main </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.31.1">virt-manager</span></span><span class="koboSpan" id="kobo.32.1"> screen, the QEMU/KVM session should now be listed as shown in </span><a href="KVM_virt-manager.xhtml#_idTextAnchor392"><span class="koboSpan" id="kobo.33.1">Figure 25-1</span></a><span class="koboSpan" id="kobo.34.1"> above.</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.35.1">To create a virtual system, click on the new virtual machine button (the far left button in the toolbar) to display the first screen of the </span><a id="_idIndexMarker604"/><span class="koboSpan" id="kobo.36.1">New VM wizard. </span><span class="koboSpan" id="kobo.36.2">In the Name field, enter a suitably descriptive name for the virtual system. </span><span class="koboSpan" id="kobo.36.3">On this screen, also select the location of the media from which the guest operating system will be installed. </span><span class="koboSpan" id="kobo.36.4">This can either be a CD or DVD drive, an ISO image file accessible to the local host, a network install using HTTP, FTP, NFS, or </span><a id="_idIndexMarker605"/><span class="koboSpan" id="kobo.37.1">PXE, or the disk image from an existing virtual machine: </span></p>
<p class="My-Basic-Paragraph ParaOverride-1" lang="en-US"><span class="koboSpan" id="kobo.38.1"><img alt="" class="_idGenObjectAttribute-3" src="image/ubuntu_virt-manager_iso.jpg"/></span></p>
<p class="Figure-Caption" lang="en-US"><span class="FigureCaptionMarker"><span class="koboSpan" id="kobo.39.1">Figure 25-3</span></span></p>
<p class="Heading-1-1" id="_idParaDest-231" lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.40.1">25.2 </span></span><a id="_idTextAnchor394"/><span class="koboSpan" id="kobo.41.1">Configuring the KVM Virtual System </span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.42.1">Clicking Forward will display a screen seeking additional information about the installation process. </span><span class="koboSpan" id="kobo.42.2">The displayed screen and information required will depend on selections made on the initial screen. </span><span class="koboSpan" id="kobo.42.3">For example, if a CD, DVD, or ISO is selected, this screen will ask for the specific location of the ISO file or physical media device. </span><span class="koboSpan" id="kobo.42.4">This screen also attempts to identify the type and version of the guest operating system (for example, the Windows version or Linux distribution) based on the specified installation media. </span><span class="koboSpan" id="kobo.42.5">If it is unable to do so, turn off the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.43.1">Automatically detect from installation media/source</span></span><span class="koboSpan" id="kobo.44.1"> option, type in the first few characters of the operating system name, and select an option from the list of possible matches: </span></p>
<p class="My-Basic-Paragraph ParaOverride-1" lang="en-US"><span class="koboSpan" id="kobo.45.1"><img alt="" class="_idGenObjectAttribute-4" src="image/ubuntu_virt-manager_iso_selected.jpg"/></span></p>
<p class="Figure-Caption" lang="en-US"><span class="FigureCaptionMarker"><span class="koboSpan" id="kobo.46.1">Figure 25-4</span></span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.47.1">Once these settings are complete, click the Forward button to configure CPU and memory settings. </span><span class="koboSpan" id="kobo.47.2">The optimal settings will depend on the number of CPUs and amount of physical memory present in the host, together with the requirements of other applications and virtual machines that will run in parallel with the new virtual machine: </span></p>
<p class="My-Basic-Paragraph ParaOverride-1" lang="en-US"><span class="koboSpan" id="kobo.48.1"><img alt="" class="_idGenObjectAttribute-5" src="image/ubuntu_virt-manager_memory.jpg"/></span></p>
<p class="Figure-Caption" lang="en-US"><span class="FigureCaptionMarker"><span class="koboSpan" id="kobo.49.1">Figure 25-5</span></span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.50.1">On the next screen, options are available to create an image disk of a specified size, select a pre-existing volume, or create a storage volume of a specified format (raw, </span><a id="_idIndexMarker606"/><span class="koboSpan" id="kobo.51.1">vmdk, ISO, etc.). </span><span class="koboSpan" id="kobo.51.2">Unless you have a specific need to use a particular format (for example, you might need to use vmdk to migrate to a VMware-based virtualization environment at a later date) or need to use a dedicated disk or partition, it is generally adequate to specify a size on this screen: </span></p>
<p class="My-Basic-Paragraph ParaOverride-1" lang="en-US"><span class="koboSpan" id="kobo.52.1"><img alt="" class="_idGenObjectAttribute-6" src="image/ubuntu_virt-manager_storage.jpg"/></span></p>
<p class="Figure-Caption" lang="en-US"><span class="FigureCaptionMarker"><span class="koboSpan" id="kobo.53.1">Figure 25-6</span></span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.54.1">If the default settings are used here, the virtual machine will use a storage volume within the default storage pool for the virtual disk drive. </span><span class="koboSpan" id="kobo.54.2">To use the custom “MyPool” </span><a id="_idIndexMarker607"/><span class="koboSpan" id="kobo.55.1">storage pool created in the preceding chapter, enable the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.56.1">Select or create custom storage</span></span><span class="koboSpan" id="kobo.57.1"> option before clicking the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.58.1">Manage...</span></span><span class="koboSpan" id="kobo.59.1"> button. </span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.60.1">In the storage volume dialog, select the MyPool entry in the left-hand panel, followed by the + button in the main panel to create a new storage volume:</span></p>
<p class="My-Basic-Paragraph ParaOverride-1" lang="en-US"><span class="koboSpan" id="kobo.61.1"><img alt="" class="_idGenObjectAttribute-7" src="image/ubuntu_virt-manager_select_pool.jpg"/></span></p>
<p class="Figure-Caption" lang="en-US"><span class="FigureCaptionMarker"><span class="koboSpan" id="kobo.62.1">Figure 25-7</span></span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.63.1">Note that the + button in the bottom left-hand corner of the dialog may also be used to create new storage pools as an alternative to using the Cockpit interface.</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.64.1">In the configuration screen (</span><a href="KVM_virt-manager.xhtml#_idTextAnchor395"><span class="koboSpan" id="kobo.65.1">Figure 25-8</span></a><span class="koboSpan" id="kobo.66.1">), name the storage volume, select the volume size, and click on the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.67.1">Finish</span></span><span class="koboSpan" id="kobo.68.1"> button to create the volume and assign it to the virtual machine: </span></p>
<p class="My-Basic-Paragraph ParaOverride-1" lang="en-US"><span class="koboSpan" id="kobo.69.1"><img alt="" class="_idGenObjectAttribute-8" src="image/ubuntu_virt_manager_volume.jpg"/></span></p>
<p class="Figure-Caption" lang="en-US"><span class="FigureCaptionMarker"><span class="koboSpan" id="kobo.70.1">Figure 25-8</span></span><a id="_idTextAnchor395"/></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.71.1">Once these settings are configured, select the new volume and click the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.72.1">Choose Volume </span></span><span class="koboSpan" id="kobo.73.1">button. </span><span class="koboSpan" id="kobo.73.2">Then, click the Forward button once more. </span><span class="koboSpan" id="kobo.73.3">The final screen displays a summary of the configuration. </span><span class="koboSpan" id="kobo.73.4">Review the information displayed. </span><span class="koboSpan" id="kobo.73.5">Advanced options are also available to change the virtual network configuration for the guest, as shown in </span><a href="KVM_virt-manager.xhtml#_idTextAnchor396"><span class="koboSpan" id="kobo.74.1">Figure 25-9</span></a><span class="koboSpan" id="kobo.75.1">:</span></p>
<p class="My-Basic-Paragraph ParaOverride-1" lang="en-US"><span class="koboSpan" id="kobo.76.1"><img alt="" class="_idGenObjectAttribute-9" src="image/ubuntu_virt_manager_finish.jpg"/></span></p>
<p class="Figure-Caption" lang="en-US"><span class="FigureCaptionMarker"><span class="koboSpan" id="kobo.77.1">Figure 25-9</span></span><a id="_idTextAnchor396"/></p>
<p class="Heading-1-1" id="_idParaDest-232" lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.78.1">25.3 </span></span><a id="_idTextAnchor397"/><span class="koboSpan" id="kobo.79.1">Starting the KVM Virtual Machine </span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.80.1">Click on the Finish button to begin the creation process. </span><span class="koboSpan" id="kobo.80.2">The virtualization manager will create the disk and configure the virtual machine before starting the guest system. </span><span class="koboSpan" id="kobo.80.3">Finally, the new virtual machine will appear in the main </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.81.1">virt-manager</span></span><span class="koboSpan" id="kobo.82.1"> window with the status set to </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.83.1">Running</span></span><span class="koboSpan" id="kobo.84.1"> as illustrated in </span><a href="KVM_virt-manager.xhtml#_idTextAnchor398"><span class="koboSpan" id="kobo.85.1">Figure 25-10</span></a><span class="koboSpan" id="kobo.86.1">:</span></p>
<p class="My-Basic-Paragraph ParaOverride-1" lang="en-US"><span class="koboSpan" id="kobo.87.1"><img alt="" class="_idGenObjectAttribute-10" src="image/ubuntu_virt_manager_vm_running.jpg"/></span></p>
<p class="Figure-Caption" lang="en-US"><span class="FigureCaptionMarker"><span class="koboSpan" id="kobo.88.1">Figure 25-10</span></span><a id="_idTextAnchor398"/></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.89.1">By default, the console for the virtual machine should appear in the virtual machine viewer window. </span><span class="koboSpan" id="kobo.89.2">To view the console of the running machine at any future time, ensure that it is selected in the virtual machine list and select the Open button from the toolbar. </span><span class="koboSpan" id="kobo.89.3">The virtual machine viewer should be ready for the installation process to begin:</span></p>
<p class="My-Basic-Paragraph ParaOverride-1" lang="en-US"><span class="koboSpan" id="kobo.90.1"><img alt="" class="_idGenObjectAttribute-11" src="image/ubuntu_virt-manager_guest_console.jpg"/></span></p>
<p class="Figure-Caption" lang="en-US"><span class="FigureCaptionMarker"><span class="koboSpan" id="kobo.91.1">Figure 25-11</span></span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.92.1">From now on, follow the installation instructions to install the guest OS in the KVM virtual machine. </span></p>
<p class="Heading-1-1" id="_idParaDest-233" lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.93.1">25.4 </span></span><a id="_idTextAnchor399"/><span class="koboSpan" id="kobo.94.1">Summary</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.95.1">There are several ways to create new KVM-based virtual machines on an Ubuntu host system. </span><span class="koboSpan" id="kobo.95.2">This chapter uses the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.96.1">virt-manager</span></span><span class="koboSpan" id="kobo.97.1"> graphical tool to create, configure, and run a guest operating system, including creating a new storage volume. </span><span class="koboSpan" id="kobo.97.2">With these basics covered, the next chapter will cover the creation of virtual machines from the command line. </span></p>
</div>
</body></html>