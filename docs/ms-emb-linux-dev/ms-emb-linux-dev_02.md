# 1

# 开始

你即将开始你的下一个项目，这次，它将运行 Linux。在你动手之前，你应该考虑什么？让我们首先从高层次上了解嵌入式 Linux，看看它为何受欢迎，开源许可证的含义是什么，以及你需要什么样的硬件来运行它。

Linux 在 1999 年左右首次成为嵌入式设备的可行选择。那时，AXIS 发布了 2100 网络摄像头，TiVo 发布了他们的首个**数字视频录制器**（**DVR**）。这两款设备都是各自类别中首批使用 Linux 的设备。从 1999 年起，Linux 逐渐流行起来，直到今天，它成为了许多产品类别的**操作系统**（**OS**）首选。到 2024 年，运行 Linux 的设备已超过三十亿台。这包括所有运行 Android 系统的智能手机，Android 使用的是 Linux 内核，以及数亿台机顶盒、智能电视和 Wi-Fi 路由器。我们不能忽视其他设备，例如车辆诊断设备、工业设备和医疗监测设备，这些设备的出货量较小。

本章将涵盖以下主题：

+   选择 Linux

+   什么时候不选择 Linux

+   了解相关参与者

+   项目生命周期的推进

+   探索开源

+   为嵌入式 Linux 选择硬件

+   获取本书所需的硬件

+   配置开发环境

# 选择 Linux

为什么 Linux 如此普及？为什么像电视机这样简单的设备需要运行如此复杂的 Linux，只是为了在屏幕上显示流媒体视频？

简单的答案是**摩尔定律**。英特尔的联合创始人戈登·摩尔在 1965 年观察到，芯片上元件的密度大约每两年翻一番。这一规律适用于我们日常生活中设计和使用的设备，就像它适用于台式机、笔记本电脑和服务器一样。大多数嵌入式设备的核心是一个高度集成的芯片，芯片包含一个或多个处理器核心，并与主内存、大容量存储器和各种外设进行接口。这被称为**系统级芯片**（**SoC**）。SoC 的复杂性随着摩尔定律的推进不断增加。一个典型的 SoC 有一个技术参考手册，内容可能达到几千页。

你的电视机不再像旧款模拟电视那样只显示视频流。这个视频流是数字的，可能是加密的，并且需要处理才能生成图像。你的电视机（或者很快会）连接到互联网。它可以接收来自智能手机、平板电脑、笔记本电脑、台式机和家庭媒体服务器的内容。它可以用来玩游戏、播放视频流和显示来自安全摄像头的实时画面。你需要一个完整的操作系统来管理这种复杂度。

这里是一些推动 Linux 采用的要点：

+   Linux 具备所需的功能。它有一个良好的调度器、优秀的网络栈、对 USB、Wi-Fi、蓝牙、多种存储介质、多媒体设备等的支持，能够满足所有需求。

+   Linux 已经被移植到广泛的处理器架构上，包括在 SoC 设计中非常常见的一些架构——Arm、RISC-V、x86、PowerPC 和 MIPS。

+   Linux 是开源的，因此你有自由获取源代码并根据需求进行修改。你或代表你工作的人可以为你的设备创建板级支持包。你可以添加缺失的协议、特性和技术，也可以删除不需要的功能，以减少内存和存储需求。Linux 非常灵活。

+   Linux 拥有一个活跃的社区（以 Linux 内核为例，社区非常活跃）。每 8 到 10 周就会发布一次新内核版本，每个版本都包含来自 1,000 多位开发者的代码。活跃的社区意味着 Linux 能保持最新，并支持当前的硬件、协议和标准。Linux 基金会是一个非盈利组织，得到了大科技公司的支持。

除了 Linux，Linux 基金会还为多个主要的开源项目提供支持，包括 Kubernetes 和 PyTorch。它还在全球举办年度活动，如开源峰会和 Linux Plumbers 大会。

+   开源许可证保证你可以访问源代码。没有供应商锁定。

正因如此，Linux 是复杂设备的理想选择。但在这里我需要提几个注意事项。复杂性使得它更难理解。加上快速发展的开发进程和开源的去中心化结构，你需要投入一些精力学习如何使用它，并且随着它的变化不断学习。我希望这本书能帮助你这一过程。

# 何时不选择 Linux

Linux 适合你的项目吗？当要解决的问题足够复杂时，Linux 非常适用。特别是在需要连接性、鲁棒性和复杂用户界面的场合，Linux 表现得尤为出色。然而，它并不能解决所有问题，因此在你深入之前需要考虑以下几个方面：

+   你的硬件能胜任工作吗？与传统的**实时操作系统**（**RTOS**），如 VxWorks 或 QNX 相比，Linux 需要更多的资源。它至少需要一个 32 位处理器和更多的内存。我将在*为嵌入式 Linux 选择硬件*部分中详细讲解。

+   你拥有合适的技能吗？项目的早期阶段，尤其是板级启动，需要对 Linux 以及它如何与硬件关联有详细了解。同样，在调试和优化应用时，你需要能够解读结果。如果你的团队没有相关技能，可能需要外包一些工作。当然，阅读本书会有所帮助！

+   你的系统是实时的吗？只要你注意一些细节，Linux 可以处理许多实时活动，我在*第二十一章*中深入讨论了这些内容。

+   你的代码是否需要监管批准（医疗、汽车、航空航天等）？合规验证和确认的负担可能使得选择其他操作系统成为更好的选择。即使你选择在这些环境中使用 Linux，购买一款已经为类似产品提供 Linux 发行版的商业公司提供的发行版可能也更有意义。这些商业 Linux 厂商包括西门子、Timesys 和 Wind River。

仔细考虑这些要点。成功的最佳指示器可能是寻找类似的 Linux 运行产品，看看它们是如何做的，并遵循最佳实践。

# 了解各方参与者

开源软件从哪里来？谁编写它？特别是，它如何与嵌入式开发的关键组件——工具链、引导加载程序、内核以及根文件系统中的基本实用程序相关联？

+   **开源社区**：毕竟，这是生成你将使用的软件的引擎。这个社区是一个松散的开发者联盟，其中许多人通过非营利组织、学术机构或商业公司获得资助。他们共同合作推动各个项目的目标。这个社区非常庞大，有很多不同规模的项目。我们将使用的一些项目包括 Linux 本身、U-Boot、BusyBox、Buildroot、Yocto 项目以及许多 GNU 旗下的项目。

+   **CPU 架构师**：这些是设计我们使用的 CPU 的组织。这里重要的有 Arm/Linaro（Arm Cortex-A）、英特尔（x86 和 x86-64）、SiFive（RISC-V）和 IBM（PowerPC）。它们实现或至少影响对基本 CPU 架构的支持。

+   **SoC 厂商**：这些包括博通、英特尔、Microchip、NXP、高通、TI 等公司。它们从 CPU 架构师处获取内核和工具链，并修改它们以支持自己的芯片。它们还创建参考板：用于下一层级创建开发板和工作产品的设计。

+   **板卡厂商和 OEM**：这些公司从 SoC 厂商那里获取参考设计，并将其构建成特定的产品，如机顶盒或摄像头。它们还创建更多通用的开发板，如 Advantech 和 Kontron 的产品。一个重要类别是便宜的 **单板计算机** (**SBC**) 如 BeagleBoard 和 Raspberry Pi，它们已经创建了自己的软件和硬件附加组件生态系统。

+   **商业 Linux 厂商**：如西门子、Timesys 和 Wind River 等公司提供经过严格合规验证的商业 Linux 发行版，这些发行版已在多个行业（医疗、汽车、航空航天等）中得到验证和确认。

这些形成了一条链条，通常你的项目处于链条的末端，这意味着你没有自由选择组件的余地。除非在极少数情况下，否则你不能直接从 kernel.org 获取最新的内核，因为它不支持你正在使用的芯片或板卡。

这是嵌入式开发中的一个持续性问题。理想情况下，每个链条中的开发人员都会推动他们的更改上游，但实际情况并非如此。开发人员时刻面临时间压力，将补丁合并到 Linux 内核中需要付出极大的努力。不少内核存在许多尚未合并的补丁。此外，SoC 供应商通常仅对其最新芯片积极开发开源组件，这意味着对任何两年以上的芯片的支持将被冻结，并且不会接收任何更新。

结果是大多数嵌入式设计基于旧版软件。它们不会接收安全补丁、性能增强或者新版本中的功能。像 Heartbleed（OpenSSL 库的漏洞）和 Shellshock（Bash shell 的漏洞）这样的问题未得到修复。

你能做些什么？首先，请向你的供应商（如 NXP、TI 和 Xilinx 等）提问：他们的更新政策是什么，他们多久更新一次内核版本，当前内核版本是什么，之前的版本是什么，以及他们的上游合并政策是什么？一些供应商在这方面取得了显著进展。你应该偏爱他们的芯片。

其次，您可以采取措施提高自给自足能力。*第一部分*的章节详细说明了依赖关系，并展示了您可以自助的地方。不要仅仅接受 SoC 或板卡供应商提供的包并盲目使用，而不考虑其他选择。

# 项目生命周期的推进

本书分为五个部分，反映了项目的各个阶段。这些阶段不一定是顺序的。通常它们是重叠的，你需要回头重新审视先前完成的事情。然而，它们代表了开发者在项目进展过程中关注的重点。

+   *嵌入式 Linux 要素（第 1 到 5 章）*将帮助您设置开发环境，并为后续阶段创建一个工作平台。这通常被称为**板级启动**阶段。

+   *构建嵌入式 Linux 镜像（第 6 到 8 章）*展示了如何通过利用 Buildroot 或 The Yocto Project 等构建系统自动化构建嵌入式 Linux 镜像的过程。自动化复杂的构建任务可以加速项目生命周期，使团队能够在更短的时间内交付更高质量的产品。

+   *系统架构与设计选择（第 9 到 14 章）*将为您提供一些关于程序和数据存储、如何在内核设备驱动程序和应用程序之间分工，以及如何初始化系统的设计决策。

+   *开发应用程序（第 15 到 18 章）* 向你展示如何打包和部署 Python 应用程序，如何有效利用 Linux 的进程和线程模型，并在资源受限的设备上管理内存。打包和部署 Python 应用程序与嵌入式 Linux 有什么关系呢？答案是“关系不大”，但请记住，本书的标题中也恰好有“开发”这个词。而且*第 15 和 16 章*完全与现代软件开发有关。

+   *调试与性能优化（第 19 到 21 章）* 描述了如何在应用程序和内核中跟踪、分析和调试你的代码。最后一章解释了当需要时如何为实时行为进行设计。

现在，让我们集中讨论本书第一部分中涉及的嵌入式 Linux 四个基本元素。

# 嵌入式 Linux 的四个元素

每个项目都始于获取、定制和部署这四个元素：工具链、引导加载程序、内核和根文件系统。这是本书第一部分的内容。

+   **工具链**：这是交叉编译器和其他创建目标设备代码所需的工具。交叉编译器在不同的主机 CPU 架构上运行时，生成目标 CPU 架构的机器码。

+   **引导加载程序**：这是一个裸机程序，用于初始化板卡和 Linux 内核。“裸机”一词意味着该程序直接运行在 CPU 上，而不是在操作系统之上。

+   **内核**：这是系统的核心，管理系统资源并与硬件进行交互。

+   **根文件系统**：它包含了内核初始化完成后运行的库和程序。

这里还有一个未提到的第五个元素，那就是特定于嵌入式应用程序的程序集合，它使得设备能够执行预定的功能，无论是称重商品、播放电影、控制机器人还是飞行无人机。

通常，当你购买 SoC 或板卡时，你会获得这些元素中的部分或全部作为一个软件包。但由于前面提到的原因，这些可能不是最适合你的选择。在前八章中，我将为你提供背景知识，以帮助你做出正确的选择，并介绍两种能够自动化整个过程的工具：Buildroot 和 Yocto 项目。

# 浏览开源

嵌入式 Linux 的组件是*开源的*，所以现在是时候考虑一下开源意味着什么，开源许可证为什么会这样运作，以及这将如何影响你将要基于它创建的、通常是专有的嵌入式设备。

## 许可证

在谈论开源时，“*免费*”这个词经常被提及。对于新接触这个话题的人来说，他们通常认为它意味着“*无需付费*”，而开源软件许可证确实保证你可以免费使用软件来开发和部署系统。然而，这里的更重要的含义是自由，因为你可以自由地获取源代码，按照自己的需要进行修改，并在其他系统中重新部署它。开源许可证赋予你这种权利，但一些许可证还要求你将这些修改与公众共享。

与免费软件许可证进行比较，这类许可证允许你免费复制二进制文件，但不提供源代码。其他许可证允许你在特定条件下免费使用软件，例如用于个人用途，但不允许商业用途。这些都不是开源。

为了帮助你理解与开源许可证相关的影响，我将提供以下评论，但我要指出的是，我是一名工程师，不是律师。接下来是我对这些许可证的理解以及它们的解释方式。

开源许可证大致分为两类：

+   *Copyleft* 许可证，如 GNU **通用公共许可证**（**GPL**）

+   宽松许可证，如 **BSD** 和 **MIT** 许可证

宽松许可证本质上说，你可以修改源代码并在你选择的系统中使用它，只要你不以任何方式修改许可证的条款。换句话说，除了这一条限制之外，你可以随意使用它，包括将其构建到可能的专有系统中。

GPL 许可证相似，但有一些条款要求你将获取和修改软件的权利传递给最终用户。换句话说，你需要共享源代码。一种选择是通过将其上传到公共服务器使其完全公开。另一种选择是通过书面方式向最终用户提供代码，按照要求提供。

GPL 进一步规定，你不能将 GPL 代码并入专有程序。任何尝试这样做的行为都会使整个程序适用 GPL。换句话说，你不能在同一个程序中将 GPL 代码和专有代码结合起来。除了 Linux 内核，GNU 编译器集合（GCC）和 GNU 调试器（GDB），以及与 GNU 项目相关的许多其他自由工具，都是 GPL 许可证下的内容。

那么，库文件如何呢？如果它们采用 GPL 许可证，则与它们链接的任何程序也会成为 GPL 程序。然而，大多数库是采用 GNU **较宽松通用公共许可证**（**LGPL**）进行授权的。如果是这种情况，你可以从专有程序中与它们进行链接。

**重要提示**

上述描述全部与 GPL v2 和 LGPL v2 相关。我应该提到最新版本的 GPL v3 和 LGPL v3。这些版本有争议，我承认我并不完全理解其含义。然而，GPL v3 和 LGPL v3 的目的是确保系统中的 GPL v3 和 LGPL v3 组件可以被最终用户替换，这符合开放源代码软件的精神，适用于每个人。

然而，GPL v3 和 LGPL v3 也存在一些问题。存在安全隐患。如果设备的拥有者可以访问系统代码，那么不受欢迎的入侵者也可能访问。通常的防御措施是通过诸如厂商等权威机构对内核映像进行签名，以避免未经授权的更新。这是否侵犯了我修改设备的权利？意见不一。

**重要说明**

TiVo 机顶盒是这场辩论中的一个重要部分。它使用一个 Linux 内核，该内核根据 GPL v2 许可发布。为了遵守许可，TiVo 已经发布了他们版本的内核源代码。TiVo 还有一个启动加载程序，该加载程序只会加载由他们签名的内核二进制文件。因此，你可以为 TiVo 盒子构建一个修改版的内核，但无法在硬件上加载它。

**自由软件基金会**（**FSF**）的立场是，这种做法不符合开放源代码软件的精神，并将其称为 **TiVo 化**。GPL v3 和 LGPL v3 的编写目的就是为了防止这种情况的发生。一些项目，特别是 Linux 内核，一直不愿意采用 GPL v3 许可证，因为它对设备制造商施加了限制。

# 为嵌入式 Linux 选择硬件

如果你正在为嵌入式 Linux 项目设计或选择硬件，你应该注意什么？

+   首先，选择一个被内核支持的 CPU 架构——除非你计划自己添加一个新的架构！查看 Linux 5.15 的源代码，你会看到有 23 个架构，每个架构都在 `arch/` 目录中有一个子目录。它们都是 32 位或 64 位架构，大多数有 MMU，有些则没有。在嵌入式设备中最常见的架构是 Arm、RISC-V、PowerPC、MIPS 和 x86，它们都有 32 位和 64 位版本，且都配有 **内存管理单元**（**MMU**）。

+   本书大部分内容是以这类处理器为基础编写的。还有另一类处理器没有 MMU，并运行一种被称为 **微控制器 Linux** 或 **uClinux** 的 Linux 子集。这些处理器架构包括 **ARC**（**阿戈诺特 RISC 核心**）、Blackfin、MicroBlaze 和 Nios。我会不时提到 uClinux，但不会深入讨论，因为它是一个相对专门化的类型。

+   第二，你将需要适量的 RAM。16 MB 是一个不错的最低值，尽管实际上用一半的内存也完全可以运行 Linux。如果你愿意为优化系统的每个部分付出努力，甚至可以用 4 MB 来运行 Linux。甚至可能能更低，但到了某个临界点，它就不再是 Linux 了。

+   第三，存在非易失性存储，通常是闪存。8 MB 足以满足简单设备的需求，如网络摄像头或基础路由器。与 RAM 类似，如果你真的愿意，你可以在较小的存储空间下创建一个可用的 Linux 系统，但存储越小，操作就越困难。Linux 对闪存存储设备有广泛的支持，包括原始的 NOR 和 NAND 闪存芯片，以及以 SD 卡、eMMC 芯片、USB 闪存等形式存在的管理闪存。

+   第四，串口非常有用，最好是基于 UART 的串口。它不一定要安装在生产板上，但会使板子的启动、调试和开发变得更加容易。

+   第五，你需要某种方式来加载软件，从零开始时尤其如此。许多微控制器板上配备了 **联合测试行动组**（**JTAG**）接口，专门用于此目的。现代 SoC 也可以直接从可移动介质加载启动代码，特别是 SD 卡和 microSD 卡，或像 QSPI 或 USB 这样的串行接口。

除了这些基本要素外，设备还需要与其工作所需的特定硬件进行接口。主线 Linux 提供了许多不同设备的开源驱动程序，并且来自 SoC 制造商和第三方芯片 OEM 的驱动程序（质量不同）也可供使用，后者可能会在设计中包含。

记住我关于某些厂商承诺和能力的评论。作为嵌入式系统的开发者，你会发现自己花了很多时间评估和适配第三方代码（如果有的话），或者如果没有，你需要与厂商沟通。最后，你必须为设备特有的接口编写设备支持，或者找人来做这件事。

# 获取本书所需硬件

本书中的示例旨在具有通用性。为了使它们更具相关性和易于跟随，我不得不选择特定的硬件。我选择了三种典型设备：树莓派 4、BeaglePlay 和 QEMU。第一种设备无疑是市场上最流行的基于 Arm 的单板计算机。第二种设备是广泛可用的单板计算机，也可以用于严肃的嵌入式硬件。第三种设备是机器仿真器，可以用于创建典型的嵌入式硬件系统。

曾一度想仅使用 QEMU，但像所有仿真一样，它与真实硬件有所不同。使用 Raspberry Pi 4 和 BeaglePlay，你能够与真实硬件互动，看到真实的 LED 闪烁。与 Raspberry Pi 4 不同，BeaglePlay 和之前的 BeagleBone Black 一样，都是 *开源硬件*。这意味着板卡设计材料是公开的，任何人都可以将 BeaglePlay 或其衍生品嵌入到他们的产品中。

无论如何，我鼓励你尽可能多地尝试这些示例，无论是使用这三种平台中的任何一种，还是使用你手头的任何嵌入式硬件。

## Raspberry Pi 4

从 2019 年 6 月到 2023 年 10 月，Raspberry Pi 4 Model B 一直是由 Raspberry Pi 基金会生产的旗舰 SBC。Raspberry Pi 4 的技术规格包括以下内容：

+   Broadcom BCM2711 1.5 GHz 四核 Cortex-A72（Arm v8）64 位 SoC

+   2, 4 或 8 GB DDR4 RAM

+   2.4 GHz 和 5 GHz 802.11ac 无线，蓝牙 5.0，BLE

+   用于调试和开发的串口

+   一个 microSD 卡槽，可以用作启动设备

+   一个 USB-C 连接器，用于为开发板供电

+   两个全尺寸 USB 3.0 和两个全尺寸 USB 2.0 主机端口

+   一个千兆以太网端口

+   两个 micro HDMI 端口，用于视频和音频输出

此外，还提供一个 40 针扩展头，可以连接多种被称为 **硬件附加在顶部**（**HATs**）的子板，允许你将开发板适配成许多不同的用途。然而，在本书中的示例中，你不需要任何 HATs。

除了开发板本身，你还需要以下设备：

+   一张 microSD 卡以及一种从开发 PC 或笔记本电脑写入它的方式

+   一根带有 3.3 V 逻辑电平的 USB 到 TTL 串口线

+   一个 5 V USB-C 电源，能够提供 3 A 电流

+   一根以太网线和一个路由器来连接，因为一些示例需要网络连接

## BeaglePlay

BeaglePlay 是由 BeagleBoard.org 基金会生产的一款开源硬件设计的 SBC（单板计算机）。该规格的主要特点如下：

+   TI AM6254 1.4 GHz 四核 Cortex-A53（Arm v8）64 位 Sitara SoC

+   2 GB DDR4 RAM

+   板载 16 GB eMMC 闪存

+   2.4 GHz 和 5 GHz MIMO Wi-Fi, BLE, Zigbee

+   用于调试和开发的串口

+   一个 microSD 卡槽，可以用作启动设备

+   一个 USB-C 连接器，用于为开发板供电

+   一个全尺寸 USB 2.0 主机端口

+   一个千兆以太网端口

+   一个全尺寸 HDMI 端口，用于视频和音频输出

BeaglePlay 采用 mikroBUS、Grove 和 Qwiic 接口来连接附加板，而不是采用大型扩展头。

除了开发板本身，你还需要以下设备：

+   一张 microSD 卡以及一种从开发 PC 或笔记本电脑写入它的方式

+   一根带有 3.3 V 逻辑电平的 USB 到 TTL 串口线

+   一个 5 V USB-C 电源，能够提供 3 A 电流

+   一根以太网线和一个路由器来连接，因为一些示例需要网络连接

除了上述内容，*第十二章*还要求以下内容：

+   一块 MikroE-5764 GNSS 7 Click 扩展板

+   一个带有 SMA 连接器的外部主动 GNSS 天线

+   一块 MikroE-5546 Environment Click 扩展板

+   一块 MikroE-5545 OLED C Click 扩展板

## QEMU

QEMU 是一个机器模拟器。它有不同的版本，每个版本可以模拟一种处理器架构以及使用该架构构建的各种板子。例如，我们有以下几种：

+   `qemu-system-arm`：32 位 Arm

+   `qemu-system-aarch64`：64 位 Arm

+   `qemu-system-mips`：MIPS

+   `qemu-system-ppc`：Power PC

+   `qemu-system-x86`：x86 和 x86-64

对于每种架构，QEMU 模拟了一系列硬件，你可以通过使用`-machine help`选项查看。每种架构模拟了该板上通常会找到的大多数硬件。还有选项将硬件链接到本地资源，例如使用本地文件作为模拟的磁盘驱动器。这里是一个具体的例子：

```
$ qemu-system-arm -machine vexpress-a9 -m 256M -drive file=rootfs.ext4,sd -net nic -net use -kernel zImage -dtb vexpress-v2p-ca9.dtb -append "console=ttyAMA0,115200 root=/dev/mmcblk0" -serial stdio -net nic,model=lan9118 -net tap,ifname=tap0 
```

**重要提示**

上述命令不打算执行，并且会失败，因为`qemu-system-arm`未安装，并且`rootfs.ext4.sd`、`zImage`和`vexpress-v2p-ca9.dtb`文件在你的主机系统中不存在。这只是一个供我们展开讨论的示例。

上述命令行中使用的选项如下：

+   `-machine vexpress -a9`：创建一个具有 Cortex-A9 处理器的 Arm Versatile Express 开发板的仿真。

+   `-m 256M`：分配 256 MB 的 RAM。

+   `-drive file=rootfs.ext4,sd`：将 SD 接口连接到本地的`rootfs.ext4`文件，该文件包含文件系统映像。

+   `-kernel zImage`：从本地名为`zImage`的文件加载 Linux 内核。

+   `-dtb vexpress-v2p-ca9.dtb`：从本地的`vexpress-v2p-ca9.dtb`文件加载设备树。

+   `-append "…" `：将引号中的字符串追加为内核命令行。

+   `-serial stdio`：将串口连接到启动 QEMU 的终端，这样你就可以通过串口控制台登录到模拟的机器。

+   `-net nic,model=lan9118`：创建一个网络接口。

+   `-net tap,ifname=tap0`：将网络接口连接到虚拟网络接口`tap0`。

要配置主机端的网络，你需要 **User Mode Linux** (**UML**) 项目中的 `tunctl` 命令。在 Debian 和 Ubuntu 上，软件包名为 `uml-utilities`：

```
$ sudo tunctl -u $(whoami) -t tap0 
```

这会创建一个名为`tap0`的网络接口，并将其连接到模拟 QEMU 机器中的网络控制器。你可以像配置任何其他网络接口一样配置`tap0`。

所有这些选项将在接下来的章节中进行描述。我将在大多数示例中使用 Versatile Express，但应该很容易使用不同的机器或架构。

# 配置你的开发环境

我只使用了开源软件作为开发工具和目标操作系统/应用程序。我假设你将在开发系统上使用 Linux。

我使用 Ubuntu 24.04 LTS 测试了所有的主机命令，因此我建议在整本书中使用该版本，以避免出现意外问题。

除了 Ubuntu，The Yocto Project 只支持少数几个 Linux 发行版：Fedora、Debian、openSUSE、AlmaLinux 和 Rocky。如果你无法使用 Ubuntu，请确保选择这些支持的发行版来进行 The Yocto Project 的练习。

# 总结

嵌入式硬件继续按照摩尔定律的发展趋势变得越来越复杂。Linux 拥有高效利用硬件的能力和灵活性。我们将共同学习如何利用这一力量，从而构建出令用户满意的强大产品。本书将带领你经历嵌入式项目生命周期的五个阶段，从嵌入式 Linux 的四个元素开始。

嵌入式平台的种类繁多，并且开发进度迅速，这导致了软件的孤立池。在许多情况下，你将依赖这些软件，特别是由 SoC 或主板厂商提供的 Linux 内核，以及在较小程度上，工具链。

一些 SoC 制造商在推动他们的更改上游时变得更加高效，且这些更改的维护也变得更加容易。尽管有这些改进，选择适合的硬件来进行嵌入式 Linux 项目仍然是一项充满风险的挑战。开源许可证合规性是你在构建嵌入式 Linux 生态系统中的产品时需要关注的另一个话题。

在本章中，你将了解本书中将使用的硬件和一些软件（即 QEMU）。随后，我们将探讨一些强大的工具，帮助你为设备创建和维护软件。我们将介绍 Buildroot，并深入讲解 The Yocto Project。在我们深入研究这些构建工具之前，我们将拆解嵌入式 Linux 的四个元素，你可以将其应用于所有嵌入式 Linux 项目，无论它们是如何构建的。

# 加入我们社区的 Discord 频道

加入我们社区的 Discord 频道，与作者和其他读者讨论： [`packt.link/embeddedsystems`](https://packt.link/embeddedsystems)

![](img/QR_Code12308107448340296.png)
