<html><head></head><body>
<div id="_idContainer028">
<h1 class="chapter-number" id="_idParaDest-36"><a id="_idTextAnchor056"/><span class="koboSpan" id="kobo.1.1">3</span></h1>
<h1 id="_idParaDest-37"><a id="_idTextAnchor057"/><span class="koboSpan" id="kobo.2.1">Using Toaster to Bake an Image</span></h1>
<p><span class="koboSpan" id="kobo.3.1">Now that we know how to build an image using BitBake within Poky, we will learn how to do the same using Toaster. </span><span class="koboSpan" id="kobo.3.2">We are going to focus on the most straightforward usage of Toaster and also </span><a id="_idTextAnchor058"/><span class="koboSpan" id="kobo.4.1">cover what else it can do so that you know about </span><span class="No-Break"><span class="koboSpan" id="kobo.5.1">its capabilities.</span></span></p>
<h1 id="_idParaDest-38"><a id="_idTextAnchor059"/><span class="koboSpan" id="kobo.6.1">What is Toaster?</span></h1>
<p><strong class="bold"><span class="koboSpan" id="kobo.7.1">Toaster</span></strong><span class="koboSpan" id="kobo.8.1"> is a web interface to </span><a id="_idIndexMarker055"/><span class="koboSpan" id="kobo.9.1">configure and run builds. </span><span class="koboSpan" id="kobo.9.2">It communicates with the BitBake and Poky build system to manage and gather information about the builds, packages, </span><span class="No-Break"><span class="koboSpan" id="kobo.10.1">and images.</span></span></p>
<p><span class="koboSpan" id="kobo.11.1">There are two ways </span><a id="_idIndexMarker056"/><span class="koboSpan" id="kobo.12.1">to </span><span class="No-Break"><span class="koboSpan" id="kobo.13.1">use Toaster:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.14.1">Locally</span></strong><span class="koboSpan" id="kobo.15.1">: We can run Toaster as a local instance, suitable for single-user development, providing a graphical interface to the BitBake command lines and some </span><span class="No-Break"><span class="koboSpan" id="kobo.16.1">build information.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.17.1">Hosted</span></strong><span class="koboSpan" id="kobo.18.1">: This is suitable for multiple users. </span><span class="koboSpan" id="kobo.18.2">The Toaster servers build and store the users’ artifacts. </span><span class="koboSpan" id="kobo.18.3">Its components can be spread across several machines when using a </span><span class="No-Break"><span class="koboSpan" id="kobo.19.1">hosted instance.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.20.1">In this chapter, we </span><a id="_idIndexMarker057"/><span class="koboSpan" id="kobo.21.1">will use Toaster as a local instance. </span><span class="koboSpan" id="kobo.21.2">However, if you want to use it as a hosted instance, please visit the following website for instructions – </span><em class="italic"><span class="koboSpan" id="kobo.22.1">Toaster </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.23.1">Manual</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.24.1"> (</span></span><a href="https://docs.yoctoproject.org/4.0.4/toaster-manual/index.html"><span class="No-Break"><span class="koboSpan" id="kobo.25.1">https://docs.yoctoproject.org/4.0.4/toaster-manual/index.html</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.26.1">).</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.27.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.28.1">Bear in mind that every hosted service requires attention to its security. </span><span class="koboSpan" id="kobo.28.2">Think about this before using a </span><span class="No-Break"><span class="koboSpan" id="kobo.29.1">hosted instanc</span><a id="_idTextAnchor060"/><a id="_idTextAnchor061"/><span class="koboSpan" id="kobo.30.1">e.</span></span></p>
<h1 id="_idParaDest-39"><a id="_idTextAnchor062"/><span class="koboSpan" id="kobo.31.1">Installing Toaster</span></h1>
<p><span class="koboSpan" id="kobo.32.1">Toaster uses the Python Django framework. </span><span class="koboSpan" id="kobo.32.2">The easiest way to install it is by using Python’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.33.1">pip</span></strong><span class="koboSpan" id="kobo.34.1"> utility. </span><span class="koboSpan" id="kobo.34.2">We </span><a id="_idIndexMarker058"/><span class="koboSpan" id="kobo.35.1">already installed this when configuring our host machine in </span><a href="B19361_02.xhtml#_idTextAnchor031"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.36.1">Chapter 2</span></em></span></a><span class="koboSpan" id="kobo.37.1">,</span><em class="italic"><span class="koboSpan" id="kobo.38.1"> Baking Our Poky-Based System</span></em><span class="koboSpan" id="kobo.39.1">. </span><span class="koboSpan" id="kobo.39.2">We can now install the rest of Toaster’s requirements inside the Poky source directory by running the </span><span class="No-Break"><span class="koboSpan" id="kobo.40.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.41.1">
$ pip3 install --user -r bitbake/toaster-requirements.</span><a id="_idTextAnchor063"/><a id="_idTextAnchor064"/><span class="koboSpan" id="kobo.42.1">txt</span></pre>
<h1 id="_idParaDest-40"><a id="_idTextAnchor065"/><span class="koboSpan" id="kobo.43.1">Starting Toaster</span></h1>
<p><span class="koboSpan" id="kobo.44.1">Once we have installed </span><a id="_idIndexMarker059"/><span class="koboSpan" id="kobo.45.1">Toaster’s requirements, we are ready to start its server. </span><span class="koboSpan" id="kobo.45.2">To do this, we should go to Poky’s directory and run the </span><span class="No-Break"><span class="koboSpan" id="kobo.46.1">following commands:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.47.1">
$ source oe-init-build-env
$ source toaster start</span></pre>
<p><span class="koboSpan" id="kobo.48.1">The commands take some time to finish. </span><span class="koboSpan" id="kobo.48.2">When everything is set up, the web server is started. </span><span class="koboSpan" id="kobo.48.3">The result is shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.49.1">following figure.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer017">
<span class="koboSpan" id="kobo.50.1"><img alt="Figure 3.1 – The result of the source toaster startup" src="image/Figure_3.01_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.51.1">Figure 3.1 – The result of the source toaster startup</span></p>
<p><span class="koboSpan" id="kobo.52.1">To access the </span><a id="_idIndexMarker060"/><span class="koboSpan" id="kobo.53.1">Toaster web interface, open your favorite browser and enter </span><span class="No-Break"><span class="koboSpan" id="kobo.54.1">the following:</span></span></p>
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.55.1">http://127.0.0.1:8000</span></strong></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.56.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.57.1">By default, Toaster starts on port </span><strong class="source-inline"><span class="koboSpan" id="kobo.58.1">8000</span></strong><span class="koboSpan" id="kobo.59.1">. </span><span class="koboSpan" id="kobo.59.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.60.1">webport</span></strong><span class="koboSpan" id="kobo.61.1"> parameter lets you use a different port – for example, </span><strong class="source-inline"><span class="koboSpan" id="kobo.62.1">$ source toaster </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.63.1">start webport=8400</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.64.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.65.1">Next, we can see the starting page </span><span class="No-Break"><span class="koboSpan" id="kobo.66.1">of Toaster:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer018">
<span class="koboSpan" id="kobo.67.1"><img alt="Figure 3.2 – The Toaster welcome p﻿﻿age" src="image/Figure_3.02_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.68.1">Figure 3.2 – The Toaster welcome p</span><a id="_idTextAnchor066"/><a id="_idTextAnchor067"/><span class="koboSpan" id="kobo.69.1">age</span></p>
<h1 id="_idParaDest-41"><a id="_idTextAnchor068"/><span class="koboSpan" id="kobo.70.1">Building an image for QEMU</span></h1>
<p><span class="koboSpan" id="kobo.71.1">Following </span><a id="_idIndexMarker061"/><span class="koboSpan" id="kobo.72.1">the same steps used in </span><a href="B19361_02.xhtml#_idTextAnchor031"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.73.1">Chapter 2</span></em></span></a><span class="koboSpan" id="kobo.74.1">, </span><em class="italic"><span class="koboSpan" id="kobo.75.1">Baking Our Poky-Based System</span></em><span class="koboSpan" id="kobo.76.1">, we </span><a id="_idIndexMarker062"/><span class="koboSpan" id="kobo.77.1">will build an image of the QEMU </span><span class="No-Break"><span class="koboSpan" id="kobo.78.1">x86-64 emulation.</span></span></p>
<p><span class="koboSpan" id="kobo.79.1">Since we currently don’t have a project, a collection of configurations and builds, we need to start one. </span><span class="koboSpan" id="kobo.79.2">Create a project name and choose the target release, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.80.1">following screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer019">
<span class="koboSpan" id="kobo.81.1"><img alt="Figure 3.3 – Creating a new project with Toaster" src="image/Figure_3.03_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.82.1">Figure 3.3 – Creating a new project with Toaster</span></p>
<p><span class="koboSpan" id="kobo.83.1">After </span><a id="_idIndexMarker063"/><span class="koboSpan" id="kobo.84.1">creating </span><strong class="bold"><span class="koboSpan" id="kobo.85.1">my-first-project</span></strong><span class="koboSpan" id="kobo.86.1">, we can see the main project screen, as </span><a id="_idIndexMarker064"/><span class="koboSpan" id="kobo.87.1">shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.88.1">following screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer020">
<span class="koboSpan" id="kobo.89.1"><img alt="Figure 3.4 – The first page of the project" src="image/Figure_3.04_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.90.1">Figure 3.4 – The first page of the project</span></p>
<p><span class="koboSpan" id="kobo.91.1">While </span><a id="_idIndexMarker065"/><span class="koboSpan" id="kobo.92.1">on the </span><strong class="bold"><span class="koboSpan" id="kobo.93.1">Configuration</span></strong><span class="koboSpan" id="kobo.94.1"> tab, go to </span><strong class="bold"><span class="koboSpan" id="kobo.95.1">Machine</span></strong><span class="koboSpan" id="kobo.96.1"> and change </span><a id="_idIndexMarker066"/><span class="koboSpan" id="kobo.97.1">the target machine </span><span class="No-Break"><span class="koboSpan" id="kobo.98.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.99.1">qemux86-64</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.100.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer021">
<span class="koboSpan" id="kobo.101.1"><img alt="Figure 3.5 – How to choose the target machine" src="image/Figure_3.05_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.102.1">Figure 3.5 – How to choose the target machine</span></p>
<p><span class="koboSpan" id="kobo.103.1">After </span><a id="_idIndexMarker067"/><span class="koboSpan" id="kobo.104.1">that, click the </span><strong class="bold"><span class="koboSpan" id="kobo.105.1">Image recipes</span></strong><span class="koboSpan" id="kobo.106.1"> tab to choose the image you </span><a id="_idIndexMarker068"/><span class="koboSpan" id="kobo.107.1">want to build. </span><span class="koboSpan" id="kobo.107.2">In this example, as used in </span><a href="B19361_02.xhtml#_idTextAnchor031"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.108.1">Chapter 2</span></em></span></a><span class="koboSpan" id="kobo.109.1">, </span><em class="italic"><span class="koboSpan" id="kobo.110.1">Baking Our Poky-Based System</span></em><span class="koboSpan" id="kobo.111.1">, we can </span><span class="No-Break"><span class="koboSpan" id="kobo.112.1">build </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.113.1">core-image-full-cmdline</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.114.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer022">
<span class="koboSpan" id="kobo.115.1"><img alt="Figure 3.6 – How to find an image using Search" src="image/Figure_3.06_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.116.1">Figure 3.6 – How to find an image using Search</span></p>
<p><span class="koboSpan" id="kobo.117.1">The following </span><a id="_idIndexMarker069"/><span class="koboSpan" id="kobo.118.1">screenshot shows </span><a id="_idIndexMarker070"/><span class="koboSpan" id="kobo.119.1">the </span><span class="No-Break"><span class="koboSpan" id="kobo.120.1">build process:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer023">
<span class="koboSpan" id="kobo.121.1"><img alt="Figure 3.7 – Toaster during the image build" src="image/Figure_3.07_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.122.1">Figure 3.7 – Toaster during the image build</span></p>
<p><span class="koboSpan" id="kobo.123.1">The build process </span><a id="_idIndexMarker071"/><span class="koboSpan" id="kobo.124.1">takes some time, but after that, we can see the built image </span><a id="_idIndexMarker072"/><span class="koboSpan" id="kobo.125.1">along with some statistics, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.126.1">following screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer024">
<span class="koboSpan" id="kobo.127.1"><img alt="Figure 3.8 – The image build artifact report" src="image/Figure_3.08_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.128.1">Figure 3.8 – The image build artifact report</span></p>
<p><span class="koboSpan" id="kobo.129.1">We can also </span><a id="_idIndexMarker073"/><span class="koboSpan" id="kobo.130.1">verify the generated set of files, as shown in the </span><a id="_idIndexMarker074"/><span class="No-Break"><span class="koboSpan" id="kobo.131.1">following screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer025">
<span class="koboSpan" id="kobo.132.1"><img alt="Figure 3.9 – The core-image-full-cmdline directory structure as shown in Toaster" src="image/Figure_3.09_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.133.1">Figure 3.9 – The core-image-full-cmdline directory structure as shown in Toaster</span></p>
<p><span class="koboSpan" id="kobo.134.1">Toaster is a powerful tool. </span><span class="koboSpan" id="kobo.134.2">You can </span><a id="_idIndexMarker075"/><span class="koboSpan" id="kobo.135.1">use it on a local development machine or a shared server to get a graphic </span><a id="_idIndexMarker076"/><span class="koboSpan" id="kobo.136.1">representation of the build. </span><span class="koboSpan" id="kobo.136.2">You can return to the </span><a id="_idIndexMarker077"/><span class="koboSpan" id="kobo.137.1">terminal where you started Toaster to run </span><strong class="source-inline"><span class="koboSpan" id="kobo.138.1">runqemu qemux86-64 core-image-full-cmdline</span></strong><span class="koboSpan" id="kobo.139.1">. </span><span class="koboSpan" id="kobo.139.2">You will see what is shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.140.1">following screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer026">
<span class="koboSpan" id="kobo.141.1"><img alt="Figure 3.10 – The QEMU screen during the Linux kernel boot" src="image/Figure_3.10_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.142.1">Figure 3.10 – The QEMU screen during the Linux kernel boot</span></p>
<p><span class="koboSpan" id="kobo.143.1">After finishing </span><a id="_idIndexMarker078"/><span class="koboSpan" id="kobo.144.1">the Linux booting, you will see a login prompt, as </span><a id="_idIndexMarker079"/><span class="koboSpan" id="kobo.145.1">shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.146.1">Figure 3</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.147.1">.11</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.148.1">.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer027">
<span class="koboSpan" id="kobo.149.1"><img alt="Figure 3.11 – The QEMU screen during user login" src="image/Figure_3.11_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.150.1">Figure 3.11 – The QEMU screen during user login</span></p>
<p><span class="koboSpan" id="kobo.151.1">We can </span><a id="_idIndexMarker080"/><span class="koboSpan" id="kobo.152.1">log in to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.153.1">root</span></strong><span class="koboSpan" id="kobo.154.1"> account </span><a id="_idIndexMarker081"/><span class="koboSpan" id="kobo.155.1">using an </span><a id="_idTextAnchor069"/><span class="No-Break"><span class="koboSpan" id="kobo.156.1">empty password.</span></span></p>
<h1 id="_idParaDest-42"><a id="_idTextAnchor070"/><span class="koboSpan" id="kobo.157.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.158.1">In this chapter, we introduced Toaster and its essential features. </span><span class="koboSpan" id="kobo.158.2">Then, we went through installing and configuring Toaster and built and inspected </span><span class="No-Break"><span class="koboSpan" id="kobo.159.1">an image.</span></span></p>
<p><span class="koboSpan" id="kobo.160.1">In the next chapter, we will go through some critical BitBake concepts. </span><span class="koboSpan" id="kobo.160.2">We believe these concepts are essential to understanding the Yocto Project. </span><span class="koboSpan" id="kobo.160.3">We will use BitBake and the command line for the rest of the book, as they provide a view of all </span><span class="No-Break"><span class="koboSpan" id="kobo.161.1">the concepts.</span></span></p>
</div>
<div>
<div class="IMG---Figure" id="_idContainer029">
</div>
</div>
</body></html>