<html><head></head><body>
<div id="_idContainer100">
<h1 class="chapter-number" id="_idParaDest-82"><a id="_idTextAnchor110"/><span class="koboSpan" id="kobo.1.1">8</span></h1>
<h1 id="_idParaDest-83"><a id="_idTextAnchor111"/><span class="koboSpan" id="kobo.2.1">Diving into BitBake Metadata</span></h1>
<p><span class="koboSpan" id="kobo.3.1">At this point in this book, we know how to generate images and packages and how to use package feeds – basically, everything we must know for the simple usage of Poky. </span><span class="koboSpan" id="kobo.3.2">Hereafter, we will learn how to control the behavior of Poky to accomplish our goals and achieve maximum benefit from the Yocto Project as </span><span class="No-Break"><span class="koboSpan" id="kobo.4.1">a whole.</span></span></p>
<p><span class="koboSpan" id="kobo.5.1">This chapter will help enhance our understanding of the BitBake metadata syntax. </span><span class="koboSpan" id="kobo.5.2">We will learn to use the BitBake operators to alter the content of variables, variable expansions, and so on. </span><span class="koboSpan" id="kobo.5.3">These are the key concepts we can use to make our recipes and the customization that we will learn about in the </span><span class="No-Break"><span class="koboSpan" id="kobo.6.1">following chapters.</span></span></p>
<h1 id="_idParaDest-84"><a id="_idTextAnchor112"/><span class="koboSpan" id="kobo.7.1">Understanding BitBake’s metadata</span></h1>
<p><span class="koboSpan" id="kobo.8.1">The amount of metadata</span><a id="_idIndexMarker178"/><span class="koboSpan" id="kobo.9.1"> used by BitBake is enormous. </span><span class="koboSpan" id="kobo.9.2">Therefore, to get the maximum benefit from Poky, we must master it. </span><span class="koboSpan" id="kobo.9.3">As we learned in </span><a href="B19361_04.xhtml#_idTextAnchor071"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.10.1">Chapter 4</span></em></span></a><span class="koboSpan" id="kobo.11.1">, </span><em class="italic"><span class="koboSpan" id="kobo.12.1">Meeting the BitBake Tool</span></em><span class="koboSpan" id="kobo.13.1">, metadata covers three </span><span class="No-Break"><span class="koboSpan" id="kobo.14.1">major areas:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.15.1">Configuration</span></strong><span class="koboSpan" id="kobo.16.1"> (the </span><strong class="source-inline"><span class="koboSpan" id="kobo.17.1">.conf</span></strong><span class="koboSpan" id="kobo.18.1"> files): The configuration files</span><a id="_idIndexMarker179"/><span class="koboSpan" id="kobo.19.1"> define the global content</span><a id="_idIndexMarker180"/><span class="koboSpan" id="kobo.20.1"> that configures</span><a id="_idIndexMarker181"/><span class="koboSpan" id="kobo.21.1"> how the classes and recipes </span><span class="No-Break"><span class="koboSpan" id="kobo.22.1">will work.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.23.1">Classes</span></strong><span class="koboSpan" id="kobo.24.1"> (the </span><strong class="source-inline"><span class="koboSpan" id="kobo.25.1">.bbclass</span></strong><span class="koboSpan" id="kobo.26.1"> files): Classes can be inherited</span><a id="_idIndexMarker182"/><span class="koboSpan" id="kobo.27.1"> for easier</span><a id="_idIndexMarker183"/><span class="koboSpan" id="kobo.28.1"> maintenance</span><a id="_idIndexMarker184"/><span class="koboSpan" id="kobo.29.1"> and to promote code reuse and avoid </span><span class="No-Break"><span class="koboSpan" id="kobo.30.1">code duplication.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.31.1">Recipes</span></strong><span class="koboSpan" id="kobo.32.1"> (the </span><strong class="source-inline"><span class="koboSpan" id="kobo.33.1">.bb</span></strong><span class="koboSpan" id="kobo.34.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.35.1">.bbappend</span></strong><span class="koboSpan" id="kobo.36.1"> files): The recipes</span><a id="_idIndexMarker185"/><span class="koboSpan" id="kobo.37.1"> describe the tasks</span><a id="_idIndexMarker186"/><span class="koboSpan" id="kobo.38.1"> to be run and provide the required information</span><a id="_idIndexMarker187"/><span class="koboSpan" id="kobo.39.1"> to allow BitBake to generate</span><a id="_idIndexMarker188"/><span class="koboSpan" id="kobo.40.1"> the required task chain. </span><span class="koboSpan" id="kobo.40.2">They are the most commonly used metadata, as they define the variables and tasks for the recipes. </span><span class="koboSpan" id="kobo.40.3">The most common types of recipes generate packages </span><span class="No-Break"><span class="koboSpan" id="kobo.41.1">and images.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.42.1">The classes and recipes use a mix of Python and Shell Script code, which is parsed by BitBake, generating a massive number of tasks and local states that must still be executed after </span><span class="No-Break"><span class="koboSpan" id="kobo.43.1">being parsed.</span></span></p>
<p><span class="koboSpan" id="kobo.44.1">We will also learn about the operators and essential concepts we need to build </span><span class="No-Break"><span class="koboSpan" id="kobo.45.1">our recipes.</span></span></p>
<h2 id="_idParaDest-85"><a id="_idTextAnchor113"/><span class="koboSpan" id="kobo.46.1">Working with metadata</span></h2>
<p><span class="koboSpan" id="kobo.47.1">The syntax used by BitBake metadata</span><a id="_idIndexMarker189"/><span class="koboSpan" id="kobo.48.1"> can be misleading and sometimes hard to trace. </span><span class="koboSpan" id="kobo.48.2">However, we can check the value of each variable in BitBake-generated, pre-processed recipe data by using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.49.1">bitbake</span></strong><span class="koboSpan" id="kobo.50.1"> option (</span><strong class="source-inline"><span class="koboSpan" id="kobo.51.1">-e</span></strong><span class="koboSpan" id="kobo.52.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.53.1">--environment</span></strong><span class="koboSpan" id="kobo.54.1">), </span><span class="No-Break"><span class="koboSpan" id="kobo.55.1">as follows:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer073">
<span class="koboSpan" id="kobo.56.1"><img alt="Figure 8.1 – How to display the BitBake environment" src="image/Figure_8.01_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.57.1">Figure 8.1 – How to display the BitBake environment</span></p>
<p><span class="koboSpan" id="kobo.58.1">To understand</span><a id="_idIndexMarker190"/><span class="koboSpan" id="kobo.59.1"> how BitBake works, please refer to </span><em class="italic"><span class="koboSpan" id="kobo.60.1">BitBake User Manual</span></em><span class="koboSpan" id="kobo.61.1"> (</span><a href="https://docs.yoctoproject.org/bitbake/2.0"><span class="koboSpan" id="kobo.62.1">https://docs.yoctoproject.org/bitbake/2.0</span></a><span class="koboSpan" id="kobo.63.1">). </span><span class="koboSpan" id="kobo.63.2">The following sections will show most of the syntax commonly used </span><span class="No-Break"><span class="koboSpan" id="kobo.64.1">in recipes.</span></span></p>
<h3><span class="koboSpan" id="kobo.65.1">The basic variable assignment</span></h3>
<p><span class="koboSpan" id="kobo.66.1">The assignment</span><a id="_idIndexMarker191"/><span class="koboSpan" id="kobo.67.1"> of a variable</span><a id="_idIndexMarker192"/><span class="koboSpan" id="kobo.68.1"> can be done as </span><span class="No-Break"><span class="koboSpan" id="kobo.69.1">shown here:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer074">
<span class="koboSpan" id="kobo.70.1"><img alt="Figure 8.2 – An example of a variable assignment" src="image/Figure_8.02_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.71.1">Figure 8.2 – An example of a variable assignment</span></p>
<p><span class="koboSpan" id="kobo.72.1">In the preceding example, the value of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.73.1">FOO</span></strong><span class="koboSpan" id="kobo.74.1"> variable is assigned to </span><strong class="source-inline"><span class="koboSpan" id="kobo.75.1">bar</span></strong><span class="koboSpan" id="kobo.76.1">. </span><span class="koboSpan" id="kobo.76.2">Variable assignment is core to the BitBake metadata syntax, as most examples </span><span class="No-Break"><span class="koboSpan" id="kobo.77.1">use variables.</span></span></p>
<h3><span class="koboSpan" id="kobo.78.1">The variable expansion</span></h3>
<p><span class="koboSpan" id="kobo.79.1">BitBake supports variable</span><a id="_idIndexMarker193"/><span class="koboSpan" id="kobo.80.1"> referencing. </span><span class="koboSpan" id="kobo.80.2">The syntax closely</span><a id="_idIndexMarker194"/><span class="koboSpan" id="kobo.81.1"> resembles Shell Script, such as </span><span class="No-Break"><span class="koboSpan" id="kobo.82.1">the following:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer075">
<span class="koboSpan" id="kobo.83.1"><img alt="Figure 8.3 – An example of variable expansion" src="image/Figure_8.03_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.84.1">Figure 8.3 – An example of variable expansion</span></p>
<p><span class="koboSpan" id="kobo.85.1">The preceding example results in </span><strong class="source-inline"><span class="koboSpan" id="kobo.86.1">A</span></strong><span class="koboSpan" id="kobo.87.1"> containing </span><strong class="source-inline"><span class="koboSpan" id="kobo.88.1">aValue</span></strong><span class="koboSpan" id="kobo.89.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.90.1">B</span></strong><span class="koboSpan" id="kobo.91.1"> containing </span><strong class="source-inline"><span class="koboSpan" id="kobo.92.1">before-aValue-after</span></strong><span class="koboSpan" id="kobo.93.1">. </span><span class="koboSpan" id="kobo.93.2">An important thing to bear in mind is that the variable only expands when it is used, as </span><span class="No-Break"><span class="koboSpan" id="kobo.94.1">shown here:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer076">
<span class="koboSpan" id="kobo.95.1"><img alt="Figure 8.4 – The variables are only expanded when used" src="image/Figure_8.04_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.96.1">Figure 8.4 – The variables are only expanded when used</span></p>
<p><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.97.1">Figure 8</span></em></span><em class="italic"><span class="koboSpan" id="kobo.98.1">.4</span></em><span class="koboSpan" id="kobo.99.1"> illustrates the </span><em class="italic"><span class="koboSpan" id="kobo.100.1">lazy evaluation</span></em><span class="koboSpan" id="kobo.101.1"> used by BitBake evaluation. </span><span class="koboSpan" id="kobo.101.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.102.1">B</span></strong><span class="koboSpan" id="kobo.103.1"> variable</span><a id="_idIndexMarker195"/><span class="koboSpan" id="kobo.104.1"> value is </span><strong class="source-inline"><span class="koboSpan" id="kobo.105.1">before-${A}-after</span></strong><span class="koboSpan" id="kobo.106.1"> until a task </span><a id="_idIndexMarker196"/><span class="koboSpan" id="kobo.107.1">requires the variable</span><a id="_idIndexMarker197"/><span class="koboSpan" id="kobo.108.1"> value. </span><span class="koboSpan" id="kobo.108.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.109.1">A</span></strong><span class="koboSpan" id="kobo.110.1"> variable has been assigned to </span><strong class="source-inline"><span class="koboSpan" id="kobo.111.1">aNewValue</span></strong><span class="koboSpan" id="kobo.112.1"> in line 3; consequently, </span><strong class="source-inline"><span class="koboSpan" id="kobo.113.1">B</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.114.1">evaluates </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.115.1">before-aNewValue-after</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.116.1">.</span></span></p>
<h3><span class="koboSpan" id="kobo.117.1">Assigning a value if the variable is unassigned, using ?=</span></h3>
<p><span class="koboSpan" id="kobo.118.1">When there is a need</span><a id="_idIndexMarker198"/><span class="koboSpan" id="kobo.119.1"> to assign</span><a id="_idIndexMarker199"/><span class="koboSpan" id="kobo.120.1"> a variable only</span><a id="_idIndexMarker200"/><span class="koboSpan" id="kobo.121.1"> if the variable is still unassigned, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.122.1">?=</span></strong><span class="koboSpan" id="kobo.123.1"> operator can be used. </span><span class="koboSpan" id="kobo.123.2">The following code shows </span><span class="No-Break"><span class="koboSpan" id="kobo.124.1">its use:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer077">
<span class="koboSpan" id="kobo.125.1"><img alt="Figure 8.5 – An example of value" src="image/Figure_8.05_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.126.1">Figure 8.5 – An example of value</span></p>
<p><span class="koboSpan" id="kobo.127.1">The same behavior happens if there are multiple </span><strong class="source-inline"><span class="koboSpan" id="kobo.128.1">?=</span></strong><span class="koboSpan" id="kobo.129.1"> assignments to a single variable. </span><span class="koboSpan" id="kobo.129.2">The first use of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.130.1">?=</span></strong><span class="koboSpan" id="kobo.131.1"> operator is responsible for assigning the variable. </span><span class="koboSpan" id="kobo.131.2">Let’s look at the </span><span class="No-Break"><span class="koboSpan" id="kobo.132.1">following example:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer078">
<span class="koboSpan" id="kobo.133.1"><img alt="Figure 8.6 – An example of a second assignment being ignored" src="image/Figure_8.06_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.134.1">Figure 8.6 – An example of a second assignment being ignored</span></p>
<p><span class="koboSpan" id="kobo.135.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.136.1">A</span></strong><span class="koboSpan" id="kobo.137.1"> variable has been assigned to </span><strong class="source-inline"><span class="koboSpan" id="kobo.138.1">value</span></strong><span class="koboSpan" id="kobo.139.1"> on line 1, before the assignment of </span><strong class="source-inline"><span class="koboSpan" id="kobo.140.1">ignoredAsAlreadyAssigned</span></strong><span class="koboSpan" id="kobo.141.1"> on line 2, which </span><span class="No-Break"><span class="koboSpan" id="kobo.142.1">is ignored.</span></span></p>
<p><span class="koboSpan" id="kobo.143.1">We need to consider that the </span><strong class="source-inline"><span class="koboSpan" id="kobo.144.1">=</span></strong><span class="koboSpan" id="kobo.145.1"> operator is stronger than the </span><strong class="source-inline"><span class="koboSpan" id="kobo.146.1">?=</span></strong><span class="koboSpan" id="kobo.147.1"> operator, as it assigns the value independently of the previous variable state, as </span><span class="No-Break"><span class="koboSpan" id="kobo.148.1">shown here:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer079">
<span class="koboSpan" id="kobo.149.1"><img alt="Figure 8.7 – An example showing that the ?= operator is weaker than the = operator" src="image/Figure_8.07_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.150.1">Figure 8.7 – An example showing that the ?= operator is weaker than the = operator</span></p>
<p><span class="koboSpan" id="kobo.151.1">Hence, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.152.1">A</span></strong><span class="koboSpan" id="kobo.153.1"> variable</span><a id="_idIndexMarker201"/><span class="koboSpan" id="kobo.154.1"> is</span><a id="_idIndexMarker202"/><span class="koboSpan" id="kobo.155.1"> assigned</span><a id="_idIndexMarker203"/> <span class="No-Break"><span class="koboSpan" id="kobo.156.1">as </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.157.1">changeValue</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.158.1">.</span></span></p>
<h3><span class="koboSpan" id="kobo.159.1">Assigning a default value using ??=</span></h3>
<p><span class="koboSpan" id="kobo.160.1">Using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.161.1">??=</span></strong><span class="koboSpan" id="kobo.162.1"> operator is intended</span><a id="_idIndexMarker204"/><span class="koboSpan" id="kobo.163.1"> to provide a default value</span><a id="_idIndexMarker205"/><span class="koboSpan" id="kobo.164.1"> for a variable</span><a id="_idIndexMarker206"/><span class="koboSpan" id="kobo.165.1"> and is a weaker version of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.166.1">?=</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.167.1">operator.</span></span></p>
<p><span class="koboSpan" id="kobo.168.1">Check out the </span><span class="No-Break"><span class="koboSpan" id="kobo.169.1">following code:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer080">
<span class="koboSpan" id="kobo.170.1"><img alt="Figure 8.8 – An example of how default values are assigned" src="image/Figure_8.08_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.171.1">Figure 8.8 – An example of how default values are assigned</span></p>
<p><span class="koboSpan" id="kobo.172.1">In line 1, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.173.1">A</span></strong><span class="koboSpan" id="kobo.174.1"> default value is assigned to </span><strong class="source-inline"><span class="koboSpan" id="kobo.175.1">firstValue</span></strong><span class="koboSpan" id="kobo.176.1">, and then in line 2, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.177.1">A</span></strong><span class="koboSpan" id="kobo.178.1"> default value is changed to </span><strong class="source-inline"><span class="koboSpan" id="kobo.179.1">secondValue</span></strong><span class="koboSpan" id="kobo.180.1">. </span><span class="koboSpan" id="kobo.180.2">As no other assignment is made to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.181.1">A</span></strong><span class="koboSpan" id="kobo.182.1"> variable, the final value </span><span class="No-Break"><span class="koboSpan" id="kobo.183.1">is </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.184.1">secondValue</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.185.1">.</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.186.1">?=</span></strong><span class="koboSpan" id="kobo.187.1"> is an assignment operator, as seen before, and takes precedence over the </span><strong class="source-inline"><span class="koboSpan" id="kobo.188.1">??=</span></strong><span class="koboSpan" id="kobo.189.1"> operator, as can be seen in the </span><span class="No-Break"><span class="koboSpan" id="kobo.190.1">following example:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer081">
<span class="koboSpan" id="kobo.191.1"><img alt="Figure 8.9 – An example of the ??= operator being weaker than the ?= operator" src="image/Figure_8.09_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.192.1">Figure 8.9 – An example of the ??= operator being weaker than the ?= operator</span></p>
<p><span class="koboSpan" id="kobo.193.1">The final</span><a id="_idIndexMarker207"/><span class="koboSpan" id="kobo.194.1"> value of </span><strong class="source-inline"><span class="koboSpan" id="kobo.195.1">A</span></strong><span class="koboSpan" id="kobo.196.1"> variable is </span><strong class="source-inline"><span class="koboSpan" id="kobo.197.1">thirdValue</span></strong><span class="koboSpan" id="kobo.198.1">, as no assignment</span><a id="_idIndexMarker208"/><span class="koboSpan" id="kobo.199.1"> has been made </span><a id="_idIndexMarker209"/><span class="koboSpan" id="kobo.200.1">until </span><span class="No-Break"><span class="koboSpan" id="kobo.201.1">line 3.</span></span></p>
<h3><span class="koboSpan" id="kobo.202.1">The immediate variable expansion</span></h3>
<p><span class="koboSpan" id="kobo.203.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.204.1">:=</span></strong><span class="koboSpan" id="kobo.205.1"> operator is used when there</span><a id="_idIndexMarker210"/><span class="koboSpan" id="kobo.206.1"> is a need to force the immediate expansion</span><a id="_idIndexMarker211"/><span class="koboSpan" id="kobo.207.1"> of a variable. </span><span class="koboSpan" id="kobo.207.2">It results in the variable’s contents being expanded immediately rather than when the variable is used, </span><span class="No-Break"><span class="koboSpan" id="kobo.208.1">as follows:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer082">
<span class="koboSpan" id="kobo.209.1"><img alt="Figure 8.10 – An example of immediate variable expansion" src="image/Figure_8.10_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.210.1">Figure 8.10 – An example of immediate variable expansion</span></p>
<p><span class="koboSpan" id="kobo.211.1">The value for </span><strong class="source-inline"><span class="koboSpan" id="kobo.212.1">B</span></strong><span class="koboSpan" id="kobo.213.1"> is assigned immediately, in line 2, and expands to </span><strong class="source-inline"><span class="koboSpan" id="kobo.214.1">aValue-after</span></strong><span class="koboSpan" id="kobo.215.1">. </span><span class="koboSpan" id="kobo.215.2">However, the value for </span><strong class="source-inline"><span class="koboSpan" id="kobo.216.1">C</span></strong><span class="koboSpan" id="kobo.217.1"> is only assigned when used and then set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.218.1">newValue</span></strong><span class="koboSpan" id="kobo.219.1">, as </span><strong class="source-inline"><span class="koboSpan" id="kobo.220.1">A</span></strong><span class="koboSpan" id="kobo.221.1"> value has been set in </span><span class="No-Break"><span class="koboSpan" id="kobo.222.1">line 3.</span></span></p>
<h3><span class="koboSpan" id="kobo.223.1">The list appending and prepending</span></h3>
<p><span class="koboSpan" id="kobo.224.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.225.1">+=</span></strong><span class="koboSpan" id="kobo.226.1"> operator, known as </span><em class="italic"><span class="koboSpan" id="kobo.227.1">list appending</span></em><span class="koboSpan" id="kobo.228.1">, adds a new </span><a id="_idIndexMarker212"/><span class="koboSpan" id="kobo.229.1">value </span><a id="_idIndexMarker213"/><span class="koboSpan" id="kobo.230.1">after the original</span><a id="_idIndexMarker214"/><span class="koboSpan" id="kobo.231.1"> one, separated with a space, as </span><span class="No-Break"><span class="koboSpan" id="kobo.232.1">shown here:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer083">
<span class="koboSpan" id="kobo.233.1"><img alt="Figure 8.11 – An example of list appending" src="image/Figure_8.11_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.234.1">Figure 8.11 – An example of list appending</span></p>
<p><span class="koboSpan" id="kobo.235.1">In this example, the final value for </span><strong class="source-inline"><span class="koboSpan" id="kobo.236.1">A</span></strong><span class="koboSpan" id="kobo.237.1"> is </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.238.1">originalValue appendedValue</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.239.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.240.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.241.1">=+</span></strong><span class="koboSpan" id="kobo.242.1"> operator, known as </span><em class="italic"><span class="koboSpan" id="kobo.243.1">list prepending</span></em><span class="koboSpan" id="kobo.244.1">, adds a new value before</span><a id="_idIndexMarker215"/><span class="koboSpan" id="kobo.245.1"> the original</span><a id="_idIndexMarker216"/><span class="koboSpan" id="kobo.246.1"> one, separated</span><a id="_idIndexMarker217"/><span class="koboSpan" id="kobo.247.1"> with a space, as </span><span class="No-Break"><span class="koboSpan" id="kobo.248.1">shown here:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer084">
<span class="koboSpan" id="kobo.249.1"><img alt="Figure 8.12 – An example of list prepending" src="image/Figure_8.12_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.250.1">Figure 8.12 – An example of list prepending</span></p>
<p><span class="koboSpan" id="kobo.251.1">In this example, the final value for </span><strong class="source-inline"><span class="koboSpan" id="kobo.252.1">A</span></strong><span class="koboSpan" id="kobo.253.1"> is </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.254.1">prependedValue originalValue</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.255.1">.</span></span></p>
<h3><span class="koboSpan" id="kobo.256.1">The string appending and prepending</span></h3>
<p><span class="koboSpan" id="kobo.257.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.258.1">.=</span></strong><span class="koboSpan" id="kobo.259.1"> operator, known as </span><em class="italic"><span class="koboSpan" id="kobo.260.1">string appending</span></em><span class="koboSpan" id="kobo.261.1">, adds a new value after</span><a id="_idIndexMarker218"/><span class="koboSpan" id="kobo.262.1"> the original</span><a id="_idIndexMarker219"/><span class="koboSpan" id="kobo.263.1"> one, with</span><a id="_idIndexMarker220"/><span class="koboSpan" id="kobo.264.1"> no extra</span><a id="_idIndexMarker221"/><span class="koboSpan" id="kobo.265.1"> space, as </span><span class="No-Break"><span class="koboSpan" id="kobo.266.1">shown here:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer085">
<span class="koboSpan" id="kobo.267.1"><img alt="Figure 8.13 – An example of string appending" src="image/Figure_8.13_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.268.1">Figure 8.13 – An example of string appending</span></p>
<p><span class="koboSpan" id="kobo.269.1">In this example, the final value for </span><strong class="source-inline"><span class="koboSpan" id="kobo.270.1">A</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.271.1">is </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.272.1">originalValueAppendedValue</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.273.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.274.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.275.1">=.</span></strong><span class="koboSpan" id="kobo.276.1"> operator, known as </span><em class="italic"><span class="koboSpan" id="kobo.277.1">string prepending</span></em><span class="koboSpan" id="kobo.278.1">, adds the new value before</span><a id="_idIndexMarker222"/><span class="koboSpan" id="kobo.279.1"> the original</span><a id="_idIndexMarker223"/><span class="koboSpan" id="kobo.280.1"> one with no extra space, as </span><span class="No-Break"><span class="koboSpan" id="kobo.281.1">shown here:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer086">
<span class="koboSpan" id="kobo.282.1"><img alt="Figure 8.14 – An example of string prepending" src="image/Figure_8.14_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.283.1">Figure 8.14 – An example of string prepending</span></p>
<p><span class="koboSpan" id="kobo.284.1">In this</span><a id="_idIndexMarker224"/><span class="koboSpan" id="kobo.285.1"> example, the final</span><a id="_idIndexMarker225"/><span class="koboSpan" id="kobo.286.1"> value for </span><strong class="source-inline"><span class="koboSpan" id="kobo.287.1">A</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.288.1">is </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.289.1">prependedValueOriginalValue</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.290.1">.</span></span></p>
<h3><span class="koboSpan" id="kobo.291.1">The :append and :prepend operators</span></h3>
<p><span class="koboSpan" id="kobo.292.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.293.1">:append</span></strong><span class="koboSpan" id="kobo.294.1"> operator adds a new value after</span><a id="_idIndexMarker226"/><span class="koboSpan" id="kobo.295.1"> the original</span><a id="_idIndexMarker227"/><span class="koboSpan" id="kobo.296.1"> with no extra</span><a id="_idIndexMarker228"/><span class="koboSpan" id="kobo.297.1"> space, as </span><span class="No-Break"><span class="koboSpan" id="kobo.298.1">shown here:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer087">
<span class="koboSpan" id="kobo.299.1"><img alt="Figure 8.15 – An example of how to use the :append operator" src="image/Figure_8.15_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.300.1">Figure 8.15 – An example of how to use the :append operator</span></p>
<p><span class="koboSpan" id="kobo.301.1">In this example, the final value for </span><strong class="source-inline"><span class="koboSpan" id="kobo.302.1">A</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.303.1">is </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.304.1">originalValueAppendedValue</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.305.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.306.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.307.1">:prepend</span></strong><span class="koboSpan" id="kobo.308.1"> operator</span><a id="_idIndexMarker229"/><span class="koboSpan" id="kobo.309.1"> adds the new value before the original with no extra space, as </span><span class="No-Break"><span class="koboSpan" id="kobo.310.1">shown here:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer088">
<span class="koboSpan" id="kobo.311.1"><img alt="Figure 8.16 – An example of how to use the :prepend operator" src="image/Figure_8.16_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.312.1">Figure 8.16 – An example of how to use the :prepend operator</span></p>
<p><span class="koboSpan" id="kobo.313.1">In this example, the final value for </span><strong class="source-inline"><span class="koboSpan" id="kobo.314.1">A</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.315.1">is </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.316.1">prependedValueOriginalValue</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.317.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.318.1">You may have noticed that the </span><strong class="source-inline"><span class="koboSpan" id="kobo.319.1">:append</span></strong><span class="koboSpan" id="kobo.320.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.321.1">:prepend</span></strong><span class="koboSpan" id="kobo.322.1"> operators resemble the string appending (</span><strong class="source-inline"><span class="koboSpan" id="kobo.323.1">.=</span></strong><span class="koboSpan" id="kobo.324.1">) and prepending (</span><strong class="source-inline"><span class="koboSpan" id="kobo.325.1">=.</span></strong><span class="koboSpan" id="kobo.326.1">) operators. </span><span class="koboSpan" id="kobo.326.2">Still, there is a subtle difference between how the </span><strong class="source-inline"><span class="koboSpan" id="kobo.327.1">:append</span></strong><span class="koboSpan" id="kobo.328.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.329.1">:prepend</span></strong><span class="koboSpan" id="kobo.330.1"> operators and the string appending and string prepending operators are parsed, as </span><span class="No-Break"><span class="koboSpan" id="kobo.331.1">shown here:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer089">
<span class="koboSpan" id="kobo.332.1"><img alt="Figure 8.17 – An example of the difference between ﻿:append and the .= operator" src="image/Figure_8.17_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.333.1">Figure 8.17 – An example of the difference between :append and the .= operator</span></p>
<p><span class="koboSpan" id="kobo.334.1">Using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.335.1">:append</span></strong><span class="koboSpan" id="kobo.336.1"> operator</span><a id="_idIndexMarker230"/><span class="koboSpan" id="kobo.337.1"> queues the operation for execution, which </span><a id="_idIndexMarker231"/><span class="koboSpan" id="kobo.338.1">happens after the </span><em class="italic"><span class="koboSpan" id="kobo.339.1">line 2</span></em><span class="koboSpan" id="kobo.340.1"> assignment, resulting in </span><strong class="source-inline"><span class="koboSpan" id="kobo.341.1">A</span></strong><span class="koboSpan" id="kobo.342.1"> becoming </span><strong class="source-inline"><span class="koboSpan" id="kobo.343.1">valueAppendedValue</span></strong><span class="koboSpan" id="kobo.344.1">. </span><span class="koboSpan" id="kobo.344.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.345.1">.=</span></strong><span class="koboSpan" id="kobo.346.1"> operator</span><a id="_idIndexMarker232"/><span class="koboSpan" id="kobo.347.1"> is immediate, so the</span><a id="_idIndexMarker233"/><span class="koboSpan" id="kobo.348.1"> assignment of </span><em class="italic"><span class="koboSpan" id="kobo.349.1">line 4</span></em><span class="koboSpan" id="kobo.350.1"> replaces the value set on </span><em class="italic"><span class="koboSpan" id="kobo.351.1">line 3</span></em><span class="koboSpan" id="kobo.352.1">, resulting in </span><strong class="source-inline"><span class="koboSpan" id="kobo.353.1">B</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.354.1">becoming </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.355.1">value</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.356.1">.</span></span></p>
<h3><span class="koboSpan" id="kobo.357.1">The list item removal</span></h3>
<p><span class="koboSpan" id="kobo.358.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.359.1">:remove</span></strong><span class="koboSpan" id="kobo.360.1"> operator drops a list item from</span><a id="_idIndexMarker234"/><span class="koboSpan" id="kobo.361.1"> the original</span><a id="_idIndexMarker235"/><span class="koboSpan" id="kobo.362.1"> content. </span><span class="koboSpan" id="kobo.362.2">For example, see </span><span class="No-Break"><span class="koboSpan" id="kobo.363.1">the following:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer090">
<span class="koboSpan" id="kobo.364.1"><img alt="Figure 8.18 – An example of how to use the :remove operator" src="image/Figure_8.18_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.365.1">Figure 8.18 – An example of how to use the :remove operator</span></p>
<p><span class="koboSpan" id="kobo.366.1">In this example, </span><strong class="source-inline"><span class="koboSpan" id="kobo.367.1">A</span></strong><span class="koboSpan" id="kobo.368.1"> is now </span><strong class="source-inline"><span class="koboSpan" id="kobo.369.1">value1 value3</span></strong><span class="koboSpan" id="kobo.370.1">. </span><span class="koboSpan" id="kobo.370.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.371.1">:remove</span></strong><span class="koboSpan" id="kobo.372.1"> operator considers the variable value as a list of strings separated by spaces so that the operator can remove one or more items from the list. </span><span class="koboSpan" id="kobo.372.2">Note that every appending and prepending operation has already finished when </span><strong class="source-inline"><span class="koboSpan" id="kobo.373.1">:remove</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.374.1">is executed.</span></span></p>
<h3><span class="koboSpan" id="kobo.375.1">Conditional metadata sets</span></h3>
<p><span class="koboSpan" id="kobo.376.1">BitBake provides a very easy-to-use way</span><a id="_idIndexMarker236"/><span class="koboSpan" id="kobo.377.1"> to write conditional metadata</span><a id="_idIndexMarker237"/><span class="koboSpan" id="kobo.378.1"> through a mechanism </span><span class="No-Break"><span class="koboSpan" id="kobo.379.1">called </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.380.1">overrides</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.381.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.382.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.383.1">OVERRIDES</span></strong><span class="koboSpan" id="kobo.384.1"> variable contains values separated by colons (</span><strong class="source-inline"><span class="koboSpan" id="kobo.385.1">:</span></strong><span class="koboSpan" id="kobo.386.1">) and evaluated from left to right. </span><span class="koboSpan" id="kobo.386.2">Each value is an item that we want to have </span><span class="No-Break"><span class="koboSpan" id="kobo.387.1">conditional metadata.</span></span></p>
<p><span class="koboSpan" id="kobo.388.1">Let’s consider the </span><span class="No-Break"><span class="koboSpan" id="kobo.389.1">next example:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer091">
<span class="koboSpan" id="kobo.390.1"><img alt="Figure 8.19 – An example of the OVERRIDES variable" src="image/Figure_8.19_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.391.1">Figure 8.19 – An example of the OVERRIDES variable</span></p>
<p><span class="koboSpan" id="kobo.392.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.393.1">linux</span></strong><span class="koboSpan" id="kobo.394.1"> override is less specific than </span><strong class="source-inline"><span class="koboSpan" id="kobo.395.1">arm</span></strong><span class="koboSpan" id="kobo.396.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.397.1">mymachine</span></strong><span class="koboSpan" id="kobo.398.1">. </span><span class="koboSpan" id="kobo.398.2">The following example shows how we can use </span><strong class="source-inline"><span class="koboSpan" id="kobo.399.1">OVERRIDES</span></strong><span class="koboSpan" id="kobo.400.1"> to set the </span><strong class="source-inline"><span class="koboSpan" id="kobo.401.1">A</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.402.1">variable conditionally:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer092">
<span class="koboSpan" id="kobo.403.1"><img alt="Figure 8.20 – An example of using OVERRIDES conditional setting" src="image/Figure_8.20_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.404.1">Figure 8.20 – An example of using OVERRIDES conditional setting</span></p>
<p><span class="koboSpan" id="kobo.405.1">In this</span><a id="_idIndexMarker238"/><span class="koboSpan" id="kobo.406.1"> example, </span><strong class="source-inline"><span class="koboSpan" id="kobo.407.1">A</span></strong><span class="koboSpan" id="kobo.408.1"> will be </span><strong class="source-inline"><span class="koboSpan" id="kobo.409.1">linuxSpecificValue</span></strong><span class="koboSpan" id="kobo.410.1">, due to the condition</span><a id="_idIndexMarker239"/><span class="koboSpan" id="kobo.411.1"> of </span><strong class="source-inline"><span class="koboSpan" id="kobo.412.1">linux</span></strong><span class="koboSpan" id="kobo.413.1"> being </span><span class="No-Break"><span class="koboSpan" id="kobo.414.1">in </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.415.1">OVERRIDES</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.416.1">.</span></span></p>
<h3><span class="koboSpan" id="kobo.417.1">Conditional appending</span></h3>
<p><span class="koboSpan" id="kobo.418.1">BitBake also supports</span><a id="_idIndexMarker240"/><span class="koboSpan" id="kobo.419.1"> appending and prepending</span><a id="_idIndexMarker241"/><span class="koboSpan" id="kobo.420.1"> variables, based on whether something is in </span><strong class="source-inline"><span class="koboSpan" id="kobo.421.1">OVERRIDES</span></strong><span class="koboSpan" id="kobo.422.1">, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.423.1">following example:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer093">
<span class="koboSpan" id="kobo.424.1"><img alt="Figure 8.21 – An example of using OVERRIDES conditional appending" src="image/Figure_8.21_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.425.1">Figure 8.21 – An example of using OVERRIDES conditional appending</span></p>
<p><span class="koboSpan" id="kobo.426.1">In the preceding example, </span><strong class="source-inline"><span class="koboSpan" id="kobo.427.1">A</span></strong><span class="koboSpan" id="kobo.428.1"> is set to </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.429.1">value armValue</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.430.1">.</span></span></p>
<h3><span class="koboSpan" id="kobo.431.1">File inclusion</span></h3>
<p><span class="koboSpan" id="kobo.432.1">BitBake provides</span><a id="_idIndexMarker242"/><span class="koboSpan" id="kobo.433.1"> two directives</span><a id="_idIndexMarker243"/><span class="koboSpan" id="kobo.434.1"> for file inclusion – </span><strong class="source-inline"><span class="koboSpan" id="kobo.435.1">include</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.436.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.437.1">require</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.438.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.439.1">With the </span><strong class="source-inline"><span class="koboSpan" id="kobo.440.1">include</span></strong><span class="koboSpan" id="kobo.441.1"> keyword, BitBake attempts to insert </span><a id="_idIndexMarker244"/><span class="koboSpan" id="kobo.442.1">the file at the keyword location, so it is optional. </span><span class="koboSpan" id="kobo.442.2">Let’s suppose the path specified on the </span><strong class="source-inline"><span class="koboSpan" id="kobo.443.1">include</span></strong><span class="koboSpan" id="kobo.444.1"> line is relative; then, BitBake locates</span><a id="_idIndexMarker245"/><span class="koboSpan" id="kobo.445.1"> the first instance it can find within </span><strong class="source-inline"><span class="koboSpan" id="kobo.446.1">BBPATH</span></strong><span class="koboSpan" id="kobo.447.1">. </span><span class="koboSpan" id="kobo.447.2">By contrast, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.448.1">require</span></strong><span class="koboSpan" id="kobo.449.1"> keyword raises </span><strong class="source-inline"><span class="koboSpan" id="kobo.450.1">ParseError</span></strong><span class="koboSpan" id="kobo.451.1"> if the required file</span><a id="_idIndexMarker246"/><span class="koboSpan" id="kobo.452.1"> cannot </span><span class="No-Break"><span class="koboSpan" id="kobo.453.1">be found.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.454.1">Tip</span></p>
<p class="callout"><span class="koboSpan" id="kobo.455.1">The convention generally adopted</span><a id="_idIndexMarker247"/><span class="koboSpan" id="kobo.456.1"> in the Yocto Project is to use a </span><strong class="source-inline"><span class="koboSpan" id="kobo.457.1">.inc</span></strong><span class="koboSpan" id="kobo.458.1"> file to share the common code between two or more </span><span class="No-Break"><span class="koboSpan" id="kobo.459.1">recipe files.</span></span></p>
<h3><span class="koboSpan" id="kobo.460.1">Python variable expansion</span></h3>
<p><span class="koboSpan" id="kobo.461.1">BitBake makes</span><a id="_idIndexMarker248"/><span class="koboSpan" id="kobo.462.1"> it easy to use Python code</span><a id="_idIndexMarker249"/><span class="koboSpan" id="kobo.463.1"> in variable expansion with the </span><span class="No-Break"><span class="koboSpan" id="kobo.464.1">following syntax:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer094">
<span class="koboSpan" id="kobo.465.1"><img alt="Figure 8.22 – An example of Python expansion syntax" src="image/Figure_8.22_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.466.1">Figure 8.22 – An example of Python expansion syntax</span></p>
<p><span class="koboSpan" id="kobo.467.1">This gives enormous flexibility to a user. </span><span class="koboSpan" id="kobo.467.2">We can see a Python function call in the </span><span class="No-Break"><span class="koboSpan" id="kobo.468.1">following example:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer095">
<span class="koboSpan" id="kobo.469.1"><img alt="Figure 8.23 – An example of a Python command to print the current date" src="image/Figure_8.23_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.470.1">Figure 8.23 – An example of a Python command to print the current date</span></p>
<p><span class="koboSpan" id="kobo.471.1">This results in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.472.1">A</span></strong><span class="koboSpan" id="kobo.473.1"> variable containing </span><span class="No-Break"><span class="koboSpan" id="kobo.474.1">today’s date.</span></span></p>
<h3><span class="koboSpan" id="kobo.475.1">Defining executable metadata</span></h3>
<p><span class="koboSpan" id="kobo.476.1">Metadata</span><a id="_idIndexMarker250"/><span class="koboSpan" id="kobo.477.1"> recipes (</span><strong class="source-inline"><span class="koboSpan" id="kobo.478.1">.bb</span></strong><span class="koboSpan" id="kobo.479.1">) and class files (</span><strong class="source-inline"><span class="koboSpan" id="kobo.480.1">.bbclass</span></strong><span class="koboSpan" id="kobo.481.1">) can use Shell Script</span><a id="_idIndexMarker251"/><span class="koboSpan" id="kobo.482.1"> code, </span><span class="No-Break"><span class="koboSpan" id="kobo.483.1">as follows:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer096">
<span class="koboSpan" id="kobo.484.1"><img alt="Figure 8.24 – An example of a task definition" src="image/Figure_8.24_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.485.1">Figure 8.24 – An example of a task definition</span></p>
<p><span class="koboSpan" id="kobo.486.1">The task definition is identical to setting a variable, except that this variable happens to be an executable Shell Script code. </span><span class="koboSpan" id="kobo.486.2">When writing the task code, we should not use Bash or Zsh-specific features, as the tasks can only rely on POSIX-compatible features. </span><span class="koboSpan" id="kobo.486.3">When in doubt, an excellent way to test whether your code is safe is to use the Dash shell to try </span><span class="No-Break"><span class="koboSpan" id="kobo.487.1">it out.</span></span></p>
<p><span class="koboSpan" id="kobo.488.1">Another way to inject code is by using Python code, as </span><span class="No-Break"><span class="koboSpan" id="kobo.489.1">shown here:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer097">
<span class="koboSpan" id="kobo.490.1"><img alt="Figure 8.25 – An example of a Python task definition" src="image/Figure_8.25_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.491.1">Figure 8.25 – An example of a Python task definition</span></p>
<p><span class="koboSpan" id="kobo.492.1">The task definition</span><a id="_idIndexMarker252"/><span class="koboSpan" id="kobo.493.1"> is similar, but it flags the task as Python</span><a id="_idIndexMarker253"/><span class="koboSpan" id="kobo.494.1"> so that BitBake knows how to run </span><span class="No-Break"><span class="koboSpan" id="kobo.495.1">it accordingly.</span></span></p>
<h3><span class="koboSpan" id="kobo.496.1">Defining Python functions in a global namespace</span></h3>
<p><span class="koboSpan" id="kobo.497.1">When we need to generate</span><a id="_idIndexMarker254"/><span class="koboSpan" id="kobo.498.1"> a value for a variable or some </span><a id="_idIndexMarker255"/><span class="koboSpan" id="kobo.499.1">other use, this can be quickly done in recipes (</span><strong class="source-inline"><span class="koboSpan" id="kobo.500.1">.bb</span></strong><span class="koboSpan" id="kobo.501.1">) and classes (</span><strong class="source-inline"><span class="koboSpan" id="kobo.502.1">.bbclass</span></strong><span class="koboSpan" id="kobo.503.1">) using code similar to </span><span class="No-Break"><span class="koboSpan" id="kobo.504.1">the following:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer098">
<span class="koboSpan" id="kobo.505.1"><img alt="Figure 8.26 – A code example to handle variable values in Python code" src="image/Figure_8.26_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.506.1">Figure 8.26 – A code example to handle variable values in Python code</span></p>
<p><span class="koboSpan" id="kobo.507.1">Usually, we need to access the BitBake datastore when writing a Python function. </span><span class="koboSpan" id="kobo.507.2">Therefore, a convention among all metadata is the use of an argument called </span><strong class="source-inline"><span class="koboSpan" id="kobo.508.1">d</span></strong><span class="koboSpan" id="kobo.509.1"> to point to BitBake’s datastore. </span><span class="koboSpan" id="kobo.509.2">It is usually in the last parameter of </span><span class="No-Break"><span class="koboSpan" id="kobo.510.1">the function.</span></span></p>
<p><span class="koboSpan" id="kobo.511.1">In </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.512.1">Figure 8</span></em></span><em class="italic"><span class="koboSpan" id="kobo.513.1">.26</span></em><span class="koboSpan" id="kobo.514.1">, we ask the datastore for the value of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.515.1">SOMECONDITION</span></strong><span class="koboSpan" id="kobo.516.1"> variable in line 2 and return a value depending </span><span class="No-Break"><span class="koboSpan" id="kobo.517.1">on it.</span></span></p>
<p><span class="koboSpan" id="kobo.518.1">The example results </span><a id="_idIndexMarker256"/><span class="koboSpan" id="kobo.519.1">in the value for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.520.1">DEPENDS</span></strong><span class="koboSpan" id="kobo.521.1"> variable</span><a id="_idIndexMarker257"/> <span class="No-Break"><span class="koboSpan" id="kobo.522.1">containing </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.523.1">dependencyWithConditon</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.524.1">.</span></span></p>
<h3><span class="koboSpan" id="kobo.525.1">The inheritance system</span></h3>
<p><span class="koboSpan" id="kobo.526.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.527.1">inherit</span></strong><span class="koboSpan" id="kobo.528.1"> directive</span><a id="_idIndexMarker258"/><span class="koboSpan" id="kobo.529.1"> specifies which classes of functionality</span><a id="_idIndexMarker259"/><span class="koboSpan" id="kobo.530.1"> our recipe (</span><strong class="source-inline"><span class="koboSpan" id="kobo.531.1">.bb</span></strong><span class="koboSpan" id="kobo.532.1">) offers a rudimentary inheritance mechanism, such as object-oriented programming languages. </span><span class="koboSpan" id="kobo.532.2">For example, we can abstract the tasks involved in using the Autoconf and Automake building tools and put them into the class for our recipes to reuse. </span><span class="koboSpan" id="kobo.532.3">A given </span><strong class="source-inline"><span class="koboSpan" id="kobo.533.1">.bbclass</span></strong><span class="koboSpan" id="kobo.534.1"> is located by searching for </span><strong class="source-inline"><span class="koboSpan" id="kobo.535.1">classes/filename.bbclass</span></strong><span class="koboSpan" id="kobo.536.1"> in </span><strong class="source-inline"><span class="koboSpan" id="kobo.537.1">BBPATH</span></strong><span class="koboSpan" id="kobo.538.1">. </span><span class="koboSpan" id="kobo.538.2">So, in a recipe that uses Autoconf or Automake, we can use </span><span class="No-Break"><span class="koboSpan" id="kobo.539.1">the following:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer099">
<span class="koboSpan" id="kobo.540.1"><img alt="Figure 8.27 – An example of how to inherit a class" src="image/Figure_8.27_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.541.1">Figure 8.27 – An example of how to inherit a class</span></p>
<p><span class="koboSpan" id="kobo.542.1">Line 1 from </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.543.1">Figure 8</span></em></span><em class="italic"><span class="koboSpan" id="kobo.544.1">.27</span></em><span class="koboSpan" id="kobo.545.1"> instructs BitBake to use </span><strong class="source-inline"><span class="koboSpan" id="kobo.546.1">inherit autotools.bbclass</span></strong><span class="koboSpan" id="kobo.547.1">, providing the default tasks that work</span><a id="_idIndexMarker260"/><span class="koboSpan" id="kobo.548.1"> fine for most Autoconf- or </span><span class="No-Break"><span class="koboSpan" id="kobo.549.1">Automake-based</span></span><span class="No-Break"><a id="_idIndexMarker261"/></span><span class="No-Break"><span class="koboSpan" id="kobo.550.1"> projects.</span></span></p>
<h1 id="_idParaDest-86"><a id="_idTextAnchor114"/><span class="koboSpan" id="kobo.551.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.552.1">In this chapter, we learned in detail about the BitBake metadata syntax, its operators to manipulate variable contents, and variable expansions, including some </span><span class="No-Break"><span class="koboSpan" id="kobo.553.1">usage examples.</span></span></p>
<p><span class="koboSpan" id="kobo.554.1">In the next chapter, we will learn how to use Poky to create external compilation tools and produce a </span><strong class="source-inline"><span class="koboSpan" id="kobo.555.1">root</span></strong><span class="koboSpan" id="kobo.556.1"> filesystem suitable for </span><span class="No-Break"><span class="koboSpan" id="kobo.557.1">target development.</span></span></p>
</div>
<div>
<div class="IMG---Figure" id="_idContainer101">
</div>
</div>
</body></html>