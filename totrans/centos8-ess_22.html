<html><head></head><body><div id="sbo-rt-content"><div id="_idContainer212" class="_idGenObjectStyleOverride-1">&#13;
			<p id="_idParaDest-221" class="Chapter-Title" lang="en-US" xml:lang="en-US"><span class="ChapterMarker">24. </span><a id="_idTextAnchor298"/>Managing <a id="_idIndexMarker498"/>KVM using the virsh Command-Line Tool</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">In previous chapters we have covered the steps necessary to install and configure KVM-based guest operating systems on CentOS 8. This chapter is dedicated to exploring some additional areas of the <span class="My-Italic _idGenCharOverride-1">virsh</span> tool that have not been covered in previous chapters, and how it may be used to manage KVM-based guest operating systems from the command-line. </p>&#13;
			<p id="_idParaDest-222" class="Heading-1-1" lang="en-US" xml:lang="en-US"><span class="Heading11Marker">24.1 </span><a id="_idTextAnchor299"/>The virsh Shell and Command-Line</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">The <span class="My-Italic _idGenCharOverride-1">virsh</span> tool is both a command-line tool and an interactive shell environment. When used in the command-line mode, the command is simply issued at the command prompt with sets of arguments appropriate to the task to be performed.</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">To use the options as command-line arguments, use them at a terminal command prompt as shown in the following example: </p>&#13;
			<p class="Code"># virsh &lt;option&gt;</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">The <span class="My-Italic _idGenCharOverride-1">virsh</span> tool, when used in shell mode, provides an interactive environment from which to issue sequences of commands.</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">To run commands in the <a id="_idIndexMarker499"/><a id="_idIndexMarker500"/><span class="My-Italic _idGenCharOverride-1">virsh</span> shell, run the following command: </p>&#13;
			<p class="Code"># virsh</p>&#13;
			<p class="Code">Welcome to virsh, the virtualization interactive terminal.</p>&#13;
			<p class="Code"> </p>&#13;
			<p class="Code">Type:  ‘help’ for help with commands</p>&#13;
			<p class="Code">       ‘quit’ to quit</p>&#13;
			<p class="Code"> </p>&#13;
			<p class="Code">virsh #</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">At the <span class="My-Italic _idGenCharOverride-1">virsh #</span> prompt enter the options you wish to run. The following <span class="My-Italic _idGenCharOverride-1">virsh</span> session, for example, lists the current virtual machines, starts a virtual machine named FedoraVM and then obtains another listing to verify the VM is running: </p>&#13;
			<p class="Code"># virsh </p>&#13;
			<p class="Code">Welcome to virsh, the virtualization interactive terminal.</p>&#13;
			<p class="Code"> </p>&#13;
			<p class="Code">Type:  ‘help’ for help with commands</p>&#13;
			<p class="Code">       ‘quit’ to quit</p>&#13;
			<p class="Code"> </p>&#13;
			<p class="Code">virsh # list</p>&#13;
			<p class="Code"> Id    Name                           State</p>&#13;
			<p class="Code">----------------------------------------------------</p>&#13;
			<p class="Code"> 8     RHEL8VM                       running</p>&#13;
			<p class="Code"> 9     CentOS7VM                     running</p>&#13;
			<p class="Code"> </p>&#13;
			<p class="Code">virsh # start FedoraVM</p>&#13;
			<p class="Code">Domain FedoraVM started</p>&#13;
			<p class="Code"> </p>&#13;
			<p class="Code">virsh # list</p>&#13;
			<p class="Code"> Id    Name                           State</p>&#13;
			<p class="Code">----------------------------------------------------</p>&#13;
			<p class="Code"> 8     RHEL8VM                       running</p>&#13;
			<p class="Code"> 9     CentOS7VM                     running</p>&#13;
			<p class="Code">10     FedoraVM                      running</p>&#13;
			<p class="Code"> </p>&#13;
			<p class="Code">virsh#</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">The <span class="My-Italic _idGenCharOverride-1">virsh</span> tool supports a wide range of commands, a full listing of which may be obtained using the help option:</p>&#13;
			<p class="Code"># virsh help</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Additional details on the syntax for each command may be obtained by specifying the command after the help directive:</p>&#13;
			<p class="Code"># virsh help restore</p>&#13;
			<p class="Code">  NAME</p>&#13;
			<p class="Code">    restore - restore a domain from a saved state in a file</p>&#13;
			<p class="Code"> </p>&#13;
			<p class="Code">  SYNOPSIS</p>&#13;
			<p class="Code">    restore &lt;file&gt; [--bypass-cache] [--xml &lt;string&gt;] [--running] [--paused]</p>&#13;
			<p class="Code"> </p>&#13;
			<p class="Code">  DESCRIPTION</p>&#13;
			<p class="Code">    Restore a domain.</p>&#13;
			<p class="Code"> </p>&#13;
			<p class="Code">  OPTIONS</p>&#13;
			<p class="Code">    [--file] &lt;string&gt;  the state to restore</p>&#13;
			<p class="Code">    --bypass-cache   avoid file system cache when restoring</p>&#13;
			<p class="Code">    --xml &lt;string&gt;   filename containing updated XML for the target</p>&#13;
			<p class="Code">    --running        restore domain into running state</p>&#13;
			<p class="Code">    --paused         restore domain into paused state</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">In the remainder of this chapter we will look at some of these commands in more detail.</p>&#13;
			<p id="_idParaDest-223" class="Heading-1-1" lang="en-US" xml:lang="en-US"><span class="Heading11Marker">24.2 </span><a id="_idTextAnchor300"/>Listing Guest System Status </p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">The status of the guest systems on a CentOS 8 virtualization host may be viewed at any time using the <span class="My-Italic _idGenCharOverride-1">list</span> option of the <span class="My-Italic _idGenCharOverride-1">virsh</span> tool. For example: </p>&#13;
			<p class="Code"># virsh list</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">The above command will display output containing a line for each guest similar to the following: </p>&#13;
			<p class="Code">virsh # list</p>&#13;
			<p class="Code"> Id    Name                           State</p>&#13;
			<p class="Code">----------------------------------------------------</p>&#13;
			<p class="Code"> 8     RHEL8VM                       running</p>&#13;
			<p class="Code"> 9     CentOS7VM                     running</p>&#13;
			<p class="Code">10     FedoraVM                      running</p>&#13;
			<p id="_idParaDest-224" class="Heading-1-1" lang="en-US" xml:lang="en-US"><span class="Heading11Marker">24.3 </span><a id="_idTextAnchor301"/>Starting a Guest System </p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">A guest operating system can be started using the <span class="My-Italic _idGenCharOverride-1">virsh</span> tool combined with the start option followed by the name of the guest operating system to be launched. For example: </p>&#13;
			<p class="Code"># virsh start myGuestOS</p>&#13;
			<p id="_idParaDest-225" class="Heading-1-1" lang="en-US" xml:lang="en-US"><span class="Heading11Marker">24.4 </span><a id="_idTextAnchor302"/>Shutting Down a Guest System </p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">The <span class="My-Italic _idGenCharOverride-1">shutdown</span> option of the <span class="My-Italic _idGenCharOverride-1">virsh</span> tool, as the name suggests, is used to shutdown a guest operating system: </p>&#13;
			<p class="Code"># virsh shutdown guestName</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Note that the shutdown option allows the guest operating system to perform an orderly shutdown when it receives the shutdown instruction. To instantly stop a guest operating system the <span class="My-Italic _idGenCharOverride-1">destroy</span> option may be used (with all the attendant risks of file system damage and data loss): </p>&#13;
			<p class="Code"># virsh destroy guestName</p>&#13;
			<p id="_idParaDest-226" class="Heading-1-1" lang="en-US" xml:lang="en-US"><span class="Heading11Marker">24.5 </span><a id="_idTextAnchor303"/>Suspending and Resuming a Guest System </p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">A guest system can be suspended and resumed using the <a id="_idIndexMarker501"/><a id="_idIndexMarker502"/><span class="My-Italic _idGenCharOverride-1">virsh</span> tool’s suspend and resume options. For example, to suspend a specific system: </p>&#13;
			<p class="Code"># virsh suspend guestName</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Similarly, to resume the paused system: </p>&#13;
			<p class="Code"># virsh resume guestName</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Note that a suspended session will be lost if the host system is rebooted. Also, be aware that a suspended system continues to reside in memory. To save a session such that it no longer takes up memory and can be restored to its exact state (even after a reboot), it is necessary to save and restore the guest. </p>&#13;
			<p id="_idParaDest-227" class="Heading-1-1" lang="en-US" xml:lang="en-US"><span class="Heading11Marker">24.6 </span><a id="_idTextAnchor304"/>Saving and Restoring Guest Systems </p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">A running guest operating system can be saved and restored using the <a id="_idIndexMarker503"/><a id="_idIndexMarker504"/><span class="My-Italic _idGenCharOverride-1">virsh</span> utility. When saved, the current status of the guest operating system is written to disk and removed from system memory. A saved system may subsequently be restored at any time (including after a host system reboot): </p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">To save a guest: </p>&#13;
			<p class="Code"># virsh save guestName path_to_save_file</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">To restore a saved guest operating system session:</p>&#13;
			<p class="Code"># virsh restore path_to_save_file</p>&#13;
			<p id="_idParaDest-228" class="Heading-1-1" lang="en-US" xml:lang="en-US"><span class="Heading11Marker">24.7 </span><a id="_idTextAnchor305"/>Rebooting a Guest System </p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">To reboot a guest operating system:<a id="_idIndexMarker505"/> </p>&#13;
			<p class="Code"># virsh reboot guestName</p>&#13;
			<p id="_idParaDest-229" class="Heading-1-1" lang="en-US" xml:lang="en-US"><span class="Heading11Marker">24.8 </span><a id="_idTextAnchor306"/>Configuring the Memory Assigned to a Guest OS </p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">To configure the memory assigned to a guest OS, use the <span class="My-Italic _idGenCharOverride-1">setmem</span> option of the <span class="My-Italic _idGenCharOverride-1">virsh</span> command. For example, the following command reduces the memory allocated to a guest system to 256Mb: </p>&#13;
			<p class="Code"># <a id="_idIndexMarker506"/>virsh setmem guestName 256</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Note that acceptable memory settings must fall within the memory available to the current Domain. This may be increased using the <span class="My-Italic _idGenCharOverride-1">setmaxmem</span> option. </p>&#13;
			<p id="_idParaDest-230" class="Heading-1-1" lang="en-US" xml:lang="en-US"><span class="Heading11Marker">24.9 </span><a id="_idTextAnchor307"/>Summary</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">The <span class="My-Italic _idGenCharOverride-1">virsh</span> tool provides a wide range of options for creating, monitoring and managing guest virtual machines. As outlined in this chapter, the tool can be used in either command-line or interactive modes.</p>&#13;
		</div>&#13;
</div>



  </body></html>