<html><head></head><body><div id="sbo-rt-content"><div id="_idContainer248" class="_idGenObjectStyleOverride-1">&#13;
			<p id="_idParaDest-299" class="Chapter-Title" lang="en-US" xml:lang="en-US"><span class="ChapterMarker">31. </span><a id="_idTextAnchor389"/>Adding and Managing CentOS 8 Swap Space</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">An important part of maintaining the performance of a CentOS 8 system involves ensuring that adequate swap space is available comparable to the memory demands placed on the system. The goal of this chapter, therefore, is to provide an overview of swap management on CentOS 8.</p>&#13;
			<p id="_idParaDest-300" class="Heading-1-1" lang="en-US" xml:lang="en-US"><span class="Heading11Marker">31.1 </span><a id="_idTextAnchor390"/>What is Swap Space?</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Computer systems have a finite amount of physical memory that is made available to the operating system. When the operating system begins to approach the limit of the available memory it frees up space by writing memory pages to disk. When any of those pages are required by the operating system they are subsequently read back into memory. The area of the disk allocated for this task is referred to as <span class="My-Italic _idGenCharOverride-1">swap space</span>.</p>&#13;
			<p id="_idParaDest-301" class="Heading-1-1" lang="en-US" xml:lang="en-US"><span class="Heading11Marker">31.2 </span><a id="_idTextAnchor391"/>Recommended <a id="_idIndexMarker665"/>Swap Space for CentOS 8</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">The amount of swap recommended for CentOS 8 depends on a number of factors including the amount of memory in the system, the workload imposed on that memory and whether the system is required to support hibernation. The current guidelines for CentOS 8 swap space are as follows:</p>&#13;
			<table id="table001-3" class="My-Table-Style">&#13;
				<colgroup>&#13;
					<col/>&#13;
					<col/>&#13;
					<col/>&#13;
				</colgroup>&#13;
				<tbody>&#13;
					<tr class="My-Table-Style">&#13;
						<td class="My-Table-Style">&#13;
							<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="My-Bold _idGenCharOverride-1">Amount of installed RAM</span></p>&#13;
						</td>&#13;
						<td class="My-Table-Style">&#13;
							<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="My-Bold _idGenCharOverride-1">Recommended swap space</span></p>&#13;
						</td>&#13;
						<td class="My-Table-Style">&#13;
							<p class="My-Basic-Paragraph ParaOverride-2" lang="en-US" xml:lang="en-US"><span class="My-Bold _idGenCharOverride-1">Recommended swap space if hibernation enabled</span></p>&#13;
						</td>&#13;
					</tr>&#13;
					<tr class="My-Table-Style">&#13;
						<td class="My-Table-Style">&#13;
							<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">2GB or less</p>&#13;
						</td>&#13;
						<td class="My-Table-Style">&#13;
							<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Installed RAM x 2</p>&#13;
						</td>&#13;
						<td class="My-Table-Style">&#13;
							<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Installed RAM x 3</p>&#13;
						</td>&#13;
					</tr>&#13;
					<tr class="My-Table-Style">&#13;
						<td class="My-Table-Style">&#13;
							<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">2GB - 8GB</p>&#13;
						</td>&#13;
						<td class="My-Table-Style">&#13;
							<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Installed RAM x 1</p>&#13;
						</td>&#13;
						<td class="My-Table-Style">&#13;
							<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Installed RAM x 2</p>&#13;
						</td>&#13;
					</tr>&#13;
					<tr class="My-Table-Style">&#13;
						<td class="My-Table-Style">&#13;
							<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">8GB - 64GB</p>&#13;
						</td>&#13;
						<td class="My-Table-Style">&#13;
							<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">At least 4GB</p>&#13;
						</td>&#13;
						<td class="My-Table-Style">&#13;
							<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Installed RAM x 1.5</p>&#13;
						</td>&#13;
					</tr>&#13;
					<tr class="My-Table-Style">&#13;
						<td class="My-Table-Style">&#13;
							<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">64GB or more</p>&#13;
						</td>&#13;
						<td class="My-Table-Style">&#13;
							<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">At least 4GB</p>&#13;
						</td>&#13;
						<td class="My-Table-Style">&#13;
							<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Hibernation not recommended</p>&#13;
						</td>&#13;
					</tr>&#13;
				</tbody>&#13;
			</table>&#13;
			<p class="Table-Caption" lang="en-US" xml:lang="en-US"><span class="TableCaptionMarker">Table 31-1</span></p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">When a system enters <a id="_idIndexMarker666"/>hibernation, the current system state is written to the hard disk and the host machine is powered off. When the machine is subsequently powered on, the state of the system is restored from the hard disk drive. This differs from suspension where the system state is stored in RAM. The machine then enters a sleep state whereby power is maintained to the system RAM while other devices are shut down.</p>&#13;
			<p id="_idParaDest-302" class="Heading-1-1" lang="en-US" xml:lang="en-US"><span class="Heading11Marker">31.3 </span><a id="_idTextAnchor392"/>Identifying Current <a id="_idIndexMarker667"/>Swap Space Usage</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">The current amount of swap used by a CentOS 8 system may be identified in a number of ways. One option is to output the <a id="_idIndexMarker668"/><span class="My-Italic _idGenCharOverride-1">/proc/swaps</span> file:</p>&#13;
			<p class="Code"># cat /proc/swaps</p>&#13;
			<p class="Code">Filename               Type       Size        Used     Priority</p>&#13;
			<p class="Code">/dev/dm-1              partition  4169724     41484    -2</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Alternatively, the <a id="_idIndexMarker669"/><span class="My-Italic _idGenCharOverride-1">swapon</span> command may be used:</p>&#13;
			<p class="Code"># swapon</p>&#13;
			<p class="Code">NAME      TYPE      SIZE  USED PRIO</p>&#13;
			<p class="Code">/dev/dm-1 partition   4G 40.5M   -2</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">To view the amount of swap space relative to the overall available RAM, the <a id="_idIndexMarker670"/><span class="My-Italic _idGenCharOverride-1">free</span> command may be used:</p>&#13;
			<p class="Code"># free</p>&#13;
			<p class="Code">              total        used        free      shared  buff/cache   available</p>&#13;
			<p class="Code">Mem:        4035436     1428276     2224596       21968      382564     2360172</p>&#13;
			<p class="Code">Swap:       4169724       41484     4128240</p>&#13;
			<p id="_idParaDest-303" class="Heading-1-1" lang="en-US" xml:lang="en-US"><span class="Heading11Marker">31.4 </span><a id="_idTextAnchor393"/>Adding a <a id="_idIndexMarker671"/>Swap File to a CentOS 8 System</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Additional swap may be added to the system by creating a file and assigning it as swap. Begin by creating the swap file using the <a id="_idIndexMarker672"/><span class="My-Italic _idGenCharOverride-1">dd</span> command. The size of the file can be changed by adjusting the <span class="My-Italic _idGenCharOverride-1">count=</span> variable. The following command-line, for example, creates a 2.0 GB file:</p>&#13;
			<p class="Code"># dd if=/dev/zero of=/newswap bs=1024 count=2000000</p>&#13;
			<p class="Code">2000000+0 records in</p>&#13;
			<p class="Code">2000000+0 records out</p>&#13;
			<p class="Code">2048000000 bytes (2.0 GB, 1.9 GiB) copied, 3.62697 s, 565 MB/s</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Before converting the file to a swap file, it is important to make sure the file has secure permissions set:</p>&#13;
			<p class="Code"># chmod 0600 /newswap</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Once a suitable file has been created, it needs to be converted into a swap file using the <a id="_idIndexMarker673"/><span class="My-Italic _idGenCharOverride-1">mkswap</span> command:</p>&#13;
			<p class="Code"># mkswap /newswap</p>&#13;
			<p class="Code">Setting up swapspace version 1, size = 1.9 GiB (2047995904 bytes)</p>&#13;
			<p class="Code">no label, UUID=4ffc238d-7fde-4367-bd98-c5c46407e535</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">With the swap file created and configured it can be added to the system in real-time using the <span class="My-Italic _idGenCharOverride-1">swapon</span> utility:</p>&#13;
			<p class="Code"># swapon /newswap</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Rerunning swapon should now report that the new file is now being used as swap:</p>&#13;
			<p class="Code"># swapon</p>&#13;
			<p class="Code">NAME      TYPE      SIZE USED PRIO</p>&#13;
			<p class="Code">/dev/dm-1 partition   4G   0B   -2</p>&#13;
			<p class="Code">/newswap  file       1.9G   0B   -3</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">The swap space may be removed dynamically by using the <a id="_idIndexMarker674"/><span class="My-Italic _idGenCharOverride-1">swapoff </span>utility as follows:</p>&#13;
			<p class="Code"># swapoff /newswap</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Finally, modify the <span class="My-Italic _idGenCharOverride-1">/etc/fstab</span> file to automatically add the new swap at system boot time by adding the following line:</p>&#13;
			<p class="Code">/newswap    swap    swap   defaults 0 0</p>&#13;
			<p id="_idParaDest-304" class="Heading-1-1" lang="en-US" xml:lang="en-US"><span class="Heading11Marker">31.5 </span><a id="_idTextAnchor394"/>Adding <a id="_idIndexMarker675"/>Swap as a Partition</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">As an alternative to designating a file as swap space, entire disk partitions may also be designated as swap. The steps to achieve this are largely the same as those for adding a swap file. Before allocating a partition to swap, however, make sure that any existing data on the corresponding filesystem is either backed up or no longer needed and that the filesystem has been unmounted. </p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Assuming that a partition exists on a disk drive represented by <span class="My-Italic _idGenCharOverride-1">/dev/sdb1</span>, for example, the first step would be to convert this into a swap partition, once again using the <a id="_idIndexMarker676"/><span class="My-Italic _idGenCharOverride-1">mkswap</span> utility:</p>&#13;
			<p class="Code"># mkswap /dev/sdb1</p>&#13;
			<p class="Code">mkswap: /dev/sdb1: warning: wiping old xfs signature.</p>&#13;
			<p class="Code">Setting up swapspace version 1, size = 8 GiB (8587833344 bytes)</p>&#13;
			<p class="Code">no label, UUID=a899c8ec-c410-4569-ba18-ddea03370c7f </p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Next, add the new partition to the system swap and verify that it has indeed been added:</p>&#13;
			<p class="Code"># swapon /dev/sdb1</p>&#13;
			<p class="Code"># swapon</p>&#13;
			<p class="Code">NAME      TYPE      SIZE USED PRIO</p>&#13;
			<p class="Code">/dev/dm-1 partition   4G   0B   -2</p>&#13;
			<p class="Code">/dev/sdb1 partition   8G   0B   -3</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Once again, the <span class="My-Italic _idGenCharOverride-1">/etc/fstab</span> file may be modified to automatically add the swap partition at boot time as follows:</p>&#13;
			<p class="Code">/dev/sdb1    swap    swap   defaults 0 0</p>&#13;
			<p id="_idParaDest-305" class="Heading-1-1" lang="en-US" xml:lang="en-US"><span class="Heading11Marker">31.6 </span><a id="_idTextAnchor395"/>Adding <a id="_idIndexMarker677"/>Space to a CentOS 8 LVM Swap Volume</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">By default, CentOS 8 configures swap space using <a id="_idIndexMarker678"/>Logical Volume Management (LVM). An alternative to adding swap via file or disk partition, therefore, is to extend the logical volume used for the swap space. </p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">The first step is to identify the current amount of swap available and the volume group and logical volume used for the swap space using the <a id="_idIndexMarker679"/><span class="My-Italic _idGenCharOverride-1">lvdisplay</span> utility (for more information on LVM, refer to the chapter entitled <a href="../Text/Volume_Groups.xhtml#_idTextAnchor375"><span class="My-Italic _idGenCharOverride-1">“Adding a New Disk to a CentOS 8 Volume Group and Logical Volume”</span></a>):</p>&#13;
			<p class="Code"># lvdisplay</p>&#13;
			<p class="Code">  --- Logical volume ---</p>&#13;
			<p class="Code">  LV Path                /dev/cl/swap</p>&#13;
			<p class="Code">  LV Name                swap</p>&#13;
			<p class="Code">  VG Name                cl</p>&#13;
			<p class="Code">  LV UUID                fwOZsF-ROwu-6eLe-2KDR-JZ0d-Pn4o-K5B0Vb</p>&#13;
			<p class="Code">  LV Write Access        read/write</p>&#13;
			<p class="Code">  LV Creation host, time demoserver, 2019-02-14 11:12:07 -0500</p>&#13;
			<p class="Code">  LV Status              available</p>&#13;
			<p class="Code">  # open                 2</p>&#13;
			<p class="Code">  LV Size                &lt;3.98 GiB</p>&#13;
			<p class="Code">  Current LE             1018</p>&#13;
			<p class="Code">  Segments               1</p>&#13;
			<p class="Code">  Allocation             inherit</p>&#13;
			<p class="Code">  Read ahead sectors     auto</p>&#13;
			<p class="Code">  - currently set to     256</p>&#13;
			<p class="Code">  Block device           253:1</p>&#13;
			<p class="Code">.</p>&#13;
			<p class="Code">.</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Clearly the swap resides on a logical volume named <span class="My-Italic _idGenCharOverride-1">swap</span> which is part of the volume group named <span class="My-Italic CharOverride-1">cl</span>. The next step is to verify if there is any space available on the volume group that can be allocated to swap volume:</p>&#13;
			<p class="Code"># vgs</p>&#13;
			<p class="Code">  VG   #PV #LV #SN Attr   VSize   VFree </p>&#13;
			<p class="Code">  cl     2   3   0 wz--n- 197.66g &lt;22.00g</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">If the amount of space available is sufficient to meet additional swap requirements, turn off the swap and extend the swap logical volume to use as much of the available space as needed to meet the system’s swap requirements:</p>&#13;
			<p class="Code"># swapoff /dev/cl/swap</p>&#13;
			<p class="Code"># lvextend -L+8GB /dev/cl/swap</p>&#13;
			<p class="Code">    Logical volume cl/swap successfully resized.</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Next, reformat the swap volume and turn the swap back on:</p>&#13;
			<p class="Code"># mkswap /dev/cl/swap</p>&#13;
			<p class="Code">mkswap: /dev/cl/swap: warning: wiping old swap signature.</p>&#13;
			<p class="Code">Setting up swapspace version 1, size = 12 GiB (12754874368 bytes)</p>&#13;
			<p class="Code">no label, UUID=241a4818-e51c-4b8c-9bc9-1697fc2ce26e</p>&#13;
			<p class="Code"> </p>&#13;
			<p class="Code"># swapon /dev/cl/swap</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Having made the changes, check that the swap space has increased:</p>&#13;
			<p class="Code"># swapon</p>&#13;
			<p class="Code">NAME      TYPE       SIZE USED PRIO</p>&#13;
			<p class="Code">/dev/dm-1 partition  12G   0B   -2</p>&#13;
			<p id="_idParaDest-306" class="Heading-1-1" lang="en-US" xml:lang="en-US"><span class="Heading11Marker">31.7 </span><a id="_idTextAnchor396"/>Adding <a id="_idIndexMarker680"/>Swap Space to the Volume Group</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">In the above section we extended the swap logical volume to use space that was already available in the volume group. If no space is available in the volume group then it will need to be added before the swap can be extended. </p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Begin by checking the status of the volume group:</p>&#13;
			<p class="Code"># vgs</p>&#13;
			<p class="Code">  VG   #PV #LV #SN Attr   VSize    VFree</p>&#13;
			<p class="Code">  cl     1   3   0 wz--n- &lt;189.67g    0</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">The above output indicates that no space is available within the volume group. Suppose, however, that we have a requirement to add 8 GB to the swap on the system. Clearly, this will require the addition of more space to the volume group. For the purposes of this example it will be assumed that a disk that is 8 GB in size and represented by <span class="My-Italic _idGenCharOverride-1">/dev/sdb</span> is available for addition to the volume group. The first step is to turn this partition into a physical volume:</p>&#13;
			<p class="Code"># pvcreate /dev/sdb</p>&#13;
			<p class="Code">  Physical volume "/dev/sdb" successfully created.</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">If the creation fails with a message similar to “Device /dev/sdb excluded by a filter”, it may be necessary to wipe the disk before creating the physical volume:</p>&#13;
			<p class="Code"># wipefs -a /dev/sdb</p>&#13;
			<p class="Code">/dev/sdb: 8 bytes were erased at offset 0x00000200 (gpt): 45 46 49 20 50 41 52 54</p>&#13;
			<p class="Code">/dev/sdb: 8 bytes were erased at offset 0x1fffffe00 (gpt): 45 46 49 20 50 41 52 54</p>&#13;
			<p class="Code">/dev/sdb: 2 bytes were erased at offset 0x000001fe (PMBR): 55 aa</p>&#13;
			<p class="Code">/dev/sdb: calling ioctl to re-read partition table: Success</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Next, the volume group needs to be extended to use this additional physical volume:</p>&#13;
			<p class="Code"># vgextend cl /dev/sdb</p>&#13;
			<p class="Code">  Volume group "cl" successfully extended</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">At this point the <span class="My-Italic _idGenCharOverride-1">vgs</span> command should report the addition of the 8 GB of space to the volume group:</p>&#13;
			<p class="Code"># vgs</p>&#13;
			<p class="Code">  VG   #PV #LV #SN Attr   VSize   VFree </p>&#13;
			<p class="Code">  cl     2   3   0 wz--n- 197.66g &lt;8.00g</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Now that the additional space is available in the volume group, the swap logical volume may be extended to utilize the space. First, turn off the swap using the <a id="_idIndexMarker681"/><span class="My-Italic _idGenCharOverride-1">swapoff</span> utility:</p>&#13;
			<p class="Code"># swapoff /dev/cl/swap</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Next, extend the logical volume to use the new space:</p>&#13;
			<p class="Code">## lvextend -L+7.9GB /dev/cl/swap</p>&#13;
			<p class="Code">  Rounding size to boundary between physical extents: 7.90 GiB.</p>&#13;
			<p class="Code">  Size of logical volume cl/swap changed from &lt;3.98 GiB (1018 extents) to &lt;11.88 GiB (3041 extents).</p>&#13;
			<p class="Code">  Logical volume cl/swap successfully resized.</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Re-create the swap on the logical volume:</p>&#13;
			<p class="Code"># mkswap /dev/cl/swap</p>&#13;
			<p class="Code">mkswap: /dev/cl/swap: warning: wiping old swap signature.</p>&#13;
			<p class="Code">Setting up swapspace version 1, size = 11.9 GiB (12754874368 bytes)</p>&#13;
			<p class="Code">no label, UUID=241a4818-e51c-4b8c-9bc9-1697fc2ce26e</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Next, turn swap back on:</p>&#13;
			<p class="Code"># swapon /dev/cl/swap</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Finally, use the<span class="My-Italic _idGenCharOverride-1"> </span><span class="My-Italic CharOverride-1"><a id="_idIndexMarker682"/></span><span class="My-Italic _idGenCharOverride-1">swapon</span> command to verify the addition of the swap space to the system:</p>&#13;
			<p class="Code"># swapon</p>&#13;
			<p class="Code">NAME      TYPE       SIZE USED PRIO</p>&#13;
			<p class="Code">/dev/dm-1 partition 11.9G   0B   -2</p>&#13;
			<p id="_idParaDest-307" class="Heading-1-1" lang="en-US" xml:lang="en-US"><span class="Heading11Marker">31.8 </span><a id="_idTextAnchor397"/>Summary</p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">Swap space is a vital component of just about any operating system in terms of handling situations where memory resources become constrained. By swapping out areas of memory to disk, the system is able to continue to function and meet the needs of the processes and applications running on it. </p>&#13;
			<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US">CentOS 8 has a set of guidelines recommending the amount of disk-based swap space that should be allocated depending on the amount of RAM installed in the system. In situations where these recommendations prove to be insufficient, additional swap space can be added to the system, typically without the need to reboot. As outlined in this chapter, swap space can be added in the form of a file, disk or disk partition or by extending existing logical volumes that have been configured as swap space. </p>&#13;
		</div>&#13;
</div>



  </body></html>