<html><head></head><body>
<div class="_idGenObjectStyleOverride-1" id="_idContainer276">
<p class="Chapter-Title" id="_idParaDest-194" lang="en-US" xml:lang="en-US"><span class="ChapterMarker"><span class="koboSpan" id="kobo.1.1">21. </span></span><a id="_idTextAnchor340"/><span class="koboSpan" id="kobo.2.1">Sharing Files between Ubuntu 23.04 and Windows with Samba</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.3.1">Although Linux has made some inroads into the desktop market, its origins and future are very much server based. </span><span class="koboSpan" id="kobo.3.2">It is unsurprising, therefore, that Ubuntu can act as a file server. </span><span class="koboSpan" id="kobo.3.3">It is also common for Ubuntu and Windows systems to be used side by side in networked environments. </span><span class="koboSpan" id="kobo.3.4">Therefore, it is a common requirement that files on an Ubuntu system be accessible to Linux, UNIX, and Windows-based systems over network connections. </span><span class="koboSpan" id="kobo.3.5">Similarly, shared folders and printers residing on Windows systems may also need to be accessible from Ubuntu-based systems. </span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.4.1">Windows systems share resources such as file systems and printers using the </span><a id="_idIndexMarker488"/><span class="koboSpan" id="kobo.5.1">Server Message Block (</span><a id="_idIndexMarker489"/><span class="koboSpan" id="kobo.6.1">SMB) protocol. </span><span class="koboSpan" id="kobo.6.2">For an Ubuntu system to serve such resources over a network to a Windows system and vice versa, it must support SMB. </span><span class="koboSpan" id="kobo.6.3">This is achieved using a technology called Samba. </span><span class="koboSpan" id="kobo.6.4">In addition to providing integration between Linux and Windows systems, Samba may also provide folder sharing between Linux systems (as an alternative to NFS covered in the previous chapter). </span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.7.1">In this chapter, we will look at the steps necessary to share file system resources and printers on an Ubuntu system with remote Windows and Linux systems and to access Windows resources from Ubuntu.</span></p>
<p class="Heading-1-1" id="_idParaDest-195" lang="en-US" xml:lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.8.1">21.1 </span></span><a id="_idTextAnchor341"/><span class="koboSpan" id="kobo.9.1">Accessing Windows Resources from the GNOME Desktop</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.10.1">Before getting into more details of Samba sharing, it is worth noting that if all you want to do is access Windows shared folders from within the GNOME desktop, then support is already provided within the GNOME Files application. </span><span class="koboSpan" id="kobo.10.2">The Files application is located in the dash as highlighted in </span><a href="Samba_File_Sharing.xhtml#_idTextAnchor342"><span class="koboSpan" id="kobo.11.1">Figure 21-1</span></a><span class="koboSpan" id="kobo.12.1">:</span></p>
<p class="My-Basic-Paragraph ParaOverride-1" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.13.1"><img alt="" class="_idGenObjectAttribute-1" src="image/ubuntu_files_icon.jpg"/></span></p>
<p class="Figure-Caption" lang="en-US" xml:lang="en-US"><span class="FigureCaptionMarker"><span class="koboSpan" id="kobo.14.1">Figure 21-1</span></span><a id="_idTextAnchor342"/></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.15.1">Once launched, select the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.16.1">Other Locations </span></span><span class="koboSpan" id="kobo.17.1">option in the left-hand navigation panel, followed by the Windows Network icon in the main panel to browse available Windows resources:</span></p>
<p class="My-Basic-Paragraph ParaOverride-1" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.18.1"><img alt="" class="_idGenObjectAttribute-2" src="image/ubuntu_files_windows_network.jpg"/></span></p>
<p class="Figure-Caption" lang="en-US" xml:lang="en-US"><span class="FigureCaptionMarker"><span class="koboSpan" id="kobo.19.1">Figure 21-2</span></span></p>
<p class="Heading-1-1" id="_idParaDest-196" lang="en-US" xml:lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.20.1">21.2 </span></span><a id="_idTextAnchor343"/><a id="_idIndexMarker490"/><span class="koboSpan" id="kobo.21.1">Samba and </span><a id="_idIndexMarker491"/><span class="koboSpan" id="kobo.22.1">Samba Client</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.23.1">Samba allows both Ubuntu resources to be shared with Windows systems and Windows resources to be shared with Ubuntu systems. </span><span class="koboSpan" id="kobo.23.2">Ubuntu accesses Windows resources using the Samba client. </span><span class="koboSpan" id="kobo.23.3">On the other hand, Ubuntu resources are shared with Windows systems by installing and configuring the Samba service.</span></p>
<p class="Heading-1-1" id="_idParaDest-197" lang="en-US" xml:lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.24.1">21.3 </span></span><a id="_idTextAnchor344"/><span class="koboSpan" id="kobo.25.1">Installing </span><a id="_idIndexMarker492"/><span class="koboSpan" id="kobo.26.1">Samba on Ubuntu</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.27.1">The default settings used during the Ubuntu installation do not typically install the necessary Samba packages. </span><span class="koboSpan" id="kobo.27.2">Unless you specifically requested that Samba be installed, it is unlikely that you have Samba installed on your system. </span><span class="koboSpan" id="kobo.27.3">To check whether Samba is installed, open a terminal window and run the following command and check for the [installed] indicator for each package: </span></p>
<p class="Code"><span class="koboSpan" id="kobo.28.1"># apt -qq list samba-common samba smbclient</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.29.1">Any missing packages can be installed using the </span><span class="My-Italic CharOverride-1"><span class="koboSpan" id="kobo.30.1">apt</span></span><span class="My-Italic _idGenCharOverride-1"> </span><span class="koboSpan" id="kobo.31.1">command-line tool:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.32.1"># apt install samba-common samba smbclient</span></p>
<p class="Heading-1-1" id="_idParaDest-198" lang="en-US" xml:lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.33.1">21.4 </span></span><a id="_idTextAnchor345"/><span class="koboSpan" id="kobo.34.1">Configuring the Ubuntu Firewall to Enable </span><a id="_idIndexMarker493"/><span class="koboSpan" id="kobo.35.1">Samba </span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.36.1">Next, the firewall protecting the Ubuntu system must be configured to allow Samba traffic. </span><span class="koboSpan" id="kobo.36.2">If you are using the Uncomplicated Firewall (ufw) run the following command:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.37.1"># ufw allow samba</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.38.1">Alternatively, if you are using firewalld, run the firewall-cmd command as follows:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.39.1"># firewall-cmd --permanent --add-port={139/tcp,445/tcp}</span></p>
<p class="Code"><span class="koboSpan" id="kobo.40.1"># firewall-cmd --reload</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.41.1">Before starting the Samba service, some configuration steps are necessary to define how the Ubuntu system will appear to Windows systems and the resources to be shared with remote clients. </span><span class="koboSpan" id="kobo.41.2">Most configuration tasks occur within the </span><a id="_idIndexMarker494"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.42.1">/etc/samba/</span></span><span class="My-Italic CharOverride-1"><a id="_idIndexMarker495"/><a id="_idIndexMarker496"/></span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.43.1">smb.conf</span></span><span class="koboSpan" id="kobo.44.1"> file.</span></p>
<p class="Heading-1-1" id="_idParaDest-199" lang="en-US" xml:lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.45.1">21.5 </span></span><a id="_idTextAnchor346"/><span class="koboSpan" id="kobo.46.1">Configuring the smb.conf File</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.47.1">Samba is a highly flexible and configurable system that provides many options for controlling how resources are shared on Windows networks. </span><span class="koboSpan" id="kobo.47.2">Unfortunately, this flexibility can lead to the sense that Samba is overly complex. </span><span class="koboSpan" id="kobo.47.3">In reality, however, the typical installation does not need many configuration options, and the learning curve to set up a basic configuration is relatively short.</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.48.1">For this chapter, we will look at joining an Ubuntu system to a Windows workgroup and setting up a directory as a shared resource that a specific user can access. </span><span class="koboSpan" id="kobo.48.2">This is a configuration known as a </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.49.1">standalone Samba server</span></span><span class="koboSpan" id="kobo.50.1">. </span><span class="koboSpan" id="kobo.50.2">More advanced configurations, such as integrating Samba within an Active Directory environment, are also available, though these are outside the scope of this book.</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.51.1">The first step in configuring Samba is to edit the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.52.1">/etc/samba/smb.conf</span></span><span class="koboSpan" id="kobo.53.1"> file.</span></p>
<p class="Heading-1-1-1" id="_idParaDest-200" lang="en-US" xml:lang="en-US"><span class="Heading111Marker"><span class="koboSpan" id="kobo.54.1">21.5.1 </span></span><a id="_idTextAnchor347"/><span class="koboSpan" id="kobo.55.1">Configuring the [global] Section</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.56.1">The </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.57.1">smb.conf</span></span><span class="koboSpan" id="kobo.58.1"> file is divided into sections. </span><span class="koboSpan" id="kobo.58.2">The first section is the [global] section, where settings that apply to the entire Samba configuration can be specified. </span><span class="koboSpan" id="kobo.58.3">While these settings are global, each option may be overridden within other configuration file sections.</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.59.1">The first task is defining the Windows workgroup name on which the Ubuntu resources will be shared. </span><span class="koboSpan" id="kobo.59.2">This is controlled via the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.60.1">workgroup =</span></span><span class="koboSpan" id="kobo.61.1"> directive of the [global] section, which by default is configured as follows:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.62.1">workgroup = WORKGROUP</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.63.1">Begin by changing this to the actual name of the workgroup if necessary.</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.64.1">In addition to the workgroup setting, the other settings indicate that this is a standalone server on which user passwords will protect the shared resources. </span><span class="koboSpan" id="kobo.64.2">Before moving on to configuring the resources to be shared, other parameters also need to be added to the [global] section as follows:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.65.1">[global]</span></p>
<p class="Code"><span class="koboSpan" id="kobo.66.1">.</span></p>
<p class="Code"><span class="koboSpan" id="kobo.67.1">.</span></p>
<p class="Code"><span class="koboSpan" id="kobo.68.1">        </span><span class="My-Bold _idGenCharOverride-2"><span class="koboSpan" id="kobo.69.1">netbios name = LinuxServer</span></span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.70.1">The “netbios name” property specifies the name by which the server will be visible to other systems on the network.</span></p>
<p class="Heading-1-1-1" id="_idParaDest-201" lang="en-US" xml:lang="en-US"><span class="Heading111Marker"><span class="koboSpan" id="kobo.71.1">21.5.2 </span></span><a id="_idTextAnchor348"/><span class="koboSpan" id="kobo.72.1">Configuring a Shared Resource</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.73.1">The next step is configuring the shared resources (in other words, the resources that will be accessible from other systems on the Windows network). </span><span class="koboSpan" id="kobo.73.2">To achieve this, the section is given a name by which it will be referred when shared. </span><span class="koboSpan" id="kobo.73.3">For example, if we plan to share the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.74.1">/sampleshare </span></span><span class="koboSpan" id="kobo.75.1">directory of our Ubuntu system, we might entitle the section [sampleshare]. </span><span class="koboSpan" id="kobo.75.2">In this section, a variety of configuration options are possible. </span><span class="koboSpan" id="kobo.75.3">For this example, however, we will define the directory that is to be shared, indicate that the directory is both browsable and writable, and declare the resource public so that guest users can gain access:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.76.1">[sampleshare]</span></p>
<p class="Code"><span class="koboSpan" id="kobo.77.1">        comment = Example Samba share</span></p>
<p class="Code"><span class="koboSpan" id="kobo.78.1">        path = /sampleshare</span></p>
<p class="Code"><span class="koboSpan" id="kobo.79.1">        browseable = Yes</span></p>
<p class="Code"><span class="koboSpan" id="kobo.80.1">        public = yes</span></p>
<p class="Code"><span class="koboSpan" id="kobo.81.1">        writable = yes</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.82.1">To restrict access to specific users, the “valid users” property may be used, for example:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.83.1">valid users = demo, bobyoung, marcewing</span></p>
<p class="Heading-1-1-1" id="_idParaDest-202" lang="en-US" xml:lang="en-US"><span class="Heading111Marker"><span class="koboSpan" id="kobo.84.1">21.5.3 </span></span><a id="_idTextAnchor349"/><span class="koboSpan" id="kobo.85.1">Removing Unnecessary Shares</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.86.1">The </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.87.1">smb.conf</span></span><span class="koboSpan" id="kobo.88.1"> file is pre-configured with sections for sharing printers and the home folders of the users on the system. </span><span class="koboSpan" id="kobo.88.2">If these resources do not need to be shared, the corresponding sections can be commented out so that Samba ignores them. </span><span class="koboSpan" id="kobo.88.3">In the following example, the [homes] section has been commented out:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.89.1">.</span></p>
<p class="Code"><span class="koboSpan" id="kobo.90.1">.</span></p>
<p class="Code"><span class="koboSpan" id="kobo.91.1">#[homes]</span></p>
<p class="Code"><span class="koboSpan" id="kobo.92.1">#       comment = Home Directories</span></p>
<p class="Code"><span class="koboSpan" id="kobo.93.1">#       valid users = %S, %D%w%S</span></p>
<p class="Code"><span class="koboSpan" id="kobo.94.1">#       browseable = No</span></p>
<p class="Code"><span class="koboSpan" id="kobo.95.1">#       read only = No</span></p>
<p class="Code"><span class="koboSpan" id="kobo.96.1">#       inherit acls = Yes</span></p>
<p class="Code"><span class="koboSpan" id="kobo.97.1">.</span></p>
<p class="Code"><span class="koboSpan" id="kobo.98.1">.</span></p>
<p class="Heading-1-1" id="_idParaDest-203" lang="en-US" xml:lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.99.1">21.6 </span></span><a id="_idTextAnchor350"/><a id="_idTextAnchor352"/><span class="koboSpan" id="kobo.100.1">Creating a </span><a id="_idIndexMarker519"/><span class="koboSpan" id="kobo.101.1">Samba User</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.102.1">Any user that requires access to a Samba shared resource must be configured as a Samba User and assigned a password. </span><span class="koboSpan" id="kobo.102.2">This task is achieved using the </span><span class="My-Italic CharOverride-1"><a id="_idIndexMarker520"/><a id="_idIndexMarker521"/></span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.103.1">smbpasswd</span></span><span class="koboSpan" id="kobo.104.1"> command-line tool. </span><span class="koboSpan" id="kobo.104.2">Consider, for example, that a user named demo is required to be able to access the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.105.1">/sampleshare</span></span><span class="koboSpan" id="kobo.106.1"> directory of our Ubuntu system from a Windows system. </span><span class="koboSpan" id="kobo.106.2">To fulfill this requirement, we must add demo as a Samba user as follows:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.107.1"># smbpasswd -a demo</span></p>
<p class="Code"><span class="koboSpan" id="kobo.108.1">New SMB password:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.109.1">Retype new SMB password:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.110.1">Added user demo.</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.111.1">Now that we have completed the configuration of an elementary Samba server, it is time to test our configuration file and then start the Samba services.</span></p>
<p class="Heading-1-1" id="_idParaDest-204" lang="en-US" xml:lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.112.1">21.7 </span></span><a id="_idTextAnchor353"/><span class="koboSpan" id="kobo.113.1">Testing the </span><a id="_idIndexMarker522"/><a id="_idIndexMarker523"/><a id="_idIndexMarker524"/><span class="koboSpan" id="kobo.114.1">smb.conf File</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.115.1">The settings in the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.116.1">smb.conf</span></span><span class="koboSpan" id="kobo.117.1"> file may be checked for errors using the</span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.118.1"> testparm</span></span><span class="koboSpan" id="kobo.119.1"> command-line tool as follows:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.120.1"># testparm</span></p>
<p class="Code"><span class="koboSpan" id="kobo.121.1">Load smb config files from /etc/samba/smb.conf</span></p>
<p class="Code"><span class="koboSpan" id="kobo.122.1">Loaded services file OK.</span></p>
<p class="Code"><span class="koboSpan" id="kobo.123.1">Weak crypto is allowed</span></p>
<p class="Code"><span class="koboSpan" id="kobo.124.1">Server role: ROLE_STANDALONE</span></p>
<p class="Code"><span class="koboSpan" id="kobo.125.1">Press enter to see a dump of your service definitions</span></p>
<p class="Code"><span class="koboSpan" id="kobo.126.1"> </span></p>
<p class="Code"><span class="koboSpan" id="kobo.127.1"># Global parameters</span></p>
<p class="Code"><span class="koboSpan" id="kobo.128.1">[global]</span></p>
<p class="Code"><span class="koboSpan" id="kobo.129.1">	log file = /var/log/samba/%m.log</span></p>
<p class="Code"><span class="koboSpan" id="kobo.130.1">	netbios name = LINUXSERVER</span></p>
<p class="Code"><span class="koboSpan" id="kobo.131.1">	printcap name = cups</span></p>
<p class="Code"><span class="koboSpan" id="kobo.132.1">	security = USER</span></p>
<p class="Code"><span class="koboSpan" id="kobo.133.1">	wins support = Yes</span></p>
<p class="Code"><span class="koboSpan" id="kobo.134.1">	idmap config * : backend = tdb</span></p>
<p class="Code"><span class="koboSpan" id="kobo.135.1">	cups options = raw</span></p>
<p class="Code"><span class="koboSpan" id="kobo.136.1"> </span></p>
<p class="Code"><span class="koboSpan" id="kobo.137.1">[sampleshare]</span></p>
<p class="Code"><span class="koboSpan" id="kobo.138.1">	comment = Example Samba share</span></p>
<p class="Code"><span class="koboSpan" id="kobo.139.1">	guest ok = Yes</span></p>
<p class="Code"><span class="koboSpan" id="kobo.140.1">	path = /sampleshare</span></p>
<p class="Code"><span class="koboSpan" id="kobo.141.1">	read only = No</span><a id="_idIndexMarker525"/></p>
<p class="Code"><span class="koboSpan" id="kobo.142.1"> </span></p>
<p class="Code"><span class="koboSpan" id="kobo.143.1">[homes]</span></p>
<p class="Code"><span class="koboSpan" id="kobo.144.1">	browseable = No</span></p>
<p class="Code"><span class="koboSpan" id="kobo.145.1">	comment = Home Directories</span></p>
<p class="Code"><span class="koboSpan" id="kobo.146.1">	inherit acls = Yes</span></p>
<p class="Code"><span class="koboSpan" id="kobo.147.1">	read only = No</span></p>
<p class="Code"><span class="koboSpan" id="kobo.148.1">	valid users = %S %D%w%S</span></p>
<p class="Code"><span class="koboSpan" id="kobo.149.1"> </span></p>
<p class="Code"><span class="koboSpan" id="kobo.150.1">[printers]</span></p>
<p class="Code"><span class="koboSpan" id="kobo.151.1">	browseable = No</span></p>
<p class="Code"><span class="koboSpan" id="kobo.152.1">	comment = All Printers</span></p>
<p class="Code"><span class="koboSpan" id="kobo.153.1">	create mask = 0600</span></p>
<p class="Code"><span class="koboSpan" id="kobo.154.1">	path = /var/tmp</span></p>
<p class="Code"><span class="koboSpan" id="kobo.155.1">	printable = Yes</span></p>
<p class="Code"><span class="koboSpan" id="kobo.156.1">.</span></p>
<p class="Code"><span class="koboSpan" id="kobo.157.1">.</span></p>
<p class="Heading-1-1" id="_idParaDest-205" lang="en-US" xml:lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.158.1">21.8 </span></span><a id="_idTextAnchor354"/><span class="koboSpan" id="kobo.159.1">Starting the Samba and </span><a id="_idIndexMarker526"/><a id="_idIndexMarker527"/><span class="koboSpan" id="kobo.160.1">NetBIOS Name Services</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.161.1">For an Ubuntu server to operate within a Windows network, the Samba (SMB) and </span><a id="_idIndexMarker528"/><a id="_idIndexMarker529"/><span class="koboSpan" id="kobo.162.1">NetBIOS nameservice (NMB) services must be started. </span><span class="koboSpan" id="kobo.162.2">Optionally, also enable the services so that they start each time the system boots:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.163.1"># systemctl enable smbd nmbd</span></p>
<p class="Code"><span class="koboSpan" id="kobo.164.1"># systemctl start smbd nmbd</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.165.1">Before attempting to connect from a Windows system, use the </span><a id="_idIndexMarker530"/><a id="_idIndexMarker531"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.166.1">smbclient</span></span><span class="koboSpan" id="kobo.167.1"> utility to verify that the share is configured:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.168.1"># smbclient -U demo -L localhost</span></p>
<p class="Code"><span class="koboSpan" id="kobo.169.1">Password for [WORKGROUP\demo]:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.170.1"> </span></p>
<p class="Code"><span class="koboSpan" id="kobo.171.1">	Sharename       Type      Comment</span></p>
<p class="Code"><span class="koboSpan" id="kobo.172.1">	---------       ----      -------</span></p>
<p class="Code"><span class="koboSpan" id="kobo.173.1">	sampleshare     Disk      Example Samba share</span></p>
<p class="Code"><span class="koboSpan" id="kobo.174.1">	print$          Disk      Printer Drivers</span></p>
<p class="Code"><span class="koboSpan" id="kobo.175.1">	IPC$            IPC       IPC Service (demoserver server (Samba, Ubuntu))</span></p>
<p class="Code"><span class="koboSpan" id="kobo.176.1">	demo            Disk      Home Directories</span></p>
<p class="Code"><span class="koboSpan" id="kobo.177.1">	HP_OfficeJet_Pro_9020_series_9F6907 Printer   HP_OfficeJet_Pro_9020_series</span></p>
<p class="Heading-1-1" id="_idParaDest-206" lang="en-US" xml:lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.178.1">21.9 </span></span><a id="_idTextAnchor355"/><span class="koboSpan" id="kobo.179.1">Accessing Samba Shares</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.180.1">Now that the Samba resources are configured and the services are running, it is time to access the shared resource from a Windows system. </span><span class="koboSpan" id="kobo.180.2">On a suitable Windows system on the same workgroup as the Ubuntu system, open Windows Explorer and right-click on the Network entry in the side panel to display the menu shown in </span><a href="Samba_File_Sharing.xhtml#_idTextAnchor356"><span class="koboSpan" id="kobo.181.1">Figure 21-3</span></a><span class="koboSpan" id="kobo.182.1">:</span></p>
<p class="My-Basic-Paragraph ParaOverride-1" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.183.1"><img alt="" class="_idGenObjectAttribute-3" src="image/windows_map_ubuntu_drive.jpg"/></span></p>
<p class="Figure-Caption" lang="en-US" xml:lang="en-US"><span class="FigureCaptionMarker"><span class="koboSpan" id="kobo.184.1">Figure 21-3</span></span><a id="_idTextAnchor356"/></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.185.1">Select the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.186.1">Map network drive...</span></span><span class="koboSpan" id="kobo.187.1"> menu option to display the dialog illustrated in </span><a href="Samba_File_Sharing.xhtml#_idTextAnchor357"><span class="koboSpan" id="kobo.188.1">Figure 21-4</span></a><span class="koboSpan" id="kobo.189.1">:</span></p>
<p class="My-Basic-Paragraph ParaOverride-1" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.190.1"><img alt="" class="_idGenObjectAttribute-4" src="image/windows_map_ubuntu_drive_folder.jpg"/></span></p>
<p class="Figure-Caption" lang="en-US" xml:lang="en-US"><span class="FigureCaptionMarker"><span class="koboSpan" id="kobo.191.1">Figure 21-4</span></span><a id="_idTextAnchor357"/></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.192.1">Select a drive letter and enter the path to a samba share. </span><span class="koboSpan" id="kobo.192.2">For example, assuming that the server name is LinuxServer and the samba user name is demo, the path to the user’s home folder would be as follows:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.193.1">\\LINUXSERVER\demo</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.194.1">Enable the Connect using different credentials checkbox and click finish. </span><span class="koboSpan" id="kobo.194.2">When the network credentials dialog appears, enter the Samba user name and the password that was assigned earlier using the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.195.1">smbpasswd</span></span><span class="koboSpan" id="kobo.196.1"> command:</span></p>
<p class="My-Basic-Paragraph ParaOverride-1" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.197.1"><img alt="" class="_idGenObjectAttribute-5" src="image/windows_map_ubuntu_drive_credentials.jpg"/></span></p>
<p class="Figure-Caption" lang="en-US" xml:lang="en-US"><span class="FigureCaptionMarker"><span class="koboSpan" id="kobo.198.1">Figure 21-5</span></span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.199.1">After the connection is established, a new Windows Explorer dialog will appear containing the contents of the shared Ubuntu folder:</span></p>
<p class="My-Basic-Paragraph ParaOverride-1" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.200.1"><img alt="" class="_idGenObjectAttribute-6" src="image/windows_mapped_ubuntu_drive.jpg"/></span></p>
<p class="Figure-Caption" lang="en-US" xml:lang="en-US"><span class="FigureCaptionMarker"><span class="koboSpan" id="kobo.201.1">Figure 21-6</span></span></p>
<p class="Heading-1-1" id="_idParaDest-207" lang="en-US" xml:lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.202.1">21.10 </span></span><a id="_idTextAnchor358"/><span class="koboSpan" id="kobo.203.1">Accessing Windows Shares from Ubuntu</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.204.1">As previously mentioned, Samba is a two-way street, allowing not only Windows systems to access files and printers hosted on an Ubuntu system but also allowing the Ubuntu system to access shared resources on Windows systems. </span><span class="koboSpan" id="kobo.204.2">This is achieved using the samba-client package, installed at this chapter’s start. </span><span class="koboSpan" id="kobo.204.3">If it is not currently installed, install it from a terminal window as follows:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.205.1"># apt install smbclient</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.206.1">Shared resources on a Windows system can be accessed from the Ubuntu desktop using the Files application or the command-line prompt using the </span><span class="My-Italic CharOverride-1"><a id="_idIndexMarker532"/><a id="_idIndexMarker533"/></span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.207.1">smbclient</span></span><span class="koboSpan" id="kobo.208.1"> and </span><a id="_idIndexMarker534"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.209.1">mount</span></span><span class="koboSpan" id="kobo.210.1"> tools. </span><span class="koboSpan" id="kobo.210.2">The steps in this section assume that the Windows system has enabled appropriate network-sharing settings. </span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.211.1">To access any shared resources on a Windows system using the GNOME desktop, launch the Files application and select the Other Locations option. </span><span class="koboSpan" id="kobo.211.2">This will display the screen shown in </span><a href="Samba_File_Sharing.xhtml#_idTextAnchor359"><span class="koboSpan" id="kobo.212.1">Figure 21-7</span></a><span class="koboSpan" id="kobo.213.1"> below, including an icon for the Windows Network (if one is detected):</span></p>
<p class="My-Basic-Paragraph ParaOverride-1" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.214.1"><img alt="" class="_idGenObjectAttribute-7" src="image/rhel_8_connect_to_windows_share.jpg"/></span> </p>
<p class="Figure-Caption" lang="en-US" xml:lang="en-US"><span class="FigureCaptionMarker"><span class="koboSpan" id="kobo.215.1">Figure 21-7</span></span><a id="_idTextAnchor359"/></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.216.1">Selecting the Windows Network option will display the Windows systems detected on the network and allow access to any shared resources.</span></p>
<p class="My-Basic-Paragraph ParaOverride-1" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.217.1"><img alt="" class="_idGenObjectAttribute-8" src="image/rhel_8_files_windows_10_share.jpg"/></span></p>
<p class="Figure-Caption" lang="en-US" xml:lang="en-US"><span class="FigureCaptionMarker"><span class="koboSpan" id="kobo.218.1">Figure 21-8</span></span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.219.1">Alternatively, the Connect to Server option may be used to connect to a specific system. </span><span class="koboSpan" id="kobo.219.2">Note that the name or IP address of the remote system must be prefixed by </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.220.1">smb://</span></span><span class="koboSpan" id="kobo.221.1"> and may be followed by the path to a specific shared resource, for example:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.222.1">smb://WinServer/Documents</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.223.1">Without a desktop environment, a remote Windows share may be mounted from the command line using the mount command and specifying the </span><a id="_idIndexMarker535"/><span class="koboSpan" id="kobo.224.1">cifs filesystem type. </span><span class="koboSpan" id="kobo.224.2">The following command, for example, mounts a share named Documents located on a Windows system named WinServer at a local mount point named </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.225.1">/winfiles</span></span><span class="koboSpan" id="kobo.226.1">:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.227.1"># mount -t cifs //WinServer/Documents /winfiles -o user=demo</span></p>
<p class="Heading-1-1" id="_idParaDest-208" lang="en-US" xml:lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.228.1">21.11 </span></span><a id="_idTextAnchor360"/><span class="koboSpan" id="kobo.229.1">Summary</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.230.1">In this chapter, we have looked at how to configure an Ubuntu system to act as both a Samba client and server, allowing the sharing of resources with Windows systems. </span><span class="koboSpan" id="kobo.230.2">Topics covered included the installation of Samba client and server packages and configuring Samba as a standalone server. </span><span class="koboSpan" id="kobo.230.3">In addition, the basic concepts of SELinux were introduced together with the steps to provide Samba access to a shared resource.</span></p>
</div>
</body></html>