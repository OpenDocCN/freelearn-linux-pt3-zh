<html><head></head><body>
<div id="_idContainer193">
<h1 class="chapter-number" id="_idParaDest-180"><a id="_idTextAnchor209"/><span class="koboSpan" id="kobo.1.1">17</span></h1>
<h1 id="_idParaDest-181"><a id="_idTextAnchor210"/><span class="koboSpan" id="kobo.2.1">Best Practices</span></h1>
<p><span class="koboSpan" id="kobo.3.1">This chapter aims to provide insight into our (the authors’) personal experience in working with embedded devices and embedded Linux development over the years. </span><span class="koboSpan" id="kobo.3.2">We have gathered some aspects that are often underestimated or wholly neglected to serve as inspiration for you in your </span><span class="No-Break"><span class="koboSpan" id="kobo.4.1">next project.</span></span></p>
<p><span class="koboSpan" id="kobo.5.1">We have split this chapter into two independent parts, one about the guidelines related to the Yocto Project specifics and the other about more general aspects of a project. </span><span class="koboSpan" id="kobo.5.2">This is so that you don’t have to study the two sections in a </span><span class="No-Break"><span class="koboSpan" id="kobo.6.1">particular order.</span></span></p>
<h1 id="_idParaDest-182"><a id="_idTextAnchor211"/><span class="koboSpan" id="kobo.7.1">Guidelines to follow for Yocto Project</span></h1>
<p><span class="koboSpan" id="kobo.8.1">This section </span><a id="_idIndexMarker502"/><span class="koboSpan" id="kobo.9.1">aims to gather some guidelines for aspects of the Yocto Project metadata and project organization tips that make our life easier in terms of short- and </span><span class="No-Break"><span class="koboSpan" id="kobo.10.1">long-term maintenance.</span></span></p>
<h2 id="_idParaDest-183"><a id="_idTextAnchor212"/><span class="koboSpan" id="kobo.11.1">Managing layers</span></h2>
<p><span class="koboSpan" id="kobo.12.1">As our journey </span><a id="_idIndexMarker503"/><span class="koboSpan" id="kobo.13.1">in product development advances, we will naturally use multiple repositories to meet the needs we face. </span><span class="koboSpan" id="kobo.13.2">Keeping track of the repositories is a complex challenge as we need to do </span><span class="No-Break"><span class="koboSpan" id="kobo.14.1">the following:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.15.1">Make sure we can reproduce a previous build in </span><span class="No-Break"><span class="koboSpan" id="kobo.16.1">the future</span></span></li>
<li><span class="koboSpan" id="kobo.17.1">Allow multiple team members to work in the same </span><span class="No-Break"><span class="koboSpan" id="kobo.18.1">code base</span></span></li>
<li><span class="koboSpan" id="kobo.19.1">Validate the changes we make using Continuous </span><span class="No-Break"><span class="koboSpan" id="kobo.20.1">Integration tools</span></span></li>
<li><span class="koboSpan" id="kobo.21.1">Avoid subtle changes in the layers </span><span class="No-Break"><span class="koboSpan" id="kobo.22.1">we use</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.23.1">Those goals are intimidating, but a few tools are in use, with different strategies to overcome </span><span class="No-Break"><span class="koboSpan" id="kobo.24.1">those challenges.</span></span></p>
<p><span class="koboSpan" id="kobo.25.1">The simplest </span><a id="_idIndexMarker504"/><span class="koboSpan" id="kobo.26.1">solution uses the </span><strong class="source-inline"><span class="koboSpan" id="kobo.27.1">image-buildinfo</span></strong><span class="koboSpan" id="kobo.28.1"> class (</span><a href="https://docs.yoctoproject.org/4.0.4/ref-manual/classes.html#image-buildinfo-bbclass"><span class="koboSpan" id="kobo.29.1">https://docs.yoctoproject.org/4.0.4/ref-manual/classes.html#image-buildinfo-bbclass</span></a><span class="koboSpan" id="kobo.30.1">), which writes a plain text file containing build information and layers revisions to the target filesystem at </span><strong class="source-inline"><span class="koboSpan" id="kobo.31.1">${sysconfdir}/buildinfo</span></strong><span class="koboSpan" id="kobo.32.1"> by default. </span><span class="koboSpan" id="kobo.32.2">Some tools have been developed that can help this process. </span><span class="koboSpan" id="kobo.32.3">These tools are discussed </span><span class="No-Break"><span class="koboSpan" id="kobo.33.1">as follows:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.34.1">Google </span><a id="_idIndexMarker505"/><span class="koboSpan" id="kobo.35.1">developed the </span><strong class="bold"><span class="koboSpan" id="kobo.36.1">repo</span></strong><span class="koboSpan" id="kobo.37.1"> (</span><a href="https://source.android.com/docs/setup/download#repo"><span class="koboSpan" id="kobo.38.1">https://source.android.com/docs/setup/download#repo</span></a><span class="koboSpan" id="kobo.39.1">) tool for Android development. </span><span class="koboSpan" id="kobo.39.2">It has been adopted for use in other projects. </span><span class="koboSpan" id="kobo.39.3">A critical aspect of repo is that it requires some tooling to integrate with Yocto Project-based projects to automate the build directory and environment configuration. </span><span class="koboSpan" id="kobo.39.4">See the </span><em class="italic"><span class="koboSpan" id="kobo.40.1">O.S. </span><span class="koboSpan" id="kobo.40.2">Systems Embedded Linux project</span></em><span class="koboSpan" id="kobo.41.1"> (</span><a href="https://github.com/OSSystemsEmbeddedLinux/ossystems-embedded-linux-platform"><span class="koboSpan" id="kobo.42.1">https://github.com/OSSystemsEmbeddedLinux/ossystems-embedded-linux-platform</span></a><span class="koboSpan" id="kobo.43.1">) as inspiration for using repo in </span><span class="No-Break"><span class="koboSpan" id="kobo.44.1">your projects.</span></span></li>
<li><span class="koboSpan" id="kobo.45.1">Siemens developed </span><strong class="bold"><span class="koboSpan" id="kobo.46.1">kas</span></strong><span class="koboSpan" id="kobo.47.1"> (</span><a href="https://github.com/siemens/kas"><span class="koboSpan" id="kobo.48.1">https://github.com/siemens/kas</span></a><span class="koboSpan" id="kobo.49.1">) to provide an easy mechanism for downloading sources, automating the build directory and environment configuration, and </span><span class="No-Break"><span class="koboSpan" id="kobo.50.1">so on.</span></span></li>
<li><span class="koboSpan" id="kobo.51.1">Garmin developed </span><strong class="bold"><span class="koboSpan" id="kobo.52.1">Whisk</span></strong><span class="koboSpan" id="kobo.53.1"> (</span><a href="https://github.com/garmin/whisk"><span class="koboSpan" id="kobo.54.1">https://github.com/garmin/whisk</span></a><span class="koboSpan" id="kobo.55.1">) to manage complex product configurations using OpenEmbedded and the Yocto Project. </span><span class="koboSpan" id="kobo.55.2">The key features are a single source tree, multiple axes of configuration, multiple product builds, isolated layer configuration, and </span><span class="No-Break"><span class="koboSpan" id="kobo.56.1">so on.</span></span></li>
<li><span class="koboSpan" id="kobo.57.1">Agilent developed </span><strong class="bold"><span class="koboSpan" id="kobo.58.1">Yocto Buddy</span></strong><span class="koboSpan" id="kobo.59.1"> (</span><a href="https://github.com/Agilent/yb"><span class="koboSpan" id="kobo.60.1">https://github.com/Agilent/yb</span></a><span class="koboSpan" id="kobo.61.1">). </span><span class="koboSpan" id="kobo.61.2">The design aims to ease the setup and keep Yocto Project-based environments synchronized. </span><span class="koboSpan" id="kobo.61.3">Yocto Buddy was inspired by all previously mentioned tools and is still early </span><span class="No-Break"><span class="koboSpan" id="kobo.62.1">in development.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.63.1">This is a </span><a id="_idIndexMarker506"/><span class="koboSpan" id="kobo.64.1">subset of existing tools and shouldn’t be considered a complete list. </span><span class="koboSpan" id="kobo.64.2">Ideally, you should play with them before deciding, as the choice depends on the project use case and </span><span class="No-Break"><span class="koboSpan" id="kobo.65.1">team expertise.</span></span></p>
<h2 id="_idParaDest-184"><a id="_idTextAnchor213"/><span class="koboSpan" id="kobo.66.1">Avoid creating too many layers</span></h2>
<p><span class="koboSpan" id="kobo.67.1">A significant </span><a id="_idIndexMarker507"/><span class="koboSpan" id="kobo.68.1">advantage of the Yocto Project is that it has the ability to use and create multiple layers. </span><span class="koboSpan" id="kobo.68.2">It allows us to do </span><span class="No-Break"><span class="koboSpan" id="kobo.69.1">the following:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.70.1">Reuse BSP layers from </span><span class="No-Break"><span class="koboSpan" id="kobo.71.1">semiconductor vendors</span></span></li>
<li><span class="koboSpan" id="kobo.72.1">Reduce duplication of work by sharing reusable blocks to enable the use of new or specific applications, programming languages, and </span><span class="No-Break"><span class="koboSpan" id="kobo.73.1">so on.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.74.1">However, creating multiple layers may be unproductive when developing a project or a set of products. </span><span class="koboSpan" id="kobo.74.2">For example, the development of BSP-only layers makes sense in the </span><span class="No-Break"><span class="koboSpan" id="kobo.75.1">following situations:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.76.1">The board is the </span><a id="_idIndexMarker508"/><span class="koboSpan" id="kobo.77.1">product, as in the </span><strong class="bold"><span class="koboSpan" id="kobo.78.1">System on Module</span></strong><span class="koboSpan" id="kobo.79.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.80.1">SoM</span></strong><span class="koboSpan" id="kobo.81.1">) </span><span class="No-Break"><span class="koboSpan" id="kobo.82.1">vendors’ case</span></span></li>
<li><span class="koboSpan" id="kobo.83.1">When external access to the layer is critical, however, we want to limit the access for the </span><span class="No-Break"><span class="koboSpan" id="kobo.84.1">non-BSP source</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.85.1">Using a single </span><a id="_idIndexMarker509"/><span class="koboSpan" id="kobo.86.1">layer for the product, or even the company, has many advantages, such as </span><span class="No-Break"><span class="koboSpan" id="kobo.87.1">the following:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.88.1">Facilitating the development of reusable components such as a </span><strong class="source-inline"><span class="koboSpan" id="kobo.89.1">packagegroup</span></strong><span class="koboSpan" id="kobo.90.1"> package for development tools or network utilities shared by </span><span class="No-Break"><span class="koboSpan" id="kobo.91.1">multiple products</span></span></li>
<li><span class="koboSpan" id="kobo.92.1">Reducing the risk of unexpected side effects due to changes for a specific product </span><span class="No-Break"><span class="koboSpan" id="kobo.93.1">or board</span></span></li>
<li><span class="koboSpan" id="kobo.94.1">Increasing the reuse of bug fixes across multiple products and reuse of BSP low-level components such as the Linux kernel </span><span class="No-Break"><span class="koboSpan" id="kobo.95.1">or bootloader</span></span></li>
<li><span class="koboSpan" id="kobo.96.1">Boosting standardization across multiple products, reducing the learning curve for new </span><span class="No-Break"><span class="koboSpan" id="kobo.97.1">team members</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.98.1">The decision to use one or more layers depends on several aspects; however, we recommend starting simple and, in the future, splitting the layer </span><span class="No-Break"><span class="koboSpan" id="kobo.99.1">if required.</span></span></p>
<h2 id="_idParaDest-185"><a id="_idTextAnchor214"/><span class="koboSpan" id="kobo.100.1">Prepare the product metadata for new Yocto Project releases</span></h2>
<p><span class="koboSpan" id="kobo.101.1">As our </span><a id="_idIndexMarker510"/><span class="koboSpan" id="kobo.102.1">product grows, so does our metadata and the need for good organization. </span><span class="koboSpan" id="kobo.102.2">Some use cases commonly seen during product development are </span><span class="No-Break"><span class="koboSpan" id="kobo.103.1">as follows:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.104.1">The need to backport a new recipe version due to a bug fix or </span><span class="No-Break"><span class="koboSpan" id="kobo.105.1">a feature</span></span></li>
<li><span class="koboSpan" id="kobo.106.1">A missing package configuration or bug fix is not yet available in the Yocto </span><span class="No-Break"><span class="koboSpan" id="kobo.107.1">Project recipe</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.108.1">We use two recipe directories to organize this kind </span><span class="No-Break"><span class="koboSpan" id="kobo.109.1">of content:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.110.1">recipes-backport</span></strong><span class="koboSpan" id="kobo.111.1">: Backports of recipes coming from new Yocto </span><span class="No-Break"><span class="koboSpan" id="kobo.112.1">Project releases</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.113.1">recipes-staging</span></strong><span class="koboSpan" id="kobo.114.1">: New recipes or </span><strong class="source-inline"><span class="koboSpan" id="kobo.115.1">bbappend</span></strong><span class="koboSpan" id="kobo.116.1"> files adding missing package configurations or </span><span class="No-Break"><span class="koboSpan" id="kobo.117.1">bug fixes</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.118.1">We continuously </span><a id="_idIndexMarker511"/><span class="koboSpan" id="kobo.119.1">send new recipes or bug fixes from </span><strong class="source-inline"><span class="koboSpan" id="kobo.120.1">recipes-staging</span></strong><span class="koboSpan" id="kobo.121.1"> to the respective upstream project (for example, OpenEmbedded Core). </span><span class="koboSpan" id="kobo.121.2">Then, when the patch is accepted, we move this change from </span><strong class="source-inline"><span class="koboSpan" id="kobo.122.1">recipes-staging</span></strong><span class="koboSpan" id="kobo.123.1"> to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.124.1">recipes-backport</span></strong><span class="koboSpan" id="kobo.125.1"> directory. </span><span class="koboSpan" id="kobo.125.2">This approach allows us to keep track of pending upstreaming tasks and easily upgrade our meta layer to a new Yocto Project release. </span><span class="koboSpan" id="kobo.125.3">Furthermore, we can quickly act on the backport directory and </span><span class="No-Break"><span class="koboSpan" id="kobo.126.1">remove it.</span></span></p>
<h2 id="_idParaDest-186"><a id="_idTextAnchor215"/><span class="koboSpan" id="kobo.127.1">Create your custom distro</span></h2>
<p><span class="koboSpan" id="kobo.128.1">When using </span><a id="_idIndexMarker512"/><span class="koboSpan" id="kobo.129.1">the Yocto Project, we usually add many configurations in </span><strong class="source-inline"><span class="koboSpan" id="kobo.130.1">build/conf/local.conf</span></strong><span class="koboSpan" id="kobo.131.1">. </span><span class="koboSpan" id="kobo.131.2">However, as discussed in the book, this is bad as it is not at source control management and is likely to differ among developers. </span><span class="koboSpan" id="kobo.131.3">Using a custom distribution has many benefits, and some of them are </span><span class="No-Break"><span class="koboSpan" id="kobo.132.1">highlighted here:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.133.1">Allows consistent use among </span><span class="No-Break"><span class="koboSpan" id="kobo.134.1">multiple developers</span></span></li>
<li><span class="koboSpan" id="kobo.135.1">Provides a clear view of the different </span><strong class="source-inline"><span class="koboSpan" id="kobo.136.1">DISTRO_FEATURES</span></strong><span class="koboSpan" id="kobo.137.1"> we use when compared to our base distribution (for </span><span class="No-Break"><span class="koboSpan" id="kobo.138.1">example, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.139.1">poky</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.140.1">)</span></span></li>
<li><span class="koboSpan" id="kobo.141.1">Provides a central place where we can have a global view of all the required recipe configurations we need for our product, reducing the number of </span><strong class="source-inline"><span class="koboSpan" id="kobo.142.1">bbappend</span></strong><span class="koboSpan" id="kobo.143.1"> files required to configure our recipes (for example, </span><strong class="source-inline"><span class="koboSpan" id="kobo.144.1">PACKAGECONFIG:pn-&lt;myrecipe&gt;:append = " </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.145.1">myfeature"</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.146.1">)</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.147.1">Besides those more technical aspects, using a custom distro also allows the proper branding of SDK or other Yocto </span><span class="No-Break"><span class="koboSpan" id="kobo.148.1">Project-generated artifacts.</span></span></p>
<p><span class="koboSpan" id="kobo.149.1">We learned how to create a custom distribution in the </span><em class="italic"><span class="koboSpan" id="kobo.150.1">Using a custom distribution</span></em><span class="koboSpan" id="kobo.151.1"> sectiown in </span><a href="B19361_12.xhtml#_idTextAnchor147"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.152.1">Chapter 12</span></em></span></a><span class="koboSpan" id="kobo.153.1">, </span><em class="italic"><span class="koboSpan" id="kobo.154.1">Creating </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.155.1">Custom Layers</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.156.1">.</span></span></p>
<h2 id="_idParaDest-187"><a id="_idTextAnchor216"/><span class="koboSpan" id="kobo.157.1">Avoid reusing existing images for your product</span></h2>
<p><span class="koboSpan" id="kobo.158.1">Images are </span><a id="_idIndexMarker513"/><span class="koboSpan" id="kobo.159.1">where everything fits together. </span><span class="koboSpan" id="kobo.159.2">When we are developing a product, it is important to minimize the number of packages we have installed in our images for </span><span class="No-Break"><span class="koboSpan" id="kobo.160.1">multiple reasons:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.161.1">Reducing the </span><span class="No-Break"><span class="koboSpan" id="kobo.162.1">rootfs size</span></span></li>
<li><span class="koboSpan" id="kobo.163.1">Reducing the </span><span class="No-Break"><span class="koboSpan" id="kobo.164.1">build time</span></span></li>
<li><span class="koboSpan" id="kobo.165.1">Reducing the number of licenses to </span><span class="No-Break"><span class="koboSpan" id="kobo.166.1">deal with</span></span></li>
<li><span class="koboSpan" id="kobo.167.1">Reducing the surface of attack for </span><span class="No-Break"><span class="koboSpan" id="kobo.168.1">security breaches</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.169.1">A typical starting point is copying the </span><strong class="source-inline"><span class="koboSpan" id="kobo.170.1">core-image-base.bb</span></strong><span class="koboSpan" id="kobo.171.1"> file to our custom layer as </span><strong class="source-inline"><span class="koboSpan" id="kobo.172.1">myproduct-image.bb</span></strong><span class="koboSpan" id="kobo.173.1"> and extending it, adding what we need for the product’s image. </span><span class="koboSpan" id="kobo.173.2">In addition, we create an image called </span><strong class="source-inline"><span class="koboSpan" id="kobo.174.1">myproduct-image-dev.bb</span></strong><span class="koboSpan" id="kobo.175.1"> for use during development and make sure it requires </span><strong class="source-inline"><span class="koboSpan" id="kobo.176.1">myproduct-image.bb</span></strong><span class="koboSpan" id="kobo.177.1"> along with the artifacts used only for development, avoiding code duplication. </span><span class="koboSpan" id="kobo.177.2">This way, we have two images for production and development, but they share the same core features </span><span class="No-Break"><span class="koboSpan" id="kobo.178.1">and packages.</span></span></p>
<h2 id="_idParaDest-188"><a id="_idTextAnchor217"/><span class="koboSpan" id="kobo.179.1">Standard SDK is commonly undervalued</span></h2>
<p><span class="koboSpan" id="kobo.180.1">Application development implies an interactive process, mainly because we usually continuously </span><a id="_idIndexMarker514"/><span class="koboSpan" id="kobo.181.1">build the application until we accomplish what we aim for. </span><span class="koboSpan" id="kobo.181.2">This use case is not well suited for the Yocto Project, mainly for the </span><span class="No-Break"><span class="koboSpan" id="kobo.182.1">following reasons:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.183.1">Every time we start the build of a recipe, it discards the previous </span><span class="No-Break"><span class="koboSpan" id="kobo.184.1">build objects</span></span></li>
<li><span class="koboSpan" id="kobo.185.1">The time needed for deploying the application or image is </span><span class="No-Break"><span class="koboSpan" id="kobo.186.1">much longer</span></span></li>
<li><span class="koboSpan" id="kobo.187.1">A lack of proper integration in the </span><span class="No-Break"><span class="koboSpan" id="kobo.188.1">IDE environment</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.189.1">There are alternatives for a few of those topics, such as using </span><strong class="source-inline"><span class="koboSpan" id="kobo.190.1">devtool</span></strong><span class="koboSpan" id="kobo.191.1"> to reuse the build objects and helping to deploy the application. </span><span class="koboSpan" id="kobo.191.2">We saw how to use </span><strong class="source-inline"><span class="koboSpan" id="kobo.192.1">devtool</span></strong><span class="koboSpan" id="kobo.193.1"> in the </span><em class="italic"><span class="koboSpan" id="kobo.194.1">Deploying to the target using devtool</span></em><span class="koboSpan" id="kobo.195.1"> and </span><em class="italic"><span class="koboSpan" id="kobo.196.1">Building a recipe using devtool</span></em><span class="koboSpan" id="kobo.197.1"> sections from </span><a href="B19361_09.xhtml#_idTextAnchor115"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.198.1">Chapter 9</span></em></span></a><span class="koboSpan" id="kobo.199.1">, </span><em class="italic"><span class="koboSpan" id="kobo.200.1">Developing with the Yocto Project</span></em><span class="koboSpan" id="kobo.201.1">, but the development experience is </span><span class="No-Break"><span class="koboSpan" id="kobo.202.1">still cumbersome.</span></span></p>
<p><span class="koboSpan" id="kobo.203.1">Using Standard </span><a id="_idIndexMarker515"/><span class="koboSpan" id="kobo.204.1">SDK for application and other components’ development, such as the Linux kernel and bootloader, is still preferable. </span><span class="koboSpan" id="kobo.204.2">This way, we focus on faster development, postponing or parallelizing the Yocto Project </span><span class="No-Break"><span class="koboSpan" id="kobo.205.1">integration task.</span></span></p>
<h2 id="_idParaDest-189"><a id="_idTextAnchor218"/><span class="koboSpan" id="kobo.206.1">Avoid too many patches for Linux kernel and bootloader modifications</span></h2>
<p><span class="koboSpan" id="kobo.207.1">The need </span><a id="_idIndexMarker516"/><span class="koboSpan" id="kobo.208.1">for patches in the Linux </span><a id="_idIndexMarker517"/><span class="koboSpan" id="kobo.209.1">kernel and bootloader is inherent to embedded Linux development, as we rarely use the hardware without any changes. </span><span class="koboSpan" id="kobo.209.2">The level of modification on those components is related to your hardware design, </span><span class="No-Break"><span class="koboSpan" id="kobo.210.1">for example:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.211.1">Using a </span><strong class="bold"><span class="koboSpan" id="kobo.212.1">Single-Board Computer</span></strong><span class="koboSpan" id="kobo.213.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.214.1">SBC</span></strong><span class="koboSpan" id="kobo.215.1">), the </span><a id="_idIndexMarker518"/><span class="koboSpan" id="kobo.216.1">number of changes should </span><span class="No-Break"><span class="koboSpan" id="kobo.217.1">be minimal</span></span></li>
<li><span class="koboSpan" id="kobo.218.1">In the </span><a id="_idIndexMarker519"/><span class="koboSpan" id="kobo.219.1">use of </span><strong class="bold"><span class="koboSpan" id="kobo.220.1">System-On-Module</span></strong><span class="koboSpan" id="kobo.221.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.222.1">SOM</span></strong><span class="koboSpan" id="kobo.223.1">) with a custom baseboard, the number of changes could vary depending on the number of modifications from the vendor baseboard </span><span class="No-Break"><span class="koboSpan" id="kobo.224.1">hardware design</span></span></li>
<li><span class="koboSpan" id="kobo.225.1">Ultimately, the use of custom hardware design implies the development of a custom BSP and, consequently, a considerable number </span><span class="No-Break"><span class="koboSpan" id="kobo.226.1">of modifications</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.227.1">Those are not set in stone. </span><span class="koboSpan" id="kobo.227.2">So, for example, consider starting the project using an SBC. </span><span class="koboSpan" id="kobo.227.3">Later, we find out that the vendor does not provide a good reference BSP, so the number of modifications and amount of work for the BSP will </span><span class="No-Break"><span class="koboSpan" id="kobo.228.1">increase considerably.</span></span></p>
<p><span class="koboSpan" id="kobo.229.1">When we have small changes, it is better to tackle the changes as patch files added to the component recipe. </span><span class="koboSpan" id="kobo.229.2">But when the effort to maintain the component increases, it justifies having a separate fork of that component to keep all the changes in place. </span><span class="koboSpan" id="kobo.229.3">Using a repository fork gives us the </span><span class="No-Break"><span class="koboSpan" id="kobo.230.1">following advantages:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.231.1">The history of </span><span class="No-Break"><span class="koboSpan" id="kobo.232.1">the changes</span></span></li>
<li><span class="koboSpan" id="kobo.233.1">Different branches or tags for development </span><span class="No-Break"><span class="koboSpan" id="kobo.234.1">and production</span></span></li>
<li><span class="koboSpan" id="kobo.235.1">The possibility of merging with </span><span class="No-Break"><span class="koboSpan" id="kobo.236.1">other providers</span></span></li>
<li><span class="koboSpan" id="kobo.237.1">It allows the use of much simpler recipes, as we don’t need to carry on </span><span class="No-Break"><span class="koboSpan" id="kobo.238.1">individual patches</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.239.1">In summary, we should use the strategy that makes sense for the project. </span><span class="koboSpan" id="kobo.239.2">Eventually, this will change, but using the right approach reduces the total effort to support the hardware in </span><span class="No-Break"><span class="koboSpan" id="kobo.240.1">use properly.</span></span></p>
<h2 id="_idParaDest-190"><a id="_idTextAnchor219"/><span class="koboSpan" id="kobo.241.1">Avoid using AUTOREV as SRCREV</span></h2>
<p><span class="koboSpan" id="kobo.242.1">The use of </span><strong class="source-inline"><span class="koboSpan" id="kobo.243.1">AUTOREV</span></strong><span class="koboSpan" id="kobo.244.1"> as </span><strong class="source-inline"><span class="koboSpan" id="kobo.245.1">SRCREV</span></strong><span class="koboSpan" id="kobo.246.1"> is usually applied when developing a product. </span><span class="koboSpan" id="kobo.246.2">We must </span><a id="_idIndexMarker520"/><span class="koboSpan" id="kobo.247.1">interactively change the code and try that code inside the Yocto Project. </span><span class="koboSpan" id="kobo.247.2">That said, this comes with a couple </span><span class="No-Break"><span class="koboSpan" id="kobo.248.1">of drawbacks:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.249.1">It is hard to reproduce the previous build as every time we rebuild our image, it may use a different revision for </span><span class="No-Break"><span class="koboSpan" id="kobo.250.1">our recipe.</span></span></li>
<li><span class="koboSpan" id="kobo.251.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.252.1">AUTOREV</span></strong><span class="koboSpan" id="kobo.253.1"> value is only applied when BitBake invalidates the cache of a specific recipe. </span><span class="koboSpan" id="kobo.253.2">That happens when we modify the recipe itself or when we change something that triggers the BitBake cache rebuild, such as changing any </span><strong class="source-inline"><span class="koboSpan" id="kobo.254.1">.</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.255.1">conf</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.256.1"> file.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.257.1">Those drawbacks make </span><strong class="source-inline"><span class="koboSpan" id="kobo.258.1">AUTOREV</span></strong><span class="koboSpan" id="kobo.259.1"> very fragile, and other alternatives can cover the interactive code change more consistently. </span><span class="koboSpan" id="kobo.259.2">Typically, </span><strong class="source-inline"><span class="koboSpan" id="kobo.260.1">devtool</span></strong><span class="koboSpan" id="kobo.261.1"> is used as it allows us to change the code directly in the workspace and forces the recipe to use this as the source. </span><span class="koboSpan" id="kobo.261.2">Another alternative is to use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.262.1">externalsrc.bbclass</span></strong><span class="koboSpan" id="kobo.263.1"> class (</span><a href="https://docs.yoctoproject.org/4.0.4/index.html#ref-classes-externalsrc"><span class="koboSpan" id="kobo.264.1">https://docs.yoctoproject.org/4.0.4/index.html#ref-classes-externalsrc</span></a><span class="koboSpan" id="kobo.265.1">), which allows us to configure a recipe to use a directory as the source for </span><span class="No-Break"><span class="koboSpan" id="kobo.266.1">the build.</span></span></p>
<h2 id="_idParaDest-191"><a id="_idTextAnchor220"/><span class="koboSpan" id="kobo.267.1">Create a Software Bill of Materials</span></h2>
<p><span class="koboSpan" id="kobo.268.1">The Poky </span><a id="_idIndexMarker521"/><span class="koboSpan" id="kobo.269.1">build system can describe </span><a id="_idIndexMarker522"/><span class="koboSpan" id="kobo.270.1">all the components used in an image from </span><a id="_idIndexMarker523"/><span class="koboSpan" id="kobo.271.1">the licenses for each software component. </span><span class="koboSpan" id="kobo.271.2">This description is generated as a </span><strong class="bold"><span class="koboSpan" id="kobo.272.1">Software Bill of Materials</span></strong><span class="koboSpan" id="kobo.273.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.274.1">SBOM</span></strong><span class="koboSpan" id="kobo.275.1">) using the </span><strong class="bold"><span class="koboSpan" id="kobo.276.1">Software Package Data Exchange</span></strong><span class="koboSpan" id="kobo.277.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.278.1">SPDX</span></strong><span class="koboSpan" id="kobo.279.1">) standard (</span><a href="https://spdx.dev/"><span class="koboSpan" id="kobo.280.1">https://spdx.dev/</span></a><span class="koboSpan" id="kobo.281.1">). </span><span class="koboSpan" id="kobo.281.2">Using the SPDX format has the advantage of leveraging existing tooling, allowing extra automation, which is impossible using Poky’s standard license </span><span class="No-Break"><span class="koboSpan" id="kobo.282.1">output format.</span></span></p>
<p><span class="koboSpan" id="kobo.283.1">The SBOM </span><a id="_idIndexMarker524"/><span class="koboSpan" id="kobo.284.1">is critical to ensure open source license compliance. </span><span class="koboSpan" id="kobo.284.2">However, the SBOM is not generated by default. </span><span class="koboSpan" id="kobo.284.3">You can refer to the </span><em class="italic"><span class="koboSpan" id="kobo.285.1">Creating a Software Bill of Materials</span></em><span class="koboSpan" id="kobo.286.1"> section from </span><em class="italic"><span class="koboSpan" id="kobo.287.1">The Yocto Project Development Tasks </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.288.1">Manual</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.289.1"> (</span></span><a href="https://docs.yoctoproject.org/4.0.4/dev-manual/common-tasks.html#creating-a-software-bill-of-materials"><span class="No-Break"><span class="koboSpan" id="kobo.290.1">https://docs.yoctoproject.org/4.0.4/dev-manual/common-tasks.html#creating-a-software-bill-of-materials</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.291.1">).</span></span></p>
<h1 id="_idParaDest-192"><a id="_idTextAnchor221"/><span class="koboSpan" id="kobo.292.1">Guidelines to follow for general projects</span></h1>
<p><span class="koboSpan" id="kobo.293.1">This section </span><a id="_idIndexMarker525"/><span class="koboSpan" id="kobo.294.1">discusses some project-related guidelines to follow to reduce the general project risk and avoid </span><span class="No-Break"><span class="koboSpan" id="kobo.295.1">common pitfalls.</span></span></p>
<h2 id="_idParaDest-193"><a id="_idTextAnchor222"/><span class="koboSpan" id="kobo.296.1">Continuously monitor the project license constraints</span></h2>
<p><span class="koboSpan" id="kobo.297.1">Depending </span><a id="_idIndexMarker526"/><span class="koboSpan" id="kobo.298.1">on the project we are working on, license compliance might be a big or a small topic. </span><span class="koboSpan" id="kobo.298.2">Some projects have very restricted license constraints, such as </span><span class="No-Break"><span class="koboSpan" id="kobo.299.1">the following:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.300.1">The inability to use </span><span class="No-Break"><span class="koboSpan" id="kobo.301.1">GPLv3-released software</span></span></li>
<li><span class="koboSpan" id="kobo.302.1">Copyleft contamination of project-specific </span><span class="No-Break"><span class="koboSpan" id="kobo.303.1">intellectual property</span></span></li>
<li><span class="koboSpan" id="kobo.304.1">Company-wise </span><span class="No-Break"><span class="koboSpan" id="kobo.305.1">license constraints</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.306.1">The advice is to start this process at the beginning of the project, reducing the amount of rework throughout the project. </span><span class="koboSpan" id="kobo.306.2">However, the project license constraints and the project component’s licenses may change, requiring us to monitor our license </span><span class="No-Break"><span class="koboSpan" id="kobo.307.1">compliance continuously.</span></span></p>
<h2 id="_idParaDest-194"><a id="_idTextAnchor223"/><span class="koboSpan" id="kobo.308.1">Security can harm your project</span></h2>
<p><span class="koboSpan" id="kobo.309.1">In our </span><a id="_idIndexMarker527"/><span class="koboSpan" id="kobo.310.1">hyper-connected era, every connected device is a potential target for a security attack. </span><span class="koboSpan" id="kobo.310.2">As embedded device developers, we should contribute to a safer place. </span><span class="koboSpan" id="kobo.310.3">We should do </span><span class="No-Break"><span class="koboSpan" id="kobo.311.1">the following:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.312.1">Scan our embedded Linux software for known </span><span class="No-Break"><span class="koboSpan" id="kobo.313.1">security flaws</span></span></li>
<li><span class="koboSpan" id="kobo.314.1">Monitor critical software for </span><span class="No-Break"><span class="koboSpan" id="kobo.315.1">security fixes</span></span></li>
<li><span class="koboSpan" id="kobo.316.1">Implement a process for fixing </span><span class="No-Break"><span class="koboSpan" id="kobo.317.1">field devices</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.318.1">We can use </span><a id="_idIndexMarker528"/><span class="koboSpan" id="kobo.319.1">the Yocto Project infrastructure, as discussed in the </span><em class="italic"><span class="koboSpan" id="kobo.320.1">Checking for Vulnerabilities</span></em><span class="koboSpan" id="kobo.321.1"> section of </span><em class="italic"><span class="koboSpan" id="kobo.322.1">Yocto Project Development Tasks Manual</span></em><span class="koboSpan" id="kobo.323.1"> (</span><a href="https://docs.yoctoproject.org/4.0.4/dev-manual/common-tasks.html#checking-for-vulnerabilities"><span class="koboSpan" id="kobo.324.1">https://docs.yoctoproject.org/4.0.4/dev-manual/common-tasks.html#checking-for-vulnerabilities</span></a><span class="koboSpan" id="kobo.325.1">), to scan for known </span><strong class="bold"><span class="koboSpan" id="kobo.326.1">Common Vulnerabilities and Exposures</span></strong><span class="koboSpan" id="kobo.327.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.328.1">CVE</span></strong><span class="koboSpan" id="kobo.329.1">) for our recipes. </span><span class="koboSpan" id="kobo.329.2">We should not be limited </span><a id="_idIndexMarker529"/><span class="koboSpan" id="kobo.330.1">to this as our BSP components might also require security fixes, which the BSP vendors commonly neglect. </span><span class="koboSpan" id="kobo.330.2">Still, the paranoia level depends on the </span><span class="No-Break"><span class="koboSpan" id="kobo.331.1">project niche.</span></span></p>
<h2 id="_idParaDest-195"><a id="_idTextAnchor224"/><span class="koboSpan" id="kobo.332.1">Don’t underestimate maintenance costs</span></h2>
<p><span class="koboSpan" id="kobo.333.1">At first, upstreaming </span><a id="_idIndexMarker530"/><span class="koboSpan" id="kobo.334.1">our changes might not seem strategic for the </span><span class="No-Break"><span class="koboSpan" id="kobo.335.1">following reasons:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.336.1">Upstreaming uses resources to </span><span class="No-Break"><span class="koboSpan" id="kobo.337.1">adapt modifications</span></span></li>
<li><span class="koboSpan" id="kobo.338.1">Upstream review feedback may require additional interactions </span><span class="No-Break"><span class="koboSpan" id="kobo.339.1">and rework</span></span></li>
<li><span class="koboSpan" id="kobo.340.1">Development work not directly connected to the product needs to </span><span class="No-Break"><span class="koboSpan" id="kobo.341.1">be done</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.342.1">Usually, development and management teams underestimate the total cost of maintenance. </span><span class="koboSpan" id="kobo.342.2">But unfortunately, this is frequently the most expensive part of the project, as it lasts for years. </span><span class="koboSpan" id="kobo.342.3">Upstreaming our changes to the respective project allows us to do </span><span class="No-Break"><span class="koboSpan" id="kobo.343.1">the following:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.344.1">Avoid work duplication over </span><span class="No-Break"><span class="koboSpan" id="kobo.345.1">the years</span></span></li>
<li><span class="koboSpan" id="kobo.346.1">Reduce the friction during upgrades for new Yocto </span><span class="No-Break"><span class="koboSpan" id="kobo.347.1">Project releases</span></span></li>
<li><span class="koboSpan" id="kobo.348.1">Receive critical and constructive feedback about the changes we </span><span class="No-Break"><span class="koboSpan" id="kobo.349.1">are upstreaming</span></span></li>
<li><span class="koboSpan" id="kobo.350.1">Reduce the amount of work with security updates and </span><span class="No-Break"><span class="koboSpan" id="kobo.351.1">bug fixes</span></span></li>
<li><span class="koboSpan" id="kobo.352.1">Reduce the amount of code we have </span><span class="No-Break"><span class="koboSpan" id="kobo.353.1">to maintain</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.354.1">The upstream work is continuous. </span><span class="koboSpan" id="kobo.354.2">Every time we add a new feature, we potentially increase the gap between our code and the upstream. </span><span class="koboSpan" id="kobo.354.3">Therefore, we may postpone the upstreaming work, but the upstreaming costs will be multiplied when you work on updating to the next Yocto </span><span class="No-Break"><span class="koboSpan" id="kobo.355.1">Project release.</span></span></p>
<h2 id="_idParaDest-196"><a id="_idTextAnchor225"/><span class="koboSpan" id="kobo.356.1">Tackle project risk points and constraints as soon as possible</span></h2>
<p><span class="koboSpan" id="kobo.357.1">As the </span><a id="_idIndexMarker531"/><span class="koboSpan" id="kobo.358.1">software and hardware must work together, a few aspects directly depend on our hardware design. </span><span class="koboSpan" id="kobo.358.2">To reduce the project risk, we should anticipate as many critical software and hardware requirements as possible so we can validate some aspects, such as </span><span class="No-Break"><span class="koboSpan" id="kobo.359.1">the following:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.360.1">Is the amount of memory we intend to use enough or </span><span class="No-Break"><span class="koboSpan" id="kobo.361.1">too much?</span></span></li>
<li><span class="koboSpan" id="kobo.362.1">Is the amount of power the hardware uses sufficient for </span><span class="No-Break"><span class="koboSpan" id="kobo.363.1">our constraints?</span></span></li>
<li><span class="koboSpan" id="kobo.364.1">Is the target GPU capable of rendering the animations </span><span class="No-Break"><span class="koboSpan" id="kobo.365.1">we need?</span></span></li>
<li><span class="koboSpan" id="kobo.366.1">Do all the planned peripheral devices have available Linux kernel drivers ready for use or do we need to plan the development </span><span class="No-Break"><span class="koboSpan" id="kobo.367.1">for those?</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.368.1">The preceding questions can be answered using a reference or well-known board, which we have </span><a id="_idIndexMarker532"/><span class="koboSpan" id="kobo.369.1">ready to use BSP. </span><span class="koboSpan" id="kobo.369.2">This allows us to produce a </span><strong class="bold"><span class="koboSpan" id="kobo.370.1">Minimal Viable Product</span></strong><span class="koboSpan" id="kobo.371.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.372.1">MVP</span></strong><span class="koboSpan" id="kobo.373.1">) without the need to design our custom hardware. </span><span class="koboSpan" id="kobo.373.2">After we validate the project’s risks and constraints, those boards are still valuable assets for </span><span class="No-Break"><span class="koboSpan" id="kobo.374.1">the following:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.375.1">Continuing the development of our software until the custom board and BSP are ready </span><span class="No-Break"><span class="koboSpan" id="kobo.376.1">for use</span></span></li>
<li><span class="koboSpan" id="kobo.377.1">As a base of comparison with our </span><span class="No-Break"><span class="koboSpan" id="kobo.378.1">custom design</span></span></li>
<li><span class="koboSpan" id="kobo.379.1">As a reference to verify whether a bug is specific to our custom board </span><span class="No-Break"><span class="koboSpan" id="kobo.380.1">and BSP</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.381.1">Considering we can develop our software using a reference or a well-known board, we should postpone the design of a custom board for as long as possible. </span><span class="koboSpan" id="kobo.381.2">Delaying the design gives us the freedom to change many aspects of our project, such as changing a peripheral because of a specific driver or even changing the planned CPU and memory capabilities after maturing the application </span><span class="No-Break"><span class="koboSpan" id="kobo.382.1">and features.</span></span></p>
<p><span class="koboSpan" id="kobo.383.1">When we finally decide to go with a custom design, we should keep it as close as possible to the board we choose as a reference. </span><span class="koboSpan" id="kobo.383.2">But, of course, sometimes we need to deviate from the reference design. </span><span class="koboSpan" id="kobo.383.3">Still, it comes with the risk of introducing design issues and increasing the cost of our </span><span class="No-Break"><span class="koboSpan" id="kobo.384.1">custom BSP.</span></span></p>
<h1 id="_idParaDest-197"><a id="_idTextAnchor226"/><span class="koboSpan" id="kobo.385.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.386.1">Phew! </span><span class="koboSpan" id="kobo.386.2">In this final chapter, you have been introduced to a set of good practices that the authors have been using in their real-life projects. </span><span class="koboSpan" id="kobo.386.3">We hope they have given you some points to consider when planning your </span><span class="No-Break"><span class="koboSpan" id="kobo.387.1">next project.</span></span></p>
<p><span class="koboSpan" id="kobo.388.1">Throughout the book, we have covered the necessary background information for you to learn any other aspect of the Yocto Project that you may need on your own. </span><span class="koboSpan" id="kobo.388.2">So, you now have a general understanding of what is happening behind the scenes when you ask BitBake to build a recipe or an image. </span><span class="koboSpan" id="kobo.388.3">From now on, you are ready to free your mind and try new things. </span><span class="koboSpan" id="kobo.388.4">The ball is in your court now – here’s where the </span><span class="No-Break"><span class="koboSpan" id="kobo.389.1">fun begins!</span></span></p>
</div>
</body></html>