<html><head></head><body>
  <div id="_idContainer191" class="Basic-Text-Frame">
    <h1 class="chapterNumber"><span class="koboSpan" id="kobo.1.1">14</span></h1>
    <h1 id="_idParaDest-304" class="chapterTitle"><span class="koboSpan" id="kobo.2.1">Using awk – Part 1</span></h1>
    <p class="normal"><span class="koboSpan" id="kobo.3.1">In this chapter, I’ll show you a bit about </span><code class="inlineCode"><span class="koboSpan" id="kobo.4.1">awk</span></code><span class="koboSpan" id="kobo.5.1">. </span><span class="koboSpan" id="kobo.5.2">It’s a programming environment with a long and storied history that dates back to the 1970s, when it was invented by Alfred Aho, Peter Weinberger, and Brian Kernighan for use with the early Unix operating systems.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.6.1">There are several ways in which you can use </span><code class="inlineCode"><span class="koboSpan" id="kobo.7.1">awk</span></code><span class="koboSpan" id="kobo.8.1">. </span><span class="koboSpan" id="kobo.8.2">It is a full-blown programming language, so you can use it to write very complex, stand-alone programs. </span><span class="koboSpan" id="kobo.8.3">You can also create simple </span><code class="inlineCode"><span class="koboSpan" id="kobo.9.1">awk</span></code><span class="koboSpan" id="kobo.10.1"> commands that you can either run from the command-line or from within normal shell scripts. </span><span class="koboSpan" id="kobo.10.2">There’s a lot to </span><code class="inlineCode"><span class="koboSpan" id="kobo.11.1">awk</span></code><span class="koboSpan" id="kobo.12.1">, and entire books have been written about it. </span><span class="koboSpan" id="kobo.12.2">The goal for this chapter is to show you how to use </span><code class="inlineCode"><span class="koboSpan" id="kobo.13.1">awk</span></code><span class="koboSpan" id="kobo.14.1"> in normal shell scripts.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.15.1">Topics in this chapter include:</span></p>
    <ul>
      <li class="bulletList"><span class="koboSpan" id="kobo.16.1">Introducing </span><code class="inlineCode"><span class="koboSpan" id="kobo.17.1">awk</span></code></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.18.1">Understanding patterns and actions</span></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.19.1">Obtaining input from text files</span></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.20.1">Obtaining input from commands</span></li>
    </ul>
    <p class="normal"><span class="koboSpan" id="kobo.21.1">If you’re ready to squawk with </span><code class="inlineCode"><span class="koboSpan" id="kobo.22.1">awk</span></code><span class="koboSpan" id="kobo.23.1">, let’s get started.</span></p>
    <h1 id="_idParaDest-305" class="heading 1"><span class="koboSpan" id="kobo.24.1">Introducing awk</span></h1>
    <p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.25.1">awk</span></code><span class="koboSpan" id="kobo.26.1"> is a pattern-scanning and text-processing</span><a id="_idIndexMarker867"/><span class="koboSpan" id="kobo.27.1"> utility that you can use to automate the process of creating reports and databases. </span><span class="koboSpan" id="kobo.27.2">With its built-in math functions, you can also use it to perform spreadsheet operations on text files of columnar, numerical data. </span><span class="koboSpan" id="kobo.27.3">The term </span><code class="inlineCode"><span class="koboSpan" id="kobo.28.1">awk</span></code><span class="koboSpan" id="kobo.29.1"> comes from the names of its creators, Aho, Weinberger and Kernighan. </span><span class="koboSpan" id="kobo.29.2">The original version is now referred to as “old </span><code class="inlineCode"><span class="koboSpan" id="kobo.30.1">awk</span></code><span class="koboSpan" id="kobo.31.1">". </span><span class="koboSpan" id="kobo.31.2">Newer implementations, such as </span><code class="inlineCode"><span class="koboSpan" id="kobo.32.1">nawk</span></code><span class="koboSpan" id="kobo.33.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.34.1">gawk</span></code><span class="koboSpan" id="kobo.35.1">, have more features and are somewhat easier to use.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.36.1">The version of </span><code class="inlineCode"><span class="koboSpan" id="kobo.37.1">awk</span></code><span class="koboSpan" id="kobo.38.1"> you have depends upon which operating system you’re running. </span><span class="koboSpan" id="kobo.38.2">Most Linux operating systems run </span><code class="inlineCode"><span class="koboSpan" id="kobo.39.1">gawk</span></code><span class="koboSpan" id="kobo.40.1">, which is the GNU implementation of </span><code class="inlineCode"><span class="koboSpan" id="kobo.41.1">awk</span></code><span class="koboSpan" id="kobo.42.1">. </span><span class="koboSpan" id="kobo.42.2">There’s most always an </span><code class="inlineCode"><span class="koboSpan" id="kobo.43.1">awk</span></code><span class="koboSpan" id="kobo.44.1"> symbolic link that points to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.45.1">gawk</span></code><span class="koboSpan" id="kobo.46.1"> executable, as you see here on my Fedora workstation:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.47.1">[donnie@fedora ~]$ awk --version
GNU Awk 5.1.1, API: 3.1 (GNU MPFR 4.1.1-p1, GNU MP 6.2.1)
Copyright (C) 1989, 1991-2021 Free Software Foundation.
</span><span class="koboSpan" id="kobo.47.2">This program is free software; you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation; either version 3 of the License, or
(at your option) any later version.
</span><span class="koboSpan" id="kobo.47.3">. </span><span class="koboSpan" id="kobo.47.4">. </span><span class="koboSpan" id="kobo.47.5">.
</span><span class="koboSpan" id="kobo.47.6">. </span><span class="koboSpan" id="kobo.47.7">. </span><span class="koboSpan" id="kobo.47.8">.
</span><span class="koboSpan" id="kobo.47.9">[donnie@fedora ~]$ ls -l /bin/awk
lrwxrwxrwx. </span><span class="koboSpan" id="kobo.47.10">1 root root 4 Jan 18  2023 /bin/awk -&gt; gawk
[donnie@fedora ~]$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.48.1">A notable exception is with Alpine Linux, which by default uses the lightweight </span><code class="inlineCode"><span class="koboSpan" id="kobo.49.1">awk</span></code><span class="koboSpan" id="kobo.50.1"> implementation that’s built into the </span><code class="inlineCode"><span class="koboSpan" id="kobo.51.1">busybox</span></code><span class="koboSpan" id="kobo.52.1"> executable. </span><span class="koboSpan" id="kobo.52.2">However, both </span><code class="inlineCode"><span class="koboSpan" id="kobo.53.1">gawk</span></code><span class="koboSpan" id="kobo.54.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.55.1">mawk</span></code><span class="koboSpan" id="kobo.56.1">, another </span><code class="inlineCode"><span class="koboSpan" id="kobo.57.1">awk</span></code><span class="koboSpan" id="kobo.58.1"> implementation, are available for installation from the Alpine repositories. </span><span class="koboSpan" id="kobo.58.2">(I couldn’t find a definitive answer for why </span><code class="inlineCode"><span class="koboSpan" id="kobo.59.1">mawk</span></code><span class="koboSpan" id="kobo.60.1"> is called </span><code class="inlineCode"><span class="koboSpan" id="kobo.61.1">mawk</span></code><span class="koboSpan" id="kobo.62.1">. </span><span class="koboSpan" id="kobo.62.2">But, its author is Michael Brennan, so I’m guessing that it’s supposed to stand for “Michael’s </span><code class="inlineCode"><span class="koboSpan" id="kobo.63.1">awk</span></code><span class="koboSpan" id="kobo.64.1">".)</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.65.1">Unix and Unix-like operating systems, such as macOS, OpenIndiana, and the various BSD distros, use </span><code class="inlineCode"><span class="koboSpan" id="kobo.66.1">nawk</span></code><span class="koboSpan" id="kobo.67.1">, which is short for “new </span><code class="inlineCode"><span class="koboSpan" id="kobo.68.1">awk</span></code><span class="koboSpan" id="kobo.69.1">". </span><span class="koboSpan" id="kobo.69.2">You’ll sometimes see this referred to as the “one true </span><code class="inlineCode"><span class="koboSpan" id="kobo.70.1">awk</span></code><span class="koboSpan" id="kobo.71.1">", partly because Brian Kernighan, one of the authors of the original </span><code class="inlineCode"><span class="koboSpan" id="kobo.72.1">awk</span></code><span class="koboSpan" id="kobo.73.1">, is one of its maintainers. </span><span class="koboSpan" id="kobo.73.2">However, </span><code class="inlineCode"><span class="koboSpan" id="kobo.74.1">gawk</span></code><span class="koboSpan" id="kobo.75.1"> is available for installation for both FreeBSD</span><a id="_idIndexMarker868"/><span class="koboSpan" id="kobo.76.1"> and OpenIndiana, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.77.1">mawk</span></code><span class="koboSpan" id="kobo.78.1"> is available for FreeBSD.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.79.1">So, what are the differences between these different </span><code class="inlineCode"><span class="koboSpan" id="kobo.80.1">awk</span></code><span class="koboSpan" id="kobo.81.1"> implementations? </span><span class="koboSpan" id="kobo.81.2">Well, here’s a quick run-down:</span></p>
    <ul>
      <li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.82.1">busybox</span></code><span class="koboSpan" id="kobo.83.1">: The </span><code class="inlineCode"><span class="koboSpan" id="kobo.84.1">awk</span></code><span class="koboSpan" id="kobo.85.1"> implementation</span><a id="_idIndexMarker869"/><span class="koboSpan" id="kobo.86.1"> that’s built into </span><code class="inlineCode"><span class="koboSpan" id="kobo.87.1">busybox</span></code><span class="koboSpan" id="kobo.88.1"> is super lightweight, and is ideal for low-resource embedded systems. </span><span class="koboSpan" id="kobo.88.2">This is why it’s the default choice for Alpine Linux, which is also popular for embedded systems. </span><span class="koboSpan" id="kobo.88.3">Be aware though that it might not always have the features that you need for complex </span><code class="inlineCode"><span class="koboSpan" id="kobo.89.1">awk</span></code><span class="koboSpan" id="kobo.90.1"> commands or scripts.</span></li>
      <li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.91.1">nawk</span></code><span class="koboSpan" id="kobo.92.1">: As I’ve already mentioned, </span><code class="inlineCode"><span class="koboSpan" id="kobo.93.1">nawk</span></code><span class="koboSpan" id="kobo.94.1"> is the default choice</span><a id="_idIndexMarker870"/><span class="koboSpan" id="kobo.95.1"> for most Unix and Unix-like systems such as FreeBSD, OpenIndiana, and macOS. </span><span class="koboSpan" id="kobo.95.2">But, the executable file you’ll find on these systems is normally just </span><code class="inlineCode"><span class="koboSpan" id="kobo.96.1">awk</span></code><span class="koboSpan" id="kobo.97.1">, instead of </span><code class="inlineCode"><span class="koboSpan" id="kobo.98.1">nawk</span></code><span class="koboSpan" id="kobo.99.1">.</span></li>
      <li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.100.1">mawk</span></code><span class="koboSpan" id="kobo.101.1">: This is supposed to be a faster</span><a id="_idIndexMarker871"/><span class="koboSpan" id="kobo.102.1"> version of </span><code class="inlineCode"><span class="koboSpan" id="kobo.103.1">awk</span></code><span class="koboSpan" id="kobo.104.1">, which was created by Mike Brennan.</span></li>
      <li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.105.1">gawk</span></code><span class="koboSpan" id="kobo.106.1">: This implementation</span><a id="_idIndexMarker872"/><span class="koboSpan" id="kobo.107.1"> has features that the other implementations don’t have. </span><span class="koboSpan" id="kobo.107.2">One major</span><a id="_idIndexMarker873"/><span class="koboSpan" id="kobo.108.1"> enhancement is the inclusion of </span><strong class="keyWord"><span class="koboSpan" id="kobo.109.1">internationalization and localization</span></strong><span class="koboSpan" id="kobo.110.1"> capabilities, which facilitates creating software for different languages and locales. </span><span class="koboSpan" id="kobo.110.2">It also includes TCP/IP networking capabilities and enhanced features for dealing with regular expressions.</span></li>
    </ul>
    <p class="normal"><span class="koboSpan" id="kobo.111.1">Unless I state otherwise, I’ll be showing you coding techniques that work the same on both </span><code class="inlineCode"><span class="koboSpan" id="kobo.112.1">nawk</span></code><span class="koboSpan" id="kobo.113.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.114.1">gawk</span></code><span class="koboSpan" id="kobo.115.1">. </span><span class="koboSpan" id="kobo.115.2">So, let’s get started.</span></p>
    <h1 id="_idParaDest-306" class="heading 1"><span class="koboSpan" id="kobo.116.1">Understanding Patterns and Actions</span></h1>
    <p class="normal"><span class="koboSpan" id="kobo.117.1">An </span><code class="inlineCode"><span class="koboSpan" id="kobo.118.1">awk</span></code> <strong class="keyWord"><span class="koboSpan" id="kobo.119.1">pattern</span></strong><span class="koboSpan" id="kobo.120.1"> is simply the text</span><a id="_idIndexMarker874"/><span class="koboSpan" id="kobo.121.1"> or the regular expression upon which an </span><strong class="keyWord"><span class="koboSpan" id="kobo.122.1">action</span></strong><span class="koboSpan" id="kobo.123.1"> will operate. </span><span class="koboSpan" id="kobo.123.2">The source</span><a id="_idIndexMarker875"/><span class="koboSpan" id="kobo.124.1"> can be either a plain text file or the output of another program. </span><span class="koboSpan" id="kobo.124.2">To begin, let’s dump the entire contents of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.125.1">/etc/passwd</span></code><span class="koboSpan" id="kobo.126.1"> file to the screen, like so:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.127.1">[donnie@fedora ~]$ awk '{print $0}' /etc/passwd
root:x:0:0:root:/root:/bin/bash
bin:x:1:1:bin:/bin:/sbin/nologin
. </span><span class="koboSpan" id="kobo.127.2">. </span><span class="koboSpan" id="kobo.127.3">.
</span><span class="koboSpan" id="kobo.127.4">. </span><span class="koboSpan" id="kobo.127.5">. </span><span class="koboSpan" id="kobo.127.6">.
</span><span class="koboSpan" id="kobo.127.7">donnie:x:1000:1000:Donald A. </span><span class="koboSpan" id="kobo.127.8">Tevault:/home/donnie:/bin/bash
systemd-coredump:x:986:986:systemd Core Dumper:/:/usr/sbin/nologin
systemd-timesync:x:985:985:systemd Time Synchronization:/:/usr/sbin/nologin
clamupdate:x:984:983:Clamav database update user:/var/lib/clamav:/sbin/nologin
setroubleshoot:x:983:979:SELinux troubleshoot server:/var/lib/setroubleshoot:/usr/sbin/nologin
[donnie@fedora ~]$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.128.1">In this command, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.129.1">{print $0}</span></code><span class="koboSpan" id="kobo.130.1"> part is the action, which must be surrounded by a pair of single quotes. </span><span class="koboSpan" id="kobo.130.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.131.1">$</span></code><span class="koboSpan" id="kobo.132.1"> designates which field to print. </span><span class="koboSpan" id="kobo.132.2">In this case, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.133.1">$0</span></code><span class="koboSpan" id="kobo.134.1"> causes every field to print. </span><span class="koboSpan" id="kobo.134.2">Specifying a pattern would cause only the lines with that pattern to print. </span><span class="koboSpan" id="kobo.134.3">By not specifying a pattern this time, I caused every line to print. </span><span class="koboSpan" id="kobo.134.4">Now, let’s say that I only want to show the line that contains a specific username. </span><span class="koboSpan" id="kobo.134.5">I’ll just add the pattern, like this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.135.1">[donnie@fedora ~]$ awk '/donnie/ {print $0}' /etc/passwd
donnie:x:1000:1000:Donald A. </span><span class="koboSpan" id="kobo.135.2">Tevault:/home/donnie:/bin/bash
[donnie@fedora ~]$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.136.1">The pattern needs to be enclosed within a pair of forward slashes, which in turn need to be within the pair of single quotes that also surround the action.</span></p>
    <div class="note">
      <p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.137.1">awk</span></code><span class="koboSpan" id="kobo.138.1"> operates on groups</span><a id="_idIndexMarker876"/><span class="koboSpan" id="kobo.139.1"> of information known as </span><code class="inlineCode"><span class="koboSpan" id="kobo.140.1">records</span></code><span class="koboSpan" id="kobo.141.1">. </span><span class="koboSpan" id="kobo.141.2">By default, each line in a text file is one record. </span><span class="koboSpan" id="kobo.141.3">For now, that’s all we’re going to deal with. </span><span class="koboSpan" id="kobo.141.4">However, you can also have files with multi-line records, which require special techniques to process. </span><span class="koboSpan" id="kobo.141.5">I’ll show you that in the next chapter.</span></p>
    </div>
    <p class="normal"><span class="koboSpan" id="kobo.142.1">Since </span><code class="inlineCode"><span class="koboSpan" id="kobo.143.1">{print $0}</span></code><span class="koboSpan" id="kobo.144.1"> is the default action, I could just omit that part and get the same result, like so:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.145.1">[donnie@fedora ~]$ awk '/donnie/' /etc/passwd
donnie:x:1000:1000:Donald A. </span><span class="koboSpan" id="kobo.145.2">Tevault:/home/donnie:/bin/bash
[donnie@fedora ~]$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.146.1">Next, let’s just print out the first field of this line. </span><span class="koboSpan" id="kobo.146.2">Do it like this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.147.1">[donnie@fedora ~]$ awk '/donnie/ {print $1}' /etc/passwd
donnie:x:1000:1000:Donald
[donnie@fedora ~]$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.148.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.149.1">$1</span></code><span class="koboSpan" id="kobo.150.1"> designates that I want to print field</span><a id="_idIndexMarker877"/><span class="koboSpan" id="kobo.151.1"> number 1. </span><span class="koboSpan" id="kobo.151.2">But wait though, this still isn’t right, because</span><a id="_idIndexMarker878"/><span class="koboSpan" id="kobo.152.1"> the command has actually printed fields 1 through 5. </span><span class="koboSpan" id="kobo.152.2">That’s because the default field delimiter for </span><code class="inlineCode"><span class="koboSpan" id="kobo.153.1">awk</span></code><span class="koboSpan" id="kobo.154.1"> is a blank space. </span><span class="koboSpan" id="kobo.154.2">Field 5, which contains my full name, has a blank space between the “Donald” and the “A.” </span><span class="koboSpan" id="kobo.154.3">So, as far as </span><code class="inlineCode"><span class="koboSpan" id="kobo.155.1">awk</span></code><span class="koboSpan" id="kobo.156.1"> is concerned, this is the beginning of the second field. </span><span class="koboSpan" id="kobo.156.2">To fix that, I’ll use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.157.1">-F:</span></code><span class="koboSpan" id="kobo.158.1"> option to make </span><code class="inlineCode"><span class="koboSpan" id="kobo.159.1">awk</span></code><span class="koboSpan" id="kobo.160.1"> recognize the colon as the field delimiter, like this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.161.1">[donnie@fedora ~]$ awk -F: '/donnie/ {print $1}' /etc/passwd
donnie
[donnie@fedora ~]$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.162.1">Finally, I have the output that I want.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.163.1">If you need to display more than one field, use a comma-separated list of field identifiers in the action, like this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.164.1">[donnie@fedora ~]$ awk -F: '/donnie/ {print $1, $7}' /etc/passwd
donnie /bin/bash
[donnie@fedora ~]$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.165.1">So here, I’m displaying fields 1 and 7. </span><span class="koboSpan" id="kobo.165.2">(Note that the comma between the field numbers is what places a blank space between the fields in the output. </span><span class="koboSpan" id="kobo.165.3">Omitting the comma would cause the output to not have that blank space.)</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.166.1">You can also pipe the output of another program into </span><code class="inlineCode"><span class="koboSpan" id="kobo.167.1">awk</span></code><span class="koboSpan" id="kobo.168.1">, like this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.169.1">[donnie@fedora ~]$ cat /etc/passwd | awk -F: '/donnie/ {print $1}'
donnie
[donnie@fedora ~]$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.170.1">Yeah, I know. </span><span class="koboSpan" id="kobo.170.2">It’s usually bad form to pipe </span><code class="inlineCode"><span class="koboSpan" id="kobo.171.1">cat</span></code><span class="koboSpan" id="kobo.172.1"> output into another utility, when you could just directly use the other utility. </span><span class="koboSpan" id="kobo.172.2">But for now, this serves to demonstrate the concept.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.173.1">All of the demos that I’ve shown you thus far could also have been done with </span><code class="inlineCode"><span class="koboSpan" id="kobo.174.1">cat</span></code><span class="koboSpan" id="kobo.175.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.176.1">grep</span></code><span class="koboSpan" id="kobo.177.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.178.1">cut</span></code><span class="koboSpan" id="kobo.179.1">, or combinations thereof. </span><span class="koboSpan" id="kobo.179.2">So, you could be forgiven for wondering what the point is in using </span><code class="inlineCode"><span class="koboSpan" id="kobo.180.1">awk</span></code><span class="koboSpan" id="kobo.181.1">. </span><span class="koboSpan" id="kobo.181.2">Well, hang on, because you’ll soon see that </span><code class="inlineCode"><span class="koboSpan" id="kobo.182.1">awk</span></code><span class="koboSpan" id="kobo.183.1"> can do some awesome things</span><a id="_idIndexMarker879"/><span class="koboSpan" id="kobo.184.1"> that the other utilities</span><a id="_idIndexMarker880"/><span class="koboSpan" id="kobo.185.1"> can’t do, or can’t do as well. </span><span class="koboSpan" id="kobo.185.2">We’ll begin by taking a closer look at how </span><code class="inlineCode"><span class="koboSpan" id="kobo.186.1">awk</span></code><span class="koboSpan" id="kobo.187.1"> can process input from plain text files.</span></p>
    <h1 id="_idParaDest-307" class="heading 1"><span class="koboSpan" id="kobo.188.1">Obtaining Input from Text Files</span></h1>
    <p class="normal"><span class="koboSpan" id="kobo.189.1">As you might have already</span><a id="_idIndexMarker881"/><span class="koboSpan" id="kobo.190.1"> guessed, the default manner in which </span><code class="inlineCode"><span class="koboSpan" id="kobo.191.1">awk</span></code><span class="koboSpan" id="kobo.192.1"> operates</span><a id="_idIndexMarker882"/><span class="koboSpan" id="kobo.193.1"> is to read a file line-by-line, searching for the specified pattern in each line. </span><span class="koboSpan" id="kobo.193.2">When it finds a line that contains the specified pattern, it will perform the specified action on that line. </span><span class="koboSpan" id="kobo.193.3">Let’s begin by building upon the </span><code class="inlineCode"><span class="koboSpan" id="kobo.194.1">passwd</span></code><span class="koboSpan" id="kobo.195.1"> file example that I showed you in the previous section.</span></p>
    <h2 id="_idParaDest-308" class="heading 2"><span class="koboSpan" id="kobo.196.1">Looking for Human Users</span></h2>
    <p class="normal"><span class="koboSpan" id="kobo.197.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.198.1">/etc/passwd</span></code><span class="koboSpan" id="kobo.199.1"> file contains</span><a id="_idIndexMarker883"/><span class="koboSpan" id="kobo.200.1"> a list of all users</span><a id="_idIndexMarker884"/><span class="koboSpan" id="kobo.201.1"> on the system. </span><span class="koboSpan" id="kobo.201.2">What I’ve always found curious is that system user accounts and normal human user accounts are all mixed together in the same file. </span><span class="koboSpan" id="kobo.201.3">But, let’s say that as part of your administrator duties, you need to maintain a list of normal human users on each machine. </span><span class="koboSpan" id="kobo.201.4">One way to do that is to use </span><code class="inlineCode"><span class="koboSpan" id="kobo.202.1">awk</span></code><span class="koboSpan" id="kobo.203.1"> to search</span><a id="_idIndexMarker885"/><span class="koboSpan" id="kobo.204.1"> through the </span><code class="inlineCode"><span class="koboSpan" id="kobo.205.1">passwd</span></code><span class="koboSpan" id="kobo.206.1"> file for the </span><strong class="keyWord"><span class="koboSpan" id="kobo.207.1">User ID Numbers</span></strong><span class="koboSpan" id="kobo.208.1"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.209.1">UIDs</span></strong><span class="koboSpan" id="kobo.210.1">) that correspond to human users. </span><span class="koboSpan" id="kobo.210.2">To find out what the UID numbers for normal users are, you can look in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.211.1">/etc/login.defs</span></code><span class="koboSpan" id="kobo.212.1"> file that’s on most Linux systems. </span><span class="koboSpan" id="kobo.212.2">This file can be somewhat different on different Linux systems, so I’ll just show you how it is on my Fedora machine. </span><span class="koboSpan" id="kobo.212.3">On lines 142 through 145, you see this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.213.1"># Min/max values for automatic uid selection in useradd(8)
#
UID_MIN                  1000
UID_MAX                 60000
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.214.1">So, to view all human user accounts</span><a id="_idIndexMarker886"/><span class="koboSpan" id="kobo.215.1"> on my system, I would search for all </span><code class="inlineCode"><span class="koboSpan" id="kobo.216.1">passwd</span></code><span class="koboSpan" id="kobo.217.1"> file lines </span><a id="_idIndexMarker887"/><span class="koboSpan" id="kobo.218.1">where field 3 (the UID field) contains a value that is greater than or equal to 1000 and less than or equal to 60000, like so:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.219.1">donnie@fedora:~$ awk -F: '$3 &gt;= 1000 &amp;&amp; $3 &lt;= 60000 {print $1, $7}' /etc/passwd
donnie /bin/bash
vicky /bin/bash
frank /bin/bash
goldie /bin/bash
cleopatra /bin/bash
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.220.1">You can also redirect the output into a text file, by placing the output redirector within the action construct, like this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.221.1">donnie@fedora:~$ awk -F: '$3 &gt;= 1000 &amp;&amp; $3 &lt;= 60000 {print $1, $7 &gt; "users.txt"}' /etc/passwd
donnie@fedora:~$ cat users.txt
donnie /bin/bash
vicky /bin/bash
frank /bin/bash
goldie /bin/bash
cleopatra /bin/bash
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.222.1">In both examples, note how I’m using </span><code class="inlineCode"><span class="koboSpan" id="kobo.223.1">&amp;&amp;</span></code><span class="koboSpan" id="kobo.224.1"> as the </span><code class="inlineCode"><span class="koboSpan" id="kobo.225.1">and</span></code><span class="koboSpan" id="kobo.226.1"> operator in the pattern portion of the command.</span></p>
    <div class="packt_tip">
      <p class="normal"><span class="koboSpan" id="kobo.227.1">Tip</span></p>
      <p class="normal"><span class="koboSpan" id="kobo.228.1">If you plan to use this command for your own use, be sure to verify what range of UID numbers that your operating system is using. </span><span class="koboSpan" id="kobo.228.2">Most Linux distros use the range of 1000 through 60000, as defined in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.229.1">/etc/login.defs</span></code><span class="koboSpan" id="kobo.230.1"> file. </span><span class="koboSpan" id="kobo.230.2">Non-Linux operating systems, such as OpenIndiana and FreeBSD, don’t use a </span><code class="inlineCode"><span class="koboSpan" id="kobo.231.1">login.defs</span></code><span class="koboSpan" id="kobo.232.1"> file, and I’ve not been able to find any definitive answer about what UID ranges they use. </span><span class="koboSpan" id="kobo.232.2">The best I can tell you about them is to look in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.233.1">/etc/passwd</span></code><span class="koboSpan" id="kobo.234.1"> file to see what UID is assigned to the first human user account, and to consult your organization’s policy manual to see the exact range of UID numbers that your organization wants to use for human users.</span></p>
    </div>
    <p class="normal"><span class="koboSpan" id="kobo.235.1">Of course, there’s no need to type</span><a id="_idIndexMarker888"/><span class="koboSpan" id="kobo.236.1"> this whole long command</span><a id="_idIndexMarker889"/><span class="koboSpan" id="kobo.237.1"> every time you want to use it. </span><span class="koboSpan" id="kobo.237.2">Instead, just put it into a normal shell script, which I’ll call </span><code class="inlineCode"><span class="koboSpan" id="kobo.238.1">user_list.sh</span></code><span class="koboSpan" id="kobo.239.1">. </span><span class="koboSpan" id="kobo.239.2">It will look something like this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.240.1">#!/bin/bash
awk -F: '$3 &gt;= 1000 &amp;&amp; $3 &lt;= 60000 {print $1, $7 &gt; "users.txt"}' /etc/passwd
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.241.1">That’s good, but what if you need a comma-separated value (</span><code class="inlineCode"><span class="koboSpan" id="kobo.242.1">.csv</span></code><span class="koboSpan" id="kobo.243.1">) file that you can easily import into a spreadsheet? </span><span class="koboSpan" id="kobo.243.2">Well, I’ve got you covered. </span><span class="koboSpan" id="kobo.243.3">Just add a </span><code class="inlineCode"><span class="koboSpan" id="kobo.244.1">BEGIN</span></code><span class="koboSpan" id="kobo.245.1"> section, where you would define the new field delimiter for the output, as well as the field delimiter for the input, like this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.246.1">donnie@fedora:~$ awk 'BEGIN {OFS = ","; FS = ":"}; $3 &gt;= 1000 &amp;&amp; $3 &lt;= 60000 {print $1,$7 &gt; "users.csv"}' /etc/passwd
donnie@fedora:~$ cat users.csv
donnie,/bin/bash
vicky,/bin/bash
frank,/bin/bash
goldie,/bin/bash
cleopatra,/bin/bash
victor,/bin/bash
valerie,/bin/bash
victoria,/bin/bash
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.247.1">This might seem a bit strange, because when you define an input field delimiter in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.248.1">awk</span></code><span class="koboSpan" id="kobo.249.1"> action, you used the </span><code class="inlineCode"><span class="koboSpan" id="kobo.250.1">-F</span></code><span class="koboSpan" id="kobo.251.1"> option. </span><span class="koboSpan" id="kobo.251.2">But, when you define an input field delimiter in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.252.1">BEGIN</span></code><span class="koboSpan" id="kobo.253.1"> section, you use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.254.1">FS</span></code><span class="koboSpan" id="kobo.255.1"> option. </span><span class="koboSpan" id="kobo.255.2">Likewise, you use </span><code class="inlineCode"><span class="koboSpan" id="kobo.256.1">OFS</span></code><span class="koboSpan" id="kobo.257.1"> in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.258.1">BEGIN</span></code><span class="koboSpan" id="kobo.259.1"> section to define the output field delimiter. </span><span class="koboSpan" id="kobo.259.2">(In </span><code class="inlineCode"><span class="koboSpan" id="kobo.260.1">awk</span></code><span class="koboSpan" id="kobo.261.1">-speak, field delimiters are actually called </span><strong class="keyWord"><span class="koboSpan" id="kobo.262.1">Field Separators</span></strong><span class="koboSpan" id="kobo.263.1">, which explains why these </span><code class="inlineCode"><span class="koboSpan" id="kobo.264.1">BEGIN</span></code><span class="koboSpan" id="kobo.265.1"> options</span><a id="_idIndexMarker890"/><span class="koboSpan" id="kobo.266.1"> are called </span><code class="inlineCode"><span class="koboSpan" id="kobo.267.1">FS</span></code><span class="koboSpan" id="kobo.268.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.269.1">OFS</span></code><span class="koboSpan" id="kobo.270.1">.)</span></p>
    <div class="note">
      <p class="normal"><span class="koboSpan" id="kobo.271.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.272.1">BEGIN</span></code><span class="koboSpan" id="kobo.273.1"> section of an </span><code class="inlineCode"><span class="koboSpan" id="kobo.274.1">awk</span></code><span class="koboSpan" id="kobo.275.1"> command or script is where you add any type of initialization code that you want to run before </span><code class="inlineCode"><span class="koboSpan" id="kobo.276.1">awk</span></code><span class="koboSpan" id="kobo.277.1"> starts processing the input file. </span><span class="koboSpan" id="kobo.277.2">You can use it to define field separators, add a header to the output, or initialize global variables that you’ll use later.</span></p>
    </div>
    <p class="normal"><span class="koboSpan" id="kobo.278.1">That’s good, but I’d also</span><a id="_idIndexMarker891"/><span class="koboSpan" id="kobo.279.1"> like to see the users’ UIDs. </span><span class="koboSpan" id="kobo.279.2">So, I’ll just</span><a id="_idIndexMarker892"/><span class="koboSpan" id="kobo.280.1"> add field 3 to the mix, like this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.281.1">donnie@fedora:~$ awk 'BEGIN {OFS = ","; FS = ":"}; $3 &gt;= 1000 &amp;&amp; $3 &lt;= 60000 {print $1,$3,$7 &gt; "users.csv"}' /etc/passwd
donnie@fedora:~$ cat users.csv
donnie,1000,/bin/bash
vicky,1001,/bin/bash
frank,1003,/bin/bash
goldie,1004,/bin/bash
cleopatra,1005,/bin/bash
victor,1006,/bin/bash
valerie,1007,/bin/bash
victoria,1008,/bin/bash
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.282.1">Now that I have my </span><code class="inlineCode"><span class="koboSpan" id="kobo.283.1">awk</span></code><span class="koboSpan" id="kobo.284.1"> command the way I want it, I’ll place it into the </span><code class="inlineCode"><span class="koboSpan" id="kobo.285.1">user_list2.sh</span></code><span class="koboSpan" id="kobo.286.1"> shell script that will look like this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.287.1">#!/bin/bash
awk 'BEGIN {OFS = ","; FS = ":"}; $3 &gt;= 1000 &amp;&amp; $3 &lt;= 60000 {print $1,$3,$7 &gt; "users.csv"}' /etc/passwd
</span></code></pre>
    <div class="note">
      <p class="normal"><span class="koboSpan" id="kobo.288.1">You could write a program that does this same thing in some other programming language, such as Python, C, or Java. </span><span class="koboSpan" id="kobo.288.2">But, the program code would be quite complex and more difficult to get right. </span><span class="koboSpan" id="kobo.288.3">With </span><code class="inlineCode"><span class="koboSpan" id="kobo.289.1">awk</span></code><span class="koboSpan" id="kobo.290.1">, all it takes is just a simple single-line command.</span></p>
    </div>
    <p class="normal"><span class="koboSpan" id="kobo.291.1">Next, let’s see how </span><code class="inlineCode"><span class="koboSpan" id="kobo.292.1">awk</span></code><span class="koboSpan" id="kobo.293.1"> can help a busy</span><a id="_idIndexMarker893"/><span class="koboSpan" id="kobo.294.1"> webserver</span><a id="_idIndexMarker894"/><span class="koboSpan" id="kobo.295.1"> administrator.</span></p>
    <h2 id="_idParaDest-309" class="heading 2"><span class="koboSpan" id="kobo.296.1">Parsing Webserver Access Logs</span></h2>
    <p class="normal"><span class="koboSpan" id="kobo.297.1">Webserver access logs contain</span><a id="_idIndexMarker895"/><span class="koboSpan" id="kobo.298.1"> a lot of information</span><a id="_idIndexMarker896"/><span class="koboSpan" id="kobo.299.1"> that can help a website owner, a webserver administrator, or a network security administrator. </span><span class="koboSpan" id="kobo.299.2">There are a lot of fancy log-parsing tools that can build fancy reports that tell you everything that’s going on, if that’s what you need. </span><span class="koboSpan" id="kobo.299.3">But, there may be times when you’ll want to quickly extract some specific data without taking the time to run some fancy tool. </span><span class="koboSpan" id="kobo.299.4">There are a few different ways to do that, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.300.1">awk</span></code><span class="koboSpan" id="kobo.301.1"> is one of the best.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.302.1">To begin the scenario, you’ll need a virtual machine with an active webserver installed. </span><span class="koboSpan" id="kobo.302.2">To keep things simple, I’ll just install the Apache server and the PHP module on my Fedora Server virtual machine, like this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.303.1">donnie@fedora:~$ sudo dnf install httpd php
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.304.1">Next, enable and start the Apache service, like this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.305.1">donnie@fedora:~$ sudo systemctl enable --now httpd
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.306.1">To access the server from different machines, you’ll need to open Port 80 on the firewall, like this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.307.1">donnie@fedora:~$ sudo firewall-cmd --add-service=http --permanent
donnie@fedora:~$ sudo firewall-cmd --reload
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.308.1">Finally, in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.309.1">/var/www/html/</span></code><span class="koboSpan" id="kobo.310.1"> directory, create the </span><code class="inlineCode"><span class="koboSpan" id="kobo.311.1">test.php</span></code><span class="koboSpan" id="kobo.312.1"> file, with the following contents:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.313.1">&lt;?php echo "&lt;strong&gt;&lt;center&gt;This is the awk Test Page&lt;/strong&gt;&lt;/center&gt;";
?&gt;
</span></code></pre>
    <div class="note">
      <p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.314.1">Reminder</span></strong><span class="koboSpan" id="kobo.315.1">: To make this work, be sure to set your virtual machine up with Bridged Mode networking, so that other machines on your network can reach it. </span><span class="koboSpan" id="kobo.315.2">Also, be sure that the virtual machines that you use to access the webserver are also set up in Bridged Mode, so that each machine will have its own IP address in the access log file.</span></p>
    </div>
    <p class="normal"><span class="koboSpan" id="kobo.316.1">Now, from as many other machines as possible, access both the Fedora Webserver Test Page and the </span><code class="inlineCode"><span class="koboSpan" id="kobo.317.1">test.php</span></code><span class="koboSpan" id="kobo.318.1"> page. </span><span class="koboSpan" id="kobo.318.2">Then, try to access a non-existent page. </span><span class="koboSpan" id="kobo.318.3">Your URLs should look something like this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.319.1">http://192.168.0.11
http://192.168.0.11/test.php
http://192.168.0.11/bogus.html
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.320.1">On the webserver virtual machine, open the </span><code class="inlineCode"><span class="koboSpan" id="kobo.321.1">var/log/httpd/access_log</span></code><span class="koboSpan" id="kobo.322.1"> file in </span><code class="inlineCode"><span class="koboSpan" id="kobo.323.1">less</span></code><span class="koboSpan" id="kobo.324.1">, like this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.325.1">donnie@fedora:~$ sudo less /var/log/httpd/access_log
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.326.1">Note the structure</span><a id="_idIndexMarker897"/><span class="koboSpan" id="kobo.327.1"> of the file, and how it uses</span><a id="_idIndexMarker898"/><span class="koboSpan" id="kobo.328.1"> blank spaces as field delimiters for some fields and double quotes as field delimiters for other fields. </span><span class="koboSpan" id="kobo.328.2">For example, here’s one entry from my own access file:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.329.1">192.168.0.17 - - [18/Dec/2023:16:40:03 -0500] "GET /test.php HTTP/1.1" 200 59 "-" "Mozilla/5.0 (X11; SunOS i86pc; rv:120.0) Gecko/20100101 Firefox/120.0"
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.330.1">So, you see here that some fields are surrounded by double quotes, and others aren’t. </span><span class="koboSpan" id="kobo.330.2">For now, let’s look at the IP addresses that have accessed this machine, like so:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.331.1">donnie@fedora:~$ sudo awk '{print $1}' /var/log/httpd/access_log | sort -V | uniq
192.168.0.10
192.168.0.16
192.168.0.17
192.168.0.18
192.168.0.27
192.168.0.37
192.168.0.107
192.168.0.251
192.168.0.252
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.332.1">As you see, I just piped the </span><code class="inlineCode"><span class="koboSpan" id="kobo.333.1">awk</span></code><span class="koboSpan" id="kobo.334.1"> output into </span><code class="inlineCode"><span class="koboSpan" id="kobo.335.1">sort -V</span></code><span class="koboSpan" id="kobo.336.1">, which I then piped into </span><code class="inlineCode"><span class="koboSpan" id="kobo.337.1">uniq</span></code><span class="koboSpan" id="kobo.338.1">. </span><span class="koboSpan" id="kobo.338.2">Using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.339.1">-V</span></code><span class="koboSpan" id="kobo.340.1"> option for </span><code class="inlineCode"><span class="koboSpan" id="kobo.341.1">sort</span></code><span class="koboSpan" id="kobo.342.1"> causes</span><a id="_idIndexMarker899"/><span class="koboSpan" id="kobo.343.1"> the IP addresses</span><a id="_idIndexMarker900"/><span class="koboSpan" id="kobo.344.1"> to be sorted in correct numerical order. </span><span class="koboSpan" id="kobo.344.2">You can’t use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.345.1">-n</span></code><span class="koboSpan" id="kobo.346.1"> switch for this, because by default, </span><code class="inlineCode"><span class="koboSpan" id="kobo.347.1">sort</span></code><span class="koboSpan" id="kobo.348.1"> treats the dots in the IP addresses as decimal points. </span><span class="koboSpan" id="kobo.348.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.349.1">-V</span></code><span class="koboSpan" id="kobo.350.1"> option overrides that behavior</span><a id="_idIndexMarker901"/><span class="koboSpan" id="kobo.351.1"> by doing what is called a </span><strong class="keyWord"><span class="koboSpan" id="kobo.352.1">natural sort</span></strong><span class="koboSpan" id="kobo.353.1">.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.354.1">This is good, except that I still don’t know how many times the webserver was accessed from each IP address. </span><span class="koboSpan" id="kobo.354.2">I’ll use </span><code class="inlineCode"><span class="koboSpan" id="kobo.355.1">uniq</span></code><span class="koboSpan" id="kobo.356.1"> with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.357.1">-c</span></code><span class="koboSpan" id="kobo.358.1"> option to see that, which will look like this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.359.1">donnie@fedora:~$ sudo awk '{print $1}' /var/log/httpd/access_log | sort -V | uniq -c
      6  192.168.0.10
     20 192.168.0.16
     12 192.168.0.17
      2  192.168.0.18
      4  192.168.0.27
     15 192.168.0.37
      6  192.168.0.107
     14 192.168.0.251
      6  192.168.0.252
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.360.1">That’s good, but I really want to create a </span><code class="inlineCode"><span class="koboSpan" id="kobo.361.1">.csv</span></code><span class="koboSpan" id="kobo.362.1"> file, as I did for my list of users. </span><span class="koboSpan" id="kobo.362.2">I can’t do that by defining</span><a id="_idIndexMarker902"/><span class="koboSpan" id="kobo.363.1"> the </span><code class="inlineCode"><span class="koboSpan" id="kobo.364.1">OFS</span></code><span class="koboSpan" id="kobo.365.1"> parameter </span><a id="_idIndexMarker903"/><span class="koboSpan" id="kobo.366.1">in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.367.1">BEGIN</span></code><span class="koboSpan" id="kobo.368.1"> section this time, because the count field isn’t created until I pipe the output into </span><code class="inlineCode"><span class="koboSpan" id="kobo.369.1">uniq -c</span></code><span class="koboSpan" id="kobo.370.1">. </span><span class="koboSpan" id="kobo.370.2">So, I’ll cheat a bit by installing the </span><code class="inlineCode"><span class="koboSpan" id="kobo.371.1">miller</span></code><span class="koboSpan" id="kobo.372.1"> package, which is in the repositories for most Linux distros, as well as for FreeBSD. </span><span class="koboSpan" id="kobo.372.2">On a Mac, you should be able to install it with </span><code class="inlineCode"><span class="koboSpan" id="kobo.373.1">homebrew</span></code><span class="koboSpan" id="kobo.374.1">. </span><span class="koboSpan" id="kobo.374.2">Anyway, to create the </span><code class="inlineCode"><span class="koboSpan" id="kobo.375.1">.csv</span></code><span class="koboSpan" id="kobo.376.1"> file, I’ll just pipe the output from this </span><code class="inlineCode"><span class="koboSpan" id="kobo.377.1">awk</span></code><span class="koboSpan" id="kobo.378.1"> command into the </span><code class="inlineCode"><span class="koboSpan" id="kobo.379.1">mlr</span></code><span class="koboSpan" id="kobo.380.1"> utility, which is part of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.381.1">miller</span></code><span class="koboSpan" id="kobo.382.1"> package. </span><span class="koboSpan" id="kobo.382.2">Here’s how that looks:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.383.1">donnie@fedora:~$ sudo awk '{print $1}' /var/log/httpd/access_log | sort -V | uniq -c | mlr --p2c cat &gt; ip_list.csv
donnie@fedora:~$ cat ip_list.csv
6,192.168.0.10
27,192.168.0.16
12,192.168.0.17
2,192.168.0.18
4,192.168.0.27
15,192.168.0.37
6,192.168.0.107
14,192.168.0.251
6,192.168.0.252
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.384.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.385.1">--p2c</span></code><span class="koboSpan" id="kobo.386.1"> option for </span><code class="inlineCode"><span class="koboSpan" id="kobo.387.1">mlr</span></code><span class="koboSpan" id="kobo.388.1"> is what converts the output to </span><code class="inlineCode"><span class="koboSpan" id="kobo.389.1">.csv</span></code><span class="koboSpan" id="kobo.390.1"> format. </span><span class="koboSpan" id="kobo.390.2">After that is </span><code class="inlineCode"><span class="koboSpan" id="kobo.391.1">cat</span></code><span class="koboSpan" id="kobo.392.1">, which is the </span><code class="inlineCode"><span class="koboSpan" id="kobo.393.1">mlr</span></code><span class="koboSpan" id="kobo.394.1"> verb. </span><span class="koboSpan" id="kobo.394.2">You see that this </span><code class="inlineCode"><span class="koboSpan" id="kobo.395.1">cat</span></code><span class="koboSpan" id="kobo.396.1"> just dumps the output to either the screen or to a file, the same as its </span><code class="inlineCode"><span class="koboSpan" id="kobo.397.1">bash</span></code><span class="koboSpan" id="kobo.398.1"> cousin does.</span></p>
    <div class="note">
      <p class="normal"><span class="koboSpan" id="kobo.399.1">I’m showing you how to create </span><code class="inlineCode"><span class="koboSpan" id="kobo.400.1">.csv</span></code><span class="koboSpan" id="kobo.401.1"> files, because for historical reasons, </span><code class="inlineCode"><span class="koboSpan" id="kobo.402.1">.csv</span></code><span class="koboSpan" id="kobo.403.1"> is the most popular format for plain-text data files, and your employer or clients might expect you to use them. </span><span class="koboSpan" id="kobo.403.2">However, as we’ll see in a bit, this isn’t always the best format. </span><span class="koboSpan" id="kobo.403.3">In certain circumstances, you might find that your best bet is to forget about </span><code class="inlineCode"><span class="koboSpan" id="kobo.404.1">.csv</span></code><span class="koboSpan" id="kobo.405.1"> files, and instead save your data to </span><strong class="keyWord"><span class="koboSpan" id="kobo.406.1">Tab Separated Value</span></strong><span class="koboSpan" id="kobo.407.1"> (</span><code class="inlineCode"><span class="koboSpan" id="kobo.408.1">.tsv</span></code><span class="koboSpan" id="kobo.409.1">) files, which might look something</span><a id="_idIndexMarker904"/><span class="koboSpan" id="kobo.410.1"> like this:</span></p>
      <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.411.1">donnie@fedora:~$ cat inventory.tsv
Kitchen spatula	$4.99	       Housewares
Raincoat	       $36.99	 	Clothing	On Sale!
</span><span class="koboSpan" id="kobo.411.2">Claw hammer	 	$7.99	       Tools
donnie@fedora:~$
</span></code></pre>
      <p class="normal"><span class="koboSpan" id="kobo.412.1">You can also import them into your favorite spreadsheet program, and in certain circumstances, they’re much easier to deal with.</span></p>
    </div>
    <p class="normal"><span class="koboSpan" id="kobo.413.1">If you need a </span><code class="inlineCode"><span class="koboSpan" id="kobo.414.1">.json</span></code><span class="koboSpan" id="kobo.415.1"> file</span><a id="_idIndexMarker905"/><span class="koboSpan" id="kobo.416.1"> instead of a </span><code class="inlineCode"><span class="koboSpan" id="kobo.417.1">.csv</span></code><span class="koboSpan" id="kobo.418.1"> file, </span><code class="inlineCode"><span class="koboSpan" id="kobo.419.1">mlr</span></code><span class="koboSpan" id="kobo.420.1"> can also</span><a id="_idIndexMarker906"/><span class="koboSpan" id="kobo.421.1"> do that for you. </span><span class="koboSpan" id="kobo.421.2">You’ll just replace the </span><code class="inlineCode"><span class="koboSpan" id="kobo.422.1">--p2c</span></code><span class="koboSpan" id="kobo.423.1"> option with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.424.1">--ojson</span></code><span class="koboSpan" id="kobo.425.1"> option, like this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.426.1">donnie@fedora:~$ sudo awk '{print $1}' /var/log/httpd/access_log | sort -V | uniq -c | mlr --ojson cat &gt; ip_list.json
donnie@fedora:~$ cat ip_list.json
{ "1": "      6 192.168.0.10" }
{ "1": "     27 192.168.0.16" }
{ "1": "     12 192.168.0.17" }
{ "1": "      2 192.168.0.18" }
{ "1": "      4 192.168.0.27" }
{ "1": "     15 192.168.0.37" }
{ "1": "      6 192.168.0.107" }
{ "1": "     14 192.168.0.251" }
{ "1": "      6 192.168.0.252" }
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.427.1">There’s a lot more that you can do with </span><code class="inlineCode"><span class="koboSpan" id="kobo.428.1">mlr</span></code><span class="koboSpan" id="kobo.429.1"> than I can show you here. </span><span class="koboSpan" id="kobo.429.2">To learn more about it, consult either the </span><code class="inlineCode"><span class="koboSpan" id="kobo.430.1">mlr</span></code><span class="koboSpan" id="kobo.431.1"> man page or the Miller Documentation web page. </span><span class="koboSpan" id="kobo.431.2">(You’ll find a link to the Miller page in the </span><em class="chapterRef"><span class="koboSpan" id="kobo.432.1">Further Reading</span></em><span class="koboSpan" id="kobo.433.1"> section.) As good as </span><code class="inlineCode"><span class="koboSpan" id="kobo.434.1">mlr</span></code><span class="koboSpan" id="kobo.435.1"> is though, it does have one flaw. </span><span class="koboSpan" id="kobo.435.2">That is, it can’t handle fields that contain blank spaces or commas. </span><span class="koboSpan" id="kobo.435.3">So, you won’t be able to use it for every field in the Apache access log.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.436.1">Now, let’s say that we want to see which operating systems and browsers are accessing this server. </span><span class="koboSpan" id="kobo.436.2">The </span><strong class="keyWord"><span class="koboSpan" id="kobo.437.1">User Agent</span></strong><span class="koboSpan" id="kobo.438.1"> string that contains</span><a id="_idIndexMarker907"/><span class="koboSpan" id="kobo.439.1"> that information is in field 6, which is surrounded by a pair of double quotes. </span><span class="koboSpan" id="kobo.439.2">So, we’ll have to use the double quote as the field delimiter, like this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.440.1">donnie@fedora:~$ sudo awk -F\" '{print $6}' /var/log/httpd/access_log | sort | uniq
Lynx/2.8.9rel.1 libwww-FM/2.14 SSL-MM/1.4.1 OpenSSL/1.1.1t-freebsd
Lynx/2.9.0dev.10 libwww-FM/2.14 SSL-MM/1.4.1 GNUTLS/3.7.1
Lynx/2.9.0dev.12 libwww-FM/2.14 SSL-MM/1.4.1 GNUTLS/3.7.8
Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/14.1.2 Safari/605.1.15
. </span><span class="koboSpan" id="kobo.440.2">. </span><span class="koboSpan" id="kobo.440.3">.
</span><span class="koboSpan" id="kobo.440.4">. </span><span class="koboSpan" id="kobo.440.5">. </span><span class="koboSpan" id="kobo.440.6">.
</span><span class="koboSpan" id="kobo.440.7">Mozilla/5.0 (X11; Linux x86_64; rv:120.0) Gecko/20100101 Firefox/120.0
Mozilla/5.0 (X11; Linux x86_64; rv:45.0) Gecko/20100101 Firefox/45.0
Mozilla/5.0 (X11; SunOS i86pc; rv:120.0) Gecko/20100101 Firefox/120.0
Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/113.0
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.441.1">You can see here</span><a id="_idIndexMarker908"/><span class="koboSpan" id="kobo.442.1"> that I had to escape the double quote</span><a id="_idIndexMarker909"/><span class="koboSpan" id="kobo.443.1"> with a backslash, so that the shell won’t misinterpret it.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.444.1">Next, let’s look for a specific User Agent. </span><span class="koboSpan" id="kobo.444.2">Let’s say that we want to know how many users are using a Mac. </span><span class="koboSpan" id="kobo.444.3">Just add the pattern, like this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.445.1">donnie@fedora:~$ sudo awk -F\" '/Mac OS X/ {print $6}' /var/log/httpd/access_log | sort | uniq -c
      8 Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/14.1.2 Safari/605.1.15
      6 Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:109.0) Gecko/20100101 Firefox/115.0
      6 Mozilla/5.0 (Macintosh; PPC Mac OS X 10.4; FPR10; rv:45.0) Gecko/20100101 Firefox/45.0 TenFourFox/7450
      9 Mozilla/5.0 (Macintosh; U; PPC Mac OS X 10_4_11; en) AppleWebKit/533.19.4 (KHTML, like Gecko) Version/4.1.3 Safari/533.19.4
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.446.1">The entries for the Intel Mac are from my 2010-model Mac Pro, so they make sense. </span><span class="koboSpan" id="kobo.446.2">But, what’s with that PPC business in lines 3 and 4 of the output? </span><span class="koboSpan" id="kobo.446.3">Well, that’s also easily explained. </span><span class="koboSpan" id="kobo.446.4">Just for fun, I fired up my 21-year old eMac that’s equipped with an old-school</span><a id="_idIndexMarker910"/><span class="koboSpan" id="kobo.447.1"> Motorola PowerPC G4 processor, and used</span><a id="_idIndexMarker911"/><span class="koboSpan" id="kobo.448.1"> it to access the test webserver. </span><span class="koboSpan" id="kobo.448.2">(I’m guessing that you’ll never see any of those on your own network.)</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.449.1">You can also obtain this information with nothing but pure </span><code class="inlineCode"><span class="koboSpan" id="kobo.450.1">awk</span></code><span class="koboSpan" id="kobo.451.1">, without having to pipe the output into other utilities. </span><span class="koboSpan" id="kobo.451.2">Do that</span><a id="_idIndexMarker912"/><span class="koboSpan" id="kobo.452.1"> by building an </span><strong class="keyWord"><span class="koboSpan" id="kobo.453.1">associative array</span></strong><span class="koboSpan" id="kobo.454.1">, which looks like this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.455.1">donnie@fedora:~$ sudo awk '{count[$1]++}; END {for (ip_address in count) print 
ip_address, count[ip_address]}' /var/log/httpd/access_log
192.168.0.251 14
192.168.0.252 6
192.168.0.10 6
192.168.0.16 22
192.168.0.17 12
192.168.0.107 6
192.168.0.18 2
192.168.0.27 4
192.168.0.37 15
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.456.1">Add a </span><code class="inlineCode"><span class="koboSpan" id="kobo.457.1">BEGIN</span></code><span class="koboSpan" id="kobo.458.1"> section with an </span><code class="inlineCode"><span class="koboSpan" id="kobo.459.1">OFS</span></code><span class="koboSpan" id="kobo.460.1"> definition, and you can create a </span><code class="inlineCode"><span class="koboSpan" id="kobo.461.1">.csv</span></code><span class="koboSpan" id="kobo.462.1"> file. </span><span class="koboSpan" id="kobo.462.2">Here’s how that looks:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.463.1">donnie@fedora:~$ sudo awk 'BEGIN {OFS = ","}; {count[$1]++}; END {for (ip_address in count) print ip_address, count[ip_address]}' /var/log/httpd/access_log &gt; ip_addresses.csv
donnie@fedora:~$ cat ip_addresses.csv
192.168.0.251,14
192.168.0.252,6
192.168.0.10,6
192.168.0.16,27
192.168.0.17,12
192.168.0.107,6
192.168.0.18,2
192.168.0.27,4
192.168.0.37,15
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.464.1">Unlike the normal shell scripting arrays that you’ve seen previously, </span><code class="inlineCode"><span class="koboSpan" id="kobo.465.1">awk</span></code><span class="koboSpan" id="kobo.466.1"> associative arrays use text strings, instead of numbers, as their indexes. </span><span class="koboSpan" id="kobo.466.2">Also, arrays in </span><code class="inlineCode"><span class="koboSpan" id="kobo.467.1">awk</span></code><span class="koboSpan" id="kobo.468.1"> are defined on-the-fly, and don’t have to be declared before you can use them. </span><span class="koboSpan" id="kobo.468.2">So here you see the </span><code class="inlineCode"><span class="koboSpan" id="kobo.469.1">count</span></code><span class="koboSpan" id="kobo.470.1"> array, with whatever the respective values of field 1 are for the index values. </span><span class="koboSpan" id="kobo.470.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.471.1">++</span></code><span class="koboSpan" id="kobo.472.1"> operator, which assumes an initial value of 0, adds together the number of times each index string is found in the file. </span><span class="koboSpan" id="kobo.472.2">The first portion of this command, which ends at the semi-colon, processes the file line-by-line as </span><code class="inlineCode"><span class="koboSpan" id="kobo.473.1">awk</span></code><span class="koboSpan" id="kobo.474.1"> normally does. </span><span class="koboSpan" id="kobo.474.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.475.1">END</span></code><span class="koboSpan" id="kobo.476.1"> keyword designates</span><a id="_idIndexMarker913"/><span class="koboSpan" id="kobo.477.1"> code that will run after the line-by-line processing</span><a id="_idIndexMarker914"/><span class="koboSpan" id="kobo.478.1"> has completed. </span><span class="koboSpan" id="kobo.478.2">In this case, you see a </span><code class="inlineCode"><span class="koboSpan" id="kobo.479.1">for</span></code><span class="koboSpan" id="kobo.480.1"> loop that prints out a summary of unique IP addresses, along with how many times each one was found. </span><span class="koboSpan" id="kobo.480.2">Unfortunately, there’s no easy way to sort the output with pure </span><code class="inlineCode"><span class="koboSpan" id="kobo.481.1">awk</span></code><span class="koboSpan" id="kobo.482.1">, but you can still pipe the output into </span><code class="inlineCode"><span class="koboSpan" id="kobo.483.1">sort</span></code><span class="koboSpan" id="kobo.484.1">, like this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.485.1">donnie@fedora:~$ sudo awk 'BEGIN {OFS = ","}; {count[$1]++}; END {for (ip_address in count) print ip_address, count[i]}' /var/log/httpd/access_log | sort -t, -V -k1,1 &gt; ip_addresses.csv
donnie@fedora:~$ cat ip_addresses.csv
192.168.0.10,6
192.168.0.16,27
192.168.0.17,12
192.168.0.18,2
192.168.0.27,4
192.168.0.37,15
192.168.0.107,6
192.168.0.251,14
192.168.0.252,6
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.486.1">To make this work, I’m using sort with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.487.1">-t,</span></code><span class="koboSpan" id="kobo.488.1"> option to define the comma as the field delimiter. </span><span class="koboSpan" id="kobo.488.2">(Yeah, I know. </span><span class="koboSpan" id="kobo.488.3">It would be nice if all Linux and Unix utilities used the same option switch to define field delimiters, but that’s just not how the world works.)</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.489.1">Another difference with using</span><a id="_idIndexMarker915"/><span class="koboSpan" id="kobo.490.1"> pure </span><code class="inlineCode"><span class="koboSpan" id="kobo.491.1">awk</span></code><span class="koboSpan" id="kobo.492.1"> is that the number of occurrences</span><a id="_idIndexMarker916"/><span class="koboSpan" id="kobo.493.1"> for each IP address is in the second column, rather than in the first column as you saw before. </span><span class="koboSpan" id="kobo.493.2">That’s okay here, but it might not work so well for other fields. </span><span class="koboSpan" id="kobo.493.3">For example, let’s change the command to look at the User Agents in field 6:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.494.1">donnie@fedora:~$ sudo awk -F\" '{count[$6]++}; END { for (i in count) print i, count[i]}' /var/log/httpd/access_log | sort
Lynx/2.8.9rel.1 libwww-FM/2.14 SSL-MM/1.4.1 OpenSSL/1.1.1t-freebsd 2
Lynx/2.9.0dev.10 libwww-FM/2.14 SSL-MM/1.4.1 GNUTLS/3.7.1 4
Lynx/2.9.0dev.12 libwww-FM/2.14 SSL-MM/1.4.1 GNUTLS/3.7.8 3
Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/14.1.2 Safari/605.1.15 8
. </span><span class="koboSpan" id="kobo.494.2">. </span><span class="koboSpan" id="kobo.494.3">.
</span><span class="koboSpan" id="kobo.494.4">. </span><span class="koboSpan" id="kobo.494.5">. </span><span class="koboSpan" id="kobo.494.6">.
</span><span class="koboSpan" id="kobo.494.7">Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/113.0 6
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.495.1">Yeah, it works, but having the number of occurrences in the second column for this makes the output somewhat less readable.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.496.1">As I mentioned before, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.497.1">.csv</span></code><span class="koboSpan" id="kobo.498.1"> format isn’t always your best choice for a plain-text data file. </span><span class="koboSpan" id="kobo.498.2">In fact, it’s impossible to turn the output from field 6 into a proper </span><code class="inlineCode"><span class="koboSpan" id="kobo.499.1">.csv</span></code><span class="koboSpan" id="kobo.500.1"> file that any spreadsheet program will properly display. </span><span class="koboSpan" id="kobo.500.2">That’s because this field contains blank spaces and commas that make a spreadsheet program think that there are more fields in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.501.1">.csv</span></code><span class="koboSpan" id="kobo.502.1"> file than there really are.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.503.1">So, the easiest solution is to surround the text in field 6 with a pair of double quotes and save the output to a </span><code class="inlineCode"><span class="koboSpan" id="kobo.504.1">.tsv</span></code><span class="koboSpan" id="kobo.505.1"> file. </span><span class="koboSpan" id="kobo.505.2">Then, when you open the file in your spreadsheet, define the </span><code class="inlineCode"><span class="koboSpan" id="kobo.506.1">"</span></code><span class="koboSpan" id="kobo.507.1"> as the field delimiter. </span><span class="koboSpan" id="kobo.507.2">Anyway, here’s the command to create the </span><code class="inlineCode"><span class="koboSpan" id="kobo.508.1">.tsv</span></code><span class="koboSpan" id="kobo.509.1"> file, without using an associative array:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.510.1">donnie@fedora:~$ sudo awk 'BEGIN {FS="\""} {print "\"" $6 "\""}' /var/log/
httpd/access_log | sort | uniq -c | sort -k 1,1 -nr &gt; user_agent.tsv
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.511.1">By default, </span><code class="inlineCode"><span class="koboSpan" id="kobo.512.1">awk</span></code><span class="koboSpan" id="kobo.513.1"> strips out the double quotes that surround field 6 in the original log file. </span><span class="koboSpan" id="kobo.513.2">So, to make this work</span><a id="_idIndexMarker917"/><span class="koboSpan" id="kobo.514.1"> properly, I have to put</span><a id="_idIndexMarker918"/><span class="koboSpan" id="kobo.515.1"> them back into the final output file. </span><span class="koboSpan" id="kobo.515.2">In the action part, you see that I’m printing a double quote both before and after </span><code class="inlineCode"><span class="koboSpan" id="kobo.516.1">$6</span></code><span class="koboSpan" id="kobo.517.1">. </span><span class="koboSpan" id="kobo.517.2">By omitting the commas that you might normally place between the various </span><code class="inlineCode"><span class="koboSpan" id="kobo.518.1">print</span></code><span class="koboSpan" id="kobo.519.1"> elements, I’ll ensure that there are no blank spaces between the quotes and the text. </span><span class="koboSpan" id="kobo.519.2">Then, I’m just piping the output into </span><code class="inlineCode"><span class="koboSpan" id="kobo.520.1">sort</span></code><span class="koboSpan" id="kobo.521.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.522.1">uniq</span></code><span class="koboSpan" id="kobo.523.1">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.524.1">sort</span></code><span class="koboSpan" id="kobo.525.1"> again as I’ve shown you before. </span><span class="koboSpan" id="kobo.525.2">Here’s how the file looks:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.526.1">donnie@fedora:~$ cat user_agent.tsv
     23 "Mozilla/5.0 (X11; Linux x86_64; rv:120.0) Gecko/20100101 Firefox/120.0"
      9 "Mozilla/5.0 (X11; SunOS i86pc; rv:120.0) Gecko/20100101 Firefox/120.0"
      9 "Mozilla/5.0 (Macintosh; U; PPC Mac OS X 10_4_11; en) AppleWebKit/533.19.4 (KHTML, like Gecko) Version/4.1.3 Safari/533.19.4"
      8 "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/14.1.2 Safari/605.1.15"
      6 "Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/113.0"
. </span><span class="koboSpan" id="kobo.526.2">. </span><span class="koboSpan" id="kobo.526.3">.
</span><span class="koboSpan" id="kobo.526.4">. </span><span class="koboSpan" id="kobo.526.5">. </span><span class="koboSpan" id="kobo.526.6">.
      </span><span class="koboSpan" id="kobo.526.7">3 "Lynx/2.9.0dev.12 libwww-FM/2.14 SSL-MM/1.4.1 GNUTLS/3.7.8"
      2 "Lynx/2.8.9rel.1 libwww-FM/2.14 SSL-MM/1.4.1 OpenSSL/1.1.1t-freebsd"
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.527.1">If you prefer to use an associative array, you can do it like this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.528.1">donnie@fedora:~$ sudo awk -F\" '{count[$6]++}; END { for (ip_address in count) printf "%s \"%s\"\n", count[ip_address], ip_address}' /var/log/httpd/access_log | sort -nr &gt; user_agent.tsv
donnie@fedora:~$ cat user_agent.tsv
      23 "Mozilla/5.0 (X11; Linux x86_64; rv:120.0) Gecko/20100101 Firefox/120.0"
      9 "Mozilla/5.0 (X11; SunOS i86pc; rv:120.0) Gecko/20100101 Firefox/120.0"
      9 "Mozilla/5.0 (Macintosh; U; PPC Mac OS X 10_4_11; en) AppleWebKit/533.19.4 (KHTML, like Gecko) Version/4.1.3 Safari/533.19.4"
      8 "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/14.1.2 Safari/605.1.15"
      6 "Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/113.0"
. </span><span class="koboSpan" id="kobo.528.2">. </span><span class="koboSpan" id="kobo.528.3">.
</span><span class="koboSpan" id="kobo.528.4">. </span><span class="koboSpan" id="kobo.528.5">. </span><span class="koboSpan" id="kobo.528.6">.
      </span><span class="koboSpan" id="kobo.528.7">3 "Lynx/2.9.0dev.12 libwww-FM/2.14 SSL-MM/1.4.1 GNUTLS/3.7.8"
      2 "Lynx/2.8.9rel.1 libwww-FM/2.14 SSL-MM/1.4.1 OpenSSL/1.1.1t-freebsd"
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.529.1">Note how I had to surround the </span><code class="inlineCode"><span class="koboSpan" id="kobo.530.1">printf</span></code><span class="koboSpan" id="kobo.531.1"> parameters with a pair of double quotes. </span><span class="koboSpan" id="kobo.531.2">The first </span><code class="inlineCode"><span class="koboSpan" id="kobo.532.1">%s</span></code><span class="koboSpan" id="kobo.533.1"> parameter is for the count field, and the second </span><code class="inlineCode"><span class="koboSpan" id="kobo.534.1">%s</span></code><span class="koboSpan" id="kobo.535.1"> parameter is for the user agent field. </span><span class="koboSpan" id="kobo.535.2">To add the double quotes</span><a id="_idIndexMarker919"/><span class="koboSpan" id="kobo.536.1"> in the proper </span><a id="_idIndexMarker920"/><span class="koboSpan" id="kobo.537.1">places, I added a </span><code class="inlineCode"><span class="koboSpan" id="kobo.538.1">\"</span></code><span class="koboSpan" id="kobo.539.1"> to both before and after the second </span><code class="inlineCode"><span class="koboSpan" id="kobo.540.1">%s</span></code><span class="koboSpan" id="kobo.541.1">. </span><span class="koboSpan" id="kobo.541.2">Using either the associative array method or the non-associative array method gives me the same results. </span><span class="koboSpan" id="kobo.541.3">Now, when I open the file in a spreadsheet program, I’ll just define the double quote as the field delimiter. </span><span class="koboSpan" id="kobo.541.4">Here’s how that looks on LibreOffice Calc:</span></p>
    <figure class="mediaobject"><span class="koboSpan" id="kobo.542.1"><img src="../Images/B21693_14_01.png" alt="B21693_14_1"/></span></figure>
    <p class="packt_figref"><span class="koboSpan" id="kobo.543.1">Figure 14.1: Setting the field delimiter in LibreOffice Calc</span></p>
    <div class="note">
      <p class="normal"><span class="koboSpan" id="kobo.544.1">I know that I haven’t fully explained </span><code class="inlineCode"><span class="koboSpan" id="kobo.545.1">print</span></code><span class="koboSpan" id="kobo.546.1"> versus </span><code class="inlineCode"><span class="koboSpan" id="kobo.547.1">printf</span></code><span class="koboSpan" id="kobo.548.1"> yet, but I will in the next chapter.</span></p>
    </div>
    <p class="normal"><span class="koboSpan" id="kobo.549.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.550.1">user_agent.tsv</span></code><span class="koboSpan" id="kobo.551.1"> file should now display properly, with the count in the first column and the User Agent string in the second column.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.552.1">Next, let’s count the number</span><a id="_idIndexMarker921"/><span class="koboSpan" id="kobo.553.1"> of times that each URL</span><a id="_idIndexMarker922"/><span class="koboSpan" id="kobo.554.1"> on the webserver was hit. </span><span class="koboSpan" id="kobo.554.2">I like having the count as the first field of output, so I’ll again pipe the </span><code class="inlineCode"><span class="koboSpan" id="kobo.555.1">awk</span></code><span class="koboSpan" id="kobo.556.1"> output into </span><code class="inlineCode"><span class="koboSpan" id="kobo.557.1">uniq</span></code><span class="koboSpan" id="kobo.558.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.559.1">sort</span></code><span class="koboSpan" id="kobo.560.1">, like so:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.561.1">donnie@fedora:~$ sudo awk '{print $7}' /var/log/httpd/access_log | sort | uniq -c | sort -k1,1 -n
      1 /something.html
      1 /test
      1 /test.html
      1 /test/php
      1 /test.php?module=..../
      2 /test.php?module=....//....//....//....//....//....//....//....//....//....//proc/self/environ%0000
      2 /test.php?page=../../../../../../../../../../../../../../../proc/self/environ%00
     11 /icons/poweredby.png
     11 /poweredby.png
     11 /report.html
     12 /favicon.ico
     17 /
     18 /test.php
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.562.1">Using the blank space as the field delimiter means that the URL field is field 7. </span><span class="koboSpan" id="kobo.562.2">At the end, I’m piping the output into </span><code class="inlineCode"><span class="koboSpan" id="kobo.563.1">sort</span></code><span class="koboSpan" id="kobo.564.1"> again so that the list will print out according to the number of hits for each URL. </span><span class="koboSpan" id="kobo.564.2">But actually, I’d like that to show the most popular URLs at the top of the list. </span><span class="koboSpan" id="kobo.564.3">So, I’ll just add the </span><code class="inlineCode"><span class="koboSpan" id="kobo.565.1">-r</span></code><span class="koboSpan" id="kobo.566.1"> option to sort in reverse, like this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.567.1">donnie@fedora:~$ sudo awk '{print $7}' /var/log/httpd/access_log | sort | uniq -c | sort -k1,1 -nr
     18 /test.php
     17 /
     12 /favicon.ico
     11 /report.html
     11 /poweredby.png
     11 /icons/poweredby.png
      2 /test.php?page=../../../../../../../../../../../../../../../proc/self/environ%00
      2 /test.php?module=....//....//....//....//....//....//....//....//....//....//proc/self/environ%0000
      1 /test.php?module=..../
      1 /test/php
      1 /test.html
      1 /test
      1 /something.html
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.568.1">One thing we see is that someone tried to perform a directory traversal attack against me, as evidenced by the lines that begin with </span><code class="inlineCode"><span class="koboSpan" id="kobo.569.1">/test.php?page</span></code><span class="koboSpan" id="kobo.570.1"> or </span><code class="inlineCode"><span class="koboSpan" id="kobo.571.1">/test.php?module</span></code><span class="koboSpan" id="kobo.572.1">. </span><span class="koboSpan" id="kobo.572.2">I’ll show you more about that later in </span><em class="chapterRef"><span class="koboSpan" id="kobo.573.1">Chapter 18, Shell Scripting for Security Professionals</span></em><span class="koboSpan" id="kobo.574.1">.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.575.1">That last field we’ll look</span><a id="_idIndexMarker923"/><span class="koboSpan" id="kobo.576.1"> at is field 9, which is the </span><strong class="keyWord"><span class="koboSpan" id="kobo.577.1">HTTP status code</span></strong><span class="koboSpan" id="kobo.578.1">. </span><span class="koboSpan" id="kobo.578.2">Again, we’ll use the blank space</span><a id="_idIndexMarker924"/><span class="koboSpan" id="kobo.579.1"> as the field</span><a id="_idIndexMarker925"/><span class="koboSpan" id="kobo.580.1"> delimiter, like so:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.581.1">donnie@fedora:~$ sudo awk '{print $9}' /var/log/httpd/access_log | sort | uniq -c | sort -k1,1 -nr
     53 200
     17 404
     17 403
      2 304
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.582.1">Here’s the breakdown of what these codes mean:</span></p>
    <ul>
      <li class="bulletList"><span class="koboSpan" id="kobo.583.1">200: The </span><code class="inlineCode"><span class="koboSpan" id="kobo.584.1">200</span></code><span class="koboSpan" id="kobo.585.1"> code means that users were able to access web pages normally, with no problems.</span></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.586.1">304: The </span><code class="inlineCode"><span class="koboSpan" id="kobo.587.1">304</span></code><span class="koboSpan" id="kobo.588.1"> code just means that when a user reloaded a page, nothing on the page had changed, so that it didn’t need to be reloaded.</span></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.589.1">403: The </span><code class="inlineCode"><span class="koboSpan" id="kobo.590.1">403</span></code><span class="koboSpan" id="kobo.591.1"> code means that someone tried to access a page for which the user wasn’t authorized.</span></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.592.1">404: The </span><code class="inlineCode"><span class="koboSpan" id="kobo.593.1">404</span></code><span class="koboSpan" id="kobo.594.1"> means that a user tried to access a page that doesn’t exist.</span></li>
    </ul>
    <p class="normal"><span class="koboSpan" id="kobo.595.1">Okay, all this is good. </span><span class="koboSpan" id="kobo.595.2">So now, let’s put all this into the </span><code class="inlineCode"><span class="koboSpan" id="kobo.596.1">access_log_parse.sh</span></code><span class="koboSpan" id="kobo.597.1"> script, which will look like this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.598.1">#!/bin/bash
#
timestamp=$(date +%F_%I-%M-%p)
awk 'BEGIN {FS="\""} {print "\"" $6 "\""}' /var/log/httpd/access_log | sort | uniq -c | sort -k 1,1 -nr &gt; user_agent_$timestamp.tsv
awk '{print $1}' /var/log/httpd/access_log | sort -V | uniq -c | sort -k1,1 -nr &gt;&gt; source_IP_addreses_$timestamp.tsv
awk '{print $7}' /var/log/httpd/access_log | sort | uniq -c | sort -k1,1 -nr &gt; URLs_Requested_$timestamp.tsv
awk '{print $9}' /var/log/httpd/access_log | sort | uniq -c | sort -k1,1 -nr &gt; HTTP_Status_Codes_$timestamp.tsv
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.599.1">I’ve decided</span><a id="_idIndexMarker926"/><span class="koboSpan" id="kobo.600.1"> that I want to create a separate </span><code class="inlineCode"><span class="koboSpan" id="kobo.601.1">.tsv</span></code><span class="koboSpan" id="kobo.602.1"> file for each</span><a id="_idIndexMarker927"/><span class="koboSpan" id="kobo.603.1"> function, and that I want to have a timestamp in each filename. </span><span class="koboSpan" id="kobo.603.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.604.1">%F</span></code><span class="koboSpan" id="kobo.605.1"> option for </span><code class="inlineCode"><span class="koboSpan" id="kobo.606.1">date</span></code><span class="koboSpan" id="kobo.607.1"> prints the date in </span><code class="inlineCode"><span class="koboSpan" id="kobo.608.1">YEAR-MONTH-DATE</span></code><span class="koboSpan" id="kobo.609.1"> format, which is fine. </span><span class="koboSpan" id="kobo.609.2">I could have used the </span><code class="inlineCode"><span class="koboSpan" id="kobo.610.1">%T</span></code><span class="koboSpan" id="kobo.611.1"> option to print the time, but that would have placed colons in the filenames, which would require me to escape the colons every time I want to access one of these files from the command line. </span><span class="koboSpan" id="kobo.611.2">So, I instead used the </span><code class="inlineCode"><span class="koboSpan" id="kobo.612.1">%I-%M-%p</span></code><span class="koboSpan" id="kobo.613.1"> combination, in order to replace the colons with dashes. </span><span class="koboSpan" id="kobo.613.2">(To see more formatting options, consult the </span><code class="inlineCode"><span class="koboSpan" id="kobo.614.1">date</span></code><span class="koboSpan" id="kobo.615.1"> man page.) The rest of the script consists of the commands that you’ve already seen, so I won’t repeat any of those explanations.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.616.1">Of course, you can fancy up any of these scripts to meet your own desires and needs. </span><span class="koboSpan" id="kobo.616.2">Just use the techniques that I’ve shown you in previous chapters to add markup language tags to the output, and convert the output files to </span><code class="inlineCode"><span class="koboSpan" id="kobo.617.1">.html</span></code><span class="koboSpan" id="kobo.618.1"> or </span><code class="inlineCode"><span class="koboSpan" id="kobo.619.1">.pdf</span></code><span class="koboSpan" id="kobo.620.1"> format. </span><span class="koboSpan" id="kobo.620.2">For the multi-function script that I’ve just now shown you, you could add either </span><code class="inlineCode"><span class="koboSpan" id="kobo.621.1">if..then</span></code><span class="koboSpan" id="kobo.622.1"> or </span><code class="inlineCode"><span class="koboSpan" id="kobo.623.1">case</span></code><span class="koboSpan" id="kobo.624.1"> constructs that would allow you to choose the specific function that you want to run. </span><span class="koboSpan" id="kobo.624.2">And, don’t feel bad if you need to refer back to the previous chapters to see how any of this is done. </span><span class="koboSpan" id="kobo.624.3">Trust me, I won’t hold it against you.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.625.1">So far, we’ve been parsing through the entire file to find what we want to see. </span><span class="koboSpan" id="kobo.625.2">Sometimes though, you might just want to view information from either a specific line or range of lines. </span><span class="koboSpan" id="kobo.625.3">For example, let’s say that you just want to see line 10. </span><span class="koboSpan" id="kobo.625.4">Do it like this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.626.1">donnie@fedora:~$ sudo awk 'NR == 10' /var/log/httpd/access_log
192.168.0.16 - - [17/Dec/2023:17:31:20 -0500] "GET /test.php HTTP/1.0" 200 59 "-" "Lynx/2.9.0dev.10 libwww-FM/2.14 SSL-MM/1.4.1 GNUTLS/3.7.1"
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.627.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.628.1">NR</span></code><span class="koboSpan" id="kobo.629.1"> variable represents the </span><strong class="keyWord"><span class="koboSpan" id="kobo.630.1">Number of Record</span></strong><span class="koboSpan" id="kobo.631.1">. </span><span class="koboSpan" id="kobo.631.2">Since each record in </span><a id="_idIndexMarker928"/><span class="koboSpan" id="kobo.632.1">the </span><code class="inlineCode"><span class="koboSpan" id="kobo.633.1">access_log</span></code><span class="koboSpan" id="kobo.634.1"> file consists</span><a id="_idIndexMarker929"/><span class="koboSpan" id="kobo.635.1"> of only a single line, this is the same</span><a id="_idIndexMarker930"/><span class="koboSpan" id="kobo.636.1"> as defining the line number that you want to see. </span><span class="koboSpan" id="kobo.636.2">To see a range of lines, do something like this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.637.1">donnie@fedora:~$ sudo awk 'NR == 10, NR == 15 {print $1}' /var/log/httpd/access_log
192.168.0.16
192.168.0.16
192.168.0.16
192.168.0.107
192.168.0.107
192.168.0.107
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.638.1">Here, I’m looking at field 1 of lines 10 through 15. </span><span class="koboSpan" id="kobo.638.2">Of course, you could do the same thing by combining the </span><code class="inlineCode"><span class="koboSpan" id="kobo.639.1">tail</span></code><span class="koboSpan" id="kobo.640.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.641.1">head</span></code><span class="koboSpan" id="kobo.642.1">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.643.1">cut</span></code><span class="koboSpan" id="kobo.644.1"> utilities, but this is way easier.</span></p>
    <div class="note">
      <p class="normal"><span class="koboSpan" id="kobo.645.1">In this section, we’ve looked at </span><code class="inlineCode"><span class="koboSpan" id="kobo.646.1">FS</span></code><span class="koboSpan" id="kobo.647.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.648.1">OFS</span></code><span class="koboSpan" id="kobo.649.1">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.650.1">NR</span></code><span class="koboSpan" id="kobo.651.1">. </span><span class="koboSpan" id="kobo.651.2">What I haven’t told you yet is that these three constructs are variables that are built into </span><code class="inlineCode"><span class="koboSpan" id="kobo.652.1">awk</span></code><span class="koboSpan" id="kobo.653.1">. </span><span class="koboSpan" id="kobo.653.2">There are many more built-in variables, but I’d rather not overwhelm you by explaining all of them now. </span><span class="koboSpan" id="kobo.653.3">If you’re interested in reading about all of them, just open the </span><code class="inlineCode"><span class="koboSpan" id="kobo.654.1">awk</span></code><span class="koboSpan" id="kobo.655.1"> man page</span><a id="_idIndexMarker931"/><span class="koboSpan" id="kobo.656.1"> and scroll down to the </span><strong class="keyWord"><span class="koboSpan" id="kobo.657.1">Built-in Variables</span></strong><span class="koboSpan" id="kobo.658.1"> section.</span></p>
    </div>
    <p class="normal"><span class="koboSpan" id="kobo.659.1">The log parsing techniques that I’ve presented here can be used for any type of log file. </span><span class="koboSpan" id="kobo.659.2">To design your </span><code class="inlineCode"><span class="koboSpan" id="kobo.660.1">awk</span></code><span class="koboSpan" id="kobo.661.1"> commands, look through the log files that you want to process and take note of how the fields are laid out in each line, and what information they contain.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.662.1">Before we move on, let’s look at a few other log-parsing techniques.</span></p>
    <h2 id="_idParaDest-310" class="heading 2"><span class="koboSpan" id="kobo.663.1">Using Regular Expressions</span></h2>
    <p class="normal"><span class="koboSpan" id="kobo.664.1">You can enhance</span><a id="_idIndexMarker932"/><span class="koboSpan" id="kobo.665.1"> your </span><code class="inlineCode"><span class="koboSpan" id="kobo.666.1">awk</span></code><span class="koboSpan" id="kobo.667.1"> experience with regular</span><a id="_idIndexMarker933"/><span class="koboSpan" id="kobo.668.1"> expressions, just as you can with other text-manipulation utilities.</span></p>
    <div class="note">
      <p class="normal"><span class="koboSpan" id="kobo.669.1">If you need to, refer back to </span><em class="chapterRef"><span class="koboSpan" id="kobo.670.1">Chapter 2, Text Stream Filters – Part 2</span></em><span class="koboSpan" id="kobo.671.1"> and </span><em class="chapterRef"><span class="koboSpan" id="kobo.672.1">Chapter 9, Filtering Text with grep, sed, and Regular Expressions</span></em><span class="koboSpan" id="kobo.673.1"> to review the concepts of regular expressions and POSIX character classes.</span></p>
    </div>
    <p class="normal"><span class="koboSpan" id="kobo.674.1">For our first example, let’s say that you need to search through the </span><code class="inlineCode"><span class="koboSpan" id="kobo.675.1">/etc/passwd</span></code><span class="koboSpan" id="kobo.676.1"> file for all users whose usernames begin with a lower-case </span><em class="italic"><span class="koboSpan" id="kobo.677.1">v</span></em><span class="koboSpan" id="kobo.678.1">. </span><span class="koboSpan" id="kobo.678.2">Just use a simple regular expression, which will look like this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.679.1">donnie@fedora:~$ awk '/^v/' /etc/passwd
vicky:x:1001:1001::/home/vicky:/bin/bash
victor:x:1006:1006::/home/victor:/bin/bash
valerie:x:1007:1007::/home/valerie:/bin/bash
victoria:x:1008:1008::/home/victoria:/bin/bash
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.680.1">This works because the username field is the first field of every line. </span><span class="koboSpan" id="kobo.680.2">So, you don’t need to do anything any fancier than just this. </span><span class="koboSpan" id="kobo.680.3">But, let’s suppose you need to search for something in another field that begins with a certain character. </span><span class="koboSpan" id="kobo.680.4">For example let’s say that you need to search through the Apache access log file for all HTTP status codes that are in the 400 range. </span><span class="koboSpan" id="kobo.680.5">Just do something like this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.681.1">donnie@fedora:~$ sudo awk '$9 ~ /^4/{print $9}' /var/log/httpd/access_log | sort -n | uniq -c
     17 403
     20 404
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.682.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.683.1">$9</span></code><span class="koboSpan" id="kobo.684.1"> in the pattern means</span><a id="_idIndexMarker934"/><span class="koboSpan" id="kobo.685.1"> that you’re looking for a certain pattern</span><a id="_idIndexMarker935"/><span class="koboSpan" id="kobo.686.1"> in field 9. </span><span class="koboSpan" id="kobo.686.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.687.1">~</span></code><span class="koboSpan" id="kobo.688.1"> means that you want something in that field to match whatever is within the following forward slashes. </span><span class="koboSpan" id="kobo.688.2">In this case, it’s looking for anything in field 9 that begins with the number 4. </span><span class="koboSpan" id="kobo.688.3">In the output, you see that I’ve found both the 403 and the 404 status codes. </span><span class="koboSpan" id="kobo.688.4">And, if you need to, you can save the output to a </span><code class="inlineCode"><span class="koboSpan" id="kobo.689.1">.csv</span></code><span class="koboSpan" id="kobo.690.1"> file, like so:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.691.1">donnie@fedora:~$ sudo awk '$9 ~ /^4/{print $9}' /var/log/httpd/access_log | sort -n | uniq -c | mlr --p2c cat &gt; status_code.csv
donnie@fedora:~$ cat status_code.csv
17,403
20,404
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.692.1">If you prefer, you can save it to a </span><code class="inlineCode"><span class="koboSpan" id="kobo.693.1">.tsv</span></code><span class="koboSpan" id="kobo.694.1"> file by omitting the </span><code class="inlineCode"><span class="koboSpan" id="kobo.695.1">mlr --p2c cat</span></code><span class="koboSpan" id="kobo.696.1"> portion, like so:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.697.1">donnie@fedora-server:~$ sudo awk '$9 ~ /^4/{print $9}' /var/log/httpd/access_log | sort -n | uniq -c &gt; status_code.tsv
donnie@fedora-server:~$ cat status_code.tsv
      6 403
      4 404
donnie@fedora-server:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.698.1">To see everything </span><em class="italic"><span class="koboSpan" id="kobo.699.1">except</span></em><span class="koboSpan" id="kobo.700.1"> for a certain pattern, use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.701.1">!~</span></code><span class="koboSpan" id="kobo.702.1"> construct, like this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.703.1">donnie@fedora:~$ sudo awk '$9 !~ /^4/{print $9}' /var/log/httpd/access_log | sort -n | uniq -c
     53 200
      2 304
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.704.1">This allows us to see everything except for the 400 codes.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.705.1">Next, let’s say that we want to see all instances where someone used either the Safari or the Lynx web browsers. </span><span class="koboSpan" id="kobo.705.2">You could do this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.706.1">donnie@fedora:~$ sudo awk '/Safari|Lynx/' /var/log/httpd/access_log
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.707.1">However, that doesn’t work, because it will include entries like this one:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.708.1">192.168.0.27 - - [17/Dec/2023:17:43:40 -0500] "GET / HTTP/1.1" 403 8474 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36 Edg/120.0.0.0"
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.709.1">For some strange</span><a id="_idIndexMarker936"/><span class="koboSpan" id="kobo.710.1"> reason, Apache can’t exactly identify</span><a id="_idIndexMarker937"/><span class="koboSpan" id="kobo.711.1"> the Microsoft Edge browser, so it reports it as several different possibilities, including Safari. </span><span class="koboSpan" id="kobo.711.2">To narrow that down, I’ll exclude any users who are using Windows. </span><span class="koboSpan" id="kobo.711.3">(Safari used to be available for Windows, but the Windows version was discontinued in 2012.) Here’s how that looks:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.712.1">donnie@fedora:~$ sudo awk -F\" '$6 ~/Safari|Lynx/ &amp;&amp; $6 !~ /Windows/' /var/log/httpd/access_log
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.713.1">And here, you see something that’s rather strange. </span><span class="koboSpan" id="kobo.713.2">It’s that when you use an </span><code class="inlineCode"><span class="koboSpan" id="kobo.714.1">or</span></code><span class="koboSpan" id="kobo.715.1"> or an </span><code class="inlineCode"><span class="koboSpan" id="kobo.716.1">and</span></code><span class="koboSpan" id="kobo.717.1"> operator within a regular expression, you use either a single </span><code class="inlineCode"><span class="koboSpan" id="kobo.718.1">|</span></code><span class="koboSpan" id="kobo.719.1"> or a single </span><code class="inlineCode"><span class="koboSpan" id="kobo.720.1">&amp;</span></code><span class="koboSpan" id="kobo.721.1">. </span><span class="koboSpan" id="kobo.721.2">When you use an </span><code class="inlineCode"><span class="koboSpan" id="kobo.722.1">or</span></code><span class="koboSpan" id="kobo.723.1"> or an </span><code class="inlineCode"><span class="koboSpan" id="kobo.724.1">and</span></code><span class="koboSpan" id="kobo.725.1"> operator outside of a regular expression, you use either </span><code class="inlineCode"><span class="koboSpan" id="kobo.726.1">||</span></code><span class="koboSpan" id="kobo.727.1"> or </span><code class="inlineCode"><span class="koboSpan" id="kobo.728.1">&amp;&amp;</span></code><span class="koboSpan" id="kobo.729.1">. </span><span class="koboSpan" id="kobo.729.2">I know, it’s confusing, but that’s just the way it is. </span><span class="koboSpan" id="kobo.729.3">Anyway, if you look through the output now, you’ll see that there are no lines from the Windows users.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.730.1">I know, this is just scratching</span><a id="_idIndexMarker938"/><span class="koboSpan" id="kobo.731.1"> the surface for what you can do with </span><code class="inlineCode"><span class="koboSpan" id="kobo.732.1">awk</span></code><span class="koboSpan" id="kobo.733.1"> and regular </span><a id="_idIndexMarker939"/><span class="koboSpan" id="kobo.734.1">expressions. </span><span class="koboSpan" id="kobo.734.2">If you ask real nicely, I might show you a few more examples in the next section, which will be about how to use </span><code class="inlineCode"><span class="koboSpan" id="kobo.735.1">awk</span></code><span class="koboSpan" id="kobo.736.1"> to process information from other commands.</span></p>
    <h1 id="_idParaDest-311" class="heading 1"><span class="koboSpan" id="kobo.737.1">Obtaining Input from Commands</span></h1>
    <p class="normal"><span class="koboSpan" id="kobo.738.1">Let’s start with something</span><a id="_idIndexMarker940"/><span class="koboSpan" id="kobo.739.1"> simple, by obtaining some basic process information. </span><span class="koboSpan" id="kobo.739.2">On the Fedora Server virtual machine that’s running Apache, search for all </span><code class="inlineCode"><span class="koboSpan" id="kobo.740.1">ps aux</span></code><span class="koboSpan" id="kobo.741.1"> output lines that contain the </span><code class="inlineCode"><span class="koboSpan" id="kobo.742.1">httpd</span></code><span class="koboSpan" id="kobo.743.1"> pattern, like so:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.744.1">donnie@fedora:~$ ps aux | awk '/httpd/ {print $0}'
root        1072  0.0  0.2  19108 10796 ?        </span><span class="koboSpan" id="kobo.744.2">Ss   14:36   0:01 /usr/sbin/httpd -DFOREGROUND
apache      1111  0.0  0.1  19204  6788 ?        </span><span class="koboSpan" id="kobo.744.3">S    14:36   0:00 /usr/sbin/httpd -DFOREGROUND
apache      1112  0.0  0.2 2158280 8448 ?        </span><span class="koboSpan" id="kobo.744.4">Sl   14:36   0:02 /usr/sbin/httpd -DFOREGROUND
apache      1113  0.0  0.2 2420488 8592 ?        </span><span class="koboSpan" id="kobo.744.5">Sl   14:36   0:03 /usr/sbin/httpd -DFOREGROUND
apache      1114  0.0  0.2 2158280 8448 ?        </span><span class="koboSpan" id="kobo.744.6">Sl   14:36   0:02 /usr/sbin/httpd -DFOREGROUND
donnie      1908  0.0  0.0   9196  3768 pts/0    S+   17:13   0:00 awk /httpd/ {print $0}
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.745.1">Next, let’s say that we want to see all processes that are owned by the root user. </span><span class="koboSpan" id="kobo.745.2">That’s also easy. </span><span class="koboSpan" id="kobo.745.3">Just do this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.746.1">donnie@fedora:~$ ps aux | awk '$1 == "root" {print $0}'
root           1  0.0  0.6  74552 27044 ?        </span><span class="koboSpan" id="kobo.746.2">Ss   14:26   0:05 /usr/lib/systemd/systemd --switched-root --system --deserialize=36 rhgb
root           2  0.0  0.0      0     0 ?        </span><span class="koboSpan" id="kobo.746.3">S    14:26   0:00 [kthreadd]
root           3  0.0  0.0      0     0 ?        </span><span class="koboSpan" id="kobo.746.4">S    14:26   0:00 [pool_workqueue_release]
. </span><span class="koboSpan" id="kobo.746.5">. </span><span class="koboSpan" id="kobo.746.6">.
</span><span class="koboSpan" id="kobo.746.7">. </span><span class="koboSpan" id="kobo.746.8">. </span><span class="koboSpan" id="kobo.746.9">.
</span><span class="koboSpan" id="kobo.746.10">root        1688  0.0  0.1  16332  6400 ?        </span><span class="koboSpan" id="kobo.746.11">S    16:53   0:00 systemd-userwork: waiting...
</span><span class="koboSpan" id="kobo.746.12">donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.747.1">There’s nothing really new here, because these </span><code class="inlineCode"><span class="koboSpan" id="kobo.748.1">awk</span></code><span class="koboSpan" id="kobo.749.1"> commands are the same as you saw in the previous section. </span><span class="koboSpan" id="kobo.749.2">Indeed, pretty much all of the techniques that you can do with parsing log files also work here. </span><span class="koboSpan" id="kobo.749.3">So, let’s not repeat any more of that.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.750.1">The first step for parsing information</span><a id="_idIndexMarker941"/><span class="koboSpan" id="kobo.751.1"> from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.752.1">ps </span></code><span class="koboSpan" id="kobo.753.1">utility is to see what the various fields are. </span><span class="koboSpan" id="kobo.753.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.754.1">aux</span></code><span class="koboSpan" id="kobo.755.1"> combination of options is what I find most useful for myself, simply because it displays the specific information that I most need to see. </span><span class="koboSpan" id="kobo.755.2">To see the </span><code class="inlineCode"><span class="koboSpan" id="kobo.756.1">ps</span></code><span class="koboSpan" id="kobo.757.1"> header that shows the field names, I’ll pipe the </span><code class="inlineCode"><span class="koboSpan" id="kobo.758.1">ps aux</span></code><span class="koboSpan" id="kobo.759.1"> output into </span><code class="inlineCode"><span class="koboSpan" id="kobo.760.1">head -1</span></code><span class="koboSpan" id="kobo.761.1">, like this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.762.1">[donnie@fedora ~]$ ps aux | head -1
USER      PID   %CPU   %MEM    VSZ   RSS   TTY    STAT   START   TIME   COMMAND
[donnie@fedora ~]$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.763.1">Here’s the breakdown</span><a id="_idIndexMarker942"/><span class="koboSpan" id="kobo.764.1"> of what all these fields represent:</span></p>
    <ul>
      <li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.765.1">USER</span></code><span class="koboSpan" id="kobo.766.1">: The user that owns each particular process.</span></li>
      <li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.767.1">PID</span></code><span class="koboSpan" id="kobo.768.1">: The </span><strong class="keyWord"><span class="koboSpan" id="kobo.769.1">Process ID</span></strong><span class="koboSpan" id="kobo.770.1"> number</span><a id="_idIndexMarker943"/><span class="koboSpan" id="kobo.771.1"> of each process.</span></li>
      <li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.772.1">%CPU</span></code><span class="koboSpan" id="kobo.773.1">: The percentage of CPU resources that each process consumes.</span></li>
      <li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.774.1">RSS</span></code><span class="koboSpan" id="kobo.775.1">: The </span><strong class="keyWord"><span class="koboSpan" id="kobo.776.1">Resident Set Size</span></strong><span class="koboSpan" id="kobo.777.1"> is the amount</span><a id="_idIndexMarker944"/><span class="koboSpan" id="kobo.778.1"> of actual physical, non-swapped memory that each process uses. </span><span class="koboSpan" id="kobo.778.2">(I know that this is out of order, but you’ll soon see the reason.)</span></li>
      <li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.779.1">%MEM</span></code><span class="koboSpan" id="kobo.780.1">: The ratio of the process’s RSS to the amount of physical memory that’s installed in the machine.</span></li>
      <li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.781.1">VSZ</span></code><span class="koboSpan" id="kobo.782.1">: The </span><strong class="keyWord"><span class="koboSpan" id="kobo.783.1">Virtual Set Size</span></strong><span class="koboSpan" id="kobo.784.1"> is the amount of virtual memory</span><a id="_idIndexMarker945"/><span class="koboSpan" id="kobo.785.1"> that each process is using. </span><span class="koboSpan" id="kobo.785.2">(This is expressed in numbers of 1024-byte units.)</span></li>
      <li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.786.1">TTY</span></code><span class="koboSpan" id="kobo.787.1">: This is the terminal which is controlling each process.</span></li>
      <li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.788.1">STAT</span></code><span class="koboSpan" id="kobo.789.1">: This column holds the status code of each process.</span></li>
      <li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.790.1">START</span></code><span class="koboSpan" id="kobo.791.1">: The starting time or date of each process.</span></li>
      <li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.792.1">TIME</span></code><span class="koboSpan" id="kobo.793.1">: This is the cumulative CPU time for each process, in “</span><code class="inlineCode"><span class="koboSpan" id="kobo.794.1">[DD-]HH:MM:SS</span></code><span class="koboSpan" id="kobo.795.1">" format.</span></li>
      <li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.796.1">COMMAND</span></code><span class="koboSpan" id="kobo.797.1">: The commands that started each process.</span></li>
    </ul>
    <div class="note">
      <p class="normal"><span class="koboSpan" id="kobo.798.1">Bear in mind that there are many options switches for </span><code class="inlineCode"><span class="koboSpan" id="kobo.799.1">ps</span></code><span class="koboSpan" id="kobo.800.1">, which all show different types of process data. </span><span class="koboSpan" id="kobo.800.2">There are also many ways to combine the switches in order to get all of the information you need, displayed in your preferred format. </span><span class="koboSpan" id="kobo.800.3">For now though, I’m just going to stick with </span><code class="inlineCode"><span class="koboSpan" id="kobo.801.1">ps aux</span></code><span class="koboSpan" id="kobo.802.1">, mainly because it’s the most useful option combination for me. </span><span class="koboSpan" id="kobo.802.2">For more details, see the </span><code class="inlineCode"><span class="koboSpan" id="kobo.803.1">ps</span></code><span class="koboSpan" id="kobo.804.1"> man page.</span></p>
    </div>
    <p class="normal"><span class="koboSpan" id="kobo.805.1">By default, </span><code class="inlineCode"><span class="koboSpan" id="kobo.806.1">ps</span></code><span class="koboSpan" id="kobo.807.1"> commands always display</span><a id="_idIndexMarker946"/><span class="koboSpan" id="kobo.808.1"> this header along with the information that you want to see. </span><span class="koboSpan" id="kobo.808.2">So, you’ll see this header if you pipe </span><code class="inlineCode"><span class="koboSpan" id="kobo.809.1">ps</span></code><span class="koboSpan" id="kobo.810.1"> into an </span><code class="inlineCode"><span class="koboSpan" id="kobo.811.1">awk</span></code><span class="koboSpan" id="kobo.812.1"> command that doesn’t filter it out. </span><span class="koboSpan" id="kobo.812.2">For example, let’s look at the processes that are not owned by the root user, like this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.813.1">donnie@fedora:~$ ps aux | awk '$1 != "root" {print $0}'
USER        PID  %CPU %MEM   VSZ    RSS   TTY   STAT START  TIME COMMAND
systemd+    800  0.1      0.1           16240  7328   ?        </span><span class="koboSpan" id="kobo.813.2">Ss       14:27      0:13   /usr/lib/systemd/systemd-oomd
systemd+    801  0.0      0.4           27656  16236 ?        </span><span class="koboSpan" id="kobo.813.3">Ss        14:27     0:00   /usr/lib/systemd/systemd-resolved
. </span><span class="koboSpan" id="kobo.813.4">. </span><span class="koboSpan" id="kobo.813.5">.
</span><span class="koboSpan" id="kobo.813.6">. </span><span class="koboSpan" id="kobo.813.7">. </span><span class="koboSpan" id="kobo.813.8">.
</span><span class="koboSpan" id="kobo.813.9">donnie       1745  200    0.1            9888   4520   pts/0    R+      17:10     0:00   ps aux
donnie        746  0.0     0.0            9196   3804   pts/0    S+       17:10     0:00   awk $1 != "root" {print $0}
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.814.1">That’s fine most of the time. </span><span class="koboSpan" id="kobo.814.2">But, having that header there might mess you up if you need to save the information to a formatted text file. </span><span class="koboSpan" id="kobo.814.3">To fix this, let’s use the </span><strong class="keyWord"><span class="koboSpan" id="kobo.815.1">Number of Record</span></strong><span class="koboSpan" id="kobo.816.1"> (</span><code class="inlineCode"><span class="koboSpan" id="kobo.817.1">NR)</span></code><span class="koboSpan" id="kobo.818.1"> variable that I showed you in the previous section. </span><span class="koboSpan" id="kobo.818.2">Here’s how that works:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.819.1">donnie@fedora:~$ ps aux | awk 'NR &gt; 1 &amp;&amp; $1 != "root" {print $0}'
systemd+     800  0.1  0.1  16240  7328 ?        </span><span class="koboSpan" id="kobo.819.2">Ss   14:27   0:15 /usr/lib/systemd/systemd-oomd
systemd+     801  0.0  0.4  27656 16236 ?        </span><span class="koboSpan" id="kobo.819.3">Ss   14:27   0:00 /usr/lib/systemd/systemd-resolved
. </span><span class="koboSpan" id="kobo.819.4">. </span><span class="koboSpan" id="kobo.819.5">.
</span><span class="koboSpan" id="kobo.819.6">. </span><span class="koboSpan" id="kobo.819.7">. </span><span class="koboSpan" id="kobo.819.8">.
</span><span class="koboSpan" id="kobo.819.9">donnie      1765  250  0.1   9888  4620 pts/0    R+   17:26   0:00 ps aux
donnie      1766  0.0  0.0   9196  3780 pts/0    S+   17:26   0:00 awk NR &gt; 1 &amp;&amp; $1 != "root" {print $0}
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.820.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.821.1">NR &gt; 1</span></code><span class="koboSpan" id="kobo.822.1"> clause means</span><a id="_idIndexMarker947"/><span class="koboSpan" id="kobo.823.1"> that we only want to see records that come after record 1. </span><span class="koboSpan" id="kobo.823.2">In other words, we don’t want to see the first line of output, which in this case would be the </span><code class="inlineCode"><span class="koboSpan" id="kobo.824.1">ps</span></code><span class="koboSpan" id="kobo.825.1"> header.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.826.1">Now that we know what each field is, we can create some useful one-liners to extract information. </span><span class="koboSpan" id="kobo.826.2">First, let’s see how many processes are in either the </span><strong class="keyWord"><span class="koboSpan" id="kobo.827.1">Running</span></strong><span class="koboSpan" id="kobo.828.1"> state or the </span><strong class="keyWord"><span class="koboSpan" id="kobo.829.1">Zombie</span></strong><span class="koboSpan" id="kobo.830.1"> state. </span><span class="koboSpan" id="kobo.830.2">(A Zombie process is a dead process that hasn’t yet been properly destroyed by its parent process. </span><span class="koboSpan" id="kobo.830.3">You can view the </span><code class="inlineCode"><span class="koboSpan" id="kobo.831.1">ps</span></code><span class="koboSpan" id="kobo.832.1"> man page to learn more about them.) We know that the </span><code class="inlineCode"><span class="koboSpan" id="kobo.833.1">STAT</span></code><span class="koboSpan" id="kobo.834.1"> column is field 8, so the command will look like this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.835.1">[donnie@fedora ~]$ ps aux | awk '$8 ~ /^[RZ]/ {print}'
donnie      2803 30.5  1.6 4963152 1058324 ?     </span><span class="koboSpan" id="kobo.835.2">Rl   14:00  70:12 /usr/lib64/firefox/firefox
donnie      4383  1.9  0.4 3157216 307460 ?      </span><span class="koboSpan" id="kobo.835.3">Rl   14:03   4:18 /usr/lib64/firefox/firefox -contentproc -childID 33 -isForBrowser -prefsLen 31190 -prefMapSize 237466 -jsInitLen 229864 -parentBuildID 20231219113315 -greomni /usr/lib64/firefox/omni.ja -appomni /usr/lib64/firefox/browser/omni.ja -appDir /usr/lib64/firefox/browser {d458c911-d065-4a3c-bdd5-9d06fc1d030d} 2803 true tab
donnie     46283  0.0  0.0      0     0 ?        </span><span class="koboSpan" id="kobo.835.4">R    17:50   0:00 [Chroot Helper]
donnie     46315  0.0  0.0 224672  3072 pts/0    R+   17:50   0:00 ps aux
[donnie@fedora ~]$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.836.1">It looks a bit jumbled up because the </span><code class="inlineCode"><span class="koboSpan" id="kobo.837.1">COMMAND</span></code><span class="koboSpan" id="kobo.838.1"> field for the second process contains a very long string, but that’s okay. </span><span class="koboSpan" id="kobo.838.2">You can still see that field 8 in every line begins with the letter </span><code class="inlineCode"><span class="koboSpan" id="kobo.839.1">R</span></code><span class="koboSpan" id="kobo.840.1">. </span><span class="koboSpan" id="kobo.840.2">(You’ll rarely see any Zombie processes on your systems, so don’t worry about not seeing any of them here. </span><span class="koboSpan" id="kobo.840.3">And no, Zombie processes don’t go around looking for brains to steal.)</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.841.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.842.1">w</span></code><span class="koboSpan" id="kobo.843.1"> command shows</span><a id="_idIndexMarker948"/><span class="koboSpan" id="kobo.844.1"> you a list of all users who are logged into the system, and what they’re doing. </span><span class="koboSpan" id="kobo.844.2">It looks like this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.845.1">donnie@fedora:~$ w
 17:37:44 up  3:11,  4 users,  load average: 0.03, 0.06, 0.02
USER        TTY         LOGIN@  IDLE     JCPU     PCPU      WHAT
donnie      tty1        17:31   5:51     0.06s    0.06s     -bash
donnie      pts/0       15:29   0.00s    0.35s    0.06s     w
vicky       pts/1       17:32   4:50     0.05s    0.05s     -bash
frank       pts/2       17:33   3:18     0.05s    0.05s     -bash
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.846.1">You see that I’m logged in via </span><code class="inlineCode"><span class="koboSpan" id="kobo.847.1">tty1</span></code><span class="koboSpan" id="kobo.848.1">, which is the local terminal. </span><span class="koboSpan" id="kobo.848.2">I’m also logged in remotely via a </span><code class="inlineCode"><span class="koboSpan" id="kobo.849.1">pts</span></code><span class="koboSpan" id="kobo.850.1"> terminal, along with Vicky and Frank. </span><span class="koboSpan" id="kobo.850.2">(Remember that </span><code class="inlineCode"><span class="koboSpan" id="kobo.851.1">tty</span></code><span class="koboSpan" id="kobo.852.1"> terminals indicate that someone is logged in locally, while </span><code class="inlineCode"><span class="koboSpan" id="kobo.853.1">pts</span></code><span class="koboSpan" id="kobo.854.1"> terminals indicate that someone is logged in remotely.) Now, let’s use </span><code class="inlineCode"><span class="koboSpan" id="kobo.855.1">ps</span></code><span class="koboSpan" id="kobo.856.1"> to see more information about the processes that the remote users are running, like this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.857.1">donnie@fedora:~$ ps aux | awk '$7 ~ "pts"'
donnie    1492  0.0  0.1  8480  5204 pts/0  Ss   15:29   0:00 -bash
vicky     1845  0.0  0.1  8348  4960 pts/1  Ss+  17:32   0:00 -bash
frank     1892  0.0  0.1  8348  5000 pts/2  Ss+  17:33   0:00 -bash
donnie    1936  200  0.1  9888  4640 pts/0  R+   17:37   0:00 ps aux
donnie    1937  0.0  0.0  9064  3908 pts/0  S+   17:37   0:00 awk $7 ~ "pts"
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.858.1">A few moments ago, I showed you how to strip the header line out of the output if your </span><code class="inlineCode"><span class="koboSpan" id="kobo.859.1">awk</span></code><span class="koboSpan" id="kobo.860.1"> command doesn’t already strip it out. </span><span class="koboSpan" id="kobo.860.2">This time, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.861.1">awk</span></code><span class="koboSpan" id="kobo.862.1"> command does strip it out, but I’ve decided that I want to see it. </span><span class="koboSpan" id="kobo.862.2">To fix that, I’ll do this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.863.1">donnie@fedora:~$ ps aux | awk '$7 ~ "pts" || $1 == "USER"'
USER   PID   %CPU  %MEM  VSZ  RSS  TTY   STAT START  TIME COMMAND
donnie 1492  0.0   0.1   8480 5204 pts/0 Ss   15:29  0:00   -bash
vicky  1845  0.0   0.1   8348 4960 pts/1 Ss+  17:32  0:00   -bash
frank  1892  0.0   0.1   8348 5000 pts/2 Ss+  17:33  0:00   -bash
donnie 2029  400   0.1   9888 4416 pts/0 R+   17:48  0:00   ps aux
donnie 2030  0.0   0.0   9064 3928 pts/0 S+   17:48  0:00   awk $7 ~ "pts" || $1 == "USER"
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.864.1">Note here that I’m using two different methods</span><a id="_idIndexMarker949"/><span class="koboSpan" id="kobo.865.1"> of finding a pattern. </span><span class="koboSpan" id="kobo.865.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.866.1">$7 ~ "pts" </span></code><span class="koboSpan" id="kobo.867.1">portion finds all lines that contain the </span><code class="inlineCode"><span class="koboSpan" id="kobo.868.1">pts</span></code><span class="koboSpan" id="kobo.869.1"> text string in field 7. </span><span class="koboSpan" id="kobo.869.2">So, we see that </span><code class="inlineCode"><span class="koboSpan" id="kobo.870.1">pts/0</span></code><span class="koboSpan" id="kobo.871.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.872.1">pts/1</span></code><span class="koboSpan" id="kobo.873.1">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.874.1">pts/2</span></code><span class="koboSpan" id="kobo.875.1"> all match this search criterion. </span><span class="koboSpan" id="kobo.875.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.876.1">$1 == "USER"</span></code><span class="koboSpan" id="kobo.877.1"> portion is looking for an exact, whole-word match. </span><span class="koboSpan" id="kobo.877.2">To demonstrate, look at this </span><code class="inlineCode"><span class="koboSpan" id="kobo.878.1">user.txt</span></code><span class="koboSpan" id="kobo.879.1"> file:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.880.1">[donnie@fedora ~]$ cat user.txt
USER		donnie
USER1	vicky
USER2	cleopatra
USER3	sylvester
[donnie@fedora ~]
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.881.1">Using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.882.1">~</span></code><span class="koboSpan" id="kobo.883.1"> to search for all lines with </span><code class="inlineCode"><span class="koboSpan" id="kobo.884.1">USER</span></code><span class="koboSpan" id="kobo.885.1"> in field 1 gives us this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.886.1">[donnie@fedora ~]$ awk '$1 ~ "USER" {print $1}' user.txt
USER
USER1
USER2
USER3
[donnie@fedora ~]$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.887.1">Replacing the </span><code class="inlineCode"><span class="koboSpan" id="kobo.888.1">~</span></code><span class="koboSpan" id="kobo.889.1"> with </span><code class="inlineCode"><span class="koboSpan" id="kobo.890.1">==</span></code><span class="koboSpan" id="kobo.891.1"> gives us this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.892.1">[donnie@fedora ~]$ awk '$1 == "USER" {print $1}' user.txt
USER
[donnie@fedora ~]$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.893.1">So you see that there</span><a id="_idIndexMarker950"/><span class="koboSpan" id="kobo.894.1"> is a big difference. </span><span class="koboSpan" id="kobo.894.2">Also, note that since I’m searching for a literal text string, I can surround the search term (</span><code class="inlineCode"><span class="koboSpan" id="kobo.895.1">USER</span></code><span class="koboSpan" id="kobo.896.1">) within either a pair of double quotes or a pair of forward slashes when using the ~. </span><span class="koboSpan" id="kobo.896.2">However, when using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.897.1">==</span></code><span class="koboSpan" id="kobo.898.1">, you’ll need to use the double quotes, because using the double slashes shows you nothing.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.899.1">And, with that bit of a digression out of the way, let’s get back to our regularly scheduled program.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.900.1">I’ve now decided that I want to see all processes with a virtual memory size (</span><code class="inlineCode"><span class="koboSpan" id="kobo.901.1">VSZ</span></code><span class="koboSpan" id="kobo.902.1">) of more than 500,000 bytes. </span><code class="inlineCode"><span class="koboSpan" id="kobo.903.1">VSZ</span></code><span class="koboSpan" id="kobo.904.1"> information is in field 5, so my </span><code class="inlineCode"><span class="koboSpan" id="kobo.905.1">awk</span></code><span class="koboSpan" id="kobo.906.1"> command looks like this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.907.1">donnie@fedora:~$ ps aux | awk '$5 &gt; 500000 {print $0}'
USER   PID  %CPU %MEM  VSZ     RSS  TTY  STAT START   TIME COMMAND
apache 1098 0.0  0.2   2420488 8628  ?   </span><span class="koboSpan" id="kobo.907.2">Sl   14:28   0:04 /usr/sbin/httpd -DFOREGROUND
apache 1099 0.0  0.2   2223816 8248  ?   </span><span class="koboSpan" id="kobo.907.3">Sl   14:28   0:03 /usr/sbin/httpd -DFOREGROUND
apache 1100  0.0 0.2   2158280 8232  ?   </span><span class="koboSpan" id="kobo.907.4">Sl   14:28   0:04 /usr/sbin/httpd -DFOREGROUND
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.908.1">But, that’s more information than I really need. </span><span class="koboSpan" id="kobo.908.2">I just want to look at the relevant fields, and I’ve decided to place each field on its own line, along with a label. </span><span class="koboSpan" id="kobo.908.3">Here’s how I’ll do it:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.909.1">donnie@fedora:~$ ps aux | awk 'NR &gt; 1 &amp;&amp; $5 &gt; 500000 {print "USER:" "\t\t" $1 "\n" "PID:" "\t\t" $2 "\n" "VSZ:" "\t\t" $5 "\n" "COMMAND:" "\t" $11 "\n\n"}'
USER:		apache
PID:		 	1147
VSZ:			2354952
COMMAND:		/usr/sbin/httpd
USER:		apache
PID:			1148
VSZ:			2158280
COMMAND:		/usr/sbin/httpd
USER:		apache
PID:			1149
VSZ:		2158280
COMMAND:		/usr/sbin/httpd
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.910.1">As noted before, </span><code class="inlineCode"><span class="koboSpan" id="kobo.911.1">NR &gt; 1</span></code><span class="koboSpan" id="kobo.912.1"> prevents </span><code class="inlineCode"><span class="koboSpan" id="kobo.913.1">ps</span></code><span class="koboSpan" id="kobo.914.1"> from printing</span><a id="_idIndexMarker951"/><span class="koboSpan" id="kobo.915.1"> the default header. </span><span class="koboSpan" id="kobo.915.2">In the action, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.916.1">print</span></code><span class="koboSpan" id="kobo.917.1"> command places a pair of tabs (</span><code class="inlineCode"><span class="koboSpan" id="kobo.918.1">\t\t</span></code><span class="koboSpan" id="kobo.919.1">) between </span><code class="inlineCode"><span class="koboSpan" id="kobo.920.1">USER</span></code><span class="koboSpan" id="kobo.921.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.922.1">PID</span></code><span class="koboSpan" id="kobo.923.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.924.1">VSZ</span></code><span class="koboSpan" id="kobo.925.1">, and their respective values. </span><span class="koboSpan" id="kobo.925.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.926.1">COMMAND</span></code><span class="koboSpan" id="kobo.927.1"> label is longer, so it only requires one tab (</span><code class="inlineCode"><span class="koboSpan" id="kobo.928.1">\t</span></code><span class="koboSpan" id="kobo.929.1">) between it and its values. </span><span class="koboSpan" id="kobo.929.2">This ensures that all values in the second column line up nice and neat. </span><span class="koboSpan" id="kobo.929.3">The newlines (</span><code class="inlineCode"><span class="koboSpan" id="kobo.930.1">\n</span></code><span class="koboSpan" id="kobo.931.1">) after the </span><code class="inlineCode"><span class="koboSpan" id="kobo.932.1">USER</span></code><span class="koboSpan" id="kobo.933.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.934.1">PID</span></code><span class="koboSpan" id="kobo.935.1">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.936.1">VSZ</span></code><span class="koboSpan" id="kobo.937.1"> values cause the next field to print on a new line. </span><span class="koboSpan" id="kobo.937.2">After the </span><code class="inlineCode"><span class="koboSpan" id="kobo.938.1">COMMAND</span></code><span class="koboSpan" id="kobo.939.1"> value, I placed two newlines (</span><code class="inlineCode"><span class="koboSpan" id="kobo.940.1">\n\n</span></code><span class="koboSpan" id="kobo.941.1">) so that there would be a blank line between each record.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.942.1">Next, let’s turn this command into a function that we can add to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.943.1">sysinfo.lib</span></code><span class="koboSpan" id="kobo.944.1"> function library that I showed you in </span><em class="chapterRef"><span class="koboSpan" id="kobo.945.1">Chapter 10--Understanding Functions</span></em><span class="koboSpan" id="kobo.946.1">. </span><span class="koboSpan" id="kobo.946.2">Our new </span><code class="inlineCode"><span class="koboSpan" id="kobo.947.1">VSZ_info()</span></code><span class="koboSpan" id="kobo.948.1"> function looks like this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.949.1">VSZ_info() {
           echo "&lt;h2&gt;Processes with more than 500000 bytes VSZ
           size.&lt;/h2&gt;"
           echo "&lt;pre&gt;"
           ps aux | awk 'NR &gt; 1 &amp;&amp; $5 &gt; 500000 {print "USER:" "\t\t" $1 "\n" "PID:" "\t\t" $2 "\n" "VSZ:" "\t\t" $5 "\n" "COMMAND:" "\t" $11 "\n\n"}'
           echo "&lt;/pre&gt;"
}
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.950.1">Now, in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.951.1">system_info.sh</span></code><span class="koboSpan" id="kobo.952.1"> script that I also showed you in </span><em class="chapterRef"><span class="koboSpan" id="kobo.953.1">Chapter 10</span></em><span class="koboSpan" id="kobo.954.1">, you’ll need to add </span><code class="inlineCode"><span class="koboSpan" id="kobo.955.1">$(VSZ_info)</span></code><span class="koboSpan" id="kobo.956.1"> to the end of the list of functions that the script calls. </span><span class="koboSpan" id="kobo.956.2">Now when you run the script, you’ll see the </span><code class="inlineCode"><span class="koboSpan" id="kobo.957.1">VSZ</span></code><span class="koboSpan" id="kobo.958.1"> information at the end of the output file. </span><span class="koboSpan" id="kobo.958.2">(Both files are too long to reproduce here, but you can download them from GitHub.)</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.959.1">Okay, that about wraps it up for the basics of using </span><code class="inlineCode"><span class="koboSpan" id="kobo.960.1">awk</span></code><span class="koboSpan" id="kobo.961.1"> in shell scripts. </span><span class="koboSpan" id="kobo.961.2">Let’s summarize and move on.</span></p>
    <h1 id="_idParaDest-312" class="heading 1"><span class="koboSpan" id="kobo.962.1">Summary</span></h1>
    <p class="normal"><span class="koboSpan" id="kobo.963.1">In this chapter, I introduced you to the sacred mysteries of using </span><code class="inlineCode"><span class="koboSpan" id="kobo.964.1">awk</span></code><span class="koboSpan" id="kobo.965.1">. </span><span class="koboSpan" id="kobo.965.2">We started by looking at the numerous implementations of </span><code class="inlineCode"><span class="koboSpan" id="kobo.966.1">awk</span></code><span class="koboSpan" id="kobo.967.1">, and at how a basic </span><code class="inlineCode"><span class="koboSpan" id="kobo.968.1">awk</span></code><span class="koboSpan" id="kobo.969.1"> command is constructed. </span><span class="koboSpan" id="kobo.969.2">Next, we saw how to use </span><code class="inlineCode"><span class="koboSpan" id="kobo.970.1">awk</span></code><span class="koboSpan" id="kobo.971.1"> to process information either from a text file or from another program. </span><span class="koboSpan" id="kobo.971.2">Then, we saw how to run </span><code class="inlineCode"><span class="koboSpan" id="kobo.972.1">awk</span></code><span class="koboSpan" id="kobo.973.1"> commands from within a normal shell script. </span><span class="koboSpan" id="kobo.973.2">Finally, we turned an </span><code class="inlineCode"><span class="koboSpan" id="kobo.974.1">awk</span></code><span class="koboSpan" id="kobo.975.1"> command into a function, and added it to our function library file.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.976.1">In the next chapter, we’ll look at how to create </span><code class="inlineCode"><span class="koboSpan" id="kobo.977.1">awk</span></code><span class="koboSpan" id="kobo.978.1"> program scripts. </span><span class="koboSpan" id="kobo.978.2">I’ll see you there.</span></p>
    <h1 id="_idParaDest-313" class="heading 1"><span class="koboSpan" id="kobo.979.1">Questions</span></h1>
    <ol>
      <li class="numberedList" value="1"><span class="koboSpan" id="kobo.980.1">What are the two parts of an </span><code class="inlineCode"><span class="koboSpan" id="kobo.981.1">awk</span></code><span class="koboSpan" id="kobo.982.1"> command? </span><span class="koboSpan" id="kobo.982.2">(Choose two.)</span><ol>
          <li class="alphabeticList level 2" value="1"><span class="koboSpan" id="kobo.983.1">action</span></li>
          <li class="alphabeticList level 2"><span class="koboSpan" id="kobo.984.1">expression</span></li>
          <li class="alphabeticList level 2"><span class="koboSpan" id="kobo.985.1">pattern</span></li>
          <li class="alphabeticList level 2"><span class="koboSpan" id="kobo.986.1">command</span></li>
          <li class="alphabeticList level 2"><span class="koboSpan" id="kobo.987.1">E. </span><span class="koboSpan" id="kobo.987.2">order</span></li>
        </ol>
      </li>
      <li class="numberedList"><span class="koboSpan" id="kobo.988.1">What does </span><code class="inlineCode"><span class="koboSpan" id="kobo.989.1">{print $0}</span></code><span class="koboSpan" id="kobo.990.1"> do in an </span><code class="inlineCode"><span class="koboSpan" id="kobo.991.1">awk</span></code><span class="koboSpan" id="kobo.992.1"> command?</span><ol>
          <li class="alphabeticList level 2" value="1"><span class="koboSpan" id="kobo.993.1">It prints the name of the script that you’re running, because </span><code class="inlineCode"><span class="koboSpan" id="kobo.994.1">$0</span></code><span class="koboSpan" id="kobo.995.1"> is the bash positional parameter that hold the name of the script.</span></li>
          <li class="alphabeticList level 2"><span class="koboSpan" id="kobo.996.1">It prints the value that was assigned to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.997.1">0</span></code><span class="koboSpan" id="kobo.998.1"> variable.</span></li>
          <li class="alphabeticList level 2"><span class="koboSpan" id="kobo.999.1">It prints all fields of a record.</span></li>
          <li class="alphabeticList level 2"><span class="koboSpan" id="kobo.1000.1">It’s an invalid command that doesn’t do anything.</span></li>
        </ol>
      </li>
      <li class="numberedList"><span class="koboSpan" id="kobo.1001.1">You want to perform an exact, whole-word match for all lines that contain a certain text string. </span><span class="koboSpan" id="kobo.1001.2">Which of the following </span><code class="inlineCode"><span class="koboSpan" id="kobo.1002.1">awk</span></code><span class="koboSpan" id="kobo.1003.1"> operators would you use?</span><ol>
          <li class="alphabeticList level 2" value="1"><code class="inlineCode"><span class="koboSpan" id="kobo.1004.1">==</span></code></li>
          <li class="alphabeticList level 2"><code class="inlineCode"><span class="koboSpan" id="kobo.1005.1">=</span></code></li>
          <li class="alphabeticList level 2"><code class="inlineCode"><span class="koboSpan" id="kobo.1006.1">eq</span></code></li>
          <li class="alphabeticList level 2"><code class="inlineCode"><span class="koboSpan" id="kobo.1007.1">~</span></code></li>
        </ol>
      </li>
      <li class="numberedList"><span class="koboSpan" id="kobo.1008.1">Where is the best place to define values for </span><code class="inlineCode"><span class="koboSpan" id="kobo.1009.1">FS</span></code><span class="koboSpan" id="kobo.1010.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1011.1">OFS</span></code><span class="koboSpan" id="kobo.1012.1">?</span><ol>
          <li class="alphabeticList level 2" value="1"><span class="koboSpan" id="kobo.1013.1">In the END section of an </span><code class="inlineCode"><span class="koboSpan" id="kobo.1014.1">awk</span></code><span class="koboSpan" id="kobo.1015.1"> command.</span></li>
          <li class="alphabeticList level 2"><span class="koboSpan" id="kobo.1016.1">You can’t. </span><span class="koboSpan" id="kobo.1016.2">They already have pre-defined values.</span></li>
          <li class="alphabeticList level 2"><span class="koboSpan" id="kobo.1017.1">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1018.1">BEGIN</span></code><span class="koboSpan" id="kobo.1019.1"> section of an </span><code class="inlineCode"><span class="koboSpan" id="kobo.1020.1">awk</span></code><span class="koboSpan" id="kobo.1021.1"> command.</span></li>
          <li class="alphabeticList level 2"><span class="koboSpan" id="kobo.1022.1"> In the action of an </span><code class="inlineCode"><span class="koboSpan" id="kobo.1023.1">awk</span></code><span class="koboSpan" id="kobo.1024.1"> command.</span></li>
        </ol>
      </li>
      <li class="numberedList"><span class="koboSpan" id="kobo.1025.1">How do you use regular expressions with </span><code class="inlineCode"><span class="koboSpan" id="kobo.1026.1">awk</span></code><span class="koboSpan" id="kobo.1027.1">?</span><ol>
          <li class="alphabeticList level 2" value="1"><span class="koboSpan" id="kobo.1028.1">Surround the regular expression with a pair of forward slashes.</span></li>
          <li class="alphabeticList level 2"><span class="koboSpan" id="kobo.1029.1">Surround the regular expression with a pair of single quotes.</span></li>
          <li class="alphabeticList level 2"><span class="koboSpan" id="kobo.1030.1">Surround the regular expression with a pair of double quotes.</span></li>
          <li class="alphabeticList level 2"><span class="koboSpan" id="kobo.1031.1">Don’t surround the regular expression with anything.</span></li>
        </ol>
      </li>
    </ol>
    <h1 id="_idParaDest-314" class="heading 1"><span class="koboSpan" id="kobo.1032.1">Further Reading</span></h1>
    <ul>
      <li class="bulletList"><span class="koboSpan" id="kobo.1033.1">The GNU awk Users’ Guide: </span><a href="https://www.gnu.org/software/gawk/manual/gawk.html"><span class="url"><span class="koboSpan" id="kobo.1034.1">https://www.gnu.org/software/gawk/manual/gawk.html</span></span></a></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.1035.1">Awk by Example: </span><a href="https://developer.ibm.com/tutorials/l-awk1/"><span class="url"><span class="koboSpan" id="kobo.1036.1">https://developer.ibm.com/tutorials/l-awk1/</span></span></a></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.1037.1">awklang.org--The site for things related to the awk language: </span><a href="http://www.awklang.org/"><span class="url"><span class="koboSpan" id="kobo.1038.1">http://www.awklang.org/</span></span></a></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.1039.1">awk: One True awk: </span><a href="https://github.com/onetrueawk/awk"><span class="url"><span class="koboSpan" id="kobo.1040.1">https://github.com/onetrueawk/awk</span></span></a></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.1041.1">Awk Scripts YouTube channel: </span><a href="mailto:https://www.youtube.com/@awkscripts"><span class="url"><span class="koboSpan" id="kobo.1042.1">https://www.youtube.com/@awkscripts</span></span></a></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.1043.1">Miller Documentation: </span><a href="https://miller.readthedocs.io/en/latest/"><span class="url"><span class="koboSpan" id="kobo.1044.1">https://miller.readthedocs.io/en/latest/</span></span></a></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.1045.1">The GAWK Manual-Useful “One-liners”: </span><a href="http://web.mit.edu/gnu/doc/html/gawk_7.html"><span class="url"><span class="koboSpan" id="kobo.1046.1">http://web.mit.edu/gnu/doc/html/gawk_7.html</span></span></a></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.1047.1">How to Use awk in Bash Scripting: </span><a href="https://www.cyberciti.biz/faq/bash-scripting-using-awk/"><span class="url"><span class="koboSpan" id="kobo.1048.1">https://www.cyberciti.biz/faq/bash-scripting-using-awk/</span></span></a></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.1049.1">Advanced Bash Shell Scripting Guide-Shell Wrappers: </span><a href="https://www.linuxtopia.org/online_books/advanced_bash_scripting_guide/wrapper.html"><span class="url"><span class="koboSpan" id="kobo.1050.1">https://www.linuxtopia.org/online_books/advanced_bash_scripting_guide/wrapper.html</span></span></a></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.1051.1">Awk: The Power and Promise of a 40-year-old Language: </span><a href="https://www.fosslife.org/awk-power-and-promise-40-year-old-language"><span class="url"><span class="koboSpan" id="kobo.1052.1">https://www.fosslife.org/awk-power-and-promise-40-year-old-language</span></span></a></li>
    </ul>
    <h1 id="_idParaDest-315" class="heading 1"><span class="koboSpan" id="kobo.1053.1">Answers</span></h1>
    <ol>
      <li class="numberedList" value="1"><span class="koboSpan" id="kobo.1054.1">a and c</span></li>
      <li class="numberedList"><span class="koboSpan" id="kobo.1055.1">c</span></li>
      <li class="numberedList"><span class="koboSpan" id="kobo.1056.1">a</span></li>
      <li class="numberedList"><span class="koboSpan" id="kobo.1057.1">c</span></li>
      <li class="numberedList"><span class="koboSpan" id="kobo.1058.1">a</span></li>
    </ol>
    <h1 id="_idParaDest-316" class="heading 1"><span class="koboSpan" id="kobo.1059.1">Join our community on Discord!</span></h1>
    <p class="normal"><span class="koboSpan" id="kobo.1060.1">Read this book alongside other users, Linux experts, and the author himself. </span></p>
    <p class="normal"><span class="koboSpan" id="kobo.1061.1">Ask questions, provide solutions to other readers, chat with the author via Ask Me Anything sessions, and much more. </span><span class="koboSpan" id="kobo.1061.2">Scan the QR code or visit the link to join the community.</span></p>
    <p class="normal"><a href="https://packt.link/SecNet"><span class="url"><span class="koboSpan" id="kobo.1062.1">https://packt.link/SecNet</span></span></a></p>
    <p class="normal"><span class="koboSpan" id="kobo.1063.1"><img src="../Images/QR_Code10596186092701843.png" alt=""/></span></p>
<h1 id="_idParaDest-4" class="heading 1"><span class="koboSpan" id="kobo.1064.1">Leave a Review!</span></h1>
    <p class="normal"><span class="koboSpan" id="kobo.1065.1">Thank you for purchasing this book from Packt Publishing—we hope you enjoy it! </span><span class="koboSpan" id="kobo.1065.2">Your feedback is invaluable and helps us improve and grow. </span><span class="koboSpan" id="kobo.1065.3">Once you've completed reading it, please take a moment to leave an Amazon review; it will only take a minute, but it makes a big difference for readers like you.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.1066.1">Scan the QR code below to receive a free ebook of your choice.</span></p>
    <p class="normal"><a href="https://packt.link/NzOWQ"><span class="url"><span class="koboSpan" id="kobo.1067.1">https://packt.link/NzOWQ</span></span></a></p>
    <p class="normal"><span class="koboSpan" id="kobo.1068.1"><img src="../Images/review.png" alt=""/></span></p>
  </div>
</body></html>