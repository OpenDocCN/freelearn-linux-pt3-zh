<html><head></head><body>
<div class="_idGenObjectStyleOverride-1" id="_idContainer197">
<p class="Chapter-Title" id="_idParaDest-93" lang="en-US"><span class="ChapterMarker"><span class="koboSpan" id="kobo.1.1">10. </span></span><a id="_idTextAnchor188"/><span class="koboSpan" id="kobo.2.1">Managing Ubuntu 23.04 systemd Units</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.3.1">To gain proficiency in Ubuntu system administration, it is essential to understand the concepts of systemd units with a particular emphasis on two specific types known as targets and services. </span><span class="koboSpan" id="kobo.3.2">This chapter provides a basic overview of the different systemd units supported by Ubuntu and how to configure the many services that run in the background of a running Linux system.</span></p>
<p class="Heading-1-1" id="_idParaDest-94" lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.4.1">10.1 </span></span><a id="_idTextAnchor189"/><span class="koboSpan" id="kobo.5.1">Understanding Ubuntu </span><a id="_idIndexMarker181"/><a id="_idIndexMarker182"/><span class="koboSpan" id="kobo.6.1">systemd Targets</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.7.1">Ubuntu can be configured to boot into one of several states (referred to as targets), each designed to provide a specific level of operating system functionality. </span><span class="koboSpan" id="kobo.7.2">The system administrator configures the target to which a system will boot by default based on the purpose for which the system is being used. </span><span class="koboSpan" id="kobo.7.3">A desktop system, for example, will likely be configured to boot using the graphical user interface target. </span><span class="koboSpan" id="kobo.7.4">In contrast, a cloud-based server system would be more likely to boot to the multi-user target level.</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.8.1">During the boot sequence, a process named </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.9.1">systemd</span></span><span class="koboSpan" id="kobo.10.1"> looks in the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.11.1">/etc/systemd/system</span></span><span class="koboSpan" id="kobo.12.1"> folder to find the default target setting. </span><span class="koboSpan" id="kobo.12.2">Having identified the default target, it proceeds to start the systemd units associated with that target so that the system boots with all the necessary processes running.</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.13.1">For those familiar with older Ubuntu versions, systemd targets replace the older runlevel system.</span></p>
<p class="Heading-1-1" id="_idParaDest-95" lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.14.1">10.2 </span></span><a id="_idTextAnchor190"/><span class="koboSpan" id="kobo.15.1">Understanding Ubuntu </span><a id="_idIndexMarker183"/><span class="koboSpan" id="kobo.16.1">systemd Services</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.17.1">A service is a process, typically running in the background, that provides specific functionality. </span><span class="koboSpan" id="kobo.17.2">The sshd service, for example, is the background process (also referred to as a </span><a id="_idIndexMarker184"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.18.1">daemon</span></span><span class="koboSpan" id="kobo.19.1">) that provides secure shell access to the system. </span><span class="koboSpan" id="kobo.19.2">Different systemd targets are configured to automatically launch different collections of services, depending on the functionality to be provided by that target.</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.20.1">Targets and services are types of systemd unit, a topic that will be covered later in this chapter.</span></p>
<p class="Heading-1-1" id="_idParaDest-96" lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.21.1">10.3 </span></span><a id="_idTextAnchor191"/><span class="koboSpan" id="kobo.22.1">Ubuntu systemd Target Descriptions</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.23.1">As previously outlined, Ubuntu can be booted into one of several target levels. </span><span class="koboSpan" id="kobo.23.2">The default target to which the system is configured to boot will, in turn, dictate which systemd units are started. </span><span class="koboSpan" id="kobo.23.3">The targets that relate specifically to system startup and shutdown can be summarized as follows:</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.24.1">• </span><a id="_idIndexMarker185"/><span class="My-Bold _idGenCharOverride-1"><span class="koboSpan" id="kobo.25.1">poweroff.target</span></span><span class="koboSpan" id="kobo.26.1"> - This target shuts down the system. </span><span class="koboSpan" id="kobo.26.2">It is unlikely you would want this as your default target.</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.27.1">• </span><a id="_idIndexMarker186"/><span class="My-Bold _idGenCharOverride-1"><span class="koboSpan" id="kobo.28.1">rescue.target</span></span><span class="koboSpan" id="kobo.29.1"> – Causes the system to start in a single-user mode under which only the root user can log in. </span><span class="koboSpan" id="kobo.29.2">The system does not start any networking, graphical user interface, or multi-user services in this mode. </span><span class="koboSpan" id="kobo.29.3">This run level is ideal for system administrators to perform system maintenance or repair activities.</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.30.1">• </span><a id="_idIndexMarker187"/><span class="My-Bold _idGenCharOverride-1"><span class="koboSpan" id="kobo.31.1">multi-user.target</span></span><span class="koboSpan" id="kobo.32.1"> - Boots the system into a multi-user mode with text-based console login capability.</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.33.1">• </span><a id="_idIndexMarker188"/><span class="My-Bold _idGenCharOverride-1"><span class="koboSpan" id="kobo.34.1">graphical.target</span></span><span class="koboSpan" id="kobo.35.1"> - Boots the system into a networked, multi-user state with X Window System capability. </span><span class="koboSpan" id="kobo.35.2">By default, the graphical desktop environment will start at the end of the boot process. </span><span class="koboSpan" id="kobo.35.3">This is the most common run level for desktop or workstation use.</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.36.1">• </span><a id="_idIndexMarker189"/><span class="My-Bold _idGenCharOverride-1"><span class="koboSpan" id="kobo.37.1">reboot.target</span></span><span class="koboSpan" id="kobo.38.1"> - Reboots the system. </span><span class="koboSpan" id="kobo.38.2">Another target that, for obvious reasons, you are unlikely to want as your default.</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.39.1">In addition to the above targets, the system includes about 70 other targets, many of which are sub-targets used by the above main targets. </span><span class="koboSpan" id="kobo.39.2">Behind the scenes, for example, </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.40.1">multi-user.target </span></span><span class="koboSpan" id="kobo.41.1">will also start a target named </span><a id="_idIndexMarker190"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.42.1">basic.target</span></span><span class="koboSpan" id="kobo.43.1"> which will, in turn, start the </span><a id="_idIndexMarker191"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.44.1">sockets.target</span></span><span class="koboSpan" id="kobo.45.1"> unit, which is required for communication between different processes. </span><span class="koboSpan" id="kobo.45.2">This ensures that all the services on which the multi-user target depends are also started during the boot process.</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.46.1">A list of the targets and services on which a specified target is dependent can be viewed by running the following command in a terminal window:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.47.1"># systemctl list-dependencies &lt;target&gt;</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.48.1">Figure 11-1, for example, shows a partial listing of the systemd unit dependencies for the graphical target (the complete listing contains over 140 targets and services required for a fully functional multi-user system):</span></p>
<p class="My-Basic-Paragraph ParaOverride-1" lang="en-US"><span class="koboSpan" id="kobo.49.1"><img alt="" class="_idGenObjectAttribute-1" src="image/ubuntu_systemd_dependencies.jpg"/></span></p>
<p class="Figure-Caption" lang="en-US"><span class="FigureCaptionMarker"><span class="koboSpan" id="kobo.50.1">Figure 10-1</span></span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.51.1">The listing is presented as a hierarchical tree illustrating how some dependencies have sub-dependencies of their own. </span><span class="koboSpan" id="kobo.51.2">Scrolling to the bottom of the list, for example, would reveal that the graphical target depends on a cloud-related service called </span><span class="My-Italic CharOverride-1"><span class="koboSpan" id="kobo.52.1">cloud-init.target</span></span><span class="koboSpan" id="kobo.53.1">, which, in turn, has its own service dependencies:</span></p>
<p class="My-Basic-Paragraph ParaOverride-1" lang="en-US"><span class="koboSpan" id="kobo.54.1"><img alt="" class="_idGenObjectAttribute-2" src="image/ubuntu_systemd_subdependencies.jpg"/></span></p>
<p class="Figure-Caption" lang="en-US"><span class="FigureCaptionMarker"><span class="koboSpan" id="kobo.55.1">Figure 10-2</span></span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.56.1">The colored dots to the left of each entry in the list indicate the current status of that service or target as follows:</span></p>
<p class="Bullet-List" lang="en-US"><span class="_idGenBNMarker-4"><span class="koboSpan" id="kobo.57.1">•</span></span><span class="My-Bold _idGenCharOverride-1"><span class="koboSpan" id="kobo.58.1">Green</span></span><span class="koboSpan" id="kobo.59.1"> - The service or target is active and running.</span></p>
<p class="Bullet-List" lang="en-US"><span class="_idGenBNMarker-4"><span class="koboSpan" id="kobo.60.1">•</span></span><span class="My-Bold _idGenCharOverride-1"><span class="koboSpan" id="kobo.61.1">White</span></span><span class="koboSpan" id="kobo.62.1"> - The service or target is inactive (dead). </span><span class="koboSpan" id="kobo.62.2">Typically because the service or target has yet to be enabled, has been stopped for some reason, or a condition on which the service or target depends has not been met.</span></p>
<p class="Bullet-List" lang="en-US"><span class="_idGenBNMarker-4"><span class="koboSpan" id="kobo.63.1">•</span></span><span class="My-Bold _idGenCharOverride-1"><span class="koboSpan" id="kobo.64.1">Red</span></span><span class="koboSpan" id="kobo.65.1"> - The service or target failed to start due to a fatal error.</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.66.1">To find out more details about the status of a systemd unit, use the </span><a id="_idIndexMarker194"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.67.1">systemctl status</span></span><span class="koboSpan" id="kobo.68.1"> command followed by the unit name as follows:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.69.1"># systemctl status systemd-machine-id-commit.service</span></p>
<p class="Code"><span class="koboSpan" id="kobo.70.1">○ systemd-machine-id-commit.service - Commit a transient machine-id on disk</span></p>
<p class="Code"><span class="koboSpan" id="kobo.71.1">     Loaded: loaded (/usr/lib/systemd/system/systemd-machine-id-commit.service; static)</span></p>
<p class="Code"><span class="koboSpan" id="kobo.72.1">     Active: inactive (dead)</span></p>
<p class="Code"><span class="koboSpan" id="kobo.73.1">  Condition: start condition failed at Thu 2023-03-30 08:41:05 EDT; 16min ago</span></p>
<p class="Code"><span class="koboSpan" id="kobo.74.1">             └─ ConditionPathIsMountPoint=/etc/machine-id was not met</span></p>
<p class="Code"><span class="koboSpan" id="kobo.75.1">       Docs: man:systemd-machine-id-commit.service(8)</span></p>
<p class="Heading-1-1" id="_idParaDest-97" lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.76.1">10.4 </span></span><a id="_idTextAnchor192"/><span class="koboSpan" id="kobo.77.1">Identifying and Configuring the Default Target</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.78.1">The current default target for an Ubuntu system can be identified using the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.79.1">systemctl</span></span><span class="koboSpan" id="kobo.80.1"> command as follows:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.81.1"># systemctl get-default</span></p>
<p class="Code"><span class="koboSpan" id="kobo.82.1">multi-user.target</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.83.1">In the above case, the system is configured to boot using the multi-user target by default. </span><span class="koboSpan" id="kobo.83.2">The default setting can be changed anytime using the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.84.1">systemctl</span></span><span class="koboSpan" id="kobo.85.1"> command with the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.86.1">set-default</span></span><span class="koboSpan" id="kobo.87.1"> option. </span><span class="koboSpan" id="kobo.87.2">The following example changes the default target to start the graphical user interface the next time the system boots:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.88.1"># systemctl set-default graphical.target</span></p>
<p class="Code"><span class="koboSpan" id="kobo.89.1">Removed /etc/systemd/system/default.target.</span></p>
<p class="Code"><span class="koboSpan" id="kobo.90.1">Created symlink /etc/systemd/system/default.target → /lib/systemd/system/graphical.target.</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.91.1">The output from the default change operation reveals the steps performed in the background by the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.92.1">systemctl</span></span><span class="koboSpan" id="kobo.93.1"> command to implement the change. </span><span class="koboSpan" id="kobo.93.2">The current default is configured by establishing a symbolic link from the </span><a id="_idIndexMarker195"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.94.1">default.target</span></span><span class="koboSpan" id="kobo.95.1"> file located in </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.96.1">/etc/systemd/system</span></span><span class="koboSpan" id="kobo.97.1"> to point to the corresponding target file located in the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.98.1">/usr/lib/systemd/system</span></span><span class="koboSpan" id="kobo.99.1"> folder (in this case the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.100.1">graphical.target</span></span><span class="koboSpan" id="kobo.101.1"> file).</span></p>
<p class="Heading-1-1" id="_idParaDest-98" lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.102.1">10.5 </span></span><a id="_idTextAnchor193"/><span class="koboSpan" id="kobo.103.1">Understanding </span><a id="_idIndexMarker196"/><a id="_idIndexMarker197"/><span class="koboSpan" id="kobo.104.1">systemd Units and Unit Types</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.105.1">As previously mentioned, targets and services are both types of systemd unit. </span><span class="koboSpan" id="kobo.105.2">All the files within the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.106.1">/usr/lib/systemd/system</span></span><span class="koboSpan" id="kobo.107.1"> folder are called systemd unit configuration files, each representing a systemd unit. </span><span class="koboSpan" id="kobo.107.2">Each unit is, in turn, categorized as being of a particular unit type. </span><span class="koboSpan" id="kobo.107.3">Ubuntu supports 12 different unit types, including the target and service unit types already covered in this chapter. </span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.108.1">The type of a unit file is represented by the filename extension as outlined in </span><a href="Systemd_Targets_and_States.xhtml#_idTextAnchor194"><span class="koboSpan" id="kobo.109.1">Table 10-1</span></a><span class="koboSpan" id="kobo.110.1"> below: </span></p>
<table class="Basic-Table TableOverride-1" id="table001-1">
<colgroup>
<col/>
<col/>
<col/>
</colgroup>
<tbody>
<tr class="Basic-Table _idGenTableRowColumn-1">
<td class="Basic-Table">
<p class="My-Basic-Paragraph" lang="en-US"><span class="My-Bold _idGenCharOverride-1"><span class="koboSpan" id="kobo.111.1">Unit Type</span></span></p>
</td>
<td class="Basic-Table">
<p class="My-Basic-Paragraph" lang="en-US"><span class="My-Bold _idGenCharOverride-1"><span class="koboSpan" id="kobo.112.1">Filename Extension</span></span></p>
</td>
<td class="Basic-Table">
<p class="My-Basic-Paragraph" lang="en-US"><span class="My-Bold _idGenCharOverride-1"><span class="koboSpan" id="kobo.113.1">Type Description</span></span></p>
</td>
</tr>
<tr class="Basic-Table">
<td class="Basic-Table">
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.114.1">Service</span></p>
</td>
<td class="Basic-Table">
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.115.1">.service</span></p>
</td>
<td class="Basic-Table">
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.116.1">System service.</span></p>
</td>
</tr>
<tr class="Basic-Table _idGenTableRowColumn-1">
<td class="Basic-Table">
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.117.1">Target</span></p>
</td>
<td class="Basic-Table">
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.118.1">.target</span></p>
</td>
<td class="Basic-Table">
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.119.1">Group of systemd units.</span></p>
</td>
</tr>
<tr class="Basic-Table">
<td class="Basic-Table">
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.120.1">Automount</span></p>
</td>
<td class="Basic-Table">
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.121.1">.automount</span></p>
</td>
<td class="Basic-Table">
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.122.1">File system auto-mount point.</span></p>
</td>
</tr>
<tr class="Basic-Table _idGenTableRowColumn-1">
<td class="Basic-Table">
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.123.1">Device</span></p>
</td>
<td class="Basic-Table">
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.124.1">.device</span></p>
</td>
<td class="Basic-Table">
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.125.1">Device file recognized by the kernel.</span></p>
</td>
</tr>
<tr class="Basic-Table">
<td class="Basic-Table">
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.126.1">Mount</span></p>
</td>
<td class="Basic-Table">
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.127.1">.mount</span></p>
</td>
<td class="Basic-Table">
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.128.1">File system mount point.</span></p>
</td>
</tr>
<tr class="Basic-Table _idGenTableRowColumn-1">
<td class="Basic-Table">
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.129.1">Path</span></p>
</td>
<td class="Basic-Table">
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.130.1">.path</span></p>
</td>
<td class="Basic-Table">
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.131.1">File or directory in a file system.</span></p>
</td>
</tr>
<tr class="Basic-Table">
<td class="Basic-Table">
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.132.1">Scope</span></p>
</td>
<td class="Basic-Table">
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.133.1">.scope</span></p>
</td>
<td class="Basic-Table">
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.134.1">Externally created process.</span></p>
</td>
</tr>
<tr class="Basic-Table _idGenTableRowColumn-1">
<td class="Basic-Table">
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.135.1">Slice</span></p>
</td>
<td class="Basic-Table">
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.136.1">.slice</span></p>
</td>
<td class="Basic-Table">
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.137.1">Group of hierarchically organized units that manage system processes.</span></p>
</td>
</tr>
<tr class="Basic-Table">
<td class="Basic-Table">
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.138.1">Snapshot</span></p>
</td>
<td class="Basic-Table">
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.139.1">.snapshot</span></p>
</td>
<td class="Basic-Table">
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.140.1">Saved state of the systemd manager.</span></p>
</td>
</tr>
<tr class="Basic-Table _idGenTableRowColumn-1">
<td class="Basic-Table">
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.141.1">Socket</span></p>
</td>
<td class="Basic-Table">
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.142.1">.socket</span></p>
</td>
<td class="Basic-Table">
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.143.1">Inter-process communication socket.</span></p>
</td>
</tr>
<tr class="Basic-Table">
<td class="Basic-Table">
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.144.1">Swap</span></p>
</td>
<td class="Basic-Table">
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.145.1">.swap</span></p>
</td>
<td class="Basic-Table">
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.146.1">Swap device or a swap file.</span></p>
</td>
</tr>
<tr class="Basic-Table _idGenTableRowColumn-1">
<td class="Basic-Table">
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.147.1">Timer</span></p>
</td>
<td class="Basic-Table">
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.148.1">.timer</span></p>
</td>
<td class="Basic-Table">
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.149.1">Systemd timer.</span></p>
</td>
</tr>
</tbody>
</table>
<p class="Table-Caption" lang="en-US"><span class="TableCaptionMarker"><span class="koboSpan" id="kobo.150.1">Table 10-1</span></span><a id="_idTextAnchor194"/></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.151.1">Note that the target unit type differs from other types in that it comprises a group of systemd units such as services or other targets. </span></p>
<p class="Heading-1-1" id="_idParaDest-99" lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.152.1">10.6 </span></span><a id="_idTextAnchor195"/><span class="koboSpan" id="kobo.153.1">Dynamically Changing the Current Target</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.154.1">The </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.155.1">systemctl set-default</span></span><span class="koboSpan" id="kobo.156.1"> command outlined previously specifies the target that will be used the next time the system starts but does not change the current system’s state. </span><span class="koboSpan" id="kobo.156.2">To change to a different target dynamically, use the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.157.1">systemctl</span></span><span class="koboSpan" id="kobo.158.1"> command again, using the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.159.1">isolate</span></span><span class="koboSpan" id="kobo.160.1"> option followed by the destination target. </span><span class="koboSpan" id="kobo.160.2">To switch the current system to the graphical target without rebooting, for example, the following command would be used:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.161.1"># systemctl isolate graphical.target</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.162.1">Once executed, the system will start the graphical desktop environment.</span></p>
<p class="Heading-1-1" id="_idParaDest-100" lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.163.1">10.7 </span></span><a id="_idTextAnchor196"/><span class="koboSpan" id="kobo.164.1">Enabling, Disabling, and Masking systemd Units</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.165.1">A newly installed Ubuntu system will include the base systemd service units but is unlikely to include all the services the system will eventually need once it goes into a production environment. </span><span class="koboSpan" id="kobo.165.2">A basic Ubuntu installation, for example, will typically not include the packages necessary to run an Apache web server, a key element of which is the </span><span class="My-Italic CharOverride-1"><span class="koboSpan" id="kobo.166.1">apache2.service</span></span><span class="koboSpan" id="kobo.167.1"> unit.</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.168.1">The system administrator will resolve this problem by installing the necessary apache2 packages using the following command:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.169.1"># apt install apache2</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.170.1">Having configured the web server, the next task will be to check the status of the apache2  service unit to identify whether it was activated as part of the installation process:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.171.1"># systemctl status apache2.service</span></p>
<p class="Code"><span class="koboSpan" id="kobo.172.1">● apache2.service - The Apache HTTP Server</span></p>
<p class="Code"><span class="koboSpan" id="kobo.173.1">     Loaded: loaded (/lib/systemd/system/apache2.service; disabled; vendor prese&gt;</span></p>
<p class="Code"><span class="koboSpan" id="kobo.174.1">     Active: active (running) since Mon 2023-07-17 14:01:13 UTC; 40s ago</span></p>
<p class="Code"><span class="koboSpan" id="kobo.175.1">       Docs: https://httpd.apache.org/docs/2.4/</span></p>
<p class="Code"><span class="koboSpan" id="kobo.176.1">   Main PID: 22328 (apache2)</span></p>
<p class="Code"><span class="koboSpan" id="kobo.177.1">      Tasks: 55 (limit: 4517)</span></p>
<p class="Code"><span class="koboSpan" id="kobo.178.1">     Memory: 4.7M</span></p>
<p class="Code"><span class="koboSpan" id="kobo.179.1">        CPU: 24ms</span></p>
<p class="Code"><span class="koboSpan" id="kobo.180.1">     CGroup: /system.slice/apache2.service</span></p>
<p class="Code"><span class="koboSpan" id="kobo.181.1">             ├─22328 /usr/sbin/apache2 -k start</span></p>
<p class="Code"><span class="koboSpan" id="kobo.182.1">             ├─22329 /usr/sbin/apache2 -k start</span></p>
<p class="Code"><span class="koboSpan" id="kobo.183.1">             └─22330 /usr/sbin/apache2 -k start</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.184.1">Note that the service status may be listed as loaded but inactive, which happens when it is preset by the vendor to be disabled when first installed. </span><span class="koboSpan" id="kobo.184.2">To start an inactive service, the following command can be used:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.185.1"># systemctl start apache2.service</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.186.1">In the above example output, the status indicates that the service is </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.187.1">disabled</span></span><span class="koboSpan" id="kobo.188.1">. </span><span class="koboSpan" id="kobo.188.2">This means that the next time the system reboots, the apache2 service will not start automatically and will need to be started manually by the system administrator.</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.189.1">To configure a service to start automatically each time the system starts, it must be enabled as follows:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.190.1"># systemctl enable apache2.service</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.191.1">A currently running service may be stopped at any time as follows:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.192.1"># systemctl stop apache2.service</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.193.1">Now that it has been enabled, the next time the system reboots to the current target, the apache2 service will start automatically. </span><span class="koboSpan" id="kobo.193.2">Assuming, for example, that the service was enabled while the system was running the multi-user target, the apache2 service will have been added as another dependency to the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.194.1">multi-user.target</span></span><span class="koboSpan" id="kobo.195.1"> systemd unit.</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.196.1">Behind the scenes, </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.197.1">systemctl</span></span><span class="koboSpan" id="kobo.198.1"> adds dependencies to targets by creating symbolic links in the </span><a id="_idIndexMarker198"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.199.1">.wants </span></span><span class="koboSpan" id="kobo.200.1">folder for the target within the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.201.1">/etc/systemd/system</span></span><span class="koboSpan" id="kobo.202.1"> folder. </span><span class="koboSpan" id="kobo.202.2">For example, the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.203.1">multi-user.target</span></span><span class="koboSpan" id="kobo.204.1"> unit has a folder named </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.205.1">multi-user.target.want</span></span><span class="koboSpan" id="kobo.206.1">s in </span><a id="_idIndexMarker199"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.207.1">/etc/systemd/system</span></span><span class="koboSpan" id="kobo.208.1"> containing symbolic links to all of the systemd units located in </span><a id="_idIndexMarker200"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.209.1">/usr/lib/systemd/system</span></span><span class="koboSpan" id="kobo.210.1"> on which it is dependent. </span><span class="koboSpan" id="kobo.210.2">A review of this folder will show a correlation with the dependencies listed by the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.211.1">systemctl list-dependencies </span></span><span class="koboSpan" id="kobo.212.1">command outlined earlier in the chapter.</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.213.1">To configure a service so that it no longer starts automatically as a target dependency, deactivate it as follows:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.214.1"># systemctl disable apache2.service</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.215.1">This command will remove the symbolic link to the </span><span class="My-Italic CharOverride-1"><span class="koboSpan" id="kobo.216.1">apache2.service</span></span><span class="koboSpan" id="kobo.217.1"> unit file from the .</span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.218.1">wants </span></span><span class="koboSpan" id="kobo.219.1">directory so that it is no longer a dependency and, as such, will not be started the next time the system boots.</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.220.1">The </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.221.1">.wants</span></span><span class="koboSpan" id="kobo.222.1"> folder contains dependencies that, if not available, will not prevent the unit from starting and functioning. </span><span class="koboSpan" id="kobo.222.2">Mandatory dependencies (in other words, dependencies that will cause the unit to fail if not available) should be placed in the</span><span class="My-Italic _idGenCharOverride-1"> </span><span class="My-Italic CharOverride-1"><a id="_idIndexMarker201"/></span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.223.1">.requires</span></span><span class="koboSpan" id="kobo.224.1"> folder (for example, </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.225.1">multi-user.target.requires</span></span><span class="koboSpan" id="kobo.226.1">).</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.227.1">In addition to enabling and disabling, it is also possible to mask a systemd unit as follows:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.228.1"># systemctl mask apache2.service</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.229.1">A masked systemd unit cannot be enabled, disabled, or started under any circumstances, even if it is listed as a dependency for another unit. </span><span class="koboSpan" id="kobo.229.2">As far as the system is concerned, it is as though a masked systemd unit no longer exists. </span><span class="koboSpan" id="kobo.229.3">This can be useful for ensuring that a unit is never started, regardless of the system conditions. </span><span class="koboSpan" id="kobo.229.4">The only way to regain access to the service is to unmask it:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.230.1"># systemctl unmask apache2.service</span></p>
<p class="Heading-1-1" id="_idParaDest-101" lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.231.1">10.8 </span></span><a id="_idTextAnchor197"/><span class="koboSpan" id="kobo.232.1">Working with </span><a id="_idIndexMarker202"/><span class="koboSpan" id="kobo.233.1">systemd Units in Cockpit</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.234.1">In addition to the command-line techniques outlined in this chapter, it is also possible to review and manage systemd units from within the </span><a id="_idIndexMarker203"/><a id="_idIndexMarker204"/><span class="koboSpan" id="kobo.235.1">Cockpit web-based interface. </span><span class="koboSpan" id="kobo.235.2">For example, assuming that Cockpit has been installed and set up as outlined in the chapter entitled </span><a href=""><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.236.1">“An Overview of the  Cockpit Web Interface”</span></span></a><span class="koboSpan" id="kobo.237.1">, access to the list of systemd units on the system can be accessed by logging into Cockpit and selecting the Services option in the left-hand navigation panel marked A in </span><a href="Systemd_Targets_and_States.xhtml#_idTextAnchor198"><span class="koboSpan" id="kobo.238.1">Figure 10-3</span></a><span class="koboSpan" id="kobo.239.1">:</span></p>
<p class="My-Basic-Paragraph ParaOverride-1" lang="en-US"><span class="koboSpan" id="kobo.240.1"><img alt="" class="_idGenObjectAttribute-3" src="image/ubuntu_cockpit_services.jpg"/></span></p>
<p class="Figure-Caption" lang="en-US"><span class="FigureCaptionMarker"><span class="koboSpan" id="kobo.241.1">Figure 10-3</span></span><a id="_idTextAnchor198"/></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.242.1">The row of options marked B displays units of specific types in the main area marked C, where the current status of each unit is listed in the State column.</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.243.1">Selecting a unit from the list will display detailed information. </span><a href="Systemd_Targets_and_States.xhtml#_idTextAnchor199"><span class="koboSpan" id="kobo.244.1">Figure 10-4</span></a><span class="koboSpan" id="kobo.245.1">, for example, shows the detail screen for an apache2 instance, including service logs (A) and a switch and menu (B) for performing tasks such as starting, stopping, enabling/disabling, and masking/unmasking the unit: </span></p>
<p class="My-Basic-Paragraph ParaOverride-1" lang="en-US"><span class="koboSpan" id="kobo.246.1"><img alt="" class="_idGenObjectAttribute-4" src="image/ubuntu_cockpit_apache_service.jpg"/></span></p>
<p class="Figure-Caption" lang="en-US"><span class="FigureCaptionMarker"><span class="koboSpan" id="kobo.247.1">Figure 10-4</span></span><a id="_idTextAnchor199"/></p>
<p class="Heading-1-1" id="_idParaDest-102" lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.248.1">10.9 </span></span><a id="_idTextAnchor200"/><span class="koboSpan" id="kobo.249.1">Summary</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.250.1">A newly installed Ubuntu system includes a base set of systemd units, many of which run in the background to provide much of the system’s functionality. </span><span class="koboSpan" id="kobo.250.2">These units are categorized by type, the most common being targets and services. </span><span class="koboSpan" id="kobo.250.3">A target unit is a group of other units to be started collectively. </span><span class="koboSpan" id="kobo.250.4">The system has a default target unit that defines the other units to be started up each time the system boots. </span><span class="koboSpan" id="kobo.250.5">The most common targets are those which boot the system to either multi-user or graphical mode. </span><span class="koboSpan" id="kobo.250.6">In addition, the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.251.1">systemctl</span></span><span class="koboSpan" id="kobo.252.1"> command-line tool provides a range of options for performing systemd unit configuration tasks, many of which are also available through the Cockpit web-based interface.</span></p>
</div>
</body></html>