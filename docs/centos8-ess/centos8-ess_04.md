5. 为 CentOS 8 分配 Windows 磁盘分区

在上一章中，我们学习了如何在与 Windows 相同的磁盘上安装 CentOS 8。这种所谓的“双重启动”配置允许用户将两个操作系统安装在同一个磁盘驱动器上，并在系统启动时选择启动其中一个。

本章面向那些已经决定彻底删除磁盘上的 Windows，并将剩余空间用于 Linux 的 CentOS 8 用户。在接下来的部分中，我们将一步步地完成这个过程。

5.1 卸载 Windows 分区

如果已经按照 “在 CentOS 8 上与 Windows 双重启动” 章节中的步骤挂载了 Windows 分区，继续本章之前应该先卸载该分区。假设 Windows 分区挂载在 /mnt/windows，以下命令可以卸载它：

# 第五章：umount /mnt/windows

/etc/fstab 文件也应该被编辑，以删除先前添加的 /mnt/windows 自动挂载项（如果有的话）。

5.2 从磁盘删除 Windows 分区

将 Windows 分区释放出来供 CentOS 使用的第一步是删除该分区。然而，在执行此操作之前，务必确保从 Windows 和 CentOS 分区中备份好所有需要保留的数据。完成备份后，便可以安全地继续进行本章操作。

为了删除 Windows 分区，我们首先需要使用 fdisk 工具识别包含这些分区的磁盘：

# fdisk -l

磁盘 /dev/sda: 50 GiB, 53687091200 字节, 104857600 扇区

单位：1 * 512 = 512 字节的扇区

扇区大小（逻辑/物理）：512 字节 / 512 字节

I/O 大小（最小/最佳）：512 字节 / 512 字节

磁盘标签类型：dos

磁盘标识符：0xe3673009

设备 启动 开始 结束 扇区 大小 Id 类型

/dev/sda1 * 2048 1126399 1124352 549M 7 HPFS/NTFS/exFAT

/dev/sda2 1126400 53655551 52529152 25G 7 HPFS/NTFS/exFAT

/dev/sda3 53655552 55752703 2097152 1G 83 Linux

/dev/sda4 55752704 104857599 49104896 23.4G 5 扩展

/dev/sda5 55754752 104857599 49102848 23.4G 8e Linux LVM

在上述示例输出中，系统包含一个物理磁盘驱动器，通过设备名称 /dev/sda 引用。在该磁盘驱动器上有五个分区，分别通过设备名称 /dev/sda1 至 /dev/sda5 访问。根据系统栏中的值，有两个 NTFS 分区。第一个是 Windows 系统分区，第二个是较大的 NTFS 启动分区，包含 Windows 操作系统和用户数据。

要删除分区，使用包含该分区的磁盘的设备名称（在此示例中为 /dev/sda）启动 fdisk 工具，并按照提示再次显示分区和扇区信息：

# fdisk /dev/sda

欢迎使用 fdisk（util-linux 2.32.1）。

变更将仅保留在内存中，直到你决定将其写入。

在使用写入命令之前请小心。

命令（输入 m 获取帮助）：p

磁盘 /dev/sda: 50 GiB, 53687091200 字节, 104857600 扇区

单位：1 个扇区 = 512 字节

扇区大小（逻辑/物理）：512 字节 / 512 字节

I/O 大小（最小/最佳）：512 字节 / 512 字节

磁盘标签类型：dos

磁盘标识符：0xe3673009

设备 启动 起始 结束 扇区 大小 ID 类型

/dev/sda1 * 2048 1126399 1124352 549M 7 HPFS/NTFS/exFAT

/dev/sda2 1126400 53655551 52529152 25G 7 HPFS/NTFS/exFAT

/dev/sda3 53655552 55752703 2097152 1G 83 Linux

/dev/sda4 55752704 104857599 49104896 23.4G 5 扩展分区

/dev/sda5 55754752 104857599 49102848 23.4G 8e Linux LVM

命令（输入 m 获取帮助）：

目前，Windows 系统分区被列为引导分区。由于我们将删除此分区，需要将 Linux 引导分区标记为可引导。上述配置中，这由 /dev/sda3 表示。在 fdisk 工具中，按如下步骤将其设置为可引导分区：

命令（输入 m 获取帮助）：a

分区号（1,3-5，默认 5）：3

分区 3 的引导标志已启用。

在继续之前，请记录下我们将删除的分区的起始和结束地址（也就是 /dev/sda1 的起始和 /dev/sda2 的结束地址）。

在命令提示符下，删除 Windows 分区（在我们的示例系统中是分区 1 和 2）：

命令（输入 m 获取帮助）：d

分区号（1-5，默认 5）：1

分区 1 已被删除。

命令（输入 m 获取帮助）：d

分区号（2-5，默认 5）：2

分区 2 已被删除。

现在我们已经删除了 Windows 分区，接下来需要在空闲的磁盘空间中创建新的 CentOS 分区。分区号必须与删除的分区号相同（在此例中为 1），并且将是一个主分区。还需要精确输入该分区的起始和结束扇区，正如原来分区所报告的那样（fdisk 通常会默认提供正确的值，但最好双重检查）。如果提示移除 NTFS 签名，请输入 Y：

命令（输入 m 获取帮助）：n

分区类型

p 主分区（1 主分区，1 扩展分区，2 空闲）

l 逻辑（从 5 开始编号）

选择（默认 p）：p

分区号（1,2，默认 1）：1

第一个扇区（2048-104857599，默认 2048）：

最后扇区，+扇区或 +大小{K,M,G,T,P}（2048-53655551，默认 53655551）：

创建了一个新的分区 1，类型为“Linux”，大小为 25.6 GiB。

分区 #1 包含 NTFS 签名。

是否移除签名？[Y]是/[N]否：y

签名将通过写入命令被移除。

做出这些更改后，下一步是检查设置是否正确（借此机会再次确认 Linux 引导分区是否可引导）：

命令（输入 m 获取帮助）：p

磁盘 /dev/sda: 50 GiB, 53687091200 字节, 104857600 扇区

单位：1 个扇区 = 512 字节

扇区大小（逻辑/物理）：512 字节 / 512 字节

I/O 大小（最小/最佳）：512 字节 / 512 字节

磁盘标签类型：dos

磁盘标识符：0xe3673009

设备 启动 起始 结束 扇区 大小 ID 类型

/dev/sda1 2048 53655551 53653504 25.6G 83 Linux

/dev/sda3 * 53655552 55752703 2097152 1G 83 Linux

/dev/sda4 55752704 104857599 49104896 23.4G 5 扩展分区

/dev/sda5 55754752 104857599 49102848 23.4G 8e Linux LVM

分区 1 上的文件系统/RAID 签名将被擦除。

要提交更改，现在需要将新分区信息写入磁盘并退出 fdisk 工具：

命令 (m 获取帮助)：w

分区表已被更改。

同步磁盘。

5.3 格式化未分配的磁盘分区

为了使新分区适用于 CentOS 8，必须在其上创建文件系统。目前 CentOS 版本的默认文件系统类型是 XFS，相关细节将在标题为 “向 CentOS 8 系统添加新磁盘驱动器” 的章节中详细讲解。文件系统的创建使用 mkfs.xfs 命令，具体如下：

# mkfs.xfs -f /dev/sda1

元数据=/dev/sda1 isize=512 agcount=4, agsize=1676672 blks

= sectsz=512 attr=2, projid32bit=1

= crc=1 finobt=1, sparse=1, rmapbt=0

= reflink=1

data = bsize=4096 blocks=6706688, imaxpct=25

= sunit=0 swidth=0 blks

naming =version 2 bsize=4096 ascii-ci=0, ftype=1

log =internal log bsize=4096 blocks=3274, version=2

= sectsz=512 sunit=0 blks, lazy-count=1

realtime =none extsz=4096 blocks=0, rtextents=0

5.4 挂载新分区

接下来，我们需要挂载新分区。在这个示例中，我们将其挂载到名为 /data 的目录中。您也可以根据需要使用任何有效的挂载点，或者将其作为逻辑卷的一部分进行使用（相关细节将在标题为 “向 CentOS 8 卷组和逻辑卷添加新磁盘” 的章节中详细介绍）。首先，我们需要创建一个目录作为挂载点：

# mkdir /data

其次，我们需要编辑 /etc/fstab 中的挂载表，以确保每次系统启动时分区都能自动挂载。在 /etc/fstab 文件的底部，添加以下行以挂载新分区（修改 /dev/sda1 设备以匹配您的环境）：

/dev/sda1 /data xfs 默认 0 0

最后，我们可以手动挂载新分区（请注意，在随后的重启中不再需要此操作，因为我们在 /etc/fstab 文件中添加的设置将使分区自动挂载）。

# mount /data

要检查分区，请运行以下命令以显示可用空间：

# df -h /data

文件系统 大小 已用 可用 使用% 挂载点

/dev/sda1 26G 215M 26G 1% /data

5.5 编辑启动菜单

下一步是修改 CentOS 启动菜单。由于这是一个原本的双重启动系统，菜单配置提供了启动 Windows 或 CentOS 的选项。现在 Windows 分区已被删除，我们需要移除这个启动选项。首先，编辑 /etc/grub.d/40_custom 文件并删除 Windows 菜单项：

#!/bin/sh

执行 tail -n +3 $0

# 该文件提供了一种简单的方式来添加自定义菜单项。只需键入

# 在此评论之后添加你想要的菜单项。注意不要修改

# 上面的 'exec tail' 行。

menuentry "Windows 10" {

set root=(hd0,1)

chainloader +1

}

保存文件并使用 grub2-mkconfig 工具生成 /boot/grub2/grub.cfg 文件，如下所示：

# grub2-mkconfig --output=/boot/grub2/grub.cfg

正在生成 grub 配置文件 ...

完成

下一次系统重启时，Windows 10 选项将不再出现在启动菜单中。

5.6 总结

在双系统配置中，Windows 分区可以随时被删除，以便为 CentOS 系统腾出空间，方法是识别属于 Windows 的分区，然后使用 fdisk 工具将其删除。删除后，未分配的空间可以用来创建新文件系统并挂载，以便 CentOS 系统使用。最后一步是从启动菜单配置中删除 Windows 选项。
