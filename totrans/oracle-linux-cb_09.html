<html><head></head><body>
<div id="_idContainer266">
<h1 class="chapter-number" id="_idParaDest-194"><a id="_idTextAnchor268"/><span class="koboSpan" id="kobo.1.1">9</span></h1>
<h1 id="_idParaDest-195"><a id="_idTextAnchor269"/><span class="koboSpan" id="kobo.2.1">Keeping the Data Safe – Securing a System</span></h1>
<p><span class="koboSpan" id="kobo.3.1">No one wants to be the headline news story, especially when their data is stolen. </span><span class="koboSpan" id="kobo.3.2">One of the best ways to help protect your data is to secure the operating system and its services. </span><span class="koboSpan" id="kobo.3.3">Securing is often compared to an onion, as there are multiple layers that are difficult to peel open, each providing some defense against bad actors. </span><span class="koboSpan" id="kobo.3.4">When bad actors attack your data, it’s not always to steal it; it’s often to change it as well. </span><span class="koboSpan" id="kobo.3.5">To make matters worse, when you move to the cloud, you will have to protect not only against internal threats, such as rogue contractors or employees, and external threats, such as hackers attacking the systems, but you also have to protect your data against your cloud provider as well. </span><span class="koboSpan" id="kobo.3.6">In security, you never know who is the </span><span class="No-Break"><span class="koboSpan" id="kobo.4.1">bad actor!</span></span></p>
<p><span class="koboSpan" id="kobo.5.1">It is not just protecting</span><a id="_idIndexMarker811"/><span class="koboSpan" id="kobo.6.1"> your systems against bad actors; many </span><a id="_idIndexMarker812"/><span class="koboSpan" id="kobo.7.1">industries also require a strong security stance. </span><span class="koboSpan" id="kobo.7.2">This is common with healthcare, which often requires security controls for compliance with the </span><strong class="bold"><span class="koboSpan" id="kobo.8.1">Health Insurance Portability and Accountability Act</span></strong><span class="koboSpan" id="kobo.9.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.10.1">HIPAA</span></strong><span class="koboSpan" id="kobo.11.1">). </span><span class="koboSpan" id="kobo.11.2">Businesses that process credit cards must meet the </span><strong class="bold"><span class="koboSpan" id="kobo.12.1">Payment Card Industry Data Security Standard</span></strong><span class="koboSpan" id="kobo.13.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.14.1">PCI-DSS</span></strong><span class="koboSpan" id="kobo.15.1">) principles, and many governmental organizations</span><a id="_idIndexMarker813"/><span class="koboSpan" id="kobo.16.1"> must implement security standards to be compliant with the </span><strong class="bold"><span class="koboSpan" id="kobo.17.1">Federal Risk and Authorization Management Program</span></strong><span class="koboSpan" id="kobo.18.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.19.1">FedRAMP</span></strong><span class="koboSpan" id="kobo.20.1">) for their </span><span class="No-Break"><span class="koboSpan" id="kobo.21.1">cloud workloads.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.22.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.23.1">Security teams have their</span><a id="_idIndexMarker814"/><span class="koboSpan" id="kobo.24.1"> own language! </span><span class="koboSpan" id="kobo.24.2">The term “bad actors” refers to hackers — the folks</span><a id="_idIndexMarker815"/><span class="koboSpan" id="kobo.25.1"> trying to modify or steal the data. </span><span class="koboSpan" id="kobo.25.2">They do this by attacking the systems against attack surfaces, basic system components, and services that are reachable by the </span><span class="No-Break"><span class="koboSpan" id="kobo.26.1">bad g</span><a id="_idTextAnchor270"/><span class="koboSpan" id="kobo.27.1">uys.</span></span></p>
<p><span class="koboSpan" id="kobo.28.1">When you secure systems, you must cover more than just one attack surface. </span><span class="koboSpan" id="kobo.28.2">These attack surfaces can be data at rest, data in motion, services such as HTTP, or even the Linux kernel. </span><span class="koboSpan" id="kobo.28.3">You also need to use tools that can help identify how the system is configured to best protect the data. </span><span class="koboSpan" id="kobo.28.4">In this chapter, the goal is to give you several recipes to help you identify risks and protect </span><span class="No-Break"><span class="koboSpan" id="kobo.29.1">your data.</span></span></p>
<p><span class="koboSpan" id="kobo.30.1">We will cover the following main rec</span><a id="_idTextAnchor271"/><span class="koboSpan" id="kobo.31.1">ipes in </span><span class="No-Break"><span class="koboSpan" id="kobo.32.1">this chapter:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.33.1">Signing Git commits </span><span class="No-Break"><span class="koboSpan" id="kobo.34.1">with GPG</span></span></li>
<li><span class="koboSpan" id="kobo.35.1">Encrypting all </span><span class="No-Break"><span class="koboSpan" id="kobo.36.1">web traffic</span></span></li>
<li><span class="koboSpan" id="kobo.37.1">Encrypting all data </span><span class="No-Break"><span class="koboSpan" id="kobo.38.1">at rest</span></span></li>
<li><span class="koboSpan" id="kobo.39.1">Validating adherence to a </span><span class="No-Break"><span class="koboSpan" id="kobo.40.1">compliance policy</span></span></li>
<li><span class="koboSpan" id="kobo.41.1">Port protection and restricting </span><span class="No-Break"><span class="koboSpan" id="kobo.42.1">network access</span></span></li>
<li><span class="koboSpan" id="kobo.43.1">Keeping </span><span class="No-Break"><span class="koboSpan" id="kobo.44.1">SELinux active</span></span></li>
</ul>
<h1 id="_idParaDest-196"><a id="_idTextAnchor272"/><span class="koboSpan" id="kobo.45.1">Technical requirements</span></h1>
<p><span class="koboSpan" id="kobo.46.1">For this recipe, you will need an Oracle Linux 8 system. </span><span class="koboSpan" id="kobo.46.2">As with most of these recipes, a VM on your desktop using a desktop virtualization product such as Oracle VirtualBox is recommended. </span><span class="koboSpan" id="kobo.46.3">A small VM with 2 cores, 2 GB RAM, and a few free gigabytes of disk space is fine. </span><span class="koboSpan" id="kobo.46.4">Ideally, before you start, you should update your system to the latest packages available. </span><span class="koboSpan" id="kobo.46.5">This only takes a few minutes and can save you a ton of time when troubleshooting issues caused by </span><span class="No-Break"><span class="koboSpan" id="kobo.47.1">a bug.</span></span></p>
<p><span class="koboSpan" id="kobo.48.1">Many of the recipes in this book have their related configuration files available in GitHub </span><span class="No-Break"><span class="koboSpan" id="kobo.49.1">at </span></span><a href="https://github.com/PacktPublishing/Oracle-Linux-Cookbook"><span class="No-Break"><span class="koboSpan" id="kobo.50.1">https://github.com/PacktPublishing/Oracle-Linux-Cookbook</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.51.1">.</span></span></p>
<h1 id="_idParaDest-197"><a id="_idTextAnchor273"/><span class="koboSpan" id="kobo.52.1">Signing Git commits with GPG</span></h1>
<p><span class="koboSpan" id="kobo.53.1">This recipe will show you how to digitally</span><a id="_idIndexMarker816"/><span class="koboSpan" id="kobo.54.1"> sign Git commits</span><a id="_idIndexMarker817"/><span class="koboSpan" id="kobo.55.1"> and RPM packages using a </span><strong class="bold"><span class="koboSpan" id="kobo.56.1">GNU Privacy Guard</span></strong><span class="koboSpan" id="kobo.57.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.58.1">GPG</span></strong><span class="koboSpan" id="kobo.59.1">) keypair. </span><span class="koboSpan" id="kobo.59.2">A GPG keypair consists of two</span><a id="_idIndexMarker818"/><span class="koboSpan" id="kobo.60.1"> parts: the public key and the </span><span class="No-Break"><span class="koboSpan" id="kobo.61.1">private key.</span></span></p>
<p><span class="koboSpan" id="kobo.62.1">This is done by creating a GPG keypair and using it to sign Git commits and </span><span class="No-Break"><span class="koboSpan" id="kobo.63.1">RPM packages.</span></span></p>
<h2 id="_idParaDest-198"><a id="_idTextAnchor274"/><span class="koboSpan" id="kobo.64.1">Getting ready</span></h2>
<p><span class="koboSpan" id="kobo.65.1">In order to work with GPG </span><a id="_idIndexMarker819"/><span class="koboSpan" id="kobo.66.1">and Git, you first need to install a few</span><a id="_idIndexMarker820"/><span class="koboSpan" id="kobo.67.1"> packages. </span><span class="koboSpan" id="kobo.67.2">Normally GPG is installed by default when the package </span><strong class="source-inline"><span class="koboSpan" id="kobo.68.1">gnupg2</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.69.1">is installed.</span></span></p>
<p><span class="koboSpan" id="kobo.70.1">Git should be installed using </span><strong class="source-inline"><span class="koboSpan" id="kobo.71.1">dnf install </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.72.1">git -y</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.73.1">.</span></span></p>
<h2 id="_idParaDest-199"><a id="_idTextAnchor275"/><span class="koboSpan" id="kobo.74.1">How to do it…</span></h2>
<p><span class="koboSpan" id="kobo.75.1">The first step is to create a GPG key if you do not already have one. </span><span class="koboSpan" id="kobo.75.2">This key will be used to sign both your Git commits and RPM packages. </span><span class="koboSpan" id="kobo.75.3">To work with the GPG key, you can use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.76.1">gpg</span></strong><span class="koboSpan" id="kobo.77.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.78.1">gpg2</span></strong><span class="koboSpan" id="kobo.79.1"> commands; both are the same thing, as </span><strong class="source-inline"><span class="koboSpan" id="kobo.80.1">gpg</span></strong><span class="koboSpan" id="kobo.81.1"> links </span><span class="No-Break"><span class="koboSpan" id="kobo.82.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.83.1">gpg2</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.84.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.85.1">The GPG key is created via the </span><span class="No-Break"><span class="koboSpan" id="kobo.86.1">command line:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.87.1">
[erik@ol8 ~]$ gpg2 --gen-key</span></pre> <p><span class="koboSpan" id="kobo.88.1">The command will ask for some information, mainly your real name and email address. </span><span class="koboSpan" id="kobo.88.2">After you enter the information and continue, it will ask you to set a passphrase to use the key. </span><span class="koboSpan" id="kobo.88.3">Do not forget the passphrase! </span><span class="koboSpan" id="kobo.88.4">If you do, the key will become unusable and you will lose all data encrypted with the key. </span><span class="koboSpan" id="kobo.88.5">You can choose not to use a passphrase, but if you do this, you will be asked to verify this several times. </span><span class="koboSpan" id="kobo.88.6">The output of the key creation should be similar to the </span><span class="No-Break"><span class="koboSpan" id="kobo.89.1">following screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer249">
<span class="koboSpan" id="kobo.90.1"><img alt="Figure 9.1 – GPG keys created" src="image/B18349_09_01.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.91.1">Figure 9.1 – GPG keys created</span></p>
<p><span class="koboSpan" id="kobo.92.1">Optionally, you can use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.93.1">--full-generate-key</span></strong><span class="koboSpan" id="kobo.94.1"> option, which can be used to create keys stored on hardware devices, among </span><span class="No-Break"><span class="koboSpan" id="kobo.95.1">other uses.</span></span></p>
<p><span class="koboSpan" id="kobo.96.1">Once the key</span><a id="_idIndexMarker821"/><span class="koboSpan" id="kobo.97.1"> is created, it is pu</span><a id="_idTextAnchor276"/><span class="koboSpan" id="kobo.98.1">t in your</span><a id="_idIndexMarker822"/><span class="koboSpan" id="kobo.99.1"> keyring, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.100.1">pubring.kbx</span></strong><span class="koboSpan" id="kobo.101.1"> file in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.102.1">.gnupg</span></strong><span class="koboSpan" id="kobo.103.1"> directory in your home directory. </span><span class="koboSpan" id="kobo.103.2">To see all the keys in the file, run the </span><strong class="source-inline"><span class="koboSpan" id="kobo.104.1">gpg2 --list-keys --</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.105.1">keyid-format=long</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.106.1"> command.</span></span></p>
<p><span class="koboSpan" id="kobo.107.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.108.1">gpg --list-secret-keys</span></strong><span class="koboSpan" id="kobo.109.1"> command is used to list the secret keys (i.e., private keys) stored in your GPG keyring. </span><span class="koboSpan" id="kobo.109.2">Running the command will show output similar to the following figure for </span><span class="No-Break"><span class="koboSpan" id="kobo.110.1">GPG keys:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer250">
<span class="koboSpan" id="kobo.111.1"><img alt="Figure 9.2 – GPG keys" src="image/B18349_09_02.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.112.1">Figure 9.2 – GPG keys</span></p>
<p><span class="koboSpan" id="kobo.113.1">The output gives several columns</span><a id="_idIndexMarker823"/><span class="koboSpan" id="kobo.114.1"> of information for </span><span class="No-Break"><span class="koboSpan" id="kobo.115.1">each</span></span><span class="No-Break"><a id="_idIndexMarker824"/></span><span class="No-Break"><span class="koboSpan" id="kobo.116.1"> key:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.117.1">sec</span></strong><span class="koboSpan" id="kobo.118.1">: This column indicates that the key is a </span><a id="_idTextAnchor277"/><span class="No-Break"><span class="koboSpan" id="kobo.119.1">secret key.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.120.1">rsa2048/4096/...</span></strong><span class="koboSpan" id="kobo.121.1">: This column shows the algorithm and key length used by the key. </span><span class="koboSpan" id="kobo.121.2">For example, </span><strong class="source-inline"><span class="koboSpan" id="kobo.122.1">rsa2048</span></strong><span class="koboSpan" id="kobo.123.1"> indicates that the key uses the RSA algorithm with a key length of 2,048 bits. </span><span class="koboSpan" id="kobo.123.2">If the long format is used, this will also contain the key fingerprint after the </span><span class="No-Break"><span class="koboSpan" id="kobo.124.1">key length.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.125.1">[creation date]</span></strong><span class="koboSpan" id="kobo.126.1">: This column shows the date on which the key </span><span class="No-Break"><span class="koboSpan" id="kobo.127.1">was created.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.128.1">[expiration date]</span></strong><span class="koboSpan" id="kobo.129.1">: If the key has an expiration date set, it will be shown in this column. </span><span class="koboSpan" id="kobo.129.2">If not, this column will </span><span class="No-Break"><span class="koboSpan" id="kobo.130.1">be empty.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.131.1">[uid]</span></strong><span class="koboSpan" id="kobo.132.1">: This column shows the user ID associated with the key. </span><span class="koboSpan" id="kobo.132.2">This is usually the name and email address of the </span><span class="No-Break"><span class="koboSpan" id="kobo.133.1">key’s owner.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.134.1">[ssb]</span></strong><span class="koboSpan" id="kobo.135.1">: This column indicates that the key has a corresponding subkey (i.e., a separate key used for encryption, signing, </span><span class="No-Break"><span class="koboSpan" id="kobo.136.1">or authentication).</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.137.1">[expires]</span></strong><span class="koboSpan" id="kobo.138.1">: If the subkey has an expiration date set, it will be shown in this column. </span><span class="koboSpan" id="kobo.138.2">If not, this column will </span><span class="No-Break"><span class="koboSpan" id="kobo.139.1">be empty.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.140.1">The key fingerprint is a shortened digital representation of the key. </span><span class="koboSpan" id="kobo.140.2">It allows other people to validate that your public key was s</span><a id="_idTextAnchor278"/><span class="koboSpan" id="kobo.141.1">ent with no tampering. </span><span class="koboSpan" id="kobo.141.2">The long key ID format for the GPG command is a 16-character hexadecimal string that uniquely identifies a public or private key in GPG. </span><span class="koboSpan" id="kobo.141.3">It is often used to refer to a specific key when working </span><span class="No-Break"><span class="koboSpan" id="kobo.142.1">with GPG.</span></span></p>
<p><span class="koboSpan" id="kobo.143.1">The long key ID is derived</span><a id="_idIndexMarker825"/><span class="koboSpan" id="kobo.144.1"> from the full 40-character fingerprint</span><a id="_idIndexMarker826"/><span class="koboSpan" id="kobo.145.1"> of the key. </span><span class="koboSpan" id="kobo.145.2">The fingerprint is a cryptographic hash of the key’s public key material, and it is used to verify the authenticity of the key. </span><span class="koboSpan" id="kobo.145.3">The long key ID is the last 16 characters of </span><span class="No-Break"><span class="koboSpan" id="kobo.146.1">the fingerprint.</span></span></p>
<p><span class="koboSpan" id="kobo.147.1">Now that you have a key, we need to import it into Git. </span><span class="koboSpan" id="kobo.147.2">In the following example, we will use the key </span><strong class="source-inline"><span class="koboSpan" id="kobo.148.1">E921BF9E922221B6</span></strong><span class="koboSpan" id="kobo.149.1">. </span><span class="koboSpan" id="kobo.149.2">To import the key, we will use the </span><span class="No-Break"><span class="koboSpan" id="kobo.150.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.151.1">
git config --global user.signingkey E921BF9E922221B6</span></pre> <p><span class="koboSpan" id="kobo.152.1">Then, we can set Git to sign all commits by default using the </span><span class="No-Break"><span class="koboSpan" id="kobo.153.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.154.1">
git config --global commit.gpgsign true</span></pre> <h2 id="_idParaDest-200"><a id="_idTextAnchor279"/><span class="koboSpan" id="kobo.155.1">How it works…</span></h2>
<p><span class="koboSpan" id="kobo.156.1">Git can sign both commits</span><a id="_idIndexMarker827"/><span class="koboSpan" id="kobo.157.1"> and tags using the GPG key. </span><span class="koboSpan" id="kobo.157.2">Be careful with Git though, as it isn’t consistent. </span><strong class="source-inline"><span class="koboSpan" id="kobo.158.1">git tag</span></strong><span class="koboSpan" id="kobo.159.1"> uses </span><strong class="source-inline"><span class="koboSpan" id="kobo.160.1">-s</span></strong><span class="koboSpan" id="kobo.161.1"> to sign tags, but </span><strong class="source-inline"><span class="koboSpan" id="kobo.162.1">git commit</span></strong><span class="koboSpan" id="kobo.163.1"> uses </span><strong class="source-inline"><span class="koboSpan" id="kobo.164.1">-s</span></strong><span class="koboSpan" id="kobo.165.1"> to add the </span><strong class="bold"><span class="koboSpan" id="kobo.166.1">developers certificate of origin</span></strong><span class="koboSpan" id="kobo.167.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.168.1">DCO</span></strong><span class="koboSpan" id="kobo.169.1">) signed-off line to the commit text and </span><strong class="source-inline"><span class="koboSpan" id="kobo.170.1">-S</span></strong><span class="koboSpan" id="kobo.171.1"> actually signs the commit </span><span class="No-Break"><span class="koboSpan" id="kobo.172.1">using GPG.</span></span></p>
<p><span class="koboSpan" id="kobo.173.1">To set up a new tag, we will use the Git tag </span><strong class="source-inline"><span class="koboSpan" id="kobo.174.1">-s $TAG -</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.175.1">m $TAG_DESCRIPTION</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.176.1">:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.177.1">
$ git tag -s v1.0 -m 'Version 1.0 tag'
You need a passphrase to unlock the secret key for
user: "Erik Benner &lt;erik@talesfromthedatacenter.com&gt;"
2048-bit RSA key, ID 922221B6, created 2024-04-01</span></pre> <p class="callout-heading"><span class="koboSpan" id="kobo.178.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.179.1">You can also set </span><strong class="source-inline"><span class="koboSpan" id="kobo.180.1">tag.gpgsign</span></strong><span class="koboSpan" id="kobo.181.1"> either globally or per-repo to ensure all tags are </span><span class="No-Break"><span class="koboSpan" id="kobo.182.1">automatically signed.</span></span></p>
<p><span class="koboSpan" id="kobo.183.1">Next, we can</span><a id="_idIndexMarker828"/><span class="koboSpan" id="kobo.184.1"> show the tag</span><a id="_idIndexMarker829"/><span class="koboSpan" id="kobo.185.1"> with </span><strong class="source-inline"><span class="koboSpan" id="kobo.186.1">git </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.187.1">show v1.0</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.188.1">:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.189.1">
$ git show v1.0
tag v1.0
Tagger: Erik Benner &lt;erik@talesformthedatacenter.com &gt;
Date:   Sun April 2 215:24:41 2023 -2300
Version 1.0 tag
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1
JHGSksdhj847yskKJHSnd874tlKJAHGS32674GJHSAD784ghsjkd7*&amp;^ADDXGFdgj3kjj hde018GDKjskhdh8737ybdhajkjkjhsadfs7892987812mmxnbcbsd8JASJ74845jfhHA SHDepkjahZXkjs83828732ZMKDjh92yaskjagZKDSJHGHHD&amp;=7213kj4ha,,jhsad10al qpdif9839928hdkask
=EFTF
-----END PGP SIGNATURE-----
commit 7fhs49185hflvmsgd742825hhabzb182ufnc8
Author: Erik Benner &lt;erik@talesformthedatcenter.com&gt;
Date:   Sun Apr 2 12:52:11 2023 -2300
    Change version number</span></pre> <p><span class="koboSpan" id="kobo.190.1">After this, when we check code using Git, add a </span><strong class="source-inline"><span class="koboSpan" id="kobo.191.1">-S</span></strong><span class="koboSpan" id="kobo.192.1"> option to the command to automatically sign</span><a id="_idIndexMarker830"/><span class="koboSpan" id="kobo.193.1"> the commit with </span><a id="_idIndexMarker831"/><span class="No-Break"><span class="koboSpan" id="kobo.194.1">the tag:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.195.1">
git comit -a -S -m "comment goes here"</span></pre> <p class="callout-heading"><span class="koboSpan" id="kobo.196.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.197.1">This is not needed if </span><strong class="source-inline"><span class="koboSpan" id="kobo.198.1">commit.gpgsign=true</span></strong><span class="koboSpan" id="kobo.199.1"> is set either globally or in the active </span><span class="No-Break"><span class="koboSpan" id="kobo.200.1">Git repo.</span></span></p>
<h1 id="_idParaDest-201"><a id="_idTextAnchor280"/><span class="koboSpan" id="kobo.201.1">Encrypting all web traffic</span></h1>
<p><span class="koboSpan" id="kobo.202.1">It’s important to encrypt the communication to and from your web servers. </span><span class="koboSpan" id="kobo.202.2">Even a simple blog or company website with no login has several advantages</span><a id="_idIndexMarker832"/><span class="koboSpan" id="kobo.203.1"> of </span><span class="No-Break"><span class="koboSpan" id="kobo.204.1">being encrypted:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.205.1">Maintaining user trust</span></strong><span class="koboSpan" id="kobo.206.1">: Encrypting your web pages with HTTPS helps establish trust between your website and your users. </span><span class="koboSpan" id="kobo.206.2">When a user sees the padlock icon in their web browser indicating that the connection is secure, they can be more confident that their data is being transmitted securely. </span><span class="koboSpan" id="kobo.206.3">Browsers will show sites that are not encrypted. </span><span class="koboSpan" id="kobo.206.4">Chrome and Edge browsers will show text as </span><em class="italic"><span class="koboSpan" id="kobo.207.1">not secure</span></em><span class="koboSpan" id="kobo.208.1"> next to the URL or as Mozilla’s red </span><span class="No-Break"><span class="koboSpan" id="kobo.209.1">slashed padlock.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.210.1">SEO benefits</span></strong><span class="koboSpan" id="kobo.211.1">: Google has stated that HTTPS is a ranking factor in their search algorithm. </span><span class="koboSpan" id="kobo.211.2">This means that websites that use HTTPS may rank higher in search results than those that </span><span class="No-Break"><span class="koboSpan" id="kobo.212.1">do not.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.213.1">Browser warnings</span></strong><span class="koboSpan" id="kobo.214.1">: Modern web browsers such as Chrome and Firefox now display warning messages when a user visits a non-HTTPS website that collects sensitive information. </span><span class="koboSpan" id="kobo.214.2">This can discourage users from using your website and negatively impact </span><span class="No-Break"><span class="koboSpan" id="kobo.215.1">your business.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.216.1">Compliance</span></strong><span class="koboSpan" id="kobo.217.1">: If your website is subject to certain regulations or standards, such as PCI DSS or HIPAA, encrypting your web pages with HTTPS may be required to comply</span><a id="_idIndexMarker833"/><span class="koboSpan" id="kobo.218.1"> with </span><span class="No-Break"><span class="koboSpan" id="kobo.219.1">those regulations.</span></span></li>
</ul>
<p class="callout-heading"><span class="koboSpan" id="kobo.220.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.221.1">While SSL</span><a id="_idIndexMarker834"/><span class="koboSpan" id="kobo.222.1"> is a term that is commonly used, modern systems actually use </span><strong class="bold"><span class="koboSpan" id="kobo.223.1">Transport Layer Security</span></strong><span class="koboSpan" id="kobo.224.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.225.1">TLS</span></strong><span class="koboSpan" id="kobo.226.1">) as the encryption technology. </span><span class="koboSpan" id="kobo.226.2">SSL, being an older technology, has some security flaws, which is why TLS was developed as an upgraded version of SSL. </span><span class="koboSpan" id="kobo.226.3">TLS addresses the existing vulnerabilities of SSL, making it a much </span><span class="No-Break"><span class="koboSpan" id="kobo.227.1">safer option.</span></span></p>
<p><span class="koboSpan" id="kobo.228.1">Overall, encrypting </span><a id="_idIndexMarker835"/><span class="koboSpan" id="kobo.229.1">web pages with HTTPS is important for protecting sensitive data, maintaining user trust, and complying with regulations and standards. </span><span class="koboSpan" id="kobo.229.2">It is also becoming increasingly important for SEO and avoiding browser warnings that may </span><a id="_idIndexMarker836"/><span class="koboSpan" id="kobo.230.1">negatively impact</span><a id="_idIndexMarker837"/><span class="koboSpan" id="kobo.231.1"> your website’s reputation. </span><span class="koboSpan" id="kobo.231.2">It’s also </span><a id="_idTextAnchor281"/><span class="koboSpan" id="kobo.232.1">easy to do and free with services such as Let’s Encrypt (</span><a href="https://letsencrypt.org/"><span class="koboSpan" id="kobo.233.1">https://letsencrypt.org/</span></a><span class="koboSpan" id="kobo.234.1">) and </span><span class="No-Break"><span class="koboSpan" id="kobo.235.1">ZeroSSL (</span></span><a href="https://zerossl.com/"><span class="No-Break"><span class="koboSpan" id="kobo.236.1">https://zerossl.com/</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.237.1">).</span></span></p>
<p><span class="koboSpan" id="kobo.238.1">Both Let’s Encrypt and ZeroSSL provide free security certificates, including SSL/TLS certificates, that are used to encrypt HTTP traffic. </span><span class="koboSpan" id="kobo.238.2">SSL/TLS certificates are used to encrypt web traffic, allowing for encrypted communication between web servers and web browsers. </span><span class="koboSpan" id="kobo.238.3">Let’s Encrypt was created to make it easier for website owners to obtain SSL/TLS certificates and enable HTTPS on their websites. </span><span class="koboSpan" id="kobo.238.4">Prior to Let’s Encrypt, obtaining SSL/TLS certificates was often a complicated and expensive process involving manual verification and payment to certificate authorities. </span><span class="koboSpan" id="kobo.238.5">Let’s Encrypt streamlines this process by automating the verification process and providing certificates </span><span class="No-Break"><span class="koboSpan" id="kobo.239.1">for free.</span></span></p>
<p><span class="koboSpan" id="kobo.240.1">Let’s Encrypt certificates </span><a id="_idIndexMarker838"/><span class="koboSpan" id="kobo.241.1">are trusted by all major web browsers and operating systems. </span><span class="koboSpan" id="kobo.241.2">They are issued for a period of 90 days and can be renewed automatically using an automated client software. </span><span class="koboSpan" id="kobo.241.3">Let’s Encrypt also provides an </span><strong class="bold"><span class="koboSpan" id="kobo.242.1">Automated Certificate Management Environment</span></strong><span class="koboSpan" id="kobo.243.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.244.1">ACME</span></strong><span class="koboSpan" id="kobo.245.1">) protocol that allows web servers to automate the process of obtaining, renewing, and </span><span class="No-Break"><span class="koboSpan" id="kobo.246.1">revoking certificates.</span></span></p>
<h2 id="_idParaDest-202"><a id="_idTextAnchor282"/><span class="koboSpan" id="kobo.247.1">Getting ready</span></h2>
<p><span class="koboSpan" id="kobo.248.1">For this example, you will need </span><a id="_idIndexMarker839"/><span class="koboSpan" id="kobo.249.1">a web server running Oracle Linux. </span><span class="koboSpan" id="kobo.249.2">The server needs to be accessible over the internet so that the Let’s Encrypt system can verify the URL. </span><span class="koboSpan" id="kobo.249.3">In this example, I will be using a VM on Oracle Cloud, using their free tier of service. </span><span class="koboSpan" id="kobo.249.4">This VM is running on an Arm-based CPU with 2 cores and 12 GB RAM. </span><span class="koboSpan" id="kobo.249.5">Both ports </span><strong class="source-inline"><span class="koboSpan" id="kobo.250.1">80</span></strong><span class="koboSpan" id="kobo.251.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.252.1">443</span></strong><span class="koboSpan" id="kobo.253.1"> are opened up to this server. </span><span class="koboSpan" id="kobo.253.2">This process works the same regardless of processor type or cloud. </span><span class="koboSpan" id="kobo.253.3">The system is running Oracle Linux 8 with the </span><span class="No-Break"><span class="koboSpan" id="kobo.254.1">latest patches.</span></span></p>
<h2 id="_idParaDest-203"><a id="_idTextAnchor283"/><span class="koboSpan" id="kobo.255.1">How to do it…</span></h2>
<p><span class="koboSpan" id="kobo.256.1">To do this, we need to do a </span><span class="No-Break"><span class="koboSpan" id="kobo.257.1">few things:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.258.1">Install Apache with </span><strong class="source-inline"><span class="koboSpan" id="kobo.259.1">mod_ssl</span></strong><span class="koboSpan" id="kobo.260.1"> and all </span><span class="No-Break"><span class="koboSpan" id="kobo.261.1">its requirements.</span></span></li>
<li><span class="koboSpan" id="kobo.262.1">Get </span><strong class="source-inline"><span class="koboSpan" id="kobo.263.1">acme.sh</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.264.1">from Git.</span></span></li>
<li><span class="koboSpan" id="kobo.265.1">Create a cert using the webroot mode. </span><span class="koboSpan" id="kobo.265.2">Webroot mode requires that the site is accessible from the internet on both ports </span><strong class="source-inline"><span class="koboSpan" id="kobo.266.1">80</span></strong><span class="koboSpan" id="kobo.267.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.268.1">443</span></strong><span class="koboSpan" id="kobo.269.1">. </span><span class="koboSpan" id="kobo.269.2">While it is easy to implement, there is another verification</span><a id="_idIndexMarker840"/><span class="koboSpan" id="kobo.270.1"> method using DNS. </span><span class="koboSpan" id="kobo.270.2">For more information about different challenge types, refer </span><span class="No-Break"><span class="koboSpan" id="kobo.271.1">to </span></span><a href="https://letsencrypt.org/docs/challenge-types/"><span class="No-Break"><span class="koboSpan" id="kobo.272.1">https://letsencrypt.org/docs/challenge-types/</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.273.1">.</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.274.1">Conduct testing.</span></span></li>
</ol>
<h3><span class="koboSpan" id="kobo.275.1">Installing Apache with mod_ssl and all its requirements</span></h3>
<ol>
<li value="1"><span class="koboSpan" id="kobo.276.1">So let’s get started</span><a id="_idIndexMarker841"/><span class="koboSpan" id="kobo.277.1"> as the root user. </span><span class="koboSpan" id="kobo.277.2">First, we need to add </span><span class="No-Break"><span class="koboSpan" id="kobo.278.1">some packages:</span></span><ul><li><strong class="source-inline"><span class="koboSpan" id="kobo.279.1">httpd</span></strong><span class="koboSpan" id="kobo.280.1"> – Apache </span><span class="No-Break"><span class="koboSpan" id="kobo.281.1">web server</span></span></li><li><strong class="source-inline"><span class="koboSpan" id="kobo.282.1">mod_ssl</span></strong><span class="koboSpan" id="kobo.283.1"> – enables SSL </span><span class="No-Break"><span class="koboSpan" id="kobo.284.1">on Apache</span></span></li></ul><p class="list-inset"><span class="koboSpan" id="kobo.285.1">You can do this with the </span><span class="No-Break"><span class="koboSpan" id="kobo.286.1">following command:</span></span></p><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.287.1">dnf install -y httpd mod_ssl</span></strong></pre></li> <li><span class="koboSpan" id="kobo.288.1">Next, let’s add both ports </span><strong class="source-inline"><span class="koboSpan" id="kobo.289.1">80</span></strong><span class="koboSpan" id="kobo.290.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.291.1">443</span></strong><span class="koboSpan" id="kobo.292.1"> to the firewall. </span><span class="koboSpan" id="kobo.292.2">This is done as the root with the </span><span class="No-Break"><span class="koboSpan" id="kobo.293.1">following commands:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.294.1">firewall-cmd --zone=public --permanent --add-service=http</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.295.1">firewall-cmd --zone=public --permanent --add-service=https</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.296.1">firewall-cmd --reload apache</span></strong></pre></li> <li><span class="koboSpan" id="kobo.297.1">Now, let’s set up</span><a id="_idIndexMarker842"/><span class="koboSpan" id="kobo.298.1"> a virtual server for </span><strong class="source-inline"><span class="koboSpan" id="kobo.299.1">ssltest.talesfromthedatacenter.com</span></strong><span class="koboSpan" id="kobo.300.1">. </span><span class="koboSpan" id="kobo.300.2">This way, we can later add the SSL certs just for this virtual server. </span><span class="koboSpan" id="kobo.300.3">As the root, let’s make a directory for th</span><a id="_idTextAnchor284"/><span class="koboSpan" id="kobo.301.1">e files and </span><strong class="source-inline"><span class="koboSpan" id="kobo.302.1">chown</span></strong><span class="koboSpan" id="kobo.303.1"> them to the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.304.1">apache</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.305.1"> user:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.306.1">mkdir -p /var/www/ssltest</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.307.1">chown apache:apache /var/www/ssltest</span></strong></pre></li> <li><span class="koboSpan" id="kobo.308.1">Next, we will add a config file </span><strong class="source-inline"><span class="koboSpan" id="kobo.309.1">ssltest.conf</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.310.1">in </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.311.1">/etc/httpd/conf.d</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.312.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.313.1">
&lt;VirtualHost *:80&gt;
    # Put this in /etc/httpd/conf.d/ssltest.conf
    Alias /.well-known/acme-challenge/ /var/www/ssltest/.well-known/acme-challenge/
    &lt;Directory "/var/www/ssltest/.well-known/acme-challenge/"&gt;
        Options None
        AllowOverride None
        ForceType text/plain
        RedirectMatch 404 "^(?!/\.well-known/acme-challenge/[\w-]{43}$)"
    &lt;/Directory&gt;
    RewriteEngine On
    RewriteCond %{REQUEST_URI} !^/.well-known/acme-challenge [NC]
    RewriteCond %{HTTPS} off
    RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]
&lt;/VirtualHost&gt;</span></pre></li> <li><span class="koboSpan" id="kobo.314.1">After you save the file, run an </span><strong class="source-inline"><span class="koboSpan" id="kobo.315.1">apachctl configtest</span></strong><span class="koboSpan" id="kobo.316.1">. </span><span class="koboSpan" id="kobo.316.2">It is good practice to always run this test when you modify the </span><span class="No-Break"><span class="koboSpan" id="kobo.317.1">config files.</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.318.1">apachectl configtest</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.319.1">Syntax OK</span></strong></pre></li> <li><span class="koboSpan" id="kobo.320.1">Next, let’s start Apache</span><a id="_idIndexMarker843"/><span class="koboSpan" id="kobo.321.1"> and make sure we can get to the default page. </span><span class="koboSpan" id="kobo.321.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.322.1">enable</span></strong><span class="koboSpan" id="kobo.323.1"> option will restart the web server when the system starts. </span><span class="koboSpan" id="kobo.323.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.324.1">--now</span></strong><span class="koboSpan" id="kobo.325.1"> option will start the </span><span class="No-Break"><span class="koboSpan" id="kobo.326.1">server now:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.327.1">systemctl enable --now httpd</span></strong></pre></li> <li><span class="koboSpan" id="kobo.328.1">Now, point your browser to the site on port </span><strong class="source-inline"><span class="koboSpan" id="kobo.329.1">80</span></strong><span class="koboSpan" id="kobo.330.1">. </span><span class="koboSpan" id="kobo.330.2">You should see the default Apache page. </span><span class="koboSpan" id="kobo.330.3">Notice, the </span><strong class="bold"><span class="koboSpan" id="kobo.331.1">Not secure</span></strong><span class="koboSpan" id="kobo.332.1"> flag in the upper-left corner! </span><span class="koboSpan" id="kobo.332.2">The site is </span><em class="italic"><span class="koboSpan" id="kobo.333.1">not</span></em> <span class="No-Break"><span class="koboSpan" id="kobo.334.1">using SSL:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer251">
<span class="koboSpan" id="kobo.335.1"><img alt="Figure 9.3 – Apache test page with no SSL" src="image/B18349_09_03.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.336.1">Figure 9.3 – Apache test page with no SSL</span></p>
<h3><span class="koboSpan" id="kobo.337.1">Getting acme.sh from Git</span></h3>
<p><span class="koboSpan" id="kobo.338.1">Now, we need</span><a id="_idIndexMarker844"/><span class="koboSpan" id="kobo.339.1"> to grab the </span><strong class="source-inline"><span class="koboSpan" id="kobo.340.1">acme.sh</span></strong><span class="koboSpan" id="kobo.341.1"> script </span><span class="No-Break"><span class="koboSpan" id="kobo.342.1">from Git:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.343.1">First, we need to install Git with the </span><span class="No-Break"><span class="koboSpan" id="kobo.344.1">following command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.345.1">dnf install -y git</span></strong></pre></li> <li><span class="koboSpan" id="kobo.346.1">Next, let’s make a directory </span><span class="No-Break"><span class="koboSpan" id="kobo.347.1">called </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.348.1">acme</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.349.1">:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.350.1">mkdir acme</span></strong></pre></li> <li><span class="koboSpan" id="kobo.351.1">Now, we can clone from the official Git site (</span><a href="https://github.com/acmesh-official/acme.sh"><span class="koboSpan" id="kobo.352.1">https://github.com/acmesh-official/acme.sh</span></a><span class="koboSpan" id="kobo.353.1">) with the </span><span class="No-Break"><span class="koboSpan" id="kobo.354.1">following command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.355.1">git clone https://github.com/acmesh-official/acme.sh.git</span></strong></pre></li> </ol>
<p><span class="koboSpan" id="kobo.356.1">And then run the installer, updating your direcotry and email address </span><span class="No-Break"><span class="koboSpan" id="kobo.357.1">as needed.</span></span></p>
<pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.358.1">/root/acme/acme.sh --install -m my@email.com</span></strong></pre> <h3><span class="koboSpan" id="kobo.359.1">Creating a cert using the webroot mode</span></h3>
<ol>
<li value="1"><span class="koboSpan" id="kobo.360.1">Next, let’s register</span><a id="_idIndexMarker845"/><span class="koboSpan" id="kobo.361.1"> for an account, passing an email address as </span><span class="No-Break"><span class="koboSpan" id="kobo.362.1">the variable:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.363.1">/root/acme/acme.sh/acme.sh --register-account -m erik@talesfromthedatacenter.com</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.364.1">[Sun Apr  2 22:02:01 GMT 2023] No EAB credentials found for ZeroSSL, let's get one</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.365.1">[Sun Apr  2 22:02:02 GMT 2023] Registering account: https://acme.zerossl.com/v2/DV90</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.366.1">[Sun Apr  2 22:02:03 GMT 2023] Registered</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.367.1">[Sun Apr  2 22:02:03 GMT 2023] ACCOUNT_THUMBPRINT='QPU6rxYiTHrRkweBPKtAhUqnflvlBSdl0Xu4N89JhyY'</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.368.1">Save the </span><strong class="source-inline"><span class="koboSpan" id="kobo.369.1">ACCOUNT_THUMBPRINT</span></strong><span class="koboSpan" id="kobo.370.1"> for future use. </span><span class="koboSpan" id="kobo.370.2">This is also saved </span><span class="No-Break"><span class="koboSpan" id="kobo.371.1">in </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.372.1">./ca/acme.zerossl.com/v2/DV90/ca.conf</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.373.1">.</span></span></p></li> <li><span class="koboSpan" id="kobo.374.1">Now, we can run the script, passing the URL and the </span><strong class="source-inline"><span class="koboSpan" id="kobo.375.1">apache</span></strong><span class="koboSpan" id="kobo.376.1"> home directory for </span><span class="No-Break"><span class="koboSpan" id="kobo.377.1">the site:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.378.1">./acme.sh --issue  -d ssltest.talesfromthedatacenter.com --log</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.379.1">The following figure shows the command running with the new certificate being installed by </span><span class="No-Break"><span class="koboSpan" id="kobo.380.1">the script.</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer252">
<span class="koboSpan" id="kobo.381.1"><img alt="Figure 9.4 – Certificate to be installed" src="image/B18349_09_04.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.382.1">Figure 9.4 – Certificate to be installed</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.383.1">The script will </span><span class="No-Break"><span class="koboSpan" id="kobo.384.1">restart</span></span><span class="No-Break"><a id="_idIndexMarker846"/></span><span class="No-Break"><span class="koboSpan" id="kobo.385.1"> Apache.</span></span></p>
<h3><span class="koboSpan" id="kobo.386.1">Testing</span></h3>
<ol>
<li value="1"><span class="koboSpan" id="kobo.387.1">You can now go to the site</span><a id="_idIndexMarker847"/><span class="koboSpan" id="kobo.388.1"> with an HTTPS. </span><span class="koboSpan" id="kobo.388.2">You will see a padlock in the left side of the address bar. </span><span class="koboSpan" id="kobo.388.3">The site is now secure. </span><span class="koboSpan" id="kobo.388.4">This is seen in the </span><span class="No-Break"><span class="koboSpan" id="kobo.389.1">following figure:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer253">
<span class="koboSpan" id="kobo.390.1"><img alt="Figure 9.5 – SSL keys installed" src="image/B18349_09_05.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.391.1">Figure 9.5 – SSL keys installed</span></p>
<h2 id="_idParaDest-204"><a id="_idTextAnchor285"/><span class="koboSpan" id="kobo.392.1">How it works…</span></h2>
<p><span class="koboSpan" id="kobo.393.1">The way this works is the </span><strong class="source-inline"><span class="koboSpan" id="kobo.394.1">acme.sh</span></strong><span class="koboSpan" id="kobo.395.1"> script generates</span><a id="_idIndexMarker848"/><span class="koboSpan" id="kobo.396.1"> a temporary key file and places it in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.397.1">.well-know/acme-challenge</span></strong><span class="koboSpan" id="kobo.398.1"> directory. </span><span class="koboSpan" id="kobo.398.2">The system then queries from the internet to the server to get the file. </span><span class="koboSpan" id="kobo.398.3">If it can get to the file, the test passes and new keys are issued. </span><span class="koboSpan" id="kobo.398.4">It is important to monitor this, as third-party security software or SELinux can impact your ability to get to the temporary </span><span class="No-Break"><span class="koboSpan" id="kobo.399.1">key file.</span></span></p>
<p><span class="koboSpan" id="kobo.400.1">Now that the certificate is set up, there is one task left to do to make this a refresh. </span><span class="koboSpan" id="kobo.400.2">You can easily have the system check daily for a new certificate by adding in the following cron job. </span><span class="koboSpan" id="kobo.400.3">As a note, you will need to adjust the location of the script based on where you installed it. </span><span class="koboSpan" id="kobo.400.4">In this case, it was installed </span><span class="No-Break"><span class="koboSpan" id="kobo.401.1">in </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.402.1">/home/acme/.acme.sh</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.403.1">:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.404.1">
0 0 * * * /home/acme/.acme.sh/acme.sh --cron --home /home/acme/.acme.sh &gt; /dev/null</span></pre> <p class="callout-heading"><span class="koboSpan" id="kobo.405.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.406.1">When using keys that automatically update, it is highly recommended to monitor your sites consistently for SSL errors. </span><span class="koboSpan" id="kobo.406.2">Ideally, you are checking for SSL errors once an hour just in case things break. </span><span class="koboSpan" id="kobo.406.3">Look in the web server’s SSL logs and also run a check with a tool such as wget or curl to verify that the site is running. </span><span class="koboSpan" id="kobo.406.4">Both wget and curl will fail with an error if the SSL key </span><span class="No-Break"><span class="koboSpan" id="kobo.407.1">is invalid.</span></span></p>
<h1 id="_idParaDest-205"><a id="_idTextAnchor286"/><span class="koboSpan" id="kobo.408.1">Encrypting all data at rest</span></h1>
<p><span class="koboSpan" id="kobo.409.1">Encrypting your data in motion</span><a id="_idIndexMarker849"/><span class="koboSpan" id="kobo.410.1"> is great, but you also need to encrypt the data at rest. </span><span class="koboSpan" id="kobo.410.2">This is especially important in the cloud, where you are sharing storage with many other users. </span><span class="koboSpan" id="kobo.410.3">While your cloud provider may offer automatic encryption, it is important to remember that if they can decrypt the data automatically, they also have access </span><a id="_idIndexMarker850"/><span class="koboSpan" id="kobo.411.1">to the keys. </span><span class="koboSpan" id="kobo.411.2">To truly protect your data, you need to encrypt the data with keys that your cloud does not have access to. </span><span class="koboSpan" id="kobo.411.3">This can be done easily with </span><strong class="bold"><span class="koboSpan" id="kobo.412.1">Linux Unified Key Setup</span></strong><span class="koboSpan" id="kobo.413.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.414.1">LUKS</span></strong><span class="koboSpan" id="kobo.415.1">). </span><span class="koboSpan" id="kobo.415.2">Large organizations will also want to use </span><strong class="bold"><span class="koboSpan" id="kobo.416.1">Clevis</span></strong><span class="koboSpan" id="kobo.417.1">, which enables the automatic decryption of data from keys</span><a id="_idIndexMarker851"/><span class="koboSpan" id="kobo.418.1"> managed by a Tang server. </span><span class="koboSpan" id="kobo.418.2">The Tang server is used to store and manage the encryption keys. </span><span class="koboSpan" id="kobo.418.3">In the cloud, this allows you to manage your boot encryption</span><a id="_idIndexMarker852"/><span class="koboSpan" id="kobo.419.1"> without the cloud provider having access to your keys. </span><span class="koboSpan" id="kobo.419.2">This process is called </span><strong class="bold"><span class="koboSpan" id="kobo.420.1">Network Bound Disk </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.421.1">Encryption</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.422.1"> (</span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.423.1">NBDE</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.424.1">).</span></span></p>
<p><span class="koboSpan" id="kobo.425.1">NBDE is a security feature used in Oracle Linux that provides disk encryption keys during the boot process. </span><span class="koboSpan" id="kobo.425.2">NBDE is an extension of regular disk encryption and uses a network server to store and provide the encryption keys rather than the local machine. </span><span class="koboSpan" id="kobo.425.3">Combined with NUKS, this allows both a local key (that requires a manual passphrase to use) and an automatic key from the Tang server to decrypt the boot drive. </span><span class="koboSpan" id="kobo.425.4">This gives you the simplicity of a secure automated boot, but in an emergency, you can still boot without the </span><span class="No-Break"><span class="koboSpan" id="kobo.426.1">Tang server.</span></span></p>
<h2 id="_idParaDest-206"><a id="_idTextAnchor287"/><span class="koboSpan" id="kobo.427.1">Getting ready</span></h2>
<p><span class="koboSpan" id="kobo.428.1">Unlike other recipes, this one will need a minimum of two VMs: one to act as the Tang server and the other to act as a client. </span><span class="koboSpan" id="kobo.428.2">Both systems should be updated to the </span><span class="No-Break"><span class="koboSpan" id="kobo.429.1">latest software.</span></span></p>
<h2 id="_idParaDest-207"><a id="_idTextAnchor288"/><span class="koboSpan" id="kobo.430.1">How to do it…</span></h2>
<p><span class="koboSpan" id="kobo.431.1">In this recipe, we will do </span><span class="No-Break"><span class="koboSpan" id="kobo.432.1">the following:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.433.1">Create a server </span><span class="No-Break"><span class="koboSpan" id="kobo.434.1">named </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.435.1">tang</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.436.1">:</span></span><ul><li><span class="koboSpan" id="kobo.437.1">Install and configure a </span><span class="No-Break"><span class="koboSpan" id="kobo.438.1">Tang server</span></span></li></ul></li>
<li><span class="koboSpan" id="kobo.439.1">Build another server </span><span class="No-Break"><span class="koboSpan" id="kobo.440.1">named </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.441.1">clevis</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.442.1">:</span></span><ul><li><span class="koboSpan" id="kobo.443.1">Install and </span><span class="No-Break"><span class="koboSpan" id="kobo.444.1">configure Clevis</span></span></li><li><span class="koboSpan" id="kobo.445.1">Configure LUKS </span><a id="_idIndexMarker853"/><span class="koboSpan" id="kobo.446.1">to work with Clevis to encrypt a </span><span class="No-Break"><span class="koboSpan" id="kobo.447.1">data volume</span></span></li></ul></li>
</ul>
<h3><span class="koboSpan" id="kobo.448.1">Configuring a Tang server</span></h3>
<p><span class="koboSpan" id="kobo.449.1">The Tang server is used by Oracle</span><a id="_idIndexMarker854"/><span class="koboSpan" id="kobo.450.1"> Linux to provide encryption keys</span><a id="_idIndexMarker855"/><span class="koboSpan" id="kobo.451.1"> during the boot process. </span><span class="koboSpan" id="kobo.451.2">Here’s a basic overview of how </span><span class="No-Break"><span class="koboSpan" id="kobo.452.1">it operates:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.453.1">During the boot process, the remote system contacts the Tang server and requests an </span><span class="No-Break"><span class="koboSpan" id="kobo.454.1">encryption key</span></span></li>
<li><span class="koboSpan" id="kobo.455.1">The Tang server generates a random encryption key and sends it back to the </span><span class="No-Break"><span class="koboSpan" id="kobo.456.1">remote system</span></span></li>
<li><span class="koboSpan" id="kobo.457.1">The remote system uses the encryption key to unlock its encrypted drive, allowing it </span><span class="No-Break"><span class="koboSpan" id="kobo.458.1">to boot</span></span></li>
<li><span class="koboSpan" id="kobo.459.1">The Tang server discards the encryption key so it cannot be </span><span class="No-Break"><span class="koboSpan" id="kobo.460.1">used again</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.461.1">One of the key benefits of using a Tang server is that it can provide encryption keys to remote systems even if the main encryption key is compromised. </span><span class="koboSpan" id="kobo.461.2">This can improve the security of the system by limiting the amount of damage that can be done if the main encryption key </span><span class="No-Break"><span class="koboSpan" id="kobo.462.1">is compromised.</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.463.1">To install the Tang server as the root, we will simply install the software with </span><strong class="source-inline"><span class="koboSpan" id="kobo.464.1">dnf</span></strong><span class="koboSpan" id="kobo.465.1">, open up the firewall ports, and set the server to run. </span><span class="koboSpan" id="kobo.465.2">This is all done as the </span><span class="No-Break"><span class="koboSpan" id="kobo.466.1">root user.</span></span><p class="list-inset"><span class="koboSpan" id="kobo.467.1">Installing via </span><strong class="source-inline"><span class="koboSpan" id="kobo.468.1">dnf</span></strong><span class="koboSpan" id="kobo.469.1"> is easy; just run the </span><span class="No-Break"><span class="koboSpan" id="kobo.470.1">following command:</span></span></p><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.471.1">dnf install -y tang</span></strong></pre></li> <li><span class="koboSpan" id="kobo.472.1">We will add ports to the firewall. </span><span class="koboSpan" id="kobo.472.2">The trusted network will be the subnet that you are booting from. </span><span class="koboSpan" id="kobo.472.3">In this case, </span><strong class="source-inline"><span class="koboSpan" id="kobo.473.1">192.168.56.0/24</span></strong><span class="koboSpan" id="kobo.474.1"> is my boot subnet. </span><span class="koboSpan" id="kobo.474.2">Don’t forget to update the subnet to your subnet when running the following </span><span class="No-Break"><span class="koboSpan" id="kobo.475.1">firewall commands:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.476.1">firewall-cmd --zone=trusted --add-source=192.168.56.0/24</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.477.1">firewall-cmd --zone=trusted --add-service=http</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.478.1">firewall-cmd --runtime-to-permanent</span></strong></pre></li> <li><span class="koboSpan" id="kobo.479.1">Configure the service</span><a id="_idIndexMarker856"/><span class="koboSpan" id="kobo.480.1"> to start upon booting and</span><a id="_idIndexMarker857"/><span class="koboSpan" id="kobo.481.1"> also start now with the </span><span class="No-Break"><span class="koboSpan" id="kobo.482.1">following command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.483.1">systemctl enable --now tangd.socket</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.484.1">You can verify that the service is running with the </span><span class="No-Break"><span class="koboSpan" id="kobo.485.1">following command:</span></span></p><pre class="source-code"><strong class="bold"><span class="koboSpan" id="kobo.486.1">systeemctl status tangd command;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.487.1"># systemctl status tangd.socket</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.488.1">●</span></strong><strong class="bold"><span class="koboSpan" id="kobo.489.1"> tangd.socket - Tang Server socket</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.490.1">   Loaded: loaded (/usr/lib/systemd/system/tangd.socket; enabled; vendor preset: disabled)</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.491.1">   Active: active (listening) since Mon 2023-07-17 13:52:58 EDT; 2min 46s ago</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.492.1">   Listen: [::]:80 (Stream)</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.493.1"> Accepted: 0; Connected: 0;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.494.1">    Tasks: 0 (limit: 48611)</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.495.1">   Memory: 0B</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.496.1">   CGroup: /system.slice/tangd.socket</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.497.1">Jul 17 13:52:58 tang.m57.local systemd[1]: Listening on Tang Server socket.</span></strong></pre></li> <li><span class="koboSpan" id="kobo.498.1">Once Tang is running, there should be key files in </span><strong class="source-inline"><span class="koboSpan" id="kobo.499.1">/var/db/tang</span></strong><span class="koboSpan" id="kobo.500.1">. </span><span class="koboSpan" id="kobo.500.2">You can also run the command </span><strong class="source-inline"><span class="koboSpan" id="kobo.501.1">tang-show-keys</span></strong><span class="koboSpan" id="kobo.502.1">. </span><span class="koboSpan" id="kobo.502.2">This will show all of the thumbprints of the keys in </span><span class="No-Break"><span class="koboSpan" id="kobo.503.1">the system:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.504.1">[root@tang ~]# tang-show-keys</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.505.1">RxdbjAY7_N19UEYBO6XIUVosv0s</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.506.1">[root@tang ~]#</span></strong></pre></li> </ol>
<p><span class="koboSpan" id="kobo.507.1">Next, let’s set up the client</span><a id="_idIndexMarker858"/><span class="koboSpan" id="kobo.508.1"> system with LUKS to encrypt</span><a id="_idIndexMarker859"/><span class="koboSpan" id="kobo.509.1"> the </span><span class="No-Break"><span class="koboSpan" id="kobo.510.1">data drive.</span></span></p>
<h3><span class="koboSpan" id="kobo.511.1">Setting up LUKS</span></h3>
<ol>
<li><span class="koboSpan" id="kobo.512.1">First, install the required</span><a id="_idIndexMarker860"/><span class="koboSpan" id="kobo.513.1"> packages with</span><a id="_idIndexMarker861"/><span class="koboSpan" id="kobo.514.1"> the following </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.515.1">dnf</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.516.1"> command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.517.1">dnf -y install cryptsetup clevis clevis-luks clevis-dracut</span></strong></pre></li> <li><span class="koboSpan" id="kobo.518.1">Now, we will encrypt the entire raw data device. </span><span class="koboSpan" id="kobo.518.2">By encrypting the entire device, all meta data about the volume is encrypted, along with the actual data itself. </span><span class="koboSpan" id="kobo.518.3">In this example, we have </span><strong class="source-inline"><span class="koboSpan" id="kobo.519.1">/dev/sdb</span></strong><span class="koboSpan" id="kobo.520.1">, which is a small 20 GB device. </span><span class="koboSpan" id="kobo.520.2">You can see by checking all the block devices with the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.521.1">lsblk</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.522.1"> command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.523.1">[root@clevis ~]# lsblk</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.524.1">NAME           MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.525.1">sda              8:0    0  100G  0 disk</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.526.1">├─sda1           8:1    0    1G  0 part /boot</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.527.1">└─sda2           8:2    0 72.9G  0 part</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.528.1">  ├─ol-root    252:0    0   50G  0 lvm  /</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.529.1">  ├─ol-swap    252:1    0  7.9G  0 lvm  [SWAP]</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.530.1">  ├─ol-var     252:2    0    5G  0 lvm  /var</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.531.1">  ├─ol-home    252:3    0    5G  0 lvm  /home</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.532.1">  └─ol-var_log 252:4    0    5G  0 lvm  /var/log</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.533.1">sdb              8:16   0   20G  0 disk</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.534.1">sr0             11:0    1 1024M  0 rom</span></strong></pre></li> <li><span class="koboSpan" id="kobo.535.1">Encrypt </span><strong class="source-inline"><span class="koboSpan" id="kobo.536.1">/dev/sdb</span></strong><span class="koboSpan" id="kobo.537.1"> with</span><a id="_idIndexMarker862"/><span class="koboSpan" id="kobo.538.1"> the </span><span class="No-Break"><span class="koboSpan" id="kobo.539.1">following</span></span><span class="No-Break"><a id="_idIndexMarker863"/></span><span class="No-Break"><span class="koboSpan" id="kobo.540.1"> command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.541.1">cryptsetup luksFormat --type luks2 --cipher aes-xts-plain64 \</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.542.1"> --key-size 512 --hash sha256 --use-random --force-password /dev/sdb</span></strong></pre><p class="list-inset"><strong class="bold"><span class="koboSpan" id="kobo.543.1">WARNING: Doing this will delete ALL DATA on the device</span></strong><span class="koboSpan" id="kobo.544.1">, including </span><span class="No-Break"><span class="koboSpan" id="kobo.545.1">any partitions:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer254">
<span class="koboSpan" id="kobo.546.1"><img alt="Figure 9.6 – Encrypting the drive" src="image/B18349_09_06.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.547.1">Figure 9.6 – Encrypting the drive</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.548.1">When running the command, you will also be prompted for a passphrase. </span><strong class="bold"><span class="koboSpan" id="kobo.549.1">DO NOT LOSE THIS</span></strong><span class="koboSpan" id="kobo.550.1"> or you will be unable to decrypt the </span><span class="No-Break"><span class="koboSpan" id="kobo.551.1">drive manually.</span></span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.552.1">Next, let’s manually unlock the drive using the previously saved passphrase with the </span><span class="No-Break"><span class="koboSpan" id="kobo.553.1">following command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.554.1">cryptsetup --verbose luksOpen /dev/sdb datadisk1</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.555.1">Once unlocked, you should see the disk </span><span class="No-Break"><span class="koboSpan" id="kobo.556.1">in </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.557.1">/dev/mapper</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.558.1">:</span></span></p><pre class="source-code"><strong class="bold"><span class="koboSpan" id="kobo.559.1">[root@clevis ~]# ls /dev/mapper/datadisk1</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.560.1">/dev/mapper/datadisk1</span></strong></pre></li> <li><span class="koboSpan" id="kobo.561.1">Now we can use </span><strong class="source-inline"><span class="koboSpan" id="kobo.562.1">/dev/mapper/datadisk1</span></strong><span class="koboSpan" id="kobo.563.1"> like any normal disk. </span><span class="koboSpan" id="kobo.563.2">In the example, let’s create a </span><strong class="source-inline"><span class="koboSpan" id="kobo.564.1">xfs</span></strong><span class="koboSpan" id="kobo.565.1"> filesystem </span><span class="No-Break"><span class="koboSpan" id="kobo.566.1">on </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.567.1">/dev/mapper/datadisk1</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.568.1">:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.569.1">mkfs.xfs /dev/mapper/datadisk1</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.570.1">We will also make a mount </span><span class="No-Break"><span class="koboSpan" id="kobo.571.1">point </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.572.1">/data</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.573.1">:</span></span></p><pre class="source-code"><strong class="bold"><span class="koboSpan" id="kobo.574.1">mkdir /data</span></strong></pre></li> <li><span class="koboSpan" id="kobo.575.1">To use the disk, we need</span><a id="_idIndexMarker864"/><span class="koboSpan" id="kobo.576.1"> to pull the UUID of the disk. </span><span class="koboSpan" id="kobo.576.2">This is done</span><a id="_idIndexMarker865"/><span class="koboSpan" id="kobo.577.1"> with the following </span><strong class="source-inline"><span class="koboSpan" id="kobo.578.1">blkid</span></strong><span class="koboSpan" id="kobo.579.1"> command. </span><span class="koboSpan" id="kobo.579.2">The UUID will be used to identify the disk to decrypt </span><span class="No-Break"><span class="koboSpan" id="kobo.580.1">it later:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.581.1">[root@clevis ~]# blkid -s UUID  /dev/mapper/datadisk1</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.582.1">/dev/mapper/datadisk1: UUID="58c9f051-f243-4c42-af4f-62d2e3e3b90f</span></strong><span class="koboSpan" id="kobo.583.1">"</span></pre></li> <li><span class="koboSpan" id="kobo.584.1">Mounting the filesystem on reboot required us to add the </span><strong class="source-inline"><span class="koboSpan" id="kobo.585.1">fstab</span></strong><span class="koboSpan" id="kobo.586.1"> entry with the </span><span class="No-Break"><span class="koboSpan" id="kobo.587.1">following command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.588.1">echo "UUID=58c9f051-f243-4c42-af4f-62d2e3e3b90f /data xfs defaults 0 0" | sudo tee -a /etc/fstab</span></strong></pre></li> <li><span class="koboSpan" id="kobo.589.1">Now we can mount the disk with the </span><span class="No-Break"><span class="koboSpan" id="kobo.590.1">following command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.591.1">mount /data</span></strong></pre></li> <li><span class="koboSpan" id="kobo.592.1">Next, we need to bind a Tang key to the device using Clevis with the following command. </span><span class="koboSpan" id="kobo.592.2">We will pass the device and Tang server information via the following command line. </span><span class="koboSpan" id="kobo.592.3">You will need to use the existing LUKS password to add the keys </span><span class="No-Break"><span class="koboSpan" id="kobo.593.1">to Tang:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.594.1">[root@clevis ~]# clevis luks bind -d /dev/sdb tang '{"url":"http://tang.m57.local"}'</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.595.1">Warning: Value 512 is outside of the allowed entropy range, adjusting it.</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.596.1">The advertisement contains the following signing keys:</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.597.1">RxdbjAY7_N19UEYBO6XIUVosv0s</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.598.1">Do you wish to trust these keys? </span><span class="koboSpan" id="kobo.598.2">[ynYN] Y</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.599.1">Enter existing LUKS password:</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.600.1">We can now look</span><a id="_idIndexMarker866"/><span class="koboSpan" id="kobo.601.1"> at the LUKS key slots. </span><span class="koboSpan" id="kobo.601.2">You should see </span><a id="_idIndexMarker867"/><span class="koboSpan" id="kobo.602.1">the key in the second </span><span class="No-Break"><span class="koboSpan" id="kobo.603.1">slot now.</span></span></p><p class="list-inset"><span class="koboSpan" id="kobo.604.1">As seen in the following screenshot, slot </span><strong class="source-inline"><span class="koboSpan" id="kobo.605.1">1:</span></strong><span class="koboSpan" id="kobo.606.1"> is populated with </span><span class="No-Break"><span class="koboSpan" id="kobo.607.1">a key:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer255">
<span class="koboSpan" id="kobo.608.1"><img alt="Figure 9.7 – LUKS with the second slot used" src="image/B18349_09_07.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.609.1">Figure 9.7 – LUKS with the second slot used</span></p>
<ol>
<li value="10"><span class="koboSpan" id="kobo.610.1">Next, we need to configure</span><a id="_idIndexMarker868"/><span class="koboSpan" id="kobo.611.1"> the disk to decrypt the drive</span><a id="_idIndexMarker869"/><span class="koboSpan" id="kobo.612.1"> on boot. </span><span class="koboSpan" id="kobo.612.2">We first need to pull the new UUID of the </span><span class="No-Break"><span class="koboSpan" id="kobo.613.1">encrypted drive:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.614.1">[root</span><a id="_idTextAnchor289"/><span class="koboSpan" id="kobo.615.1">@clevis ~]# blkid -s UUID  /dev/sdb</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.616.1">/dev/sdb: UUID="218ec8bc-2508-4e34-a569-1e8d3783874e"</span></strong></pre></li> <li><span class="koboSpan" id="kobo.617.1">Next, let’s enable the </span><span class="No-Break"><span class="koboSpan" id="kobo.618.1">Clevis service:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.619.1">systemctl enable clevis-luks-askpass.path</span></strong></pre></li> <li><span class="koboSpan" id="kobo.620.1">Now, we need to add the device to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.621.1">/etc/crypttab</span></strong><span class="koboSpan" id="kobo.622.1"> file. </span><span class="koboSpan" id="kobo.622.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.623.1">crypttab</span></strong><span class="koboSpan" id="kobo.624.1"> file contains a list of all </span><span class="No-Break"><span class="koboSpan" id="kobo.625.1">encrypted drives:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.626.1">echo "encrypteddisk UUID=218ec8bc-2508-4e34-a569-1e8d3783874e - _netdev" | sudo tee -a /etc/crypttab</span></strong></pre></li> <li><span class="koboSpan" id="kobo.627.1">Next, we will update</span><a id="_idIndexMarker870"/><span class="koboSpan" id="kobo.628.1"> the </span><strong class="source-inline"><span class="koboSpan" id="kobo.629.1">/etc/fstab</span></strong><span class="koboSpan" id="kobo.630.1"> file for the</span><a id="_idIndexMarker871"/><span class="koboSpan" id="kobo.631.1"> filesystem, changing the default to </span><strong class="source-inline"><span class="koboSpan" id="kobo.632.1">_netdev</span></strong><span class="koboSpan" id="kobo.633.1">. </span><span class="koboSpan" id="kobo.633.2">This will allow the device to mount after the other </span><span class="No-Break"><span class="koboSpan" id="kobo.634.1">non-encrypted filesystems.</span></span></li>
<li><span class="koboSpan" id="kobo.635.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.636.1">/etc/fstab</span></strong><span class="koboSpan" id="kobo.637.1"> should look similar to the following screenshot, with the UUID of the encrypted drive mounting as </span><span class="No-Break"><span class="koboSpan" id="kobo.638.1">a </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.639.1">_netdev</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.640.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer256">
<span class="koboSpan" id="kobo.641.1"><img alt="Figure 9.8 – fstab" src="image/B18349_09_08.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.642.1">Figure 9.8 – fstab</span></p>
<h2 id="_idParaDest-208"><a id="_idTextAnchor290"/><span class="koboSpan" id="kobo.643.1">How it works…</span></h2>
<p><span class="koboSpan" id="kobo.644.1">Clevis and Tang are both</span><a id="_idIndexMarker872"/><span class="koboSpan" id="kobo.645.1"> software tools that are used to unlock and decrypt disks automatically during the boot process of a </span><span class="No-Break"><span class="koboSpan" id="kobo.646.1">Linux system.</span></span></p>
<p><span class="koboSpan" id="kobo.647.1">Here is a brief overview of how </span><span class="No-Break"><span class="koboSpan" id="kobo.648.1">they work:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.649.1">During the boot process, the system prompts the user for a passphrase to unlock and decrypt </span><span class="No-Break"><span class="koboSpan" id="kobo.650.1">the disk.</span></span></li>
<li><span class="koboSpan" id="kobo.651.1">With Clevis and Tang, this prompt is replaced with an automated process that unlocks and decrypts the disk using a network-based </span><span class="No-Break"><span class="koboSpan" id="kobo.652.1">key server.</span></span></li>
<li><span class="koboSpan" id="kobo.653.1">Clevis and Tang work together to create a </span><em class="italic"><span class="koboSpan" id="kobo.654.1">binding</span></em><span class="koboSpan" id="kobo.655.1"> between the encrypted disk and the key server. </span><span class="koboSpan" id="kobo.655.2">This binding is based on a </span><em class="italic"><span class="koboSpan" id="kobo.656.1">policy</span></em><span class="koboSpan" id="kobo.657.1"> that specifies the conditions under which the disk can </span><span class="No-Break"><span class="koboSpan" id="kobo.658.1">be unlocked.</span></span></li>
<li><span class="koboSpan" id="kobo.659.1">When the system boots up, it contacts the key server and requests the decryption key for the encrypted disk. </span><span class="koboSpan" id="kobo.659.2">The key server checks the policy to determine whether the conditions for unlocking the disk have </span><span class="No-Break"><span class="koboSpan" id="kobo.660.1">been met.</span></span></li>
<li><span class="koboSpan" id="kobo.661.1">If the policy conditions are met, the key server sends the decryption key to the system, which then uses it to unlock and decrypt </span><span class="No-Break"><span class="koboSpan" id="kobo.662.1">the disk.</span></span></li>
<li><span class="koboSpan" id="kobo.663.1">If the policy conditions are not met, the key server denies the request for the decryption key, and the disk</span><a id="_idIndexMarker873"/> <span class="No-Break"><span class="koboSpan" id="kobo.664.1">remains locked.</span></span></li>
</ol>
<h3><span class="koboSpan" id="kobo.665.1">There’s more…</span></h3>
<p><span class="koboSpan" id="kobo.666.1">Optionally, you can</span><a id="_idIndexMarker874"/><span class="koboSpan" id="kobo.667.1"> also modify the system to allow an admin to manually enter the initial password when the system boots. </span><span class="koboSpan" id="kobo.667.2">To do this, </span><span class="No-Break"><span class="koboSpan" id="kobo.668.1">install </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.669.1">clevis-dracut</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.670.1">:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.671.1">
dnf install -y clevis-dracut</span></pre> <p><span class="koboSpan" id="kobo.672.1">Then, rebuild the </span><span class="No-Break"><span class="koboSpan" id="kobo.673.1">boot files:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.674.1">
dracut -fv</span></pre> <p><span class="koboSpan" id="kobo.675.1">When the system boots, you will have the opportunity to enter the </span><span class="No-Break"><span class="koboSpan" id="kobo.676.1">passphrase manually:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer257">
<span class="koboSpan" id="kobo.677.1"><img alt="Figure 9.9 – Manual passphrase entry" src="image/B18349_09_09.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.678.1">Figure 9.9 – Manual passphrase entry</span></p>
<p><span class="koboSpan" id="kobo.679.1">Now you have an</span><a id="_idIndexMarker875"/><span class="koboSpan" id="kobo.680.1"> encrypted filesystem with an automatic way to decrypt it, as well as a manual method for use </span><span class="No-Break"><span class="koboSpan" id="kobo.681.1">in emergencies.</span></span></p>
<h1 id="_idParaDest-209"><a id="_idTextAnchor291"/><span class="koboSpan" id="kobo.682.1">Validating adherence to a compliance policy</span></h1>
<p><span class="koboSpan" id="kobo.683.1">Securing systems</span><a id="_idIndexMarker876"/><span class="koboSpan" id="kobo.684.1"> is much more than encrypting data at rest or in motion. </span><span class="koboSpan" id="kobo.684.2">Many configuration files should be checked, along with other common security settings. </span><span class="koboSpan" id="kobo.684.3">This can be done automatically using </span><strong class="bold"><span class="koboSpan" id="kobo.685.1">Security Content Automation Protocol</span></strong><span class="koboSpan" id="kobo.686.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.687.1">SCAP</span></strong><span class="koboSpan" id="kobo.688.1">) files. </span><span class="koboSpan" id="kobo.688.2">SCAP is a standardized framework</span><a id="_idIndexMarker877"/><span class="koboSpan" id="kobo.689.1"> that is used to automate the process of maintaining the security of computer systems. </span><span class="koboSpan" id="kobo.689.2">It is a suite of specifications that provide a standardized approach to security automation, enabling organizations to implement consistent and repeatable security practices across their </span><span class="No-Break"><span class="koboSpan" id="kobo.690.1">IT infrastructure.</span></span></p>
<p><span class="koboSpan" id="kobo.691.1">SCAP defines a common language for communicating security-related information, which allows security tools and products from different vendors to work together seamlessly. </span><span class="koboSpan" id="kobo.691.2">It includes a set of standards and guidelines for creating and sharing security content, such as vulnerability</span><a id="_idIndexMarker878"/><span class="koboSpan" id="kobo.692.1"> data, security checklists, and configuration baselines. </span><span class="koboSpan" id="kobo.692.2">Some of the key components of SCAP include the </span><strong class="bold"><span class="koboSpan" id="kobo.693.1">Common Vulnerabilities and Exposures</span></strong><span class="koboSpan" id="kobo.694.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.695.1">CVE</span></strong><span class="koboSpan" id="kobo.696.1">) database, which is used to identify and track known security vulnerabilities, and the </span><strong class="bold"><span class="koboSpan" id="kobo.697.1">Common Configuration Enumeration</span></strong><span class="koboSpan" id="kobo.698.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.699.1">CCE</span></strong><span class="koboSpan" id="kobo.700.1">) database, which provides a standardized method</span><a id="_idIndexMarker879"/><span class="koboSpan" id="kobo.701.1"> for identifying configuration settings that are relevant </span><span class="No-Break"><span class="koboSpan" id="kobo.702.1">to security.</span></span></p>
<p><span class="koboSpan" id="kobo.703.1">The easiest way to do this</span><a id="_idIndexMarker880"/><span class="koboSpan" id="kobo.704.1"> is to use a tool called OpenSCAP, which comes with </span><span class="No-Break"><span class="koboSpan" id="kobo.705.1">Oracle Linux.</span></span></p>
<h2 id="_idParaDest-210"><a id="_idTextAnchor292"/><span class="koboSpan" id="kobo.706.1">Getting ready</span></h2>
<p><span class="koboSpan" id="kobo.707.1">As with the other test, we will</span><a id="_idIndexMarker881"/><span class="koboSpan" id="kobo.708.1"> need an Oracle Linux system to play with. </span><span class="koboSpan" id="kobo.708.2">Nothing else is required other than the ability for the system to access a </span><strong class="source-inline"><span class="koboSpan" id="kobo.709.1">dnf</span></strong><span class="koboSpan" id="kobo.710.1"> repository to install </span><span class="No-Break"><span class="koboSpan" id="kobo.711.1">additional packages.</span></span></p>
<h2 id="_idParaDest-211"><a id="_idTextAnchor293"/><span class="koboSpan" id="kobo.712.1">How to do it…</span></h2>
<p><span class="koboSpan" id="kobo.713.1">The first step is to install OpenSCAP, usually by installing the entire suite </span><span class="No-Break"><span class="koboSpan" id="kobo.714.1">of tools:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.715.1">scap-workbench</span></strong><span class="koboSpan" id="kobo.716.1">: </span><span class="No-Break"><span class="koboSpan" id="kobo.717.1">A GUI</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.718.1">openscap-scanner</span></strong><span class="koboSpan" id="kobo.719.1">: </span><span class="No-Break"><span class="koboSpan" id="kobo.720.1">Scans systems</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.721.1">openscap</span></strong><span class="koboSpan" id="kobo.722.1">: The </span><span class="No-Break"><span class="koboSpan" id="kobo.723.1">OpenSCAP core</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.724.1">openscap-utils</span></strong><span class="koboSpan" id="kobo.725.1">: Several command-line tools for scanning systems </span><span class="No-Break"><span class="koboSpan" id="kobo.726.1">and containers</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.727.1">scap-security-guide</span></strong><span class="koboSpan" id="kobo.728.1">: Commonly used </span><span class="No-Break"><span class="koboSpan" id="kobo.729.1">SCAP files</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.730.1">This is done via </span><strong class="source-inline"><span class="koboSpan" id="kobo.731.1">dnf</span></strong><span class="koboSpan" id="kobo.732.1"> with the </span><span class="No-Break"><span class="koboSpan" id="kobo.733.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.734.1">
dnf install -y scap-workbench</span></pre> <p><span class="koboSpan" id="kobo.735.1">Once OpenSCAP is installed, you have two ways to run the tool: via a GUI or by using the command line. </span><span class="koboSpan" id="kobo.735.2">To start the GUI, run </span><strong class="source-inline"><span class="koboSpan" id="kobo.736.1">scap-workbench</span></strong><span class="koboSpan" id="kobo.737.1">. </span><span class="koboSpan" id="kobo.737.2">This launches an easy-to-use GUI that will let you </span><span class="No-Break"><span class="koboSpan" id="kobo.738.1">run scans.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.739.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.740.1">If you install </span><strong class="source-inline"><span class="koboSpan" id="kobo.741.1">scap-workbench</span></strong><span class="koboSpan" id="kobo.742.1"> and X11 is not installed, </span><strong class="source-inline"><span class="koboSpan" id="kobo.743.1">dnf</span></strong><span class="koboSpan" id="kobo.744.1"> will install it. </span><span class="koboSpan" id="kobo.744.2">If you are not using X11 on your servers, consider installing the </span><strong class="source-inline"><span class="koboSpan" id="kobo.745.1">scap-workbench</span></strong><span class="koboSpan" id="kobo.746.1"> on a WSL Oracle Linux system or a system with X11. </span><span class="koboSpan" id="kobo.746.2">You can also install SCAP Workbench on a Windows desktop. </span><span class="koboSpan" id="kobo.746.3">Downloads for Windows can be found</span><a id="_idIndexMarker882"/><span class="koboSpan" id="kobo.747.1"> on the Open SCAP </span><span class="No-Break"><span class="koboSpan" id="kobo.748.1">website, </span></span><a href="https://www.open-scap.org/"><span class="No-Break"><span class="koboSpan" id="kobo.749.1">https://www.open-scap.org/</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.750.1">.</span></span></p>
<h2 id="_idParaDest-212"><a id="_idTextAnchor294"/><span class="koboSpan" id="kobo.751.1">How it works…</span></h2>
<p><span class="koboSpan" id="kobo.752.1">While many users</span><a id="_idIndexMarker883"/><span class="koboSpan" id="kobo.753.1"> run the GUI, you can also use a </span><span class="No-Break"><span class="koboSpan" id="kobo.754.1">command line.</span></span></p>
<p><span class="koboSpan" id="kobo.755.1">When the GUI Launches, you need to pick the type of systems you wish to scan. </span><span class="koboSpan" id="kobo.755.2">Here, OL8 is </span><span class="No-Break"><span class="koboSpan" id="kobo.756.1">being used:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer258">
<span class="koboSpan" id="kobo.757.1"><img alt="Figure 9.10 – Workbench launch" src="image/B18349_09_10.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.758.1">Figure 9.10 – Workbench launch</span></p>
<p><span class="koboSpan" id="kobo.759.1">Next, select the profile you wish to use for the scan. </span><span class="koboSpan" id="kobo.759.2">The profile is the standard that you are comparing to. </span><span class="koboSpan" id="kobo.759.3">You must pick one of the profiles </span><span class="No-Break"><span class="koboSpan" id="kobo.760.1">to continue:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer259">
<span class="koboSpan" id="kobo.761.1"><img alt="Figure 9.11 – SCAP profiles" src="image/B18349_09_11.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.762.1">Figure 9.11 – SCAP profiles</span></p>
<p><span class="koboSpan" id="kobo.763.1">The families of profiles</span><a id="_idIndexMarker884"/><span class="koboSpan" id="kobo.764.1"> included are </span><span class="No-Break"><span class="koboSpan" id="kobo.765.1">as follows:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.766.1">ANSSI-BP</span></strong><span class="koboSpan" id="kobo.767.1">: ANSSI-BP is a set of security recommendations</span><a id="_idIndexMarker885"/><span class="koboSpan" id="kobo.768.1"> developed by the </span><strong class="bold"><span class="koboSpan" id="kobo.769.1">French National Agency for the Security of Information Systems</span></strong><span class="koboSpan" id="kobo.770.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.771.1">ANSSI</span></strong><span class="koboSpan" id="kobo.772.1">) to provide guidance on securing information systems. </span><span class="koboSpan" id="kobo.772.2">The ANSSI-BP recommendations</span><a id="_idIndexMarker886"/><span class="koboSpan" id="kobo.773.1"> cover a wide range of topics, including network security, secure software development, access control, cryptography, incident response, and </span><span class="No-Break"><span class="koboSpan" id="kobo.774.1">security monitoring.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.775.1">CJIS</span></strong><span class="koboSpan" id="kobo.776.1">: The </span><strong class="bold"><span class="koboSpan" id="kobo.777.1">Criminal Justice Information Services</span></strong><span class="koboSpan" id="kobo.778.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.779.1">CJIS</span></strong><span class="koboSpan" id="kobo.780.1">) are a division of the </span><strong class="bold"><span class="koboSpan" id="kobo.781.1">Federal Bureau of Investigation</span></strong><span class="koboSpan" id="kobo.782.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.783.1">FBI</span></strong><span class="koboSpan" id="kobo.784.1">) in the United States. </span><span class="koboSpan" id="kobo.784.2">The CJIS</span><a id="_idIndexMarker887"/><span class="koboSpan" id="kobo.785.1"> division is responsible for providing law enforcement</span><a id="_idIndexMarker888"/><span class="koboSpan" id="kobo.786.1"> agencies with access to criminal justice information systems, which includes databases of criminal records, fingerprints, and other related information. </span><span class="koboSpan" id="kobo.786.2">The CJIS division was established in 1992 and provides services to more than 18,000 law enforcement agencies across the United States. </span><span class="koboSpan" id="kobo.786.3">Its mission is to provide accurate and timely information to law enforcement officials to help them solve and prevent crimes, while also ensuring the privacy and security of </span><span class="No-Break"><span class="koboSpan" id="kobo.787.1">the information.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.788.1">NIST-800</span></strong><span class="koboSpan" id="kobo.789.1">: NIST-800 refers to a series of guidelines</span><a id="_idIndexMarker889"/><span class="koboSpan" id="kobo.790.1"> and standards for information security developed by the </span><strong class="bold"><span class="koboSpan" id="kobo.791.1">National Institute of Standards and Technology</span></strong><span class="koboSpan" id="kobo.792.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.793.1">NIST</span></strong><span class="koboSpan" id="kobo.794.1">) in the United States. </span><span class="koboSpan" id="kobo.794.2">The NIST-800 series includes a set of publications that provide</span><a id="_idIndexMarker890"/><span class="koboSpan" id="kobo.795.1"> guidance on various aspects of information security, such as risk</span><a id="_idIndexMarker891"/><span class="koboSpan" id="kobo.796.1"> management, security controls, and incident response. </span><span class="koboSpan" id="kobo.796.2">The NIST-800 series is widely used by government agencies, private sector organizations, and other entities to improve the security of their information systems. </span><span class="koboSpan" id="kobo.796.3">The publications in the series are regularly updated to reflect changes in the threat landscape and advancements in </span><span class="No-Break"><span class="koboSpan" id="kobo.797.1">security technology.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.798.1">ACSC</span></strong><span class="koboSpan" id="kobo.799.1">: The </span><strong class="bold"><span class="koboSpan" id="kobo.800.1">Australian Cyber Security Centre</span></strong><span class="koboSpan" id="kobo.801.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.802.1">ACSC</span></strong><span class="koboSpan" id="kobo.803.1">) is a government agency that is responsible</span><a id="_idIndexMarker892"/><span class="koboSpan" id="kobo.804.1"> for enhancing the cyber security</span><a id="_idIndexMarker893"/><span class="koboSpan" id="kobo.805.1"> capabilities and resilience of the Australian government, businesses, and the community. </span><span class="koboSpan" id="kobo.805.2">The ACSC was established in 2014 and is a part of the </span><strong class="bold"><span class="koboSpan" id="kobo.806.1">Australian Signals </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.807.1">Directorate</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.808.1"> (</span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.809.1">ASD</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.810.1">).</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.811.1">HIPAA</span></strong><span class="koboSpan" id="kobo.812.1">: The </span><strong class="bold"><span class="koboSpan" id="kobo.813.1">Health Insurance Portability and Accountability Act</span></strong><span class="koboSpan" id="kobo.814.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.815.1">HIPAA</span></strong><span class="koboSpan" id="kobo.816.1">) is a federal law in the United States</span><a id="_idIndexMarker894"/><span class="koboSpan" id="kobo.817.1"> that protects healthcare information. </span><span class="koboSpan" id="kobo.817.2">This law establishes standards for protecting the privacy and security of individuals’ health-related information. </span><span class="koboSpan" id="kobo.817.3">HIPAA includes specific requirements for securing </span><strong class="bold"><span class="koboSpan" id="kobo.818.1">electronic protected health information</span></strong><span class="koboSpan" id="kobo.819.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.820.1">ePHI</span></strong><span class="koboSpan" id="kobo.821.1">), which is health information that is stored</span><a id="_idIndexMarker895"/><span class="koboSpan" id="kobo.822.1"> or </span><span class="No-Break"><span class="koboSpan" id="kobo.823.1">transmitted electronically.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.824.1">PCS-DSS</span></strong><span class="koboSpan" id="kobo.825.1">: The </span><strong class="bold"><span class="koboSpan" id="kobo.826.1">Payment Card Industry Data Security Standard</span></strong> <strong class="bold"><span class="koboSpan" id="kobo.827.1">(PCI-DSS)</span></strong><span class="koboSpan" id="kobo.828.1"> is a set of security standards established by major credit card companies that ensure</span><a id="_idIndexMarker896"/><span class="koboSpan" id="kobo.829.1"> that organizations that have access to credit card details protect the confidentiality and integrity of cardholder data. </span><span class="koboSpan" id="kobo.829.2">PCI-DSS is designed to reduce the risk of data breaches and credit </span><span class="No-Break"><span class="koboSpan" id="kobo.830.1">card fraud.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.831.1">STIG</span></strong><span class="koboSpan" id="kobo.832.1">: </span><strong class="bold"><span class="koboSpan" id="kobo.833.1">STIG</span></strong><span class="koboSpan" id="kobo.834.1"> stands for </span><strong class="bold"><span class="koboSpan" id="kobo.835.1">Security Technical Implementation Guide</span></strong><span class="koboSpan" id="kobo.836.1">, which is a set</span><a id="_idIndexMarker897"/><span class="koboSpan" id="kobo.837.1"> of guidelines developed by the </span><strong class="bold"><span class="koboSpan" id="kobo.838.1">Defense Information Systems Agency</span></strong><span class="koboSpan" id="kobo.839.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.840.1">DISA</span></strong><span class="koboSpan" id="kobo.841.1">) in the United States for securing information</span><a id="_idIndexMarker898"/><span class="koboSpan" id="kobo.842.1"> systems and software used by the </span><strong class="bold"><span class="koboSpan" id="kobo.843.1">Department of Defense</span></strong><span class="koboSpan" id="kobo.844.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.845.1">DoD</span></strong><span class="koboSpan" id="kobo.846.1">). </span><span class="koboSpan" id="kobo.846.2">STIG provides detailed information</span><a id="_idIndexMarker899"/><span class="koboSpan" id="kobo.847.1"> on how to configure and maintain various technologies to meet DoD security requirements and ensure that systems are hardened </span><span class="No-Break"><span class="koboSpan" id="kobo.848.1">against cyberattacks.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.849.1">When picking a standard, you can use</span><a id="_idIndexMarker900"/><span class="koboSpan" id="kobo.850.1"> the default generic standards (such as the </span><em class="italic"><span class="koboSpan" id="kobo.851.1">Standard System Security Profile for Oracle Linux 8</span></em><span class="koboSpan" id="kobo.852.1"> found at </span><a href="https://static.open-scap.org/ssg-guides/ssg-ol8-guide-standard.html"><span class="koboSpan" id="kobo.853.1">https://static.open-scap.org/ssg-guides/ssg-ol8-guide-standard.html</span></a><span class="koboSpan" id="kobo.854.1">) or a standard that aligns with the workload. </span><span class="koboSpan" id="kobo.854.2">For example, for healthcare, HIPAA is likely the appropriate standard. </span><span class="koboSpan" id="kobo.854.3">If you are in the US Federal Government </span><a id="_idIndexMarker901"/><span class="koboSpan" id="kobo.855.1">ecosystem, the STIG standard is widely used even outside of the DoD. </span><span class="koboSpan" id="kobo.855.2">Once you pick the standard, you have several additional options, as seen in the following screenshot. </span><span class="koboSpan" id="kobo.855.3">You can pick a local or remote machine, as well as a remediation role. </span><span class="koboSpan" id="kobo.855.4">The remediation role allows the system to automatically resolve issues if possible, but any admin should be careful using this. </span><span class="koboSpan" id="kobo.855.5">This is because many of the standards can break system functionality. </span><span class="koboSpan" id="kobo.855.6">Always be careful when automatically remediating issues, especially with the more stringent standards, such as STIG </span><span class="No-Break"><span class="koboSpan" id="kobo.856.1">and CJIS.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer260">
<span class="koboSpan" id="kobo.857.1"><img alt="Figure 9.12 – Scan settings" src="image/B18349_09_12.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.858.1">Figure 9.12 – Scan settings</span></p>
<p><span class="koboSpan" id="kobo.859.1">Once you have made your choices, </span><span class="No-Break"><span class="koboSpan" id="kobo.860.1">select </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.861.1">Scan</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.862.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.863.1">Depending on the standard</span><a id="_idIndexMarker902"/><span class="koboSpan" id="kobo.864.1"> used, the scan can run in as fast as a few seconds or take over 20 minutes. </span><span class="koboSpan" id="kobo.864.2">When the scan is complete, you can use the GUI to review </span><span class="No-Break"><span class="koboSpan" id="kobo.865.1">the results:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer261">
<span class="koboSpan" id="kobo.866.1"><img alt="Figure 9.13 – Scan results" src="image/B18349_09_13.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.867.1">Figure 9.13 – Scan results</span></p>
<p><span class="koboSpan" id="kobo.868.1">Not all fixes involve changing</span><a id="_idIndexMarker903"/><span class="koboSpan" id="kobo.869.1"> a simple setting. </span><span class="koboSpan" id="kobo.869.2">Some may require additional filesystems or kernel settings. </span><span class="koboSpan" id="kobo.869.3">To see the details of a finding, simply expand the results as seen in the </span><span class="No-Break"><span class="koboSpan" id="kobo.870.1">following screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer262">
<span class="koboSpan" id="kobo.871.1"><img alt="Figure 9.14 – Result details" src="image/B18349_09_14.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.872.1">Figure 9.14 – Result details</span></p>
<p><span class="koboSpan" id="kobo.873.1">At the bottom of the summary, you have </span><span class="No-Break"><span class="koboSpan" id="kobo.874.1">several options:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer263">
<span class="koboSpan" id="kobo.875.1"><img alt="Figure 9.15 – Report options" src="image/B18349_09_15.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.876.1">Figure 9.15 – Report options</span></p>
<p><span class="koboSpan" id="kobo.877.1">These options are </span><span class="No-Break"><span class="koboSpan" id="kobo.878.1">as follows:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.879.1">Save Results</span></strong><span class="koboSpan" id="kobo.880.1">: Saves</span><a id="_idIndexMarker904"/><span class="koboSpan" id="kobo.881.1"> the results</span><a id="_idIndexMarker905"/><span class="koboSpan" id="kobo.882.1"> as a HTML file, an </span><strong class="bold"><span class="koboSpan" id="kobo.883.1">Asset Reporting File</span></strong><span class="koboSpan" id="kobo.884.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.885.1">ARF</span></strong><span class="koboSpan" id="kobo.886.1">) file, or an </span><strong class="bold"><span class="koboSpan" id="kobo.887.1">Extensible Configuration Checklist Description Format</span></strong><span class="koboSpan" id="kobo.888.1"> (</span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.889.1">XCDDF</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.890.1">) file</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.891.1">Generate remediation role</span></strong><span class="koboSpan" id="kobo.892.1">: Generates a script in bash, Ansible, or Puppet format to automate the remediation of </span><span class="No-Break"><span class="koboSpan" id="kobo.893.1">the server</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.894.1">Show Report</span></strong><span class="koboSpan" id="kobo.895.1">: Opens up the HTML-formatted</span><a id="_idIndexMarker906"/><span class="koboSpan" id="kobo.896.1"> report in </span><span class="No-Break"><span class="koboSpan" id="kobo.897.1">a browser</span></span></li>
</ul>
<h1 id="_idParaDest-213"><a id="_idTextAnchor295"/><span class="koboSpan" id="kobo.898.1">Port protection and restricting network access</span></h1>
<p><span class="koboSpan" id="kobo.899.1">Oracle Linux</span><a id="_idIndexMarker907"/><span class="koboSpan" id="kobo.900.1"> has a firewall built</span><a id="_idIndexMarker908"/><span class="koboSpan" id="kobo.901.1"> into the distribution. </span><span class="koboSpan" id="kobo.901.2">This firewall is called </span><strong class="bold"><span class="koboSpan" id="kobo.902.1">firewalld</span></strong><span class="koboSpan" id="kobo.903.1">, short for </span><strong class="bold"><span class="koboSpan" id="kobo.904.1">firewall daemon</span></strong><span class="koboSpan" id="kobo.905.1">. </span><span class="koboSpan" id="kobo.905.2">firewalld is a dynamic</span><a id="_idIndexMarker909"/><span class="koboSpan" id="kobo.906.1"> firewall management </span><a id="_idIndexMarker910"/><span class="koboSpan" id="kobo.907.1">tool used on Linux systems that provides a simple and consistent way to manage firewall rules across different distributions. </span><span class="koboSpan" id="kobo.907.2">It is designed to allow administrators to manage firewall rules in a flexible and </span><span class="No-Break"><span class="koboSpan" id="kobo.908.1">efficient way.</span></span></p>
<h2 id="_idParaDest-214"><a id="_idTextAnchor296"/><span class="koboSpan" id="kobo.909.1">Getting ready</span></h2>
<p><span class="koboSpan" id="kobo.910.1">As with the other test, we will need an Oracle</span><a id="_idIndexMarker911"/><span class="koboSpan" id="kobo.911.1"> Linux system to play with. </span><span class="koboSpan" id="kobo.911.2">Nothing else is required. </span><span class="koboSpan" id="kobo.911.3">The system</span><a id="_idIndexMarker912"/><span class="koboSpan" id="kobo.912.1"> is enabled by default on most installations. </span><span class="koboSpan" id="kobo.912.2">To check the status of the daemon, you can use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.913.1">systemctl</span></strong><span class="koboSpan" id="kobo.914.1"> command </span><span class="No-Break"><span class="koboSpan" id="kobo.915.1">as follows:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.916.1">
systemctl status firewalld</span></pre> <p><span class="koboSpan" id="kobo.917.1">The output is displayed in the </span><span class="No-Break"><span class="koboSpan" id="kobo.918.1">following screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer264">
<span class="koboSpan" id="kobo.919.1"><img alt="Figure 9.16 – firewalld status" src="image/B18349_09_16.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.920.1">Figure 9.16 – firewalld status</span></p>
<h2 id="_idParaDest-215"><a id="_idTextAnchor297"/><span class="koboSpan" id="kobo.921.1">How to do it…</span></h2>
<p><span class="koboSpan" id="kobo.922.1">You can see the current configuration using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.923.1">firewall-cmd</span></strong><span class="koboSpan" id="kobo.924.1"> with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.925.1">--</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.926.1">list-all</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.927.1"> option:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.928.1">
[root@ol8 ~]# firewall-cmd --list-all</span></pre> <p><span class="koboSpan" id="kobo.929.1">This will show the </span><span class="No-Break"><span class="koboSpan" id="kobo.930.1">following information:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer265">
<span class="koboSpan" id="kobo.931.1"><img alt="Figure 9.17 – firewall-cmd --list-all" src="image/B18349_09_17.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.932.1">Figure 9.17 – firewall-cmd --list-all</span></p>
<p><span class="koboSpan" id="kobo.933.1">The output of the preceding command displays a comprehensive summary of the active firewall rules and configurations</span><a id="_idIndexMarker913"/><span class="koboSpan" id="kobo.934.1"> managed by firewalld on a Linux system. </span><span class="koboSpan" id="kobo.934.2">The output is organized</span><a id="_idIndexMarker914"/><span class="koboSpan" id="kobo.935.1"> into </span><span class="No-Break"><span class="koboSpan" id="kobo.936.1">several sections:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.937.1">public</span></strong><span class="koboSpan" id="kobo.938.1"> (active): This line displays the name of the active firewall zone, which in this example is the public zone. </span><span class="koboSpan" id="kobo.938.2">When </span><strong class="source-inline"><span class="koboSpan" id="kobo.939.1">Target:default</span></strong><span class="koboSpan" id="kobo.940.1"> is present, this indicates that this is the default zone and that it is </span><span class="No-Break"><span class="koboSpan" id="kobo.941.1">currently active.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.942.1">interfaces: enp0s3 enp0s8</span></strong><span class="koboSpan" id="kobo.943.1">: This line shows the network interface(s) that is assigned to the active firewall zone. </span><span class="koboSpan" id="kobo.943.2">In this example, both the </span><strong class="source-inline"><span class="koboSpan" id="kobo.944.1">enp0s3</span></strong><span class="koboSpan" id="kobo.945.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.946.1">enp0s8</span></strong><span class="koboSpan" id="kobo.947.1"> interfaces are assigned to the </span><span class="No-Break"><span class="koboSpan" id="kobo.948.1">public zone.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.949.1">sources</span></strong><span class="koboSpan" id="kobo.950.1">: This line displays the IP addresses or network ranges that are allowed to access the firewall zone. </span><span class="koboSpan" id="kobo.950.2">If no sources are defined, this line will </span><span class="No-Break"><span class="koboSpan" id="kobo.951.1">be blank.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.952.1">services: cockpit dhcpv6-client ssh</span></strong><span class="koboSpan" id="kobo.953.1">: This line lists the services that are allowed to access the firewall zone. </span><span class="koboSpan" id="kobo.953.2">In this example, incoming traffic for the cockpit, </span><strong class="source-inline"><span class="koboSpan" id="kobo.954.1">dhcpv6-client</span></strong><span class="koboSpan" id="kobo.955.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.956.1">ssh</span></strong><span class="koboSpan" id="kobo.957.1"> services </span><span class="No-Break"><span class="koboSpan" id="kobo.958.1">are allowed.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.959.1">ports</span></strong><span class="koboSpan" id="kobo.960.1">: This line shows the TCP and UDP ports that are allowed to access the firewall zone. </span><span class="koboSpan" id="kobo.960.2">If no ports are defined, this line will </span><span class="No-Break"><span class="koboSpan" id="kobo.961.1">be blank.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.962.1">protocols</span></strong><span class="koboSpan" id="kobo.963.1">: This line shows protocols, such as TCP/UDP/ICMP, that are managed at a </span><span class="No-Break"><span class="koboSpan" id="kobo.964.1">protocol level.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.965.1">forward</span></strong><span class="koboSpan" id="kobo.966.1">: This shows whether zone forwarding </span><span class="No-Break"><span class="koboSpan" id="kobo.967.1">is enabled.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.968.1">masquerade: no</span></strong><span class="koboSpan" id="kobo.969.1">: This line indicates whether masquerading is enabled or disabled for the firewall zone. </span><span class="koboSpan" id="kobo.969.2">Masquerading allows packets from one network to appear as if they are coming from </span><span class="No-Break"><span class="koboSpan" id="kobo.970.1">another network.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.971.1">forward-ports</span></strong><span class="koboSpan" id="kobo.972.1">: This line shows any forwarded ports that are defined for the firewall zone. </span><span class="koboSpan" id="kobo.972.2">Forwarded ports allow incoming traffic on a specific port to be redirected to a different port or </span><span class="No-Break"><span class="koboSpan" id="kobo.973.1">IP address.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.974.1">source-ports</span></strong><span class="koboSpan" id="kobo.975.1">: This line shows any source ports that are defined for the firewall zone. </span><span class="koboSpan" id="kobo.975.2">Source ports allow incoming traffic from a specific port to be redirected to a different port or </span><span class="No-Break"><span class="koboSpan" id="kobo.976.1">IP address.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.977.1">icmp-blocks</span></strong><span class="koboSpan" id="kobo.978.1">: This line displays any </span><strong class="bold"><span class="koboSpan" id="kobo.979.1">Internet Control Message Protocol</span></strong><span class="koboSpan" id="kobo.980.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.981.1">ICMP</span></strong><span class="koboSpan" id="kobo.982.1">) packets that are blocked by the firewall. </span><span class="koboSpan" id="kobo.982.2">ICMP </span><a id="_idIndexMarker915"/><span class="koboSpan" id="kobo.983.1">packets are used for network diagnostics </span><span class="No-Break"><span class="koboSpan" id="kobo.984.1">and troubleshooting.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.985.1">rich rules</span></strong><span class="koboSpan" id="kobo.986.1">: This line shows any rich rules that are defined for the firewall zone. </span><span class="koboSpan" id="kobo.986.2">Rich rules allow more complex rules to be defined using a syntax that is similar to the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.987.1">iptables</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.988.1"> syntax.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.989.1">Adding new rules is easy to do. </span><span class="koboSpan" id="kobo.989.2">A rule</span><a id="_idIndexMarker916"/><span class="koboSpan" id="kobo.990.1"> can be added using the service name (found in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.991.1">/etc/services</span></strong><span class="koboSpan" id="kobo.992.1"> file) or the port number. </span><span class="koboSpan" id="kobo.992.2">The most common task is to add a common </span><a id="_idIndexMarker917"/><span class="koboSpan" id="kobo.993.1">user service, such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.994.1">http</span></strong><span class="koboSpan" id="kobo.995.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.996.1">mysql</span></strong><span class="koboSpan" id="kobo.997.1">. </span><span class="koboSpan" id="kobo.997.2">This is done by adding the </span><strong class="source-inline"><span class="koboSpan" id="kobo.998.1">--add-service</span></strong><span class="koboSpan" id="kobo.999.1"> option to the command. </span><span class="koboSpan" id="kobo.999.2">When the service is added, the configuration will not survive a reboot unless the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1000.1">--permanent</span></strong><span class="koboSpan" id="kobo.1001.1"> option is added. </span><span class="koboSpan" id="kobo.1001.2">Some common examples are </span><span class="No-Break"><span class="koboSpan" id="kobo.1002.1">as follows:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1003.1">
firewall-cmd --permanent --add-service=http
firewall-cmd --permanent --add-service=imap
firewall-cmd --permanent --add-service=pop
firewall-cmd --permanent --add-service=mysql</span></pre> <p><span class="koboSpan" id="kobo.1004.1">Optionally, you can specify the protocol and port to allow the service. </span><span class="koboSpan" id="kobo.1004.2">The following are examples of adding TCP or </span><span class="No-Break"><span class="koboSpan" id="kobo.1005.1">UDP ports:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1006.1">
firewall-cmd --permanent --add-port=1521/TCP
firewall-cmd --permanent --add-port=6900/UDP</span></pre> <p><span class="koboSpan" id="kobo.1007.1">You can also remove a port or service by using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1008.1">--remove-port</span></strong><span class="koboSpan" id="kobo.1009.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.1010.1">--</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1011.1">remove-service</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1012.1"> options:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1013.1">
firewall-cmd --permanent --remove-service=pop
firewall-cmd --permanent --remove-port=6900/UDP</span></pre> <p><span class="koboSpan" id="kobo.1014.1">When you are done making changes, you will need to reload the fi</span><a id="_idTextAnchor298"/><span class="koboSpan" id="kobo.1015.1">rewall rules. </span><span class="koboSpan" id="kobo.1015.2">This is done with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1016.1">--</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1017.1">reload</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1018.1"> option:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1019.1">
firewall-cmd --reload</span></pre> <h2 id="_idParaDest-216"><a id="_idTextAnchor299"/><span class="koboSpan" id="kobo.1020.1">How it works…</span></h2>
<p><span class="koboSpan" id="kobo.1021.1">firewalld is based on the netfilter</span><a id="_idIndexMarker918"/><span class="koboSpan" id="kobo.1022.1"> framework, which is a set of hooks that allows network packets to be filtered by the kernel. </span><span class="koboSpan" id="kobo.1022.2">This framework is used to implement the iptables firewall on many Linux systems. </span><span class="koboSpan" id="kobo.1022.3">firewalld provides a higher-level abstraction of the netfilter framework, allowing administrators to define rules in terms of services, ports, and protocols rather than directly manipulating iptables rules. </span><span class="koboSpan" id="kobo.1022.4">One of the key advantages of firewalld is its ability to define firewall rules that match on multiple attributes. </span><span class="koboSpan" id="kobo.1022.5">For example, administrators can define a rule that matches on both the source and destination IP address, as well as the protocol and port number. </span><span class="koboSpan" id="kobo.1022.6">This allows more granular control over network traffic and makes it easier to define complex </span><span class="No-Break"><span class="koboSpan" id="kobo.1023.1">firewall policies.</span></span></p>
<p><span class="koboSpan" id="kobo.1024.1">firewalld also allows</span><a id="_idIndexMarker919"/><span class="koboSpan" id="kobo.1025.1"> administrators to define firewall rules in terms of network zones. </span><span class="koboSpan" id="kobo.1025.2">A zone</span><a id="_idIndexMarker920"/><span class="koboSpan" id="kobo.1026.1"> is a set of network interfaces that are assigned a specific level of trust. </span><span class="koboSpan" id="kobo.1026.2">For example, an administrator might define a public zone for network interfaces that are exposed to the internet and a trusted zone for network interfaces that are only accessible from trusted internal networks. </span><span class="koboSpan" id="kobo.1026.3">Each zone can have its own set of firewall rules, allowing administrators to apply different policies to different </span><span class="No-Break"><span class="koboSpan" id="kobo.1027.1">network interfaces.</span></span></p>
<h1 id="_idParaDest-217"><a id="_idTextAnchor300"/><span class="koboSpan" id="kobo.1028.1">Keeping SELinux active</span></h1>
<p><strong class="bold"><span class="koboSpan" id="kobo.1029.1">SELinux</span></strong><span class="koboSpan" id="kobo.1030.1">, or </span><strong class="bold"><span class="koboSpan" id="kobo.1031.1">Security-Enhanced Linux</span></strong><span class="koboSpan" id="kobo.1032.1">, is a security module that provides </span><strong class="bold"><span class="koboSpan" id="kobo.1033.1">mandatory access control</span></strong><span class="koboSpan" id="kobo.1034.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.1035.1">MAC</span></strong><span class="koboSpan" id="kobo.1036.1">) policies in the Linux kernel. </span><span class="koboSpan" id="kobo.1036.2">It is needed because it offers</span><a id="_idIndexMarker921"/><span class="koboSpan" id="kobo.1037.1"> a higher level of security</span><a id="_idIndexMarker922"/><span class="koboSpan" id="kobo.1038.1"> for Linux systems by enforcing strict rules on what processes</span><a id="_idIndexMarker923"/><span class="koboSpan" id="kobo.1039.1"> and users can do on the system. </span><span class="koboSpan" id="kobo.1039.2">By default, Linux uses </span><strong class="bold"><span class="koboSpan" id="kobo.1040.1">discretionary access control</span></strong><span class="koboSpan" id="kobo.1041.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.1042.1">DAC</span></strong><span class="koboSpan" id="kobo.1043.1">), which means that any user or process can access any file or resource, as long as they have the appropriate permissions. </span><span class="koboSpan" id="kobo.1043.2">This can lead to security vulnerabilities, as any compromised process or user can potentially access and modify sensitive data or </span><span class="No-Break"><span class="koboSpan" id="kobo.1044.1">system files.</span></span></p>
<p><span class="koboSpan" id="kobo.1045.1">SELinux adds an extra layer of security by enforcing mandatory access control policies that restrict access to files and resources based on the security context of the process or user. </span><span class="koboSpan" id="kobo.1045.2">This means that even if a process or user has the appropriate permissions, they will only be able to access resources that are explicitly allowed by the </span><span class="No-Break"><span class="koboSpan" id="kobo.1046.1">SELinux policy.</span></span></p>
<p><span class="koboSpan" id="kobo.1047.1">This recipe will cover how</span><a id="_idIndexMarker924"/><span class="koboSpan" id="kobo.1048.1"> to create a custom SELinux policy instead of disabling it and how to allow services to do things such as bind to low </span><span class="No-Break"><span class="koboSpan" id="kobo.1049.1">ports (&lt;</span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1050.1">1024</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1051.1">).</span></span></p>
<h2 id="_idParaDest-218"><a id="_idTextAnchor301"/><span class="koboSpan" id="kobo.1052.1">Getting ready</span></h2>
<p><span class="koboSpan" id="kobo.1053.1">As with the other test, we will need an Oracle Linux system to play with. </span><span class="koboSpan" id="kobo.1053.2">Nothing else is required. </span><span class="koboSpan" id="kobo.1053.3">The system is enabled by default on most installations. </span><span class="koboSpan" id="kobo.1053.4">To see the status of SELinux, you can use the command </span><strong class="source-inline"><span class="koboSpan" id="kobo.1054.1">getenforce</span></strong><span class="koboSpan" id="kobo.1055.1">. </span><span class="koboSpan" id="kobo.1055.2">The command will return the current active</span><a id="_idIndexMarker925"/><span class="koboSpan" id="kobo.1056.1"> state. </span><span class="koboSpan" id="kobo.1056.2">There are </span><span class="No-Break"><span class="koboSpan" id="kobo.1057.1">three states:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1058.1">enforcing</span></strong><span class="koboSpan" id="kobo.1059.1"> – SELinux is active and blocking activity that is </span><span class="No-Break"><span class="koboSpan" id="kobo.1060.1">not allowed</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1061.1">permissive</span></strong><span class="koboSpan" id="kobo.1062.1"> – SELinux is enabled, but will not block </span><span class="No-Break"><span class="koboSpan" id="kobo.1063.1">any activity</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1064.1">disabled</span></strong><span class="koboSpan" id="kobo.1065.1"> – SELinux </span><span class="No-Break"><span class="koboSpan" id="kobo.1066.1">is disabled</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.1067.1">Addition commands are available if you install the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1068.1">setools</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1069.1">using </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1070.1">dnf</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1071.1">:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1072.1">
dnf install -y setools-console</span></pre> <p><span class="koboSpan" id="kobo.1073.1">You can also use the command </span><strong class="source-inline"><span class="koboSpan" id="kobo.1074.1">sestatus</span></strong><span class="koboSpan" id="kobo.1075.1"> to get more information </span><span class="No-Break"><span class="koboSpan" id="kobo.1076.1">about SELinux:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1077.1">
[root@ol8 ~]# sestatus
SELinux status:                         enabled
SELinuxfs mount:                    /sys/fs/selinux
SELinux root directory:             /etc/selinux
Loaded policy name:              targeted
Current mode:                    enforcing
Mode from config file:           enforcing
Policy MLS status:               enabled
Policy deny_unknown status:     allowed
Memory protection checking:     actual (secure)
Max kernel policy version:       31</span></pre> <p><span class="koboSpan" id="kobo.1078.1">You can also use the SELinux type to manage resources. </span><span class="koboSpan" id="kobo.1078.2">SELinux types are labels used to classify various resources in a Linux system, such as processes, files, directories, and network ports. </span><span class="koboSpan" id="kobo.1078.3">SELinux types are an important part of SELinux security policies, as they determine which processes and users can access specific resources on </span><span class="No-Break"><span class="koboSpan" id="kobo.1079.1">the system.</span></span></p>
<p><span class="koboSpan" id="kobo.1080.1">There are several types of SELinux types, including </span><span class="No-Break"><span class="koboSpan" id="kobo.1081.1">the following:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.1082.1">User types</span></strong><span class="koboSpan" id="kobo.1083.1">: User types are used</span><a id="_idIndexMarker926"/><span class="koboSpan" id="kobo.1084.1"> to define the security context of a user. </span><span class="koboSpan" id="kobo.1084.2">They are also used to confine the actions of a user to a specific set of resources on </span><span class="No-Break"><span class="koboSpan" id="kobo.1085.1">the system.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.1086.1">Role types</span></strong><span class="koboSpan" id="kobo.1087.1">: Role types are used</span><a id="_idIndexMarker927"/><span class="koboSpan" id="kobo.1088.1"> to define the security context of a role. </span><span class="koboSpan" id="kobo.1088.2">They are also used to confine the actions of a user to a specific set of resources on </span><span class="No-Break"><span class="koboSpan" id="kobo.1089.1">the system.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.1090.1">Domain types</span></strong><span class="koboSpan" id="kobo.1091.1">: Domain types are used</span><a id="_idIndexMarker928"/><span class="koboSpan" id="kobo.1092.1"> to define the security context of a process. </span><span class="koboSpan" id="kobo.1092.2">Each process on the system is assigned a unique domain type, which determines which resources the process </span><span class="No-Break"><span class="koboSpan" id="kobo.1093.1">can access.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.1094.1">Type enforcement types</span></strong><span class="koboSpan" id="kobo.1095.1">: Type enforcement types</span><a id="_idIndexMarker929"/><span class="koboSpan" id="kobo.1096.1"> are used to define the security context of a file or directory and confine the actions of a process to a specific set of resources on </span><span class="No-Break"><span class="koboSpan" id="kobo.1097.1">the system.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.1098.1">Network port type</span></strong><span class="koboSpan" id="kobo.1099.1">s: Network port types are used</span><a id="_idIndexMarker930"/><span class="koboSpan" id="kobo.1100.1"> to define the security context of a network port. </span><span class="koboSpan" id="kobo.1100.2">Network port types are used to restrict network access to specific ports or services on </span><span class="No-Break"><span class="koboSpan" id="kobo.1101.1">the system.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.1102.1">In addition to these types, there are also several special types used by SELinux, such as the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1103.1">unconfined_t</span></strong><span class="koboSpan" id="kobo.1104.1"> type, which is used for processes that are not confined by SELinux, and the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1105.1">system_u</span></strong><span class="koboSpan" id="kobo.1106.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1107.1">root_t</span></strong><span class="koboSpan" id="kobo.1108.1"> types, which are used for system resources </span><span class="No-Break"><span class="koboSpan" id="kobo.1109.1">and processes.</span></span></p>
<h2 id="_idParaDest-219"><a id="_idTextAnchor302"/><span class="koboSpan" id="kobo.1110.1">How to do it…</span></h2>
<p><span class="koboSpan" id="kobo.1111.1">The state of SELinux </span><a id="_idIndexMarker931"/><span class="koboSpan" id="kobo.1112.1">can be changed on the fly using the command </span><strong class="source-inline"><span class="koboSpan" id="kobo.1113.1">setenforce</span></strong><span class="koboSpan" id="kobo.1114.1"> with the parameters </span><strong class="source-inline"><span class="koboSpan" id="kobo.1115.1">1</span></strong><span class="koboSpan" id="kobo.1116.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.1117.1">0</span></strong><span class="koboSpan" id="kobo.1118.1">. </span><span class="koboSpan" id="kobo.1118.2">Using </span><strong class="source-inline"><span class="koboSpan" id="kobo.1119.1">1</span></strong><span class="koboSpan" id="kobo.1120.1"> puts SELinux into </span><strong class="source-inline"><span class="koboSpan" id="kobo.1121.1">enforcing</span></strong><span class="koboSpan" id="kobo.1122.1"> mode, while </span><strong class="source-inline"><span class="koboSpan" id="kobo.1123.1">0</span></strong><span class="koboSpan" id="kobo.1124.1"> puts it into </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1125.1">permissive</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1126.1"> mode.</span></span></p>
<p><span class="koboSpan" id="kobo.1127.1">Additionally, you can edit the configuration file, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1128.1">/etc/selinux/config</span></strong><span class="koboSpan" id="kobo.1129.1">, and set the field SELinux to any one of the three states. </span><span class="koboSpan" id="kobo.1129.2">This is also the only way to </span><span class="No-Break"><span class="koboSpan" id="kobo.1130.1">disable SELinux.</span></span></p>
<p><span class="koboSpan" id="kobo.1131.1">While disabling SELinux is tempting for many admins, it can easily be updated to allow the </span><span class="No-Break"><span class="koboSpan" id="kobo.1132.1">required behavior.</span></span></p>
<p><span class="koboSpan" id="kobo.1133.1">SELinux also logs to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1134.1">/var/log/audit/audit.log</span></strong><span class="koboSpan" id="kobo.1135.1"> file </span><span class="No-Break"><span class="koboSpan" id="kobo.1136.1">by default.</span></span></p>
<h2 id="_idParaDest-220"><a id="_idTextAnchor303"/><span class="koboSpan" id="kobo.1137.1">How it works…</span></h2>
<p><span class="koboSpan" id="kobo.1138.1">SELinux has several layers of security managing files, ports, and kernel modules. </span><span class="koboSpan" id="kobo.1138.2">They are all managed by the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1139.1">semanage</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1140.1"> command.</span></span></p>
<h3><span class="koboSpan" id="kobo.1141.1">semanage</span></h3>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.1142.1">semanage</span></strong><span class="koboSpan" id="kobo.1143.1"> is a command-line tool</span><a id="_idIndexMarker932"/><span class="koboSpan" id="kobo.1144.1"> used that's to manage SELinux policies in Linux systems. </span><span class="koboSpan" id="kobo.1144.2">It is used to create, modify, or delete SELinux policies, as well as manage file contexts and network ports. </span><span class="koboSpan" id="kobo.1144.3">Here are some common uses of the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1145.1">semanage</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1146.1"> command:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1147.1">semanage</span></strong><span class="koboSpan" id="kobo.1148.1"> can be used to create, modify, or delete policy modules. </span><span class="koboSpan" id="kobo.1148.2">For example, you can create a new policy </span><a id="_idIndexMarker933"/><span class="koboSpan" id="kobo.1149.1">module with the </span><span class="No-Break"><span class="koboSpan" id="kobo.1150.1">following command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1151.1">semanage module -a kernelmodule.pp</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.1152.1">This will add the policy module </span><strong class="source-inline"><span class="koboSpan" id="kobo.1153.1">kernelmodule.pp</span></strong><span class="koboSpan" id="kobo.1154.1"> to the </span><span class="No-Break"><span class="koboSpan" id="kobo.1155.1">SELinux policy.</span></span></p></li> <li><strong class="source-inline"><span class="koboSpan" id="kobo.1156.1">semanage</span></strong><span class="koboSpan" id="kobo.1157.1"> can be used to manage file contexts, including adding or modifying contexts for specific files or directories. </span><span class="koboSpan" id="kobo.1157.2">For example, you can add a new file context with the </span><span class="No-Break"><span class="koboSpan" id="kobo.1158.1">following command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1159.1">semanage fcontext -a -t httpd_sys_content_t '/var/www/html(/.*)?'</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.1160.1">This will add a new file context that allows the HTTPd process to access files and directories </span><span class="No-Break"><span class="koboSpan" id="kobo.1161.1">under </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1162.1">/var/www/html</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1163.1">.</span></span></p></li> <li><strong class="source-inline"><span class="koboSpan" id="kobo.1164.1">semanage</span></strong><span class="koboSpan" id="kobo.1165.1"> can be used to manage network ports and services, including adding or modifying port types and policies. </span><span class="koboSpan" id="kobo.1165.2">For example, you can define a new port type with the </span><span class="No-Break"><span class="koboSpan" id="kobo.1166.1">following command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1167.1">semanage port -a -t www2 -p tcp 8080</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.1168.1">This will add a new port type </span><strong class="source-inline"><span class="koboSpan" id="kobo.1169.1">www2</span></strong><span class="koboSpan" id="kobo.1170.1"> for TCP </span><span class="No-Break"><span class="koboSpan" id="kobo.1171.1">port </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1172.1">8080</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1173.1">.</span></span></p></li> <li><strong class="source-inline"><span class="koboSpan" id="kobo.1174.1">setsebool</span></strong><span class="koboSpan" id="kobo.1175.1">: SELinux has Boolean variables that can be either enabled or disabled to control specific security policies. </span><span class="koboSpan" id="kobo.1175.2">To change the value of these variables, you can use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1176.1">setsebool</span></strong><span class="koboSpan" id="kobo.1177.1"> command to enable or disable certain SELinux policies. </span><span class="koboSpan" id="kobo.1177.2">A useful example is when you set </span><strong class="source-inline"><span class="koboSpan" id="kobo.1178.1">httpd_can_network_connect</span></strong><span class="koboSpan" id="kobo.1179.1"> to true for a </span><span class="No-Break"><span class="koboSpan" id="kobo.1180.1">web server:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1181.1">setsebool -P httpd_can_netowork_connect on</span></strong></pre></li> <li><strong class="source-inline"><span class="koboSpan" id="kobo.1182.1">getsebool</span></strong><span class="koboSpan" id="kobo.1183.1">: To view the status of SELinux policies, you can use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1184.1">getsebool</span></strong><span class="koboSpan" id="kobo.1185.1"> command. </span><span class="koboSpan" id="kobo.1185.2">This command displays Boolean variables that can enable or disable certain policies. </span><span class="koboSpan" id="kobo.1185.3">To view all values, use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1186.1">-a</span></strong><span class="koboSpan" id="kobo.1187.1"> option. </span><span class="koboSpan" id="kobo.1187.2">Alternatively, you can pass</span><a id="_idIndexMarker934"/><span class="koboSpan" id="kobo.1188.1"> a specific value to check, as shown in </span><span class="No-Break"><span class="koboSpan" id="kobo.1189.1">this example:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1190.1">getsebool httpd_can_network_connect</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1191.1">httpd_can_network_connect --&gt; off</span></strong></pre></li> </ul>
<h3><span class="koboSpan" id="kobo.1192.1">SELinux fixfiles</span></h3>
<p><span class="koboSpan" id="kobo.1193.1">SELinux </span><strong class="source-inline"><span class="koboSpan" id="kobo.1194.1">fixfiles</span></strong><span class="koboSpan" id="kobo.1195.1"> is a command-line tool</span><a id="_idIndexMarker935"/><span class="koboSpan" id="kobo.1196.1"> that's used to restore the SELinux file contexts of files and directories. </span><span class="koboSpan" id="kobo.1196.2">SELinux uses file contexts to determine which processes and users can access specific files or directories on the system. </span><span class="koboSpan" id="kobo.1196.3">When file contexts are changed or corrupted, it can cause issues with system functionality or security. </span><span class="koboSpan" id="kobo.1196.4">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1197.1">fixfiles</span></strong><span class="koboSpan" id="kobo.1198.1"> command is used to restore the SELinux file contexts to their default values. </span><span class="koboSpan" id="kobo.1198.2">This can be useful when you encounter issues with file access or SELinux-related errors. </span><span class="koboSpan" id="kobo.1198.3">Here are some common ways</span><a id="_idIndexMarker936"/><span class="koboSpan" id="kobo.1199.1"> to use the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1200.1">fixfiles</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1201.1"> command:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.1202.1">Restore default file contexts for a directory</span></strong><span class="koboSpan" id="kobo.1203.1">: To restore the default file contexts for a specific directory, you can use the </span><span class="No-Break"><span class="koboSpan" id="kobo.1204.1">following command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1205.1">fixfiles restore /directory_to_fix</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.1206.1">This will recursively restore the default file contexts for all files and directories within the </span><span class="No-Break"><span class="koboSpan" id="kobo.1207.1">specified directory.</span></span></p></li> <li><strong class="bold"><span class="koboSpan" id="kobo.1208.1">Restore default file contexts for the entire system</span></strong><span class="koboSpan" id="kobo.1209.1">: To restore the default file contexts for the entire system, run the </span><span class="No-Break"><span class="koboSpan" id="kobo.1210.1">following command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1211.1">fixfiles restore</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.1212.1">This will restore</span><a id="_idIndexMarker937"/><span class="koboSpan" id="kobo.1213.1"> the default file contexts for all files and directories on the system. </span><span class="koboSpan" id="kobo.1213.2">Note that this can take some time to complete and may cause temporary disruptions to </span><span class="No-Break"><span class="koboSpan" id="kobo.1214.1">system functionality.</span></span></p></li> <li><strong class="bold"><span class="koboSpan" id="kobo.1215.1">Verify file contexts</span></strong><span class="koboSpan" id="kobo.1216.1">: You can use the following command to verify the file contexts for a specific file </span><span class="No-Break"><span class="koboSpan" id="kobo.1217.1">or directory:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1218.1">matchpathcon /file_to_verify</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.1219.1">This will display the expected file context for the specified file or directory. </span><span class="koboSpan" id="kobo.1219.2">If the displayed context does not match the actual context, you can use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1220.1">fixfiles</span></strong><span class="koboSpan" id="kobo.1221.1"> command</span><a id="_idIndexMarker938"/><span class="koboSpan" id="kobo.1222.1"> to restore the </span><span class="No-Break"><span class="koboSpan" id="kobo.1223.1">default context.</span></span></p></li> </ul>
<p class="callout-heading"><span class="koboSpan" id="kobo.1224.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1225.1">If SELinux was disabled for any amount of time, these contexts would not have been set while it was not running. </span><span class="koboSpan" id="kobo.1225.2">There is a shortcut to get SELinux to re-label the entire filesystem hierarchy: </span><strong class="source-inline"><span class="koboSpan" id="kobo.1226.1"># </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1227.1">touch /.autorelabel</span></strong></span></p>
<p class="callout"><span class="koboSpan" id="kobo.1228.1">Now reboot the machine. </span><span class="koboSpan" id="kobo.1228.2">As SELinux starts, it will set all file and security contexts to the default for each type </span><span class="No-Break"><span class="koboSpan" id="kobo.1229.1">and location.</span></span></p>
<h3><span class="koboSpan" id="kobo.1230.1">SELinux users</span></h3>
<p><span class="koboSpan" id="kobo.1231.1">SELinux users are labels</span><a id="_idIndexMarker939"/><span class="koboSpan" id="kobo.1232.1"> used to classify different types of users in a Linux system. </span><span class="koboSpan" id="kobo.1232.2">SELinux users are an important part of SELinux security policies, as they are used to confine the actions of a user to a specific set of resources on </span><span class="No-Break"><span class="koboSpan" id="kobo.1233.1">the system.</span></span></p>
<p><span class="koboSpan" id="kobo.1234.1">There are several types of </span><span class="No-Break"><span class="koboSpan" id="kobo.1235.1">SELinux users:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.1236.1">System users</span></strong><span class="koboSpan" id="kobo.1237.1">: System users are users</span><a id="_idIndexMarker940"/><span class="koboSpan" id="kobo.1238.1"> that are defined by the system and are used to run system services or daemons. </span><span class="koboSpan" id="kobo.1238.2">These users are typically assigned a unique SELinux user label, which is used to confine the actions of the user to a specific set of resources on </span><span class="No-Break"><span class="koboSpan" id="kobo.1239.1">the system.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.1240.1">Login users</span></strong><span class="koboSpan" id="kobo.1241.1">: Login users are users that are defined</span><a id="_idIndexMarker941"/><span class="koboSpan" id="kobo.1242.1"> by the system and are used to log into the system. </span><span class="koboSpan" id="kobo.1242.2">These users are typically assigned a unique SELinux user label, which is used to confine the actions of the user to a specific set of resources on </span><span class="No-Break"><span class="koboSpan" id="kobo.1243.1">the system.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.1244.1">Staff users</span></strong><span class="koboSpan" id="kobo.1245.1">: Staff users are users that are defined</span><a id="_idIndexMarker942"/><span class="koboSpan" id="kobo.1246.1"> by the system and are used by staff members to perform their work. </span><span class="koboSpan" id="kobo.1246.2">These users are typically assigned a unique SELinux user label, which is used to confine the actions of the user to a specific set of resources on </span><span class="No-Break"><span class="koboSpan" id="kobo.1247.1">the system.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.1248.1">User-defined users</span></strong><span class="koboSpan" id="kobo.1249.1">: User-defined users are users</span><a id="_idIndexMarker943"/><span class="koboSpan" id="kobo.1250.1"> that are defined by the system administrator. </span><span class="koboSpan" id="kobo.1250.2">These users are typically assigned a unique SELinux user label, which is used to confine the actions of the user to a specific set of resources on </span><span class="No-Break"><span class="koboSpan" id="kobo.1251.1">the system.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.1252.1">Here are some of the commonly</span><a id="_idIndexMarker944"/><span class="koboSpan" id="kobo.1253.1"> used SELinux </span><span class="No-Break"><span class="koboSpan" id="kobo.1254.1">user commands:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1255.1">semanage user</span></strong><span class="koboSpan" id="kobo.1256.1">: This command is used to manage SELinux users and their properties. </span><span class="koboSpan" id="kobo.1256.2">For example, to create a new SELinux user, you can use the command </span><strong class="source-inline"><span class="koboSpan" id="kobo.1257.1">semanage user -a -R "s0-s0:c0.c1023" -r s0 -L s0:c0.c1023 -P user -</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1258.1">n username</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1259.1">.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1260.1">semanage login</span></strong><span class="koboSpan" id="kobo.1261.1">: This command is used to manage SELinux login mappings, which map system users to SELinux users. </span><span class="koboSpan" id="kobo.1261.2">For example, to create a new login mapping, you can use the command </span><strong class="source-inline"><span class="koboSpan" id="kobo.1262.1">semanage login -a -s user_u -r </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1263.1">s0 username</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1264.1">.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1265.1">semanage staff</span></strong><span class="koboSpan" id="kobo.1266.1">: This command is used to manage SELinux staff mappings, which map staff users to SELinux users. </span><span class="koboSpan" id="kobo.1266.2">For example, to create a new staff mapping, you can use the command </span><strong class="source-inline"><span class="koboSpan" id="kobo.1267.1">semanage staff -a -s user_u -r </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1268.1">s0 username</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1269.1">.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1270.1">semanage sudo</span></strong><span class="koboSpan" id="kobo.1271.1">: This command is used to manage SELinux sudo mappings, which map sudoers to SELinux users. </span><span class="koboSpan" id="kobo.1271.2">For example, to create a new sudo mapping, you can use the command </span><strong class="source-inline"><span class="koboSpan" id="kobo.1272.1">semanage sudo -a -r s0 -R "s0-s0:c0.c1023" -L s0:c0.c1023 -</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1273.1">U username</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1274.1">.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1275.1">semanage port</span></strong><span class="koboSpan" id="kobo.1276.1">: This command</span><a id="_idIndexMarker945"/><span class="koboSpan" id="kobo.1277.1"> is used to manage SELinux port mappings, which map ports to SELinux types. </span><span class="koboSpan" id="kobo.1277.2">For example, to create a new port mapping, you can use the command </span><strong class="source-inline"><span class="koboSpan" id="kobo.1278.1">semanage port -a -t http_port_t -p </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1279.1">tcp 80</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1280.1">.</span></span></li>
</ul>
</div>
</body></html>