- en: '2'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '2'
- en: Network File Storage – Expanding Your Knowledge of How to Share Data
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 网络文件存储 – 拓展你对如何共享数据的理解
- en: In this chapter, we’re going to cover the topics of **Network File Storage**
    (**NFS**) and Samba using **Server Message Block** (**SMB**) storage. These are
    two network-based file-sharing options. One (NFS) is heavily used in Linux, while
    the other is the mainstay of Windows, which is SMB (in our case, Samba). We are
    going to learn how to set up both of these target folders and share them with
    the world. We will go over making sure they are only available to those we are
    attempting to share access with. We will show how we can ensure that unauthorized
    access does not occur – well, to the best of our abilities; people are sneaky.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将介绍**网络文件存储**（**NFS**）和通过**服务器消息块**（**SMB**）存储的 Samba。它们是两种基于网络的文件共享选项。一种（NFS）在
    Linux 中广泛使用，而另一种（SMB）则是 Windows 的主流，在我们的案例中是 Samba。我们将学习如何设置这两个目标文件夹，并与外界共享它们。我们还将确保这些共享文件夹仅对我们希望共享访问权限的人可用。我们会展示如何确保不发生未授权的访问——尽管我们会尽最大努力；毕竟，人们总是能找到一些巧妙的方法。
- en: After we set those up manually, we will work on setting them up through automation
    using Ansible. This can make it extremely easy to set up new servers to access
    file shares that are needed for every new server in an automated fashion. This
    ensures that each new server has the required access without worrying whether
    you forgot to add one of the folders. Automation helps take the headache out of
    system admin work and with Ansible, it is even easier. Let’s get started in the
    world of NFS; it only makes our lives easier.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们手动设置好这些环境后，我们将通过自动化工具 Ansible 来设置它们。这可以极大地方便新服务器的配置，使其能够以自动化的方式访问每个新服务器所需的文件共享。这样可以确保每个新服务器都能获得必要的访问权限，而不必担心是否遗漏了某个文件夹。自动化帮助减少了系统管理员工作的头痛，使用
    Ansible 后，操作变得更加简便。让我们一起进入 NFS 的世界，它只会让我们的生活更轻松。
- en: 'In this chapter, we will cover the following topics:'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将涵盖以下主题：
- en: NFS and SMB network storage – the way they work and when to choose one over
    the other
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: NFS 和 SMB 网络存储 – 它们的工作方式以及何时选择一个而非另一个
- en: NFS manual provisioning and deployment
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: NFS 手动配置与部署
- en: NFS Ansible Automation playbook creation and usage
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: NFS Ansible 自动化剧本创建与使用
- en: SMB storage manual provisioning and deployment
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: SMB 存储的手动配置与部署
- en: SMB storage Ansible Automation playbook creation and usage
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: SMB 存储 Ansible 自动化剧本创建与使用
- en: Technical requirements
  id: totrans-10
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: This section covers the technical requirements for this chapter.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 本节涵盖本章的技术要求。
- en: Setting up GitHub access
  id: totrans-12
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 设置 GitHub 访问权限
- en: 'Please refer to [*Chapter 1*](B18607_01.xhtml#_idTextAnchor016), *Block Storage
    – Learning How to Provision Block Storage on Red Hat Enterprise Linux*, for gaining
    access to GitHub. You will find the Ansible Automation playbooks for this chapter
    at the following link: [https://github.com/PacktPublishing/Red-Hat-Certified-Specialist-in-Services-Management-and-Automation-EX358-Exam-Guide/tree/main/Chapter02](https://github.com/PacktPublishing/Red-Hat-Certified-Specialist-in-Services-Management-and-Automation-EX358-Exam-Guide/tree/main/Chapter02).
    Remember, these are suggested playbooks and are not the only way you can write
    them to make the playbooks work for you.'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 请参考[*第 1 章*](B18607_01.xhtml#_idTextAnchor016)，*块存储 – 学习如何在 Red Hat Enterprise
    Linux 上配置块存储*，以获取 GitHub 访问权限。你可以在以下链接中找到本章的 Ansible 自动化剧本：[https://github.com/PacktPublishing/Red-Hat-Certified-Specialist-in-Services-Management-and-Automation-EX358-Exam-Guide/tree/main/Chapter02](https://github.com/PacktPublishing/Red-Hat-Certified-Specialist-in-Services-Management-and-Automation-EX358-Exam-Guide/tree/main/Chapter02)。记住，这些是推荐的剧本，并不是唯一能够让剧本起作用的方法。
- en: You can always change them up using `raw`, `shell`, or `cmd` to achieve the
    same results, but we are demonstrating the best way to accomplish the goals. Also,
    keep in mind that we are not using the **Fully Qaulified Collection Name** (**FQCN**)
    that is needed in the future version of Ansible, as that will not be supported
    in the exam as it is testing against Ansible 2.9.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以使用 `raw`、`shell` 或 `cmd` 来改变配置以实现相同的结果，但我们展示的是实现目标的最佳方法。同时请注意，我们没有使用将来版本的
    Ansible 所需的**完全限定集合名称**（**FQCN**），因为该功能在考试中并不支持，考试所用的是 Ansible 2.9 版本。
- en: Setting up your lab environment for NFS and SMB
  id: totrans-15
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 设置 NFS 和 SMB 的实验环境
- en: Please refer to the setup of the lab environment from [*Chapter 1*](B18607_01.xhtml#_idTextAnchor016),
    *Block Storage – Learning How to Provision Block Storage on Red Hat Enterprise
    Linux*, if not already completed. You can also use this opportunity to create
    snapshots of your environment so that you can revert to them and do the hands-on
    exercises over and over again. This can be accomplished as follows.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 如果尚未完成，请参考[*第 1 章*](B18607_01.xhtml#_idTextAnchor016)的实验环境设置，*块存储 – 在 Red Hat
    Enterprise Linux 上学习如何配置块存储*。你还可以利用这个机会创建你环境的快照，这样你就可以恢复到这些快照并一遍又一遍地进行实际操作练习。可以按以下步骤进行：
- en: 'Snapshots are easy to create in VirtualBox: you simply need to click on the
    following button that is selected with the mouse cursor to create a snapshot:'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 在 VirtualBox 中创建快照非常简单：只需点击下方按钮并用鼠标光标选中即可创建快照：
- en: "![Figure 2.1 – VirtualBox options button to open snapshot \uFEFFcreation](img/Figure_2.01_B18607.jpg)"
  id: totrans-18
  prefs: []
  type: TYPE_IMG
  zh: '![图 2.1 – VirtualBox 打开快照创建的选项按钮](img/Figure_2.01_B18607.jpg)'
- en: Figure 2.1 – VirtualBox options button to open snapshot creation
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 图 2.1 – VirtualBox 打开快照创建的选项按钮
- en: 'Click to take one at the top and then name your snapshot. This will allow you
    to determine the state of the machine image when the snapshot was taken. This
    can be seen in the following figure:'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 点击顶部的按钮进行拍摄，然后为你的快照命名。这将让你能够确定拍摄快照时机器镜像的状态。可以在下图中看到：
- en: '![Figure 2.2 – VirtualBox snapshot save feature](img/Figure_2.02_B18607.jpg)'
  id: totrans-21
  prefs: []
  type: TYPE_IMG
  zh: '![图 2.2 – VirtualBox 快照保存功能](img/Figure_2.02_B18607.jpg)'
- en: Figure 2.2 – VirtualBox snapshot save feature
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 图 2.2 – VirtualBox 快照保存功能
- en: This will wrap up taking a snapshot in order to revert to previous states for
    repeated hands-on rework. Now, let’s get into the storage wars.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 这将总结如何拍摄快照以便恢复到先前的状态，进行反复的实际操作。接下来，让我们进入存储战争。
- en: NFS and SMB network storage – the way they work and when to choose one over
    the other
  id: totrans-24
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: NFS 和 SMB 网络存储 – 它们的工作方式以及何时选择其中之一而非另一个
- en: NFS is a great way to share files across Linux systems. It is machine-based
    authentication so the system can have access to the files for all users. This
    is great for Linux when sharing small files as the speed is increased and the
    system shares are retrieved more efficiently. SMB, on the other hand, is user
    authentication-based and better suited for interactions with Windows computers.
    So, if you have a multivendor environment, it might be worthwhile to set up SMB
    as it has the ability to share printers as well. This allows for file sharing
    as well as printer sharing, thus giving a slight multi-functional edge to the
    system to make up for the slight speed loss.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: NFS 是在 Linux 系统之间共享文件的一个好方法。它是基于机器的认证方式，因此系统可以让所有用户访问文件。这对于 Linux 系统共享小文件非常有用，因为它提高了速度，并且系统共享获取更高效。另一方面，SMB
    是基于用户认证的，更适合与 Windows 计算机进行交互。所以，如果你有一个多厂商环境，设置 SMB 可能是值得的，因为它还支持打印机共享。这既允许文件共享，也允许打印机共享，从而在系统上增加了一些多功能性，弥补了略微的速度损失。
- en: The differences in authentication make for some differences in setup and can
    lead to some headaches when it comes to making sure you are locking down the right
    permissions. SMB using user-based authentication is a bit better because, with
    NFS, anyone with access to the allowed machine can gain access to the files being
    shared. So, in reality, it is more of a toss-up of what you need, such as security
    or multivendor support in your environment, when it comes to choosing to implement
    either of the two. In most cases, both are actually implemented for different
    system uses.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 认证方式的差异带来了一些设置上的不同，也可能导致一些麻烦，特别是在确保正确锁定权限时。使用基于用户认证的 SMB 更好一些，因为在 NFS 中，任何拥有访问权限的机器都可以访问共享的文件。所以，实际上，在选择实现这两者中的任何一个时，更多的是取决于你所需要的，比如安全性或多厂商支持。在大多数情况下，实际上会为不同的系统使用需求实现两者。
- en: Let’s go into a little more depth on NFS and what it can do for RHEL 8.1 users
    and Linux overall through setting it up hands-on. This will show you how to set
    up NFS manually and through automation. RHEL 8.1 supports NFSv3 and NFSv4\. NFSv3
    can use UDP and TCP, whereas NFSv4 uses TCP. Older versions are no longer supported.
    Let’s set up NFS on our systems.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们更深入地了解 NFS 以及它如何通过动手设置帮助 RHEL 8.1 用户和 Linux 系统整体。这将展示如何手动设置 NFS 以及通过自动化来设置。RHEL
    8.1 支持 NFSv3 和 NFSv4。NFSv3 可以使用 UDP 和 TCP，而 NFSv4 只使用 TCP。旧版本不再受支持。让我们开始在系统上设置
    NFS。
- en: Initially, we are going to install the package needed if it is not already installed.
    This package is the `nfs-utils` package and is needed for the client and the target
    machines. It provides all the tooling to access folders and mount the needed folders.
    By installing it on both the server and client, you ensure that you are able to
    enable all of the dependencies that are needed in order to run the service.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，如果还没有安装相关软件包，我们需要安装必需的软件包。这个软件包是 `nfs-utils`，它是客户端和目标机器所需的。它提供了所有访问文件夹和挂载所需的工具。通过在服务器和客户端上都安装它，你可以确保启用所有运行该服务所需的依赖项。
- en: 'Let’s install `nfs-utils` as shown in the following figure:'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们安装如以下图所示的 `nfs-utils`：
- en: '![Figure 2.3 – Installing the nfs-utils package](img/Figure_2.03_B18607.jpg)'
  id: totrans-30
  prefs: []
  type: TYPE_IMG
  zh: '![图 2.3 – 安装 nfs-utils 包](img/Figure_2.03_B18607.jpg)'
- en: Figure 2.3 – Installing the nfs-utils package
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 图 2.3 – 安装 nfs-utils 包
- en: 'Now, there is a small caveat that can lead to frustration – trust me, when
    writing this and running into the issue, I was boiling! After a large amount of
    troubleshooting, the current `2.3.3-51.el8` has a bug that will not allow the
    exports to share out correctly and the proper permissions to connect. So, after
    installing NFS, we need to downgrade it one step to `2.3.3-46.el8`, where the
    bug is not present. In the following figure, it is shown being downgraded:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，有一个小陷阱可能会让人感到沮丧——相信我，在写这段内容并遇到问题时，我差点炸了！经过大量故障排除后，当前版本 `2.3.3-51.el8` 存在一个bug，无法正确共享
    exports 以及连接时的适当权限。所以，在安装 NFS 后，我们需要将其降级到 `2.3.3-46.el8`，该版本没有此问题。以下图所示，演示了如何降级：
- en: '![Figure 2.4 – Downgrading nfs-utils](img/Figure_2.04_B18607.jpg)'
  id: totrans-33
  prefs: []
  type: TYPE_IMG
  zh: '![图 2.4 – 降级 nfs-utils](img/Figure_2.04_B18607.jpg)'
- en: Figure 2.4 – Downgrading nfs-utils
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 图 2.4 – 降级 nfs-utils
- en: This allows us to do our hands-on exercises without issue. Before, if you tried
    to do them, you would be banging your head on your keyboard much like I was.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 这样我们就可以顺利进行实践操作了。之前，如果你尝试做这些操作，可能会像我一样对着键盘发愁。
- en: 'After the correct version is installed, we are going to enable the daemon:'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 安装正确版本后，我们将启用守护进程：
- en: '[PRE0]'
  id: totrans-37
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Then, we have to open the firewall to ensure that connectivity is allowed:'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们需要打开防火墙以确保连接畅通：
- en: '[PRE1]'
  id: totrans-39
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Next up, we will be configuring the exports, which are what tell the NFS server
    what to allow out to the world. The settings are granular and allow for thorough
    control. The exports allow you to tell the system what can be read and by what
    machines. You can allow specific machines via DNS, IP, IP range, and so on.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将配置 exports，exports 告诉 NFS 服务器哪些内容可以对外共享。设置非常细致，允许进行充分的控制。通过 exports，你可以告诉系统哪些内容可以被哪些机器读取。你可以通过
    DNS、IP、IP 范围等方式指定允许访问的机器。
- en: 'First, let’s make a shared directory as root:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，让我们创建一个共享目录作为根目录：
- en: '[PRE2]'
  id: totrans-42
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: This will be the folder we share out to the world. Others will access this to
    read and write files. We will be editing the `/etc/exports` file to share out
    this folder.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 这是我们要共享给外界的文件夹。其他用户将访问该文件夹来读取和写入文件。我们将编辑 `/etc/exports` 文件来共享该文件夹。
- en: 'Here are some examples of a correctly formatted `exports` file. We will talk
    more about the settings shown in the following screenshot, such as (`rw`):'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 这里是一些正确格式化的`exports`文件的示例。我们将详细讨论以下截图中显示的设置，例如（`rw`）：
- en: '![Figure 2.5 – /etc/exports example file for NFS share folder](img/Figure_2.05_B18607.jpg)'
  id: totrans-45
  prefs: []
  type: TYPE_IMG
  zh: '![图 2.5 – /etc/exports 示例文件用于 NFS 共享文件夹](img/Figure_2.05_B18607.jpg)'
- en: Figure 2.5 – /etc/exports example file for NFS share folder
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 图 2.5 – /etc/exports 示例文件用于 NFS 共享文件夹
- en: As you can see, you can export NFS shares via DNS as noted. You can export via
    IP and IP range. You can use space delimited for multiple shared locations if
    you do not wish to stack them. You can also put restraints such as read-only or
    read-write. The `no_root_squash` function allows for root access to the directory
    instead of the `nobody` user being selected. By default, if a root client creates
    a file, the `nobody` user owns that file. This can cause issues with access to
    the file, so it is a good idea to use `no_root_squash`. This gives full root access
    to the files. Please be aware that the preceding is an example, and duplicates
    such as the ones shown will be ignored by NFS.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 如你所见，你可以通过 DNS 导出 NFS 共享。你也可以通过 IP 和 IP 范围进行导出。如果你不想堆叠多个共享位置，也可以使用空格分隔来指定多个共享位置。你还可以设置访问限制，例如只读或读写。`no_root_squash`
    功能允许根用户访问目录，而不是选择 `nobody` 用户。默认情况下，如果根用户创建文件，`nobody` 用户将拥有该文件。这可能会导致访问文件时出现问题，因此建议使用
    `no_root_squash`。这会为文件提供完全的 root 访问权限。请注意，以上是一个示例，NFS 会忽略类似的重复项。
- en: '![Figure 2.6 – Correct NFS /etc/exports file](img/Figure_2.06_B18607.jpg)'
  id: totrans-48
  prefs: []
  type: TYPE_IMG
  zh: '![图2.6 – 正确的NFS /etc/exports文件](img/Figure_2.06_B18607.jpg)'
- en: Figure 2.6 – Correct NFS /etc/exports file
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 图2.6 – 正确的NFS /etc/exports文件
- en: 'You then need to run `exportfs -r` in order to update the exports so that they
    are served to the endpoints:'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，您需要运行`exportfs -r`以更新导出，使它们能够被端点提供服务：
- en: '[PRE3]'
  id: totrans-51
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'You can then check your exports to ensure they are being served with the `exportfs`
    command:'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，您可以检查您的导出，确保它们通过`exportfs`命令被提供服务：
- en: '[PRE4]'
  id: totrans-53
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: Next, we are going to mount the folder on another system so that it can share
    files.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将把文件夹挂载到另一台系统上，以便共享文件。
- en: 'On RHEL3, we are going to run the `mount` command to mount the filesystem.
    You can also add this to `fstab` to make this permanent:'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 在RHEL3上，我们将运行`mount`命令来挂载文件系统。您也可以将其添加到`fstab`中以使其永久生效：
- en: '[PRE5]'
  id: totrans-56
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Here is an example of `fstab` for NFS as well:'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 这里也有一个NFS的`fstab`示例：
- en: '![Figure 2.7 – Example of what fstab would look like](img/Figure_2.07_B18607.jpg)'
  id: totrans-58
  prefs: []
  type: TYPE_IMG
  zh: '![图2.7 – fstab的示例](img/Figure_2.07_B18607.jpg)'
- en: Figure 2.7 – Example of what fstab would look like
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 图2.7 – fstab的示例
- en: After that, you should be able to go to the folder and add files to share. The
    other systems with access can also see these files.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 之后，您应该能够进入文件夹并添加共享文件。其他具有访问权限的系统也能看到这些文件。
- en: This concludes the walk-through of NFS and how to export it to systems manually.
    This is what you will be tested on in the exam. The bonus mounting of the system
    is for your understanding, and I hope that helps you in the future. Now we are
    going to talk about the automation of the process of NFS server provisioning.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 这就是对NFS的讲解，以及如何手动将其导出到系统中。考试中将会考察这个内容。系统挂载的附加内容是为了帮助您理解，希望未来对您有所帮助。接下来，我们将讨论NFS服务器配置过程的自动化。
- en: NFS Ansible Automation playbook creation and usage
  id: totrans-62
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: NFS Ansible自动化playbook的创建和使用
- en: 'We are going to delve deeper into the Ansible Automation playbook. We will
    fully break it down for the NFS exports. We are going to show each step of the
    playbook and what each item does. By *item*, we are referring to the variables
    and commands set within an Ansible playbook:'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将深入分析Ansible自动化playbook，完全拆解NFS导出的过程。我们将展示playbook的每个步骤以及每个项的作用。这里所说的*项*是指在Ansible
    playbook中设置的变量和命令：
- en: '[PRE6]'
  id: totrans-64
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'Here, we have the beginning of the playbook. The hosts are the targets of the
    playbook. These are normally the servers you want to make changes to. These are
    listed in the inventory file. In this case, we are targeting the `exports` group.
    In this case, `become` tells Ansible that you want to elevate the user, and `become_method`
    tells it that you want to use `sudo` to elevate the permissions:'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 这里是playbook的开头。主机是playbook的目标。这些通常是您希望进行更改的服务器，列在清单文件中。在这种情况下，我们的目标是`exports`组。`become`告诉Ansible您希望提升用户权限，而`become_method`则告诉它您希望使用`sudo`来提升权限：
- en: '[PRE7]'
  id: totrans-66
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'We are now going to move to tasks. These are the actions we want Ansible to
    take. The first task we see here is to create a directory using the file module.
    The `name` field is like a comment for a better understanding of the code by other
    engineers. From there, we see the other items we set, and then there are assumed
    defaults. As mentioned in [*Chapter 1*](B18607_01.xhtml#_idTextAnchor016), *Block
    Storage – Learning How to Provision Block Storage on Red Hat Enterprise Linux*,
    you can use the `ansible-doc` file to see the usage and examples:'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们将进入任务部分。这些是我们希望Ansible执行的操作。我们在这里看到的第一个任务是使用文件模块创建一个目录。`name`字段就像是注释，帮助其他工程师更好地理解代码。从这里我们可以看到设置的其他项，接下来是默认值。如在[*第一章*](B18607_01.xhtml#_idTextAnchor016)中提到的，*块存储
    – 学习如何在Red Hat Enterprise Linux上配置块存储*，您可以使用`ansible-doc`文件查看用法和示例：
- en: '[PRE8]'
  id: totrans-68
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: Normally, you would use the latest state; however, in our case, that would cause
    the system to encounter the bug that fails connectivity. It should work fine with
    the latest on the exam though.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，您会使用最新的状态；然而，在我们的情况下，这会导致系统遇到连接失败的bug。不过在考试中使用最新状态应该没问题。
- en: 'In this task, we installed the `nfs-utilities` package using the generic package
    installer for Ansible. This uses the facts gathered by Ansible. By using those
    facts, it knows to use `dnf` to install the software:'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 在此任务中，我们使用Ansible的通用包安装程序安装了`nfs-utilities`包。它使用Ansible收集的事实。通过使用这些事实，它知道使用`dnf`来安装软件：
- en: '[PRE9]'
  id: totrans-71
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'Using the `copy` module, we are replacing the current `exports` file. If this
    was a multiline exports file, it would need to be a template, `lineinfile`, or
    all lines would need to be in the task. Here, we are using the `service` module
    to enable and start the `nfs-server` service. This will ensure that the service
    is started. The service is enabled upon boot. The service also loads the exports,
    as `nfs-server` is started after the `exports` file was updated:'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`copy`模块，我们正在替换当前的`exports`文件。如果这是一个多行的exports文件，它将需要作为模板、`lineinfile`，或者所有行都需要包含在任务中。在这里，我们使用`service`模块来启用并启动`nfs-server`服务。这样可以确保服务被启动，并且在启动时服务会启用。服务也会加载exports文件，因为`nfs-server`是在更新`exports`文件后启动的：
- en: '[PRE10]'
  id: totrans-73
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'Using the `firewalld` module, we are going to allow a permanent opening for
    the NFS file service. This will allow connectivity to the resources we opt to
    share. Once that is complete, the `exports` playbook is completed, and up next
    is the `clients` playbook:'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`firewalld`模块，我们将为NFS文件服务永久开放。这样可以连接到我们选择共享的资源。完成后，`exports`剧本就完成了，接下来是`clients`剧本：
- en: '[PRE11]'
  id: totrans-75
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: After we have finished creating the playbook, we will use the `ansible-playbook
    -i inventory nfs_server.yml -u emcleroy -k --ask-become –v` command to execute
    the playbook. The flag of `-i` indicates the name of the inventory to use. The
    `-u` flag indicates the username to use when executing the playbook. The `–k`
    flag indicates to ask for the user password. The `--ask-become` flag specifies
    that you want to provide the `sudo` password for the playbook run. Finally, `–v`
    shows additional verbosity so you can see more logs of what is happening when
    the playbook is running.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 在完成创建剧本后，我们将使用`ansible-playbook -i inventory nfs_server.yml -u emcleroy -k --ask-become
    -v`命令来执行剧本。`-i`标志表示使用的清单名称。`-u`标志表示执行剧本时使用的用户名。`–k`标志表示要求输入用户密码。`--ask-become`标志表示您希望为剧本运行提供`sudo`密码。最后，`–v`显示更多详细信息，以便您可以看到剧本运行时发生的更多日志。
- en: 'Here, we will show a quick view of the playbook used to support the client
    setup of utilizing a share that has been set up for us:'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们将展示一个快速查看用于支持客户端设置的剧本，该设置是利用已经为我们设置好的共享：
- en: '[PRE12]'
  id: totrans-78
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: This will install `nfs-utilities` and then mount the file to the `/``share folder`.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 这将安装`nfs-utilities`，然后将文件挂载到`/share`文件夹。
- en: 'To run the playbook, we will use the following command: `ansible-playbook -i
    inventory nfs_client.yml -u emcleroy -k --ask-become –v`. That wraps up our foray
    into NFS. We will now be moving on to some more network-based file storage. We
    will be discussing SMB, which is most commonly used for Windows systems. We will
    go through setting it up manually and with automation.'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 要运行剧本，我们将使用以下命令：`ansible-playbook -i inventory nfs_client.yml -u emcleroy -k
    --ask-become -v`。这标志着我们对NFS的初步探索的结束。接下来，我们将转向更多基于网络的文件存储。我们将讨论SMB，它最常用于Windows系统。我们将介绍如何手动和通过自动化设置它。
- en: SMB storage manual provisioning and deployment
  id: totrans-81
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: SMB存储手动配置与部署
- en: The major difference when it comes to SMB is that it is the sharing standard
    for Windows-based systems from Linux systems. The best way to learn about Samba
    (another name for SMB) is to get your hands dirty, and that is what we are going
    to do today. We will be going step by step into how to install and provision SMB.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 当涉及到SMB时，主要的区别在于它是Windows系统与Linux系统之间的共享标准。学习Samba（SMB的另一个名称）最好的方式就是亲自操作，这正是我们今天要做的。我们将一步步介绍如何安装和配置SMB。
- en: 'To start, we are going to install SMB via `dnf`:'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们将通过`dnf`安装SMB：
- en: '[PRE13]'
  id: totrans-84
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'Then, create the share for SMB to serve:'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，创建SMB的共享：
- en: '[PRE14]'
  id: totrans-86
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'Next, we are going to start and enable the `smb` service:'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将启动并启用` smb` 服务：
- en: '[PRE15]'
  id: totrans-88
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'After that, we are going to open the firewall service for Samba:'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们将打开Samba的防火墙服务：
- en: '[PRE16]'
  id: totrans-90
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'With SMB now installed and the firewall opened, we can move on to setting up
    the folder we created. This will allow us to set the SELinux permissions needed.
    We are going to give access to administrators:'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 现在SMB已安装且防火墙已开放，我们可以继续设置我们创建的文件夹。这将允许我们设置所需的SELinux权限。我们将为管理员提供访问权限：
- en: '[PRE17]'
  id: totrans-92
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: This will allow us to restrict access to the folder to the `admins` group only.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 这将允许我们仅将文件夹的访问权限限制为`admins`组。
- en: 'With SELinux in the enforcing mode, it needs the correct context. As shown
    in these commands, the correct context is added back to the folder:'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 在SELinux强制模式下，它需要正确的上下文。如这些命令所示，正确的上下文已添加回文件夹：
- en: '[PRE18]'
  id: totrans-95
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: This allows for the label to stay, even during relabeling events within SELinux.
    SELinux context is outside the scope of this class and can be researched further
    online or through other Packt books.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 这允许标签在 SELinux 重标记事件期间保持不变。SELinux 上下文超出了本课程的范围，可以通过在线研究或其他 Packt 书籍进一步了解。
- en: 'Next, we will work on setting up the `smb.conf` file with the correct information
    to allow access to the `share` folder:'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将着手配置 `smb.conf` 文件，提供正确的信息以允许访问 `share` 文件夹：
- en: '[PRE19]'
  id: totrans-98
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'From there, you can see an example of a global Samba config portion and Samba
    share config portion in the following screenshot:'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 从这里，你可以看到以下截图中展示的全局 Samba 配置部分和 Samba 共享配置部分示例：
- en: '![Figure 2.8 – Global config for SMB with guests allowed](img/Figure_2.08_B18607.jpg)'
  id: totrans-100
  prefs: []
  type: TYPE_IMG
  zh: '![图 2.8 – 允许访客的 SMB 全局配置](img/Figure_2.08_B18607.jpg)'
- en: Figure 2.8 – Global config for SMB with guests allowed
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 图 2.8 – 允许访客的 SMB 全局配置
- en: 'Next, we have the guests allowed setting for our share, as follows:'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们有共享的访客允许设置，如下所示：
- en: '![Figure 2.9 – Guests are allowed as noted in the guest only statement](img/Figure_2.09_B18607.jpg)'
  id: totrans-103
  prefs: []
  type: TYPE_IMG
  zh: '![图 2.9 – 如“仅限访客”声明所示，允许访客访问](img/Figure_2.09_B18607.jpg)'
- en: Figure 2.9 – Guests are allowed as noted in the guest only statement
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 图 2.9 – 如“仅限访客”声明所示，允许访客访问
- en: 'Finally, here is an example of having to have a password to access the folder:'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，下面是一个需要密码才能访问文件夹的示例：
- en: '![Figure 2.10 – As shown here, guest only is set to no so you need to have
    a user and password](img/Figure_2.10_B18607.jpg)'
  id: totrans-106
  prefs: []
  type: TYPE_IMG
  zh: '![图 2.10 – 如这里所示，guest only 设置为 no，因此你需要拥有一个用户和密码](img/Figure_2.10_B18607.jpg)'
- en: Figure 2.10 – As shown here, guest only is set to no so you need to have a user
    and password
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 图 2.10 – 如这里所示，guest only 设置为 no，因此你需要拥有一个用户和密码
- en: These settings allow for control over your `smb` share.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 这些设置可以控制你的`smb`共享。
- en: 'Next, we are going to start the service and create some users. These users
    and passwords will only be good for the `smb` share. They will not affect the
    login information:'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将启动服务并创建一些用户。这些用户和密码仅适用于`smb`共享，不会影响登录信息：
- en: '[PRE20]'
  id: totrans-110
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'Finally, we are going to start up `smb` so that we can use it for our newly
    created `sambauser`:'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们将启动 `smb`，以便为我们新创建的 `sambauser` 提供服务：
- en: '[PRE21]'
  id: totrans-112
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'In the following screenshot, we can see that `smb` is running:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 在以下截图中，我们可以看到 `smb` 正在运行：
- en: '![Figure 2.11 – SMB successfully running on the system](img/Figure_2.11_B18607.jpg)'
  id: totrans-114
  prefs: []
  type: TYPE_IMG
  zh: '![图 2.11 – SMB 在系统上成功运行](img/Figure_2.11_B18607.jpg)'
- en: Figure 2.11 – SMB successfully running on the system
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 图 2.11 – SMB 在系统上成功运行
- en: 'To mount the system, we will have to install `samba-client` on the client machine.
    As shown in the following screenshot, we are installing `samba-client` on `rhel2`:'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 要挂载系统，我们需要在客户端机器上安装 `samba-client`。如以下截图所示，我们正在 `rhel2` 上安装 `samba-client`：
- en: '![Figure 2.12 – samba-client being installed on rhel2](img/Figure_2.12_B18607.jpg)'
  id: totrans-117
  prefs: []
  type: TYPE_IMG
  zh: '![图 2.12 – 在 rhel2 上安装 samba-client](img/Figure_2.12_B18607.jpg)'
- en: Figure 2.12 – samba-client being installed on rhel2
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 图 2.12 – 在 rhel2 上安装 samba-client
- en: 'This will allow us to mount the share on `rhel2`. We need `cifs-utils` installed,
    and then we can mount using the following command:'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 这将允许我们在 `rhel2` 上挂载共享。我们需要安装 `cifs-utils`，然后可以使用以下命令挂载：
- en: '[PRE22]'
  id: totrans-120
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: Note
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 注意
- en: This code and the process will all be available via the **Code in Action** (**CiA**)
    videos that are provided by Packt.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 这些代码和过程都可以通过由 Packt 提供的**Code in Action**（**CiA**）视频获取。
- en: Next, we will go over setting up a restricted share to a client on a particular
    domain. Then we will show how to define which users/groups have read-only or write
    access. Finally, we will show how to mount permanently using specific user credentials.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将介绍如何为特定域上的客户端设置受限共享。然后，我们将展示如何定义哪些用户/组具有只读或写入访问权限。最后，我们将展示如何使用特定的用户凭证永久挂载。
- en: 'Let’s start with how to set up a restricted share to a client on a particular
    domain. This can be accomplished by setting the security to the `domain` level
    instead of the `user` level. This can be seen in the following code snippet:'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们从如何为特定域上的客户端设置受限共享开始。可以通过将安全性设置为 `domain` 级别而不是 `user` 级别来实现。这可以在以下代码片段中看到：
- en: '[PRE23]'
  id: totrans-125
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'Next, to set up a specific group to have read-write and also allow other users
    to have read-only, you would set up the `smb` file for the share to look something
    like the following when `security` is set to `user`:'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，为了设置特定的组拥有读写权限，并允许其他用户仅具有只读权限，你需要设置 `smb` 文件，使共享的内容类似于以下内容，当 `security`
    设置为 `user` 时：
- en: '[PRE24]'
  id: totrans-127
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: The preceding file settings will allow `systemadmin1` to have read-only privileges
    and allow the `engineers` group to have read-write privileges, and all others
    will be unable to view the share.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 前面的文件设置将允许`systemadmin1`具有只读权限，并允许`engineers`组具有读写权限，其他所有人将无法查看共享。
- en: Next, we are going to look at how to set up a permanent mount using CIFS credentials
    and `fstab` in order to mount the share at startup.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将了解如何使用CIFS凭据和`fstab`设置永久挂载，以便在启动时挂载共享。
- en: 'We will start by creating a CIFS credential file, as shown here:'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将从创建一个CIFS凭据文件开始，如下所示：
- en: '[PRE25]'
  id: totrans-131
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 'This will have the following body of text:'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 这将包含以下内容：
- en: '[PRE26]'
  id: totrans-133
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'After the file is created, we will use it for login credentials for the mount
    and add the following to `fstab` to mount the share with these credentials:'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 文件创建后，我们将使用它作为挂载的登录凭据，并将以下内容添加到`fstab`中，以使用这些凭据挂载共享：
- en: '[PRE27]'
  id: totrans-135
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: That wraps up the manual portion of SMB storage. We will now work through the
    templates and other things needed for the automated approach of setting up SMB
    storage. Stay tuned for more great information about this and what we need to
    do to get it working through automation. This will help you with completing the
    EX358 exam as well.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 这就结束了SMB存储的手动配置部分。接下来，我们将处理自动化设置SMB存储所需的模板和其他内容。敬请期待更多关于如何通过自动化让它工作的重要信息。这也将帮助你完成EX358考试。
- en: SMB storage Ansible Automation playbook creation and usage
  id: totrans-137
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: SMB存储Ansible自动化剧本的创建和使用
- en: In this section, we will be looking at what is needed in order to set up SMB
    shares through Ansible Automation. This will allow for quicker setup across multiple
    servers. This will, in turn, also allow you to spend less time on the keyboard
    and more time focused on what you really want to learn. We have covered the different
    areas of Ansible in depth, from comments to names to modules. We are going to
    go through all of this again for SMB storage and show you how to set it up. This
    again is one way of doing it; there are others with Ansible that will be successful.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将探讨设置通过Ansible自动化配置SMB共享所需的内容。这将允许在多个服务器上更快速地设置。这样，你就可以将更多时间集中在真正想要学习的内容上，而不是键盘操作上。我们已经深入探讨了Ansible的各个方面，从注释到名称到模块。我们将再次回顾这些内容，讲解如何为SMB存储设置这些内容。这也是一种方法，Ansible还有其他方法可以成功实现。
- en: 'Let’s get started as we have with all of the other playbooks we have created.
    First, we will choose the inventory hosts and escalation points that we want to
    use. I showed you how to set up the inventory in previous sections so we will
    skip that. However, here is a snapshot of the inventory for your reference:'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们像创建其他所有剧本一样开始。首先，我们将选择要使用的库存主机和升级点。我在前面章节中向你展示了如何设置库存，因此我们跳过这部分。不过，以下是库存的快照供你参考：
- en: '![Figure 2.13 – smb_playbook inventory snapshot](img/Figure_2.13_B18607.jpg)'
  id: totrans-140
  prefs: []
  type: TYPE_IMG
  zh: '![图 2.13 – smb_playbook 库存快照](img/Figure_2.13_B18607.jpg)'
- en: Figure 2.13 – smb_playbook inventory snapshot
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 图 2.13 – smb_playbook 库存快照
- en: 'To start, let’s set up a new directory for the playbook:'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，让我们为剧本创建一个新目录：
- en: '[PRE28]'
  id: totrans-143
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'Next, we are going to start the tasks to set up everything needed for samba.
    First, let’s install it and the client to be thorough:'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将开始设置所有需要的samba任务。首先，彻底地安装它和客户端：
- en: '[PRE29]'
  id: totrans-145
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 'This portion of the code creates the groups that we will use to set allow functions
    on SMB:'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 这部分代码创建了我们将用于在SMB上设置允许功能的组：
- en: '[PRE30]'
  id: totrans-147
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: 'This portion of the code creates the user with a password for SMB. We will
    have different ways of doing this with loops in the final review, which will allow
    you to vault passwords and lists of users. This is not recommended as everything
    is in plain text. This playbook is an example of one way to accomplish the change:'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 这部分代码为SMB创建带密码的用户。最终的复习中，我们将使用循环做不同的操作，这将使你能够管理密码和用户列表。由于所有内容都是明文的，这种方法不推荐使用。这个剧本是完成此更改的一种方法示例：
- en: '[PRE31]'
  id: totrans-149
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: 'This portion of the code adds the group that we are using for SMB to the user:'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 这部分代码将我们用于SMB的组添加到用户中：
- en: '[PRE32]'
  id: totrans-151
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: 'Here we have created the directory and given the correct SELinux context:'
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 这里我们已经创建了目录并设置了正确的SELinux上下文：
- en: '[PRE33]'
  id: totrans-153
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: 'Here, we have added the information for our `share` folder to the `smb.conf`
    file:'
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们已将`share`文件夹的信息添加到`smb.conf`文件中：
- en: '[PRE34]'
  id: totrans-155
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: 'This portion of the code enables the SMB service as well as restarting it:'
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 这部分代码启用SMB服务并重新启动它：
- en: '[PRE35]'
  id: totrans-157
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: 'This portion of the code opens up the necessary firewall rules:'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 这部分代码开启了必要的防火墙规则：
- en: '[PRE36]'
  id: totrans-159
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: 'You can then run the playbook on the system using this command:'
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，你可以使用以下命令在系统上运行 playbook：
- en: '[PRE37]'
  id: totrans-161
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: This will ask you for your `ssh` password and your `become` password for the
    system. Please ensure that on the Ansible Control node (in our case, `rhel3`),
    `sshpass` is installed in order to avoid password failures. These can be handled
    through Ansible Vault as well or through other password credential systems that
    are out of the scope of this exam.
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 这将要求你输入系统的 `ssh` 密码和 `become` 密码。请确保在 Ansible 控制节点（在我们的例子中是 `rhel3`）上安装了 `sshpass`，以避免密码失败。这些可以通过
    Ansible Vault 处理，或者通过其他密码凭证系统处理，这些内容超出了本考试的范围。
- en: 'Next, we are going to show the playbook from the client side so that we can
    mount the new SMB share we created. We are going to create a new playbook as follows:'
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将展示客户端侧的 playbook，以便挂载我们创建的新 SMB 共享。我们将按照以下方式创建一个新的 playbook：
- en: '[PRE38]'
  id: totrans-164
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: 'This creates a file with your credentials. You can also vault this file for
    encryption and use variables:'
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 这将创建一个包含你凭证的文件。你也可以将该文件加密，并使用变量：
- en: '[PRE39]'
  id: totrans-166
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: Please note that the IP address of the server may be different for your lab
    setup.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，服务器的 IP 地址可能与您的实验室设置不同。
- en: This will mount the SMB share with the credentials you passed to the file. We
    will explore other ways of doing all of this in the final review with the full
    video in the CiA videos. The CiA videos will display the manual and automated
    code being run and will be placed on Packt’s website.
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 这将使用你提供的凭证挂载 SMB 共享。我们将在最终复习中探索其他方式来完成所有这些操作，复习视频将放在 Packt 网站上，视频将展示手动和自动化代码的运行。
- en: Summary
  id: totrans-169
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: This brings us to the end of this chapter and network file sharing. We have
    talked about many types of storage up until this point, from iSCSI to SMB. They
    all have one thing in common and that is networking. We will be moving on to introduce
    you to the networking aspect of how these things interconnect in our next chapter.
    We want to ensure that everyone is aware of how RHEL networking is handled, how
    it is different from traditional networking such as Cisco and others, and how
    it can help you. We will go over exam objectives and ensure you know how to connect
    these servers to pass the storage we talked about.
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 这将是本章和网络文件共享的结束。到目前为止，我们讨论了许多存储类型，从 iSCSI 到 SMB。它们都有一个共同点，那就是网络。接下来我们将介绍这些事物如何在网络方面互联。在下一章中，我们将确保大家了解
    RHEL 网络的处理方式，了解它与传统网络（如 Cisco 等）的不同之处，以及它如何帮助你。我们还会回顾考试目标，确保你知道如何将这些服务器连接起来，以便通过我们讨论的存储部分。
- en: 'Part 2: Red Hat Linux 8 – Configuring and Maintaining Networking with Automation'
  id: totrans-171
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第二部分：Red Hat Linux 8 – 使用自动化配置和维护网络
- en: In this part, you will learn to set up and maintain Linux networking functions
    manually and automatically. This will meet the objectives set to pass the Red
    Hat EX358 exam.
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 在这一部分，你将学习如何手动和自动设置和维护 Linux 网络功能。这将满足通过 Red Hat EX358 考试的目标。
- en: 'This part contains the following chapters:'
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 这一部分包含以下章节：
- en: '[*Chapter 3*](B18607_03.xhtml#_idTextAnchor039), *Network Services with Automation
    – Introduction to Red Hat Linux Networking*'
  id: totrans-174
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[*第3章*](B18607_03.xhtml#_idTextAnchor039)，*使用自动化的网络服务 – Red Hat Linux 网络简介*'
- en: '[*Chapter 3*](B18607_03.xhtml#_idTextAnchor039), *Link Aggregation Creation
    – Creating Your Own Link and Mastering the Networking Domain*'
  id: totrans-175
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[*第3章*](B18607_03.xhtml#_idTextAnchor039)，*链路聚合创建 – 创建你自己的链路并掌握网络领域*'
- en: '[*Chapter 5*](B18607_05.xhtml#_idTextAnchor060), *DNS, DHCP, and IP Addressing
    – Gaining Deeper Knowledge of Red Hat Linux Networking*'
  id: totrans-176
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[*第5章*](B18607_05.xhtml#_idTextAnchor060)，*DNS、DHCP 和 IP 地址分配 – 深入了解 Red Hat
    Linux 网络*'
