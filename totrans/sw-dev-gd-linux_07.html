<html><head></head><body>
<div class="Basic-Text-Frame" id="_idContainer052">
<h1 class="chapterNumber"><span class="koboSpan" id="kobo.1.1">7</span></h1>
<h1 class="chapterTitle" id="_idParaDest-138"><span class="koboSpan" id="kobo.2.1">Users and Groups</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.3.1">In this chapter, we’ll be taking a look at two of the building blocks that Linux uses to manage resources and maintain security: users and groups. </span><span class="koboSpan" id="kobo.3.2">After learning the basics and covering a very special user, </span><code class="inlineCode"><span class="koboSpan" id="kobo.4.1">root</span></code><span class="koboSpan" id="kobo.5.1">, we’ll show you how the concept of Linux user groups adds a convenient layer on top of the user abstraction.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.6.1">Once we’ve covered the necessary theory, you’ll jump directly into the practical commands you need to create and modify users and groups. </span><span class="koboSpan" id="kobo.6.2">And, in a stunning triumph that will pay dividends if it ever comes up in an interview, you’ll see for yourself </span><em class="italic"><span class="koboSpan" id="kobo.7.1">what a Linux user is actually made of</span></em><span class="koboSpan" id="kobo.8.1"> (hint: it’s just three lines of plaintext).</span></p>
<p class="normal"><span class="koboSpan" id="kobo.9.1">By the end of this chapter, you’ll:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.10.1">Understand what users are and what they’re used for</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.11.1">Understand the distinction between root and normal users, and how to switch between them when you need to</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.12.1">Know how to create and modify users and groups</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.13.1">Take a deeper dive into user metadata, and see what a Linux user is actually made of</span></li>
</ul>
<h1 class="heading-1" id="_idParaDest-139"><span class="koboSpan" id="kobo.14.1">What is a user?</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.15.1">A user, in the context </span><a id="_idIndexMarker226"/><span class="koboSpan" id="kobo.16.1">of a Unix system, is simply a named entity that can do things on the system. </span><span class="koboSpan" id="kobo.16.2">Users can launch and own processes, own files and directories and have various permissions on them, and be allowed or prevented from doing things or using resources on the system. </span><span class="koboSpan" id="kobo.16.3">Practically, a user is who you log in as, what your processes run as, or who owns your files.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.17.1">The word “user” is obviously a metaphor for a real person with a user account, a password, and so on. </span><span class="koboSpan" id="kobo.17.2">But most “users” on real systems don’t actually represent specific humans. </span><span class="koboSpan" id="kobo.17.3">They’re machine accounts, meant to group resources like processes and files for the purposes of security or</span><a id="_idIndexMarker227"/><span class="koboSpan" id="kobo.18.1"> organization.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.19.1">But there’s a much more important distinction than whether or not an account is intended to be used interactively by a human operator. </span><span class="koboSpan" id="kobo.19.2">There are exactly two types of users, and before we jump into practical user-management skills, we need to talk about that distinction.</span></p>
<h1 class="heading-1" id="_idParaDest-140"><span class="koboSpan" id="kobo.20.1">Root versus everybody else</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.21.1">The world can be a harsh place, and sometimes it’s dangerous to run a command. </span><span class="koboSpan" id="kobo.21.2">For example, </span><code class="inlineCode"><span class="koboSpan" id="kobo.22.1">fdisk</span></code><span class="koboSpan" id="kobo.23.1"> can wipe</span><a id="_idIndexMarker228"/><span class="koboSpan" id="kobo.24.1"> the partitions of a disk or otherwise modify hardware. </span><code class="inlineCode"><span class="koboSpan" id="kobo.25.1">iptables</span></code><span class="koboSpan" id="kobo.26.1"> can </span><a id="_idIndexMarker229"/><span class="koboSpan" id="kobo.27.1">open a network port and let an attacker exploit a vulnerability. </span><span class="koboSpan" id="kobo.27.2">Even using an innocuous </span><code class="inlineCode"><span class="koboSpan" id="kobo.28.1">echo</span></code><span class="koboSpan" id="kobo.29.1"> command</span><a id="_idIndexMarker230"/><span class="koboSpan" id="kobo.30.1"> to send a value to the wrong place on a filesystem can change the operating system’s configuration in subtle and terrible ways.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.31.1">To guard against this, the Unix-like environment that your command-line interface is running in has some built-in guardrails. </span><span class="koboSpan" id="kobo.31.2">There is a “superuser” called </span><code class="inlineCode"><span class="koboSpan" id="kobo.32.1">root</span></code><span class="koboSpan" id="kobo.33.1"> in </span><a id="_idIndexMarker231"/><span class="koboSpan" id="kobo.34.1">every Unix system. </span><span class="koboSpan" id="kobo.34.2">As a result, the basic security model is as follows:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.35.1">First, there is </span><code class="inlineCode"><span class="koboSpan" id="kobo.36.1">root</span></code><span class="koboSpan" id="kobo.37.1">. </span><span class="koboSpan" id="kobo.37.2">This user is the equivalent of the system administrator on other systems and is the user with the highest number of permissions. </span><code class="inlineCode"><span class="koboSpan" id="kobo.38.1">root</span></code><span class="koboSpan" id="kobo.39.1"> can do almost anything.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.40.1">Then, there’s everybody else. </span><span class="koboSpan" id="kobo.40.2">Non-root users have limited permissions – they can’t launch processes or edit files that could affect the whole system, but they can launch their own (unprivileged) applications and edit their own files.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.41.1">To guard against problems, only the </span><code class="inlineCode"><span class="koboSpan" id="kobo.42.1">root</span></code><span class="koboSpan" id="kobo.43.1"> user can execute commands that change important aspects of your system. </span><span class="koboSpan" id="kobo.43.2">Because even seemingly innocuous commands can cause potential havoc if they’re run with the right arguments, you may find yourself needing root privileges just to edit a text file.</span></p>
<h1 class="heading-1" id="_idParaDest-141"><span class="koboSpan" id="kobo.44.1">sudo</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.45.1">Because it would be an inconvenience to </span><a id="_idIndexMarker232"/><span class="koboSpan" id="kobo.46.1">have to log in as a separate user every time you want to do something potentially dangerous on a system, there’s the </span><code class="inlineCode"><span class="koboSpan" id="kobo.47.1">sudo</span></code><span class="koboSpan" id="kobo.48.1"> command. </span><span class="koboSpan" id="kobo.48.2">Prefixing a command with </span><code class="inlineCode"><span class="koboSpan" id="kobo.49.1">sudo</span></code><span class="koboSpan" id="kobo.50.1">, which stands for “substitute user (and) do,” lets you perform that command </span><em class="italic"><span class="koboSpan" id="kobo.51.1">as the root user</span></em><span class="koboSpan" id="kobo.52.1">. </span><span class="koboSpan" id="kobo.52.2">When that command finishes executing and exits, your next command is interpreted as coming from your regular (non-root) user again.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.53.1">You can see this behavior for yourself by running two commands. </span><span class="koboSpan" id="kobo.53.2">First, run the </span><code class="inlineCode"><span class="koboSpan" id="kobo.54.1">whoami</span></code><span class="koboSpan" id="kobo.55.1"> command, which is a command that prints out the current user:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.56.1">whoami
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.57.1">In this case. </span><span class="koboSpan" id="kobo.57.2">I’m logged in as the “</span><code class="inlineCode"><span class="koboSpan" id="kobo.58.1">dave</span></code><span class="koboSpan" id="kobo.59.1">" user, so this command prints out:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.60.1">dave
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.61.1">Now, prepend “</span><code class="inlineCode"><span class="koboSpan" id="kobo.62.1">sudo</span></code><span class="koboSpan" id="kobo.63.1">" to that same command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.64.1">sudo whoami
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.65.1">Even though you’re still logged in as a non-root user, your </span><em class="italic"><span class="koboSpan" id="kobo.66.1">effective</span></em><span class="koboSpan" id="kobo.67.1"> user ID has changed for the duration of a single command, because of </span><code class="inlineCode"><span class="koboSpan" id="kobo.68.1">sudo</span></code><span class="koboSpan" id="kobo.69.1">:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.70.1">root
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.71.1">Let’s look at a more practical example where we want to run a single action as </span><code class="inlineCode"><span class="koboSpan" id="kobo.72.1">root</span></code><span class="koboSpan" id="kobo.73.1">, but then continue running other commands as our regular user:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.74.1">sudo systemctl start nginx
&lt;go back to doing regular-user stuff&gt;
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.75.1">That first command starts the </span><code class="inlineCode"><span class="koboSpan" id="kobo.76.1">nginx</span></code><span class="koboSpan" id="kobo.77.1"> web server (presuming the nginx package is installed), which is something that only root can do. </span><span class="koboSpan" id="kobo.77.2">Any commands after that are executed as your regular user again.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.78.1">This is a common workflow that ensures safety – you spend most of your time working as a regular user, incapable of borking the entire system in a single command. </span><span class="koboSpan" id="kobo.78.2">When you need root powers, you invoke them by prepending </span><em class="italic"><span class="koboSpan" id="kobo.79.1">only those commands that require it</span></em><span class="koboSpan" id="kobo.80.1"> with root. </span><span class="koboSpan" id="kobo.80.2">It’s a nice psychological barrier to accidentally breaking things on a system.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.81.1">You’ll see this pattern used for various potentially dangerous things on a system, such as editing system-level configuration files, creating directories outside of your user’s home directory (covered later in this chapter), and more:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.82.1">sudo mkdir /var/log/foobar</span></code></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.83.1">sudo vim /etc/hosts</span></code></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.84.1">sudo mount /dev/sdb1</span></code></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.85.1">You can use </span><code class="inlineCode"><span class="koboSpan" id="kobo.86.1">sudo</span></code><span class="koboSpan" id="kobo.87.1"> to get a long-lived root shell session if you plan on running many commands as root (or if you’re troubleshooting something that runs as root, or simulating the environment that a </span><code class="inlineCode"><span class="koboSpan" id="kobo.88.1">cloud-init</span></code><span class="koboSpan" id="kobo.89.1"> script would be executing in):</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.90.1">sudo -i
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.91.1">This will get you an </span><em class="italic"><span class="koboSpan" id="kobo.92.1">interactive</span></em><span class="koboSpan" id="kobo.93.1"> shell session as the root user. </span><span class="koboSpan" id="kobo.93.2">Be careful with this! </span><span class="koboSpan" id="kobo.93.3">There’s nothing stopping you from destroying the system with a mistake or a poorly typed command.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.94.1">While sudo defaults to replace the current user with the root user, you can also change that to another user, via the </span><code class="inlineCode"><span class="koboSpan" id="kobo.95.1">–u</span></code><span class="koboSpan" id="kobo.96.1"> option. </span><span class="koboSpan" id="kobo.96.2">For example:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.97.1">sudo –u myuser vim /home/myuser/.bashrc
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.98.1">This will</span><a id="_idIndexMarker233"/><span class="koboSpan" id="kobo.99.1"> open </span><code class="inlineCode"><span class="koboSpan" id="kobo.100.1">/home/myuser/.bashrc</span></code><span class="koboSpan" id="kobo.101.1"> in vim as the user </span><code class="inlineCode"><span class="koboSpan" id="kobo.102.1">myuser</span></code><span class="koboSpan" id="kobo.103.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.104.1">Which user (or group) is allowed to do what exactly can be defined in </span><code class="inlineCode"><span class="koboSpan" id="kobo.105.1">/etc/sudo.conf</span></code><span class="koboSpan" id="kobo.106.1">. </span><span class="koboSpan" id="kobo.106.2">You should never edit this file directly; use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.107.1">visudo</span></code><span class="koboSpan" id="kobo.108.1"> command to modify the file.</span></p>
<h1 class="heading-1" id="_idParaDest-142"><span class="koboSpan" id="kobo.109.1">What is a group?</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.110.1">Groups are an </span><a id="_idIndexMarker234"/><span class="koboSpan" id="kobo.111.1">additional primitive that allows a set of users to share permissions. </span><span class="koboSpan" id="kobo.111.2">Groups are often used to get the functionality of a permission set or profile. </span><span class="koboSpan" id="kobo.111.3">For example, on Linux, there’s often a group called </span><code class="inlineCode"><span class="koboSpan" id="kobo.112.1">sudoers</span></code><span class="koboSpan" id="kobo.113.1">, and on macOS, you’ll encounter a group called </span><code class="inlineCode"><span class="koboSpan" id="kobo.114.1">wheel</span></code><span class="koboSpan" id="kobo.115.1">. </span><span class="koboSpan" id="kobo.115.2">By convention, users who are members of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.116.1">sudoers</span></code><span class="koboSpan" id="kobo.117.1"> or </span><code class="inlineCode"><span class="koboSpan" id="kobo.118.1">wheel</span></code><span class="koboSpan" id="kobo.119.1"> groups on these systems are allowed to use </span><code class="inlineCode"><span class="koboSpan" id="kobo.120.1">sudo</span></code><span class="koboSpan" id="kobo.121.1"> to execute commands as root. </span><span class="koboSpan" id="kobo.121.2">This is functionally the same thing as adding a user to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.122.1">Administrators</span></code><span class="koboSpan" id="kobo.123.1"> group in Windows.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.124.1">You can extrapolate that if groups are useful for managing who is allowed to run the </span><code class="inlineCode"><span class="koboSpan" id="kobo.125.1">sudo</span></code><span class="koboSpan" id="kobo.126.1"> command, they might be useful for grouping together users and managing other kinds of permissions, too.</span></p>
<h1 class="heading-1" id="_idParaDest-143"><span class="koboSpan" id="kobo.127.1">Mini project: user and group management</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.128.1">For example, imagine that we want to allow every user who is a software developer at our company to read a given file – let’s call it </span><code class="inlineCode"><span class="koboSpan" id="kobo.129.1">document.txt</span></code><span class="koboSpan" id="kobo.130.1">. </span><span class="koboSpan" id="kobo.130.2">We can simply create a </span><code class="inlineCode"><span class="koboSpan" id="kobo.131.1">developers</span></code><span class="koboSpan" id="kobo.132.1"> group and add all of our developer users to that group.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.133.1">Then, when we’re setting ownership and permissions for </span><code class="inlineCode"><span class="koboSpan" id="kobo.134.1">document.txt</span></code><span class="koboSpan" id="kobo.135.1">, we can reference the </span><code class="inlineCode"><span class="koboSpan" id="kobo.136.1">developers</span></code><span class="koboSpan" id="kobo.137.1"> group instead of trying to keep track of every single user who might be a member of that group individually.</span></p>
<h2 class="heading-2" id="_idParaDest-144"><span class="koboSpan" id="kobo.138.1">Creating a user</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.139.1">On a Linux system that </span><a id="_idIndexMarker235"/><span class="koboSpan" id="kobo.140.1">has the </span><code class="inlineCode"><span class="koboSpan" id="kobo.141.1">adduser</span></code><span class="koboSpan" id="kobo.142.1"> command installed, you can use it to </span><em class="italic"><span class="koboSpan" id="kobo.143.1">interactively </span></em><span class="koboSpan" id="kobo.144.1">create a user named </span><code class="inlineCode"><span class="koboSpan" id="kobo.145.1">dave</span></code><span class="koboSpan" id="kobo.146.1">. </span><span class="koboSpan" id="kobo.146.2">If you don’t, the package is usually named </span><code class="inlineCode"><span class="koboSpan" id="kobo.147.1">useradd</span></code><span class="koboSpan" id="kobo.148.1"> (see </span><em class="chapterRef"><span class="koboSpan" id="kobo.149.1">Chapter 9</span></em><span class="koboSpan" id="kobo.150.1">, </span><em class="italic"><span class="koboSpan" id="kobo.151.1">Managing Installed Software</span></em><span class="koboSpan" id="kobo.152.1"> for more details on installing packages).</span></p>
<p class="normal"><span class="koboSpan" id="kobo.153.1">Running the command with a username as the only argument will give you a wizard-style user creation process. </span><span class="koboSpan" id="kobo.153.2">Notice that we’re using sudo here, since only </span><code class="inlineCode"><span class="koboSpan" id="kobo.154.1">root</span></code><span class="koboSpan" id="kobo.155.1"> can add or delete users:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="code-highlight"><strong class="hljs-con-slc"><span class="koboSpan" id="kobo.156.1">$ sudo adduser steve</span></strong></span><span class="koboSpan" id="kobo.157.1">
Adding user `steve' ...
</span><span class="koboSpan" id="kobo.157.2">Adding new group `steve' (1000) ...
</span><span class="koboSpan" id="kobo.157.3">Adding new user `steve' (1000) with group `steve' ...
</span><span class="koboSpan" id="kobo.157.4">Creating home directory `/home/steve' ...
</span><span class="koboSpan" id="kobo.157.5">Copying files from `/etc/skel' ...
</span><span class="code-highlight"><strong class="hljs-con-slc"><span class="koboSpan" id="kobo.158.1">New password:</span></strong></span>
<span class="code-highlight"><strong class="hljs-con-slc"><span class="koboSpan" id="kobo.159.1">Retype new password:</span></strong></span><span class="koboSpan" id="kobo.160.1">
passwd: password updated successfully
Changing the user information for steve
Enter the new value, or press ENTER for the default
</span><span class="code-highlight"><strong class="hljs-con-slc"><span class="koboSpan" id="kobo.161.1">Full Name []: Steve</span></strong></span><span class="koboSpan" id="kobo.162.1">
Room Number []:
Work Phone []:
Home Phone []:
Other []:
</span><span class="code-highlight"><strong class="hljs-con-slc"><span class="koboSpan" id="kobo.163.1">Is the information correct? </span><span class="koboSpan" id="kobo.163.2">[Y/n] y</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.164.1">We’ve bolded the parts that required user interaction on our part – namely, setting the password, the full name, and the confirmation that we want to create this user on the system.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.165.1">This is a nice way to</span><a id="_idIndexMarker236"/><span class="koboSpan" id="kobo.166.1"> add one or two users, but what if you’re working on a Linux test server that needs individual accounts for your 300 largest customers? </span><span class="koboSpan" id="kobo.166.2">You’ll want the non-interactive </span><code class="inlineCode"><span class="koboSpan" id="kobo.167.1">useradd</span></code><span class="koboSpan" id="kobo.168.1"> command instead, which lets you specify user attributes as arguments to a single command. </span><span class="koboSpan" id="kobo.168.2">This makes user changes easy to script (see our note about scriptability later in this chapter):</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.169.1">useradd --home-dir /home/dave --create-home --shell /bin/zsh -g dave -G sudoers dave
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.170.1">That command also:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.171.1">Sets and creates the user’s home directory (</span><code class="inlineCode"><span class="koboSpan" id="kobo.172.1">--home-dir</span></code><span class="koboSpan" id="kobo.173.1"> and -</span><code class="inlineCode"><span class="koboSpan" id="kobo.174.1">-create-home</span></code><span class="koboSpan" id="kobo.175.1">)</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.176.1">Sets a custom shell (</span><code class="inlineCode"><span class="koboSpan" id="kobo.177.1">--shell</span></code><span class="koboSpan" id="kobo.178.1">)</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.179.1">Sets the user’s primary group to </span><code class="inlineCode"><span class="koboSpan" id="kobo.180.1">dave</span></code><span class="koboSpan" id="kobo.181.1"> (although this could also be something like </span><code class="inlineCode"><span class="koboSpan" id="kobo.182.1">employees</span></code><span class="koboSpan" id="kobo.183.1">) with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.184.1">-g</span></code><span class="koboSpan" id="kobo.185.1"> option</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.186.1">Adds a supplementary group membership to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.187.1">sudoers</span></code><span class="koboSpan" id="kobo.188.1"> group (you can pass multiple comma-separated group names here)</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.189.1">And that’s it – if the command exits successfully, your new user has been created!</span></p>
<p class="normal"><span class="koboSpan" id="kobo.190.1">But we’re not done yet – this user is </span><a id="_idIndexMarker237"/><span class="koboSpan" id="kobo.191.1">going to be working on the new, top-secret </span><code class="inlineCode"><span class="koboSpan" id="kobo.192.1">tutorialinux</span></code><span class="koboSpan" id="kobo.193.1"> application, so let’s create a group for that project and add our new user to it.</span></p>
<h2 class="heading-2" id="_idParaDest-145"><span class="koboSpan" id="kobo.194.1">Create a group</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.195.1">To create a new group</span><a id="_idIndexMarker238"/><span class="koboSpan" id="kobo.196.1"> called </span><code class="inlineCode"><span class="koboSpan" id="kobo.197.1">tutorialinux</span></code><span class="koboSpan" id="kobo.198.1">, you’ll use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.199.1">groupadd</span></code><span class="koboSpan" id="kobo.200.1"> command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.201.1">groupadd tutorialinux
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.202.1">This creates a new group on the system, adding a line to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.203.1">/etc/group</span></code><span class="koboSpan" id="kobo.204.1"> configuration file, which is the record of all groups that exist on a Unix system. </span><span class="koboSpan" id="kobo.204.2">You can validate that the group was created by “grepping” (searching) for the group name in that file:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.205.1"># grep tutorialinux /etc/group
tutorialinux:x:1001:
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.206.1">You can see that a group with the name </span><code class="inlineCode"><span class="koboSpan" id="kobo.207.1">tutorialinux</span></code><span class="koboSpan" id="kobo.208.1"> now exists, with </span><strong class="keyWord"><span class="koboSpan" id="kobo.209.1">Group ID</span></strong><span class="koboSpan" id="kobo.210.1"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.211.1">GID</span></strong><span class="koboSpan" id="kobo.212.1">) of 1001.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.213.1">We’re not going to dive deeply into what the </span><code class="inlineCode"><span class="koboSpan" id="kobo.214.1">x</span></code><span class="koboSpan" id="kobo.215.1"> character here means; it’s enough to know that this file is made up of one line for every group, with colon-separated values. </span><span class="koboSpan" id="kobo.215.2">You’ll only ever care about the group name (first column), group ID (third column), and members (last column, which is empty in this example).</span></p>
<h2 class="heading-2" id="_idParaDest-146"><span class="koboSpan" id="kobo.216.1">Modifying a Linux user</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.217.1">Just as </span><code class="inlineCode"><span class="koboSpan" id="kobo.218.1">useradd</span></code><span class="koboSpan" id="kobo.219.1"> allows you to set </span><a id="_idIndexMarker239"/><span class="koboSpan" id="kobo.220.1">user metadata to your heart’s content during user creation, </span><code class="inlineCode"><span class="koboSpan" id="kobo.221.1">usermod</span></code><span class="koboSpan" id="kobo.222.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.223.1">gpasswd</span></code><span class="koboSpan" id="kobo.224.1"> allow you to modify all aspects of an existing user. </span><span class="koboSpan" id="kobo.224.2">Let’s add the </span><code class="inlineCode"><span class="koboSpan" id="kobo.225.1">dave</span></code><span class="koboSpan" id="kobo.226.1"> user we created earlier to the new </span><code class="inlineCode"><span class="koboSpan" id="kobo.227.1">tutorialinux</span></code><span class="koboSpan" id="kobo.228.1"> group, so he can work on project files that only group members can see or modify.</span></p>
<h3 class="heading-3" id="_idParaDest-147"><span class="koboSpan" id="kobo.229.1">Adding a Linux user to a group</span></h3>
<p class="normal"><span class="koboSpan" id="kobo.230.1">To change the </span><a id="_idIndexMarker240"/><span class="koboSpan" id="kobo.231.1">primary </span><a id="_idIndexMarker241"/><span class="koboSpan" id="kobo.232.1">group of the user: </span><code class="inlineCode"><span class="koboSpan" id="kobo.233.1">sudo usermod -g groupname username</span></code></p>
<p class="normal"><span class="koboSpan" id="kobo.234.1">That’s not exactly what we want here, though: the </span><code class="inlineCode"><span class="koboSpan" id="kobo.235.1">dave</span></code><span class="koboSpan" id="kobo.236.1"> user should continue to be in the eponymous </span><code class="inlineCode"><span class="koboSpan" id="kobo.237.1">dave</span></code><span class="koboSpan" id="kobo.238.1"> group; it’s just that we want </span><code class="inlineCode"><span class="koboSpan" id="kobo.239.1">dave</span></code><span class="koboSpan" id="kobo.240.1"> to </span><em class="italic"><span class="koboSpan" id="kobo.241.1">also</span></em><span class="koboSpan" id="kobo.242.1"> be a member of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.243.1">tutorialinux</span></code><span class="koboSpan" id="kobo.244.1"> group. </span><span class="koboSpan" id="kobo.244.2">To add a user to a group </span><em class="italic"><span class="koboSpan" id="kobo.245.1">without </span></em><span class="koboSpan" id="kobo.246.1">making it that user’s primary group, use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.247.1">-aG</span></code><span class="koboSpan" id="kobo.248.1"> options (“</span><strong class="keyWord"><span class="koboSpan" id="kobo.249.1">add</span></strong><span class="koboSpan" id="kobo.250.1"> to additional </span><strong class="keyWord"><span class="koboSpan" id="kobo.251.1">groups</span></strong><span class="koboSpan" id="kobo.252.1">”):</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.253.1">sudo usermod –aG tutorialinux dave
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.254.1">If you inspect </span><code class="inlineCode"><span class="koboSpan" id="kobo.255.1">/etc/group</span></code><span class="koboSpan" id="kobo.256.1"> again, you can see that the </span><code class="inlineCode"><span class="koboSpan" id="kobo.257.1">dave</span></code><span class="koboSpan" id="kobo.258.1"> user is now a member of three groups: </span><code class="inlineCode"><span class="koboSpan" id="kobo.259.1">dave</span></code><span class="koboSpan" id="kobo.260.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.261.1">sudoers</span></code><span class="koboSpan" id="kobo.262.1">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.263.1">tutorialinux</span></code><span class="koboSpan" id="kobo.264.1">:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.265.1">grep dave /etc/group
sudoers:x:27:dave
dave:x:1000:
tutorialinux:x:1001:dave
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.266.1">Using the commands you learned in the previous chapter to modify file ownership and permissions, you can now control the access that all members of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.267.1">tutorialinux</span></code><span class="koboSpan" id="kobo.268.1"> group have to certain files and directories.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.269.1">Now, when a specific user is done working on the </span><code class="inlineCode"><span class="koboSpan" id="kobo.270.1">tutorialinux</span></code><span class="koboSpan" id="kobo.271.1"> project, you can clean up and revoke their access without having to modify individual file and directory permissions.</span></p>
<h3 class="heading-3" id="_idParaDest-148"><span class="koboSpan" id="kobo.272.1">Removing a user from a group</span></h3>
<p class="normal"><span class="koboSpan" id="kobo.273.1">To remove a </span><a id="_idIndexMarker242"/><span class="koboSpan" id="kobo.274.1">user from a </span><a id="_idIndexMarker243"/><span class="koboSpan" id="kobo.275.1">group, we can use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.276.1">gpasswd</span></code><span class="koboSpan" id="kobo.277.1"> command like this:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.278.1">gpasswd –delete username groupname
</span></code></pre>
<h3 class="heading-3" id="_idParaDest-149"><span class="koboSpan" id="kobo.279.1">Removing a Linux user</span></h3>
<p class="normal"><span class="koboSpan" id="kobo.280.1">To remove a Linux user</span><a id="_idIndexMarker244"/><span class="koboSpan" id="kobo.281.1"> entirely, use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.282.1">userdel</span></code><span class="koboSpan" id="kobo.283.1"> command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.284.1">userdel -r account_name
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.285.1">If you want to preserve that user’s home directory, omit the (</span><code class="inlineCode"><span class="koboSpan" id="kobo.286.1">-r</span></code><span class="koboSpan" id="kobo.287.1"> / </span><code class="inlineCode"><span class="koboSpan" id="kobo.288.1">--remove</span></code><span class="koboSpan" id="kobo.289.1">) flag.</span></p>
<h3 class="heading-3" id="_idParaDest-150"><span class="koboSpan" id="kobo.290.1">Remove a Linux group</span></h3>
<p class="normal"><span class="koboSpan" id="kobo.291.1">There’s also a </span><code class="inlineCode"><span class="koboSpan" id="kobo.292.1">groupdel</span></code><span class="koboSpan" id="kobo.293.1"> command</span><a id="_idIndexMarker245"/><span class="koboSpan" id="kobo.294.1"> for groups that are no longer needed:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.295.1">groupdel groupname
</span></code></pre>
<h1 class="heading-1" id="_idParaDest-151"><span class="koboSpan" id="kobo.296.1">Advanced: what is a user, really?</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.297.1">Users and groups are one</span><a id="_idIndexMarker246"/><span class="koboSpan" id="kobo.298.1"> place where something quite wonderful about Unix and Linux can be</span><a id="_idIndexMarker247"/><span class="koboSpan" id="kobo.299.1"> seen clearly: there’s very little magic here.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.300.1">A Linux user</span><a id="_idIndexMarker248"/><span class="koboSpan" id="kobo.301.1"> is really just</span><a id="_idIndexMarker249"/><span class="koboSpan" id="kobo.302.1"> a </span><strong class="keyWord"><span class="koboSpan" id="kobo.303.1">User ID</span></strong><span class="koboSpan" id="kobo.304.1"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.305.1">UID</span></strong><span class="koboSpan" id="kobo.306.1">), which is a simple numerical representation of a user (an unsigned 32-bit integer). </span><span class="koboSpan" id="kobo.306.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.307.1">root</span></code><span class="koboSpan" id="kobo.308.1"> user’s UID is 0. </span><span class="koboSpan" id="kobo.308.2">All other users have a UID larger than 0. </span><span class="koboSpan" id="kobo.308.3">The same goes for groups.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.309.1">This information is not stored in some secret location, in some binary format, or some proprietary data structure that only the operating system can work with: users and groups are defined in plaintext files, which are traditionally modified using the few simple commands we’ve covered here.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.310.1">That simplicity and lack of magic means that mere mortals (such as a panicked developer with just a faded memory of this chapter) can quickly find out the state of users and groups on a running system, troubleshooting application errors that may come from an incorrectly prepared host environment that’s missing a necessary application user. </span><span class="koboSpan" id="kobo.310.2">It also comes in handy during the “systems engineering” portions of developer interviews.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.311.1">So, in the interest of cementing your intuition about how this stuff works, here are a few more useful facts about what’s going on under the hood as we create and manage users and groups.</span></p>
<h2 class="heading-2" id="_idParaDest-152"><span class="koboSpan" id="kobo.312.1">User metadata / attributes</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.313.1">Users defined only by a number aren’t </span><a id="_idIndexMarker250"/><span class="koboSpan" id="kobo.314.1">particularly useful – not without some additional metadata to spice things up. </span><span class="koboSpan" id="kobo.314.2">For example, an account that I use for my day-to-day work on a Linux or macOS machine, which happens to have UID </span><code class="inlineCode"><span class="koboSpan" id="kobo.315.1">502</span></code><span class="koboSpan" id="kobo.316.1">, might also have:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.317.1">A friendly login name (</span><code class="inlineCode"><span class="koboSpan" id="kobo.318.1">dave</span></code><span class="koboSpan" id="kobo.319.1">)</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.320.1">Its own group (the </span><code class="inlineCode"><span class="koboSpan" id="kobo.321.1">dave</span></code><span class="koboSpan" id="kobo.322.1"> group)</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.323.1">Various group memberships (</span><code class="inlineCode"><span class="koboSpan" id="kobo.324.1">staff</span></code><span class="koboSpan" id="kobo.325.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.326.1">developer</span></code><span class="koboSpan" id="kobo.327.1">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.328.1">wheel</span></code><span class="koboSpan" id="kobo.329.1">)</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.330.1">A login shell (</span><code class="inlineCode"><span class="koboSpan" id="kobo.331.1">bash</span></code><span class="koboSpan" id="kobo.332.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.333.1">zsh</span></code><span class="koboSpan" id="kobo.334.1">, and so on)</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.335.1">A home directory </span><code class="inlineCode"><span class="koboSpan" id="kobo.336.1">(/Users/dave/</span></code><span class="koboSpan" id="kobo.337.1"> on macOS, or </span><code class="inlineCode"><span class="koboSpan" id="kobo.338.1">/home/dave/</span></code><span class="koboSpan" id="kobo.339.1"> on Linux)</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.340.1">If you’re curious, you can get information about your current user by running the </span><code class="inlineCode"><span class="koboSpan" id="kobo.341.1">id</span></code><span class="koboSpan" id="kobo.342.1"> command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.343.1"># id
uid=0(root) gid=0(root) groups=0(root)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.344.1">By default, a few files define and contain all this extra user information:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.345.1">/etc/passwd</span></code><span class="koboSpan" id="kobo.346.1"> contains a username, UID, GID, home directory, and login shell, all on one colon-delimited line per user:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.347.1">root@localhost:~# cat /etc/passwd
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
</span></code></pre>
</li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.348.1">/etc/shadow</span></code><span class="koboSpan" id="kobo.349.1"> contains the user’s hashed, salted passwords; it is readable only by the root user:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.350.1">root@localhost:~# cat /etc/shadow
root:$6$SPevRPxD94AYwtmF$IOp9k15dnaN8FW8RUpDDQlifLPp9pJ3btgJcMfI
QEs1kT.ZNjDfX66XBOcPOBZzkRcGOb3Rwq6qTsDQ0jiZNh/:19251:0:99999:7:::
daemon:*:19251:0:99999:7:::
bin:*:19251:0:99999:7:::
sys:*:19251:0:99999:7:::
sync:*:19251:0:99999:7:::
</span></code></pre>
</li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.351.1">/etc/group</span></code><span class="koboSpan" id="kobo.352.1"> – the equivalent of </span><code class="inlineCode"><span class="koboSpan" id="kobo.353.1">/etc/passwd</span></code><span class="koboSpan" id="kobo.354.1">, but for groups instead of users. </span><span class="koboSpan" id="kobo.354.2">You saw (and used) this file earlier in the chapter.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.355.1">Optionally, a home directory like </span><code class="inlineCode"><span class="koboSpan" id="kobo.356.1">/home/dave</span></code><span class="koboSpan" id="kobo.357.1">:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.358.1"># /etc/passwd username:password:UID:GID:comment:home:shell
</span></code></pre>
<div class="note">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.359.1">WARNING</span></strong><span class="koboSpan" id="kobo.360.1">: While it makes sense to know what these files contain, you should NEVER edit any of these files manually. </span><span class="koboSpan" id="kobo.360.2">Use the tools we used in the previous sections to create, remove, or modify</span><a id="_idIndexMarker251"/><span class="koboSpan" id="kobo.361.1"> system users and groups.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.362.1">Hopefully, this quick theoretical overview of the moving parts – or more accurately, the static plaintext files – that make up users and groups was enlightening. </span><span class="koboSpan" id="kobo.362.2">Not only do we want to make sure that you’ve got an intuition for how this works, but we hope that this section stresses how </span><em class="italic"><span class="koboSpan" id="kobo.363.1">simple</span></em><span class="koboSpan" id="kobo.364.1"> this really is under the covers. </span><span class="koboSpan" id="kobo.364.2">There’s no magic here! </span><span class="koboSpan" id="kobo.364.3">You can feel confident that you’re not missing something the next time you’re troubleshooting why an application won’t start, or why a user doesn’t have permission to view a certain file with specific group ownership permissions.</span></p>
<h1 class="heading-1" id="_idParaDest-153"><span class="koboSpan" id="kobo.365.1">A note on scriptability</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.366.1">Earlier, we alluded to preferring </span><a id="_idIndexMarker252"/><span class="koboSpan" id="kobo.367.1">automatable tools like </span><code class="inlineCode"><span class="koboSpan" id="kobo.368.1">useradd</span></code><span class="koboSpan" id="kobo.369.1">, instead of interactive wizard-based tools like </span><code class="inlineCode"><span class="koboSpan" id="kobo.370.1">adduser</span></code><span class="koboSpan" id="kobo.371.1"> – even if those automatable tools are a bit more complex or hard to learn. </span><span class="koboSpan" id="kobo.371.2">Or perhaps you’re asking, “Why not just use a graphical tool, instead of these hard-to-remember CLI commands?”</span></p>
<p class="normal"><span class="koboSpan" id="kobo.372.1">One of the things we want to teach you during the course of this book is to generally prefer non-interactive commands.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.373.1">Because these commands don’t rely on real-time user input when they run, they are scriptable: creating a hundred users is almost as easy as creating one. </span><span class="koboSpan" id="kobo.373.2">This really comes in handy when you’re dealing with real-life problems like building Docker images, repeatedly preparing production environments, or writing </span><code class="inlineCode"><span class="koboSpan" id="kobo.374.1">cloud-init</span></code><span class="koboSpan" id="kobo.375.1"> setup scripts for your cloud instances.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.376.1">As a developer, this should ring true: automating things makes them more repeatable, safe, and fast. </span><span class="koboSpan" id="kobo.376.2">By learning commands that are non-interactive, you retain the power to use that command as part of a larger piece of automation, instead of having steps that require error-prone, time-consuming, and risky manual intervention.</span></p>
<h1 class="heading-1" id="_idParaDest-154"><span class="koboSpan" id="kobo.377.1">Conclusion</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.378.1">You just learned the basics of how Linux uses the abstractions of users and groups to manage and control processes, files, and other resources on a system. </span><span class="koboSpan" id="kobo.378.2">Just as importantly, you learned the basic commands you need to create and manage users and groups on a real system. </span><span class="koboSpan" id="kobo.378.3">You learned about the important difference between the </span><code class="inlineCode"><span class="koboSpan" id="kobo.379.1">root</span></code><span class="koboSpan" id="kobo.380.1"> user and all of the other normal users on a system.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.381.1">Then, we walked through a practical exercise where you created a user, added a group to the system, modified that user, and then cleaned up all the resources you created.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.382.1">Finally, we went beyond the day-to-day commands to show you that there’s no magic behind the scenes here: it’s all just plaintext files that define users and groups on a Unix system. </span><span class="koboSpan" id="kobo.382.2">This is a good thing; it’s going to make your life as a developer easy, whether you’re:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.383.1">Creating a Docker image to run your application as a specific non-root user.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.384.1">Setting up a long-running cloud instance with logins and a shared group for your data science team.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.385.1">Trying to minimize the blast radius of a mistake in your own local test environment.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.386.1">Troubleshooting user- and group-based errors on applications, for example, on a web application that needs root-user powers to open a secret file or do privileged actions on a system.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.387.1">In the next chapter, we’ll use all of this knowledge to dive deeply into how the Unix security model works, by looking at ownership and permissions.</span></p>
<h1 class="heading-1"><span class="koboSpan" id="kobo.388.1">Learn more on Discord</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.389.1">To join the Discord community for this book – where you can share feedback, ask questions to the author, and learn about new releases – follow the QR code below:</span></p>
<p class="normal"><a href="https://packt.link/SecNet"><span class="url"><span class="koboSpan" id="kobo.390.1">https://packt.link/SecNet</span></span></a></p>
<p class="normal"><span class="koboSpan" id="kobo.391.1"><img alt="" role="presentation" src="../Images/QR_Code1768422420210094187.png"/></span></p>
</div>
</body></html>