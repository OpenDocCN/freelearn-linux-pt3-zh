- en: 31\. Adding and Managing CentOS 8 Swap Space
  prefs: []
  type: TYPE_NORMAL
- en: An important part of maintaining the performance of a CentOS 8 system involves
    ensuring that adequate swap space is available comparable to the memory demands
    placed on the system. The goal of this chapter, therefore, is to provide an overview
    of swap management on CentOS 8.
  prefs: []
  type: TYPE_NORMAL
- en: 31.1 What is Swap Space?
  prefs: []
  type: TYPE_NORMAL
- en: Computer systems have a finite amount of physical memory that is made available
    to the operating system. When the operating system begins to approach the limit
    of the available memory it frees up space by writing memory pages to disk. When
    any of those pages are required by the operating system they are subsequently
    read back into memory. The area of the disk allocated for this task is referred
    to as swap space.
  prefs: []
  type: TYPE_NORMAL
- en: 31.2 Recommended Swap Space for CentOS 8
  prefs: []
  type: TYPE_NORMAL
- en: 'The amount of swap recommended for CentOS 8 depends on a number of factors
    including the amount of memory in the system, the workload imposed on that memory
    and whether the system is required to support hibernation. The current guidelines
    for CentOS 8 swap space are as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '| Amount of installed RAM | Recommended swap space | Recommended swap space
    if hibernation enabled |'
  prefs: []
  type: TYPE_TB
- en: '| 2GB or less | Installed RAM x 2 | Installed RAM x 3 |'
  prefs: []
  type: TYPE_TB
- en: '| 2GB - 8GB | Installed RAM x 1 | Installed RAM x 2 |'
  prefs: []
  type: TYPE_TB
- en: '| 8GB - 64GB | At least 4GB | Installed RAM x 1.5 |'
  prefs: []
  type: TYPE_TB
- en: '| 64GB or more | At least 4GB | Hibernation not recommended |'
  prefs: []
  type: TYPE_TB
- en: Table 31-1
  prefs: []
  type: TYPE_NORMAL
- en: When a system enters hibernation, the current system state is written to the
    hard disk and the host machine is powered off. When the machine is subsequently
    powered on, the state of the system is restored from the hard disk drive. This
    differs from suspension where the system state is stored in RAM. The machine then
    enters a sleep state whereby power is maintained to the system RAM while other
    devices are shut down.
  prefs: []
  type: TYPE_NORMAL
- en: 31.3 Identifying Current Swap Space Usage
  prefs: []
  type: TYPE_NORMAL
- en: 'The current amount of swap used by a CentOS 8 system may be identified in a
    number of ways. One option is to output the /proc/swaps file:'
  prefs: []
  type: TYPE_NORMAL
- en: cat /proc/swaps
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Filename Type Size Used Priority
  prefs: []
  type: TYPE_NORMAL
- en: /dev/dm-1 partition 4169724 41484 -2
  prefs: []
  type: TYPE_NORMAL
- en: 'Alternatively, the swapon command may be used:'
  prefs: []
  type: TYPE_NORMAL
- en: swapon
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: NAME TYPE SIZE USED PRIO
  prefs: []
  type: TYPE_NORMAL
- en: /dev/dm-1 partition 4G 40.5M -2
  prefs: []
  type: TYPE_NORMAL
- en: 'To view the amount of swap space relative to the overall available RAM, the
    free command may be used:'
  prefs: []
  type: TYPE_NORMAL
- en: free
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: total used free shared buff/cache available
  prefs: []
  type: TYPE_NORMAL
- en: 'Mem: 4035436 1428276 2224596 21968 382564 2360172'
  prefs: []
  type: TYPE_NORMAL
- en: 'Swap: 4169724 41484 4128240'
  prefs: []
  type: TYPE_NORMAL
- en: 31.4 Adding a Swap File to a CentOS 8 System
  prefs: []
  type: TYPE_NORMAL
- en: 'Additional swap may be added to the system by creating a file and assigning
    it as swap. Begin by creating the swap file using the dd command. The size of
    the file can be changed by adjusting the count= variable. The following command-line,
    for example, creates a 2.0 GB file:'
  prefs: []
  type: TYPE_NORMAL
- en: dd if=/dev/zero of=/newswap bs=1024 count=2000000
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 2000000+0 records in
  prefs: []
  type: TYPE_NORMAL
- en: 2000000+0 records out
  prefs: []
  type: TYPE_NORMAL
- en: 2048000000 bytes (2.0 GB, 1.9 GiB) copied, 3.62697 s, 565 MB/s
  prefs: []
  type: TYPE_NORMAL
- en: 'Before converting the file to a swap file, it is important to make sure the
    file has secure permissions set:'
  prefs: []
  type: TYPE_NORMAL
- en: chmod 0600 /newswap
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Once a suitable file has been created, it needs to be converted into a swap
    file using the mkswap command:'
  prefs: []
  type: TYPE_NORMAL
- en: mkswap /newswap
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Setting up swapspace version 1, size = 1.9 GiB (2047995904 bytes)
  prefs: []
  type: TYPE_NORMAL
- en: no label, UUID=4ffc238d-7fde-4367-bd98-c5c46407e535
  prefs: []
  type: TYPE_NORMAL
- en: 'With the swap file created and configured it can be added to the system in
    real-time using the swapon utility:'
  prefs: []
  type: TYPE_NORMAL
- en: swapon /newswap
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Rerunning swapon should now report that the new file is now being used as swap:'
  prefs: []
  type: TYPE_NORMAL
- en: swapon
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: NAME TYPE SIZE USED PRIO
  prefs: []
  type: TYPE_NORMAL
- en: /dev/dm-1 partition 4G 0B -2
  prefs: []
  type: TYPE_NORMAL
- en: /newswap file 1.9G 0B -3
  prefs: []
  type: TYPE_NORMAL
- en: 'The swap space may be removed dynamically by using the swapoff utility as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: swapoff /newswap
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Finally, modify the /etc/fstab file to automatically add the new swap at system
    boot time by adding the following line:'
  prefs: []
  type: TYPE_NORMAL
- en: /newswap swap swap defaults 0 0
  prefs: []
  type: TYPE_NORMAL
- en: 31.5 Adding Swap as a Partition
  prefs: []
  type: TYPE_NORMAL
- en: As an alternative to designating a file as swap space, entire disk partitions
    may also be designated as swap. The steps to achieve this are largely the same
    as those for adding a swap file. Before allocating a partition to swap, however,
    make sure that any existing data on the corresponding filesystem is either backed
    up or no longer needed and that the filesystem has been unmounted.
  prefs: []
  type: TYPE_NORMAL
- en: 'Assuming that a partition exists on a disk drive represented by /dev/sdb1,
    for example, the first step would be to convert this into a swap partition, once
    again using the mkswap utility:'
  prefs: []
  type: TYPE_NORMAL
- en: mkswap /dev/sdb1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'mkswap: /dev/sdb1: warning: wiping old xfs signature.'
  prefs: []
  type: TYPE_NORMAL
- en: Setting up swapspace version 1, size = 8 GiB (8587833344 bytes)
  prefs: []
  type: TYPE_NORMAL
- en: no label, UUID=a899c8ec-c410-4569-ba18-ddea03370c7f
  prefs: []
  type: TYPE_NORMAL
- en: 'Next, add the new partition to the system swap and verify that it has indeed
    been added:'
  prefs: []
  type: TYPE_NORMAL
- en: swapon /dev/sdb1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: swapon
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: NAME TYPE SIZE USED PRIO
  prefs: []
  type: TYPE_NORMAL
- en: /dev/dm-1 partition 4G 0B -2
  prefs: []
  type: TYPE_NORMAL
- en: /dev/sdb1 partition 8G 0B -3
  prefs: []
  type: TYPE_NORMAL
- en: 'Once again, the /etc/fstab file may be modified to automatically add the swap
    partition at boot time as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: /dev/sdb1 swap swap defaults 0 0
  prefs: []
  type: TYPE_NORMAL
- en: 31.6 Adding Space to a CentOS 8 LVM Swap Volume
  prefs: []
  type: TYPE_NORMAL
- en: By default, CentOS 8 configures swap space using Logical Volume Management (LVM).
    An alternative to adding swap via file or disk partition, therefore, is to extend
    the logical volume used for the swap space.
  prefs: []
  type: TYPE_NORMAL
- en: 'The first step is to identify the current amount of swap available and the
    volume group and logical volume used for the swap space using the lvdisplay utility
    (for more information on LVM, refer to the chapter entitled [“Adding a New Disk
    to a CentOS 8 Volume Group and Logical Volume”](../Text/Volume_Groups.xhtml#_idTextAnchor375)):'
  prefs: []
  type: TYPE_NORMAL
- en: lvdisplay
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '--- Logical volume ---'
  prefs: []
  type: TYPE_NORMAL
- en: LV Path /dev/cl/swap
  prefs: []
  type: TYPE_NORMAL
- en: LV Name swap
  prefs: []
  type: TYPE_NORMAL
- en: VG Name cl
  prefs: []
  type: TYPE_NORMAL
- en: LV UUID fwOZsF-ROwu-6eLe-2KDR-JZ0d-Pn4o-K5B0Vb
  prefs: []
  type: TYPE_NORMAL
- en: LV Write Access read/write
  prefs: []
  type: TYPE_NORMAL
- en: LV Creation host, time demoserver, 2019-02-14 11:12:07 -0500
  prefs: []
  type: TYPE_NORMAL
- en: LV Status available
  prefs: []
  type: TYPE_NORMAL
- en: '# open 2'
  prefs: []
  type: TYPE_NORMAL
- en: LV Size <3.98 GiB
  prefs: []
  type: TYPE_NORMAL
- en: Current LE 1018
  prefs: []
  type: TYPE_NORMAL
- en: Segments 1
  prefs: []
  type: TYPE_NORMAL
- en: Allocation inherit
  prefs: []
  type: TYPE_NORMAL
- en: Read ahead sectors auto
  prefs: []
  type: TYPE_NORMAL
- en: '- currently set to 256'
  prefs: []
  type: TYPE_NORMAL
- en: Block device 253:1
  prefs: []
  type: TYPE_NORMAL
- en: .
  prefs: []
  type: TYPE_NORMAL
- en: .
  prefs: []
  type: TYPE_NORMAL
- en: 'Clearly the swap resides on a logical volume named swap which is part of the
    volume group named cl. The next step is to verify if there is any space available
    on the volume group that can be allocated to swap volume:'
  prefs: []
  type: TYPE_NORMAL
- en: vgs
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'VG #PV #LV #SN Attr VSize VFree'
  prefs: []
  type: TYPE_NORMAL
- en: cl 2 3 0 wz--n- 197.66g <22.00g
  prefs: []
  type: TYPE_NORMAL
- en: 'If the amount of space available is sufficient to meet additional swap requirements,
    turn off the swap and extend the swap logical volume to use as much of the available
    space as needed to meet the system’s swap requirements:'
  prefs: []
  type: TYPE_NORMAL
- en: swapoff /dev/cl/swap
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: lvextend -L+8GB /dev/cl/swap
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Logical volume cl/swap successfully resized.
  prefs: []
  type: TYPE_NORMAL
- en: 'Next, reformat the swap volume and turn the swap back on:'
  prefs: []
  type: TYPE_NORMAL
- en: mkswap /dev/cl/swap
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'mkswap: /dev/cl/swap: warning: wiping old swap signature.'
  prefs: []
  type: TYPE_NORMAL
- en: Setting up swapspace version 1, size = 12 GiB (12754874368 bytes)
  prefs: []
  type: TYPE_NORMAL
- en: no label, UUID=241a4818-e51c-4b8c-9bc9-1697fc2ce26e
  prefs: []
  type: TYPE_NORMAL
- en: swapon /dev/cl/swap
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Having made the changes, check that the swap space has increased:'
  prefs: []
  type: TYPE_NORMAL
- en: swapon
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: NAME TYPE SIZE USED PRIO
  prefs: []
  type: TYPE_NORMAL
- en: /dev/dm-1 partition 12G 0B -2
  prefs: []
  type: TYPE_NORMAL
- en: 31.7 Adding Swap Space to the Volume Group
  prefs: []
  type: TYPE_NORMAL
- en: In the above section we extended the swap logical volume to use space that was
    already available in the volume group. If no space is available in the volume
    group then it will need to be added before the swap can be extended.
  prefs: []
  type: TYPE_NORMAL
- en: 'Begin by checking the status of the volume group:'
  prefs: []
  type: TYPE_NORMAL
- en: vgs
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'VG #PV #LV #SN Attr VSize VFree'
  prefs: []
  type: TYPE_NORMAL
- en: cl 1 3 0 wz--n- <189.67g 0
  prefs: []
  type: TYPE_NORMAL
- en: 'The above output indicates that no space is available within the volume group.
    Suppose, however, that we have a requirement to add 8 GB to the swap on the system.
    Clearly, this will require the addition of more space to the volume group. For
    the purposes of this example it will be assumed that a disk that is 8 GB in size
    and represented by /dev/sdb is available for addition to the volume group. The
    first step is to turn this partition into a physical volume:'
  prefs: []
  type: TYPE_NORMAL
- en: pvcreate /dev/sdb
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Physical volume "/dev/sdb" successfully created.
  prefs: []
  type: TYPE_NORMAL
- en: 'If the creation fails with a message similar to “Device /dev/sdb excluded by
    a filter”, it may be necessary to wipe the disk before creating the physical volume:'
  prefs: []
  type: TYPE_NORMAL
- en: wipefs -a /dev/sdb
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '/dev/sdb: 8 bytes were erased at offset 0x00000200 (gpt): 45 46 49 20 50 41
    52 54'
  prefs: []
  type: TYPE_NORMAL
- en: '/dev/sdb: 8 bytes were erased at offset 0x1fffffe00 (gpt): 45 46 49 20 50 41
    52 54'
  prefs: []
  type: TYPE_NORMAL
- en: '/dev/sdb: 2 bytes were erased at offset 0x000001fe (PMBR): 55 aa'
  prefs: []
  type: TYPE_NORMAL
- en: '/dev/sdb: calling ioctl to re-read partition table: Success'
  prefs: []
  type: TYPE_NORMAL
- en: 'Next, the volume group needs to be extended to use this additional physical
    volume:'
  prefs: []
  type: TYPE_NORMAL
- en: vgextend cl /dev/sdb
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Volume group "cl" successfully extended
  prefs: []
  type: TYPE_NORMAL
- en: 'At this point the vgs command should report the addition of the 8 GB of space
    to the volume group:'
  prefs: []
  type: TYPE_NORMAL
- en: vgs
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'VG #PV #LV #SN Attr VSize VFree'
  prefs: []
  type: TYPE_NORMAL
- en: cl 2 3 0 wz--n- 197.66g <8.00g
  prefs: []
  type: TYPE_NORMAL
- en: 'Now that the additional space is available in the volume group, the swap logical
    volume may be extended to utilize the space. First, turn off the swap using the
    swapoff utility:'
  prefs: []
  type: TYPE_NORMAL
- en: swapoff /dev/cl/swap
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Next, extend the logical volume to use the new space:'
  prefs: []
  type: TYPE_NORMAL
- en: lvextend -L+7.9GB /dev/cl/swap
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Rounding size to boundary between physical extents: 7.90 GiB.'
  prefs: []
  type: TYPE_NORMAL
- en: Size of logical volume cl/swap changed from <3.98 GiB (1018 extents) to <11.88
    GiB (3041 extents).
  prefs: []
  type: TYPE_NORMAL
- en: Logical volume cl/swap successfully resized.
  prefs: []
  type: TYPE_NORMAL
- en: 'Re-create the swap on the logical volume:'
  prefs: []
  type: TYPE_NORMAL
- en: mkswap /dev/cl/swap
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'mkswap: /dev/cl/swap: warning: wiping old swap signature.'
  prefs: []
  type: TYPE_NORMAL
- en: Setting up swapspace version 1, size = 11.9 GiB (12754874368 bytes)
  prefs: []
  type: TYPE_NORMAL
- en: no label, UUID=241a4818-e51c-4b8c-9bc9-1697fc2ce26e
  prefs: []
  type: TYPE_NORMAL
- en: 'Next, turn swap back on:'
  prefs: []
  type: TYPE_NORMAL
- en: swapon /dev/cl/swap
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Finally, use the swapon command to verify the addition of the swap space to
    the system:'
  prefs: []
  type: TYPE_NORMAL
- en: swapon
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: NAME TYPE SIZE USED PRIO
  prefs: []
  type: TYPE_NORMAL
- en: /dev/dm-1 partition 11.9G 0B -2
  prefs: []
  type: TYPE_NORMAL
- en: 31.8 Summary
  prefs: []
  type: TYPE_NORMAL
- en: Swap space is a vital component of just about any operating system in terms
    of handling situations where memory resources become constrained. By swapping
    out areas of memory to disk, the system is able to continue to function and meet
    the needs of the processes and applications running on it.
  prefs: []
  type: TYPE_NORMAL
- en: CentOS 8 has a set of guidelines recommending the amount of disk-based swap
    space that should be allocated depending on the amount of RAM installed in the
    system. In situations where these recommendations prove to be insufficient, additional
    swap space can be added to the system, typically without the need to reboot. As
    outlined in this chapter, swap space can be added in the form of a file, disk
    or disk partition or by extending existing logical volumes that have been configured
    as swap space.
  prefs: []
  type: TYPE_NORMAL
