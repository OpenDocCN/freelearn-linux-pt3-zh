<html><head></head><body>
<div id="_idContainer071">
<h1 class="chapter-number" id="_idParaDest-69"><a id="_idTextAnchor097"/><span class="koboSpan" id="kobo.1.1">7</span></h1>
<h1 id="_idParaDest-70"><a id="_idTextAnchor098"/><span class="koboSpan" id="kobo.2.1">Assimilating Packaging Support</span></h1>
<p><span class="koboSpan" id="kobo.3.1">This chapter presents the key concepts for understanding the aspects of Poky and BitBake related to packaging. </span><span class="koboSpan" id="kobo.3.2">We will learn about the supported binary package formats, shared state cache, package versioning components, how to set up and use binary package feeds to support our development process, </span><span class="No-Break"><span class="koboSpan" id="kobo.4.1">and more.</span></span></p>
<h1 id="_idParaDest-71"><a id="_idTextAnchor099"/><span class="koboSpan" id="kobo.5.1">Using supported package formats</span></h1>
<p><span class="koboSpan" id="kobo.6.1">From a Yocto Project perspective, a recipe may generate one or more output packages. </span><span class="koboSpan" id="kobo.6.2">A package wraps a set of files and metadata in a way that makes them available in the future. </span><span class="koboSpan" id="kobo.6.3">They can be installed into one or more images or deployed for </span><span class="No-Break"><span class="koboSpan" id="kobo.7.1">later use.</span></span></p>
<p><span class="koboSpan" id="kobo.8.1">Packages are critical to</span><a id="_idIndexMarker145"/><span class="koboSpan" id="kobo.9.1"> Poky, as they enable the build system to produce diverse types of artifacts, such as images </span><span class="No-Break"><span class="koboSpan" id="kobo.10.1">and toolchains.</span></span></p>
<h2 id="_idParaDest-72"><a id="_idTextAnchor100"/><span class="koboSpan" id="kobo.11.1">List of supported package formats</span></h2>
<p><span class="koboSpan" id="kobo.12.1">Currently, BitBake supports four different </span><span class="No-Break"><span class="koboSpan" id="kobo.13.1">package formats:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.14.1">Red Hat Package Manager</span></strong><span class="koboSpan" id="kobo.15.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.16.1">RPM</span></strong><span class="koboSpan" id="kobo.17.1">): Originally named Red Hat Package Manager but now known as the </span><a id="_idIndexMarker146"/><span class="koboSpan" id="kobo.18.1">RPM package</span><a id="_idIndexMarker147"/><span class="koboSpan" id="kobo.19.1"> format since its adoption by several other Linux distributions, this is a popular format in use in Linux distributions such as SuSE, OpenSuSE, Red Hat, Fedora, </span><span class="No-Break"><span class="koboSpan" id="kobo.20.1">and CentOS.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.21.1">Debian Package Manager</span></strong><span class="koboSpan" id="kobo.22.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.23.1">DEB</span></strong><span class="koboSpan" id="kobo.24.1">): This</span><a id="_idIndexMarker148"/><span class="koboSpan" id="kobo.25.1"> is a widespread </span><a id="_idIndexMarker149"/><span class="koboSpan" id="kobo.26.1">format used in Debian and several other Debian-based distributions – Ubuntu Linux and Linux Mint are the most </span><span class="No-Break"><span class="koboSpan" id="kobo.27.1">widely known.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.28.1">Itsy Package Management System</span></strong><span class="koboSpan" id="kobo.29.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.30.1">IPK</span></strong><span class="koboSpan" id="kobo.31.1">): This was a lightweight package management system designed for </span><a id="_idIndexMarker150"/><span class="koboSpan" id="kobo.32.1">embedded devices that resembled Debian’s package format. </span><span class="koboSpan" id="kobo.32.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.33.1">opkg</span></strong><span class="koboSpan" id="kobo.34.1"> package manager, which</span><a id="_idIndexMarker151"/><span class="koboSpan" id="kobo.35.1"> supports the IPK format, is used in several distributions such as OpenEmbedded Core, OpenWRT, </span><span class="No-Break"><span class="koboSpan" id="kobo.36.1">and Poky.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.37.1">Tar</span></strong><span class="koboSpan" id="kobo.38.1">: This is </span><a id="_idIndexMarker152"/><span class="koboSpan" id="kobo.39.1">derived from the </span><strong class="bold"><span class="koboSpan" id="kobo.40.1">Tape Archive</span></strong><span class="koboSpan" id="kobo.41.1">, a widely used </span><strong class="source-inline"><span class="koboSpan" id="kobo.42.1">tarball</span></strong><span class="koboSpan" id="kobo.43.1"> file type used to group several</span><a id="_idIndexMarker153"/><span class="koboSpan" id="kobo.44.1"> files into just a </span><span class="No-Break"><span class="koboSpan" id="kobo.45.1">single file.</span></span></li>
</ul>
<h2 id="_idParaDest-73"><a id="_idTextAnchor101"/><span class="koboSpan" id="kobo.46.1">Choosing a package format</span></h2>
<p><span class="koboSpan" id="kobo.47.1">The support for</span><a id="_idIndexMarker154"/><span class="koboSpan" id="kobo.48.1"> formats is provided using a set of classes (i.e., </span><strong class="source-inline"><span class="koboSpan" id="kobo.49.1">package_rpm</span></strong><span class="koboSpan" id="kobo.50.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.51.1">package_deb</span></strong><span class="koboSpan" id="kobo.52.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.53.1">package_ipk</span></strong><span class="koboSpan" id="kobo.54.1">). </span><span class="koboSpan" id="kobo.54.2">We can select one or more formats using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.55.1">PACKAGE_CLASSES</span></strong><span class="koboSpan" id="kobo.56.1"> variable, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.57.1">following example:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer058">
<span class="koboSpan" id="kobo.58.1"><img alt="Figure 7.1 – The variable used to configure which package format to use" src="image/Figure_7.01_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.59.1">Figure 7.1 – The variable used to configure which package format to use</span></p>
<p><span class="koboSpan" id="kobo.60.1">You can configure one or more package formats – for example, in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.61.1">build/conf/local.conf</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.62.1"> file.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.63.1">Tip</span></p>
<p class="callout"><span class="koboSpan" id="kobo.64.1">The first package format in </span><strong class="source-inline"><span class="koboSpan" id="kobo.65.1">PACKAGE_CLASSES</span></strong><span class="koboSpan" id="kobo.66.1"> is the one used for </span><span class="No-Break"><span class="koboSpan" id="kobo.67.1">image generation.</span></span></p>
<p><span class="koboSpan" id="kobo.68.1">Poky defaults to the RPM package format, which uses the DNF package manager. </span><span class="koboSpan" id="kobo.68.2">However, the format choice depends on several factors, such as package format-specific features, memory, and resource usage. </span><span class="koboSpan" id="kobo.68.3">OpenEmbedded Core defaults to the IPK and </span><strong class="source-inline"><span class="koboSpan" id="kobo.69.1">opkg</span></strong><span class="koboSpan" id="kobo.70.1"> as the package manager, as it offers a smaller memory and resource </span><span class="No-Break"><span class="koboSpan" id="kobo.71.1">usage footprint.</span></span></p>
<p><span class="koboSpan" id="kobo.72.1">On the other hand, users familiar with Debian-based systems may prefer to use the APT and DEB package formats for </span><span class="No-Break"><span class="koboSpan" id="kobo.73.1">their products.</span></span></p>
<h1 id="_idParaDest-74"><a id="_idTextAnchor102"/><span class="koboSpan" id="kobo.74.1">Running code during package installation</span></h1>
<p><span class="koboSpan" id="kobo.75.1">Packages can use scripts as part of their</span><a id="_idIndexMarker155"/><span class="koboSpan" id="kobo.76.1"> installation and removal process. </span><span class="koboSpan" id="kobo.76.2">The included scripts are defined </span><span class="No-Break"><span class="koboSpan" id="kobo.77.1">as follows:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.78.1">preinst</span></strong><span class="koboSpan" id="kobo.79.1">: This executes before unpacking the package. </span><span class="koboSpan" id="kobo.79.2">If the package has services, it must stop them for installation </span><span class="No-Break"><span class="koboSpan" id="kobo.80.1">or upgrade.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.81.1">postinst</span></strong><span class="koboSpan" id="kobo.82.1">: After unpacking, this typically completes any required configuration of the package. </span><span class="koboSpan" id="kobo.82.2">Many </span><strong class="source-inline"><span class="koboSpan" id="kobo.83.1">postinst</span></strong><span class="koboSpan" id="kobo.84.1"> scripts execute any command necessary to start or restart a service after installation </span><span class="No-Break"><span class="koboSpan" id="kobo.85.1">or upgrade.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.86.1">prerm</span></strong><span class="koboSpan" id="kobo.87.1">: It usually stops any daemon associated with a package before removing files associated with </span><span class="No-Break"><span class="koboSpan" id="kobo.88.1">the package.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.89.1">postrm</span></strong><span class="koboSpan" id="kobo.90.1">: This commonly modifies links or other files created by </span><span class="No-Break"><span class="koboSpan" id="kobo.91.1">the package.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.92.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.93.1">preinst</span></strong><span class="koboSpan" id="kobo.94.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.95.1">prerm</span></strong><span class="koboSpan" id="kobo.96.1"> scripts target complex use cases, such as data migration when updating packages. </span><span class="koboSpan" id="kobo.96.2">In the Yocto Project case, </span><strong class="source-inline"><span class="koboSpan" id="kobo.97.1">postinst</span></strong><span class="koboSpan" id="kobo.98.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.99.1">postrm</span></strong><span class="koboSpan" id="kobo.100.1"> are also responsible for stopping and starting the </span><strong class="source-inline"><span class="koboSpan" id="kobo.101.1">systemd</span></strong><span class="koboSpan" id="kobo.102.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.103.1">sysvinit</span></strong><span class="koboSpan" id="kobo.104.1"> services. </span><span class="koboSpan" id="kobo.104.2">A default script is provided when we use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.105.1">systemd</span></strong><span class="koboSpan" id="kobo.106.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.107.1">update-rc.d</span></strong><span class="koboSpan" id="kobo.108.1"> classes. </span><span class="koboSpan" id="kobo.108.2">It can be customized to include any </span><span class="No-Break"><span class="koboSpan" id="kobo.109.1">particular case.</span></span></p>
<p><span class="koboSpan" id="kobo.110.1">The post-package installation (</span><strong class="source-inline"><span class="koboSpan" id="kobo.111.1">postinst</span></strong><span class="koboSpan" id="kobo.112.1">) scripts are run during the </span><strong class="source-inline"><span class="koboSpan" id="kobo.113.1">root</span></strong><span class="koboSpan" id="kobo.114.1"> filesystem creation. </span><span class="koboSpan" id="kobo.114.2">The package is marked as installed if the script returns a success value. </span><span class="koboSpan" id="kobo.114.3">To add a </span><strong class="source-inline"><span class="koboSpan" id="kobo.115.1">postinst</span></strong><span class="koboSpan" id="kobo.116.1"> script for a package, we can use </span><span class="No-Break"><span class="koboSpan" id="kobo.117.1">the following:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer059">
<span class="koboSpan" id="kobo.118.1"><img alt="Figure 7.2 – An example of the pkg_postinst script" src="image/Figure_7.02_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.119.1">Figure 7.2 – An example of the pkg_postinst script</span></p>
<p><span class="koboSpan" id="kobo.120.1">Sometimes, we need to ensure that </span><strong class="source-inline"><span class="koboSpan" id="kobo.121.1">postinst</span></strong><span class="koboSpan" id="kobo.122.1"> runs inside the target device itself. </span><span class="koboSpan" id="kobo.122.2">This can be done using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.123.1">postinst_ontarget</span></strong><span class="koboSpan" id="kobo.124.1"> variant, such as </span><span class="No-Break"><span class="koboSpan" id="kobo.125.1">the following:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer060">
<span class="koboSpan" id="kobo.126.1"><img alt="Figure 7.3 – An example of the pkg_postinst_ontarget script" src="image/Figure_7.03_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.127.1">Figure 7.3 – An example of the pkg_postinst_ontarget script</span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.128.1">Tip</span></p>
<p class="callout"><span class="koboSpan" id="kobo.129.1">Instead of using the package name itself, we can use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.130.1">PN</span></strong><span class="koboSpan" id="kobo.131.1"> variable, which automatically expands the package name of </span><span class="No-Break"><span class="koboSpan" id="kobo.132.1">the recipe.</span></span></p>
<p><span class="koboSpan" id="kobo.133.1">All post-installation</span><a id="_idIndexMarker156"/><span class="koboSpan" id="kobo.134.1"> scripts must succeed when we generate an image with </span><strong class="source-inline"><span class="koboSpan" id="kobo.135.1">read-only-rootfs</span></strong><span class="koboSpan" id="kobo.136.1"> in </span><strong class="source-inline"><span class="koboSpan" id="kobo.137.1">IMAGE_FEATURES</span></strong><span class="koboSpan" id="kobo.138.1">. </span><span class="koboSpan" id="kobo.138.2">Because it is impossible to write in a read-only </span><strong class="source-inline"><span class="koboSpan" id="kobo.139.1">rootfs</span></strong><span class="koboSpan" id="kobo.140.1">, the check must occur during build time. </span><span class="koboSpan" id="kobo.140.2">It ensures that we identify the problem while building the image, rather than during the initial boot operation in the target device. </span><span class="koboSpan" id="kobo.140.3">If there is a requirement to run any script inside the target device, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.141.1">do_rootfs</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.142.1">task fails.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.143.1">Tip</span></p>
<p class="callout"><span class="koboSpan" id="kobo.144.1">Eventually, using a whole image as read-only is not an option. </span><span class="koboSpan" id="kobo.144.2">For example, some projects may need to persist some data or even allow some applications to write to a volatile directory. </span><span class="koboSpan" id="kobo.144.3">Such use cases are outside the scope of this book. </span><span class="koboSpan" id="kobo.144.4">However, you might find some helpful information in the </span><em class="italic"><span class="koboSpan" id="kobo.145.1">Yocto Project Reference Manual</span></em><span class="koboSpan" id="kobo.146.1"> for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.147.1">overlayfs</span></strong><span class="koboSpan" id="kobo.148.1"> (</span><a href="https://docs.yoctoproject.org/4.0.4/ref-manual/classes.html#overlayfs-bbclass"><span class="koboSpan" id="kobo.149.1">https://docs.yoctoproject.org/4.0.4/ref-manual/classes.html#overlayfs-bbclass</span></a><span class="koboSpan" id="kobo.150.1">) and </span><strong class="source-inline"><span class="koboSpan" id="kobo.151.1">overlayfs-etc</span></strong><span class="koboSpan" id="kobo.152.1"> (</span><a href="https://docs.yoctoproject.org/4.0.4/ref-manual/classes.html#overlayfs-etc-bbclass"><span class="No-Break"><span class="koboSpan" id="kobo.153.1">https://docs.yoctoproject.org/4.0.4/ref-manual/classes.html#overlayfs-etc-bbclass</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.154.1">) classes.</span></span></p>
<p><span class="koboSpan" id="kobo.155.1">One common oversight when creating post-installation scripts is the lack of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.156.1">D</span></strong><span class="koboSpan" id="kobo.157.1"> variable in front of absolute paths. </span><strong class="source-inline"><span class="koboSpan" id="kobo.158.1">D</span></strong><span class="koboSpan" id="kobo.159.1"> has </span><span class="No-Break"><span class="koboSpan" id="kobo.160.1">two traits:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.161.1">During </span><strong class="source-inline"><span class="koboSpan" id="kobo.162.1">rootfs</span></strong><span class="koboSpan" id="kobo.163.1"> generation, </span><strong class="source-inline"><span class="koboSpan" id="kobo.164.1">D</span></strong><span class="koboSpan" id="kobo.165.1"> is set to the root of the </span><span class="No-Break"><span class="koboSpan" id="kobo.166.1">working directory</span></span></li>
<li><span class="koboSpan" id="kobo.167.1">Inside the device, </span><strong class="source-inline"><span class="koboSpan" id="kobo.168.1">D</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.169.1">is empty</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.170.1">Consequently, this ensures that paths are valid in both host and target environments. </span><span class="koboSpan" id="kobo.170.2">For example, consider the </span><span class="No-Break"><span class="koboSpan" id="kobo.171.1">following code:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer061">
<span class="koboSpan" id="kobo.172.1"><img alt="Figure 7.4 – Sample source code using the D variable" src="image/Figure_7.04_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.173.1">Figure 7.4 – Sample source code using the D variable</span></p>
<p><span class="koboSpan" id="kobo.174.1">In the example in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.175.1">Figure 7</span></em></span><em class="italic"><span class="koboSpan" id="kobo.176.1">.4</span></em><span class="koboSpan" id="kobo.177.1">, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.178.1">touch</span></strong><span class="koboSpan" id="kobo.179.1"> command uses the </span><strong class="source-inline"><span class="koboSpan" id="kobo.180.1">D</span></strong><span class="koboSpan" id="kobo.181.1"> variable, so it works generically depending on </span><span class="No-Break"><span class="koboSpan" id="kobo.182.1">its value.</span></span></p>
<p><span class="koboSpan" id="kobo.183.1">Another common mistake is</span><a id="_idIndexMarker157"/><span class="koboSpan" id="kobo.184.1"> attempting to run processes specific to or dependent on the target architecture. </span><span class="koboSpan" id="kobo.184.2">The easiest solution, in this case, is to postpone the script execution to the target (using </span><strong class="source-inline"><span class="koboSpan" id="kobo.185.1">pkg_postinst_ontarget</span></strong><span class="koboSpan" id="kobo.186.1">). </span><span class="koboSpan" id="kobo.186.2">However, as mentioned before, this prevents the use of </span><span class="No-Break"><span class="koboSpan" id="kobo.187.1">read-only filesystems.</span></span></p>
<h1 id="_idParaDest-75"><a id="_idTextAnchor103"/><span class="koboSpan" id="kobo.188.1">Understanding shared state cache</span></h1>
<p><span class="koboSpan" id="kobo.189.1">The default behavior of Poky is to build everything from scratch unless BitBake determines that a recipe does not need to be rebuilt. </span><span class="koboSpan" id="kobo.189.2">The main advantage of building everything from scratch is that the</span><a id="_idIndexMarker158"/><span class="koboSpan" id="kobo.190.1"> result is fresh, and there is no risk of previous data causing problems. </span><span class="koboSpan" id="kobo.190.2">However, rebuilding everything requires computational time </span><span class="No-Break"><span class="koboSpan" id="kobo.191.1">and resources.</span></span></p>
<p><span class="koboSpan" id="kobo.192.1">The strategy to determine whether a recipe must be rebuilt is complex. </span><span class="koboSpan" id="kobo.192.2">BitBake tries to track as much information as possible about every task, variable, and piece of code used in the build process. </span><span class="koboSpan" id="kobo.192.3">BitBake then generates a checksum for the information used by every task, including dependencies from other tasks. </span><span class="koboSpan" id="kobo.192.4">In summary, BitBake recursively tracks used variables, task source code, and dependencies for the recipes and </span><span class="No-Break"><span class="koboSpan" id="kobo.193.1">their dependencies.</span></span></p>
<p><span class="koboSpan" id="kobo.194.1">Poky uses all this information provided by BitBake to store snapshots of those tasks as a set of packaged data, generated in a cache called the shared state cache (</span><strong class="source-inline"><span class="koboSpan" id="kobo.195.1">sstate-cache</span></strong><span class="koboSpan" id="kobo.196.1">). </span><span class="koboSpan" id="kobo.196.2">This cache wraps the contents of each task output in packages stored in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.197.1">SSTATE_DIR</span></strong><span class="koboSpan" id="kobo.198.1"> directory. </span><span class="koboSpan" id="kobo.198.2">Whenever BitBake prepares to run a task, it first checks the existence of a </span><strong class="source-inline"><span class="koboSpan" id="kobo.199.1">sstate-cache</span></strong><span class="koboSpan" id="kobo.200.1"> package that matches the required computed checksum. </span><span class="koboSpan" id="kobo.200.2">If the package is present, BitBake uses the </span><span class="No-Break"><span class="koboSpan" id="kobo.201.1">prebuilt package.</span></span></p>
<p><span class="koboSpan" id="kobo.202.1">The whole shared state </span><a id="_idIndexMarker159"/><span class="koboSpan" id="kobo.203.1">mechanism encompasses quite complex code, and the previous explanation simplifies it. </span><span class="koboSpan" id="kobo.203.2">For a detailed description, it is advised that you go through the </span><em class="italic"><span class="koboSpan" id="kobo.204.1">Shared State Cache</span></em><span class="koboSpan" id="kobo.205.1"> section of the </span><em class="italic"><span class="koboSpan" id="kobo.206.1">Yocto Project Overview and Concepts </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.207.1">Manual </span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.208.1">(</span></span><a href="https://docs.yoctoproject.org/4.0.4/overview-manual/concepts.html#shared-state-cache"><span class="No-Break"><span class="koboSpan" id="kobo.209.1">https://docs.yoctoproject.org/4.0.4/overview-manual/concepts.html#shared-state-cache</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.210.1">).</span></span></p>
<p><span class="koboSpan" id="kobo.211.1">When using Poky for several builds, we must remember that </span><strong class="source-inline"><span class="koboSpan" id="kobo.212.1">sstate-cache</span></strong><span class="koboSpan" id="kobo.213.1"> needs cleaning from time to time, since it keeps growing after every build. </span><span class="koboSpan" id="kobo.213.2">There is a straightforward way of cleaning it. </span><span class="koboSpan" id="kobo.213.3">Use the following command from the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.214.1">poky</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.215.1"> directory:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer062">
<span class="koboSpan" id="kobo.216.1"><img alt="Figure 7.5 – The command line to remove a duplicated Shared State Cache" src="image/Figure_7.05_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.217.1">Figure 7.5 – The command line to remove a duplicated Shared State Cache</span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.218.1">Tip</span></p>
<p class="callout"><span class="koboSpan" id="kobo.219.1">When we need to rebuild from scratch, we can do either of </span><span class="No-Break"><span class="koboSpan" id="kobo.220.1">the following:</span></span></p>
<ul>
<li class="callout"><span class="koboSpan" id="kobo.221.1">Remove </span><strong class="source-inline"><span class="koboSpan" id="kobo.222.1">build/tmp</span></strong><span class="koboSpan" id="kobo.223.1"> so that we can use </span><strong class="source-inline"><span class="koboSpan" id="kobo.224.1">sstate-cache</span></strong><span class="koboSpan" id="kobo.225.1"> to speed up </span><span class="No-Break"><span class="koboSpan" id="kobo.226.1">the build</span></span></li>
<li class="callout"><span class="koboSpan" id="kobo.227.1">Remove both </span><strong class="source-inline"><span class="koboSpan" id="kobo.228.1">build/tmp</span></strong><span class="koboSpan" id="kobo.229.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.230.1">sstate-cache</span></strong><span class="koboSpan" id="kobo.231.1"> so that no cache is reused during </span><span class="No-Break"><span class="koboSpan" id="kobo.232.1">the build</span></span></li>
</ul>
<h1 id="_idParaDest-76"><a id="_idTextAnchor104"/><span class="koboSpan" id="kobo.233.1">Explaining package versioning</span></h1>
<p><span class="koboSpan" id="kobo.234.1">Package versioning is used to </span><a id="_idIndexMarker160"/><span class="koboSpan" id="kobo.235.1">differentiate the same package in distinct stages of its life cycle. </span><span class="koboSpan" id="kobo.235.2">From Poky’s perspective, it is also used as part of the equation that generates the checksum used by BitBake to verify whether a task must </span><span class="No-Break"><span class="koboSpan" id="kobo.236.1">be rebuilt.</span></span></p>
<p><span class="koboSpan" id="kobo.237.1">The package version, also known as </span><strong class="source-inline"><span class="koboSpan" id="kobo.238.1">PV</span></strong><span class="koboSpan" id="kobo.239.1">, plays a leading role when we select which recipe to build. </span><span class="koboSpan" id="kobo.239.2">The default behavior of Poky is always to prefer the newest recipe version unless there is a different explicit preference, as discussed in </span><a href="B19361_05.xhtml#_idTextAnchor077"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.240.1">Chapter 5</span></em></span></a><span class="koboSpan" id="kobo.241.1">,</span><em class="italic"><span class="koboSpan" id="kobo.242.1"> Grasping the BitBake Tool</span></em><span class="koboSpan" id="kobo.243.1">. </span><span class="koboSpan" id="kobo.243.2">For example, let’s suppose that we have two versions of the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.244.1">myrecipe</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.245.1"> recipe:</span></span></p>
<ul>
<li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.246.1">myrecipe_1.0.bb</span></strong></span></li>
<li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.247.1">myrecipe_1.1.bb</span></strong></span></li>
</ul>
<p><span class="koboSpan" id="kobo.248.1">BitBake, by default, builds the recipe with version </span><strong class="source-inline"><span class="koboSpan" id="kobo.249.1">1.1</span></strong><span class="koboSpan" id="kobo.250.1">. </span><span class="koboSpan" id="kobo.250.2">Inside the recipe, we may have other variables that </span><a id="_idIndexMarker161"/><span class="koboSpan" id="kobo.251.1">compose package versioning with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.252.1">PV</span></strong><span class="koboSpan" id="kobo.253.1"> variable. </span><span class="koboSpan" id="kobo.253.2">These are the </span><strong class="bold"><span class="koboSpan" id="kobo.254.1">package epoch</span></strong><span class="koboSpan" id="kobo.255.1">, known as </span><strong class="source-inline"><span class="koboSpan" id="kobo.256.1">PE</span></strong><span class="koboSpan" id="kobo.257.1">, and</span><a id="_idIndexMarker162"/><span class="koboSpan" id="kobo.258.1"> the </span><strong class="bold"><span class="koboSpan" id="kobo.259.1">package revision</span></strong><span class="koboSpan" id="kobo.260.1">, known as </span><strong class="source-inline"><span class="koboSpan" id="kobo.261.1">PR</span></strong><span class="koboSpan" id="kobo.262.1">. </span></p>
<p><span class="koboSpan" id="kobo.263.1">Those variables normally follow </span><span class="No-Break"><span class="koboSpan" id="kobo.264.1">this pattern:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer063">
<span class="koboSpan" id="kobo.265.1"><img alt="Figure 7.6 – A complete versioning pattern" src="image/Figure_7.06_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.266.1">Figure 7.6 – A complete versioning pattern</span></p>
<p><span class="koboSpan" id="kobo.267.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.268.1">PE</span></strong><span class="koboSpan" id="kobo.269.1"> variable has a</span><a id="_idIndexMarker163"/><span class="koboSpan" id="kobo.270.1"> default value of zero. </span><span class="koboSpan" id="kobo.270.2">It is used when the package version schema is changed, breaking the possibility of usual ordering. </span><strong class="source-inline"><span class="koboSpan" id="kobo.271.1">PE</span></strong><span class="koboSpan" id="kobo.272.1"> is prepended in the package version, forcing a higher number </span><span class="No-Break"><span class="koboSpan" id="kobo.273.1">when needed.</span></span></p>
<p><span class="koboSpan" id="kobo.274.1">For example, suppose a package uses the date to compose </span><strong class="source-inline"><span class="koboSpan" id="kobo.275.1">PV</span></strong><span class="koboSpan" id="kobo.276.1"> variables such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.277.1">20220101</span></strong><span class="koboSpan" id="kobo.278.1">, and there is a version schema change to release the </span><strong class="source-inline"><span class="koboSpan" id="kobo.279.1">1.0</span></strong><span class="koboSpan" id="kobo.280.1"> version. </span><span class="koboSpan" id="kobo.280.2">It is impossible to determine whether version </span><strong class="source-inline"><span class="koboSpan" id="kobo.281.1">1.0</span></strong><span class="koboSpan" id="kobo.282.1"> is higher than version </span><strong class="source-inline"><span class="koboSpan" id="kobo.283.1">20220101</span></strong><span class="koboSpan" id="kobo.284.1">. </span><span class="koboSpan" id="kobo.284.2">So, </span><strong class="source-inline"><span class="koboSpan" id="kobo.285.1">PE = "1"</span></strong><span class="koboSpan" id="kobo.286.1"> is used to change the recipe epoch, forcing version </span><strong class="source-inline"><span class="koboSpan" id="kobo.287.1">1.0</span></strong><span class="koboSpan" id="kobo.288.1"> to be higher than </span><strong class="source-inline"><span class="koboSpan" id="kobo.289.1">20220101</span></strong><span class="koboSpan" id="kobo.290.1">, since </span><strong class="source-inline"><span class="koboSpan" id="kobo.291.1">1:1.0</span></strong><span class="koboSpan" id="kobo.292.1"> is greater </span><span class="No-Break"><span class="koboSpan" id="kobo.293.1">than </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.294.1">0:20220101</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.295.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.296.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.297.1">PR</span></strong><span class="koboSpan" id="kobo.298.1"> variable has a default value of </span><strong class="source-inline"><span class="koboSpan" id="kobo.299.1">r0</span></strong><span class="koboSpan" id="kobo.300.1"> and is a part of package versioning. </span><span class="koboSpan" id="kobo.300.2">When it is updated, it forces BitBake to rebuild all tasks of a specific recipe. </span><span class="koboSpan" id="kobo.300.3">We can update it manually in the recipe metadata to force a rebuild we know is needed. </span><span class="koboSpan" id="kobo.300.4">Still, it is fragile because it relies on human interaction and knowledge. </span><span class="koboSpan" id="kobo.300.5">BitBake uses task checksums to control what needs to be rebuilt. </span><span class="koboSpan" id="kobo.300.6">The manual </span><strong class="source-inline"><span class="koboSpan" id="kobo.301.1">PR</span></strong><span class="koboSpan" id="kobo.302.1"> increment is only used in rare cases when the task checksum does </span><span class="No-Break"><span class="koboSpan" id="kobo.303.1">not change.</span></span></p>
<h1 id="_idParaDest-77"><a id="_idTextAnchor105"/><span class="koboSpan" id="kobo.304.1">Specifying runtime package dependencies</span></h1>
<p><span class="koboSpan" id="kobo.305.1">The results of most recipes are </span><a id="_idIndexMarker164"/><span class="koboSpan" id="kobo.306.1">packages managed by the package manager. </span><span class="koboSpan" id="kobo.306.2">As we saw in the previous sections, it requires information about all those packages and how they relate. </span><span class="koboSpan" id="kobo.306.3">For example, a package may depend on or conflict </span><span class="No-Break"><span class="koboSpan" id="kobo.307.1">with another.</span></span></p>
<p><span class="koboSpan" id="kobo.308.1">Constraints exist within multiple package relationships; however, those constraints are package format-specific, so BitBake has specific metadata to abstract </span><span class="No-Break"><span class="koboSpan" id="kobo.309.1">those constraints.</span></span></p>
<p><span class="koboSpan" id="kobo.310.1">Here is a list of the most used package </span><span class="No-Break"><span class="koboSpan" id="kobo.311.1">runtime constraints:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.312.1">RDEPENDS</span></strong><span class="koboSpan" id="kobo.313.1">: The list of packages must be available at runtime, along with the package that </span><span class="No-Break"><span class="koboSpan" id="kobo.314.1">defines it.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.315.1">RPROVIDES</span></strong><span class="koboSpan" id="kobo.316.1">: This is the list of symbolic names a package provides. </span><span class="koboSpan" id="kobo.316.2">By default, a package always includes the package name as a symbolic name. </span><span class="koboSpan" id="kobo.316.3">It can also include alternative symbolic names provided by </span><span class="No-Break"><span class="koboSpan" id="kobo.317.1">that package.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.318.1">RCONFLICTS</span></strong><span class="koboSpan" id="kobo.319.1">: This is the list of packages known to conflict with the package. </span><span class="koboSpan" id="kobo.319.2">The final image must not include </span><span class="No-Break"><span class="koboSpan" id="kobo.320.1">conflicting packages.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.321.1">RREPLACES</span></strong><span class="koboSpan" id="kobo.322.1">: This is a list of symbolic names that the package </span><span class="No-Break"><span class="koboSpan" id="kobo.323.1">can replace.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.324.1">A full recipe, from </span><strong class="source-inline"><span class="koboSpan" id="kobo.325.1">meta/recipes-devtools/python/python3-dbus_1.2.18.bb</span></strong><span class="koboSpan" id="kobo.326.1">, is </span><span class="No-Break"><span class="koboSpan" id="kobo.327.1">as follows:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer064">
<span class="koboSpan" id="kobo.328.1"><img alt="Figure 7.7 – An example of how to use RDEPENDS" src="image/Figure_7.07_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.329.1">Figure 7.7 – An example of how to use RDEPENDS</span></p>
<p><span class="koboSpan" id="kobo.330.1">The recipe from </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.331.1">Figure 7</span></em></span><em class="italic"><span class="koboSpan" id="kobo.332.1">.6</span></em><span class="koboSpan" id="kobo.333.1"> shows that the </span><strong class="source-inline"><span class="koboSpan" id="kobo.334.1">python3-dbus</span></strong><span class="koboSpan" id="kobo.335.1"> package has a list of runtime dependencies on several </span><a id="_idIndexMarker165"/><span class="koboSpan" id="kobo.336.1">Python modules, on </span><span class="No-Break"><span class="koboSpan" id="kobo.337.1">line 21.</span></span></p>
<h1 id="_idParaDest-78"><a id="_idTextAnchor106"/><span class="koboSpan" id="kobo.338.1">Using packages to generate a rootfs image</span></h1>
<p><span class="koboSpan" id="kobo.339.1">One of the most</span><a id="_idIndexMarker166"/><span class="koboSpan" id="kobo.340.1"> common uses of Poky is the </span><strong class="source-inline"><span class="koboSpan" id="kobo.341.1">rootfs</span></strong><span class="koboSpan" id="kobo.342.1"> image generation. </span><span class="koboSpan" id="kobo.342.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.343.1">rootfs</span></strong><span class="koboSpan" id="kobo.344.1"> image should be seen as a ready-to-use root filesystem for a target. </span><span class="koboSpan" id="kobo.344.2">The image can be composed of one or more filesystems. </span><span class="koboSpan" id="kobo.344.3">It may include other artifacts</span><a id="_idIndexMarker167"/><span class="koboSpan" id="kobo.345.1"> available during its generation, such as the Linux kernel, the device tree, and bootloader binaries. </span><span class="koboSpan" id="kobo.345.2">The process of generating the image is composed of several steps. </span><span class="koboSpan" id="kobo.345.3">Its most common uses are </span><span class="No-Break"><span class="koboSpan" id="kobo.346.1">as follows:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.347.1">Generating the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.348.1">rootfs</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.349.1"> directory</span></span></li>
<li><span class="koboSpan" id="kobo.350.1">Creating the </span><span class="No-Break"><span class="koboSpan" id="kobo.351.1">required files</span></span></li>
<li><span class="koboSpan" id="kobo.352.1">Wrapping the final filesystem according to the specific requirements (it may be a disk file with several partitions </span><span class="No-Break"><span class="koboSpan" id="kobo.353.1">and contents)</span></span></li>
<li><span class="koboSpan" id="kobo.354.1">Finally, compressing it, </span><span class="No-Break"><span class="koboSpan" id="kobo.355.1">if applicable</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.356.1">The sub-tasks of </span><strong class="source-inline"><span class="koboSpan" id="kobo.357.1">do_rootfs</span></strong><span class="koboSpan" id="kobo.358.1"> perform all these steps. </span><strong class="source-inline"><span class="koboSpan" id="kobo.359.1">rootfs</span></strong><span class="koboSpan" id="kobo.360.1"> is a directory with the desired packages installed, with the required tweaks applied afterward. </span><span class="koboSpan" id="kobo.360.2">The tweaks make minor adjustments to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.361.1">rootfs</span></strong><span class="koboSpan" id="kobo.362.1"> contents – for example, when building a development image, </span><strong class="source-inline"><span class="koboSpan" id="kobo.363.1">rootfs</span></strong><span class="koboSpan" id="kobo.364.1"> is </span><a id="_idIndexMarker168"/><span class="koboSpan" id="kobo.365.1">adjusted to allow us to log in as </span><strong class="source-inline"><span class="koboSpan" id="kobo.366.1">root</span></strong><span class="koboSpan" id="kobo.367.1"> without </span><span class="No-Break"><span class="koboSpan" id="kobo.368.1">a password.</span></span></p>
<p><span class="koboSpan" id="kobo.369.1">The list of packages to be</span><a id="_idIndexMarker169"/><span class="koboSpan" id="kobo.370.1"> installed into </span><strong class="source-inline"><span class="koboSpan" id="kobo.371.1">rootfs</span></strong><span class="koboSpan" id="kobo.372.1"> is defined by a union of packages listed by </span><strong class="source-inline"><span class="koboSpan" id="kobo.373.1">IMAGE_INSTALL</span></strong><span class="koboSpan" id="kobo.374.1"> and the packages included with </span><strong class="source-inline"><span class="koboSpan" id="kobo.375.1">IMAGE_FEATURES</span></strong><span class="koboSpan" id="kobo.376.1">; image customization is detailed in </span><a href="B19361_12.xhtml#_idTextAnchor147"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.377.1">Chapter 12</span></em></span></a><span class="koboSpan" id="kobo.378.1">, </span><em class="italic"><span class="koboSpan" id="kobo.379.1">Creating Custom Layers</span></em><span class="koboSpan" id="kobo.380.1">. </span><span class="koboSpan" id="kobo.380.2">Each image feature can include extra packages for installation – for example, </span><strong class="source-inline"><span class="koboSpan" id="kobo.381.1">dev-pkgs</span></strong><span class="koboSpan" id="kobo.382.1">, which installs development libraries and headers of all packages listed to be installed </span><span class="No-Break"><span class="koboSpan" id="kobo.383.1">in </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.384.1">rootfs</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.385.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.386.1">The list of packages to be installed is now filtered by the </span><strong class="source-inline"><span class="koboSpan" id="kobo.387.1">PACKAGE_EXCLUDE</span></strong><span class="koboSpan" id="kobo.388.1"> variable, which lists the packages that should not be installed. </span><span class="koboSpan" id="kobo.388.2">The packages listed in </span><strong class="source-inline"><span class="koboSpan" id="kobo.389.1">PACKAGE_EXCLUDE</span></strong><span class="koboSpan" id="kobo.390.1"> are only excluded from the list of packages to be </span><span class="No-Break"><span class="koboSpan" id="kobo.391.1">explicitly installed.</span></span></p>
<p><span class="koboSpan" id="kobo.392.1">With the final set of packages to install, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.393.1">do_rootfs</span></strong><span class="koboSpan" id="kobo.394.1"> task can initiate the process of unpacking and configuring each package, and its required dependencies, into the </span><strong class="source-inline"><span class="koboSpan" id="kobo.395.1">rootfs</span></strong><span class="koboSpan" id="kobo.396.1"> directory. </span><span class="koboSpan" id="kobo.396.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.397.1">rootfs</span></strong><span class="koboSpan" id="kobo.398.1"> generation uses the local package feed, which we will cover in the </span><span class="No-Break"><span class="koboSpan" id="kobo.399.1">next section.</span></span></p>
<p><span class="koboSpan" id="kobo.400.1">With the </span><strong class="source-inline"><span class="koboSpan" id="kobo.401.1">rootfs</span></strong><span class="koboSpan" id="kobo.402.1"> contents unpacked, the non-target post-installation scripts of the referred packages must run to avoid the penalty of running them during the </span><span class="No-Break"><span class="koboSpan" id="kobo.403.1">first boot.</span></span></p>
<p><span class="koboSpan" id="kobo.404.1">Now, the directory is ready to generate the filesystem. </span><strong class="source-inline"><span class="koboSpan" id="kobo.405.1">IMAGE_FSTYPES</span></strong><span class="koboSpan" id="kobo.406.1"> lists the filesystem to be generated – for example, </span><strong class="bold"><span class="koboSpan" id="kobo.407.1">EXT4</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.408.1">or </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.409.1">UBIFS</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.410.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.411.1">After the </span><strong class="source-inline"><span class="koboSpan" id="kobo.412.1">do_rootfs</span></strong><span class="koboSpan" id="kobo.413.1"> task has finished, the generated image file is placed in </span><strong class="source-inline"><span class="koboSpan" id="kobo.414.1">build/tmp/deploy/image/&lt;machine&gt;/</span></strong><span class="koboSpan" id="kobo.415.1">. </span><span class="koboSpan" id="kobo.415.2">The process of creating our image and the possible values for </span><strong class="source-inline"><span class="koboSpan" id="kobo.416.1">IMAGE_FEATURES</span></strong><span class="koboSpan" id="kobo.417.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.418.1">IMAGE_FSTYPES</span></strong><span class="koboSpan" id="kobo.419.1"> are described in </span><a href="B19361_12.xhtml#_idTextAnchor147"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.420.1">Chapter 12</span></em></span></a><span class="koboSpan" id="kobo.421.1">, </span><em class="italic"><span class="koboSpan" id="kobo.422.1">Creating </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.423.1">Custom Layers</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.424.1">.</span></span></p>
<h1 id="_idParaDest-79"><a id="_idTextAnchor107"/><span class="koboSpan" id="kobo.425.1">Package feeds</span></h1>
<p><span class="koboSpan" id="kobo.426.1">As discussed in </span><a href="B19361_05.xhtml#_idTextAnchor077"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.427.1">Chapter 5</span></em></span></a><span class="koboSpan" id="kobo.428.1">, </span><em class="italic"><span class="koboSpan" id="kobo.429.1">Grasping the BitBake Tool</span></em><span class="koboSpan" id="kobo.430.1">, packages play a vital role, as images and </span><strong class="bold"><span class="koboSpan" id="kobo.431.1">Software Development Kits</span></strong><span class="koboSpan" id="kobo.432.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.433.1">SDKs</span></strong><span class="koboSpan" id="kobo.434.1">) rely on them. </span><span class="koboSpan" id="kobo.434.2">In fact, </span><strong class="source-inline"><span class="koboSpan" id="kobo.435.1">do_rootfs</span></strong><span class="koboSpan" id="kobo.436.1"> uses a local repository to fetch binary</span><a id="_idIndexMarker170"/><span class="koboSpan" id="kobo.437.1"> packages when generating those artifacts. </span><span class="koboSpan" id="kobo.437.2">This repository is known as a </span><span class="No-Break"><span class="koboSpan" id="kobo.438.1">package feed.</span></span></p>
<p><span class="koboSpan" id="kobo.439.1">There is no reason for this</span><a id="_idIndexMarker171"/><span class="koboSpan" id="kobo.440.1"> repository to be used just for the images or SDK build steps. </span><span class="koboSpan" id="kobo.440.2">Several valid reasons exist for making this repository remotely accessible, either internally in our development environment or publicly. </span><span class="koboSpan" id="kobo.440.3">Some of these reasons are </span><span class="No-Break"><span class="koboSpan" id="kobo.441.1">as follows:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.442.1">You can easily test an updated application during the development stage, without requiring a complete </span><span class="No-Break"><span class="koboSpan" id="kobo.443.1">system re-installation</span></span></li>
<li><span class="koboSpan" id="kobo.444.1">You can make additional packages more flexible so that they can be installed in a </span><span class="No-Break"><span class="koboSpan" id="kobo.445.1">running image</span></span></li>
<li><span class="koboSpan" id="kobo.446.1">You can update products in </span><span class="No-Break"><span class="koboSpan" id="kobo.447.1">the field</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.448.1">To produce a solid package feed, we must ensure that we have consistent increments in the package revision every time the package is changed. </span><span class="koboSpan" id="kobo.448.2">It is almost impossible to do this manually, and the Yocto Project has a </span><strong class="source-inline"><span class="koboSpan" id="kobo.449.1">PR</span></strong><span class="koboSpan" id="kobo.450.1"> service specifically designed to help </span><span class="No-Break"><span class="koboSpan" id="kobo.451.1">with this.</span></span></p>
<p><span class="koboSpan" id="kobo.452.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.453.1">PR service</span></strong><span class="koboSpan" id="kobo.454.1">, part of BitBake, is </span><a id="_idIndexMarker172"/><span class="koboSpan" id="kobo.455.1">used to increment </span><strong class="source-inline"><span class="koboSpan" id="kobo.456.1">PR</span></strong><span class="koboSpan" id="kobo.457.1"> without human interaction every time BitBake detects a checksum change in a task. </span><span class="koboSpan" id="kobo.457.2">It injects a suffix in </span><strong class="source-inline"><span class="koboSpan" id="kobo.458.1">PR</span></strong><span class="koboSpan" id="kobo.459.1"> in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.460.1">${PR}.X</span></strong><span class="koboSpan" id="kobo.461.1"> format. </span><span class="koboSpan" id="kobo.461.2">For example, if we have </span><strong class="source-inline"><span class="koboSpan" id="kobo.462.1">PR = "r34"</span></strong><span class="koboSpan" id="kobo.463.1"> after subsequent </span><strong class="source-inline"><span class="koboSpan" id="kobo.464.1">PR</span></strong><span class="koboSpan" id="kobo.465.1"> service interactions, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.466.1">PR</span></strong><span class="koboSpan" id="kobo.467.1"> value becomes </span><strong class="source-inline"><span class="koboSpan" id="kobo.468.1">r34.1</span></strong><span class="koboSpan" id="kobo.469.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.470.1">r34.2</span></strong><span class="koboSpan" id="kobo.471.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.472.1">r34.3</span></strong><span class="koboSpan" id="kobo.473.1">, and so on. </span><span class="koboSpan" id="kobo.473.2">The use of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.474.1">PR</span></strong><span class="koboSpan" id="kobo.475.1"> service is critical for solid package feeds, as it requires the version to </span><span class="No-Break"><span class="koboSpan" id="kobo.476.1">increase linearly.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.477.1">Tip</span></p>
<p class="callout"><span class="koboSpan" id="kobo.478.1">Even though we ought to use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.479.1">PR</span></strong><span class="koboSpan" id="kobo.480.1"> service to have solid package versioning, it does not preclude the need to set </span><strong class="source-inline"><span class="koboSpan" id="kobo.481.1">PR</span></strong><span class="koboSpan" id="kobo.482.1"> manually in </span><span class="No-Break"><span class="koboSpan" id="kobo.483.1">exceptional cases.</span></span></p>
<p><span class="koboSpan" id="kobo.484.1">By default, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.485.1">PR</span></strong><span class="koboSpan" id="kobo.486.1"> service is not enabled or running. </span><span class="koboSpan" id="kobo.486.2">We can enable it to run locally by adding the </span><strong class="source-inline"><span class="koboSpan" id="kobo.487.1">PRSERV_HOST</span></strong><span class="koboSpan" id="kobo.488.1"> variable in the BitBake configuration – for example, in </span><strong class="source-inline"><span class="koboSpan" id="kobo.489.1">build/conf/local.conf</span></strong><span class="koboSpan" id="kobo.490.1">, as in </span><span class="No-Break"><span class="koboSpan" id="kobo.491.1">the following:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer065">
<span class="koboSpan" id="kobo.492.1"><img alt="Figure 7.8 – How to configure a PR service to run locally" src="image/Figure_7.08_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.493.1">Figure 7.8 – How to configure a PR service to run locally</span></p>
<p><span class="koboSpan" id="kobo.494.1">This approach is adequate when the build happens on a single computer, which builds every package of the package feed. </span><span class="koboSpan" id="kobo.494.2">BitBake starts and stops the server at each build and automatically increases the required </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.495.1">PR</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.496.1"> values.</span></span></p>
<p><span class="koboSpan" id="kobo.497.1">For a more complex </span><a id="_idIndexMarker173"/><span class="koboSpan" id="kobo.498.1">setup, with multiple computers working against a shared package feed, we must have a single </span><strong class="source-inline"><span class="koboSpan" id="kobo.499.1">PR</span></strong><span class="koboSpan" id="kobo.500.1"> service running, used by all building systems associated with the package feed. </span><span class="koboSpan" id="kobo.500.2">In this case, we need to start the </span><strong class="source-inline"><span class="koboSpan" id="kobo.501.1">PR</span></strong><span class="koboSpan" id="kobo.502.1"> service in the server using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.503.1">bitbake-prserv</span></strong><span class="koboSpan" id="kobo.504.1"> command, shown </span><span class="No-Break"><span class="koboSpan" id="kobo.505.1">as follows:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer066">
<span class="koboSpan" id="kobo.506.1"><img alt="Figure 7.9 – The command line to initiate the PR service server" src="image/Figure_7.09_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.507.1">Figure 7.9 – The command line to initiate the PR service server</span></p>
<p><span class="koboSpan" id="kobo.508.1">In addition to manually-starting the service, we need to update the BitBake configuration file (for example, </span><strong class="source-inline"><span class="koboSpan" id="kobo.509.1">build/conf/local.conf</span></strong><span class="koboSpan" id="kobo.510.1">) of each build system, which connects to a server using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.511.1">PRSERV_HOST</span></strong><span class="koboSpan" id="kobo.512.1"> variable, as described earlier, so that each system points to the server </span><strong class="source-inline"><span class="koboSpan" id="kobo.513.1">IP</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.514.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.515.1">port</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.516.1">.</span></span></p>
<h2 id="_idParaDest-80"><a id="_idTextAnchor108"/><span class="koboSpan" id="kobo.517.1">Using package feeds</span></h2>
<p><span class="koboSpan" id="kobo.518.1">To use package</span><a id="_idIndexMarker174"/><span class="koboSpan" id="kobo.519.1"> feeds, the following two components </span><span class="No-Break"><span class="koboSpan" id="kobo.520.1">are required:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.521.1">The server provides access to </span><span class="No-Break"><span class="koboSpan" id="kobo.522.1">the packages</span></span></li>
<li><span class="koboSpan" id="kobo.523.1">The client accesses the server and downloads the </span><span class="No-Break"><span class="koboSpan" id="kobo.524.1">required packages</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.525.1">The set of packages offered by the package feed is determined by the recipes we build. </span><span class="koboSpan" id="kobo.525.2">We can build one or more recipes and offer them, or build a set of images to generate the desired packages. </span><span class="koboSpan" id="kobo.525.3">Once satisfied with the packages offered, we must create the package index provided by the package feeds. </span><span class="koboSpan" id="kobo.525.4">The following command </span><span class="No-Break"><span class="koboSpan" id="kobo.526.1">performs this:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer067">
<span class="koboSpan" id="kobo.527.1"><img alt="Figure 7.10 – The command line to create the package index" src="image/Figure_7.10_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.528.1">Figure 7.10 – The command line to create the package index</span></p>
<p><span class="koboSpan" id="kobo.529.1">The packages are available inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.530.1">build/tmp/deploy</span></strong><span class="koboSpan" id="kobo.531.1"> directory. </span><span class="koboSpan" id="kobo.531.2">We must choose the respective</span><a id="_idIndexMarker175"/><span class="koboSpan" id="kobo.532.1"> sub-directory depending on the package format chosen. </span><span class="koboSpan" id="kobo.532.2">Poky uses RPM by default, so we must serve the content of the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.533.1">build/tmp/deploy/rpm</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.534.1"> directory.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.535.1">Tip</span></p>
<p class="callout"><span class="koboSpan" id="kobo.536.1">Make sure to run </span><strong class="source-inline"><span class="koboSpan" id="kobo.537.1">bitbake package-index</span></strong><span class="koboSpan" id="kobo.538.1"> after building all packages; otherwise, the package index will not </span><span class="No-Break"><span class="koboSpan" id="kobo.539.1">include them.</span></span></p>
<p><span class="koboSpan" id="kobo.540.1">The package index and packages must be made available through a transfer protocol such as HTTP. </span><span class="koboSpan" id="kobo.540.2">We can use any server we wish for this task, such as Apache, Nginx, and Lighttpd. </span><span class="koboSpan" id="kobo.540.3">A convenient way to make the packages available through HTTP for local development is by using the Python simple HTTP server, shown </span><span class="No-Break"><span class="koboSpan" id="kobo.541.1">as follows:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer068">
<span class="koboSpan" id="kobo.542.1"><img alt="Figure 7.11 – How to provide the package feed by using the Python simple HTTP server" src="image/Figure_7.11_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.543.1">Figure 7.11 – How to provide the package feed by using the Python simple HTTP server</span></p>
<p><span class="koboSpan" id="kobo.544.1">To add support for package management to the image, we have a couple of changes to make. </span><span class="koboSpan" id="kobo.544.2">We need to add </span><strong class="source-inline"><span class="koboSpan" id="kobo.545.1">package-management</span></strong><span class="koboSpan" id="kobo.546.1"> in </span><strong class="source-inline"><span class="koboSpan" id="kobo.547.1">EXTRA_IMAGE_FEATURES</span></strong><span class="koboSpan" id="kobo.548.1"> and set the URI for package fetching on </span><strong class="source-inline"><span class="koboSpan" id="kobo.549.1">PACKAGE_FEED_URIS</span></strong><span class="koboSpan" id="kobo.550.1">. </span><span class="koboSpan" id="kobo.550.2">For example, we can add this to </span><span class="No-Break"><span class="koboSpan" id="kobo.551.1">our </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.552.1">build/conf/local.conf</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.553.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer069">
<span class="koboSpan" id="kobo.554.1"><img alt="Figure 7.12 – How to configure a remote package feed" src="image/Figure_7.12_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.555.1">Figure 7.12 – How to configure a remote package feed</span></p>
<p><span class="koboSpan" id="kobo.556.1">We will detail the </span><strong class="source-inline"><span class="koboSpan" id="kobo.557.1">IMAGE_FEATURES</span></strong><span class="koboSpan" id="kobo.558.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.559.1">EXTRA_IMAGE_FEATURES</span></strong><span class="koboSpan" id="kobo.560.1"> variables in </span><a href="B19361_12.xhtml#_idTextAnchor147"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.561.1">Chapter 12</span></em></span></a><span class="koboSpan" id="kobo.562.1">, </span><em class="italic"><span class="koboSpan" id="kobo.563.1">Creating Custom Layers</span></em><span class="koboSpan" id="kobo.564.1">. </span><span class="koboSpan" id="kobo.564.2">If we want a small image with no package management support, we should omit </span><strong class="source-inline"><span class="koboSpan" id="kobo.565.1">package-management</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.566.1">from </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.567.1">EXTRA_IMAGE_FEATURES</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.568.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.569.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.570.1">PACKAGE_FEED_URIS</span></strong><span class="koboSpan" id="kobo.571.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.572.1">EXTRA_IMAGE_FEATURES</span></strong><span class="koboSpan" id="kobo.573.1"> configurations guarantee that the image on the client side can access the server and has the utilities needed to install, remove, and upgrade its packages. </span><span class="koboSpan" id="kobo.573.2">After these steps, we can use the runtwime package management in the </span><span class="No-Break"><span class="koboSpan" id="kobo.574.1">target device.</span></span></p>
<p><span class="koboSpan" id="kobo.575.1">For example, if we choose the RPM package format for the image, we can fetch the repository information using the </span><span class="No-Break"><span class="koboSpan" id="kobo.576.1">following command:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer070">
<span class="koboSpan" id="kobo.577.1"><img alt="Figure 7.13 – Command line to fetch the package feed repository" src="image/Figure_7.13_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.578.1">Figure 7.13 – Command line to fetch the package feed repository</span></p>
<p><span class="koboSpan" id="kobo.579.1">Use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.580.1">dnf search &lt;package&gt;</span></strong><span class="koboSpan" id="kobo.581.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.582.1">dnf install &lt;package&gt;</span></strong><span class="koboSpan" id="kobo.583.1"> commands to find and install packages from </span><span class="No-Break"><span class="koboSpan" id="kobo.584.1">the repositories.</span></span></p>
<p><span class="koboSpan" id="kobo.585.1">Depending on the </span><a id="_idIndexMarker176"/><span class="koboSpan" id="kobo.586.1">package format chosen, the commands for the target to update the package index, search for, and install a package are different. </span><span class="koboSpan" id="kobo.586.2">See the available command lines for each package format in the </span><span class="No-Break"><span class="koboSpan" id="kobo.587.1">following table:</span></span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table001-1">
<colgroup>
<col/>
<col/>
<col/>
<col/>
</colgroup>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.588.1">Package format</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.589.1">RPM</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.590.1">IPK</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.591.1">DEB</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.592.1">Update the </span><span class="No-Break"><span class="koboSpan" id="kobo.593.1">package index</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.594.1">dnf check-updates</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.595.1">opkg update</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.596.1">apt-get update</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.597.1">Search for </span><span class="No-Break"><span class="koboSpan" id="kobo.598.1">a package</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.599.1">dnf search</span></strong></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.600.1">&lt;</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.601.1">package&gt;</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.602.1">opkg search</span></strong></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.603.1">&lt;</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.604.1">package&gt;</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.605.1">apt-cache search</span></strong></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.606.1">&lt;</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.607.1">package&gt;</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.608.1">Install </span><span class="No-Break"><span class="koboSpan" id="kobo.609.1">a package</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.610.1">dnf install</span></strong></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.611.1">&lt;</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.612.1">package&gt;</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.613.1">opkg install</span></strong></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.614.1">&lt;</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.615.1">package&gt;</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.616.1">apt-get install</span></strong></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.617.1">&lt;</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.618.1">package&gt;</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.619.1">System upgrade</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.620.1">dnf upgrade</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.621.1">opkg upgrade</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="source-inline"><span class="koboSpan" id="kobo.622.1">apt-get </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.623.1">dist- upgrade</span></strong></span></p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.624.1">Table 7.1 – A package management command comparison</span></p>
<p><span class="koboSpan" id="kobo.625.1">The use of package feeds are great to use in a local development phase because they enable us to install </span><a id="_idIndexMarker177"/><span class="koboSpan" id="kobo.626.1">packages in an already </span><span class="No-Break"><span class="koboSpan" id="kobo.627.1">deployed image.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.628.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.629.1">The use of package feeds for system upgrades in the field requires a huge test effort to guarantee that a system does not fall into a broken state. </span><span class="koboSpan" id="kobo.629.2">The testing effort is enormous to verify all different upgrade scenarios. </span><span class="koboSpan" id="kobo.629.3">Usually, full image upgrades are safer for </span><span class="No-Break"><span class="koboSpan" id="kobo.630.1">production use.</span></span></p>
<p><span class="koboSpan" id="kobo.631.1">The management of a package feed is much more complex. </span><span class="koboSpan" id="kobo.631.2">It involves several other aspects, such as package dependency chains and different upgrade scenarios. </span><span class="koboSpan" id="kobo.631.3">Creating a complex package feed external server is out of this book’s scope, so please refer to the Yocto Project documentation for </span><span class="No-Break"><span class="koboSpan" id="kobo.632.1">further details.</span></span></p>
<h1 id="_idParaDest-81"><a id="_idTextAnchor109"/><span class="koboSpan" id="kobo.633.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.634.1">This chapter presented the basic concepts of packaging, which has a significant role in Poky and BitBake (package versioning), and how this impacts Poky’s behavior when rebuilding packages and package feeds. </span><span class="koboSpan" id="kobo.634.2">It also showed us how to configure an image to be updated using prebuilt packages provided by a </span><span class="No-Break"><span class="koboSpan" id="kobo.635.1">remote server.</span></span></p>
<p><span class="koboSpan" id="kobo.636.1">In the next chapter, we will learn about the BitBake metadata syntax and its operators and how to append, prepend, and remove content from variables, variable expansions, and so on. </span><span class="koboSpan" id="kobo.636.2">We will then be able to better understand the language used in Yocto </span><span class="No-Break"><span class="koboSpan" id="kobo.637.1">Project engines.</span></span></p>
</div>
<div>
<div class="IMG---Figure" id="_idContainer072">
</div>
</div>
</body></html>