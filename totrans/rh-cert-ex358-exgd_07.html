<html><head></head><body>
		<div id="_idContainer189">
			<h1 id="_idParaDest-80" class="chapter-number"><a id="_idTextAnchor085"/>7</h1>
			<h1 id="_idParaDest-81"><a id="_idTextAnchor086"/>Databases – Setting Up and Working with MariaDB SQL Databases</h1>
			<p>In this chapter, we will be discussing databases. In our case, this will involve going into detail about the operation of MariaDB. This is a powerful tool that allows us to store and access data for use by applications, as well as web servers. With the power of a fully functional database behind your project, you will be able to increase the functionality of your application or web server by adding a multitude of items that can be saved and accessed by these products. Things from shopping carts to member information can all be saved using MariaDB. Let’s get started with learning more about databases and MariaDB for Red Hat Enterprise <span class="No-Break">Linux 8.1.</span></p>
			<p>In this chapter, we’re going to cover the following <span class="No-Break">main topics:</span></p>
			<ul>
				<li>Getting started with MariaDB for data <span class="No-Break">collection storage</span></li>
				<li>Installing and configuring MariaDB on RHEL <span class="No-Break">8 manually</span></li>
				<li>Installing and configuring MariaDB on RHEL 8 using <span class="No-Break">Ansible Automation</span></li>
			</ul>
			<h1 id="_idParaDest-82"><a id="_idTextAnchor087"/>Technical requirements</h1>
			<p>The technical requirements for this chapter are covered in the <span class="No-Break">following subsection.</span></p>
			<h2 id="_idParaDest-83"><a id="_idTextAnchor088"/>Setting up GitHub access</h2>
			<p>Please<a id="_idIndexMarker357"/> refer to the instructions found in <a href="B18607_01.xhtml#_idTextAnchor016"><span class="No-Break"><em class="italic">Chapter 1</em></span></a>, <em class="italic">Block Storage – Learning How to Provision Block Storage on Red Hat Enterprise Linux</em>, to gain access to GitHub. You will find the Ansible Automation playbooks for this chapter at the following link: <a href="https://github.com/PacktPublishing/Red-Hat-Certified-Specialist-in-Services-Management-and-Automation-EX358-Exam-Guide/tree/main/Chapter07">https://github.com/PacktPublishing/Red-Hat-Certified-Specialist-in-Services-Management-and-Automation-EX358-Exam-Guide/tree/main/Chapter07</a>. Remember these are suggested playbooks and are not the only way you can write them – you can make the playbooks work <span class="No-Break">for you.</span></p>
			<p>You can <a id="_idIndexMarker358"/>always change them up using <strong class="source-inline">raw</strong>, <strong class="source-inline">shell</strong>, or <strong class="source-inline">cmd</strong> to achieve the same results but we are demonstrating the best way to accomplish the goals. Also, keep in mind that we are not using the FCQN, which is needed in future versions of Ansible, as that will not be supported in the exam, which covers <span class="No-Break">Ansible 2.9.</span></p>
			<h1 id="_idParaDest-84"><a id="_idTextAnchor089"/>Getting started with MariaDB for data collection storage</h1>
			<p>MariaDB is a<a id="_idIndexMarker359"/> database that allows for the relational storage of objects. This allows for key-value pairs to be stored and accessed using MySQL commands. The ability to save and access this information is paramount for platforms such as forums where usernames and passwords need to be correlated together for authentication, for example. We also use this for inventory tracking in many instances, for businesses both big and small. The power of these databases is a necessity that every company <span class="No-Break">relies upon.</span></p>
			<p><strong class="bold">Structured Query Language</strong> (<strong class="bold">SQL</strong>) is <a id="_idIndexMarker360"/>what is normally used by a <strong class="bold">relational database management system</strong> (<strong class="bold">RDBMS</strong>) in order to control how a <a id="_idIndexMarker361"/>database is <a id="_idIndexMarker362"/>configured and accessed. This system provides the means to configure your database in the manner that is needed to function properly, whether it is used by an application or a web server. The more you use relational databases, the more you will understand their significance when it comes to <span class="No-Break">business strategies.</span></p>
			<p>First, we are going to look at manually installing MariaDB and then we'll move on to the automated installation and manipulation of <span class="No-Break">these databases.</span></p>
			<h1 id="_idParaDest-85">Installing and configuring MariaDB on RHEL 8 man<a id="_idTextAnchor090"/>ually</h1>
			<p>First, we are going to start the <a id="_idIndexMarker363"/>MariaDB installation in order <a id="_idIndexMarker364"/>to get started with using this powerful package of tools. We will look up the MariaDB package to get the default version and the profiles available using the command in the <span class="No-Break">following screenshot:</span></p>
			<div>
				<div id="_idContainer162" class="IMG---Figure">
					<img src="image/Figure_7.01_B18607.jpg" alt="Figure 7.1 – Module list of the server package instead of the client package"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.1 – Module list of the server package instead of the client package</p>
			<p>As <a id="_idIndexMarker365"/>shown in the preceding screenshot, we can<a id="_idIndexMarker366"/> see that MariaDB 10.3 is the default, and we can see the profile of the server, which is what we want to install. We will install the MariaDB server as seen in the <span class="No-Break">following screenshot:</span></p>
			<div>
				<div id="_idContainer163" class="IMG---Figure">
					<img src="image/Figure_7.02_B18607.jpg" alt="Figure 7.2 – Installing the MariaDB server"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.2 – Installing the MariaDB server</p>
			<p>We<a id="_idIndexMarker367"/> will then start and enable the MariaDB<a id="_idIndexMarker368"/> service as shown in the <span class="No-Break">following screenshot:</span></p>
			<div>
				<div id="_idContainer164" class="IMG---Figure">
					<img src="image/Figure_7.03_B18607.jpg" alt="Figure 7.3 – Starting and enabling the MariaDB service"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.3 – Starting and enabling the MariaDB service</p>
			<p>We will <a id="_idIndexMarker369"/>then open the ports for MySQL, which, as<a id="_idIndexMarker370"/> discussed earlier, is how we interact with MariaDB. Opening the firewall rules can be seen in the <span class="No-Break">following screenshot:</span></p>
			<div>
				<div id="_idContainer165" class="IMG---Figure">
					<img src="image/Figure_7.04_B18607.jpg" alt="Figure 7.4 – Opening the firewall rules for MariaDB"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.4 – Opening the firewall rules for MariaDB</p>
			<p>Once we have the <a id="_idIndexMarker371"/>package enabled and started and the firewall open, we<a id="_idIndexMarker372"/> can begin to use our database server for data collection or <span class="No-Break">application backing.</span></p>
			<p>Next, let’s look at the options in the configuration file for controlling network connectivity. We have learned in the previous chapters that controlling network connectivity is key for many purposes. We will look at <strong class="source-inline">/etc/my.cnf.d/mariadb-server.cnf</strong> and pay close attention to a few items to go over, but first, a sample of this file can be seen in the <span class="No-Break">following screenshot:</span></p>
			<div>
				<div id="_idContainer166" class="IMG---Figure">
					<img src="image/Figure_7.05_B18607.jpg" alt="Figure 7.5 – The truncated mariadb-server.cnf file"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.5 – The truncated mariadb-server.cnf file</p>
			<p>If you look at the<a id="_idIndexMarker373"/> Galera-related settings, you will<a id="_idIndexMarker374"/> see an example of some of the items we want to pay attention to, as shown in the <span class="No-Break">following screenshot:</span></p>
			<div>
				<div id="_idContainer167" class="IMG---Figure">
					<img src="image/Figure_7.06_B18607.jpg" alt="Figure 7.6 – The ﻿mariadb-server.cnf file (continued)"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.6 – The mariadb-server.cnf file (continued)</p>
			<p>Here, we <a id="_idIndexMarker375"/>can see <strong class="source-inline">bind-address</strong>, which we <a id="_idIndexMarker376"/>want to move up to the <strong class="source-inline">[mysqld]</strong> section. Next, we want to add <strong class="source-inline">skip-networking=1</strong> so that connections are only allowed on the server. If <strong class="source-inline">skip-networking</strong> is set to <strong class="source-inline">0</strong>, it will listen for connections outside <span class="No-Break">of </span><span class="No-Break"><strong class="source-inline">localhost</strong></span><span class="No-Break">.</span></p>
			<p>For our use, we are going to limit the bind address to IPv4 and we are going to set <strong class="source-inline">skip-networking=1</strong> by adding a line of code to lock out all connections started from outside of the server. These settings configured within the file can be seen in the <span class="No-Break">following screenshot:</span></p>
			<div>
				<div id="_idContainer168" class="IMG---Figure">
					<img src="image/Figure_7.07_B18607.jpg" alt="Figure 7.7 – The updated mariadb-server.cnf file with skip-networking"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.7 – The updated mariadb-server.cnf file with skip-networking</p>
			<p>Once the<a id="_idIndexMarker377"/> settings have been added, ensure <a id="_idIndexMarker378"/>that you restart the MariaDB service using the <span class="No-Break">following command:</span></p>
			<pre class="console">
[emcleroy@rhel1 ~]$ sudo systemctl restart mysql</pre>
			<p>Next, we are going to work on manipulating data in the database. We will use MySQL tools to perform these actions. We will start by logging in to the database using the command shown in the <span class="No-Break">following screenshot:</span></p>
			<div>
				<div id="_idContainer169" class="IMG---Figure">
					<img src="image/Figure_7.08_B18607.jpg" alt="Figure 7.8 – Logging ﻿in to the mysql database for the first time"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.8 – Logging in to the mysql database for the first time</p>
			<p>We are now going to secure the database by running the following command to secure the MySQL <span class="No-Break">database installation:</span></p>
			<pre class="console">
[emcleroy@rhel2 ~]$ sudo mysql_secure_installation</pre>
			<p>This <a id="_idIndexMarker379"/>command removes things such as the <a id="_idIndexMarker380"/>test database and the anonymous user and sets a password for root accounts, among others. We can see the setup in action in the <span class="No-Break">following screenshot:</span></p>
			<div>
				<div id="_idContainer170" class="IMG---Figure">
					<img src="image/Figure_7.09_B18607.jpg" alt="Figure 7.9 – Securing the MariaDB installation"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.9 – Securing the MariaDB installation</p>
			<p>Next, we are going to look at the databases and you will notice there are some default databases. These<a id="_idIndexMarker381"/> are used to handle how <a id="_idIndexMarker382"/>MySQL works within MariaDB, as shown in the <span class="No-Break">following screenshot:</span></p>
			<div>
				<div id="_idContainer171" class="IMG---Figure">
					<img src="image/Figure_7.10_B18607.jpg" alt="Figure 7.10 – Logging in using the newly set password and showing the databases"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.10 – Logging in using the newly set password and showing the databases</p>
			<p>In order to<a id="_idIndexMarker383"/> use a database, we<a id="_idIndexMarker384"/> will use the <strong class="source-inline">USE</strong> command, such as <strong class="source-inline">USE information_schema;</strong>, in order to access and manipulate that database. Next, we will use the database creation command and then use that database to manipulate data. We will create this new personnel database and make it ready for use as shown in the <span class="No-Break">following screenshot:</span></p>
			<div>
				<div id="_idContainer172" class="IMG---Figure">
					<img src="image/Figure_7.11_B18607.jpg" alt="Figure 7.11 – Using the personnel database"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.11 – Using the personnel database</p>
			<p>After that, we will <a id="_idIndexMarker385"/>want to inspect the <a id="_idIndexMarker386"/>database and see whether anything is in it. For this, we will switch to the personnel database. We can identify that the database is currently empty in the <span class="No-Break">following screenshot:</span></p>
			<div>
				<div id="_idContainer173" class="IMG---Figure">
					<img src="image/Figure_7.12_B18607.jpg" alt="Figure 7.12 – Showing the tables are empty within the personnel database"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.12 – Showing the tables are empty within the personnel database</p>
			<p>After we have created the<a id="_idIndexMarker387"/> database, we are going<a id="_idIndexMarker388"/> to create a table for the database using the command shown in the <span class="No-Break">following screenshot:</span></p>
			<div>
				<div id="_idContainer174" class="IMG---Figure">
					<img src="image/Figure_7.13_B18607.jpg" alt="Figure 7.13 – Creating tables in the personnel database"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.13 – Creating tables in the personnel database</p>
			<p>Next, we will be<a id="_idIndexMarker389"/> adding information to the <a id="_idIndexMarker390"/>name and phone number columns so that we have something to search through. We can see the commands to add to the database table in the <span class="No-Break">following screenshot:</span></p>
			<div>
				<div id="_idContainer175" class="IMG---Figure">
					<img src="image/Figure_7.14_B18607.jpg" alt="Figure 7.14 – Creating data within the table of the personnel database"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.14 – Creating data within the table of the personnel database</p>
			<p>You can also<a id="_idIndexMarker391"/> search for items within<a id="_idIndexMarker392"/> tables using the command shown in the <span class="No-Break">following screenshot:</span></p>
			<div>
				<div id="_idContainer176" class="IMG---Figure">
					<img src="image/Figure_7.15_B18607.jpg" alt="Figure 7.15 – Searching the database using known information"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.15 – Searching the database using known information</p>
			<p>The <strong class="source-inline">SELECT</strong> command can be used with the <strong class="source-inline">WHERE</strong> variable, as in the following command, to <a id="_idIndexMarker393"/>look for a specific column <a id="_idIndexMarker394"/>within <span class="No-Break">a database:</span></p>
			<pre class="console">
SELECT * FROM users WHERE phone_number = '(901)678-5887';</pre>
			<p>Next, we are going to talk about taking a backup of your database. This will allow you to restore information that you have backed up recently using the <strong class="source-inline">mysqldump</strong> command. More about the <strong class="source-inline">mysqldump</strong> command can be found in the man page for it, as shown in the <span class="No-Break">following screenshot:</span></p>
			<div>
				<div id="_idContainer177" class="IMG---Figure">
					<img src="image/Figure_7.16_B18607.jpg" alt="Figure 7.16 – mysqldump man page"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.16 – mysqldump man page</p>
			<p>We <a id="_idIndexMarker395"/>will use the following command to back <a id="_idIndexMarker396"/>up <span class="No-Break">the database:</span></p>
			<pre class="console">
[emcleroy@rhel2 ~]$ mysqldump -u root -p personnel &gt;/tmp/mariadb.dump</pre>
			<p>This command execution can be seen in the <span class="No-Break">following screenshot:</span></p>
			<div>
				<div id="_idContainer178" class="IMG---Figure">
					<img src="image/Figure_7.17_B18607.jpg" alt="Figure 7.17 – Creating a backup of the personnel database"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.17 – Creating a backup of the personnel database</p>
			<p>Next, we <a id="_idIndexMarker397"/>are going to restore from the <a id="_idIndexMarker398"/>backup. We will use the following command to choose the backup file we want to restore and restore it to <span class="No-Break">our database:</span></p>
			<pre class="console">
[emcleroy@rhel2 ~]$ mysql -u root -p personnel &lt; /tmp/mariadb.dump</pre>
			<p>Let’s test this by dropping the <strong class="source-inline">users</strong> table as shown in the following screenshot and then restoring <span class="No-Break">the database:</span></p>
			<div>
				<div id="_idContainer179" class="IMG---Figure">
					<img src="image/Figure_7.18_B18607.jpg" alt="Figure 7.18 – Removing tables and checking that they are missing before restoring them"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.18 – Removing tables and checking that they are missing before restoring them</p>
			<p>Now, we <a id="_idIndexMarker399"/>are going to restore the<a id="_idIndexMarker400"/> database and show that the table has been recreated, as shown in the <span class="No-Break">following screenshot:</span></p>
			<div>
				<div id="_idContainer180" class="IMG---Figure">
					<img src="image/Figure_7.19_B18607.jpg" alt="Figure 7.19 – Restoring the database and showing that the tables are now back"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.19 – Restoring the database and showing that the tables are now back</p>
			<p>Once you<a id="_idIndexMarker401"/> load this information back<a id="_idIndexMarker402"/> into your database, you can use <strong class="source-inline">show</strong> commands to gather information for <span class="No-Break">anything needed.</span></p>
			<p>Finally, we are going to show how to control user access to your systems. We are going to add users with different rights to the databases. Adding these users can be done with the following command in <span class="No-Break">this screenshot:</span></p>
			<div>
				<div id="_idContainer181" class="IMG---Figure">
					<img src="image/Figure_7.20_B18607.jpg" alt="Figure 7.20 – Creating users for the databases"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.20 – Creating users for the databases</p>
			<p>In the <a id="_idIndexMarker403"/>preceding screenshot, you<a id="_idIndexMarker404"/> can see we created <strong class="source-inline">danny@localhost</strong>, specifying that this is a local user and that it is <strong class="source-inline">identified by</strong>, referring to the password for the user, <strong class="source-inline">redhat</strong>, in our case. Next, we are going to add privileges to <strong class="source-inline">danny</strong> so that he can make changes to the personnel database. The commands for adding privileges can be seen in the following commands within <span class="No-Break">the screenshot:</span></p>
			<div>
				<div id="_idContainer182" class="IMG---Figure">
					<img src="image/Figure_7.21_B18607.jpg" alt="Figure 7.21 – Setting privileges for a new user created"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.21 – Setting privileges for a new user created</p>
			<p>We have<a id="_idIndexMarker405"/> also created <strong class="source-inline">jennifer</strong> as a <a id="_idIndexMarker406"/>user and provided her with privileges to alter the database. This allows <strong class="source-inline">jennifer</strong> to insert, delete, and select items within the personn<a id="_idTextAnchor091"/>el database. Now, we can use <strong class="source-inline">jennifer</strong> to add items to <span class="No-Break">the database.</span></p>
			<h1 id="_idParaDest-86"><a id="_idTextAnchor092"/>Installing and configuring MariaDB on RHEL 8 using Ansible Automation</h1>
			<p>We <a id="_idIndexMarker407"/>will <a id="_idIndexMarker408"/>start with the<a id="_idIndexMarker409"/> inventory file to set up the MariaDB servers and configure them with users. We will then go into manipulating data within the created MariaDB system using loops to add things such as tables and database entries. We will then use Ansible Automation to show how to retrieve information from the MariaDB database so that you can provide information from your database to end users. Please ensure that the server you are running this playbook against has not had MariaDB installed previously, or you will receive errors when trying to set the <span class="No-Break">root password.</span></p>
			<p>First, we are going to start with an inventory file, which can be seen in the <span class="No-Break">following screenshot:</span></p>
			<div>
				<div id="_idContainer183" class="IMG---Figure">
					<img src="image/Figure_7.22_B18607.jpg" alt="Figure 7.22 – Ansible Automation inventory file"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.22 – Ansible Automation inventory file</p>
			<p>From<a id="_idIndexMarker410"/> there, we <a id="_idIndexMarker411"/>are going to <a id="_idIndexMarker412"/>create the <strong class="source-inline">ansible.cfg</strong> file within our directory so that we can skip <strong class="source-inline">host_key_checking</strong>, as it causes issues with connectivity. We can see the Ansible file in the <span class="No-Break">following screenshot:</span></p>
			<div>
				<div id="_idContainer184" class="IMG---Figure">
					<img src="image/Figure_7.23_B18607.jpg" alt="Figure 7.23 – Ansible Automation ansible.cfg file"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.23 – Ansible Automation ansible.cfg file</p>
			<p>After <a id="_idIndexMarker413"/>we have <a id="_idIndexMarker414"/>those files, we <a id="_idIndexMarker415"/>will create the playbook file of <strong class="source-inline">mariadb_server.yml</strong> and start it as normal, as shown in the <span class="No-Break">following code:</span></p>
			<pre class="source-code">
---
- name: MariaDB install and configuration
  hosts: mariadb_servers
  become: true
  become_method: sudo</pre>
			<p>Next, we <a id="_idIndexMarker416"/>are going to<a id="_idIndexMarker417"/> install MariaDB and set up the firewall rules as well. Installing the package and <a id="_idIndexMarker418"/>starting and enabling the service, as well as setting the firewall rules, can be seen in the <span class="No-Break">following code:</span></p>
			<pre class="source-code">
  tasks:
    - name: Install MariaDB server
      package:
        name: '@mariadb:10.3/server'
        state: present
    - name: Install MariaDB client
      package:
        name: mariadb
        state: latest
    - name: Start and enable MariaDB
      service:
        name: mariadb
        state: started
        enabled: true
    - name: Open firewall rules for MariaDB
      firewalld:
        service: mysql
        permanent: true
        state: enabled
    - name: Reload firewall
      command:
        cmd: firewall-cmd --reload</pre>
			<p>After we <a id="_idIndexMarker419"/>have the code<a id="_idIndexMarker420"/> for installing the server, we will move on to securing the MariaDB installation to<a id="_idIndexMarker421"/> enable it and open up the firewall rules. We will start by configuring the root password. We can see that we have configured that in the following code and marked it with <strong class="source-inline">no_log: true</strong> in order to keep the system from outputting this in the <span class="No-Break">log files:</span></p>
			<pre class="source-code">
    - name: Install PyMySQL
      package:
        name: python3-PyMySQL
        state: present
    - name: Set root password for MariaDB
      mysql_user:
        name: root
        host_all: true
        update_password: always
        password: redhat
      no_log: true
      ignore_errors: true</pre>
			<p>Next, we are going to copy a configuration file to <strong class="source-inline">root</strong> so that we can log in and make changes to the database without having to show the user and password. We can also vault this file, but for our purposes, we are simply going to copy it. The file can be seen in the <span class="No-Break">following screenshot:</span></p>
			<div>
				<div id="_idContainer185" class="IMG---Figure">
					<img src="image/Figure_7.24_B18607.jpg" alt="Figure 7.24 – The my.cnf file to provide access for configuring databases"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.24 – The my.cnf file to provide access for configuring databases</p>
			<p>The following <a id="_idIndexMarker422"/>code will <a id="_idIndexMarker423"/>be used <a id="_idIndexMarker424"/>to move the file to the needed location on the server for use later on with the modules to add and change things on <span class="No-Break">the system:</span></p>
			<pre class="source-code">
    - name: Copy user and password to home
      copy:
        src: "{{ playbook_dir }}/my.cnf"
        dest: /root/.my.cnf</pre>
			<p>After that, we will remove the anonymous user so that only authenticated users can access the databases. We can see this removal of the anonymous user in the <span class="No-Break">following code:</span></p>
			<pre class="source-code">
    - name: Delete anonymous user
      mysql_user:
        name: ''
        host_all: yes
        state: absent</pre>
			<p>Next, we <a id="_idIndexMarker425"/>are going to<a id="_idIndexMarker426"/> create a database called <strong class="source-inline">employees</strong>. We will update this database using a loop so that it is <a id="_idIndexMarker427"/>configured with multiple employees within the database. We can see how to create the database and tables and fill in the data in the <span class="No-Break">following code:</span></p>
			<pre class="source-code">
    - name: Add employees database
      mysql_db:
        name: employees
        state: present
        config_file: /root/.my.cnf</pre>
			<p>Next, we will create the <strong class="source-inline">insert.sql</strong> file in order to import the needed database items. This can be seen in the <span class="No-Break">following screenshot:</span></p>
			<div>
				<div id="_idContainer186" class="IMG---Figure">
					<img src="image/Figure_7.25_B18607.jpg" alt="Figure 7.25 – The insert.sql file to import data into the employee database"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.25 – The insert.sql file to import data into the employee database</p>
			<p>After <a id="_idIndexMarker428"/>creating the <a id="_idIndexMarker429"/>database, we <a id="_idIndexMarker430"/>will now create a table within the database with the name of people, as shown in the following code, using the <strong class="source-inline">insert.sql</strong> file to provide the information for the table <span class="No-Break">and data:</span></p>
			<pre class="source-code">
    - name: Copy insert.sql file to tmp
      copy:
        src: "{{ playbook_dir }}/insert.sql"
        dest: /tmp/insert.sql
    - name: Import the insert.sql information into the database
      mysql_db:
        name: employees
        state: import
        target: /tmp/insert.sql
        config_file: /root/.my.cnf</pre>
			<p>Next, we <a id="_idIndexMarker431"/>are going to <a id="_idIndexMarker432"/>create a user for<a id="_idIndexMarker433"/> the databases and provide them with permissions to the newly created database. We can see how we create users with set privileges in the <span class="No-Break">following code:</span></p>
			<pre class="source-code">
    - name: Add user
      mysql_user:
        name: david
        password: redhat
        update_password: on_create
        state: present
      no_log: true
    - name: Provide user with privileges
      mysql_user:
        name: david
        host: localhost
        priv: 'people.*:INSERT,UPDATE,SELECT'
        state: present</pre>
			<p>Now that we have all of this set, we are going to run the playbook. We will use the following command to run the playbook again, assuming you do not have keys <span class="No-Break">set up:</span></p>
			<pre class="console">
[emcleroy@rhel3 mariadb_server]$ ansible-playbook -i inventory mariadb_server.yml -u emcleroy -k --ask-become -v</pre>
			<p>The<a id="_idIndexMarker434"/> following <a id="_idIndexMarker435"/>screenshot shows a<a id="_idIndexMarker436"/> successful Ansible Automation <span class="No-Break">playbook run:</span></p>
			<div>
				<div id="_idContainer187" class="IMG---Figure">
					<img src="image/Figure_7.26_B18607.jpg" alt="Figure 7.26 – Successful playbook run"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.26 – Successful playbook run</p>
			<p>After a successful playbook run, you can see the information has been added, as shown in the <span class="No-Break">following screenshot:</span></p>
			<div>
				<div id="_idContainer188" class="IMG---Figure">
					<img src="image/Figure_7.27_B18607.jpg" alt="Figure 7.27 – Data is now populated within the system"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.27 – Data is now populated within the system</p>
			<p>In this <a id="_idIndexMarker437"/>section, we<a id="_idIndexMarker438"/> learned<a id="_idIndexMarker439"/> how to automate the installation and configuration of MariaDB. With this information, you can successfully deploy databases quickly and more confidently. The lower threshold for human error allows for greater confidence in the deployment and it can be done in seconds instead of hours, which is how long it would take somebody to do so with a keyboard for multiple databases. This is an advantage of using <span class="No-Break">Ansible Automation.</span></p>
			<h1 id="_idParaDest-87"><a id="_idTextAnchor093"/>Summary</h1>
			<p>In this chapter, we learned about the MariaDB SQL database and how it can be configured and updated. We learned how to automate it so that it can be easily deployed with the information we need it to have. This allows us to deploy a database quickly without the need for much human intervention. We also were able to back up the database and restore it, which is a crucial thing to be able to do when working with databases. In our next chapter, we will be talking about web servers, which use databases as their backends in some cases. We will go into installing and setting up these databases both manually and with Ansible Automation. I look forward to seeing you in the next chapter on our journey through the preparation for the <span class="No-Break">EX358 exam.</span></p>
		</div>
	</body></html>