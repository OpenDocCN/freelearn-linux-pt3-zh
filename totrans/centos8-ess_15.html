<html><head></head><body><div id="sbo-rt-content"><div id="_idContainer164" class="_idGenObjectStyleOverride-1">&#13;
			<p id="_idParaDest-161" class="Chapter-Title"><span class="ChapterMarker">17. </span><a id="_idTextAnchor221"/>Using NFS to Share CentOS 8 Files with Remote Systems</p>&#13;
			<p class="My-Basic-Paragraph">CentOS 8 provides two mechanisms for sharing files and folders with other systems on a network. One approach is to use technology called Samba. Samba is based on Microsoft Windows Folder Sharing and allows Linux systems to make folders accessible to Windows systems, and also to access Windows based folder shares from Linux. This approach can also be used to share folders between other Linux and UNIX based systems as long as they too have Samba support installed and configured. This is by far the most popular approach to sharing folders in heterogeneous network environments. The topic of folder sharing using Samba is covered in <a href="../Text/Samba_File_Sharing.xhtml#_idTextAnchor232"><span class="My-Italic _idGenCharOverride-1">“Sharing Files between CentOS 8 and Windows Systems with Samba”</span></a>. </p>&#13;
			<p class="My-Basic-Paragraph">Another option, which is targeted specifically at sharing folders between Linux and UNIX based systems, uses technology called <a id="_idIndexMarker362"/>Network File System (<a id="_idIndexMarker363"/>NFS). NFS allows the file system on one Linux computer to be accessed over a network connection by another Linux or UNIX system. NFS was originally developed by Sun Microsystems (now part of Oracle Corporation) in the 1980s and remains the standard mechanism for sharing of remote Linux/UNIX file systems to this day. </p>&#13;
			<p class="My-Basic-Paragraph">NFS is very different to the <a id="_idIndexMarker364"/>Windows SMB resource sharing technology used by Samba. In this chapter we will be looking at network based sharing of folders between CentOS 8 and other UNIX/Linux based systems using NFS. </p>&#13;
			<p id="_idParaDest-162" class="Heading-1-1"><span class="Heading11Marker">17.1 </span><a id="_idTextAnchor222"/>Ensuring <a id="_idIndexMarker365"/>NFS Services are running on CentOS 8</p>&#13;
			<p class="My-Basic-Paragraph">The first task is to verify that the NFS services are installed and running on your CentOS 8 system. This can be achieved either from the command-line, or using the Cockpit interface.</p>&#13;
			<p class="My-Basic-Paragraph">Behind the scenes, NFS makes use of <a id="_idIndexMarker366"/>Remote Procedure Calls (<a id="_idIndexMarker367"/>RPC) to share filesystems over a network between different computers in the form of the <a id="_idIndexMarker368"/><span class="My-Italic _idGenCharOverride-1">rpcbind</span> service. Begin by installing both rpcbind and the NFS service by running the following command from a terminal window:</p>&#13;
			<p class="Code"># dnf install rpcbind nfs-utils</p>&#13;
			<p class="My-Basic-Paragraph">Next, configure these services so that they automatically start at boot time:</p>&#13;
			<p class="Code"># systemctl enable rpcbind</p>&#13;
			<p class="Code"># systemctl enable nfs-server</p>&#13;
			<p class="My-Basic-Paragraph">Once the services have been enabled, start them as follows:</p>&#13;
			<p class="Code"># systemctl start rpcbind</p>&#13;
			<p class="Code"># systemctl start nfs-server</p>&#13;
			<p id="_idParaDest-163" class="Heading-1-1"><span class="Heading11Marker">17.2 </span><a id="_idTextAnchor223"/>Configuring the CentOS 8 Firewall to Allow <a id="_idIndexMarker369"/>NFS Traffic </p>&#13;
			<p class="My-Basic-Paragraph">Next, the firewall needs to be configured to allow NFS traffic. To achieve this, run the following <a id="_idIndexMarker370"/><span class="My-Italic _idGenCharOverride-1">firewall-cmd </span>commands where &lt;zone&gt; is replaced by the appropriate zone for your firewall and system configuration:</p>&#13;
			<p class="Code">firewall-cmd --zone=<span class="My-Italic _idGenCharOverride-2">&lt;zone&gt;</span> --permanent --add-service=mountd</p>&#13;
			<p class="Code">firewall-cmd --zone=<span class="My-Italic _idGenCharOverride-2">&lt;zone&gt;</span> --permanent --add-service=nfs</p>&#13;
			<p class="Code">firewall-cmd --zone=<span class="My-Italic _idGenCharOverride-2">&lt;zone&gt;</span> --permanent --add-service=rpc-bind</p>&#13;
			<p class="Code">firewall-cmd --reload</p>&#13;
			<p id="_idParaDest-164" class="Heading-1-1"><span class="Heading11Marker">17.3 </span><a id="_idTextAnchor224"/>Specifying the Folders to be Shared </p>&#13;
			<p class="My-Basic-Paragraph">Now that <a id="_idIndexMarker371"/>NFS is running and the firewall has been configured, we need to specify which parts of the CentOS 8 file system may be accessed by remote Linux or UNIX systems. These settings can be declared in the <a id="_idIndexMarker372"/><span class="My-Italic _idGenCharOverride-1">/etc/exports </span>file, which will need to be modified to export the directories for remote access via NFS. The syntax for an export line in this file is as follows:</p>&#13;
			<p class="Code">&lt;export&gt; &lt;host1&gt;(&lt;options&gt;) &lt;host2&gt;(&lt;options&gt;)...</p>&#13;
			<p class="My-Basic-Paragraph">In the above line, &lt;export&gt; is replaced by the directory to be exported, &lt;host1&gt; is the name or IP address of the system to which access is being granted and &lt;options&gt; represents the restrictions that are to be imposed on that access (read only, read write etc). Multiple host and options entries may be placed on the same line if required. For example, the following line grants read only permission to the <span class="My-Italic _idGenCharOverride-1">/datafiles</span> directory to a host with the IP address of 192.168.2.38:</p>&#13;
			<p class="Code">/datafiles 192.168.2.38(ro)</p>&#13;
			<p class="My-Basic-Paragraph">The use of wildcards is permitted in order to apply an export to multiple hosts. For example, the following line permits read write access to <span class="My-Italic _idGenCharOverride-1">/home/demo</span> to all external hosts:</p>&#13;
			<p class="Code">/home/demo *(rw)</p>&#13;
			<p class="My-Basic-Paragraph">A full list of options supported by the exports file may be found by reading the exports man page:</p>&#13;
			<p class="Code"># man exports</p>&#13;
			<p class="My-Basic-Paragraph">For the purposes of this chapter, we will configure the <span class="My-Italic _idGenCharOverride-1">/etc/exports</span> file as follows:</p>&#13;
			<p class="Code">/tmp       *(rw,sync)</p>&#13;
			<p class="Code">/vol1      192.168.2.21(ro,sync)</p>&#13;
			<p class="My-Basic-Paragraph">Once configured, the table of exported file systems maintained by the NFS server needs to be updated with the latest <span class="My-Italic _idGenCharOverride-1">/etc/exports</span> settings using the <span class="My-Italic _idGenCharOverride-1">exportfs</span> command as follows:</p>&#13;
			<p class="Code"># exportfs -a</p>&#13;
			<p class="My-Basic-Paragraph">It is also possible to view the current share settings from the command-line using the <span class="My-Italic _idGenCharOverride-1">exportfs</span> tool: </p>&#13;
			<p class="Code"># exportfs</p>&#13;
			<p class="My-Basic-Paragraph">The above command will generate the following output: </p>&#13;
			<p class="Code">/tmp            &lt;world&gt;</p>&#13;
			<p class="Code">/vol1           192.168.2.21</p>&#13;
			<p id="_idParaDest-165" class="Heading-1-1"><span class="Heading11Marker">17.4 </span><a id="_idTextAnchor225"/>Accessing Shared CentOS 8 Folders </p>&#13;
			<p class="My-Basic-Paragraph">The shared folders may be accessed from a client system by mounting them manually from the command-line. Before attempting to mount a remote <a id="_idIndexMarker373"/>NFS folder, the <span class="My-Italic _idGenCharOverride-1">nfs-utils</span> package should first be installed on the client system:</p>&#13;
			<p class="Code"># dnf install nfs-utils</p>&#13;
			<p class="My-Basic-Paragraph">To mount a remote folder from the command-line, open a terminal window and create a folder where you would like the remote folder to be mounted: </p>&#13;
			<p class="Code"># mkdir /home/demo/tmp</p>&#13;
			<p class="My-Basic-Paragraph">Next enter the command to mount the remote folder using either the IP address or hostname of the remote NFS server, for example: </p>&#13;
			<p class="Code"># mount -t nfs 192.168.1.115:/tmp /home/demo/tmp</p>&#13;
			<p class="My-Basic-Paragraph">The remote <span class="My-Italic _idGenCharOverride-1">/tmp</span> folder will then be mounted on the local system. Once mounted, the <span class="My-Italic _idGenCharOverride-1">/home/demo/tmp</span> folder will contain the remote folder and all its contents. </p>&#13;
			<p class="My-Basic-Paragraph">Options may also be specified when mounting a remote NFS filesystem. The following command, for example, mounts the same folder, but configures it to be read-only:</p>&#13;
			<p class="Code"># mount -t nfs -o ro 192.168.1.115:/tmp /home/demo/tmp</p>&#13;
			<p id="_idParaDest-166" class="Heading-1-1"><span class="Heading11Marker">17.5 </span><a id="_idTextAnchor226"/>Mounting an NFS Filesystem on System Startup </p>&#13;
			<p class="My-Basic-Paragraph">It is also possible to configure a CentOS 8 system to automatically mount a remote file system each time the system starts up by editing the <span class="My-Italic _idGenCharOverride-1">/etc/fstab</span> file. When loaded into an editor, it will likely resemble the following: </p>&#13;
			<p class="Code">/dev/mapper/cl-root   /                       xfs     defaults        0 0</p>&#13;
			<p class="Code">UUID=c2c3b49a-e1a1-4004 /boot                   xfs     defaults        0 0</p>&#13;
			<p class="Code">/dev/mapper/cl-home   /home                   xfs     defaults        0 0</p>&#13;
			<p class="Code">/dev/mapper/cl-swap   swap                    swap    defaults        0 0</p>&#13;
			<p class="My-Basic-Paragraph">To mount, for example, a folder with the path <span class="My-Italic _idGenCharOverride-1">/tmp</span> which resides on a system with the IP address 192.168.1.115 in the local folder with the path <span class="My-Italic _idGenCharOverride-1">/home/demo/tmp</span> (note that this folder must already exist) add the following line to the <span class="My-Italic _idGenCharOverride-1">/etc/fstab</span> file: </p>&#13;
			<p class="Code">192.168.1.115:/tmp      /home/demo/tmp           nfs     rw              0 0</p>&#13;
			<p class="My-Basic-Paragraph">Next time the system reboots the <span class="My-Italic _idGenCharOverride-1">/tmp</span> folder located on the remote system will be mounted on the local <span class="My-Italic _idGenCharOverride-1">/home/demo/tmp</span> mount point. All the files in the remote folder can then be accessed as if they reside on the local hard disk drive. </p>&#13;
			<p id="_idParaDest-167" class="Heading-1-1"><span class="Heading11Marker">17.6 </span><a id="_idTextAnchor227"/>Unmounting an <a id="_idIndexMarker374"/>NFS Mount Point </p>&#13;
			<p class="My-Basic-Paragraph">Once a remote file system is mounted using NFS it can be unmounted using the <span class="My-Italic _idGenCharOverride-1">umount</span> command with the local mount point as the command-line argument. The following command, for example, will unmount our example filesystem mount point: </p>&#13;
			<p class="Code"># umount /home/demo/tmp</p>&#13;
			<p id="_idParaDest-168" class="Heading-1-1"><span class="Heading11Marker">17.7 </span><a id="_idTextAnchor228"/>Accessing <a id="_idIndexMarker375"/><a id="_idIndexMarker376"/>NFS Filesystems in Cockpit</p>&#13;
			<p class="My-Basic-Paragraph">In addition to mounting a remote NFS file system on a client using the command-line, it is also possible to perform mount operations from within the Cockpit web interface. Assuming that Cockpit has been installed and configured on the client system, log into the Cockpit interface from within a web browser and select the <span class="My-Italic _idGenCharOverride-1">Storage</span> option from the left-hand navigation panel. If the Storage option is not listed, the <span class="My-Italic _idGenCharOverride-1">cockpit-storaged</span> package will need to be installed and the cockpit service restarted as follows:</p>&#13;
			<p class="Code"># dnf install cockpit-storaged</p>&#13;
			<p class="Code"># systemctl restart cockpit.socket</p>&#13;
			<p class="My-Basic-Paragraph">Once the Cockpit service has restarted, log back into the Cockpit interface at which point the Storage option should now be visible.</p>&#13;
			<p class="My-Basic-Paragraph">Once selected, the main storage page will include a section listing any currently mounted NFS file systems as illustrated in <a href="../Text/NFS_File_Sharing.xhtml#_idTextAnchor229">Figure 17-1</a>:</p>&#13;
			<p class="My-Basic-Paragraph ParaOverride-1"><img class="_idGenObjectAttribute-1" src="Images/rhel_8_cockpit_nfs_mounts.png" alt="" width="833" height="140"/></p>&#13;
			<p class="Figure-Caption"><span class="FigureCaptionMarker">Figure 17-1</span><a id="_idTextAnchor229"/></p>&#13;
			<p class="My-Basic-Paragraph">To mount a remote filesystem, click on the ‘+’ button highlighted above and enter information about the remote NFS server and file system share together with the local mount point and any necessary options into the resulting dialog before clicking on the <span class="My-Italic _idGenCharOverride-1">Add</span> button:</p>&#13;
			<p class="My-Basic-Paragraph ParaOverride-1"><img class="_idGenObjectAttribute-2" src="Images/rhel_8_cockpit_nfs_mount_dialog.png" alt="" width="600" height="317"/></p>&#13;
			<p class="Figure-Caption"><span class="FigureCaptionMarker">Figure 17-2</span></p>&#13;
			<p class="My-Basic-Paragraph">To modify, unmount or remove an NFS filesystem share, select the corresponding mount in the NFS Mounts list (<a href="../Text/NFS_File_Sharing.xhtml#_idTextAnchor229">Figure 17-1</a> above) to display the page shown in <a href="../Text/NFS_File_Sharing.xhtml#_idTextAnchor230">Figure 17-3</a> below:</p>&#13;
			<p class="My-Basic-Paragraph ParaOverride-1"><img class="_idGenObjectAttribute-3" src="Images/rhel_8_cockpit_nfs_mount_modify.png" alt="" width="861" height="221"/></p>&#13;
			<p class="Figure-Caption"><span class="FigureCaptionMarker">Figure 17-3</span><a id="_idTextAnchor230"/></p>&#13;
			<p class="My-Basic-Paragraph">Within this screen perform tasks such as changing the server or mount points or unmounting the file system. The Remove option unmounts the file system and deletes the entry from the <span class="My-Italic _idGenCharOverride-1">/etc/fstab</span> file so that it does not re-mount next time the system reboots.</p>&#13;
			<p id="_idParaDest-169" class="Heading-1-1"><span class="Heading11Marker">17.8 </span><a id="_idTextAnchor231"/>Summary</p>&#13;
			<p class="My-Basic-Paragraph">The Network File System (NFS) is a client/server-based system, originally developed by Sun Microsystems, which provides a way for Linux and Unix systems to share filesystems over a network. NFS allows a client system to access and (subject to permissions) modify files located on a remote server as though those files are stored on a local filesystem. This chapter has provided an overview of NFS and outlined the options available for configuring both client and server systems using the command-line or the Cockpit web interface.</p>&#13;
		</div>&#13;
</div>



  </body></html>