<html><head></head><body>
<div id="_idContainer122">
<h1 class="chapter-number" id="_idParaDest-87"><a id="_idTextAnchor115"/><span class="koboSpan" id="kobo.1.1">9</span></h1>
<h1 id="_idParaDest-88"><a id="_idTextAnchor116"/><span class="koboSpan" id="kobo.2.1">Developing with the Yocto Project</span></h1>
<p><span class="koboSpan" id="kobo.3.1">So far in this book, we have used Poky as a build tool. </span><span class="koboSpan" id="kobo.3.2">In other words, we have used it as a tool to design and generate the image delivered </span><span class="No-Break"><span class="koboSpan" id="kobo.4.1">to products.</span></span></p>
<p><span class="koboSpan" id="kobo.5.1">In this chapter, we will see how to set up a development environment for use inside the target and meet the </span><strong class="bold"><span class="koboSpan" id="kobo.6.1">Standard SDK</span></strong><span class="koboSpan" id="kobo.7.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.8.1">Extensible SDK</span></strong><span class="koboSpan" id="kobo.9.1"> tools, which can help us develop applications outside the target. </span><span class="koboSpan" id="kobo.9.2">For example, they allow us to cross-compile applications, recipes, </span><span class="No-Break"><span class="koboSpan" id="kobo.10.1">and images.</span></span></p>
<h1 id="_idParaDest-89"><a id="_idTextAnchor117"/><span class="koboSpan" id="kobo.11.1">What is a software development kit?</span></h1>
<p><span class="koboSpan" id="kobo.12.1">In embedded development, the toolchain is often composed of cross-platform tools or tools executed on one architecture, which then produces a binary for use in another architecture – for example, a GCC tool that runs on an x86-64-compatible machine and generates binaries for an ARM machine is a cross-compiler. </span><span class="koboSpan" id="kobo.12.2">When a tool and the resulting binaries rely on dependencies from the same host on which the tool runs, this is commonly called a native build. </span><span class="koboSpan" id="kobo.12.3">Build </span><a id="_idIndexMarker262"/><span class="koboSpan" id="kobo.13.1">and target architectures may be the same, but it is cross-compilation if the target binary uses a staged root filesystem to find </span><span class="No-Break"><span class="koboSpan" id="kobo.14.1">its dependencies.</span></span></p>
<p><span class="koboSpan" id="kobo.15.1">A </span><strong class="bold"><span class="koboSpan" id="kobo.16.1">software development kit</span></strong><span class="koboSpan" id="kobo.17.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.18.1">SDK</span></strong><span class="koboSpan" id="kobo.19.1">) is a set of</span><a id="_idIndexMarker263"/><span class="koboSpan" id="kobo.20.1"> tools and files to develop and debug applications. </span><span class="koboSpan" id="kobo.20.2">These tools include compilers, linkers, debuggers, external libraries, headers, and </span><a id="_idIndexMarker264"/><span class="koboSpan" id="kobo.21.1">binaries, also called a toolchain. </span><span class="koboSpan" id="kobo.21.2">It may also include extra utilities and applications. </span><span class="koboSpan" id="kobo.21.3">We can have two types </span><span class="No-Break"><span class="koboSpan" id="kobo.22.1">of SDK:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.23.1">Cross-development SDKs</span></strong><span class="koboSpan" id="kobo.24.1">: These have</span><a id="_idIndexMarker265"/><span class="koboSpan" id="kobo.25.1"> the goal of being used in the development host to generate binaries for </span><span class="No-Break"><span class="koboSpan" id="kobo.26.1">the</span></span><span class="No-Break"><a id="_idIndexMarker266"/></span><span class="No-Break"><span class="koboSpan" id="kobo.27.1"> target</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.28.1">Native SDKs</span></strong><span class="koboSpan" id="kobo.29.1">: These aim to</span><a id="_idIndexMarker267"/><span class="koboSpan" id="kobo.30.1"> run on the </span><span class="No-Break"><span class="koboSpan" id="kobo.31.1">target</span></span><span class="No-Break"><a id="_idIndexMarker268"/></span><span class="No-Break"><span class="koboSpan" id="kobo.32.1"> device</span></span></li>
</ul>
<h1 id="_idParaDest-90"><a id="_idTextAnchor118"/><span class="koboSpan" id="kobo.33.1">Generating a native SDK for on-device development</span></h1>
<p><span class="koboSpan" id="kobo.34.1">Some embedded </span><a id="_idIndexMarker269"/><span class="koboSpan" id="kobo.35.1">devices are powerful enough to be used as a development environment. </span><span class="koboSpan" id="kobo.35.2">However, the resources needed for the build vary significantly from one library or application to another, so using the target as the building environment may not always be viable. </span><span class="koboSpan" id="kobo.35.3">The development image needs </span><span class="No-Break"><span class="koboSpan" id="kobo.36.1">the following:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.37.1">The header files </span><span class="No-Break"><span class="koboSpan" id="kobo.38.1">and libraries</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.39.1">The toolchain</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.40.1">The following line adds these properties to </span><span class="No-Break"><span class="koboSpan" id="kobo.41.1">an image:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer102">
<span class="koboSpan" id="kobo.42.1"><img alt="Figure 9.1 – How to configure an image to include development artifacts" src="image/Figure_9.01_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.43.1">Figure 9.1 – How to configure an image to include development artifacts</span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.44.1">IMAGE_FEATURES</span></strong><span class="koboSpan" id="kobo.45.1"> in the preceding example extends the image functionality </span><span class="No-Break"><span class="koboSpan" id="kobo.46.1">as follows:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.47.1">dev-pkgs</span></strong><span class="koboSpan" id="kobo.48.1">: Installs development packages (headers and extra library links) for all packages installed in a </span><span class="No-Break"><span class="koboSpan" id="kobo.49.1">given image</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.50.1">tools-sdk</span></strong><span class="koboSpan" id="kobo.51.1">: Installs the toolchain that runs on </span><span class="No-Break"><span class="koboSpan" id="kobo.52.1">the device</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.53.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.54.1">IMAGE_FEATURES</span></strong><span class="koboSpan" id="kobo.55.1"> variable is described in more detail in </span><a href="B19361_12.xhtml#_idTextAnchor147"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.56.1">Chapter 12</span></em></span></a><span class="koboSpan" id="kobo.57.1">, </span><em class="italic"><span class="koboSpan" id="kobo.58.1">Creating </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.59.1">Custom Layers</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.60.1">.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.61.1">Tip</span></p>
<p class="callout"><span class="koboSpan" id="kobo.62.1">If we want to modify only </span><strong class="source-inline"><span class="koboSpan" id="kobo.63.1">build/conf/local.conf</span></strong><span class="koboSpan" id="kobo.64.1">, the variable we should use </span><span class="No-Break"><span class="koboSpan" id="kobo.65.1">is </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.66.1">EXTRA_IMAGE_FEATURES</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.67.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.68.1">The target can use this image during the application development cycle and share the image among all developers working on the same project. </span><span class="koboSpan" id="kobo.68.2">Each developer will have a copy, and the development team will use the same development </span><span class="No-Break"><span class="koboSpan" id="kobo.69.1">environment consistently.</span></span></p>
<h1 id="_idParaDest-91"><a id="_idTextAnchor119"/><span class="koboSpan" id="kobo.70.1">Understanding the types of cross-development SDKs</span></h1>
<p><span class="koboSpan" id="kobo.71.1">The Yocto Project can generate</span><a id="_idIndexMarker270"/><span class="koboSpan" id="kobo.72.1"> two types of cross-development SDKs that aim to cover different needs. </span><span class="koboSpan" id="kobo.72.2">They are defined </span><span class="No-Break"><span class="koboSpan" id="kobo.73.1">as follows:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.74.1">Standard SDK</span></strong><span class="koboSpan" id="kobo.75.1">: This provides</span><a id="_idIndexMarker271"/><span class="koboSpan" id="kobo.76.1"> the artifacts for application</span><a id="_idIndexMarker272"/><span class="koboSpan" id="kobo.77.1"> development, be it for bootloader or Linux kernel development, or some other user </span><span class="No-Break"><span class="koboSpan" id="kobo.78.1">space software</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.79.1">Extensible SDK</span></strong><span class="koboSpan" id="kobo.80.1">: This allows the</span><a id="_idIndexMarker273"/><span class="koboSpan" id="kobo.81.1"> installation of extra </span><a id="_idIndexMarker274"/><span class="koboSpan" id="kobo.82.1">packages inside the SDK’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.83.1">sysroot</span></strong><span class="koboSpan" id="kobo.84.1"> directory, as well as recipe and application integration inside a Yocto </span><span class="No-Break"><span class="koboSpan" id="kobo.85.1">Project-controlled environment</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.86.1">The Standard SDK includes a toolchain and debugging applications. </span><span class="koboSpan" id="kobo.86.2">Its goal is to allow users to generate binaries for use in the target. </span><span class="koboSpan" id="kobo.86.3">The Extensible SDK is more powerful and can build images and recipes. </span><span class="koboSpan" id="kobo.86.4">A notable difference between the two types of SDK is the presence of </span><strong class="source-inline"><span class="koboSpan" id="kobo.87.1">devtool</span></strong><span class="koboSpan" id="kobo.88.1"> in the </span><span class="No-Break"><span class="koboSpan" id="kobo.89.1">Extensible SDK.</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.90.1">devtool</span></strong><span class="koboSpan" id="kobo.91.1"> is responsible for providing the additional features of the Extensible SDK. </span><span class="koboSpan" id="kobo.91.2">It is an interface for using BitBake and </span><strong class="source-inline"><span class="koboSpan" id="kobo.92.1">recipetool</span></strong><span class="koboSpan" id="kobo.93.1">’s power. </span><span class="koboSpan" id="kobo.93.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.94.1">devtool</span></strong><span class="koboSpan" id="kobo.95.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.96.1">recipetool</span></strong><span class="koboSpan" id="kobo.97.1"> commands are also available in the traditional Yocto </span><span class="No-Break"><span class="koboSpan" id="kobo.98.1">Project environment.</span></span></p>
<h1 id="_idParaDest-92"><a id="_idTextAnchor120"/><span class="koboSpan" id="kobo.99.1">Using the Standard SDK</span></h1>
<p><span class="koboSpan" id="kobo.100.1">Usually, an SDK has</span><a id="_idIndexMarker275"/><span class="koboSpan" id="kobo.101.1"> a set of libraries and applications it must provide, which is defined in an image tailored to the product. </span><span class="koboSpan" id="kobo.101.2">These are called image-based SDKs. </span><span class="koboSpan" id="kobo.101.3">For example, we can generate the Standard SDK for </span><strong class="source-inline"><span class="koboSpan" id="kobo.102.1">core-image-full-cmdline</span></strong><span class="koboSpan" id="kobo.103.1"> with the </span><span class="No-Break"><span class="koboSpan" id="kobo.104.1">following command:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer103">
<span class="koboSpan" id="kobo.105.1"><img alt="Figure 9.2 – How to generate the Standard SDK for core-image-full-cmdline" src="image/Figure_9.02_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.106.1">Figure 9.2 – How to generate the Standard SDK for core-image-full-cmdline</span></p>
<p><span class="koboSpan" id="kobo.107.1">Another option is to create a generic SDK with the toolchain and debugging tools. </span><span class="koboSpan" id="kobo.107.2">This generic SDK is called </span><strong class="source-inline"><span class="koboSpan" id="kobo.108.1">meta-toolchain</span></strong><span class="koboSpan" id="kobo.109.1"> and is used mainly for Linux kernel and bootloader development and their </span><a id="_idIndexMarker276"/><span class="koboSpan" id="kobo.110.1">debugging processes. </span><span class="koboSpan" id="kobo.110.2">It may not be sufficient to build applications with complex dependencies. </span><span class="koboSpan" id="kobo.110.3">To create </span><strong class="source-inline"><span class="koboSpan" id="kobo.111.1">meta-toolchain</span></strong><span class="koboSpan" id="kobo.112.1">, use the </span><span class="No-Break"><span class="koboSpan" id="kobo.113.1">following command:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer104">
<span class="koboSpan" id="kobo.114.1"><img alt="Figure 9.3 – How to generate a generic SDK" src="image/Figure_9.03_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.115.1">Figure 9.3 – How to generate a generic SDK</span></p>
<p><span class="koboSpan" id="kobo.116.1">In both cases, the resulting SDK self-installer files are at </span><strong class="source-inline"><span class="koboSpan" id="kobo.117.1">build/tmp/deploy/sdk/</span></strong><span class="koboSpan" id="kobo.118.1">. </span><span class="koboSpan" id="kobo.118.2">Considering we used the Standard SDK for </span><strong class="source-inline"><span class="koboSpan" id="kobo.119.1">core-image-full-cmdline</span></strong><span class="koboSpan" id="kobo.120.1">, we can see the following resulting set </span><span class="No-Break"><span class="koboSpan" id="kobo.121.1">of files:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer105">
<span class="koboSpan" id="kobo.122.1"><img alt="Figure 9.4 – The resultant files after running bitbake core-image-full-cmdline -c populate_sdk" src="image/Figure_9.04_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.123.1">Figure 9.4 – The resultant files after running bitbake core-image-full-cmdline -c populate_sdk</span></p>
<p><span class="koboSpan" id="kobo.124.1">The next step after creating the Standard SDK is to install it, as the Standard SDK is wrapped in an installation script that can be executed in the same manner as any other script. </span><span class="koboSpan" id="kobo.124.2">The following sequence shows the Standard SDK installation process using the standard </span><span class="No-Break"><span class="koboSpan" id="kobo.125.1">target directory:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer106">
<span class="koboSpan" id="kobo.126.1"><img alt="Figure 9.5 – The Standard SDK installation process" src="image/Figure_9.05_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.127.1">Figure 9.5 – The Standard SDK installation process</span></p>
<p><span class="koboSpan" id="kobo.128.1">The preceding Standard SDK illustrates how we can generate and install a Standard SDK. </span><span class="koboSpan" id="kobo.128.2">Still, it is not ideal to use a standard image that is not tailored to your current needs. </span><span class="koboSpan" id="kobo.128.3">Therefore, creating a custom image that fits our application needs is highly recommended. </span><span class="koboSpan" id="kobo.128.4">It is also recommended to base the Standard SDK on this </span><span class="No-Break"><span class="koboSpan" id="kobo.129.1">custom image.</span></span></p>
<p><span class="koboSpan" id="kobo.130.1">The Standard SDK is generated to match the machine architecture we set using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.131.1">MACHINE</span></strong><span class="koboSpan" id="kobo.132.1"> variable. </span><span class="koboSpan" id="kobo.132.2">To use</span><a id="_idIndexMarker277"/><span class="koboSpan" id="kobo.133.1"> the Standard SDK to build a custom application, for example, </span><strong class="source-inline"><span class="koboSpan" id="kobo.134.1">hello-world.c</span></strong><span class="koboSpan" id="kobo.135.1">, we can use the following lines, targeting the </span><span class="No-Break"><span class="koboSpan" id="kobo.136.1">x86-64 architecture:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer107">
<span class="koboSpan" id="kobo.137.1"><img alt="Figure 9.6 – The steps to build a C application using the Standard SDK" src="image/Figure_9.06_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.138.1">Figure 9.6 – The steps to build a C application using the Standard SDK</span></p>
<p><span class="koboSpan" id="kobo.139.1">Another very commonly used project is the Linux kernel. </span><span class="koboSpan" id="kobo.139.2">When we want to build the Linux kernel source code, we can use the following sequence </span><span class="No-Break"><span class="koboSpan" id="kobo.140.1">of commands:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer108">
<span class="koboSpan" id="kobo.141.1"><img alt="Figure 9.7 – The steps to build the Linux ﻿kernel using the Standard SDK" src="image/Figure_9.07_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.142.1">Figure 9.7 – The steps to build the Linux kernel using the Standard SDK</span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.143.1">unset LDFLAGS</span></strong><span class="koboSpan" id="kobo.144.1"> is required to avoid using GCC for linking, which is the Yocto Project-based Standard </span><span class="No-Break"><span class="koboSpan" id="kobo.145.1">SDK’s default.</span></span></p>
<h1 id="_idParaDest-93"><a id="_idTextAnchor121"/><span class="koboSpan" id="kobo.146.1">Using the Extensible SDK</span></h1>
<p><span class="koboSpan" id="kobo.147.1">The Extensible SDK expands the</span><a id="_idIndexMarker278"/><span class="koboSpan" id="kobo.148.1"> functionalities of the Standard SDK. </span><span class="koboSpan" id="kobo.148.2">Some of the significant capabilities included are </span><span class="No-Break"><span class="koboSpan" id="kobo.149.1">as follows:</span></span></p>
<ul>
<li><span class="No-Break"><span class="koboSpan" id="kobo.150.1">Generate recipes</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.151.1">Build recipes</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.152.1">Build images</span></span></li>
<li><span class="koboSpan" id="kobo.153.1">Install packages in the </span><span class="No-Break"><span class="koboSpan" id="kobo.154.1">internal toolchain</span></span></li>
<li><span class="koboSpan" id="kobo.155.1">Deploy packages to </span><span class="No-Break"><span class="koboSpan" id="kobo.156.1">the target</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.157.1">Those additional features are provided by the </span><strong class="source-inline"><span class="koboSpan" id="kobo.158.1">devtool</span></strong><span class="koboSpan" id="kobo.159.1"> utility, which is also available in the standard Yocto </span><span class="No-Break"><span class="koboSpan" id="kobo.160.1">Project environment.</span></span></p>
<p><span class="koboSpan" id="kobo.161.1">To generate the Extensible SDK, use the </span><span class="No-Break"><span class="koboSpan" id="kobo.162.1">following command:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer109">
<span class="koboSpan" id="kobo.163.1"><img alt="Figure 9.8 – Command to generate the Extensible SDK" src="image/Figure_9.08_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.164.1">Figure 9.8 – Command to generate the Extensible SDK</span></p>
<p><span class="koboSpan" id="kobo.165.1">The resulting files </span><a id="_idIndexMarker279"/><span class="koboSpan" id="kobo.166.1">are in </span><strong class="source-inline"><span class="koboSpan" id="kobo.167.1">build/tmp/deploy/sdk/</span></strong><span class="koboSpan" id="kobo.168.1">. </span><span class="koboSpan" id="kobo.168.2">Considering we used the Extensible SDK for </span><strong class="source-inline"><span class="koboSpan" id="kobo.169.1">core-image-full-cmdline</span></strong><span class="koboSpan" id="kobo.170.1">, we see the following set </span><span class="No-Break"><span class="koboSpan" id="kobo.171.1">of files:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer110">
<span class="koboSpan" id="kobo.172.1"><img alt="Figure 9.9 – The resultant files after running bitbake core-image-full-cmdline -c populate_sdk_ext" src="image/Figure_9.09_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.173.1">Figure 9.9 – The resultant files after running bitbake core-image-full-cmdline -c populate_sdk_ext</span></p>
<p><span class="koboSpan" id="kobo.174.1">The next step after creating the Extensible SDK is to install it. </span><span class="koboSpan" id="kobo.174.2">To install it, we can execute the generated script. </span><span class="koboSpan" id="kobo.174.3">The following sequence shows the Extensible SDK installation process using the standard </span><span class="No-Break"><span class="koboSpan" id="kobo.175.1">target directory:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer111">
<span class="koboSpan" id="kobo.176.1"><img alt="Figure 9.10 – The Extensible SDK installation process" src="image/Figure_9.10_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.177.1">Figure 9.10 – The Extensible SDK installation process</span></p>
<p><span class="koboSpan" id="kobo.178.1">The preceding screenshot illustrates how we can generate and install an Extensible SDK. </span><span class="koboSpan" id="kobo.178.2">Still, it is not ideal to use a standard image that is not tailored to your current needs. </span><span class="koboSpan" id="kobo.178.3">Therefore, creating a custom image that fits your application needs is highly recommended, as is basing the Extensible SDK on one. </span><span class="koboSpan" id="kobo.178.4">However, we can build and install any extra dependencies</span><a id="_idIndexMarker280"/><span class="koboSpan" id="kobo.179.1"> into the SDK using the </span><span class="No-Break"><span class="koboSpan" id="kobo.180.1">Extensible SDK.</span></span></p>
<p><span class="koboSpan" id="kobo.181.1">In our case, we installed the Extensible SDK in </span><strong class="source-inline"><span class="koboSpan" id="kobo.182.1">/home/user/poky_sdk</span></strong><span class="koboSpan" id="kobo.183.1">. </span><span class="koboSpan" id="kobo.183.2">After the installation has been completed, the next step is to use the provided script to export the required environment variables, which enables the Extensible SDK’s use, with the </span><span class="No-Break"><span class="koboSpan" id="kobo.184.1">following command:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer112">
<span class="koboSpan" id="kobo.185.1"><img alt="Figure 9.11 – Exporting the environment variables to allow the Extensible SDK to be used" src="image/Figure_9.11_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.186.1">Figure 9.11 – Exporting the environment variables to allow the Extensible SDK to be used</span></p>
<p><span class="koboSpan" id="kobo.187.1">In the following sections, we will cover some use cases using </span><strong class="source-inline"><span class="koboSpan" id="kobo.188.1">devtool</span></strong><span class="koboSpan" id="kobo.189.1">. </span><span class="koboSpan" id="kobo.189.2">All commands are executed inside a terminal with the Extensible SDK </span><span class="No-Break"><span class="koboSpan" id="kobo.190.1">variables exported.</span></span></p>
<p><span class="koboSpan" id="kobo.191.1">The Extensible SDK is a different way to deliver the same Yocto Project tools and metadata. </span><span class="koboSpan" id="kobo.191.2">It wraps together </span><span class="No-Break"><span class="koboSpan" id="kobo.192.1">the following:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.193.1">A basic set of binaries for the Yocto Project </span><span class="No-Break"><span class="koboSpan" id="kobo.194.1">environment execution</span></span></li>
<li><span class="koboSpan" id="kobo.195.1">A Standard SDK </span><span class="No-Break"><span class="koboSpan" id="kobo.196.1">for development</span></span></li>
<li><span class="koboSpan" id="kobo.197.1">A shared state cache to reduce </span><span class="No-Break"><span class="koboSpan" id="kobo.198.1">local builds</span></span></li>
<li><span class="koboSpan" id="kobo.199.1">A snapshot of the Yocto Project metadata </span><span class="No-Break"><span class="koboSpan" id="kobo.200.1">and configuration</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.201.1">Essentially, the Extensible SDK is </span><a id="_idIndexMarker281"/><span class="koboSpan" id="kobo.202.1">a snapshot of the environment used to create it. </span><span class="koboSpan" id="kobo.202.2">Therefore, all </span><strong class="source-inline"><span class="koboSpan" id="kobo.203.1">devtool</span></strong><span class="koboSpan" id="kobo.204.1"> commands, including those we will use in the following sections, are available inside the Yocto </span><span class="No-Break"><span class="koboSpan" id="kobo.205.1">Project environment.</span></span></p>
<h2 id="_idParaDest-94"><a id="_idTextAnchor122"/><span class="koboSpan" id="kobo.206.1">Building an image using devtool</span></h2>
<p><span class="koboSpan" id="kobo.207.1">Let’s start by creating </span><a id="_idIndexMarker282"/><span class="koboSpan" id="kobo.208.1">an image. </span><span class="koboSpan" id="kobo.208.2">The Extensible SDK is capable of creating </span><a id="_idIndexMarker283"/><span class="koboSpan" id="kobo.209.1">any supported image. </span><span class="koboSpan" id="kobo.209.2">For example, to create </span><strong class="source-inline"><span class="koboSpan" id="kobo.210.1">core-image-full-cmdline</span></strong><span class="koboSpan" id="kobo.211.1">, we can use the following </span><span class="No-Break"><span class="koboSpan" id="kobo.212.1">command line:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer113">
<span class="koboSpan" id="kobo.213.1"><img alt="Figure 9.12 – Building core-image-full-cmdline with devtool" src="image/Figure_9.12_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.214.1">Figure 9.12 – Building core-image-full-cmdline with devtool</span></p>
<p><span class="koboSpan" id="kobo.215.1">After running the </span><strong class="source-inline"><span class="koboSpan" id="kobo.216.1">devtool</span></strong><span class="koboSpan" id="kobo.217.1"> command, the generated files can be found </span><span class="No-Break"><span class="koboSpan" id="kobo.218.1">in </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.219.1">/home/user/poky_sdk/tmp/deploy/images/qemux86-64</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.220.1">.</span></span></p>
<h2 id="_idParaDest-95"><a id="_idTextAnchor123"/><span class="koboSpan" id="kobo.221.1">Running an image on QEMU</span></h2>
<p><span class="koboSpan" id="kobo.222.1">We can emulate the target hardware </span><a id="_idIndexMarker284"/><span class="koboSpan" id="kobo.223.1">with QEMU using </span><a id="_idIndexMarker285"/><span class="koboSpan" id="kobo.224.1">the previously built image, </span><strong class="source-inline"><span class="koboSpan" id="kobo.225.1">core-image-full-cmdline</span></strong><span class="koboSpan" id="kobo.226.1">, with the </span><span class="No-Break"><span class="koboSpan" id="kobo.227.1">following command:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer114">
<span class="koboSpan" id="kobo.228.1"><img alt="Figure 9.13 – Emulating with devtool and QEMU" src="image/Figure_9.13_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.229.1">Figure 9.13 – Emulating with devtool and QEMU</span></p>
<p><span class="koboSpan" id="kobo.230.1">It starts the </span><a id="_idIndexMarker286"/><span class="koboSpan" id="kobo.231.1">QEMU execution and generates the </span><a id="_idIndexMarker287"/><span class="koboSpan" id="kobo.232.1">boot splash, as is shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.233.1">following screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer115">
<span class="koboSpan" id="kobo.234.1"><img alt="Figure 9.14 – The QEMU boot splash" src="image/Figure_9.14_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.235.1">Figure 9.14 – The QEMU boot splash</span></p>
<h2 id="_idParaDest-96"><a id="_idTextAnchor124"/><span class="koboSpan" id="kobo.236.1">Creating a recipe from an external Git repository</span></h2>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.237.1">devtool</span></strong><span class="koboSpan" id="kobo.238.1"> is also</span><a id="_idIndexMarker288"/><span class="koboSpan" id="kobo.239.1"> capable of producing a recipe</span><a id="_idIndexMarker289"/><span class="koboSpan" id="kobo.240.1"> from an external Git repository. </span><span class="koboSpan" id="kobo.240.2">Here, we are going to </span><span class="No-Break"><span class="koboSpan" id="kobo.241.1">use </span></span><a href="https://github.com/OSSystems/bbexample"><span class="No-Break"><span class="koboSpan" id="kobo.242.1">https://github.com/OSSystems/bbexample</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.243.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer116">
<span class="koboSpan" id="kobo.244.1"><img alt="Figure 9.15 – Creating the recipe using devtool" src="image/Figure_9.15_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.245.1">Figure 9.15 – Creating the recipe using devtool</span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.246.1">devtool</span></strong><span class="koboSpan" id="kobo.247.1"> creates a basic</span><a id="_idIndexMarker290"/><span class="koboSpan" id="kobo.248.1"> recipe file for</span><a id="_idIndexMarker291"/><span class="koboSpan" id="kobo.249.1"> the given repository. </span><span class="koboSpan" id="kobo.249.2">It creates a workspace with the package source code and the needed metadata. </span><span class="koboSpan" id="kobo.249.3">The file structure used by </span><strong class="source-inline"><span class="koboSpan" id="kobo.250.1">devtool</span></strong><span class="koboSpan" id="kobo.251.1">, after the </span><strong class="source-inline"><span class="koboSpan" id="kobo.252.1">devtool add https://github.com/OSSystems/bbexample</span></strong><span class="koboSpan" id="kobo.253.1"> command is run, is </span><span class="No-Break"><span class="koboSpan" id="kobo.254.1">as follows:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer117">
<span class="koboSpan" id="kobo.255.1"><img alt="Figure 9.16 – The file structure created by devtool when creating a recipe" src="image/Figure_9.16_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.256.1">Figure 9.16 – The file structure created by devtool when creating a recipe</span></p>
<p><span class="koboSpan" id="kobo.257.1">Currently, </span><strong class="source-inline"><span class="koboSpan" id="kobo.258.1">devtool</span></strong><span class="koboSpan" id="kobo.259.1"> generates</span><a id="_idIndexMarker292"/><span class="koboSpan" id="kobo.260.1"> a tentative recipe for</span><a id="_idIndexMarker293"/><span class="koboSpan" id="kobo.261.1"> projects based on </span><span class="No-Break"><span class="koboSpan" id="kobo.262.1">the following:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.263.1">Autotools (</span><strong class="source-inline"><span class="koboSpan" id="kobo.264.1">autoconf</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.265.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.266.1">automake</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.267.1">)</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.268.1">CMake</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.269.1">Scons</span></span></li>
<li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.270.1">qmake</span></strong></span></li>
<li><span class="koboSpan" id="kobo.271.1">A </span><span class="No-Break"><span class="koboSpan" id="kobo.272.1">plain </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.273.1">Makefile</span></strong></span></li>
<li><span class="koboSpan" id="kobo.274.1">The </span><span class="No-Break"><span class="koboSpan" id="kobo.275.1">Node.js module</span></span></li>
<li><span class="koboSpan" id="kobo.276.1">Python modules that use </span><strong class="source-inline"><span class="koboSpan" id="kobo.277.1">setuptools</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.278.1">or </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.279.1">distutils</span></strong></span></li>
</ul>
<h2 id="_idParaDest-97"><a id="_idTextAnchor125"/><span class="koboSpan" id="kobo.280.1">Building a recipe using devtool</span></h2>
<p><span class="koboSpan" id="kobo.281.1">Now that the recipe has</span><a id="_idIndexMarker294"/><span class="koboSpan" id="kobo.282.1"> been created under the </span><a id="_idIndexMarker295"/><span class="koboSpan" id="kobo.283.1">workspace directory, we can build it with the </span><span class="No-Break"><span class="koboSpan" id="kobo.284.1">following command:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer118">
<span class="koboSpan" id="kobo.285.1"><img alt="Figure 9.17 – Building a recipe with devtool" src="image/Figure_9.17_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.286.1">Figure 9.17 – Building a recipe with devtool</span></p>
<h2 id="_idParaDest-98"><a id="_idTextAnchor126"/><span class="koboSpan" id="kobo.287.1">Deploying to the target using devtool</span></h2>
<p><span class="koboSpan" id="kobo.288.1">After building the</span><a id="_idIndexMarker296"/><span class="koboSpan" id="kobo.289.1"> package with </span><strong class="source-inline"><span class="koboSpan" id="kobo.290.1">devtool</span></strong><span class="koboSpan" id="kobo.291.1">, we can deploy it to the target. </span><span class="koboSpan" id="kobo.291.2">In our example, the target is</span><a id="_idIndexMarker297"/><span class="koboSpan" id="kobo.292.1"> the running QEMU. </span><span class="koboSpan" id="kobo.292.2">To access it, use the default QEMU IP address, </span><strong class="source-inline"><span class="koboSpan" id="kobo.293.1">192.168.7.2</span></strong><span class="koboSpan" id="kobo.294.1">, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.295.1">following command:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer119">
<span class="koboSpan" id="kobo.296.1"><img alt="Figure 9.18 – Deploying to the target using devtool" src="image/Figure_9.18_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.297.1">Figure 9.18 – Deploying to the target using devtool</span></p>
<p><span class="koboSpan" id="kobo.298.1">The application is installed in the target. </span><span class="koboSpan" id="kobo.298.2">We can see </span><strong class="source-inline"><span class="koboSpan" id="kobo.299.1">bbexample</span></strong><span class="koboSpan" id="kobo.300.1"> being executed in the QEMU target, as shown in</span><a id="_idIndexMarker298"/><span class="koboSpan" id="kobo.301.1"> the </span><span class="No-Break"><span class="koboSpan" id="kobo.302.1">following screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer120">
<span class="koboSpan" id="kobo.303.1"><img alt="Figure 9.19 –﻿ bbexample executing on the target" src="image/Figure_9.19_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.304.1">Figure 9.19 – bbexample executing on the target</span></p>
<h2 id="_idParaDest-99"><a id="_idTextAnchor127"/><span class="koboSpan" id="kobo.305.1">Extending the SDK</span></h2>
<p><span class="koboSpan" id="kobo.306.1">One of the goals</span><a id="_idIndexMarker299"/><span class="koboSpan" id="kobo.307.1"> of the Extensible SDK is to allow us to install different recipes in the SDK environment. </span><span class="koboSpan" id="kobo.307.2">For example, to have </span><strong class="source-inline"><span class="koboSpan" id="kobo.308.1">libusb1</span></strong><span class="koboSpan" id="kobo.309.1"> available, we can run the</span><a id="_idIndexMarker300"/> <span class="No-Break"><span class="koboSpan" id="kobo.310.1">following command:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer121">
<span class="koboSpan" id="kobo.311.1"><img alt="Figure 9.20 – The installation of a new recipe in the Extensible SDK" src="image/Figure_9.20_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.312.1">Figure 9.20 – The installation of a new recipe in the Extensible SDK</span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.313.1">Tip</span></p>
<p class="callout"><span class="koboSpan" id="kobo.314.1">The Yocto Project Extensible SDK allows for distributed development, as developers can update and extend the existing SDK environment during a project’s lifetime. </span><span class="koboSpan" id="kobo.314.2">There is some infrastructure setup required for the proper use of the Extensible SDK as a </span><strong class="source-inline"><span class="koboSpan" id="kobo.315.1">sstate-cache</span></strong><span class="koboSpan" id="kobo.316.1"> mirror and Extensible SDK server, which requires a complex configuration beyond the scope of this book. </span><span class="koboSpan" id="kobo.316.2">For more details, please refer to the </span><em class="italic"><span class="koboSpan" id="kobo.317.1">Providing Updates to the Extensible SDK After Installation</span></em><span class="koboSpan" id="kobo.318.1"> section of </span><em class="italic"><span class="koboSpan" id="kobo.319.1">Yocto Project Application Development and the Extensible Software Development Kit (</span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.320.1">eSDK)</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.321.1"> (</span></span><a href="https://docs.yoctoproject.org/4.0.4/sdk-manual/appendix-customizing.html#providing-updates-to-the-extensible-sdk-after-installation"><span class="No-Break"><span class="koboSpan" id="kobo.322.1">https://docs.yoctoproject.org/4.0.4/sdk-manual/appendix-customizing.html#providing-updates-to-the-extensible-sdk-after-installation</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.323.1">).</span></span></p>
<h1 id="_idParaDest-100"><a id="_idTextAnchor128"/><span class="koboSpan" id="kobo.324.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.325.1">In this chapter, we learned that the Yocto Project can be used for development and image creation. </span><span class="koboSpan" id="kobo.325.2">We learned how to create different types of toolchains and also how to </span><span class="No-Break"><span class="koboSpan" id="kobo.326.1">use them.</span></span></p>
<p><span class="koboSpan" id="kobo.327.1">In the next chapter, we will look at how we can configure Poky to help us in the debugging process, how we can configure our system to provide the required tools for remote debugging using GDB, and how we can track our changes </span><span class="No-Break"><span class="koboSpan" id="kobo.328.1">using </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.329.1">buildhistory</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.330.1">.</span></span></p>
</div>
<div>
<div class="IMG---Figure" id="_idContainer123">
</div>
</div>
</body></html>