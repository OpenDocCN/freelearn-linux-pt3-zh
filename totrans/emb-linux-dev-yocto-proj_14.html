<html><head></head><body>
<div id="_idContainer184">
<h1 class="chapter-number" id="_idParaDest-141"><a id="_idTextAnchor170"/><span class="koboSpan" id="kobo.1.1">14</span></h1>
<h1 id="_idParaDest-142"><a id="_idTextAnchor171"/><span class="koboSpan" id="kobo.2.1">Achieving GPL Compliance</span></h1>
<p><span class="koboSpan" id="kobo.3.1">In this chapter, we will see how we can ensure open source license compliance and use Poky to provide the artifacts needed, such as the source code, licensing text, and the list of derivative work. </span><span class="koboSpan" id="kobo.3.2">This is critical for most products introduced into the market nowadays, as open source code needs to live alongside </span><span class="No-Break"><span class="koboSpan" id="kobo.4.1">proprietary code.</span></span></p>
<h1 id="_idParaDest-143"><a id="_idTextAnchor172"/><span class="koboSpan" id="kobo.5.1">Understanding copyleft</span></h1>
<p><strong class="bold"><span class="koboSpan" id="kobo.6.1">Copyleft</span></strong><span class="koboSpan" id="kobo.7.1"> is a legal</span><a id="_idIndexMarker428"/><span class="koboSpan" id="kobo.8.1"> way to use copyright law to maximize rights and express freedom. </span><span class="koboSpan" id="kobo.8.2">However, it impacts our products. </span><span class="koboSpan" id="kobo.8.3">We must meet all obligations of open source and free </span><span class="No-Break"><span class="koboSpan" id="kobo.9.1">software licenses.</span></span></p>
<p><span class="koboSpan" id="kobo.10.1">When building a Linux distribution, at least two projects are used: the Linux kernel and a compiler. </span><span class="koboSpan" id="kobo.10.2">The </span><strong class="bold"><span class="koboSpan" id="kobo.11.1">GNU Compiler Collection</span></strong><span class="koboSpan" id="kobo.12.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.13.1">GCC</span></strong><span class="koboSpan" id="kobo.14.1">) is still the </span><a id="_idIndexMarker429"/><span class="koboSpan" id="kobo.15.1">most commonly used compiler. </span><span class="koboSpan" id="kobo.15.2">The Linux kernel </span><a id="_idIndexMarker430"/><span class="koboSpan" id="kobo.16.1">uses the </span><strong class="bold"><span class="koboSpan" id="kobo.17.1">General Public License</span></strong><span class="koboSpan" id="kobo.18.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.19.1">GPL</span></strong><span class="koboSpan" id="kobo.20.1">) </span><strong class="bold"><span class="koboSpan" id="kobo.21.1">v2</span></strong><span class="koboSpan" id="kobo.22.1"> license, and the GCC uses the </span><strong class="bold"><span class="koboSpan" id="kobo.23.1">GPLv2</span></strong><span class="koboSpan" id="kobo.24.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.25.1">GPLv2.1</span></strong><span class="koboSpan" id="kobo.26.1">, and </span><strong class="bold"><span class="koboSpan" id="kobo.27.1">GPLv3</span></strong><span class="koboSpan" id="kobo.28.1"> licenses, depending on the </span><span class="No-Break"><span class="koboSpan" id="kobo.29.1">project used.</span></span></p>
<p><span class="koboSpan" id="kobo.30.1">However, a Linux-based system can include virtually all projects available worldwide, in addition to all applications made by the company for its product. </span><span class="koboSpan" id="kobo.30.2">So how do we know the number of projects and licenses included, and how do we fulfill copyleft </span><span class="No-Break"><span class="koboSpan" id="kobo.31.1">compliance requirements?</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.32.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.33.1">This chapter describes how the Yocto Project can help you in this task but be aware that you must know exactly what you need to provide and the possible license incompatibilities. </span><span class="koboSpan" id="kobo.33.2">Please consult your legal department or a copyright lawyer if you have </span><span class="No-Break"><span class="koboSpan" id="kobo.34.1">any doubts.</span></span></p>
<p><span class="koboSpan" id="kobo.35.1">In the next section, we will look at how the Yocto Project can help us with the most common tasks required for </span><span class="No-Break"><span class="koboSpan" id="kobo.36.1">copyleft compliance.</span></span></p>
<h2 id="_idParaDest-144"><a id="_idTextAnchor173"/><span class="koboSpan" id="kobo.37.1">Understanding copyleft compliance versus proprietary code</span></h2>
<p><span class="koboSpan" id="kobo.38.1">Understanding that proprietary and copyleft-covered codes can coexist in the same product is essential. </span><span class="koboSpan" id="kobo.38.2">Although this is</span><a id="_idIndexMarker431"/><span class="koboSpan" id="kobo.39.1"> the standard for most products available nowadays, we must be careful about the libraries we link the code to</span><a id="_idIndexMarker432"/><span class="koboSpan" id="kobo.40.1"> because some may have license </span><span class="No-Break"><span class="koboSpan" id="kobo.41.1">compatibility issues.</span></span></p>
<p><span class="koboSpan" id="kobo.42.1">One Linux-based system is a set of several projects, each one under a different license. </span><span class="koboSpan" id="kobo.42.2">The Yocto Project helps developers understand that most copyleft projects have the </span><span class="No-Break"><span class="koboSpan" id="kobo.43.1">following obligations:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.44.1">The source code of </span><span class="No-Break"><span class="koboSpan" id="kobo.45.1">the project</span></span></li>
<li><span class="koboSpan" id="kobo.46.1">The license for </span><span class="No-Break"><span class="koboSpan" id="kobo.47.1">the project</span></span></li>
<li><span class="koboSpan" id="kobo.48.1">Any modification to </span><span class="No-Break"><span class="koboSpan" id="kobo.49.1">the project</span></span></li>
<li><span class="koboSpan" id="kobo.50.1">Any script that is required to configure </span><span class="No-Break"><span class="koboSpan" id="kobo.51.1">and build</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.52.1">If one project under copyleft is modified, the license text, the base source code, and any modification must be included in the </span><span class="No-Break"><span class="koboSpan" id="kobo.53.1">final deliverable.</span></span></p>
<p><span class="koboSpan" id="kobo.54.1">The assumptions cover most rights guaranteed by copyleft licenses. </span><span class="koboSpan" id="kobo.54.2">These are the parts where the Yocto Project can help us. </span><span class="koboSpan" id="kobo.54.3">However, before releasing anything, it is recommended that we audit all the materials to be released to make sure </span><span class="No-Break"><span class="koboSpan" id="kobo.55.1">they’re complete.</span></span></p>
<h1 id="_idParaDest-145"><a id="_idTextAnchor174"/><span class="koboSpan" id="kobo.56.1">Managing software licensing with Poky</span></h1>
<p><span class="koboSpan" id="kobo.57.1">One important Poky feature is</span><a id="_idIndexMarker433"/><span class="koboSpan" id="kobo.58.1"> the ability to manage licenses. </span><span class="koboSpan" id="kobo.58.2">Most of the time, we only care about our bugs. </span><span class="koboSpan" id="kobo.58.3">However, managing licenses and the kinds </span><a id="_idIndexMarker434"/><span class="koboSpan" id="kobo.59.1">of licenses used is crucial when creating </span><span class="No-Break"><span class="koboSpan" id="kobo.60.1">a product.</span></span></p>
<p><span class="koboSpan" id="kobo.61.1">Poky keeps track of licenses in every recipe. </span><span class="koboSpan" id="kobo.61.2">In addition, it has a strategy to work with proprietary applications during the </span><span class="No-Break"><span class="koboSpan" id="kobo.62.1">development cycle.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.63.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.64.1">An important thing to know is that a recipe is released under a specific license and represents a project released under a different license. </span><span class="koboSpan" id="kobo.64.2">Therefore, the recipe and the project are two separate entities with specific licenses, so the two licenses must be considered part of </span><span class="No-Break"><span class="koboSpan" id="kobo.65.1">the product.</span></span></p>
<p><span class="koboSpan" id="kobo.66.1">In most recipes, information</span><a id="_idIndexMarker435"/><span class="koboSpan" id="kobo.67.1"> is a comment containing the copyright, license, and author name; this information pertains to the recipe itself. </span><span class="koboSpan" id="kobo.67.2">Then, there is a</span><a id="_idIndexMarker436"/><span class="koboSpan" id="kobo.68.1"> set of variables to describe the package license, and they are </span><span class="No-Break"><span class="koboSpan" id="kobo.69.1">as follows:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.70.1">LICENSE</span></strong><span class="koboSpan" id="kobo.71.1">: This describes the license under which the package </span><span class="No-Break"><span class="koboSpan" id="kobo.72.1">was released.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.73.1">LIC_FILES_CHKSUM</span></strong><span class="koboSpan" id="kobo.74.1">: This may not seem very useful at first sight. </span><span class="koboSpan" id="kobo.74.2">It describes the license file and checksum for a particular package, and we may find much variation in how a project describes its license. </span><span class="koboSpan" id="kobo.74.3">The most common license files are stored </span><span class="No-Break"><span class="koboSpan" id="kobo.75.1">in </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.76.1">meta/files/common-licenses/</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.77.1">.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.78.1">Some projects include a file, such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.79.1">COPYING</span></strong><span class="koboSpan" id="kobo.80.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.81.1">LICENSE</span></strong><span class="koboSpan" id="kobo.82.1">, which specifies the license for the source code. </span><span class="koboSpan" id="kobo.82.2">Others use a header note in each file or the main file. </span><span class="koboSpan" id="kobo.82.3">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.83.1">LIC_FILES_CHKSUM</span></strong><span class="koboSpan" id="kobo.84.1"> variable has the checksum for the license text of a project; if any letters are changed, the checksum is changed as well. </span><span class="koboSpan" id="kobo.84.2">This ensures that any change is noted and consciously accepted by the developer. </span><span class="koboSpan" id="kobo.84.3">A license change may be a typo fix; however, it may also be a change in legal obligations, so the developer needs to review and understand </span><span class="No-Break"><span class="koboSpan" id="kobo.85.1">the difference.</span></span></p>
<p><span class="koboSpan" id="kobo.86.1">When a different license checksum is detected, BitBake launches a build error and points to the project that had its license changed. </span><span class="koboSpan" id="kobo.86.2">You must be careful when this happens, as the license change may impact the use of this software. </span><span class="koboSpan" id="kobo.86.3">To be able to build anything again, you must change the </span><strong class="source-inline"><span class="koboSpan" id="kobo.87.1">LIC_FILE_CHKSUM</span></strong><span class="koboSpan" id="kobo.88.1"> value accordingly and update the </span><strong class="source-inline"><span class="koboSpan" id="kobo.89.1">LICENSE</span></strong><span class="koboSpan" id="kobo.90.1"> field to match the license change. </span><span class="koboSpan" id="kobo.90.2">Your legal department should be consulted if the license terms have changed. </span><span class="koboSpan" id="kobo.90.3">It is also good practice to record the reason for the change in a commit message for </span><span class="No-Break"><span class="koboSpan" id="kobo.91.1">future reference.</span></span></p>
<h2 id="_idParaDest-146"><a id="_idTextAnchor175"/><span class="koboSpan" id="kobo.92.1">Understanding commercial licenses</span></h2>
<p><span class="koboSpan" id="kobo.93.1">By default, Poky does not use any recipe </span><a id="_idIndexMarker437"/><span class="koboSpan" id="kobo.94.1">with a commercial license restriction. </span><span class="koboSpan" id="kobo.94.2">In the recipe file, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.95.1">LICENSE_FLAGS</span></strong><span class="koboSpan" id="kobo.96.1"> variable is used to identify which license restriction that recipe has. </span><span class="koboSpan" id="kobo.96.2">For the </span><strong class="source-inline"><span class="koboSpan" id="kobo.97.1">gstreamer1.0-plugins-ugly</span></strong><span class="koboSpan" id="kobo.98.1"> recipe, the license-related variables are from </span><em class="italic"><span class="koboSpan" id="kobo.99.1">line 5</span></em><span class="koboSpan" id="kobo.100.1"> to </span><em class="italic"><span class="koboSpan" id="kobo.101.1">line 10</span></em><span class="koboSpan" id="kobo.102.1">, as in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.103.1">Figure 14</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.104.1">.1</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.105.1">:</span></span></p>
<p class="IMG---Figure"> </p>
<div>
<div class="IMG---Figure" id="_idContainer177">
<span class="koboSpan" id="kobo.106.1"><img alt="Figure 14.1 – The license-related variables for the gstreamer1.0-plugins-ugly recipe" src="image/Figure_14.1_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.107.1">Figure 14.1 – The license-related variables for the gstreamer1.0-plugins-ugly recipe</span></p>
<p><em class="italic"><span class="koboSpan" id="kobo.108.1">Line 10</span></em><span class="koboSpan" id="kobo.109.1"> indicates to Poky</span><a id="_idIndexMarker438"/><span class="koboSpan" id="kobo.110.1"> that this recipe requires the </span><strong class="source-inline"><span class="koboSpan" id="kobo.111.1">commercial</span></strong><span class="koboSpan" id="kobo.112.1"> license flag to be explicitly accepted for the recipe to be used. </span><span class="koboSpan" id="kobo.112.2">To allow the use of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.113.1">gstreamer1.0-plugins-ugly</span></strong><span class="koboSpan" id="kobo.114.1"> recipe, we can use </span><span class="No-Break"><span class="koboSpan" id="kobo.115.1">the following:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer178">
<span class="koboSpan" id="kobo.116.1"><img alt="Figure 14.2 – How to accept to install the recipes with commercial license restrictions" src="image/Figure_14.2_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.117.1">Figure 14.2 – How to accept to install the recipes with commercial license restrictions</span></p>
<p><span class="koboSpan" id="kobo.118.1">We can add </span><strong class="source-inline"><span class="koboSpan" id="kobo.119.1">LICENSE_FLAGS_ACCEPTED</span></strong><span class="koboSpan" id="kobo.120.1"> in our custom distribution (e.g., </span><strong class="source-inline"><span class="koboSpan" id="kobo.121.1">&lt;my-layer&gt;/conf/distro/my-distro.conf</span></strong><span class="koboSpan" id="kobo.122.1">) or inside </span><strong class="source-inline"><span class="koboSpan" id="kobo.123.1">build/conf/local.conf</span></strong><span class="koboSpan" id="kobo.124.1"> during the initial development stages. </span><span class="koboSpan" id="kobo.124.2">Using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.125.1">commercial</span></strong><span class="koboSpan" id="kobo.126.1"> flag accepts the installation of every recipe that requires this flag. </span><span class="koboSpan" id="kobo.126.2">Still, sometimes we want to manage the recipes we use, demanding specific license terms. </span><span class="koboSpan" id="kobo.126.3">We can use the </span><span class="No-Break"><span class="koboSpan" id="kobo.127.1">following form:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer179">
<span class="koboSpan" id="kobo.128.1"><img alt="Figure 14.3 ﻿– How to accept to only install gstreamer1.0-plugins-ugly" src="image/Figure_14.3_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.129.1">Figure 14.3 – How to accept to only install gstreamer1.0-plugins-ugly</span></p>
<p><span class="koboSpan" id="kobo.130.1">With the code from </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.131.1">Figure 14</span></em></span><em class="italic"><span class="koboSpan" id="kobo.132.1">.3</span></em><span class="koboSpan" id="kobo.133.1"> we accept only the </span><strong class="source-inline"><span class="koboSpan" id="kobo.134.1">commercial</span></strong><span class="koboSpan" id="kobo.135.1"> license flag from </span><strong class="source-inline"><span class="koboSpan" id="kobo.136.1">gstreamer1.0-plugins-ugly</span></strong><span class="koboSpan" id="kobo.137.1">, which is the recipe name. </span><span class="koboSpan" id="kobo.137.2">It is good practice to ensure this flag is enabled for a set of recipes that you have permission to use in a commercial setting. </span><span class="koboSpan" id="kobo.137.3">Please </span><a id="_idIndexMarker439"/><span class="koboSpan" id="kobo.138.1">consult your legal department to </span><span class="No-Break"><span class="koboSpan" id="kobo.139.1">ensure this.</span></span></p>
<h1 id="_idParaDest-147"><a id="_idTextAnchor176"/><span class="koboSpan" id="kobo.140.1">Using Poky to achieve copyleft compliance</span></h1>
<p><span class="koboSpan" id="kobo.141.1">At this point, we know</span><a id="_idIndexMarker440"/><span class="koboSpan" id="kobo.142.1"> how to use Poky and understand its main goal. </span><span class="koboSpan" id="kobo.142.2">It is time to understand the legal aspects of producing a Linux-based system that uses </span><a id="_idIndexMarker441"/><span class="koboSpan" id="kobo.143.1">packages under </span><span class="No-Break"><span class="koboSpan" id="kobo.144.1">different licenses.</span></span></p>
<p><span class="koboSpan" id="kobo.145.1">We can configure Poky to generate the artifacts that should be shared as part of the copyleft </span><span class="No-Break"><span class="koboSpan" id="kobo.146.1">compliance process.</span></span></p>
<h2 id="_idParaDest-148"><a id="_idTextAnchor177"/><span class="koboSpan" id="kobo.147.1">Understanding license auditing</span></h2>
<p><span class="koboSpan" id="kobo.148.1">To help us achieve copyleft compliance, Poky </span><a id="_idIndexMarker442"/><span class="koboSpan" id="kobo.149.1">generates a license manifest during the image build, located </span><span class="No-Break"><span class="koboSpan" id="kobo.150.1">at </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.151.1">build/tmp/deploy/licenses/&lt;image_name-machine_name&gt;-&lt;datastamp&gt;/</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.152.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.153.1">To demonstrate this process, we will use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.154.1">core-image-full-cmdline</span></strong><span class="koboSpan" id="kobo.155.1"> image for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.156.1">qemux86-64</span></strong><span class="koboSpan" id="kobo.157.1"> machine. </span><span class="koboSpan" id="kobo.157.2">To start with our example, look at the files under </span><strong class="source-inline"><span class="koboSpan" id="kobo.158.1">build/tmp/deploy/licenses/core-image-full-cmdline-qemux86-64-&lt;datastamp&gt;</span></strong><span class="koboSpan" id="kobo.159.1">, which are </span><span class="No-Break"><span class="koboSpan" id="kobo.160.1">as follows:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.161.1">image_license.manifest</span></strong><span class="koboSpan" id="kobo.162.1">: This lists the recipe names, versions, licenses, and the packages files available in </span><strong class="source-inline"><span class="koboSpan" id="kobo.163.1">build/tmp/deploy/image/&lt;machine&gt;</span></strong><span class="koboSpan" id="kobo.164.1"> but not installed</span><a id="_idIndexMarker443"/><span class="koboSpan" id="kobo.165.1"> inside the </span><strong class="bold"><span class="koboSpan" id="kobo.166.1">root filesystem</span></strong><span class="koboSpan" id="kobo.167.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.168.1">rootfs</span></strong><span class="koboSpan" id="kobo.169.1">). </span><span class="koboSpan" id="kobo.169.2">The most common examples are the bootloader, the Linux kernel image, and </span><span class="No-Break"><span class="koboSpan" id="kobo.170.1">DTB files.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.171.1">package.manifest</span></strong><span class="koboSpan" id="kobo.172.1">: This lists all the packages in </span><span class="No-Break"><span class="koboSpan" id="kobo.173.1">the image.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.174.1">license.manifest</span></strong><span class="koboSpan" id="kobo.175.1">: This lists the names, versions, recipe names, and licenses for all the installed </span><a id="_idIndexMarker444"/><span class="koboSpan" id="kobo.176.1">packages. </span><span class="koboSpan" id="kobo.176.2">This manifest may be used for copyleft </span><span class="No-Break"><span class="koboSpan" id="kobo.177.1">compliance auditing.</span></span></li>
</ul>
<div>
<div class="IMG---Figure" id="_idContainer180">
<span class="koboSpan" id="kobo.178.1"><img alt="Figure 14.4 – The directory layout for the license manifests under build/tmp/deploy" src="image/Figure_14.4_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.179.1">Figure 14.4 – The directory layout for the license manifests under build/tmp/deploy</span></p>
<p><span class="koboSpan" id="kobo.180.1">The license manifest for each recipe is under </span><strong class="source-inline"><span class="koboSpan" id="kobo.181.1">build/tmp/deploy/licenses/&lt;package-name&gt;</span></strong><span class="koboSpan" id="kobo.182.1">. </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.183.1">Figure 14</span></em></span><em class="italic"><span class="koboSpan" id="kobo.184.1">.4</span></em><span class="koboSpan" id="kobo.185.1"> shows the directory layout for </span><span class="No-Break"><span class="koboSpan" id="kobo.186.1">some packages.</span></span></p>
<h2 id="_idParaDest-149"><a id="_idTextAnchor178"/><span class="koboSpan" id="kobo.187.1">Providing the source code</span></h2>
<p><span class="koboSpan" id="kobo.188.1">The most apparent </span><a id="_idIndexMarker445"/><span class="koboSpan" id="kobo.189.1">way Poky can help us to provide the source code of every project used in our image is by sharing the </span><strong class="source-inline"><span class="koboSpan" id="kobo.190.1">DL_DIR</span></strong><span class="koboSpan" id="kobo.191.1"> content. </span><span class="koboSpan" id="kobo.191.2">However, this approach has one crucial pitfall – any proprietary source code will be shared within </span><strong class="source-inline"><span class="koboSpan" id="kobo.192.1">DL_DIR</span></strong><span class="koboSpan" id="kobo.193.1"> if it is shared as is. </span><span class="koboSpan" id="kobo.193.2">In addition, this approach will share any source code, including parts not required by </span><span class="No-Break"><span class="koboSpan" id="kobo.194.1">copyleft compliance.</span></span></p>
<p><span class="koboSpan" id="kobo.195.1">Poky must be configured to archive the source code before the final image is created. </span><span class="koboSpan" id="kobo.195.2">To have it, we can add the following variables into </span><strong class="source-inline"><span class="koboSpan" id="kobo.196.1">build/conf/local.conf</span></strong><span class="koboSpan" id="kobo.197.1">, as in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.198.1">Figure 14</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.199.1">.5</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.200.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer181">
<span class="koboSpan" id="kobo.201.1"><img alt="Figure 14.5 – Configuring Poky to provide the source code of packages under copyleft" src="image/Figure_14.5_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.202.1">Figure 14.5 – Configuring Poky to provide the source code of packages under copyleft</span></p>
<p><span class="koboSpan" id="kobo.203.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.204.1">archiver</span></strong><span class="koboSpan" id="kobo.205.1"> class copies the source code, patches, and scripts for the filtered license set. </span><span class="koboSpan" id="kobo.205.2">The default configuration is </span><a id="_idIndexMarker446"/><span class="koboSpan" id="kobo.206.1">to have </span><strong class="source-inline"><span class="koboSpan" id="kobo.207.1">COPYLEFT_LICENSE_INCLUDE</span></strong><span class="koboSpan" id="kobo.208.1"> set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.209.1">"GPL* LGPL* AGPL*"</span></strong><span class="koboSpan" id="kobo.210.1"> so the recipes that use source code licensed on those licenses are copied under the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.211.1">build/tmp/deploy/sources/&lt;architecture&gt;</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.212.1"> folders:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer182">
<span class="koboSpan" id="kobo.213.1"><img alt="Figure 14.6 – The build/tmp/deploy/sources directory layout" src="image/Figure_14.6_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.214.1">Figure 14.6 – The build/tmp/deploy/sources directory layout</span></p>
<p><span class="koboSpan" id="kobo.215.1">The class also supports the </span><strong class="source-inline"><span class="koboSpan" id="kobo.216.1">COPYLEFT_LICENSE_EXCLUDE</span></strong><span class="koboSpan" id="kobo.217.1"> variable to ensure packages that use source code licensed on some specific licenses never go into the </span><strong class="source-inline"><span class="koboSpan" id="kobo.218.1">sources</span></strong><span class="koboSpan" id="kobo.219.1"> directory. </span><span class="koboSpan" id="kobo.219.2">By default, it is set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.220.1">"CLOSED Proprietary"</span></strong><span class="koboSpan" id="kobo.221.1">. </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.222.1">Figure 14</span></em></span><em class="italic"><span class="koboSpan" id="kobo.223.1">.6</span></em><span class="koboSpan" id="kobo.224.1"> shows some recipe examples after </span><span class="No-Break"><span class="koboSpan" id="kobo.225.1">baking </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.226.1">core-image-full-cmdline</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.227.1">.</span></span></p>
<h2 id="_idParaDest-150"><a id="_idTextAnchor179"/><span class="koboSpan" id="kobo.228.1">Providing compilation scripts and source code modifications</span></h2>
<p><span class="koboSpan" id="kobo.229.1">With the configuration </span><a id="_idIndexMarker447"/><span class="koboSpan" id="kobo.230.1">provided in the previous section, Poky will package the original source code for each project. </span><span class="koboSpan" id="kobo.230.2">If we want to include the </span><a id="_idIndexMarker448"/><span class="koboSpan" id="kobo.231.1">patched source code, we will only use </span><strong class="source-inline"><span class="koboSpan" id="kobo.232.1">ARCHIVER_MODE[src] = "patched"</span></strong><span class="koboSpan" id="kobo.233.1">; this way, Poky will wrap the project source code after the </span><strong class="source-inline"><span class="koboSpan" id="kobo.234.1">do_patch</span></strong><span class="koboSpan" id="kobo.235.1"> task. </span><span class="koboSpan" id="kobo.235.2">It includes modifications from recipes or the </span><strong class="source-inline"><span class="koboSpan" id="kobo.236.1">.</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.237.1">bbappend</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.238.1"> file.</span></span></p>
<p><span class="koboSpan" id="kobo.239.1">This way, the source code and any modifications can be shared easily. </span><span class="koboSpan" id="kobo.239.2">However, one kind of information still needs to be created: the procedure used to configure and build </span><span class="No-Break"><span class="koboSpan" id="kobo.240.1">the project.</span></span></p>
<p><span class="koboSpan" id="kobo.241.1">To have a reproducible build environment, we can share the configured project, in other words, the project after the </span><strong class="source-inline"><span class="koboSpan" id="kobo.242.1">do_configure</span></strong><span class="koboSpan" id="kobo.243.1"> task. </span><span class="koboSpan" id="kobo.243.2">We can add </span><strong class="source-inline"><span class="koboSpan" id="kobo.244.1">ARCHIVER_MODE[src] = "configured"</span></strong><span class="koboSpan" id="kobo.245.1"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.246.1">build/conf/local.conf</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.247.1">for this.</span></span></p>
<p><span class="koboSpan" id="kobo.248.1">It is important to remember that we must consider that the person on the other side may not use the Yocto Project for copyleft compliance; alternatively, if they are using it, they must know that the modification made to the original source code and configuration procedure is not available. </span><span class="koboSpan" id="kobo.248.2">This is why we share the configured project: it allows anyone to reproduce our </span><span class="No-Break"><span class="koboSpan" id="kobo.249.1">build environment.</span></span></p>
<p><span class="koboSpan" id="kobo.250.1">For all flavors of source code, the default resulting file is a tarball; other options will add </span><strong class="source-inline"><span class="koboSpan" id="kobo.251.1">ARCHIVER_MODE[srpm] = "1"</span></strong><span class="koboSpan" id="kobo.252.1"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.253.1">build/conf/local.conf</span></strong><span class="koboSpan" id="kobo.254.1">, and the resulting file will be an </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.255.1">SRPM</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.256.1"> package.</span></span></p>
<h2 id="_idParaDest-151"><a id="_idTextAnchor180"/><span class="koboSpan" id="kobo.257.1">Providing license text</span></h2>
<p><span class="koboSpan" id="kobo.258.1">When providing the</span><a id="_idIndexMarker449"/><span class="koboSpan" id="kobo.259.1"> source code, the license text is shared inside it. </span><span class="koboSpan" id="kobo.259.2">If we want the license text inside our final image, we can add the following </span><span class="No-Break"><span class="koboSpan" id="kobo.260.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.261.1">build/conf/local.conf</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.262.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer183">
<span class="koboSpan" id="kobo.263.1"><img alt="Figure 14.7 – How to configure Poky to deploy license text inside the final image" src="image/Figure_14.7_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.264.1">Figure 14.7 – How to configure Poky to deploy license text inside the final image</span></p>
<p><span class="koboSpan" id="kobo.265.1">This way, the license files will be</span><a id="_idIndexMarker450"/><span class="koboSpan" id="kobo.266.1"> placed inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.267.1">rootfs</span></strong><span class="koboSpan" id="kobo.268.1">, </span><span class="No-Break"><span class="koboSpan" id="kobo.269.1">under </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.270.1">/usr/share/common-licenses/</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.271.1">.</span></span></p>
<h1 id="_idParaDest-152"><a id="_idTextAnchor181"/><span class="koboSpan" id="kobo.272.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.273.1">In this chapter, we learned how Poky can help with copyleft license compliance and why it should not be used as a legal resource. </span><span class="koboSpan" id="kobo.273.2">Poky enables us to generate source code, reproduction scripts, and license text for packages used in our distribution. </span><span class="koboSpan" id="kobo.273.3">In addition, we learned that the license manifest generated within the image might be used to audit </span><span class="No-Break"><span class="koboSpan" id="kobo.274.1">the image.</span></span></p>
<p><span class="koboSpan" id="kobo.275.1">In the next chapter, we will learn how to use the Yocto Project’s tools with real hardware. </span><span class="koboSpan" id="kobo.275.2">Then, we will use the Yocto Project to generate images for a few </span><span class="No-Break"><span class="koboSpan" id="kobo.276.1">real boards.</span></span></p>
</div>
</body></html>