# 前言

欢迎阅读 *终极 Linux Shell 脚本指南*！本书非常适合 Linux 初学者和更有经验的 Linux 管理员，它将引导你完成 Shell 脚本的创建过程。我们将从基本的命令行使用开始，并逐步深入每一章节中的更高级概念。你将学会如何编写脚本来自动化重复的管理任务，以及其他许多有趣的功能。全书的重点将主要放在 `bash` 脚本上。稍后，我们会展示如何使脚本具有可移植性，以便它们可以在无法运行 `bash` 的旧版 Unix 系统上运行。在关于 Shell 脚本调试和安全性的章节后，我们将以 Z Shell 和 PowerShell 的介绍作为总结。

# 本书的适用对象

本书适合任何需要掌握 Shell 脚本概念的人。Linux 初学者可以受益，因为它可以帮助他们掌握将涵盖的内容，特别是帮助他们为 CompTIA Linux+/Linux 专业认证考试做准备。更高级的 Linux 管理员也能从中受益，因为本书会展示他们需要掌握的更高级概念，从而编写出真正有用的实用 Shell 脚本。

# 本书的内容

*第一章*，*入门 Shell*，这一章涵盖了 Linux 和类 Unix 系统上常见的操作系统 Shell 的基础知识。读者需要了解这些基本原理，以便理解后续章节中将要介绍的其他原理。

*第二章*，*解释命令*，操作系统 Shell 为我们提供五个功能：解释命令、设置变量、启用管道、允许输入/输出重定向以及允许自定义用户的工作环境。在这一章中，我们将探讨 Shell 是如何解释用户命令的。

*第三章*，*理解变量和管道*，在这一章中，我们将讨论操作系统 Shell 为我们做的另外两件事，那就是允许我们设置变量并使用命令管道。关于这两个话题要说的并不多，这也是为什么我们将它们合并到同一章节中的原因。

*第四章*，*理解输入/输出重定向*，在这一章中，我们将讨论如何将命令的文本输出发送到终端以外的地方，而终端是默认的输出设备。接着我们将讨论如何让命令从键盘以外的地方获取文本输入，而键盘是默认的输入设备。

最后，我们将讨论如何将错误信息发送到终端以外的地方。

*第五章*，*自定义环境*，在这一章中，我们将探讨各种 Shell 环境的配置文件。我们将学习如何自定义这些配置文件，并且如何通过命令行设置某些环境选项。

*第六章*，*文本流过滤器 - 第一部分*，管理员经常需要编写 shell 脚本，从外部来源获取文本信息，格式化这些信息并生成报告。在本章中，我们将介绍文本流过滤器的概念，这些过滤器能帮助完成这个过程。此外，了解这些文本流过滤器还能帮助你通过某些 Linux 认证考试，比如 LPI/Linux+考试。接下来，我们将向你展示如何使用这些过滤器。

*第七章*，*文本流过滤器 - 第二部分*，在本章中，我们将继续探索文本流过滤器。

*第八章*，*基础 shell 脚本构建*，在本章中，我们将讲解 shell 脚本的基本结构，并将使用前面章节中的一些文本流过滤器来创建简单的脚本。我们还将介绍一些在所有编程语言中都常见的基本编程结构，并向你展示如何使用它们。

*第九章*，*使用 grep、sed 和正则表达式过滤文本*，在本章中，你将学习正则表达式的概念，以及如何将它们与 grep 和 sed 结合使用，来过滤或处理文本。这些技巧不仅可以帮助你查找特定的文本，还能帮助你自动化报告的生成以及同时编辑多个文本文件。

*第十章*，*理解函数*，函数是每种编程语言中的重要部分，因为它们使程序员能够在多个程序中或同一个程序的多个地方重复使用一段代码。程序员可以向函数传递参数，让函数对这些参数进行操作，并将结果返回给主程序。

*第十一章*，*执行数学运算*，各种操作系统的 shell 都有执行数学运算的方式，无论是从命令行，还是从 shell 脚本中。在本章中，我们将探讨如何使用整数和浮点数运算。

*第十二章*，*使用 here 文档和 expect 自动化脚本*，虽然让 shell 脚本从一个独立的文本文件中提取数据很简单，但有时候将数据直接存储在 shell 脚本中更为方便。我们将通过使用“here”文档来实现。在本章中，你将学习如何创建和使用“here”文档。你还将看到如何利用`expect`工具来自动化某些脚本。

*第十三章*，*使用 ImageMagick 编写脚本*，ImageMagick 是一个文本模式的程序，用于编辑、处理和查看图像文件。在本章中，你将学习如何通过在 shell 脚本中使用 ImageMagick 命令来自动化图像处理。

*第十四章*，*使用 awk–第一部分*，这一章介绍了`awk`，它是一个能够从文本文件中提取特定文本并自动生成报告和数据库的工具。由于 awk 本身就是一个完整的编程语言，我们在这里不会深入讨论它。相反，我们将提供足够的信息，让您能够编写适用于 Shell 脚本的 awk“一行脚本”。

*第十五章*，*使用 awk–第二部分*，这是上一章的延续，在这一章中，我们将讨论使用 awk 脚本编写的更高级的概念。

*第十六章*，*使用 yad、dialog 和 xdialog 创建用户界面*，到目前为止，我们只看了从命令行运行的 Shell 脚本。事实上，这也是大多数人使用 Shell 脚本的方式，也是大多数人想到 Shell 脚本时的默认印象。但其实，也可以创建提供用户界面的 Shell 脚本。在这一章中，我们将使用 yad 来创建图形用户界面，使用 dialog 来创建 ncurses 风格的界面。

*第十七章*，*使用 Shell 脚本选项与 getopts*，管理员通常需要向 Shell 脚本传递参数和选项。传递参数，即脚本操作的对象，比较容易。要同时传递选项，修改脚本的运行方式，则需要另一种类型的操作符。在这一章中，您将学习如何使用 getopts 向脚本传递选项。

*第十八章*，*为安全专业人员编写 Shell 脚本*，在这一章中，您将学习如何创建 Shell 脚本或搜索现有的 Shell 脚本，以帮助安全管理员执行他们的工作。我们还将探讨如何修改或改进现有的 Shell 脚本，以满足安全管理员的特定需求。

*第十九章*，*Shell 脚本的可移植性*，大型组织，如大型政府机构或大公司，可能会拥有不同类型的 Linux、Unix 和类 Unix 机器。有时，编写能够自动检测运行的系统类型并为每种类型系统运行相应代码的 Shell 脚本会非常方便。在这一章中，我们将讨论几种增强脚本可移植性的方法。

*第二十章*，*Shell 脚本安全性*，脚本错误可能导致脚本无意中暴露敏感数据，或允许某人对系统执行未经授权的操作。在这一章中，我们将讨论如何帮助读者编写尽可能安全的 Shell 脚本。

*第二十一章*，*调试 Shell 脚本*，Shell 脚本可能会有 bug，就像任何其他编程语言一样。有时 bug 很容易找到，而有时则不然。在这一章中，我们将探讨一些方法，帮助繁忙的管理员调试那些不能正常工作的 Shell 脚本。

*第二十二章*，*Z Shell 脚本简介*，Z Shell（或 zsh）是一种可替代 bash 的 Shell。它的使用方式与 bash 相似，但也有 bash 没有的增强功能。在本章中，我们将探讨这些增强功能，以及一些 bash 无法实现的脚本技巧。

*第二十三章*，*在 Linux 上使用 PowerShell*，PowerShell 是微软在 2006 年为 Windows 操作系统开发的。在 2016 年，微软宣布将 PowerShell 开源，并使其可以在 Linux 和 macOS 上使用，同时也支持 Windows。在本章中，我们将探讨 PowerShell 如何对 Linux 管理员有所帮助，如何安装它，以及如何使用它。

# 要充分利用本书

由于本书从 Linux 和 Unix 命令行使用的基础知识开始，读者实际上只需要对设置 VirtualBox 并安装 Linux、FreeBSD 和 OpenIndiana 虚拟机的过程感到熟悉。

VirtualBox 是一个免费的下载软件，你可以从这里获取： https://www.virtualbox.org/

要运行 VirtualBox，你需要一台支持虚拟化的 CPU。大多数现代 CPU 都具备此能力，除了某些 Intel Core i3 和 Core i5 型号。（这是因为它们缺乏虚拟化所需的硬件加速。）此外，你还需要确保在计算机的 BIOS 中启用了虚拟化。

对于演示，我们将使用 Fedora、Debian、Ubuntu、FreeBSD 和 OpenIndiana 虚拟机。你可以从以下位置下载安装镜像：

+   Fedora: https://fedoraproject.org/

+   Debian: https://www.debian.org/

+   Ubuntu: https://ubuntu.com/

+   FreeBSD: https://www.freebsd.org/

+   OpenIndiana: https://openindiana.org/

在所有情况下，你都需要创建一个具有完全 sudo 权限的普通用户账户。在 Ubuntu 和 OpenIndiana 的安装过程中，这会自动完成。在 Debian 和 Fedora 中，如果你在安装过程中没有设置 root 用户密码，这也会自动完成。

对于 FreeBSD，情况略有不同。这是因为 FreeBSD 安装程序会要求你为 root 用户设置密码，而`sudo`不会被安装。因此，以下是安装 FreeBSD 的过程。

1.  当你到达安装程序部分，要求你创建自己的用户账户时，你会看到：

    1.  登录组是`your_username`。将`your_username`邀请加入其他组。

    1.  输入`wheel`以将自己添加到`wheel`组。

1.  安装完成后，使用你在安装过程中创建的密码登录 root 用户账户。

1.  通过执行以下命令安装`sudo`包：

    ```
    pkg install sudo 
    ```

1.  配置`sudo`，使得 wheel 组的成员拥有完全的`sudo`权限。首先输入以下命令：

    ```
    visudo 
    ```

1.  向下滚动，直到看到这一行：

    ```
    # %wheel ALL=(ALL:ALL) ALL
    ```

    +   删除这一行前面的#和空格。

    +   保存文件并退出。

1.  从 root 用户账户注销，然后使用你自己的账户重新登录。

当您需要执行管理命令时，您可以像在任何 Linux 发行版上一样使用`sudo`。

接下来，您需要在 FreeBSD 上安装`bash`。

由于 bash 在 FreeBSD 上默认未安装，您需要自行安装。以下是操作步骤：

1.  使用以下命令安装 bash：

    ```
    sudo pkg install bash 
    ```

1.  创建一个指向 bash 可执行文件的符号链接，类似这样：

    ```
    sudo ln -s /usr/local/bin/bash /bin/bash 
    ```

## 下载示例代码文件

本书的代码包托管在 GitHub 上，地址为 https://github.com/PacktPublishing/The-Ultimate-Linux-Shell-Scripting-Guide.git。我们还提供了来自我们丰富书籍和视频目录的其他代码包，您可以在 https://github.com/PacktPublishing/ 上查看它们。

## 下载彩色图片

我们还提供了一份 PDF 文件，其中包含本书中使用的截图/图表的彩色图片。您可以在这里下载：[`packt.link/gbp/9781835463574`](https://packt.link/gbp/9781835463574)。

## 使用的约定

本书中使用了多种文本约定。

`CodeInText`：表示文本中的代码字、数据库表名、文件夹名称、文件名、文件扩展名、路径名、虚拟网址、用户输入和 Twitter 账号。例如：“将新功能添加到`/etc/bashrc`文件中。”

```
donnie@opensuse:~> git clone https://github.com/PacktPublishing/The-Ultimate-Linux-Shell-Scripting-Guide.git 
```

**粗体**：表示新术语、重要词汇，或您在屏幕上看到的词语。例如，菜单或对话框中的词语在文本中通常以这种方式出现。例如：“首先，让我们看一下处于**运行**状态或**僵尸**状态的进程数量。”

警告或重要提示通常以这种方式呈现。

提示和技巧通常以这种方式呈现。

# 联系我们

我们总是欢迎读者的反馈。

**一般反馈**：通过电子邮件`feedback@packtpub.com`与我们联系，并在邮件主题中提及书名。如果您对本书的任何方面有疑问，请发送邮件至`questions@packtpub.com`。

**勘误**：尽管我们已尽最大努力确保内容的准确性，但错误仍然可能发生。如果您在本书中发现错误，欢迎向我们报告。请访问 http://www.packtpub.com/submit-errata，点击**提交勘误**并填写表单。

**盗版**：如果您在互联网上发现我们作品的任何非法副本，欢迎您提供相关的地址或网站名称。请通过`copyright@packtpub.com`与我们联系，并附上相关材料的链接。

**如果您有意成为作者**：如果您在某个领域拥有专长，并且有意编写或贡献书籍内容，请访问 http://authors.packtpub.com。

# 留下评论！

感谢您从 Packt 出版购买本书——我们希望您喜欢这本书！您的反馈对我们至关重要，帮助我们改进和成长。完成阅读后，请花一点时间留下[Amazon 评论](https://packt.link/r/1835463576)；这只需要一分钟，但对像您这样的读者来说，意义重大。

扫描下面的二维码，获取您选择的免费电子书。

![](img/review.png)

[`packt.link/NzOWQ`](https://packt.link/NzOWQ)

# 下载这本书的免费 PDF 副本

感谢您购买本书！

您喜欢随时随地阅读，但无法携带印刷版书籍吗？

您的电子书购买是否与您选择的设备不兼容？

不用担心，现在购买每本 Packt 图书时，您都可以免费获得该书的无 DRM PDF 版本。

随时随地、在任何设备上阅读。直接从您最喜欢的技术书籍中搜索、复制并粘贴代码到您的应用程序中。

福利不仅仅是这些，您还可以获得独家折扣、新闻通讯以及每日发送到您邮箱的精彩免费内容。

按照这些简单的步骤获取福利：

1.  扫描二维码或访问以下链接：

![](img/B21693_Free_PDF_QR.png)

https://packt.link/free-ebook/9781835463574

1.  提交您的购买证明。

1.  就这样！我们会将您的免费 PDF 和其他福利直接发送到您的电子邮件。
