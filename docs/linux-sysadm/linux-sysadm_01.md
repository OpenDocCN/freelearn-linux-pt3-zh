

# 了解 Linux

Linux 是一系列基于相同内核的操作系统。由于它是一个由独立开发的系统组成的家族，具有不同的设计原则、目标和实现细节，因此了解是什么使这种情况成为可能以及这些系统是如何构建的非常重要。在本章中，我们将讨论 Linux 发行版的概念、开源软件许可，并了解 Linux 系统的使用情况。我们将涵盖以下主题：

+   Linux 系统结构

+   开源软件许可证

+   Linux 在现代世界的应用

# Linux 系统结构

Linux 及其多个发行版对于初学者来说通常显得复杂。为了澄清这一点，让我们来看看操作系统的结构和发展。

## Linux 内核和基于 Linux 的操作系统

当人们说*Linux*时，他们可能指的是不同的事物。从狭义上讲，Linux 是一个操作系统内核，它由 Linus Torvalds 在 90 年代初期创建，现在由一个庞大的国际社区开发和维护。然而，当人们说他们正在使用 Linux 时，通常指的是一系列使用该内核的操作系统，并通常（但并不总是）包含由 GNU 项目创建的一组系统库和工具，这也是为什么有些人坚持认为这类系统应当称为 GNU/Linux 的原因。

注意

GNU 项目是一个自由软件项目，由理查德·斯托曼于 1983 年发起。其目标是创建一个完全由自由软件组成的类 Unix 操作系统。**GNU**代表**GNU 不是 Unix**，这反映了该项目旨在为专有 Unix 操作系统提供自由软件替代品的目标。

要完全理解这种不寻常的情况是如何可能的，让我们简要讨论一下操作系统的历史。

## 内核与用户空间

最早的计算机计算能力非常低，因此它们一次只能在内存中运行一个程序，并且该程序对硬件拥有完全的控制权。随着计算能力的提高，多个用户可以同时使用同一台计算机并运行多个程序——这种思想被称为时间共享或多任务处理。共享计算机会运行一个称为“监控程序”的程序，该程序负责将资源分配给终端用户程序。一系列的监控程序和系统工具被称为操作系统。最早的时间共享系统采用了合作式多任务处理，程序预计会自行将控制权转交给监控程序。然而，如果程序中出现编程错误，导致程序进入死循环或将数据写入错误的内存地址，那么该程序可能会导致整个计算机崩溃，或破坏另一个程序（包括监控程序）的内存。

为了使多任务处理更加可靠，新一代硬件引入了保护机制，允许监控程序重新控制 CPU，强制终止那些试图向属于其他程序或监控程序自身的内存写入内容的程序。

这使得操作系统内核与用户空间程序之间实现了分离。最终用户程序在物理上不再能够直接控制硬件，也不能访问未明确分配给它们的内存。这些特权保留给内核——它包括进程调度器（其作用与旧版监控程序相同）和设备驱动程序。

在单个程序内部，程序员可以自由地组织他们的代码。然而，当多个独立开发的组件需要协同工作时，它们之间需要有一个明确定义的接口。由于现在没有人直接编写机器代码，因此对于现代系统，这意味着两个接口：**应用程序编程接口**（**API**）和**应用程序二进制接口**（**ABI**）。API 是为编写源代码并定义可以调用的函数名和这些函数的参数列表的程序员准备的。经过编译后，这些函数调用被转换为可执行代码，将参数加载到内存中的正确位置，并将控制权转交给被调用的代码——如何加载这些参数以及如何转交控制权由 ABI 定义。

用户空间程序与库之间的接口受其编写所用编程语言的深刻影响。

相反，内核与用户空间程序之间的接口更类似于硬件接口。它们完全独立于编程语言，使用软件中断或专用的*系统调用* CPU 指令，而不是应用程序开发者熟悉的函数调用。

注意

在 Linux 中，系统调用是一种机制，允许用户级进程请求内核提供服务，内核是操作系统的核心。这些服务可以访问硬件设备、管理进程和线程、分配内存，并执行其他需要特权访问的低级任务。

这些接口也非常低级：例如，如果你想使用`write()`系统调用将字符串打印到标准输出，你必须始终指定写入多少字节——它没有*字符串变量*的概念，也没有确定其长度的约定。

因此，操作系统包含了一个或多个编程语言的标准库，这些库为最终用户程序提供了一个抽象层和稳定的 API。

大多数操作系统将内核、编程语言的标准库和通常由一个小组人员紧密协作开发的基本系统工具一起版本化并分发。在这种情况下，内核接口通常被视为纯粹的内部内容，且不保证保持稳定。

## Linux 内核与 GNU 项目

Linux 的独特之处在于，它是为了提供一个现有操作系统用户空间部分的替代内核而开发的。该项目的创始人 Linus Torvalds 最初是为了改进 MINIX 的功能而开发它——MINIX 是一个简化版的类 Unix 操作系统，旨在用于教学而非生产环境。此后，Linus 一直在使用来自 GNU 项目的 GNU C 编译器和用户空间程序——这是 Richard Stallman 启动的项目，目标是创建一个完整的类 Unix 操作系统，既自由（如自由）又开源，从而让每个人都能使用、改进和重新分发。

当时，GNU 项目已经拥有了操作系统的所有用户空间部分，但没有一个可用的内核。还有其他开源 Unix 项目，但它们源自 BSD Unix 代码库，在 90 年代初，它们成为了版权侵权诉讼的目标。Linux 内核恰好在这个时候应运而生，因为 Linus Torvalds 和各个贡献者完全独立地开发了它，并以与 GNU 项目软件相同的许可证发布——即 GNU **通用公共许可证**（**GPL**）。因此，一套 GNU 软件包加上 Linux 内核，成为了完全开源操作系统的潜在基础。

然而，Linus Torvalds 并不是 GNU 项目的成员，Linux 内核依然独立于 **自由软件基金会**（**FSF**）——它仅使用了 FSF 为 GNU 项目开发的许可证，但任何其他人也可以使用，许多人确实使用了。

因此，为了使新的 Linux 内核版本能够与 GNU C 库及其依赖的相关软件一起使用，开发者必须保持内核接口的稳定性。

GNU C 库并不是为了与特定内核配合工作而开发的——当这个项目启动时，并没有一个可用的 GNU 内核，GNU 软件通常运行在其他类 Unix 操作系统上。

因此，Linux 和 GNU 软件可以并且仍然可以一起使用，并以不同的组合方式使用。GNU 用户空间软件集也可以与仍处于实验阶段的 GNU 硬内核一起使用，其他操作系统也将其作为系统或附加软件。例如，Apple macOS 长时间使用 GNU Bash 作为其系统 shell，直到它被 zsh 替代。

Linux 内核接口的稳定性保证使其成为定制操作系统的有吸引力基础，这些操作系统可能与 Unix 完全不同——其中一些操作系统仅在内核之上运行单个程序。人们还为不同的编程语言创建了可与 Linux 一起使用的替代标准库，如 C 语言的 Musl 和 Bionic，它们使用更宽松的许可证并促进静态链接。但要理解这些许可证的差异，我们需要讨论软件许可证的概念。

# 开源软件许可证

软件许可证是版权持有者与软件接收者之间的协议。现代版权法旨在赋予作者对其作品的使用和分发的完全控制权——版权自作品固定在任何媒介上之时自动产生，且未经作者明确许可，任何人不得使用或复制该作品。因此，许可协议是必需的，它授权用户一些默认情况下仅作者拥有的权限。作者可以自由指定任何条件，许多个人和公司利用这一点来限制用户的行为——例如，仅允许非商业使用。许可协议通常也是在作者或版权持有者与特定个人之间达成的。

然而，在 1980 年代后期，程序员和律师提出了利用作者对作品的无限控制来确保任何人都能使用、分发和修改它们，而不是加以限制的想法。他们引入了*公共许可证*，授予每个人权限，而不仅仅是那些签署或以其他方式接受协议的人，并写了若干可供任何人应用于其软件的可重用许可证。这一概念被称为**版权反转**（copyleft）——即与版权相反的做法。这些许可证被称为开源许可证，因为它们明确允许软件源代码的分发与修改。

所有的*经典*许可证都诞生于那个时期：MIT 许可证、BSD 许可证、GNU GPL 和 GNU **较小/库通用公共许可证**（**LGPL**）。这些许可证没有限制用户在其下分发的软件的使用权。若有条件，亦仅适用于可执行文件和源代码的分发与修改。

## 允许性许可证和版权反转许可证

在分发方面，两种不同的思想流派在分发条件上有所不同。

允许性许可证的支持者认为，软件的接收者必须拥有对软件的绝对自由，包括将其纳入其他非开源软件中，或创建闭源衍生物。MIT 许可证和 BSD 许可证是典型的允许性开源许可证例子。

反对专有软件的支持者认为，保护开源软件免受试图挪用其作者作品并创建闭源衍生品的行为非常重要。GNU GPL 就是最纯粹的例子——如果有人分发 GPL 下的程序可执行文件或与 GPL 库链接的程序，他们必须也在该许可证下分发程序的源代码。这是最激进的做法，称为*强制性反版权*。

允许将库链接到其他许可证下的程序，但要求库代码的修改也必须遵守相同许可证的许可证被称为*弱反版权*许可证。最常用的例子是 GNU LGPL。

## 专利授权、TiVo 化和 SaaS 问题

GNU GPL 是为了应对没有源代码分发的专有软件的兴起而创建的，这种软件阻止了最终用户对其进行改进并分享他们的改进。然而，软件行业正在发展，新的趋势正在出现，一些人认为这些趋势威胁到了开源软件的存在或财务可持续性。

其中一个威胁是*专利恶意诉讼*——在存在软件专利的司法管辖区内，恶意使用软件专利。对此，一些较新的许可证和旧许可证的新版本（如 Apache 许可证和 GNU GPLv3）引入了专利授权条款。该条款禁止软件源代码的贡献者对其用户提出专利诉讼。如果他们提出这样的法律威胁，他们的许可证将被撤销。

GPLv3 的一个更具争议的点是它试图保护用户在其硬件上运行修改版本的权利。通过数字签名和类似机制防止硬件运行自定义软件的做法有时被称为*TiVo 化*，这个术语源自一个基于 Linux 的数字视频录像机 TiVo，它是早期此类锁定机制的例子。尽管有些项目支持通过这一条款来加以防范，但对其他项目而言，GPLv3 条款成为不从 GPLv2 转换的理由——Linux 内核便是那些保持使用旧版 GPL 的项目之一。

最后，所有经典许可证都是在所有软件都部署在本地的时代编写的，而在现代，许多软件通过网络交付，其可执行文件对最终用户不可访问——这种方法被称为**软件即服务**（**SaaS**）。由于 GPL 规定每个二进制可执行文件的接收者有权接收其源代码，它并不适用于 SaaS，因为用户从未收到任何可执行文件。这使得供应商能够在 GPL 下创建软件的修改版本，而无需与社区分享他们的改进。为了应对这一趋势，开发了几个许可证，例如 Affero GPL。

在过去的几年里，提供开源软件托管版本的大型科技公司开始被视为削弱项目维护者通过服务赚钱的能力，因为与有效的垄断竞争价格非常困难。对此，一些项目开始转向有使用限制的许可证，许多人认为这些许可证不再是开源许可证，尽管源代码仍然可以获取。此类许可证的未来仍是一个悬而未决的问题。

# Linux 发行版

由于开源许可证下的软件可以自由修改和分发，这使得组合包含内核、系统库和实用程序以及应用软件的完整操作系统成为可能。由于开源许可证对使用没有限制，用户不需要为每个组件接受许可协议。

在 Linux 的早期，设置一个可用的 Linux 环境是一个复杂而繁琐的过程。为了简化这个过程，Linux 爱好者开始准备第一个*发行版*—一组包和脚本，用于自动化安装。许多早期的发行版，如 Softlanding Linux System 和 Yggdrasil，现在已经停止维护，但一些仍在维护中——Slackware Linux 就是一个显著的例子。

## 包管理器和软件包仓库

早期的发行版目标相对简单，即提供一个可以安装应用软件的基本系统。然而，后来的发行版开始重新思考软件安装的过程。随着开源软件项目数量的增加，以及光驱和互联网连接变得更加经济实惠，包含更多软件的发行版变得比以往更加可行。

然而，许多应用程序依赖于共享库或其他应用程序。传统上，安装包会包含所有依赖项，或者将依赖项管理交给用户。由于发行版由一个维护小组管理，开发人员提出了一个想法：在所有需要依赖的包之间共享依赖项，并在用户请求安装包时自动安装所有依赖项。这催生了包管理器和软件包仓库——一组以特殊格式存储的文件，包括编译后的二进制文件和元数据，如软件包版本及其依赖关系。

两种最流行的软件包格式及其相应的包管理器是在 90 年代中期开发的，并且至今仍在使用。其中一种是 DEB 格式，配合 dpkg 工具使用，由 Debian 开发。另一种是**Red Hat 包管理器**（**RPM**），与 rpm 工具一起使用，由 Red Hat 开发。

dpkg 和 rpm 工具负责在本地机器上安装包文件。要安装一个包，用户需要获取该包本身以及它所依赖的所有包。为了自动化这个过程，发行版开发了高级包管理器，可以自动从在线仓库下载包，检查更新，搜索元数据等。这些高级包管理器通常依赖低级包管理器来管理安装。Debian 的**高级包装工具**（**APT**）通常与 DEB 包一起使用，尽管技术上它也可以与 RPM 一起使用。主要使用 RPM 格式的高级包管理器更多：由 Red Hat 维护的 YUM 和 DNF，来自 openSUSE 的 zypper，以及为现已停用的 Mandrake Linux 开发的 urpmi，仍然被它的分支使用。

目前存在的许多发行版自 90 年代以来一直在积极维护，或者是从不同时间点分叉出来的。例如，Ubuntu Linux 在 2000 年代初期从 Debian GNU/Linux 分叉出来，而 Rocky Linux 是一个从 2021 年开始的 Red Hat Enterprise Linux 衍生版。

然而，完全独立的发行版偶尔也会出现。它们中的一些是特定用途的系统，具有经典通用发行版无法满足的需求。例如，OpenWrt 是一个基于 Linux 的系统，用于消费者路由器，最初是为 Linksys WRT-54G 设备开发的，因此得名。这类设备通常只有几兆字节的闪存空间，因此为它们设计的操作系统必须非常紧凑，而且还必须使用诸如 JFFS 等专门为 NAND 闪存驱动器设计的文件系统。

其他独立的发行版尝试不同的包管理和安装原则。例如，NixOS 和 GNU Guix 采用一种方法，允许用户在新包版本出现问题时恢复系统更新。

本书将重点介绍基于 Debian/Ubuntu 和 Red Hat 的系统，因为它们长时间以来一直是最受欢迎的发行版，并且仍然保持受欢迎。

## 发行版之间的差异

发行版之间的差异不仅仅体现在包管理器上。配置文件的位置可能不同，相同包的默认配置也可能有很大差异。例如，Apache HTTP 服务器的配置文件目录在 Red Hat Linux 衍生版上是`/etc/httpd`，而在 Debian 衍生版上是`/etc/apache2`。

一些发行版也使用高级配置工具，你可能需要考虑它们。

软件的选择及其安装的便捷性也可能有所不同。Debian、Fedora 和许多其他发行版将桌面环境的选择交给用户，并且可以轻松地在同一系统上安装多个不同的桌面环境，这样你就可以在不同的登录会话中切换 GNOME3、KDE、MATE 或其他任何环境。相比之下，Ubuntu 系列发行版包括多个不同桌面环境的版本，并且期望如果你不喜欢其默认的选择（Unity 桌面环境），你应该使用 Kubuntu（KDE 桌面环境），而不是默认的 Ubuntu。最后，一些发行版带有自定义桌面环境，并且不支持其他桌面环境，例如 elementary OS。

然而，经验丰富的 Linux 用户通常可以找到任何发行版的使用方法。

# Linux 在现代世界的使用

Linux 内核的开源特性及其对多种硬件架构的支持，使其成为定制操作系统的热门选择，而通用 Linux 发行版也在以往使用专有 Unix 系统的每个领域中找到了广泛的应用。

世界上最流行的基于 Linux 的操作系统是 Android。虽然大多数 Android 应用程序是为定制的运行时编写的，并且从未直接使用 Linux 内核的任何功能，但它仍然是一个 Linux 发行版。

网络设备通常通过 Web 图形用户界面或自定义命令行接口进行管理，但它们仍然经常在背后运行 Linux。这适用于消费者级的 Wi-Fi 路由器，也适用于高性能的企业和数据中心路由器及交换机。

通用 Linux 发行版也随处可见。得益于内建的虚拟机支持（通过 Xen 或 KVM 虚拟机监控器），Linux 驱动着最大的云计算平台，包括 Amazon EC2、Google Cloud Platform 和 DigitalOcean。许多来宾系统也是运行 Web 服务器、数据库系统以及其他许多应用程序的 Linux 机器。

Linux 还广泛应用于高性能计算：目前世界上最强大的超级计算机都在其控制节点和 I/O 节点上运行 Linux。

最后但同样重要的是，本章的作者在 Linux 桌面上敲下了这些文字。

# 总结

Linux 发行版是一个完整的操作系统，包括 Linux 内核以及由各种个人和公司开发的一组库和程序。Linux 内核和核心系统库并非由同一组开发人员开发，而是 Linux 内核提供了一个稳定的 ABI，允许任何人开发标准库，使编程语言能够在其之上运行。

开源许可证有不同的条件，但它们都允许任何人出于任何目的使用软件并分发其副本，这也是 Linux 发行版存在的前提。

不同的发行版使用不同的包管理和配置方法，但有经验的用户如果掌握了基础知识，可以很快学会如何使用新的发行版。如今，Linux 无处不在，从手机到最强大的超级计算机都有它的身影。

在下一章，我们将学习 Linux 系统上可用的各种 shell，以及基本命令。
