<html><head></head><body>
  <div id="_idContainer416" class="Basic-Text-Frame">
    <h1 class="chapterNumber"><span class="koboSpan" id="kobo.1.1">21</span></h1>
    <h1 id="_idParaDest-446" class="chapterTitle"><span class="koboSpan" id="kobo.2.1">Debugging Shell Scripts</span></h1>
    <p class="normal"><span class="koboSpan" id="kobo.3.1">If you’ve ever written a beautiful looking script, only to be disappointed when it doesn’t work properly, don’t feel alone. </span><span class="koboSpan" id="kobo.3.2">This happens to all of us, and even happened to me a few times when I was creating scripts for this book. </span><span class="koboSpan" id="kobo.3.3">(I know, shocking, right?)</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.4.1">The debugging process should begin the moment that you begin to design your code. </span><span class="koboSpan" id="kobo.4.2">Put careful thought into the design, test each portion as you write it, and—for goodness’ sake—use a text editor with color-coded syntax highlighting. </span><span class="koboSpan" id="kobo.4.3">(That color highlighting will prevent you from making a multitude of typographical errors.)</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.5.1">Topics in the chapter include:</span></p>
    <ul>
      <li class="bulletList"><span class="koboSpan" id="kobo.6.1">Understanding common scripting errors</span></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.7.1">Not Enough Quoting</span></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.8.1">Creating a Wild Loop</span></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.9.1">Using shell script debugging tools and techniques</span></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.10.1">Using </span><code class="inlineCode"><span class="koboSpan" id="kobo.11.1">echo</span></code><span class="koboSpan" id="kobo.12.1"> Statements</span></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.13.1">Using </span><code class="inlineCode"><span class="koboSpan" id="kobo.14.1">xtrace</span></code><span class="koboSpan" id="kobo.15.1"> for Debugging</span></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.16.1">Checking for Undefined Variables</span></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.17.1">Checking for Errors with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.18.1">-e</span></code><span class="koboSpan" id="kobo.19.1"> Option</span></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.20.1">Using </span><code class="inlineCode"><span class="koboSpan" id="kobo.21.1">bash</span></code><span class="koboSpan" id="kobo.22.1"> Debugger</span></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.23.1">Debugging a script with bashdb</span></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.24.1">Getting help with bashdb</span></li>
    </ul>
    <p class="normal"><span class="koboSpan" id="kobo.25.1">If you’re ready, let’s get started.</span></p>
    <h1 id="_idParaDest-447" class="heading 1"><span class="koboSpan" id="kobo.26.1">Technical Requirements</span></h1>
    <p class="normal"><span class="koboSpan" id="kobo.27.1">For this chapter, I’m mainly just using the Fedora workstation that I’m using to create this Word file. </span><span class="koboSpan" id="kobo.27.2">But, you can use whichever Linux virtual machine that you like, as long as it has a desktop environment installed. </span><span class="koboSpan" id="kobo.27.3">(One of the demos requires a desktop.) </span></p>
    <p class="normal"><span class="koboSpan" id="kobo.28.1">For the final topic, I’ll show you how to install and use </span><code class="inlineCode"><span class="koboSpan" id="kobo.29.1">bashdb</span></code><span class="koboSpan" id="kobo.30.1"> on Debian/Ubuntu, Fedora, FreeBSD, and macOS.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.31.1">As always, you can grab the scripts by doing:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.32.1">git clone https://github.com/PacktPublishing/The-Ultimate-Linux-Shell-Scripting-Guide.git
</span></code></pre>
    <h1 id="_idParaDest-448" class="heading 1"><span class="koboSpan" id="kobo.33.1">Understanding Common Scripting Errors</span></h1>
    <p class="normal"><span class="koboSpan" id="kobo.34.1">The most important step in </span><a id="_idIndexMarker1348"/><span class="koboSpan" id="kobo.35.1">debugging is understanding the common errors that could cause your scripts to either outright fail, or to give you incorrect results. </span><span class="koboSpan" id="kobo.35.2">Let’s look at a few examples.</span></p>
    <h2 id="_idParaDest-449" class="heading 2"><span class="koboSpan" id="kobo.36.1">Not Enough Quoting</span></h2>
    <p class="normal"><span class="koboSpan" id="kobo.37.1">You can have a few different problems if you don’t surround variable names with quotes. </span><span class="koboSpan" id="kobo.37.2">Here are some examples.</span></p>
    <h3 id="_idParaDest-450" class="heading 3"><span class="koboSpan" id="kobo.38.1">Filenames with Blank Spaces</span></h3>
    <p class="normal"><span class="koboSpan" id="kobo.39.1">For this demo, I’ve moved</span><a id="_idIndexMarker1349"/><span class="koboSpan" id="kobo.40.1"> into an empty directory in order to keep the files I’ll be creating separate from the files in my main home directory. </span><span class="koboSpan" id="kobo.40.2">I want to create some files with a timestamp in the filename. </span><span class="koboSpan" id="kobo.40.3">To do that, I’ll use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.41.1">date</span></code><span class="koboSpan" id="kobo.42.1"> command, without any option switches.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.43.1">First, I’ll create a file from the command-line using </span><code class="inlineCode"><span class="koboSpan" id="kobo.44.1">touch</span></code><span class="koboSpan" id="kobo.45.1">:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.46.1">donnie@fedora:~/quoting_demo$ touch somefile_$(date).txt
donnie@fedora:~/quoting_demo$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.47.1">Okay, let’s look at the file:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.48.1">donnie@fedora:~/quoting_demo$ ls -l
total 0
-rw-r--r--. </span><span class="koboSpan" id="kobo.48.2">1 donnie donnie 0 Aug 20 15:08 03:08:51
-rw-r--r--. </span><span class="koboSpan" id="kobo.48.3">1 donnie donnie 0 Aug 20 15:08 20
-rw-r--r--. </span><span class="koboSpan" id="kobo.48.4">1 donnie donnie 0 Aug 20 15:08 2024.txt
-rw-r--r--. </span><span class="koboSpan" id="kobo.48.5">1 donnie donnie 0 Aug 20 15:08 Aug
-rw-r--r--. </span><span class="koboSpan" id="kobo.48.6">1 donnie donnie 0 Aug 20 15:08 EDT
-rw-r--r--. </span><span class="koboSpan" id="kobo.48.7">1 donnie donnie 0 Aug 20 15:08 PM
-rw-r--r--. </span><span class="koboSpan" id="kobo.48.8">1 donnie donnie 0 Aug 20 15:08 somefile_Tue
donnie@fedora:~/quoting_demo$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.49.1">Whoa, now. </span><span class="koboSpan" id="kobo.49.2">What’s </span><a id="_idIndexMarker1350"/><span class="koboSpan" id="kobo.50.1">going on here? </span><span class="koboSpan" id="kobo.50.2">Instead of having one file, I have seven. </span><span class="koboSpan" id="kobo.50.3">Each file has a portion of the current date in its filename. </span><span class="koboSpan" id="kobo.50.4">Well, the problem is that </span><code class="inlineCode"><span class="koboSpan" id="kobo.51.1">date</span></code><span class="koboSpan" id="kobo.52.1">, without any option switches, produces output with blank spaces in it, like this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.53.1">donnie@fedora:~/quoting_demo$ date
Tue Aug 20 03:13:23 PM EDT 2024
donnie@fedora:~/quoting_demo$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.54.1">So when the shell saw those blank spaces, it thought that I wanted to create multiple files, instead of just one. </span><span class="koboSpan" id="kobo.54.2">Let’s delete all of these files, and try this again with some quotes:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.55.1">donnie@fedora:~/quoting_demo$ touch somefile_"$(date)".txt
donnie@fedora:~/quoting_demo$ ls -l
total 0
-rw-r--r--. </span><span class="koboSpan" id="kobo.55.2">1 donnie donnie 0 Aug 20 15:15 'somefile_Tue Aug 20 03:15:37 PM EDT 2024.txt'
donnie@fedora:~/quoting_demo$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.56.1">You see how I’ve</span><a id="_idIndexMarker1351"/><span class="koboSpan" id="kobo.57.1"> surrounded the command substitution construct with a pair of double quotes, which causes the shell to ignore the blank spaces. </span><span class="koboSpan" id="kobo.57.2">So now, I have just one file with the correct filename.</span></p>
    <h3 id="_idParaDest-451" class="heading 3"><span class="koboSpan" id="kobo.58.1">Problems with Unset Variables</span></h3>
    <p class="normal"><span class="koboSpan" id="kobo.59.1">For our next</span><a id="_idIndexMarker1352"/><span class="koboSpan" id="kobo.60.1"> scenario, let’s look at the </span><code class="inlineCode"><span class="koboSpan" id="kobo.61.1">quote_problem1.sh</span></code><span class="koboSpan" id="kobo.62.1"> script:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.63.1">#!/bin/bash
number=1
if [ $number = 1 ]; then
        echo "Number equals 1"
else
        echo "Number does not equal 1"
fi
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.64.1">All it does is to tell us whether or not the value of </span><code class="inlineCode"><span class="koboSpan" id="kobo.65.1">number</span></code><span class="koboSpan" id="kobo.66.1"> is 1. </span><span class="koboSpan" id="kobo.66.2">Running the script looks like this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.67.1">donnie@fedora:~$ ./quote_problem1.sh
Number equals 1
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.68.1">Okay, it works fine. </span><span class="koboSpan" id="kobo.68.2">Now, I’ll edit the file to change the value of </span><code class="inlineCode"><span class="koboSpan" id="kobo.69.1">number</span></code><span class="koboSpan" id="kobo.70.1"> to 2, and run the script again. </span><span class="koboSpan" id="kobo.70.2">Here’s how that looks:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.71.1">donnie@fedora:~$ ./quote_problem1.sh
Number does not equal 1
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.72.1">Now, let’s try that with an unset variable, as you see in </span><code class="inlineCode"><span class="koboSpan" id="kobo.73.1">quote_problem2.sh</span></code><span class="koboSpan" id="kobo.74.1">:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.75.1">#!/bin/bash
number=
if [ $number = 1 ]; then
        echo "Number equals 1"
else
        echo "Number does not equal 1"
fi
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.76.1">When we say that a variable is unset, it just means that we defined the variable, but haven’t assigned a value to it. </span><span class="koboSpan" id="kobo.76.2">Let’s see what happens with I try to run this script.</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.77.1">donnie@fedora:~$ ./quote_problem2.sh
./quote_problem2.sh: line 4: [: =: unary operator expected
Number does not equal 1
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.78.1">The problem is that</span><a id="_idIndexMarker1353"/><span class="koboSpan" id="kobo.79.1"> the </span><code class="inlineCode"><span class="koboSpan" id="kobo.80.1">if [ $number = 1 ]</span></code><span class="koboSpan" id="kobo.81.1"> test is looking for some sort of value for the number variable. </span><span class="koboSpan" id="kobo.81.2">But, </span><code class="inlineCode"><span class="koboSpan" id="kobo.82.1">number</span></code><span class="koboSpan" id="kobo.83.1"> has no value, which breaks the test. </span><span class="koboSpan" id="kobo.83.2">Fortunately, it’s an easy fix. </span><span class="koboSpan" id="kobo.83.3">All I’ll have to do is to surround the </span><code class="inlineCode"><span class="koboSpan" id="kobo.84.1">$number</span></code><span class="koboSpan" id="kobo.85.1"> that’s in the test statement with a pair of double quotes, as you see in </span><code class="inlineCode"><span class="koboSpan" id="kobo.86.1">quote_problem3.sh</span></code><span class="koboSpan" id="kobo.87.1">:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.88.1">#!/bin/bash
number=
if [ "$number" = 1 ]; then
        echo "Number equals 1"
else
        echo "Number does not equal 1"
fi
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.89.1">Running this script will show the correct results:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.90.1">donnie@fedora:~$ ./quote_problem3.sh
Number does not equal 1
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.91.1">This works because instead of having no value at all as we had before, </span><code class="inlineCode"><span class="koboSpan" id="kobo.92.1">number</span></code><span class="koboSpan" id="kobo.93.1"> now effectively has the value of a blank space. </span><span class="koboSpan" id="kobo.93.2">A blank space isn’t equal to 1, so the script works.</span></p>
    <div class="note">
      <p class="normal"><span class="koboSpan" id="kobo.94.1">It’s normally better to always assign an initial value to your variables as you create them, in order to prevent these kinds of problems. </span><span class="koboSpan" id="kobo.94.2">However, it’s sometimes desirable to use an unset variable. </span><span class="koboSpan" id="kobo.94.3">For example, you might want your script to do one thing if a variable is unset, or to do something else if the variable is set with a value. </span><span class="koboSpan" id="kobo.94.4">That’s perfectly fine as long as you know how to use quotes to avoid these kinds of parsing problems.</span></p>
    </div>
    <p class="normal"><span class="koboSpan" id="kobo.95.1">To make this a bit </span><a id="_idIndexMarker1354"/><span class="koboSpan" id="kobo.96.1">more realistic, let’s make </span><code class="inlineCode"><span class="koboSpan" id="kobo.97.1">quote_problem4.sh</span></code><span class="koboSpan" id="kobo.98.1"> so that it will accept a user-defined value:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.99.1">#!/bin/bash
number=$1
if [ $number = 1 ]; then
        echo "Number equals 1"
else
        echo "Number does not equal 1"
fi
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.100.1">Let’s see how it works with different values:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.101.1">donnie@fedora:~$ ./quote_problem4.sh 1
Number equals 1
donnie@fedora:~$ ./quote_problem4.sh 5
Number does not equal 1
donnie@fedora:~$ ./quote_problem4.sh
./quote_problem4.sh: line 4: [: =: unary operator expected
Number does not equal 1
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.102.1">It works fine with either 1 or 5 as a value, but doesn’t work when I don’t supply a value. </span><span class="koboSpan" id="kobo.102.2">So, it appears that I forgot to quote the </span><code class="inlineCode"><span class="koboSpan" id="kobo.103.1">$number</span></code><span class="koboSpan" id="kobo.104.1">. </span><span class="koboSpan" id="kobo.104.2">Not to worry, I’ll fix that in </span><code class="inlineCode"><span class="koboSpan" id="kobo.105.1">quote_problem5.sh</span></code><span class="koboSpan" id="kobo.106.1">:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.107.1">#!/bin/bash
number=$1
if [ "$number" = 1 ]; then
        echo "Number equals 1"
else
        echo "Number does not equal 1"
fi
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.108.1">Let’s see what we have now:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.109.1">donnie@fedora:~$ ./quote_problem5.sh 1
Number equals 1
donnie@fedora:~$ ./quote_problem5.sh 5
Number does not equal 1
donnie@fedora:~$ ./quote_problem5.sh
Number does not equal 1
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.110.1">It works like a champ, which means that once again, we’ve achieved coolness.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.111.1">Since we’ve been </span><a id="_idIndexMarker1355"/><span class="koboSpan" id="kobo.112.1">working with tests, let’s see what happens when we leave out a space, as I did in </span><code class="inlineCode"><span class="koboSpan" id="kobo.113.1">space_problem1.sh</span></code><span class="koboSpan" id="kobo.114.1">:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.115.1">#!/bin/bash
number=$1
if ["$number" = 1 ]; then
        echo "Number equals 1"
else
        echo "Number does not equal 1"
fi
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.116.1">It’s the same as the </span><code class="inlineCode"><span class="koboSpan" id="kobo.117.1">quote_problem5.sh</span></code><span class="koboSpan" id="kobo.118.1"> script, except that I deleted the space between the </span><code class="inlineCode"><span class="koboSpan" id="kobo.119.1">[</span></code><span class="koboSpan" id="kobo.120.1"> and the </span><code class="inlineCode"><span class="koboSpan" id="kobo.121.1">"$number"</span></code><span class="koboSpan" id="kobo.122.1">. </span><span class="koboSpan" id="kobo.122.2">Here’s what happens when I run it:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.123.1">donnie@fedora:~$ ./space_problem1.sh
./space_problem1.sh: line 4: [: =: unary operator expected
Number does not equal 1
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.124.1">Amazingly enough, it gives me the exact same error message as when I forgot to quote my </span><code class="inlineCode"><span class="koboSpan" id="kobo.125.1">$number</span></code><span class="koboSpan" id="kobo.126.1"> variable. </span><span class="koboSpan" id="kobo.126.2">So, this shows us two things. </span><span class="koboSpan" id="kobo.126.3">First, you need to be careful about placing spaces in your test conditions. </span><span class="koboSpan" id="kobo.126.4">Secondly, you can’t always depend upon the shell’s error message to tell you exactly what the problem is. </span><span class="koboSpan" id="kobo.126.5">In this case, the exact same message showed up for two completely different errors.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.127.1">But wait! </span><span class="koboSpan" id="kobo.127.2">Here’s one</span><a id="_idIndexMarker1356"/><span class="koboSpan" id="kobo.128.1"> more way to troubleshoot this problem. </span><span class="koboSpan" id="kobo.128.2">We’ll just use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.129.1">-u</span></code><span class="koboSpan" id="kobo.130.1"> shell option to check for uninitialized variables, as you see here in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.131.1">quote_problem6.sh</span></code><span class="koboSpan" id="kobo.132.1"> script:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.133.1">#!/bin/bash -u
number=$1
if [ $number = 1 ]; then
        echo "Number equals 1"
else
        echo "Number does not equal 1"
fi
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.134.1">The only difference between this script and the previous one is that I added </span><code class="inlineCode"><span class="koboSpan" id="kobo.135.1">-u</span></code><span class="koboSpan" id="kobo.136.1"> to the end of the shebang line. </span><span class="koboSpan" id="kobo.136.2">Let’s see what happens when I run it without supplying a value for </span><code class="inlineCode"><span class="koboSpan" id="kobo.137.1">$1</span></code><span class="koboSpan" id="kobo.138.1">:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.139.1">donnie@fedora:~$ ./quote_problem6.sh
./quote_problem6.sh: line 3: $1: unbound variable
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.140.1">This is cool, because it tells us exactly what the problem is, instead of just showing us a generic error message. </span><span class="koboSpan" id="kobo.140.2">If you need to see a more verbose message, just add the </span><code class="inlineCode"><span class="koboSpan" id="kobo.141.1">v</span></code><span class="koboSpan" id="kobo.142.1"> option, like this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.143.1">#!/bin/bash -uv
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.144.1">Running the script now </span><a id="_idIndexMarker1357"/><span class="koboSpan" id="kobo.145.1">looks like this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.146.1">donnie@fedora:~$ ./quote_problem6.sh
#!/bin/bash -uv
number=$1
./quote_problem6.sh: line 3: $1: unbound variable
donnie@fedora:~$
</span></code></pre>
    <div class="note">
      <p class="normal"><span class="koboSpan" id="kobo.147.1">When you’re finished debugging, be sure to delete the </span><code class="inlineCode"><span class="koboSpan" id="kobo.148.1">-u</span></code><span class="koboSpan" id="kobo.149.1"> or </span><code class="inlineCode"><span class="koboSpan" id="kobo.150.1">-uv</span></code><span class="koboSpan" id="kobo.151.1"> That’s because it could cause problems in production scripts.</span></p>
      <p class="normal"><span class="koboSpan" id="kobo.152.1">I’ll show you more about using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.153.1">-u</span></code><span class="koboSpan" id="kobo.154.1"> option in just a few pages, in the </span><em class="chapterRef"><span class="koboSpan" id="kobo.155.1">Using Shell Script Debugging Tools</span></em><span class="koboSpan" id="kobo.156.1"> section.</span></p>
    </div>
    <p class="normal"><span class="koboSpan" id="kobo.157.1">For the next problem, you’ll need to buckle your seat belt. </span><span class="koboSpan" id="kobo.157.2">That’s because things are going to get wild.</span></p>
    <h2 id="_idParaDest-452" class="heading 2"><span class="koboSpan" id="kobo.158.1">Creating a Wild Loop</span></h2>
    <p class="normal"><span class="koboSpan" id="kobo.159.1">When you </span><a id="_idIndexMarker1358"/><span class="koboSpan" id="kobo.160.1">create some sort of loop, it’s real easy to accidentally create one that will run forever until you stop it. </span><span class="koboSpan" id="kobo.160.2">For example, let’s look at the </span><code class="inlineCode"><span class="koboSpan" id="kobo.161.1">wild_loop1.sh</span></code><span class="koboSpan" id="kobo.162.1"> script:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.163.1">#!/bin/bash
# while loop running wild
count=30
limit=25
while [ "$count" -gt "$limit" ];
do
        echo $count
        (( count = (count + 1)))
done
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.164.1">This loop begins with a </span><code class="inlineCode"><span class="koboSpan" id="kobo.165.1">count</span></code><span class="koboSpan" id="kobo.166.1"> value of 30, which will increment by 1 on each iteration of the loop. </span><span class="koboSpan" id="kobo.166.2">It’s supposed to go until </span><code class="inlineCode"><span class="koboSpan" id="kobo.167.1">count</span></code><span class="koboSpan" id="kobo.168.1"> reaches a value of 25. </span><span class="koboSpan" id="kobo.168.2">Okay, I know that the problem is blatantly obvious this time, but bear with me anyway. </span><span class="koboSpan" id="kobo.168.3">This could happen if a coder got in a hurry and just didn’t notice it. </span><span class="koboSpan" id="kobo.168.4">Anyway, trying to run this will output a list of numbers that just keeps on going and going. </span><span class="koboSpan" id="kobo.168.5">No matter how fast you hit </span><em class="keystroke"><span class="koboSpan" id="kobo.169.1">Ctrl-c</span></em><span class="koboSpan" id="kobo.170.1">, the output will scroll past the top of your terminal, so that you’ll never get to see the top part of the output. </span><span class="koboSpan" id="kobo.170.2">So, I’ll fix that by directing the output into a text file. </span><span class="koboSpan" id="kobo.170.3">First though, I’ll open a second terminal window, and create a blank text file, like this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.171.1">donnie@fedora:~$ touch wild_loop.txt
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.172.1">Next, while still in that window, I’ll open the file with </span><code class="inlineCode"><span class="koboSpan" id="kobo.173.1">tail -f</span></code><span class="koboSpan" id="kobo.174.1">, in order to see the file as it gets updated:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.175.1">donnie@fedora:~$ tail -f wild_loop.txt
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.176.1">I’ll now go back to my first terminal window, and run the </span><code class="inlineCode"><span class="koboSpan" id="kobo.177.1">wild_loop1.sh</span></code><span class="koboSpan" id="kobo.178.1"> script, like this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.179.1">donnie@fedora:~$ ./wild_loop1.sh &gt; wild_loop.txt
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.180.1">I hit </span><em class="keystroke"><span class="koboSpan" id="kobo.181.1">Cntrl-c</span></em><span class="koboSpan" id="kobo.182.1"> after only a </span><a id="_idIndexMarker1359"/><span class="koboSpan" id="kobo.183.1">few seconds. </span><span class="koboSpan" id="kobo.183.2">But, as you see in the second window, the count really went wild:</span></p>
    <figure class="mediaobject"><span class="koboSpan" id="kobo.184.1"><img src="../Images/B21693_21_01.png" alt="B21693_21_1"/></span></figure>
    <p class="packt_figref"><span class="koboSpan" id="kobo.185.1">Figure 21.1: The wild loop is going wild!</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.186.1">Open the </span><code class="inlineCode"><span class="koboSpan" id="kobo.187.1">wild_loop.txt</span></code><span class="koboSpan" id="kobo.188.1"> file in </span><code class="inlineCode"><span class="koboSpan" id="kobo.189.1">less</span></code><span class="koboSpan" id="kobo.190.1">, and you’ll see that the script really does have the output begin at 30.</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.191.1">30
31
32
33
. </span><span class="koboSpan" id="kobo.191.2">. </span><span class="koboSpan" id="kobo.191.3">.
</span><span class="koboSpan" id="kobo.191.4">. </span><span class="koboSpan" id="kobo.191.5">. </span><span class="koboSpan" id="kobo.191.6">.
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.192.1">As I said before, the </span><a id="_idIndexMarker1360"/><span class="koboSpan" id="kobo.193.1">problem here is obvious. </span><span class="koboSpan" id="kobo.193.2">It’s just that I accidentally reversed the values of </span><code class="inlineCode"><span class="koboSpan" id="kobo.194.1">count</span></code><span class="koboSpan" id="kobo.195.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.196.1">limit</span></code><span class="koboSpan" id="kobo.197.1">. </span><span class="koboSpan" id="kobo.197.2">So, let’s fix that in </span><code class="inlineCode"><span class="koboSpan" id="kobo.198.1">wild_loop2.sh</span></code><span class="koboSpan" id="kobo.199.1">:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.200.1">#!/bin/bash
# while loop NOT running wild
count=25
limit=30
while [ "$limit" -gt "$count" ];
do
        echo $count
        (( count = (count + 1)))
done
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.201.1">This time, </span><code class="inlineCode"><span class="koboSpan" id="kobo.202.1">count</span></code><span class="koboSpan" id="kobo.203.1"> is set to 25 and </span><code class="inlineCode"><span class="koboSpan" id="kobo.204.1">limit</span></code><span class="koboSpan" id="kobo.205.1"> is set to 30. </span><span class="koboSpan" id="kobo.205.2">Running this script should work better. </span><span class="koboSpan" id="kobo.205.3">Let’s see:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.206.1">donnie@fedora:~$ ./wild_loop2.sh
25
26
27
28
29
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.207.1">Oh yeah, that looks much better.</span></p>
    <div class="note">
      <p class="normal"><span class="koboSpan" id="kobo.208.1">There are a whole lot more shell scripting pitfalls that I could share with you. </span><span class="koboSpan" id="kobo.208.2">But, in the interest of not trying to reinvent the proverbial wheel, I’ll end this here and instead share a few excellent resources that you might find useful.</span></p>
      <p class="normal"><span class="koboSpan" id="kobo.209.1">Filenames and Pathnames in Shell: How to do it Correctly:</span></p>
      <p class="normal"><a href="https://dwheeler.com/essays/filenames-in-shell.html"><span class="url"><span class="koboSpan" id="kobo.210.1">https://dwheeler.com/essays/filenames-in-shell.html</span></span></a></p>
      <p class="normal"><span class="koboSpan" id="kobo.211.1">Common Shell Script Mistakes:</span></p>
      <p class="normal"><a href="https://www.pixelbeat.org/programming/shell_script_mistakes.html"><span class="url"><span class="koboSpan" id="kobo.212.1">https://www.pixelbeat.org/programming/shell_script_mistakes.html</span></span></a></p>
      <p class="normal"><span class="koboSpan" id="kobo.213.1">BashPitfalls:</span></p>
      <p class="normal"><a href="http://mywiki.wooledge.org/BashPitfalls"><span class="url"><span class="koboSpan" id="kobo.214.1">http://mywiki.wooledge.org/BashPitfalls</span></span></a></p>
    </div>
    <p class="normal"><span class="koboSpan" id="kobo.215.1">All right, let’s move on to the debugging tools.</span></p>
    <h1 id="_idParaDest-453" class="heading 1"><span class="koboSpan" id="kobo.216.1">Using Shell Script Debugging Tools and Techniques</span></h1>
    <p class="normal"><span class="koboSpan" id="kobo.217.1">There are a few different debugging tools that we can use, which include </span><code class="inlineCode"><span class="koboSpan" id="kobo.218.1">shellcheck</span></code><span class="koboSpan" id="kobo.219.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.220.1">checkbashisms</span></code><span class="koboSpan" id="kobo.221.1">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.222.1">shall</span></code><span class="koboSpan" id="kobo.223.1">. </span><span class="koboSpan" id="kobo.223.2">We’ve already looked at them in </span><em class="chapterRef"><span class="koboSpan" id="kobo.224.1">Chapter 19—Shell Script Portability</span></em><span class="koboSpan" id="kobo.225.1">, so we won’t look at them again here. </span><span class="koboSpan" id="kobo.225.2">Instead, I’ll present some tools and techniques that we haven’t covered yet.</span></p>
    <h2 id="_idParaDest-454" class="heading 2"><span class="koboSpan" id="kobo.226.1">Using echo Statements</span></h2>
    <p class="normal"><span class="koboSpan" id="kobo.227.1">Sometimes, if</span><a id="_idIndexMarker1361"/><span class="koboSpan" id="kobo.228.1"> you have a problem with a shell script that you can’t figure out, placing </span><code class="inlineCode"><span class="koboSpan" id="kobo.229.1">echo</span></code><span class="koboSpan" id="kobo.230.1"> statements in strategic locations can help you find the problem.</span></p>
    <div class="note">
      <p class="normal"><span class="koboSpan" id="kobo.231.1">You may see in other references that some people think of </span><code class="inlineCode"><span class="koboSpan" id="kobo.232.1">echo</span></code><span class="koboSpan" id="kobo.233.1"> statements as the poor man’s debugging tool. </span><span class="koboSpan" id="kobo.233.2">That’s because </span><code class="inlineCode"><span class="koboSpan" id="kobo.234.1">echo</span></code><span class="koboSpan" id="kobo.235.1"> is always available, and can be used if you can’t use anything else.</span></p>
    </div>
    <p class="normal"><span class="koboSpan" id="kobo.236.1">Back in </span><em class="chapterRef"><span class="koboSpan" id="kobo.237.1">Chapter 16, Creating User Interfaces with yad, dialog, and xdialog</span></em><span class="koboSpan" id="kobo.238.1">, I showed you the </span><code class="inlineCode"><span class="koboSpan" id="kobo.239.1">xdialog-hello2.sh</span></code><span class="koboSpan" id="kobo.240.1"> script, which can automatically detect two things.</span></p>
    <ul>
      <li class="bulletList"><span class="koboSpan" id="kobo.241.1">It can detect whether or not the </span><code class="inlineCode"><span class="koboSpan" id="kobo.242.1">Xdialog</span></code><span class="koboSpan" id="kobo.243.1"> utility</span><a id="_idIndexMarker1362"/><span class="koboSpan" id="kobo.244.1"> is present.</span></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.245.1">It can also detect if your machine has a desktop environment installed.</span></li>
    </ul>
    <p class="normal"><span class="koboSpan" id="kobo.246.1">If both a desktop environment </span><a id="_idIndexMarker1363"/><span class="koboSpan" id="kobo.247.1">and the </span><code class="inlineCode"><span class="koboSpan" id="kobo.248.1">Xdialog</span></code><span class="koboSpan" id="kobo.249.1"> utility are detected, the script will run the graphical </span><code class="inlineCode"><span class="koboSpan" id="kobo.250.1">Xdialog</span></code><span class="koboSpan" id="kobo.251.1"> utility. </span><span class="koboSpan" id="kobo.251.2">Otherwise, the script will run the ncurses-based </span><code class="inlineCode"><span class="koboSpan" id="kobo.252.1">dialog</span></code><span class="koboSpan" id="kobo.253.1"> utility. </span><span class="koboSpan" id="kobo.253.2">Here’s what the script looks like:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.254.1">#!/bin/bash
command -v Xdialog
if [[ $? </span><span class="koboSpan" id="kobo.254.2">== 0 ]] &amp;&amp; [[ -n $DISPLAY ]]; then
        diag=Xdialog
else
        diag=dialog
fi
$diag --title "Dialog message box" \
        --begin 2 2 \
        --msgbox "\nHowdy folks!" </span><span class="koboSpan" id="kobo.254.3">15 50
clear
</span></code></pre>
    <div class="note">
      <p class="normal"><span class="koboSpan" id="kobo.255.1">As a reminder, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.256.1">DISPLAY</span></code><span class="koboSpan" id="kobo.257.1"> environmental variable will have a non-zero length assigned value if a desktop environment is installed, and won’t have an assigned value if no desktop environment is installed. </span><span class="koboSpan" id="kobo.257.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.258.1">-n</span></code><span class="koboSpan" id="kobo.259.1"> in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.260.1">[[ -n $DISPLAY ]]</span></code><span class="koboSpan" id="kobo.261.1"> statement tests for the presence of a non-zero length assigned value. </span><span class="koboSpan" id="kobo.261.2">(The </span><code class="inlineCode"><span class="koboSpan" id="kobo.262.1">-n</span></code><span class="koboSpan" id="kobo.263.1"> actually stands for </span><em class="italic"><span class="koboSpan" id="kobo.264.1">non-zero</span></em><span class="koboSpan" id="kobo.265.1">.) So, if the </span><code class="inlineCode"><span class="koboSpan" id="kobo.266.1">[[ -n $DISPLAY ]]</span></code><span class="koboSpan" id="kobo.267.1"> test returns a value of 0, which means that the condition is </span><em class="italic"><span class="koboSpan" id="kobo.268.1">true</span></em><span class="koboSpan" id="kobo.269.1">, then a desktop environment has been detected.</span></p>
    </div>
    <p class="normal"><span class="koboSpan" id="kobo.270.1">Originally though, the script looked like this, as you see in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.271.1">xdialog-hello2-broken.sh</span></code><span class="koboSpan" id="kobo.272.1"> script:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.273.1">#!/bin/bash
command -v Xdialog
if [[ -n $DISPLAY ]] &amp;&amp; [[ $? </span><span class="koboSpan" id="kobo.273.2">== 0 ]]; then
        diag=Xdialog
else
        diag=dialog
fi
$diag --title "Dialog message box" \
        --begin 2 2 \
        --msgbox "\nHowdy folks!" </span><span class="koboSpan" id="kobo.273.3">15 50
clear
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.274.1">As you see, the only </span><a id="_idIndexMarker1364"/><span class="koboSpan" id="kobo.275.1">difference is that the test conditions in the two scripts are in a different order. </span><span class="koboSpan" id="kobo.275.2">The script that works has the </span><code class="inlineCode"><span class="koboSpan" id="kobo.276.1">[[ $? </span><span class="koboSpan" id="kobo.276.2">== 0 ]]</span></code><span class="koboSpan" id="kobo.277.1"> test first, and the broken script has the </span><code class="inlineCode"><span class="koboSpan" id="kobo.278.1">[[ -n $DISPLAY ]]</span></code><span class="koboSpan" id="kobo.279.1"> condition first.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.280.1">When I tried running the</span><a id="_idIndexMarker1365"/><span class="koboSpan" id="kobo.281.1"> original script, which had </span><code class="inlineCode"><span class="koboSpan" id="kobo.282.1">[[ -n $DISPLAY ]]</span></code><span class="koboSpan" id="kobo.283.1"> first, it just wouldn’t work. </span><span class="koboSpan" id="kobo.283.2">I mean, it would work fine on desktop machines that had </span><code class="inlineCode"><span class="koboSpan" id="kobo.284.1">Xdialog</span></code><span class="koboSpan" id="kobo.285.1"> installed or machines that were running in text mode. </span><span class="koboSpan" id="kobo.285.2">But, on desktop machines that didn’t have </span><code class="inlineCode"><span class="koboSpan" id="kobo.286.1">Xdialog</span></code><span class="koboSpan" id="kobo.287.1"> installed, it would always tell me that it is installed. </span><span class="koboSpan" id="kobo.287.2">And of course, running the script would always fail because it was trying to run </span><code class="inlineCode"><span class="koboSpan" id="kobo.288.1">Xdialog</span></code><span class="koboSpan" id="kobo.289.1">. </span><span class="koboSpan" id="kobo.289.2">I couldn’t understand the reason for this, so I had to do some troubleshooting.</span></p>
    <div class="note">
      <p class="normal"><span class="koboSpan" id="kobo.290.1">I’ve never installed </span><code class="inlineCode"><span class="koboSpan" id="kobo.291.1">Xdialog</span></code><span class="koboSpan" id="kobo.292.1"> on my Fedora workstation, so I can use it to show you my troubleshooting steps. </span><span class="koboSpan" id="kobo.292.2">When you try this demo, be sure to try it on a desktop-type virtual machine that also does not have </span><code class="inlineCode"><span class="koboSpan" id="kobo.293.1">Xdialog</span></code><span class="koboSpan" id="kobo.294.1"> installed.</span></p>
    </div>
    <p class="normal"><span class="koboSpan" id="kobo.295.1">You can start troubleshooting by placing an </span><code class="inlineCode"><span class="koboSpan" id="kobo.296.1">echo $?</span></code><span class="koboSpan" id="kobo.297.1"> command and a </span><code class="inlineCode"><span class="koboSpan" id="kobo.298.1">sleep 10</span></code><span class="koboSpan" id="kobo.299.1"> command just under the </span><code class="inlineCode"><span class="koboSpan" id="kobo.300.1">command -v Xdialog</span></code><span class="koboSpan" id="kobo.301.1"> line. </span><span class="koboSpan" id="kobo.301.2">The script now looks like this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.302.1">#!/bin/bash
command -v Xdialog
echo $?
</span><span class="koboSpan" id="kobo.302.2">sleep 10
if [[ -n $DISPLAY ]] &amp;&amp; [[ $? </span><span class="koboSpan" id="kobo.302.3">== 0 ]]; then
        diag=Xdialog
else
        diag=dialog
fi
$diag --title "Dialog message box" \
        --begin 2 2 \
        --msgbox "\nHowdy folks!" </span><span class="koboSpan" id="kobo.302.4">15 50
clear
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.303.1">I wanted to see if the exit code would be 0 or 1, and the </span><code class="inlineCode"><span class="koboSpan" id="kobo.304.1">sleep 10</span></code><span class="koboSpan" id="kobo.305.1"> command would pause the script long enough so that I could see the </span><code class="inlineCode"><span class="koboSpan" id="kobo.306.1">echo $?</span></code><span class="koboSpan" id="kobo.307.1"> output.</span></p>
    <div class="note">
      <p class="normal"><span class="koboSpan" id="kobo.308.1">I inserted the </span><code class="inlineCode"><span class="koboSpan" id="kobo.309.1">sleep 10</span></code><span class="koboSpan" id="kobo.310.1"> command to give myself ten seconds to see the output of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.311.1">echo $?</span></code><span class="koboSpan" id="kobo.312.1"> command. </span><span class="koboSpan" id="kobo.312.2">Otherwise, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.313.1">clear</span></code><span class="koboSpan" id="kobo.314.1"> command at the end would clear away the output before I could see it. </span><span class="koboSpan" id="kobo.314.2">If you prefer, you can omit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.315.1">sleep 10</span></code><span class="koboSpan" id="kobo.316.1"> command, and instead just comment out the </span><code class="inlineCode"><span class="koboSpan" id="kobo.317.1">clear</span></code><span class="koboSpan" id="kobo.318.1"> command. </span><span class="koboSpan" id="kobo.318.2">Either way works, so the choice is yours.</span></p>
    </div>
    <p class="normal"><span class="koboSpan" id="kobo.319.1">A 1 would </span><a id="_idIndexMarker1366"/><span class="koboSpan" id="kobo.320.1">mean that </span><code class="inlineCode"><span class="koboSpan" id="kobo.321.1">Xdialog</span></code><span class="koboSpan" id="kobo.322.1"> is not installed, and a 0 would mean that it is installed. </span><span class="koboSpan" id="kobo.322.2">Placing the </span><code class="inlineCode"><span class="koboSpan" id="kobo.323.1">echo</span></code><span class="koboSpan" id="kobo.324.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.325.1">sleep</span></code><span class="koboSpan" id="kobo.326.1"> commands under the </span><code class="inlineCode"><span class="koboSpan" id="kobo.327.1">command -v Xdialog</span></code><span class="koboSpan" id="kobo.328.1"> command would</span><a id="_idIndexMarker1367"/><span class="koboSpan" id="kobo.329.1"> show me if the script was properly detecting if the package was installed. </span><span class="koboSpan" id="kobo.329.2">Running the script now looks like this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.330.1">donnie@fedora:~$ ./xdialog-hello2-broken.sh
1
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.331.1">The 1 exit code means that the script properly detects that </span><code class="inlineCode"><span class="koboSpan" id="kobo.332.1">Xdialog</span></code><span class="koboSpan" id="kobo.333.1"> is not present. </span><span class="koboSpan" id="kobo.333.2">So, that portion of the script works. </span><span class="koboSpan" id="kobo.333.3">Next, you can comment out the whole </span><code class="inlineCode"><span class="koboSpan" id="kobo.334.1">if. </span><span class="koboSpan" id="kobo.334.2">. </span><span class="koboSpan" id="kobo.334.3">then. </span><span class="koboSpan" id="kobo.334.4">.else</span></code><span class="koboSpan" id="kobo.335.1"> stanza, and place an </span><code class="inlineCode"><span class="koboSpan" id="kobo.336.1">[[ -n $DISPLAY ]] &amp;&amp; echo $?</span></code><span class="koboSpan" id="kobo.337.1"> statement and a </span><code class="inlineCode"><span class="koboSpan" id="kobo.338.1">sleep 10</span></code><span class="koboSpan" id="kobo.339.1"> statement just above it, like this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.340.1">#!/bin/bash
command -v Xdialog
[[ -n $DISPLAY ]] &amp;&amp; echo $?
</span><span class="koboSpan" id="kobo.340.2">sleep 10
#if [[ -n $DISPLAY ]] &amp;&amp; [[ $? </span><span class="koboSpan" id="kobo.340.3">== 0 ]]; then
 #       diag=Xdialog
#else
#        diag=dialog
#fi
$diag --title "Dialog message box" \
        --begin 2 2 \
        --msgbox "\nHowdy folks!" </span><span class="koboSpan" id="kobo.340.4">15 50
clear
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.341.1">Running the script with this modification looks like this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.342.1">donnie@fedora:~$ ./xdialog-hello2-broken.sh
0
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.343.1">The 0 exit code indicates a true condition, which means that a desktop environment is indeed installed. </span><span class="koboSpan" id="kobo.343.2">So, that part of the code also works properly.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.344.1">At this point we need to start</span><a id="_idIndexMarker1368"/><span class="koboSpan" id="kobo.345.1"> thinking logically. </span><span class="koboSpan" id="kobo.345.2">If the </span><code class="inlineCode"><span class="koboSpan" id="kobo.346.1">[[ -n $DISPLAY ]]</span></code><span class="koboSpan" id="kobo.347.1"> returns a 0 exit code, how would that affect the </span><code class="inlineCode"><span class="koboSpan" id="kobo.348.1">[[ $? </span><span class="koboSpan" id="kobo.348.2">== 0 ]]</span></code><span class="koboSpan" id="kobo.349.1"> part? </span><span class="koboSpan" id="kobo.349.2">Well, it turns out that the </span><code class="inlineCode"><span class="koboSpan" id="kobo.350.1">$?</span></code><span class="koboSpan" id="kobo.351.1"> in the second test condition was looking at the 0 exit code that was returned by the first test condition, instead of the exit code from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.352.1">command -v Xdialog</span></code><span class="koboSpan" id="kobo.353.1"> command. </span><span class="koboSpan" id="kobo.353.2">So on a desktop machine, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.354.1">$?</span></code><span class="koboSpan" id="kobo.355.1"> would always be looking at a 0 exit code, whether or not </span><code class="inlineCode"><span class="koboSpan" id="kobo.356.1">Xdialog</span></code><span class="koboSpan" id="kobo.357.1"> was present. </span><span class="koboSpan" id="kobo.357.2">Fixing that was just a simple matter of swapping the </span><a id="_idIndexMarker1369"/><span class="koboSpan" id="kobo.358.1">order of the two test conditions, as you see above in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.359.1">xdialog-hello2.sh</span></code><span class="koboSpan" id="kobo.360.1"> script.</span></p>
    <div class="note">
      <p class="normal"><span class="koboSpan" id="kobo.361.1">In hindsight, the solution to this problem should have been obvious. </span><span class="koboSpan" id="kobo.361.2">But for some reason I was having a mental block that prevented me from seeing that. </span><span class="koboSpan" id="kobo.361.3">It just goes to show that even the best of us can sometimes be buffaloed by simple scripting errors.</span></p>
    </div>
    <p class="normal"><span class="koboSpan" id="kobo.362.1">All right, let’s move on to the next debugging tool.</span></p>
    <h2 id="_idParaDest-455" class="heading 2"><span class="koboSpan" id="kobo.363.1">Using xtrace for Debugging</span></h2>
    <p class="normal"><span class="koboSpan" id="kobo.364.1">Using </span><strong class="keyWord"><span class="koboSpan" id="kobo.365.1">xtrace</span></strong><span class="koboSpan" id="kobo.366.1"> with </span><a id="_idIndexMarker1370"/><span class="koboSpan" id="kobo.367.1">your problematic scripts shows the actual execution of the commands in the scripts, along with their output. </span><span class="koboSpan" id="kobo.367.2">This can help you track down the source of your problems.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.368.1">You can use </span><code class="inlineCode"><span class="koboSpan" id="kobo.369.1">xtrace</span></code><span class="koboSpan" id="kobo.370.1"> mode in three different ways, which are:</span></p>
    <ul>
      <li class="bulletList"><span class="koboSpan" id="kobo.371.1">Append </span><code class="inlineCode"><span class="koboSpan" id="kobo.372.1">-x</span></code><span class="koboSpan" id="kobo.373.1"> to the shebang line. </span><span class="koboSpan" id="kobo.373.2">This works for all shells that we’ve been working with. </span><span class="koboSpan" id="kobo.373.3">For example, if you’re writing a </span><code class="inlineCode"><span class="koboSpan" id="kobo.374.1">bash</span></code><span class="koboSpan" id="kobo.375.1"> script, then the shebang line will be </span><code class="inlineCode"><span class="koboSpan" id="kobo.376.1">#!/bin/bash -x</span></code><span class="koboSpan" id="kobo.377.1">. </span><span class="koboSpan" id="kobo.377.2">If you’re creating a script where portability matters, you can use </span><code class="inlineCode"><span class="koboSpan" id="kobo.378.1">#!/bin/sh -x</span></code><span class="koboSpan" id="kobo.379.1">.</span></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.380.1">Place a </span><code class="inlineCode"><span class="koboSpan" id="kobo.381.1">set -x</span></code><span class="koboSpan" id="kobo.382.1"> command into the script where you want to turn on debugging mode.</span></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.383.1">Run the </span><code class="inlineCode"><span class="koboSpan" id="kobo.384.1">set -x</span></code><span class="koboSpan" id="kobo.385.1"> command from the command-line before you invoke a script.</span></li>
    </ul>
    <p class="normal"><span class="koboSpan" id="kobo.386.1">To demo this, let’s look at the </span><code class="inlineCode"><span class="koboSpan" id="kobo.387.1">xdialog-hello2-broken2.sh</span></code><span class="koboSpan" id="kobo.388.1"> script, which has the same problem as the </span><code class="inlineCode"><span class="koboSpan" id="kobo.389.1">xdialog-hello2-broken.sh</span></code><span class="koboSpan" id="kobo.390.1"> script that you saw in the previous section..</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.391.1">#!/bin/bash -x
command -v Xdialog
if [[ -n $DISPLAY ]] &amp;&amp; [[ $? </span><span class="koboSpan" id="kobo.391.2">== 0 ]]; then
        diag=Xdialog
        sleep 10
else
        diag=dialog
        sleep 10
fi
$diag --title "Dialog message box" \
        --begin 2 2 \
        --msgbox "\nHowdy folks!" </span><span class="koboSpan" id="kobo.391.3">15 50
clear
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.392.1">Here, I placed a </span><code class="inlineCode"><span class="koboSpan" id="kobo.393.1">-x</span></code><span class="koboSpan" id="kobo.394.1"> at the end of the shebang line, and then placed a </span><code class="inlineCode"><span class="koboSpan" id="kobo.395.1">sleep 10</span></code><span class="koboSpan" id="kobo.396.1"> line after the </span><code class="inlineCode"><span class="koboSpan" id="kobo.397.1">diag=Xdialog</span></code><span class="koboSpan" id="kobo.398.1"> line and the </span><code class="inlineCode"><span class="koboSpan" id="kobo.399.1">diag=dialog</span></code><span class="koboSpan" id="kobo.400.1"> line. </span><span class="koboSpan" id="kobo.400.2">Now, let’s run it.</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.401.1">donnie@fedora:~$ ./xdialog-hello2-broken2.sh
+ command -v Xdialog
+ [[ -n :0 ]]
+ [[ 0 == 0 ]]
+ diag=Xdialog
+ sleep 10
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.402.1">You can immediately see how this is even more useful than using </span><code class="inlineCode"><span class="koboSpan" id="kobo.403.1">echo</span></code><span class="koboSpan" id="kobo.404.1"> commands. </span><span class="koboSpan" id="kobo.404.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.405.1">[[ -n :0 ]]</span></code><span class="koboSpan" id="kobo.406.1"> line is the expansion of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.407.1">[[ -n $DISPLAY ]]</span></code><span class="koboSpan" id="kobo.408.1"> test. </span><span class="koboSpan" id="kobo.408.2">It shows that the </span><code class="inlineCode"><span class="koboSpan" id="kobo.409.1">DISPLAY</span></code><span class="koboSpan" id="kobo.410.1"> variable does indeed have an assigned value (</span><code class="inlineCode"><span class="koboSpan" id="kobo.411.1">:0</span></code><span class="koboSpan" id="kobo.412.1">), which means that a desktop environment is installed. </span><span class="koboSpan" id="kobo.412.2">But, the real key here is the </span><code class="inlineCode"><span class="koboSpan" id="kobo.413.1">[[ 0 == 0 ]]</span></code><span class="koboSpan" id="kobo.414.1"> line, which is the expansion of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.415.1">[[ $? </span><span class="koboSpan" id="kobo.415.2">== 0 ]]</span></code><span class="koboSpan" id="kobo.416.1"> test. </span><span class="koboSpan" id="kobo.416.2">Invoking </span><code class="inlineCode"><span class="koboSpan" id="kobo.417.1">Xdialog</span></code><span class="koboSpan" id="kobo.418.1"> from this script requires that </span><code class="inlineCode"><span class="koboSpan" id="kobo.419.1">$?</span></code><span class="koboSpan" id="kobo.420.1"> equals 0, which would require that </span><em class="italic"><span class="koboSpan" id="kobo.421.1">both</span></em><span class="koboSpan" id="kobo.422.1"> of our test conditions return a 0. </span></p>
    <p class="normal"><span class="koboSpan" id="kobo.423.1">This in turn requires that both </span><code class="inlineCode"><span class="koboSpan" id="kobo.424.1">Xdialog</span></code><span class="koboSpan" id="kobo.425.1"> and a desktop environment are present. </span><span class="koboSpan" id="kobo.425.2">But, even though </span><code class="inlineCode"><span class="koboSpan" id="kobo.426.1">Xdialog</span></code><span class="koboSpan" id="kobo.427.1"> is not installed on this machine, this script erroneously shows that it is, as you see in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.428.1">diag=Xdialog</span></code><span class="koboSpan" id="kobo.429.1"> line. </span><span class="koboSpan" id="kobo.429.2">So again, the only obvious answer is to swap the test conditions, as we did before, and test it </span><a id="_idIndexMarker1371"/><span class="koboSpan" id="kobo.430.1">again. </span><span class="koboSpan" id="kobo.430.2">After you do that, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.431.1">[[ $? </span><span class="koboSpan" id="kobo.431.2">== 0 ]]</span></code><span class="koboSpan" id="kobo.432.1"> will expand to </span><code class="inlineCode"><span class="koboSpan" id="kobo.433.1">[[ 1 == 0 ]]</span></code><span class="koboSpan" id="kobo.434.1">, which is what we want to see in this case.</span></p>
    <div class="note">
      <p class="normal"><span class="koboSpan" id="kobo.435.1">If you’re using </span><code class="inlineCode"><span class="koboSpan" id="kobo.436.1">#!/usr/bin/env bash</span></code><span class="koboSpan" id="kobo.437.1"> as your shebang line, than appending </span><code class="inlineCode"><span class="koboSpan" id="kobo.438.1">-x</span></code><span class="koboSpan" id="kobo.439.1"> to the end of the shebang line won’t work. </span><span class="koboSpan" id="kobo.439.2">That’s because </span><code class="inlineCode"><span class="koboSpan" id="kobo.440.1">env</span></code><span class="koboSpan" id="kobo.441.1"> only recognizes one option at a time, which in this case is </span><code class="inlineCode"><span class="koboSpan" id="kobo.442.1">bash</span></code><span class="koboSpan" id="kobo.443.1">. </span><span class="koboSpan" id="kobo.443.2">So instead, you’ll need to either use </span><code class="inlineCode"><span class="koboSpan" id="kobo.444.1">set -x</span></code><span class="koboSpan" id="kobo.445.1"> from the command-line before you run the script, or place a </span><code class="inlineCode"><span class="koboSpan" id="kobo.446.1">set -x</span></code><span class="koboSpan" id="kobo.447.1"> command inside the script, like this:</span></p>
      <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.448.1">#!/usr/bin/env bash
set -x
. </span><span class="koboSpan" id="kobo.448.2">. </span><span class="koboSpan" id="kobo.448.3">.
</span><span class="koboSpan" id="kobo.448.4">. </span><span class="koboSpan" id="kobo.448.5">. </span><span class="koboSpan" id="kobo.448.6">.
</span></code></pre>
      <p class="normal"><span class="koboSpan" id="kobo.449.1">If you use </span><code class="inlineCode"><span class="koboSpan" id="kobo.450.1">set -x</span></code><span class="koboSpan" id="kobo.451.1"> on the command-line, you can turn debug mode back off by doing </span><code class="inlineCode"><span class="koboSpan" id="kobo.452.1">set +x</span></code><span class="koboSpan" id="kobo.453.1">.</span></p>
    </div>
    <p class="normal"><span class="koboSpan" id="kobo.454.1">If </span><code class="inlineCode"><span class="koboSpan" id="kobo.455.1">-x</span></code><span class="koboSpan" id="kobo.456.1"> alone doesn’t show you enough information, you can enable verbose mode by adding the </span><code class="inlineCode"><span class="koboSpan" id="kobo.457.1">v</span></code><span class="koboSpan" id="kobo.458.1"> option, as you see in </span><code class="inlineCode"><span class="koboSpan" id="kobo.459.1">xdialog-hello2-broken4.sh</span></code><span class="koboSpan" id="kobo.460.1">:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.461.1">#!/bin/bash -xv
command -v Xdialog
if [[ -n $DISPLAY ]] &amp;&amp; [[ $? </span><span class="koboSpan" id="kobo.461.2">== 0 ]]; then
        diag=Xdialog
        sleep 10
else
        diag=dialog
        sleep 10
fi
$diag --title "Dialog message box" \
        --begin 2 2 \
        --msgbox "\nHowdy folks!" </span><span class="koboSpan" id="kobo.461.3">15 50
clear
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.462.1">Here’s the </span><a id="_idIndexMarker1372"/><span class="koboSpan" id="kobo.463.1">output:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.464.1">donnie@fedora:~$ ./xdialog-hello2-broken4.sh
#!/bin/bash -xv
command -v Xdialog
+ command -v Xdialog
if [[ -n $DISPLAY ]] &amp;&amp; [[ $? </span><span class="koboSpan" id="kobo.464.2">== 0 ]]; then
        diag=Xdialog
	sleep 10
else
        diag=dialog
	sleep 10
fi
+ [[ -n :0 ]]
+ [[ 0 == 0 ]]
+ diag=Xdialog
+ sleep 10
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.465.1">In addition to what we saw before, we now see the entire script echoed back at us. </span><span class="koboSpan" id="kobo.465.2">We also see that the value of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.466.1">diag</span></code><span class="koboSpan" id="kobo.467.1"> variable is </span><code class="inlineCode"><span class="koboSpan" id="kobo.468.1">Xdialog</span></code><span class="koboSpan" id="kobo.469.1">. </span><span class="koboSpan" id="kobo.469.2">Since </span><code class="inlineCode"><span class="koboSpan" id="kobo.470.1">Xdialog</span></code><span class="koboSpan" id="kobo.471.1"> isn’t installed on this machine, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.472.1">diag</span></code><span class="koboSpan" id="kobo.473.1"> value should be </span><code class="inlineCode"><span class="koboSpan" id="kobo.474.1">dialog</span></code><span class="koboSpan" id="kobo.475.1">.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.476.1">If you need a permanent record of your debugging for further study, you can redirect the </span><code class="inlineCode"><span class="koboSpan" id="kobo.477.1">-x</span></code><span class="koboSpan" id="kobo.478.1"> output into a text file. </span><span class="koboSpan" id="kobo.478.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.479.1">-x</span></code><span class="koboSpan" id="kobo.480.1"> output is considered as </span><code class="inlineCode"><span class="koboSpan" id="kobo.481.1">stderr</span></code><span class="koboSpan" id="kobo.482.1"> output, so you’ll redirect it</span><a id="_idIndexMarker1373"/><span class="koboSpan" id="kobo.483.1"> like so:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.484.1">donnie@fedora:~$ ./xdialog-hello2-broken4.sh 2&gt; debug.txt
</span></code></pre>
    <div class="note">
      <p class="normal"><span class="koboSpan" id="kobo.485.1">When you’re through debugging, be sure to remove the </span><code class="inlineCode"><span class="koboSpan" id="kobo.486.1">-x</span></code><span class="koboSpan" id="kobo.487.1"> or set </span><code class="inlineCode"><span class="koboSpan" id="kobo.488.1">-x</span></code><span class="koboSpan" id="kobo.489.1"> options from your script before you put it into production.</span></p>
    </div>
    <p class="normal"><span class="koboSpan" id="kobo.490.1">Okay, let’s move on to our next trick.</span></p>
    <h2 id="_idParaDest-456" class="heading 2"><span class="koboSpan" id="kobo.491.1">Checking for Undefined Variables</span></h2>
    <p class="normal"><span class="koboSpan" id="kobo.492.1">As I said at the beginning </span><a id="_idIndexMarker1374"/><span class="koboSpan" id="kobo.493.1">of this chapter, in the </span><em class="chapterRef"><span class="koboSpan" id="kobo.494.1">Understanding Common Scripting Errors</span></em><span class="koboSpan" id="kobo.495.1"> section, it’s sometimes desirable to define a variable in a script without assigning an initial value to it. </span><span class="koboSpan" id="kobo.495.2">But, sometimes it isn’t. </span><span class="koboSpan" id="kobo.495.3">You can track down uninitialized variables by appending a </span><code class="inlineCode"><span class="koboSpan" id="kobo.496.1">-u</span></code><span class="koboSpan" id="kobo.497.1"> to the end of your shebang line. </span><span class="koboSpan" id="kobo.497.2">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.498.1">bash</span></code><span class="koboSpan" id="kobo.499.1"> for example, you can use </span><code class="inlineCode"><span class="koboSpan" id="kobo.500.1">#!/bin/bash -u</span></code><span class="koboSpan" id="kobo.501.1">, which will turn this feature on for the entire script. </span><span class="koboSpan" id="kobo.501.2">Or, you can place a </span><code class="inlineCode"><span class="koboSpan" id="kobo.502.1">set -u</span></code><span class="koboSpan" id="kobo.503.1"> command any place in the script where you’d like to start checking. </span><span class="koboSpan" id="kobo.503.2">For example, let’s look at the </span><code class="inlineCode"><span class="koboSpan" id="kobo.504.1">unassigned_var1.sh</span></code><span class="koboSpan" id="kobo.505.1"> script, which has variable checking turned off:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.506.1">#!/bin/bash
echo "The uninitialized myvar, without setting -u, looks like this : " $myvar
echo
myvar=Donnie
echo "I've just initialized myvar."
</span><span class="koboSpan" id="kobo.506.2">echo "The value of myvar is: " $myvar
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.507.1">Here’s the output:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.508.1">donnie@fedora:~$ ./unassigned_var1.sh
The uninitialized myvar, without setting -u, looks like this :
I've just initialized myvar.
</span><span class="koboSpan" id="kobo.508.2">The value of myvar is:  Donnie
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.509.1">As you see, without the </span><code class="inlineCode"><span class="koboSpan" id="kobo.510.1">-u</span></code><span class="koboSpan" id="kobo.511.1"> setting, the script runs to completion. </span><span class="koboSpan" id="kobo.511.2">It’s just that trying to echo the value of the uninitialized </span><code class="inlineCode"><span class="koboSpan" id="kobo.512.1">myvar</span></code><span class="koboSpan" id="kobo.513.1"> just shows us a blank space. </span><span class="koboSpan" id="kobo.513.2">Next, let’s turn on variable checking by adding the </span><code class="inlineCode"><span class="koboSpan" id="kobo.514.1">-u</span></code><span class="koboSpan" id="kobo.515.1"> option, as you see in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.516.1">unassigned_var2.sh</span></code><span class="koboSpan" id="kobo.517.1"> script:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.518.1">#!/bin/bash -u
echo "The uninitialized myvar, without setting -u, looks like this : " $myvar
echo
myvar=Donnie
echo "I've just initialized myvar."
</span><span class="koboSpan" id="kobo.518.2">echo "The value of myvar is: " $myvar
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.519.1">Let’s see what this does:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.520.1">donnie@fedora:~$ ./unassigned_var2.sh
./unassigned_var2.sh: line 2: myvar: unbound variable
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.521.1">This time the script</span><a id="_idIndexMarker1375"/><span class="koboSpan" id="kobo.522.1"> failed as soon as it saw the uninitialized variable.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.523.1">You can set the </span><code class="inlineCode"><span class="koboSpan" id="kobo.524.1">-u</span></code><span class="koboSpan" id="kobo.525.1"> option anywhere in the script you like, by using </span><code class="inlineCode"><span class="koboSpan" id="kobo.526.1">set -u</span></code><span class="koboSpan" id="kobo.527.1">, as you see here in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.528.1">unassigned_var3.sh</span></code><span class="koboSpan" id="kobo.529.1"> script:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.530.1">#!/bin/bash
echo "The uninitialized myvar, without setting -u, looks like this : " $myvar
echo
echo "I'm now setting -u."
</span><span class="koboSpan" id="kobo.530.2">set -u
myvar=Donnie
echo "I've just initialized myvar."
</span><span class="koboSpan" id="kobo.530.3">echo "The value of myvar is: " $myvar
echo
echo "Let's now try another uninitialized variable."
</span><span class="koboSpan" id="kobo.530.4">echo "Here's the uninitialized " $myvar2
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.531.1">So now, I have one uninitialized variable at the top, on line 2. </span><span class="koboSpan" id="kobo.531.2">(Let’s just say that for whatever reason, I want this particular variable to be uninitialized.) I then turn on variable checking on line 5. </span><span class="koboSpan" id="kobo.531.3">Let’s see how this runs:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.532.1">donnie@fedora:~$ ./unassigned_var3.sh
The uninitialized myvar, without setting -u, looks like this :
I'm now setting -u.
</span><span class="koboSpan" id="kobo.532.2">I've just initialized myvar.
</span><span class="koboSpan" id="kobo.532.3">The value of myvar is:  Donnie
Let's now try another uninitialized variable.
</span><span class="koboSpan" id="kobo.532.4">./unassigned_var3.sh: line 11: myvar2: unbound variable
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.533.1">Before I turn on</span><a id="_idIndexMarker1376"/><span class="koboSpan" id="kobo.534.1"> variable checking, the uninitialized </span><code class="inlineCode"><span class="koboSpan" id="kobo.535.1">myvar</span></code><span class="koboSpan" id="kobo.536.1"> just shows us a blank space. </span><span class="koboSpan" id="kobo.536.2">After I turn on variable checking, I initialized </span><code class="inlineCode"><span class="koboSpan" id="kobo.537.1">myvar</span></code><span class="koboSpan" id="kobo.538.1"> with a value of </span><code class="inlineCode"><span class="koboSpan" id="kobo.539.1">Donnie</span></code><span class="koboSpan" id="kobo.540.1">, and it prints out normally. </span><span class="koboSpan" id="kobo.540.2">But, the uninitialized </span><code class="inlineCode"><span class="koboSpan" id="kobo.541.1">myvar2</span></code><span class="koboSpan" id="kobo.542.1"> at the end crashes the script.</span></p>
    <div class="note">
      <p class="normal"><span class="koboSpan" id="kobo.543.1">If you search the web for shell scripting security tutorials, you’ll find several that tell you to make either </span><code class="inlineCode"><span class="koboSpan" id="kobo.544.1">-u</span></code><span class="koboSpan" id="kobo.545.1"> or </span><code class="inlineCode"><span class="koboSpan" id="kobo.546.1">set -u</span></code><span class="koboSpan" id="kobo.547.1"> a permanent part of your scripts. </span><span class="koboSpan" id="kobo.547.2">The authors of these tutorials say that it enhances the security of your scripts, without giving any convincing explanation of why or how. </span><span class="koboSpan" id="kobo.547.3">Using </span><code class="inlineCode"><span class="koboSpan" id="kobo.548.1">-u</span></code><span class="koboSpan" id="kobo.549.1"> or </span><code class="inlineCode"><span class="koboSpan" id="kobo.550.1">set -u</span></code><span class="koboSpan" id="kobo.551.1"> is great for debugging, but it should only be used for just that—debugging! </span><span class="koboSpan" id="kobo.551.2">So, when you’re through debugging your scripts, be sure to remove the </span><code class="inlineCode"><span class="koboSpan" id="kobo.552.1">-u</span></code><span class="koboSpan" id="kobo.553.1"> or the </span><code class="inlineCode"><span class="koboSpan" id="kobo.554.1">set -u</span></code><span class="koboSpan" id="kobo.555.1"> before you place the script into production. </span><span class="koboSpan" id="kobo.555.2">Otherwise, your scripts could give you some rather unpredictable results.</span></p>
      <p class="normal"><span class="koboSpan" id="kobo.556.1">Also, be aware that using </span><code class="inlineCode"><span class="koboSpan" id="kobo.557.1">-u</span></code><span class="koboSpan" id="kobo.558.1"> can also help you detect typos in your scripts. </span><span class="koboSpan" id="kobo.558.2">For example, if you define a variable as </span><code class="inlineCode"><span class="koboSpan" id="kobo.559.1">mynum=1</span></code><span class="koboSpan" id="kobo.560.1">, but accidentally call back the value with </span><code class="inlineCode"><span class="koboSpan" id="kobo.561.1">$mymum</span></code><span class="koboSpan" id="kobo.562.1">, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.563.1">-u</span></code><span class="koboSpan" id="kobo.564.1"> will detect that </span><code class="inlineCode"><span class="koboSpan" id="kobo.565.1">mymum</span></code><span class="koboSpan" id="kobo.566.1"> is an unset variable.</span></p>
    </div>
    <p class="normal"><span class="koboSpan" id="kobo.567.1">That about does it for the discussion of uninitialized variables. </span><span class="koboSpan" id="kobo.567.2">Let’s move on to our next trick.</span></p>
    <h2 id="_idParaDest-457" class="heading 2"><span class="koboSpan" id="kobo.568.1">Checking for Errors with the -e Option</span></h2>
    <p class="normal"><span class="koboSpan" id="kobo.569.1">Our next trick is to </span><a id="_idIndexMarker1377"/><span class="koboSpan" id="kobo.570.1">use either the </span><code class="inlineCode"><span class="koboSpan" id="kobo.571.1">-e</span></code><span class="koboSpan" id="kobo.572.1"> shell option or the </span><code class="inlineCode"><span class="koboSpan" id="kobo.573.1">set -e</span></code><span class="koboSpan" id="kobo.574.1"> command to test our scripts for errors that cause commands within the script to fail. </span><span class="koboSpan" id="kobo.574.2">Let’s look at the </span><code class="inlineCode"><span class="koboSpan" id="kobo.575.1">bad_dir1.sh</span></code><span class="koboSpan" id="kobo.576.1"> script to see how that works.</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.577.1">#!/bin/bash
mkdir mydir
cd mydire
ls
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.578.1">With this, I want to create the </span><code class="inlineCode"><span class="koboSpan" id="kobo.579.1">mydir</span></code><span class="koboSpan" id="kobo.580.1"> directory, </span><code class="inlineCode"><span class="koboSpan" id="kobo.581.1">cd</span></code><span class="koboSpan" id="kobo.582.1"> into it, and then do a file listing. </span><span class="koboSpan" id="kobo.582.2">But, my typing isn’t up to what it should be today, so in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.583.1">cd</span></code><span class="koboSpan" id="kobo.584.1"> line I accidentally typed </span><code class="inlineCode"><span class="koboSpan" id="kobo.585.1">mydire</span></code><span class="koboSpan" id="kobo.586.1">, instead of </span><code class="inlineCode"><span class="koboSpan" id="kobo.587.1">mydir</span></code><span class="koboSpan" id="kobo.588.1">. </span><span class="koboSpan" id="kobo.588.2">Let’s see what happens when I run it.</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.589.1">donnie@fedora:~$ ./bad_dir1.sh
./bad_dir1.sh: line 4: cd: mydire: No such file or directory
 15827_zip.zip
 18.csv
 2023-08-01_15-23-31.mp4
. </span><span class="koboSpan" id="kobo.589.2">. </span><span class="koboSpan" id="kobo.589.3">.
</span><span class="koboSpan" id="kobo.589.4">. </span><span class="koboSpan" id="kobo.589.5">. </span><span class="koboSpan" id="kobo.589.6">.
</span><span class="koboSpan" id="kobo.589.7">yad_timer.sh
yad-weather.sh
zoneinfo.zip
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.590.1">Yeah, this problem is obvious, but that’s okay. </span><span class="koboSpan" id="kobo.590.2">That’s because the </span><code class="inlineCode"><span class="koboSpan" id="kobo.591.1">-e</span></code><span class="koboSpan" id="kobo.592.1"> option does more than just identify the problem. </span><span class="koboSpan" id="kobo.592.2">It would cause the script to immediately exit if any command fails. </span><span class="koboSpan" id="kobo.592.3">Let’s put this option into the </span><code class="inlineCode"><span class="koboSpan" id="kobo.593.1">bad_dir2.sh</span></code><span class="koboSpan" id="kobo.594.1"> script to see how that works.</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.595.1">#!/bin/bash -e
mkdir mydir
cd mydire
ls
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.596.1">All I did here was to insert the </span><code class="inlineCode"><span class="koboSpan" id="kobo.597.1">-e</span></code><span class="koboSpan" id="kobo.598.1"> option. </span><span class="koboSpan" id="kobo.598.2">Now, I’ll delete the </span><code class="inlineCode"><span class="koboSpan" id="kobo.599.1">mydir</span></code><span class="koboSpan" id="kobo.600.1"> directory that the first script created, and try running this one.</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.601.1">donnie@fedora:~$ rm -rf mydir
donnie@fedora:~$ ./bad_dir2.sh
./bad_dir2.sh: line 4: cd: mydire: No such file or directory
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.602.1">Using </span><code class="inlineCode"><span class="koboSpan" id="kobo.603.1">-e</span></code><span class="koboSpan" id="kobo.604.1"> also works </span><a id="_idIndexMarker1378"/><span class="koboSpan" id="kobo.605.1">when the failing command is part of a compound command structure, as you see in </span><code class="inlineCode"><span class="koboSpan" id="kobo.606.1">bad_dir3.sh</span></code><span class="koboSpan" id="kobo.607.1">.</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.608.1">#!/bin/bash -e
mkdir mydir &amp;&amp; cd mydire
ls
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.609.1">As before, I’ll delete the </span><code class="inlineCode"><span class="koboSpan" id="kobo.610.1">mydir</span></code><span class="koboSpan" id="kobo.611.1"> directory that the previous script created, and then run </span><code class="inlineCode"><span class="koboSpan" id="kobo.612.1">bad_dir3.sh</span></code><span class="koboSpan" id="kobo.613.1">, which looks like this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.614.1">donnie@fedora:~$ ./bad_dir3.sh
./bad_dir3.sh: line 3: cd: mydire: No such file or directory
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.615.1">So again, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.616.1">-e</span></code><span class="koboSpan" id="kobo.617.1"> stopped this script in its tracks when the </span><code class="inlineCode"><span class="koboSpan" id="kobo.618.1">cd</span></code><span class="koboSpan" id="kobo.619.1"> command failed.</span></p>
    <div class="note">
      <p class="normal"><span class="koboSpan" id="kobo.620.1">I know what you’re thinking, and I know that that’s a bit creepy. </span><span class="koboSpan" id="kobo.620.2">You’re thinking that the kinds of errors that </span><code class="inlineCode"><span class="koboSpan" id="kobo.621.1">-e</span></code><span class="koboSpan" id="kobo.622.1"> would detect are fairly obvious. </span><span class="koboSpan" id="kobo.622.2">That’s because with these types of errors, the shell will display an error message that pinpoints the problem. </span><span class="koboSpan" id="kobo.622.3">So then, why do we need </span><code class="inlineCode"><span class="koboSpan" id="kobo.623.1">-e</span></code><span class="koboSpan" id="kobo.624.1">? </span><span class="koboSpan" id="kobo.624.2">Well, think of </span><code class="inlineCode"><span class="koboSpan" id="kobo.625.1">-e</span></code><span class="koboSpan" id="kobo.626.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.627.1">set -e</span></code><span class="koboSpan" id="kobo.628.1"> as more of a safety mechanism than a debugging tool. </span><span class="koboSpan" id="kobo.628.2">For example, if the next command after trying to </span><code class="inlineCode"><span class="koboSpan" id="kobo.629.1">cd</span></code><span class="koboSpan" id="kobo.630.1"> into a non-existent directory is to </span><code class="inlineCode"><span class="koboSpan" id="kobo.631.1">rm</span></code><span class="koboSpan" id="kobo.632.1"> all files, then allowing the script to run after the </span><code class="inlineCode"><span class="koboSpan" id="kobo.633.1">cd</span></code><span class="koboSpan" id="kobo.634.1"> command fails could be disastrous.</span></p>
    </div>
    <p class="normal"><span class="koboSpan" id="kobo.635.1">Okay, I’ve told you the good stuff about </span><code class="inlineCode"><span class="koboSpan" id="kobo.636.1">-e</span></code><span class="koboSpan" id="kobo.637.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.638.1">set -e</span></code><span class="koboSpan" id="kobo.639.1">. </span><span class="koboSpan" id="kobo.639.2">Now, let me tell you some not-so-good stuff.</span></p>
    <h3 id="_idParaDest-458" class="heading 3"><span class="koboSpan" id="kobo.640.1">Understanding the Problems with set -e and -e</span></h3>
    <p class="normal"><span class="koboSpan" id="kobo.641.1">Although </span><code class="inlineCode"><span class="koboSpan" id="kobo.642.1">-e</span></code><span class="koboSpan" id="kobo.643.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.644.1">set -e</span></code><span class="koboSpan" id="kobo.645.1"> can be helpful, they can also cause you headaches. </span><span class="koboSpan" id="kobo.645.2">Sometimes, they</span><a id="_idIndexMarker1379"/><span class="koboSpan" id="kobo.646.1"> can actually break a script that worked before. </span><span class="koboSpan" id="kobo.646.2">Here’s what I mean.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.647.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.648.1">set -e</span></code><span class="koboSpan" id="kobo.649.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.650.1">-e</span></code><span class="koboSpan" id="kobo.651.1"> settings work by detecting if a command in the script returns an exit code of something other than 0.</span></p>
    <div class="note">
      <p class="normal"><span class="koboSpan" id="kobo.652.1">Remember that an exit code of 0 indicates a successful command execution, and a non-0 exit code indicates a failure.</span></p>
    </div>
    <p class="normal"><span class="koboSpan" id="kobo.653.1">Sometimes though, you’ll need for some commands in your script to return a non-0 exit code in order for the script to work. </span><span class="koboSpan" id="kobo.653.2">This makes the operation of </span><code class="inlineCode"><span class="koboSpan" id="kobo.654.1">set -e</span></code><span class="koboSpan" id="kobo.655.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.656.1">-e</span></code><span class="koboSpan" id="kobo.657.1"> unpredictable, at best. </span><span class="koboSpan" id="kobo.657.2">For example, take a look at this </span><code class="inlineCode"><span class="koboSpan" id="kobo.658.1">set_e_fails1.sh</span></code><span class="koboSpan" id="kobo.659.1"> script:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.660.1">#!/bin/bash
set -e
i=0
let i++
echo "i is $i"
</span></code></pre>
    <div class="note">
      <p class="normal"><span class="koboSpan" id="kobo.661.1">Note that </span><code class="inlineCode"><span class="koboSpan" id="kobo.662.1">let i++</span></code><span class="koboSpan" id="kobo.663.1"> is a bashism that I haven’t yet shown you. </span><span class="koboSpan" id="kobo.663.2">You can replace it with </span><code class="inlineCode"><span class="koboSpan" id="kobo.664.1">i=$(( i + 1 ))</span></code><span class="koboSpan" id="kobo.665.1"> in order to make the script portable to non-</span><code class="inlineCode"><span class="koboSpan" id="kobo.666.1">bash</span></code><span class="koboSpan" id="kobo.667.1"> shells.</span></p>
    </div>
    <p class="normal"><span class="koboSpan" id="kobo.668.1">This creates the </span><code class="inlineCode"><span class="koboSpan" id="kobo.669.1">i</span></code><span class="koboSpan" id="kobo.670.1"> variable with a value of 0, increments that value by 1, and then prints out the final value of </span><code class="inlineCode"><span class="koboSpan" id="kobo.671.1">i</span></code><span class="koboSpan" id="kobo.672.1">. </span><span class="koboSpan" id="kobo.672.2">But, watch what happens with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.673.1">-e</span></code><span class="koboSpan" id="kobo.674.1"> setting:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.675.1">donnie@fedora:~$ ./set_e_fails1.sh
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.676.1">Well, it prints out nothing. </span><span class="koboSpan" id="kobo.676.2">Let’s see what happens if I comment out the </span><code class="inlineCode"><span class="koboSpan" id="kobo.677.1">set -e</span></code><span class="koboSpan" id="kobo.678.1"> command, like so:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.679.1">#!/bin/bash
# set -e
i=0
let i++
echo "i is $i"
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.680.1">Let’s run it again.</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.681.1">donnie@fedora:~$ ./set_e_fails1.sh
i is 1
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.682.1">So, the script runs perfectly fine</span><a id="_idIndexMarker1380"/><span class="koboSpan" id="kobo.683.1"> without the </span><code class="inlineCode"><span class="koboSpan" id="kobo.684.1">set -e</span></code><span class="koboSpan" id="kobo.685.1">, but inserting the </span><code class="inlineCode"><span class="koboSpan" id="kobo.686.1">set -e</span></code><span class="koboSpan" id="kobo.687.1"> breaks it. </span><span class="koboSpan" id="kobo.687.2">I know, that’s crazy, right? </span><span class="koboSpan" id="kobo.687.3">To help us figure out what’s going on, let’s create the </span><code class="inlineCode"><span class="koboSpan" id="kobo.688.1">set_e_fails2.sh</span></code><span class="koboSpan" id="kobo.689.1"> script, like so:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.690.1">#!/bin/bash
i=0
echo "Exit code after setting the value of i: " $?
</span><span class="koboSpan" id="kobo.690.2">let i++
echo "Exit code after incrementing i: " $?
</span><span class="koboSpan" id="kobo.690.3">echo "i is $i"
echo "Exit code after displaying new value of i: " $?
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.691.1">The only difference is that I omitted the </span><code class="inlineCode"><span class="koboSpan" id="kobo.692.1">set -e</span></code><span class="koboSpan" id="kobo.693.1"> line, and inserted </span><code class="inlineCode"><span class="koboSpan" id="kobo.694.1">echo</span></code><span class="koboSpan" id="kobo.695.1"> statements that display the exit code of each command. </span><span class="koboSpan" id="kobo.695.2">Now, to run it:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.696.1">donnie@fedora:~$ ./set_e_fails2.sh
Exit code after setting the value of i:  0
Exit code after incrementing i:  1
i is 1
Exit code after displaying new value of i:  0
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.697.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.698.1">Exit code after incrementing i: 1</span></code><span class="koboSpan" id="kobo.699.1"> line shows us the problem. </span><span class="koboSpan" id="kobo.699.2">It’s just that for some truly bizarre reason that I don’t understand, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.700.1">let i++</span></code><span class="koboSpan" id="kobo.701.1"> command produces an exit code of 1, even though the command is successful. </span><span class="koboSpan" id="kobo.701.2">So in this case, using </span><code class="inlineCode"><span class="koboSpan" id="kobo.702.1">-e</span></code><span class="koboSpan" id="kobo.703.1"> created a problem, instead of solving one. </span><span class="koboSpan" id="kobo.703.2">(Curiously though, using the portable </span><code class="inlineCode"><span class="koboSpan" id="kobo.704.1">i=$(( i + 1 ))</span></code><span class="koboSpan" id="kobo.705.1"> construct will return exit code 0, which will prevent this problem. </span><span class="koboSpan" id="kobo.705.2">I have no idea why that is.) </span></p>
    <div class="note">
      <p class="normal"><span class="koboSpan" id="kobo.706.1">I mentioned in the </span><em class="chapterRef"><span class="koboSpan" id="kobo.707.1">Checking for Undefined Variables</span></em><span class="koboSpan" id="kobo.708.1"> section that some articles you’ll find on the web recommend making either </span><code class="inlineCode"><span class="koboSpan" id="kobo.709.1">-u</span></code><span class="koboSpan" id="kobo.710.1"> or </span><code class="inlineCode"><span class="koboSpan" id="kobo.711.1">set -u</span></code><span class="koboSpan" id="kobo.712.1"> a permanent part of your scripts, in order to enhance security. </span><span class="koboSpan" id="kobo.712.2">These authors actually recommend making both the </span><code class="inlineCode"><span class="koboSpan" id="kobo.713.1">-e</span></code><span class="koboSpan" id="kobo.714.1">/</span><code class="inlineCode"><span class="koboSpan" id="kobo.715.1">set -e</span></code><span class="koboSpan" id="kobo.716.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.717.1">-u</span></code><span class="koboSpan" id="kobo.718.1">/</span><code class="inlineCode"><span class="koboSpan" id="kobo.719.1">set -u</span></code><span class="koboSpan" id="kobo.720.1"> a permanent part of your scripts. </span><span class="koboSpan" id="kobo.720.2">But, as I’ve just demonstrated, </span><code class="inlineCode"><span class="koboSpan" id="kobo.721.1">-e</span></code><span class="koboSpan" id="kobo.722.1">/</span><code class="inlineCode"><span class="koboSpan" id="kobo.723.1">set -e</span></code><span class="koboSpan" id="kobo.724.1"> can be rather unpredictable, and could cause you more problems than it solves. </span><span class="koboSpan" id="kobo.724.2">At any rate, if you do use this tool for troubleshooting, be sure to delete it from your scripts before you place them into production.</span></p>
      <p class="normal"><span class="koboSpan" id="kobo.725.1">Although my personal belief is that </span><code class="inlineCode"><span class="koboSpan" id="kobo.726.1">-e</span></code><span class="koboSpan" id="kobo.727.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.728.1">set -e</span></code><span class="koboSpan" id="kobo.729.1"> can be useful when used with caution, that’s actually a controversial opinion. </span><span class="koboSpan" id="kobo.729.2">In the following article, you’ll see a lengthy write-up about why you should never, ever use </span><code class="inlineCode"><span class="koboSpan" id="kobo.730.1">-e</span></code><span class="koboSpan" id="kobo.731.1"> or </span><code class="inlineCode"><span class="koboSpan" id="kobo.732.1">set -e</span></code><span class="koboSpan" id="kobo.733.1">:</span></p>
      <p class="normal"><span class="koboSpan" id="kobo.734.1">BashFAQ105—Greg’s Wiki:</span></p>
      <p class="normal"><a href="https://mywiki.wooledge.org/BashFAQ/105"><span class="url"><span class="koboSpan" id="kobo.735.1">https://mywiki.wooledge.org/BashFAQ/105</span></span></a></p>
      <p class="normal"><span class="koboSpan" id="kobo.736.1">This author’s belief is that you would be better served by creating your own error checks, rather than relying on </span><code class="inlineCode"><span class="koboSpan" id="kobo.737.1">-e</span></code><span class="koboSpan" id="kobo.738.1">/</span><code class="inlineCode"><span class="koboSpan" id="kobo.739.1">set -e</span></code><span class="koboSpan" id="kobo.740.1">.</span></p>
      <p class="normal"><span class="koboSpan" id="kobo.741.1">If you like, give the page a visit, and work through the examples that the author provides. </span><span class="koboSpan" id="kobo.741.2">The author also provides a link to a page with the counter-argument to this, so be sure to check that out as well so that you can decide for yourself.</span></p>
    </div>
    <p class="normal"><span class="koboSpan" id="kobo.742.1">Okay, let’s move on to our final debugging tool.</span></p>
    <h2 id="_idParaDest-459" class="heading 2"><span class="koboSpan" id="kobo.743.1">Using bash Debugger</span></h2>
    <p class="normal"><span class="koboSpan" id="kobo.744.1">The </span><strong class="keyWord"><span class="koboSpan" id="kobo.745.1">bash Debugger</span></strong><span class="koboSpan" id="kobo.746.1">, which you’ll </span><a id="_idIndexMarker1381"/><span class="koboSpan" id="kobo.747.1">normally see referred to as </span><strong class="keyWord"><span class="koboSpan" id="kobo.748.1">bashdb</span></strong><span class="koboSpan" id="kobo.749.1">, allows you to step through a </span><code class="inlineCode"><span class="koboSpan" id="kobo.750.1">bash</span></code><span class="koboSpan" id="kobo.751.1"> script, one command at a time. </span><span class="koboSpan" id="kobo.751.2">This allows you to see what each command in the script is doing before moving on to the next command. </span><span class="koboSpan" id="kobo.751.3">It’s pretty simple to use, once you get installed.</span></p>
    <div class="note">
      <p class="normal"><span class="koboSpan" id="kobo.752.1">You’ll find a lot of </span><code class="inlineCode"><span class="koboSpan" id="kobo.753.1">bashdb</span></code><span class="koboSpan" id="kobo.754.1"> tutorials on the web, but a lot of them are very old, and show you an obsolete method for installing </span><code class="inlineCode"><span class="koboSpan" id="kobo.755.1">bashdb</span></code><span class="koboSpan" id="kobo.756.1">. </span><span class="koboSpan" id="kobo.756.2">That’s because years ago, </span><code class="inlineCode"><span class="koboSpan" id="kobo.757.1">bashdb</span></code><span class="koboSpan" id="kobo.758.1"> was included in the repositories of pretty much every Linux distro. </span><span class="koboSpan" id="kobo.758.2">So, you could install it with your normal package manager as those tutorials showed.</span></p>
      <p class="normal"><span class="koboSpan" id="kobo.759.1">Unfortunately, for some strange reason, </span><code class="inlineCode"><span class="koboSpan" id="kobo.760.1">bashdb</span></code><span class="koboSpan" id="kobo.761.1"> has been removed from most, if not all, Linux repositories. </span><span class="koboSpan" id="kobo.761.2">So now, if you want to run </span><code class="inlineCode"><span class="koboSpan" id="kobo.762.1">bashdb</span></code><span class="koboSpan" id="kobo.763.1"> on Linux, you’ll need to compile it from source code as I’m about to show you.</span></p>
      <p class="normal"><span class="koboSpan" id="kobo.764.1">On the other hand, </span><code class="inlineCode"><span class="koboSpan" id="kobo.765.1">bashdb</span></code><span class="koboSpan" id="kobo.766.1"> is in the</span><a id="_idIndexMarker1382"/><span class="koboSpan" id="kobo.767.1"> FreeBSD repository and in the Homebrew repository for macOS, so you’re all good there.</span></p>
    </div>
    <p class="normal"><span class="koboSpan" id="kobo.768.1">Okay, let’s look at installing </span><code class="inlineCode"><span class="koboSpan" id="kobo.769.1">bashdb</span></code><span class="koboSpan" id="kobo.770.1">.</span></p>
    <h3 id="_idParaDest-460" class="heading 3"><span class="koboSpan" id="kobo.771.1">Installing bashdb on Linux</span></h3>
    <p class="normal"><span class="koboSpan" id="kobo.772.1">As I mentioned </span><a id="_idIndexMarker1383"/><span class="koboSpan" id="kobo.773.1">above in the info box, you’ll need to </span><a id="_idIndexMarker1384"/><span class="koboSpan" id="kobo.774.1">install </span><code class="inlineCode"><span class="koboSpan" id="kobo.775.1">bashdb</span></code><span class="koboSpan" id="kobo.776.1"> from source code. </span><span class="koboSpan" id="kobo.776.2">Don’t fret though, because it’s easy.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.777.1">1. </span><span class="koboSpan" id="kobo.777.2">You’ll first need to install the </span><code class="inlineCode"><span class="koboSpan" id="kobo.778.1">autoconf</span></code><span class="koboSpan" id="kobo.779.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.780.1">texinfo</span></code><span class="koboSpan" id="kobo.781.1"> packages from your normal distro repository, using your distro’s normal package manager.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.782.1">2. </span><span class="koboSpan" id="kobo.782.2">Download the </span><code class="inlineCode"><span class="koboSpan" id="kobo.783.1">bashdb</span></code><span class="koboSpan" id="kobo.784.1"> source code by doing:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.785.1">git clone https://github.com/rocky/bashdb.git
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.786.1">3. </span><code class="inlineCode"><span class="koboSpan" id="kobo.787.1">cd</span></code><span class="koboSpan" id="kobo.788.1"> into the </span><code class="inlineCode"><span class="koboSpan" id="kobo.789.1">bashdb/</span></code><span class="koboSpan" id="kobo.790.1"> directory that the </span><code class="inlineCode"><span class="koboSpan" id="kobo.791.1">git</span></code><span class="koboSpan" id="kobo.792.1"> command created.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.793.1">4. </span><span class="koboSpan" id="kobo.793.2">Run the following set of commands to compile and install </span><code class="inlineCode"><span class="koboSpan" id="kobo.794.1">bashdb</span></code><span class="koboSpan" id="kobo.795.1">:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.796.1">./autogen.sh
./configure
make &amp;&amp; make check
sudo make install
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.797.1">That’s all there is to it.</span></p>
    <h3 id="_idParaDest-461" class="heading 3"><span class="koboSpan" id="kobo.798.1">Installing bashdb on FreeBSD</span></h3>
    <p class="normal"><span class="koboSpan" id="kobo.799.1">This </span><a id="_idIndexMarker1385"/><span class="koboSpan" id="kobo.800.1">is even </span><a id="_idIndexMarker1386"/><span class="koboSpan" id="kobo.801.1">easier. </span><span class="koboSpan" id="kobo.801.2">Just do:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.802.1">sudo pkg install bashdb
</span></code></pre>
    <h3 id="_idParaDest-462" class="heading 3"><span class="koboSpan" id="kobo.803.1">Installing on macOS</span></h3>
    <p class="normal"><span class="koboSpan" id="kobo.804.1">On a</span><a id="_idIndexMarker1387"/><span class="koboSpan" id="kobo.805.1"> Mac with</span><a id="_idIndexMarker1388"/><span class="koboSpan" id="kobo.806.1"> Homebrew installed, just do:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.807.1">brew install bashdb
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.808.1">Now that </span><code class="inlineCode"><span class="koboSpan" id="kobo.809.1">bashdb</span></code><span class="koboSpan" id="kobo.810.1"> is installed, let’s see if we can actually use it.</span></p>
    <h2 id="_idParaDest-463" class="heading 2"><span class="koboSpan" id="kobo.811.1">Debugging a Script with bashdb</span></h2>
    <p class="normal"><span class="koboSpan" id="kobo.812.1">Let’s start with a </span><a id="_idIndexMarker1389"/><span class="koboSpan" id="kobo.813.1">clean, unmodified copy of the original broken </span><code class="inlineCode"><span class="koboSpan" id="kobo.814.1">xdialog</span></code><span class="koboSpan" id="kobo.815.1"> script, which I’ll call </span><code class="inlineCode"><span class="koboSpan" id="kobo.816.1">xdialog-hello2-broken5.sh</span></code><span class="koboSpan" id="kobo.817.1">, which looks like this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.818.1">#!/bin/bash
command -v Xdialog
if [[ -n $DISPLAY ]] &amp;&amp; [[ $? </span><span class="koboSpan" id="kobo.818.2">== 0 ]]; then
        diag=Xdialog
else
        diag=dialog
fi
$diag --title "Dialog message box" \
        --begin 2 2 \
        --msgbox "\nHowdy folks!" </span><span class="koboSpan" id="kobo.818.3">15 50
clear
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.819.1">As you’ve seen in the </span><em class="chapterRef"><span class="koboSpan" id="kobo.820.1">Using xtrace for Debugging</span></em><span class="koboSpan" id="kobo.821.1"> section, the problem is that the script won’t properly detect if both </span><code class="inlineCode"><span class="koboSpan" id="kobo.822.1">Xdialog</span></code><span class="koboSpan" id="kobo.823.1"> and a desktop display are installed. </span><span class="koboSpan" id="kobo.823.2">Let’s step through this with </span><code class="inlineCode"><span class="koboSpan" id="kobo.824.1">bashdb</span></code><span class="koboSpan" id="kobo.825.1"> to see what it can tell us. </span><span class="koboSpan" id="kobo.825.2">Begin like so:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.826.1">donnie@fedora:~$ bashdb ./xdialog-hello2-broken5.sh
bash debugger, bashdb, release 5.2-1.1.2
Copyright 2002-2004, 2006-2012, 2014, 2016-2019, 2021, 2023 Rocky Bernstein
This is free software, covered by the GNU General Public License, and you are
welcome to change it and/or distribute copies of it under certain conditions.
</span><span class="koboSpan" id="kobo.826.2">(/home/donnie/xdialog-hello2-broken5.sh:3):
3:	command -v Xdialog
bashdb&lt;0&gt;
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.827.1">This runs the first </span><a id="_idIndexMarker1390"/><span class="koboSpan" id="kobo.828.1">command in the script, and then dumps us out at the </span><code class="inlineCode"><span class="koboSpan" id="kobo.829.1">bashdb</span></code><span class="koboSpan" id="kobo.830.1"> command prompt. </span><span class="koboSpan" id="kobo.830.2">To run the next command, just enter </span><code class="inlineCode"><span class="koboSpan" id="kobo.831.1">step</span></code><span class="koboSpan" id="kobo.832.1">, like so:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.833.1">. </span><span class="koboSpan" id="kobo.833.2">. </span><span class="koboSpan" id="kobo.833.3">.
</span><span class="koboSpan" id="kobo.833.4">. </span><span class="koboSpan" id="kobo.833.5">. </span><span class="koboSpan" id="kobo.833.6">.
</span><span class="koboSpan" id="kobo.833.7">bashdb&lt;0&gt; step
(/home/donnie/xdialog-hello2-broken5.sh:4):
4:	if [[ -n $DISPLAY ]] &amp;&amp; [[ $? </span><span class="koboSpan" id="kobo.833.8">== 0 ]]; then
bashdb&lt;1&gt;
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.834.1">Here, we see the </span><code class="inlineCode"><span class="koboSpan" id="kobo.835.1">DISPLAY</span></code><span class="koboSpan" id="kobo.836.1"> variable that’s inside the test construct. </span><span class="koboSpan" id="kobo.836.2">Let’s examine that variable to see what its value is, by using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.837.1">examine</span></code><span class="koboSpan" id="kobo.838.1"> command:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.839.1">. </span><span class="koboSpan" id="kobo.839.2">. </span><span class="koboSpan" id="kobo.839.3">.
</span><span class="koboSpan" id="kobo.839.4">. </span><span class="koboSpan" id="kobo.839.5">. </span><span class="koboSpan" id="kobo.839.6">.
</span><span class="koboSpan" id="kobo.839.7">bashdb&lt;1&gt; examine DISPLAY
declare -x DISPLAY=":0"
bashdb&lt;2&gt;
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.840.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.841.1">declare -x</span></code><span class="koboSpan" id="kobo.842.1"> part means that </span><code class="inlineCode"><span class="koboSpan" id="kobo.843.1">bashdb</span></code><span class="koboSpan" id="kobo.844.1"> is marking the </span><code class="inlineCode"><span class="koboSpan" id="kobo.845.1">DISPLAY</span></code><span class="koboSpan" id="kobo.846.1"> variable for export to subsequent commands. </span><span class="koboSpan" id="kobo.846.2">But, that’s not the important part. </span><span class="koboSpan" id="kobo.846.3">What’s important is that the </span><code class="inlineCode"><span class="koboSpan" id="kobo.847.1">DISPLAY</span></code><span class="koboSpan" id="kobo.848.1"> variable has a value of </span><code class="inlineCode"><span class="koboSpan" id="kobo.849.1">:0</span></code><span class="koboSpan" id="kobo.850.1">, which means that the </span><code class="inlineCode"><span class="koboSpan" id="kobo.851.1">[[ -n $DISPLAY ]]</span></code><span class="koboSpan" id="kobo.852.1"> test will return a value of 0 to indicate a true condition.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.853.1">Instead of using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.854.1">examine DISPLAY</span></code><span class="koboSpan" id="kobo.855.1"> command, you can use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.856.1">print $DISPLAY</span></code><span class="koboSpan" id="kobo.857.1"> command, like so:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.858.1">bashdb&lt;1&gt; print $DISPLAY
:0
bashdb&lt;2&gt;
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.859.1">This way, the only thing that shows up is just the actual </span><code class="inlineCode"><span class="koboSpan" id="kobo.860.1">DISPLAY</span></code><span class="koboSpan" id="kobo.861.1"> value.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.862.1">At this point, we need to put on our thinking caps and ponder what it means to have this </span><code class="inlineCode"><span class="koboSpan" id="kobo.863.1">DISPLAY</span></code><span class="koboSpan" id="kobo.864.1"> test come before the </span><code class="inlineCode"><span class="koboSpan" id="kobo.865.1">$?</span></code><span class="koboSpan" id="kobo.866.1"> test. </span><span class="koboSpan" id="kobo.866.2">Well, we’ve already come up with that answer when we used the </span><code class="inlineCode"><span class="koboSpan" id="kobo.867.1">echo</span></code><span class="koboSpan" id="kobo.868.1"> statement and </span><code class="inlineCode"><span class="koboSpan" id="kobo.869.1">xtrace</span></code><span class="koboSpan" id="kobo.870.1"> methods to troubleshoot this. </span><span class="koboSpan" id="kobo.870.2">It’s just that if we do the </span><code class="inlineCode"><span class="koboSpan" id="kobo.871.1">DISPLAY</span></code><span class="koboSpan" id="kobo.872.1"> detection first, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.873.1">$?</span></code><span class="koboSpan" id="kobo.874.1"> value in the second test will always be 0, even if no </span><code class="inlineCode"><span class="koboSpan" id="kobo.875.1">Xdialog</span></code><span class="koboSpan" id="kobo.876.1"> executable is detected. </span><span class="koboSpan" id="kobo.876.2">But, for the sake of showing you a bit more, let’s say that we haven’t figured that out, and need to see more</span><a id="_idIndexMarker1391"/><span class="koboSpan" id="kobo.877.1"> of what the script is doing. </span><span class="koboSpan" id="kobo.877.2">To do that, enter the series of commands that you see in the next snippet:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.878.1">bashdb&lt;2&gt; step
(/home/donnie/xdialog-hello2-broken5.sh:4):
4:	if [[ -n $DISPLAY ]] &amp;&amp; [[ $? </span><span class="koboSpan" id="kobo.878.2">== 0 ]]; then
[[ $? </span><span class="koboSpan" id="kobo.878.3">== 0 ]]
bashdb&lt;3&gt; step
(/home/donnie/xdialog-hello2-broken5.sh:5):
5:	        diag=Xdialog
bashdb&lt;4&gt; print $diag
bashdb&lt;5&gt; step
(/home/donnie/xdialog-hello2-broken5.sh:10):
10:	$diag --title "Dialog message box" \
bashdb&lt;6&gt; print $diag
Xdialog
bashdb&lt;7&gt;
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.879.1">I started this by issuing two </span><code class="inlineCode"><span class="koboSpan" id="kobo.880.1">step</span></code><span class="koboSpan" id="kobo.881.1"> commands, which gets me down to where the </span><code class="inlineCode"><span class="koboSpan" id="kobo.882.1">diag</span></code><span class="koboSpan" id="kobo.883.1"> variable is defined and what its assigned value is. </span><span class="koboSpan" id="kobo.883.2">I then issued the </span><code class="inlineCode"><span class="koboSpan" id="kobo.884.1">print $diag</span></code><span class="koboSpan" id="kobo.885.1"> command, but nothing showed up. </span><span class="koboSpan" id="kobo.885.2">Then, I issued another </span><code class="inlineCode"><span class="koboSpan" id="kobo.886.1">step</span></code><span class="koboSpan" id="kobo.887.1"> command, followed by another </span><code class="inlineCode"><span class="koboSpan" id="kobo.888.1">print $diag</span></code><span class="koboSpan" id="kobo.889.1"> command. </span><span class="koboSpan" id="kobo.889.2">At that point, I finally see that the </span><code class="inlineCode"><span class="koboSpan" id="kobo.890.1">diag</span></code><span class="koboSpan" id="kobo.891.1"> variable has the value of </span><code class="inlineCode"><span class="koboSpan" id="kobo.892.1">Xdialog</span></code><span class="koboSpan" id="kobo.893.1">, even though </span><code class="inlineCode"><span class="koboSpan" id="kobo.894.1">Xdialog</span></code><span class="koboSpan" id="kobo.895.1"> isn’t installed on this workstation.</span></p>
    <div class="note">
      <p class="normal"><span class="koboSpan" id="kobo.896.1">The clear advantage of using </span><code class="inlineCode"><span class="koboSpan" id="kobo.897.1">bashdb</span></code><span class="koboSpan" id="kobo.898.1"> is that I didn’t have to modify the script in order to debug it. </span><span class="koboSpan" id="kobo.898.2">As you see, I didn’t have to add any </span><code class="inlineCode"><span class="koboSpan" id="kobo.899.1">echo</span></code><span class="koboSpan" id="kobo.900.1"> statements to obtain the value of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.901.1">DISPLAY</span></code><span class="koboSpan" id="kobo.902.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.903.1">diag</span></code><span class="koboSpan" id="kobo.904.1"> variables. </span><span class="koboSpan" id="kobo.904.2">I also didn’t have to add a </span><code class="inlineCode"><span class="koboSpan" id="kobo.905.1">sleep</span></code><span class="koboSpan" id="kobo.906.1"> command or comment out the ending </span><code class="inlineCode"><span class="koboSpan" id="kobo.907.1">clear</span></code><span class="koboSpan" id="kobo.908.1"> command in order to prevent the screen from clearing before I could see the </span><code class="inlineCode"><span class="koboSpan" id="kobo.909.1">DISPLAY</span></code><span class="koboSpan" id="kobo.910.1"> value. </span><span class="koboSpan" id="kobo.910.2">Obviously, this is a big win for </span><code class="inlineCode"><span class="koboSpan" id="kobo.911.1">bashdb</span></code><span class="koboSpan" id="kobo.912.1">.</span></p>
    </div>
    <p class="normal"><span class="koboSpan" id="kobo.913.1">Of course, you </span><a id="_idIndexMarker1392"/><span class="koboSpan" id="kobo.914.1">might at times need to find extra information about what you can do with </span><code class="inlineCode"><span class="koboSpan" id="kobo.915.1">bashdb</span></code><span class="koboSpan" id="kobo.916.1">. </span><span class="koboSpan" id="kobo.916.2">Let’s look at that next.</span></p>
    <h2 id="_idParaDest-464" class="heading 2"><span class="koboSpan" id="kobo.917.1">Getting Help with bashdb</span></h2>
    <p class="normal"><span class="koboSpan" id="kobo.918.1">When you install </span><code class="inlineCode"><span class="koboSpan" id="kobo.919.1">bashdb</span></code><span class="koboSpan" id="kobo.920.1">, a man page will get installed with it. </span><span class="koboSpan" id="kobo.920.2">Frankly though, it doesn’t tell you </span><a id="_idIndexMarker1393"/><span class="koboSpan" id="kobo.921.1">much. </span><span class="koboSpan" id="kobo.921.2">Fortunately, </span><code class="inlineCode"><span class="koboSpan" id="kobo.922.1">bashdb</span></code><span class="koboSpan" id="kobo.923.1"> has a built-in help function that you can use any time that you’re at the </span><code class="inlineCode"><span class="koboSpan" id="kobo.924.1">bashdb</span></code><span class="koboSpan" id="kobo.925.1"> command-prompt. </span><span class="koboSpan" id="kobo.925.2">Just enter the </span><code class="inlineCode"><span class="koboSpan" id="kobo.926.1">help</span></code><span class="koboSpan" id="kobo.927.1"> command, and you’ll see this:</span></p>
    <figure class="mediaobject"><span class="koboSpan" id="kobo.928.1"><img src="../Images/B21693_21_02.png" alt=""/></span></figure>
    <p class="packt_figref"><span class="koboSpan" id="kobo.929.1">Figure 21.2: The bashdb help display</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.930.1">This shows the list of available </span><code class="inlineCode"><span class="koboSpan" id="kobo.931.1">bashdb</span></code><span class="koboSpan" id="kobo.932.1"> commands. </span><span class="koboSpan" id="kobo.932.2">To see how to use a particular command, just enter </span><code class="inlineCode"><span class="koboSpan" id="kobo.933.1">help</span></code><span class="koboSpan" id="kobo.934.1"> followed by the command name, like so:</span></p>
    <figure class="mediaobject"><span class="koboSpan" id="kobo.935.1"><img src="../Images/B21693_21_03.png" alt=""/></span></figure>
    <p class="packt_figref"><span class="koboSpan" id="kobo.936.1">Figure 21.3: Getting help for the break command</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.937.1">That about wraps</span><a id="_idIndexMarker1394"/><span class="koboSpan" id="kobo.938.1"> things up for this chapter. </span><span class="koboSpan" id="kobo.938.2">Let’s summarize and move on.</span></p>
    <h1 id="_idParaDest-465" class="heading 1"><span class="koboSpan" id="kobo.939.1">Summary</span></h1>
    <p class="normal"><span class="koboSpan" id="kobo.940.1">In this chapter, we covered some cool tips and tricks that can help you troubleshoot your code. </span><span class="koboSpan" id="kobo.940.2">We began by looking at some common shell scripting errors, and showed how to find them in a broken script. </span><span class="koboSpan" id="kobo.940.3">We then looked at some common debugging tools and techniques. </span><span class="koboSpan" id="kobo.940.4">For the </span><code class="inlineCode"><span class="koboSpan" id="kobo.941.1">-u</span></code><span class="koboSpan" id="kobo.942.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.943.1">-e</span></code><span class="koboSpan" id="kobo.944.1"> shell options, I showed you both the pros and the cons of using them. </span><span class="koboSpan" id="kobo.944.2">Finally, I showed you how to install and use </span><code class="inlineCode"><span class="koboSpan" id="kobo.945.1">bashdb</span></code><span class="koboSpan" id="kobo.946.1">.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.947.1">In the next chapter, we’ll take a brief look at scripting with </span><code class="inlineCode"><span class="koboSpan" id="kobo.948.1">zsh</span></code><span class="koboSpan" id="kobo.949.1">. </span><span class="koboSpan" id="kobo.949.2">I’ll see you there.</span></p>
    <h1 id="_idParaDest-466" class="heading 1"><span class="koboSpan" id="kobo.950.1">Questions</span></h1>
    <p class="normal"><span class="koboSpan" id="kobo.951.1">This time, instead of presenting you with questions to answer, I’ll present you with some buggy shell scripts. </span><span class="koboSpan" id="kobo.951.2">Try running them to observe the errors, and then try to debug them. </span><span class="koboSpan" id="kobo.951.3">Can you debug them? </span><span class="koboSpan" id="kobo.951.4">Sure you can. </span><span class="koboSpan" id="kobo.951.5">I have faith in you.</span></p>
    <ol>
      <li class="numberedList" value="1"><span class="koboSpan" id="kobo.952.1">We’ll start with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.953.1">bug1.sh</span></code><span class="koboSpan" id="kobo.954.1"> script:
        </span><pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.955.1">#!/bin/bash
echo "Fix this script...I've got bugs"
a=45
if [$a -gt 27 ]
then
echo $a
fi
exit
</span></code></pre>
      </li>
      <li class="numberedList"><span class="koboSpan" id="kobo.956.1">Here’s the </span><code class="inlineCode"><span class="koboSpan" id="kobo.957.1">bug2.sh</span></code><span class="koboSpan" id="kobo.958.1"> script:
        </span><pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.959.1">#!/bin/bash
echo "Fix this script...I've got bugs"
for i in 1 2 3 4 5 6 7 8 9
do
echo $i
exit
</span></code></pre>
      </li>
      <li class="numberedList"><span class="koboSpan" id="kobo.960.1">Now, for </span><code class="inlineCode"><span class="koboSpan" id="kobo.961.1">bug3.sh</span></code><span class="koboSpan" id="kobo.962.1">:
        </span><pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.963.1">#!/bin/bash
echo "Fix this script...I've got bugs"
scripts=$(ls | grep [a-z]*.sh)
echo $scripts
exit
</span></code></pre>
      </li>
      <li class="numberedList"><span class="koboSpan" id="kobo.964.1">Here’s the fourth and final, </span><code class="inlineCode"><span class="koboSpan" id="kobo.965.1">bug4.sh</span></code><span class="koboSpan" id="kobo.966.1">:
        </span><pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.967.1">#! </span><span class="koboSpan" id="kobo.967.2">/bin/bash
echo '1 2 3' &gt; sample.data
cut -d' ' -f1,3 sample.data | read x z
echo $((x+z))
</span></code></pre>
      </li>
    </ol>
    <h1 id="_idParaDest-467" class="heading 1"><span class="koboSpan" id="kobo.968.1">Further Reading</span></h1>
    <ul>
      <li class="bulletList"><span class="koboSpan" id="kobo.969.1">Writing Shell Scripts—Lesson 9: Stay Out of Trouble: </span><a href="http://linuxcommand.org/lc3_wss0090.php"><span class="url"><span class="koboSpan" id="kobo.970.1">http://linuxcommand.org/lc3_wss0090.php</span></span></a></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.971.1">How to Debug Bash Scripts: </span><a href="https://linuxconfig.org/how-to-debug-bash-scripts"><span class="url"><span class="koboSpan" id="kobo.972.1">https://linuxconfig.org/how-to-debug-bash-scripts</span></span></a></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.973.1">15 Essential Bash Debugging Techniques and Tools: </span><a href="https://www.fosslinux.com/104144/essential-bash-debugging-techniques-and-tools.htm"><span class="url"><span class="koboSpan" id="kobo.974.1">https://www.fosslinux.com/104144/essential-bash-debugging-techniques-and-tools.htm</span></span></a></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.975.1">Debugging a Bash Script: </span><a href="https://www.baeldung.com/linux/debug-bash-script"><span class="url"><span class="koboSpan" id="kobo.976.1">https://www.baeldung.com/linux/debug-bash-script</span></span></a></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.977.1">5 Simple Steps On How to Debug a Bash Shell Script: </span><a href="https://www.shell-tips.com/bash/debug-script/#gsc.tab=0"><span class="url"><span class="koboSpan" id="kobo.978.1">https://www.shell-tips.com/bash/debug-script/#gsc.tab=0</span></span></a></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.979.1">Filenames and Pathnames in Shell: How to do it Correctly:</span></li>
      <li class="bulletList"><a href="https://dwheeler.com/essays/filenames-in-shell.html"><span class="url"><span class="koboSpan" id="kobo.980.1">https://dwheeler.com/essays/filenames-in-shell.html</span></span></a></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.981.1">Common Shell Script Mistakes:</span></li>
      <li class="bulletList"><a href="https://www.pixelbeat.org/programming/shell_script_mistakes.html"><span class="url"><span class="koboSpan" id="kobo.982.1">https://www.pixelbeat.org/programming/shell_script_mistakes.html</span></span></a></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.983.1">BashPitfalls:</span></li>
      <li class="bulletList"><a href="http://mywiki.wooledge.org/BashPitfalls "><span class="url"><span class="koboSpan" id="kobo.984.1">http://mywiki.wooledge.org/BashPitfalls</span></span></a></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.985.1">Debugging your shell scripts with bashdb: </span><a href="https://www.linux.com/news/debug-your-shell-scripts-bashdb/"><span class="url"><span class="koboSpan" id="kobo.986.1">https://www.linux.com/news/debug-your-shell-scripts-bashdb/</span></span></a></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.987.1">Debugging bash scripts with the bashdb debugger: </span><a href="https://dafoster.net/articles/2023/02/22/debugging-bash-scripts-with-the-bashdb-debugger/"><span class="url"><span class="koboSpan" id="kobo.988.1">https://dafoster.net/articles/2023/02/22/debugging-bash-scripts-with-the-bashdb-debugger/</span></span></a></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.989.1">Using BashDB to Debug Your Shell Scripts—YouTube: </span><a href="https://www.youtube.com/watch?v=jbOQJDSTksA"><span class="url"><span class="koboSpan" id="kobo.990.1">https://www.youtube.com/watch?v=jbOQJDSTksA</span></span></a></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.991.1">BASH Debugger documentation: </span><a href="https://bashdb.sourceforge.net/bashdb.html"><span class="url"><span class="koboSpan" id="kobo.992.1">https://bashdb.sourceforge.net/bashdb.html</span></span></a></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.993.1">The Bash Trap Trap: </span><a href="https://medium.com/@dirk.avery/the-bash-trap-trap-ce6083f36700"><span class="url"><span class="koboSpan" id="kobo.994.1">https://medium.com/@dirk.avery/the-bash-trap-trap-ce6083f36700</span></span></a></li>
    </ul>
    <h1 id="_idParaDest-468" class="heading 1"><span class="koboSpan" id="kobo.995.1">Answers</span></h1>
    <ol>
      <li class="numberedList" value="1"><span class="koboSpan" id="kobo.996.1">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.997.1">if</span></code><span class="koboSpan" id="kobo.998.1"> statement, you need to insert a blank space between the </span><code class="inlineCode"><span class="koboSpan" id="kobo.999.1">[</span></code><span class="koboSpan" id="kobo.1000.1"> and the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1001.1">$a</span></code><span class="koboSpan" id="kobo.1002.1">.</span></li>
      <li class="numberedList"><span class="koboSpan" id="kobo.1003.1">You need to place a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1004.1">done</span></code><span class="koboSpan" id="kobo.1005.1"> statement after the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1006.1">echo $i</span></code><span class="koboSpan" id="kobo.1007.1"> statement.</span></li>
      <li class="numberedList"><span class="koboSpan" id="kobo.1008.1">There are a couple of problems with this script. </span><span class="koboSpan" id="kobo.1008.2">First, the regular expression is set up wrong, which causes you to get either no or incorrect output from this script. </span><span class="koboSpan" id="kobo.1008.3">Instead of</span></li>
    </ol>
    <p class="normal one"><code class="inlineCode"><span class="koboSpan" id="kobo.1009.1">[a-z]*.sh</span></code><span class="koboSpan" id="kobo.1010.1">, it should be </span><code class="inlineCode"><span class="koboSpan" id="kobo.1011.1">[a-z].sh</span></code><span class="koboSpan" id="kobo.1012.1">. </span><span class="koboSpan" id="kobo.1012.2">(The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1013.1">*</span></code><span class="koboSpan" id="kobo.1014.1"> actually isn’t needed for this.)</span></p>
    <div class="note one">
      <p class="normal"><span class="koboSpan" id="kobo.1015.1">You can review the concept of regular expressions in </span><em class="chapterRef"><span class="koboSpan" id="kobo.1016.1">Chapter 9—Filtering Text with grep, sed, and Regular Expressions</span></em><span class="koboSpan" id="kobo.1017.1">.</span></p>
    </div>
    <p class="normal one"><span class="koboSpan" id="kobo.1018.1">There’s also the fact this regular expression isn’t doing much for us. </span><span class="koboSpan" id="kobo.1018.2">Unless you have scripts with filenames that consist of nothing but either digits or upper-case characters, this </span><code class="inlineCode"><span class="koboSpan" id="kobo.1019.1">grep</span></code><span class="koboSpan" id="kobo.1020.1"> command is going to show you all of the scripts in your directory. </span><span class="koboSpan" id="kobo.1020.2">So, you could probably just omit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1021.1">grep</span></code><span class="koboSpan" id="kobo.1022.1"> command altogether, and go with a simple </span><code class="inlineCode"><span class="koboSpan" id="kobo.1023.1">ls *.sh</span></code><span class="koboSpan" id="kobo.1024.1"> command.</span></p>
    <p class="normal one"><span class="koboSpan" id="kobo.1025.1">Finally, in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1026.1">echo</span></code><span class="koboSpan" id="kobo.1027.1"> statement, you need to surround the variable with a pair of double quotes, like this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.1028.1">echo "$scripts"
</span></code></pre>
    <p class="normal one"><span class="koboSpan" id="kobo.1029.1">This will prevent problems with filenames that have blank spaces in them.</span></p>
    <ol>
      <li class="numberedList" value="4"><span class="koboSpan" id="kobo.1030.1">This script is supposed to take values from the first and third field of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1031.1">sample.data</span></code><span class="koboSpan" id="kobo.1032.1"> file that the script created, and add them together. </span><span class="koboSpan" id="kobo.1032.2">The values of the first and third fields are 1 and 3, so the sum of the two should be 4. </span><span class="koboSpan" id="kobo.1032.3">However, here’s how it looks when you run it:
        </span><pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.1033.1">donnie@fedora:~$ ./bug4.sh
0
donnie@fedora:~$
</span></code></pre>
      </li>
    </ol>
    <p class="normal one"><span class="koboSpan" id="kobo.1034.1">The problem is that the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1035.1">cut</span></code><span class="koboSpan" id="kobo.1036.1"> command on line 3 is piping its output into the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1037.1">read</span></code><span class="koboSpan" id="kobo.1038.1"> command. </span><span class="koboSpan" id="kobo.1038.2">The problem with that is that the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1039.1">read</span></code><span class="koboSpan" id="kobo.1040.1"> command is built into the shell, instead of having its own executable file. </span></p>
    <p class="normal one"><span class="koboSpan" id="kobo.1041.1">That’s significant, because you can only pipe output of one command into a command that has its own executable. </span><span class="koboSpan" id="kobo.1041.2">So, you can’t pipe output into a command that’s a shell builtin.</span></p>
    <p class="normal one"><span class="koboSpan" id="kobo.1042.1">Instead of using a pipe, you can instead send the first and third field values to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1043.1">tmp.data</span></code><span class="koboSpan" id="kobo.1044.1"> file, and then use the input redirector to obtain the input from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1045.1">tmp.data</span></code><span class="koboSpan" id="kobo.1046.1"> file, as you see here in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1047.1">bug5.sh</span></code><span class="koboSpan" id="kobo.1048.1"> script:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.1049.1">#! </span><span class="koboSpan" id="kobo.1049.2">/bin/bash
echo '1 2 3' &gt; sample.data
cut -d' ' -f1,3 sample.data &gt; tmp.data
read x z &lt; tmp.data
echo $((x+z))
</span></code></pre>
    <p class="normal one"><span class="koboSpan" id="kobo.1050.1">Another option would be to use a </span><em class="italic"><span class="koboSpan" id="kobo.1051.1">here</span></em><span class="koboSpan" id="kobo.1052.1"> document, as you see in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1053.1">bug6.sh</span></code><span class="koboSpan" id="kobo.1054.1"> script:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.1055.1">#! </span><span class="koboSpan" id="kobo.1055.2">/bin/bash
echo '1 2 3' &gt; sample.data
read -r x z &lt;&lt;&lt;$(cut -d' ' -f1,3 sample.data)
echo $((x+z))
</span></code></pre>
    <p class="normal one"><span class="koboSpan" id="kobo.1056.1">Either way, you’ll now see the correct results:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.1057.1">donnie@fedora:~$ ./bug5.sh
4
</span><span class="Hyperlink"><span class="koboSpan" id="kobo.1058.1">donnie@fedora</span></span><span class="koboSpan" id="kobo.1059.1">:~$ ./bug6.sh
4
donnie@fedora:~$
</span></code></pre>
    <h1 id="_idParaDest-469" class="heading 1"><span class="koboSpan" id="kobo.1060.1">Join our community on Discord!</span></h1>
    <p class="normal"><span class="koboSpan" id="kobo.1061.1">Read this book alongside other users, Linux experts, and the author himself. </span></p>
    <p class="normal"><span class="koboSpan" id="kobo.1062.1">Ask questions, provide solutions to other readers, chat with the author via Ask Me Anything sessions, and much more. </span><span class="koboSpan" id="kobo.1062.2">Scan the QR code or visit the link to join the community.</span></p>
    <p class="normal"><a href="https://packt.link/SecNet"><span class="url"><span class="koboSpan" id="kobo.1063.1">https://packt.link/SecNet</span></span></a></p>
    <p class="normal"><span class="koboSpan" id="kobo.1064.1"><img src="../Images/QR_Code10596186092701843.png" alt=""/></span></p>
  </div>
</body></html>