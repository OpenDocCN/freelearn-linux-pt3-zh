<html><head></head><body>
<div id="_idContainer056">
<h1 class="chapter-number" id="_idParaDest-61"><a id="_idTextAnchor089"/><span class="koboSpan" id="kobo.1.1">6</span></h1>
<h1 id="_idParaDest-62"><a id="_idTextAnchor090"/><span class="koboSpan" id="kobo.2.1">Detailing the Temporary Build Directory</span></h1>
<p><span class="koboSpan" id="kobo.3.1">In this chapter, we will try to understand the contents of the temporary build directory after image generation and see how BitBake uses it in the baking process. </span><span class="koboSpan" id="kobo.3.2">In addition, we will learn how some of these directories can assist us by acting as a valuable source of information when things do not work </span><span class="No-Break"><span class="koboSpan" id="kobo.4.1">as expected.</span></span></p>
<h1 id="_idParaDest-63"><a id="_idTextAnchor091"/><span class="koboSpan" id="kobo.5.1">Detailing the build directory</span></h1>
<p><span class="koboSpan" id="kobo.6.1">The build directory is a </span><a id="_idIndexMarker131"/><span class="koboSpan" id="kobo.7.1">central information and artifact source for every Poky user. </span><span class="koboSpan" id="kobo.7.2">Its main directories are </span><span class="No-Break"><span class="koboSpan" id="kobo.8.1">as follows:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.9.1">conf</span></strong><span class="koboSpan" id="kobo.10.1">: This contains the configuration files we use to control Poky and BitBake. </span><span class="koboSpan" id="kobo.10.2">We first used this directory in </span><a href="B19361_02.xhtml#_idTextAnchor031"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.11.1">Chapter 2</span></em></span></a><span class="koboSpan" id="kobo.12.1">, </span><em class="italic"><span class="koboSpan" id="kobo.13.1">Baking Our Poky-Based System</span></em><span class="koboSpan" id="kobo.14.1">. </span><span class="koboSpan" id="kobo.14.2">It stores configuration files, such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.15.1">build/conf/local.conf</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.16.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.17.1">build/conf/bblayers.conf</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.18.1">.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.19.1">downloads</span></strong><span class="koboSpan" id="kobo.20.1">: This stores all the downloaded artifacts. </span><span class="koboSpan" id="kobo.20.2">It works as a download cache. </span><span class="koboSpan" id="kobo.20.3">We talked about it in detail in </span><a href="B19361_05.xhtml#_idTextAnchor077"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.21.1">Chapter 5</span></em></span></a><span class="koboSpan" id="kobo.22.1">, </span><em class="italic"><span class="koboSpan" id="kobo.23.1">Grasping the </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.24.1">BitBake Tool</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.25.1">.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.26.1">sstate-cache</span></strong><span class="koboSpan" id="kobo.27.1">: This contains the snapshots of the packaged data. </span><span class="koboSpan" id="kobo.27.2">It is a cache mainly used to speed up the future build process, as it is used as a cache for the building process. </span><span class="koboSpan" id="kobo.27.3">This folder is detailed in </span><a href="B19361_07.xhtml#_idTextAnchor097"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.28.1">Chapter 7</span></em></span></a><span class="koboSpan" id="kobo.29.1">, </span><em class="italic"><span class="koboSpan" id="kobo.30.1">Assimilating </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.31.1">Packaging Support</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.32.1">.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.33.1">tmp</span></strong><span class="koboSpan" id="kobo.34.1">: This is the temporary build directory and the main focus of </span><span class="No-Break"><span class="koboSpan" id="kobo.35.1">this chapter.</span></span></li>
</ul>
<h1 id="_idParaDest-64"><a id="_idTextAnchor092"/><span class="koboSpan" id="kobo.36.1">Constructing the build directory</span></h1>
<p><span class="koboSpan" id="kobo.37.1">In the previous chapters, we learned about Poky’s inputs and outputs in abstract high-level detail. </span><span class="koboSpan" id="kobo.37.2">We already </span><a id="_idIndexMarker132"/><span class="koboSpan" id="kobo.38.1">know that BitBake uses metadata to generate different types of artifacts, including images. </span><span class="koboSpan" id="kobo.38.2">Besides the generated artifacts, BitBake creates other content during this process, which may be used in several ways, dependent on </span><span class="No-Break"><span class="koboSpan" id="kobo.39.1">our goals.</span></span></p>
<p><span class="koboSpan" id="kobo.40.1">BitBake performs several tasks and continuously modifies the build directory during the build process. </span><span class="koboSpan" id="kobo.40.2">Therefore, we can understand it better by following the usual BitBake execution flow, </span><span class="No-Break"><span class="koboSpan" id="kobo.41.1">as follows:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.42.1">Fetching</span></strong><span class="koboSpan" id="kobo.43.1">: The first </span><a id="_idIndexMarker133"/><span class="koboSpan" id="kobo.44.1">action executed by BitBake is to download the source code. </span><span class="koboSpan" id="kobo.44.2">This step may modify the build directory as it tries to use the cached downloaded copy of the source code or performs the download and stores it inside the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.45.1">build/download</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.46.1"> directory.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.47.1">Source preparation</span></strong><span class="koboSpan" id="kobo.48.1">: After completing the source code fetching, it must be prepared; for example, the unpacking of a tarball or a clone of a locally cached Git directory (from the download cache). </span><span class="koboSpan" id="kobo.48.2">This preparation happens in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.49.1">build/tmp/work</span></strong><span class="koboSpan" id="kobo.50.1"> directory. </span><span class="koboSpan" id="kobo.50.2">When the source code is ready, the required modifications are applied (for example, applying necessary patches and checking out the correct </span><span class="No-Break"><span class="koboSpan" id="kobo.51.1">Git revision).</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.52.1">Configuration and building</span></strong><span class="koboSpan" id="kobo.53.1">: The building process starts with the </span><em class="italic"><span class="koboSpan" id="kobo.54.1">ready-to-use</span></em><span class="koboSpan" id="kobo.55.1"> source code. </span><span class="koboSpan" id="kobo.55.2">It involves the configuration of build options (for example, </span><strong class="source-inline"><span class="koboSpan" id="kobo.56.1">./configure</span></strong><span class="koboSpan" id="kobo.57.1">) and building (for </span><span class="No-Break"><span class="koboSpan" id="kobo.58.1">example, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.59.1">make</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.60.1">).</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.61.1">Installing</span></strong><span class="koboSpan" id="kobo.62.1">: The built artifacts are then installed (for example, </span><strong class="source-inline"><span class="koboSpan" id="kobo.63.1">make install</span></strong><span class="koboSpan" id="kobo.64.1">) in a staging directory </span><span class="No-Break"><span class="koboSpan" id="kobo.65.1">under </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.66.1">build/tmp/work/&lt;...&gt;/image</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.67.1">.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.68.1">Wrapping the sysroot</span></strong><span class="koboSpan" id="kobo.69.1">: The artifacts required for cross-compilation, such as libraries, headers, and other files, are copied and sometimes modified to </span><strong class="source-inline"><span class="koboSpan" id="kobo.70.1">build/tmp/work/&lt;...&gt;/recipe-sysroot</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.71.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.72.1">build/tmp/work/&lt;...&gt;/recipe-sysroot-native</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.73.1">.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.74.1">Creating the packages</span></strong><span class="koboSpan" id="kobo.75.1">: The packages are generated using the installed contents, potentially </span><a id="_idIndexMarker134"/><span class="koboSpan" id="kobo.76.1">splitting this content across multiple packages, which can be provided in different formats, for example, </span><strong class="source-inline"><span class="koboSpan" id="kobo.77.1">.rpm</span></strong><span class="koboSpan" id="kobo.78.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.79.1">.ipk</span></strong><span class="koboSpan" id="kobo.80.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.81.1">.deb</span></strong><span class="koboSpan" id="kobo.82.1">, </span><span class="No-Break"><span class="koboSpan" id="kobo.83.1">or </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.84.1">.tar</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.85.1">.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.86.1">Quality Assurance (QA) checks</span></strong><span class="koboSpan" id="kobo.87.1">: When building a recipe, the build system performs </span><a id="_idIndexMarker135"/><span class="koboSpan" id="kobo.88.1">various QA checks on the output to ensure that common issues are detected </span><span class="No-Break"><span class="koboSpan" id="kobo.89.1">and reported.</span></span></li>
</ul>
<h1 id="_idParaDest-65"><a id="_idTextAnchor093"/><span class="koboSpan" id="kobo.90.1">Exploring the temporary build directory</span></h1>
<p><span class="koboSpan" id="kobo.91.1">Understanding </span><a id="_idIndexMarker136"/><span class="koboSpan" id="kobo.92.1">the temporary build directory (</span><strong class="source-inline"><span class="koboSpan" id="kobo.93.1">build/tmp</span></strong><span class="koboSpan" id="kobo.94.1">) is critical. </span><span class="koboSpan" id="kobo.94.2">The temporary build directory is created just after the build starts, and it’s essential for helping us identify why something didn’t behave </span><span class="No-Break"><span class="koboSpan" id="kobo.95.1">as expected.</span></span></p>
<p><span class="koboSpan" id="kobo.96.1">The following figure shows the contents of the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.97.1">build/tmp</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.98.1"> directory:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer050">
<span class="koboSpan" id="kobo.99.1"><img alt="Figure 6.1 – Contents of build/tmp" src="image/Figure_6.1_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.100.1">Figure 6.1 – Contents of build/tmp</span></p>
<p><span class="koboSpan" id="kobo.101.1">The most critical directories found within it are </span><span class="No-Break"><span class="koboSpan" id="kobo.102.1">as follows:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.103.1">deploy</span></strong><span class="koboSpan" id="kobo.104.1">: This contains the build products, such as images, binary packages, and </span><span class="No-Break"><span class="koboSpan" id="kobo.105.1">SDK installers.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.106.1">sysroots-components</span></strong><span class="koboSpan" id="kobo.107.1">: This contains a representation of </span><strong class="source-inline"><span class="koboSpan" id="kobo.108.1">recipes-sysroot</span></strong><span class="koboSpan" id="kobo.109.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.110.1">recipes-sysroot-native</span></strong><span class="koboSpan" id="kobo.111.1">, which allows BitBake to know where each component is installed. </span><span class="koboSpan" id="kobo.111.2">This is used to create recipe-specific </span><strong class="source-inline"><span class="koboSpan" id="kobo.112.1">sysroots</span></strong><span class="koboSpan" id="kobo.113.1"> during </span><span class="No-Break"><span class="koboSpan" id="kobo.114.1">the build.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.115.1">sysroots-uninative</span></strong><span class="koboSpan" id="kobo.116.1">: This includes </span><strong class="source-inline"><span class="koboSpan" id="kobo.117.1">glibc</span></strong><span class="koboSpan" id="kobo.118.1"> (a C library), which is used when native utilities are generated. </span><span class="koboSpan" id="kobo.118.2">This, in turn, improves the reuse of shared state artifacts across different </span><span class="No-Break"><span class="koboSpan" id="kobo.119.1">host distributions.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.120.1">work</span></strong><span class="koboSpan" id="kobo.121.1">: This contains </span><a id="_idIndexMarker137"/><span class="koboSpan" id="kobo.122.1">the working source code, a task’s configuration, execution logs, and the contents of </span><span class="No-Break"><span class="koboSpan" id="kobo.123.1">generated packages.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.124.1">work-shared</span></strong><span class="koboSpan" id="kobo.125.1">: This is a </span><strong class="source-inline"><span class="koboSpan" id="kobo.126.1">work</span></strong><span class="koboSpan" id="kobo.127.1"> directory used for sharing the source code with multiple recipes. </span><strong class="source-inline"><span class="koboSpan" id="kobo.128.1">work-shared</span></strong><span class="koboSpan" id="kobo.129.1"> is only used by a subset of recipes, for example, </span><strong class="source-inline"><span class="koboSpan" id="kobo.130.1">linux-yocto</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.131.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.132.1">gcc</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.133.1">.</span></span></li>
</ul>
<h1 id="_idParaDest-66"><a id="_idTextAnchor094"/><span class="koboSpan" id="kobo.134.1">Understanding the work directory</span></h1>
<p><span class="koboSpan" id="kobo.135.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.136.1">build/tmp/work</span></strong><span class="koboSpan" id="kobo.137.1"> directory is </span><a id="_idIndexMarker138"/><span class="koboSpan" id="kobo.138.1">organized by architecture. </span><span class="koboSpan" id="kobo.138.2">For example, when working with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.139.1">qemux86-64</span></strong><span class="koboSpan" id="kobo.140.1"> machine, we have the following </span><span class="No-Break"><span class="koboSpan" id="kobo.141.1">four directories:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer051">
<span class="koboSpan" id="kobo.142.1"><img alt="Figure 6.2 – The contents of the build/tmp/work directory" src="image/Figure_6.2_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.143.1">Figure 6.2 – The contents of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.144.1">build/tmp/work</span></strong><span class="koboSpan" id="kobo.145.1"> directory</span></p>
<p><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.146.1">Figure 6</span></em></span><em class="italic"><span class="koboSpan" id="kobo.147.1">.2</span></em><span class="koboSpan" id="kobo.148.1"> shows an example of possible directories under </span><strong class="source-inline"><span class="koboSpan" id="kobo.149.1">build/tmp/work</span></strong><span class="koboSpan" id="kobo.150.1"> for an </span><strong class="source-inline"><span class="koboSpan" id="kobo.151.1">x86-64</span></strong><span class="koboSpan" id="kobo.152.1"> host and a </span><strong class="source-inline"><span class="koboSpan" id="kobo.153.1">qemux86-64</span></strong><span class="koboSpan" id="kobo.154.1"> target. </span><span class="koboSpan" id="kobo.154.2">They are architecture- and machine-dependent, </span><span class="No-Break"><span class="koboSpan" id="kobo.155.1">as follows:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.156.1">all-poky-linux</span></strong><span class="koboSpan" id="kobo.157.1">: This directory contains the working build directories for the architecture-agnostic packages. </span><span class="koboSpan" id="kobo.157.2">These are mostly scripts or interpreted language-based packages, for example, Perl scripts and </span><span class="No-Break"><span class="koboSpan" id="kobo.158.1">Python scripts.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.159.1">core2-64-poky-linux</span></strong><span class="koboSpan" id="kobo.160.1">: This directory contains the working build directories for the packages common to </span><strong class="source-inline"><span class="koboSpan" id="kobo.161.1">x86-64</span></strong><span class="koboSpan" id="kobo.162.1">-based targets using the optimization tuned </span><span class="No-Break"><span class="koboSpan" id="kobo.163.1">for </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.164.1">core2-64</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.165.1">.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.166.1">qemux86_64-poky-linux</span></strong><span class="koboSpan" id="kobo.167.1">: This directory contains the working build directories for packages specific to the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.168.1">qemux86-64</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.169.1"> machine.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.170.1">x86_64-linux</span></strong><span class="koboSpan" id="kobo.171.1">: This directory holds the working build directories for the packages that are targeted to run on the build </span><span class="No-Break"><span class="koboSpan" id="kobo.172.1">host machine.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.173.1">This componentized structure is necessary to allow building system images and packages for multiple </span><a id="_idIndexMarker139"/><span class="koboSpan" id="kobo.174.1">machines and architectures within one </span><strong class="source-inline"><span class="koboSpan" id="kobo.175.1">build</span></strong><span class="koboSpan" id="kobo.176.1"> directory without conflicts. </span><span class="koboSpan" id="kobo.176.2">The target machine we will use </span><span class="No-Break"><span class="koboSpan" id="kobo.177.1">is </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.178.1">qemux86-64</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.179.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.180.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.181.1">build/tmp/work</span></strong><span class="koboSpan" id="kobo.182.1"> directory is useful when checking for misbehavior or building failures. </span><span class="koboSpan" id="kobo.182.2">Its contents are organized in sub-directories following </span><span class="No-Break"><span class="koboSpan" id="kobo.183.1">this pattern:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer052">
<span class="koboSpan" id="kobo.184.1"><img alt="Figure 6.3 – The pattern used in sub-directories of the build/tmp/work directory" src="image/Figure_6.3_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.185.1">Figure 6.3 – The pattern used in sub-directories of the build/tmp/work directory</span></p>
<p><span class="koboSpan" id="kobo.186.1">Some of the directories under the tree shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.187.1">Figure 6</span></em></span><em class="italic"><span class="koboSpan" id="kobo.188.1">.3</span></em><span class="koboSpan" id="kobo.189.1"> are </span><span class="No-Break"><span class="koboSpan" id="kobo.190.1">as follows:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.191.1">&lt;sources&gt;</span></strong><span class="koboSpan" id="kobo.192.1">: This is extracted source code of the software to be built. </span><span class="koboSpan" id="kobo.192.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.193.1">WORKDIR</span></strong><span class="koboSpan" id="kobo.194.1"> variable points to </span><span class="No-Break"><span class="koboSpan" id="kobo.195.1">this directory.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.196.1">image</span></strong><span class="koboSpan" id="kobo.197.1">: This contains the files installed by </span><span class="No-Break"><span class="koboSpan" id="kobo.198.1">the recipe.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.199.1">package</span></strong><span class="koboSpan" id="kobo.200.1">: The extracted contents of output packages are </span><span class="No-Break"><span class="koboSpan" id="kobo.201.1">stored here.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.202.1">packages-split</span></strong><span class="koboSpan" id="kobo.203.1">: The contents of output packages, extracted and split into sub-directories, are </span><span class="No-Break"><span class="koboSpan" id="kobo.204.1">stored here.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.205.1">temp</span></strong><span class="koboSpan" id="kobo.206.1">: This stores BitBake’s task code and </span><span class="No-Break"><span class="koboSpan" id="kobo.207.1">execution logs.</span></span></li>
</ul>
<p class="callout-heading"><span class="koboSpan" id="kobo.208.1">Tip</span></p>
<p class="callout"><span class="koboSpan" id="kobo.209.1">We can automatically remove the </span><strong class="source-inline"><span class="koboSpan" id="kobo.210.1">work</span></strong><span class="koboSpan" id="kobo.211.1"> directory after each recipe compilation cycle to reduce disk usage, adding </span><strong class="source-inline"><span class="koboSpan" id="kobo.212.1">INHERIT += "rm_work"</span></strong><span class="koboSpan" id="kobo.213.1"> in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.214.1">build/conf/local.conf</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.215.1"> file.</span></span></p>
<p><span class="koboSpan" id="kobo.216.1">The structure of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.217.1">work</span></strong><span class="koboSpan" id="kobo.218.1"> directory is the same for all architectures. </span><span class="koboSpan" id="kobo.218.2">For every recipe, a directory with the </span><a id="_idIndexMarker140"/><span class="koboSpan" id="kobo.219.1">recipe name is created. </span><span class="koboSpan" id="kobo.219.2">Taking the machine-specific </span><strong class="source-inline"><span class="koboSpan" id="kobo.220.1">work</span></strong><span class="koboSpan" id="kobo.221.1"> directory and using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.222.1">sysvinit-inittab</span></strong><span class="koboSpan" id="kobo.223.1"> recipe as an example, we see </span><span class="No-Break"><span class="koboSpan" id="kobo.224.1">the following:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer053">
<span class="koboSpan" id="kobo.225.1"><img alt="Figure 6.4 – Content of build/tmp/work/core2-64-poky-linux/pm-utils/1.4.1-r1/" src="image/Figure_6.4_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.226.1">Figure 6.4 – Content of build/tmp/work/core2-64-poky-linux/pm-utils/1.4.1-r1/</span></p>
<p><span class="koboSpan" id="kobo.227.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.228.1">sysvinit-inittab</span></strong><span class="koboSpan" id="kobo.229.1"> recipe is an excellent example, as it is machine-specific. </span><span class="koboSpan" id="kobo.229.2">This recipe contains the </span><strong class="source-inline"><span class="koboSpan" id="kobo.230.1">inittab</span></strong><span class="koboSpan" id="kobo.231.1"> file that defines the serial console to spawn the login process, which varies from machine </span><span class="No-Break"><span class="koboSpan" id="kobo.232.1">to machine.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.233.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.234.1">The build system uses the directories shown in the preceding figure that are not detailed here. </span><span class="koboSpan" id="kobo.234.2">Therefore, you should not need to work with them, except if you are working on build </span><span class="No-Break"><span class="koboSpan" id="kobo.235.1">tool development.</span></span></p>
<p><span class="koboSpan" id="kobo.236.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.237.1">work</span></strong><span class="koboSpan" id="kobo.238.1"> directory is </span><a id="_idIndexMarker141"/><span class="koboSpan" id="kobo.239.1">handy for debugging purposes; we cover this in </span><a href="B19361_10.xhtml#_idTextAnchor129"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.240.1">Chapter 10</span></em></span></a><span class="koboSpan" id="kobo.241.1">, </span><em class="italic"><span class="koboSpan" id="kobo.242.1">Debugging with the </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.243.1">Yocto Project</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.244.1">.</span></span></p>
<h1 id="_idParaDest-67"><a id="_idTextAnchor095"/><span class="koboSpan" id="kobo.245.1">Understanding the sysroot directories</span></h1>
<p><span class="koboSpan" id="kobo.246.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.247.1">sysroot</span></strong><span class="koboSpan" id="kobo.248.1"> directory plays </span><a id="_idIndexMarker142"/><span class="koboSpan" id="kobo.249.1">a critical role in the Yocto Project. </span><span class="koboSpan" id="kobo.249.2">It creates an individual and isolated environment for each recipe. </span><span class="koboSpan" id="kobo.249.3">This environment, set for each recipe, is essential to ensure reproducibility and avoid contamination with the host </span><span class="No-Break"><span class="koboSpan" id="kobo.250.1">machine’s packages.</span></span></p>
<p><span class="koboSpan" id="kobo.251.1">After we build the </span><strong class="source-inline"><span class="koboSpan" id="kobo.252.1">procps</span></strong><span class="koboSpan" id="kobo.253.1"> recipe, version </span><strong class="source-inline"><span class="koboSpan" id="kobo.254.1">3.3.17</span></strong><span class="koboSpan" id="kobo.255.1">, we get two sets of </span><strong class="source-inline"><span class="koboSpan" id="kobo.256.1">sysroot</span></strong><span class="koboSpan" id="kobo.257.1"> directories – </span><strong class="source-inline"><span class="koboSpan" id="kobo.258.1">recipes-sysroot</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.259.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.260.1">recipes-sysroot-native</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.261.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.262.1">Inside each </span><strong class="source-inline"><span class="koboSpan" id="kobo.263.1">sysroot</span></strong><span class="koboSpan" id="kobo.264.1"> set, there is a sub-directory called </span><strong class="source-inline"><span class="koboSpan" id="kobo.265.1">sysroot-provides</span></strong><span class="koboSpan" id="kobo.266.1">. </span><span class="koboSpan" id="kobo.266.2">This directory lists the packages installed on each respective </span><strong class="source-inline"><span class="koboSpan" id="kobo.267.1">sysroot</span></strong><span class="koboSpan" id="kobo.268.1">. </span><span class="koboSpan" id="kobo.268.2">Following is the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.269.1">recipe-sysroot</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.270.1"> directory:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer054">
<span class="koboSpan" id="kobo.271.1"><img alt="Figure 6.5 – Content of the recipe-sysroot directory under build/tmp/work for recipe procps" src="image/Figure_6.5_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.272.1">Figure 6.5 – Content of the recipe-sysroot directory under build/tmp/work for recipe procps</span></p>
<p><span class="koboSpan" id="kobo.273.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.274.1">recipe-sysroot-native</span></strong><span class="koboSpan" id="kobo.275.1"> directory includes the build dependencies used on the host system during the build process. </span><span class="koboSpan" id="kobo.275.2">It encompasses the compiler, linker, tools, and more. </span><span class="koboSpan" id="kobo.275.3">At the same </span><a id="_idIndexMarker143"/><span class="koboSpan" id="kobo.276.1">time, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.277.1">recipe-sysroot</span></strong><span class="koboSpan" id="kobo.278.1"> directory has the libraries and headers used in the target code. </span><span class="koboSpan" id="kobo.278.2">The following figure shows the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.279.1">recipe-sysroot-native</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.280.1"> directory:</span></span></p>
<p class="IMG---Figure"> </p>
<div>
<div class="IMG---Figure" id="_idContainer055">
<span class="koboSpan" id="kobo.281.1"><img alt="Figure 6.6 – Content of the recipe-sysroot-native directory under build/tmp/work for recipe procps" src="image/Figure_6.6_B19361.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.282.1">Figure 6.6 – Content of the recipe-sysroot-native directory under build/tmp/work for recipe procps</span></p>
<p><span class="koboSpan" id="kobo.283.1">When we see a missing </span><a id="_idIndexMarker144"/><span class="koboSpan" id="kobo.284.1">header or a link failure, we must double-check whether our </span><strong class="source-inline"><span class="koboSpan" id="kobo.285.1">sysroot</span></strong><span class="koboSpan" id="kobo.286.1"> directory (target and host) contents </span><span class="No-Break"><span class="koboSpan" id="kobo.287.1">are correct.</span></span></p>
<h1 id="_idParaDest-68"><a id="_idTextAnchor096"/><span class="koboSpan" id="kobo.288.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.289.1">In this chapter, we explored the contents of the temporary build directory after image generation. </span><span class="koboSpan" id="kobo.289.2">We saw how BitBake uses it during the </span><span class="No-Break"><span class="koboSpan" id="kobo.290.1">baking process.</span></span></p>
<p><span class="koboSpan" id="kobo.291.1">In the next chapter, we will better understand how packaging is done in Poky, how to use package feeds, the </span><strong class="bold"><span class="koboSpan" id="kobo.292.1">Package Revision</span></strong><span class="koboSpan" id="kobo.293.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.294.1">PR</span></strong><span class="koboSpan" id="kobo.295.1">) service, and how they may help our </span><span class="No-Break"><span class="koboSpan" id="kobo.296.1">product maintenance.</span></span></p>
</div>
<div>
<div class="IMG---Figure" id="_idContainer057">
</div>
</div>
</body></html>