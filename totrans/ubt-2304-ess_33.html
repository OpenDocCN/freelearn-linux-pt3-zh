<html><head></head><body>
<div class="_idGenObjectStyleOverride-1" id="_idContainer388">
<p class="Chapter-Title" id="_idParaDest-313" lang="en-US" xml:lang="en-US"><span class="ChapterMarker"><span class="koboSpan" id="kobo.1.1">34. </span></span><a id="_idTextAnchor506"/><span class="koboSpan" id="kobo.2.1">Adding a New Disk to an Ubuntu 23.04 Volume Group and Logical Volume</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.3.1">In the previous chapter, we looked at adding a new disk drive to an Ubuntu system, creating a partition and file system, and then mounting that file system to access the disk. </span><span class="koboSpan" id="kobo.3.2">An alternative to creating fixed partitions and file systems is to use </span><a id="_idIndexMarker776"/><span class="koboSpan" id="kobo.4.1">Logical Volume Management (</span><a id="_idIndexMarker777"/><span class="koboSpan" id="kobo.5.1">LVM) to create logical disks comprising space from one or more physical or virtual disks or partitions. </span><span class="koboSpan" id="kobo.5.2">The advantage of using LVM is that space can be added to or removed from logical volumes without spreading data over multiple file systems. </span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.6.1">Let us take, for example, the root (</span><span class="My-Italic CharOverride-1"><span class="koboSpan" id="kobo.7.1">/</span></span><span class="koboSpan" id="kobo.8.1">) file system of an Ubuntu-based server. </span><span class="koboSpan" id="kobo.8.2">Without LVM, this file system would be created with a specific size when the operating system is installed. </span><span class="koboSpan" id="kobo.8.3">If a new disk drive is installed, there is no way to allocate any of that space to the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.9.1">/</span></span><span class="koboSpan" id="kobo.10.1"> file system. </span><span class="koboSpan" id="kobo.10.2">The only option would be to create new file systems on the new disk and mount them at particular mount points. </span><span class="koboSpan" id="kobo.10.3">In this scenario, you would have plenty of space on the new file system, but the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.11.1">/</span></span><span class="koboSpan" id="kobo.12.1"> file system would still be nearly full. </span><span class="koboSpan" id="kobo.12.2">The only option would be to move files onto the new file system. </span><span class="koboSpan" id="kobo.12.3">With LVM, the new disk (or part thereof) can be assigned to the logical volume containing the home file system, thereby dynamically extending the space available. </span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.13.1">In this chapter, we will look at the steps necessary to add new disk space to both a volume group and a logical volume to add additional space to the home file system of an Ubuntu system. </span></p>
<p class="Heading-1-1" id="_idParaDest-314" lang="en-US" xml:lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.14.1">34.1 </span></span><a id="_idTextAnchor507"/><span class="koboSpan" id="kobo.15.1">An Overview of Logical Volume Management (LVM) </span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.16.1">LVM provides a flexible and high-level approach to managing disk space. </span><span class="koboSpan" id="kobo.16.2">Instead of each disk drive being split into partitions of fixed sizes onto which fixed-size file systems are created, LVM provides a way to group disk space into logical volumes that can be easily resized and moved. </span><span class="koboSpan" id="kobo.16.3">In addition, LVM allows administrators to carefully control disk space assigned to different groups of users by allocating distinct volume groups or logical volumes to those users. </span><span class="koboSpan" id="kobo.16.4">When the space initially allocated to the volume is exhausted, the administrator can add more space without moving the user files to a different file system. </span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.17.1">LVM consists of the following components: </span></p>
<p class="Heading-1-1-1" id="_idParaDest-315" lang="en-US" xml:lang="en-US"><span class="Heading111Marker"><span class="koboSpan" id="kobo.18.1">34.1.1 </span></span><a id="_idTextAnchor508"/><a id="_idIndexMarker778"/><span class="koboSpan" id="kobo.19.1">Volume Group (</span><a id="_idIndexMarker779"/><span class="koboSpan" id="kobo.20.1">VG)</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.21.1">The Volume Group is the high-level container with one or more logical and physical volumes. </span></p>
<p class="Heading-1-1-1" id="_idParaDest-316" lang="en-US" xml:lang="en-US"><span class="Heading111Marker"><span class="koboSpan" id="kobo.22.1">34.1.2 </span></span><a id="_idTextAnchor509"/><a id="_idIndexMarker780"/><span class="koboSpan" id="kobo.23.1">Physical Volume (</span><a id="_idIndexMarker781"/><span class="koboSpan" id="kobo.24.1">PV) </span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.25.1">A physical volume represents a storage device such as a disk drive or other storage media. </span></p>
<p class="Heading-1-1-1" id="_idParaDest-317" lang="en-US" xml:lang="en-US"><span class="Heading111Marker"><span class="koboSpan" id="kobo.26.1">34.1.3 </span></span><a id="_idTextAnchor510"/><a id="_idIndexMarker782"/><span class="koboSpan" id="kobo.27.1">Logical Volume (</span><a id="_idIndexMarker783"/><span class="koboSpan" id="kobo.28.1">LV) </span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.29.1">A logical volume is equivalent to a disk partition and, as with a disk partition, can contain a file system. </span></p>
<p class="Heading-1-1-1" id="_idParaDest-318" lang="en-US" xml:lang="en-US"><span class="Heading111Marker"><span class="koboSpan" id="kobo.30.1">34.1.4 </span></span><a id="_idTextAnchor511"/><a id="_idIndexMarker784"/><span class="koboSpan" id="kobo.31.1">Physical Extent (</span><a id="_idIndexMarker785"/><span class="koboSpan" id="kobo.32.1">PE) </span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.33.1">Each physical volume (PV) is divided into equal size blocks known as physical extents. </span></p>
<p class="Heading-1-1-1" id="_idParaDest-319" lang="en-US" xml:lang="en-US"><span class="Heading111Marker"><span class="koboSpan" id="kobo.34.1">34.1.5 </span></span><a id="_idTextAnchor512"/><a id="_idIndexMarker786"/><span class="koboSpan" id="kobo.35.1">Logical Extent (</span><a id="_idIndexMarker787"/><span class="koboSpan" id="kobo.36.1">LE) </span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.37.1">Each logical volume (LV) is divided into equal size blocks called logical extents. </span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.38.1">Suppose we are creating a new volume group called VolGroup001. </span><span class="koboSpan" id="kobo.38.2">This volume group needs physical disk space to function, so we allocate three disk partitions </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.39.1">/dev/sda1</span></span><span class="koboSpan" id="kobo.40.1">, </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.41.1">/dev/sdb1</span></span><span class="koboSpan" id="kobo.42.1">, and </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.43.1">/dev/sdb2</span></span><span class="koboSpan" id="kobo.44.1">. </span><span class="koboSpan" id="kobo.44.2">These become physical volumes in VolGroup001. </span><span class="koboSpan" id="kobo.44.3">We would then create a logical volume called LogVol001 within the volume group comprising the three physical volumes. </span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.45.1">If we run out of space in LogVol001, we add more disk partitions as physical volumes and assign them to the volume group and logical volume. </span></p>
<p class="Heading-1-1" id="_idParaDest-320" lang="en-US" xml:lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.46.1">34.2 </span></span><a id="_idTextAnchor513"/><span class="koboSpan" id="kobo.47.1">Getting Information about Logical Volumes </span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.48.1">As an example of using LVM with Ubuntu, we will work through an example of adding space to the / file system of a standard Ubuntu installation. </span><span class="koboSpan" id="kobo.48.2">Anticipating the need for flexibility in the sizing of the root partition, Ubuntu sets up the / file system as a logical volume (called </span><span class="My-Italic CharOverride-1"><span class="koboSpan" id="kobo.49.1">ubuntu_lv</span></span><span class="koboSpan" id="kobo.50.1">) within a volume group called </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.51.1">ub</span></span><span class="My-Italic CharOverride-1"><span class="koboSpan" id="kobo.52.1">untu-vg</span></span><span class="koboSpan" id="kobo.53.1">. </span><span class="koboSpan" id="kobo.53.2">Before making any changes to the LVM setup, however, it is essential first to gather information. </span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.54.1">Running the </span><a id="_idIndexMarker788"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.55.1">mount</span></span><span class="koboSpan" id="kobo.56.1"> command will output information about a range of mount points, including the following entry for the home filesystem:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.57.1">/dev/mapper/ubuntu--vg-ubuntu--lv on / type ext4 (rw,relatime)</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.58.1">Information about the volume group can be obtained using the </span><a id="_idIndexMarker789"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.59.1">vgdisplay</span></span><span class="koboSpan" id="kobo.60.1"> command: </span></p>
<p class="Code"><span class="koboSpan" id="kobo.61.1"># vgdisplay</span></p>
<p class="Code"><span class="koboSpan" id="kobo.62.1">  --- Volume group ---</span></p>
<p class="Code"><span class="koboSpan" id="kobo.63.1">  VG Name               ubuntu-vg</span></p>
<p class="Code"><span class="koboSpan" id="kobo.64.1">  System ID             </span></p>
<p class="Code"><span class="koboSpan" id="kobo.65.1">  Format                lvm2</span></p>
<p class="Code"><span class="koboSpan" id="kobo.66.1">  Metadata Areas        1</span></p>
<p class="Code"><span class="koboSpan" id="kobo.67.1">  Metadata Sequence No  2</span></p>
<p class="Code"><span class="koboSpan" id="kobo.68.1">  VG Access             read/write</span></p>
<p class="Code"><span class="koboSpan" id="kobo.69.1">  VG Status             resizable</span></p>
<p class="Code"><span class="koboSpan" id="kobo.70.1">  MAX LV                0</span></p>
<p class="Code"><span class="koboSpan" id="kobo.71.1">  Cur LV                1</span></p>
<p class="Code"><span class="koboSpan" id="kobo.72.1">  Open LV               1</span></p>
<p class="Code"><span class="koboSpan" id="kobo.73.1">  Max PV                0</span></p>
<p class="Code"><span class="koboSpan" id="kobo.74.1">  Cur PV                1</span></p>
<p class="Code"><span class="koboSpan" id="kobo.75.1">  Act PV                1</span></p>
<p class="Code"><span class="koboSpan" id="kobo.76.1">  VG Size               &lt;295.04 GiB</span></p>
<p class="Code"><span class="koboSpan" id="kobo.77.1">  PE Size               4.00 MiB</span></p>
<p class="Code"><span class="koboSpan" id="kobo.78.1">  Total PE              75529</span></p>
<p class="Code"><span class="koboSpan" id="kobo.79.1">  Alloc PE / Size       75529 / &lt;295.04 GiB</span></p>
<p class="Code"><span class="koboSpan" id="kobo.80.1">  Free  PE / Size       0 / 0   </span></p>
<p class="Code"><span class="koboSpan" id="kobo.81.1">  VG UUID               IIGC9W-1UBx-fajE-SMoK-rUdn-qw8E-0omd5P</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.82.1">As we can see in the above example, the </span><span class="My-Italic CharOverride-1"><span class="koboSpan" id="kobo.83.1">ubuntu-vg</span></span><span class="koboSpan" id="kobo.84.1"> volume group has a physical extent size of 4.00MiB and has a total of 295.04GB available for allocation to logical volumes. </span><span class="koboSpan" id="kobo.84.2">Currently, 75529 physical extents are allocated, equaling the total capacity. </span><span class="koboSpan" id="kobo.84.3">Therefore, we must add one or more physical volumes to increase the space allocated to any logical volumes in the </span><span class="My-Italic CharOverride-1"><span class="koboSpan" id="kobo.85.1">ubuntu-vg</span></span><span class="koboSpan" id="kobo.86.1"> volume group. </span><span class="koboSpan" id="kobo.86.2">The </span><a id="_idIndexMarker790"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.87.1">vgs </span></span><span class="koboSpan" id="kobo.88.1">tool is also helpful for displaying a quick overview of the space available in the volume groups on a system:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.89.1"># vgs</span></p>
<p class="Code"><span class="koboSpan" id="kobo.90.1">  VG        #PV #LV #SN Attr   VSize    VFree</span></p>
<p class="Code"><span class="koboSpan" id="kobo.91.1">  ubuntu-vg   1   1   0 wz--n- &lt;295.04g    0</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.92.1">Information about logical volumes in a volume group may similarly be obtained using the </span><a id="_idIndexMarker791"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.93.1">lvdisplay</span></span><span class="koboSpan" id="kobo.94.1"> command: </span></p>
<p class="Code"><span class="koboSpan" id="kobo.95.1"># lvdisplay</span></p>
<p class="Code"><span class="koboSpan" id="kobo.96.1">  --- Logical volume ---</span></p>
<p class="Code"><span class="koboSpan" id="kobo.97.1">  LV Path                /dev/ubuntu-vg/ubuntu-lv</span></p>
<p class="Code"><span class="koboSpan" id="kobo.98.1">  LV Name                ubuntu-lv</span></p>
<p class="Code"><span class="koboSpan" id="kobo.99.1">  VG Name                ubuntu-vg</span></p>
<p class="Code"><span class="koboSpan" id="kobo.100.1">  LV UUID                DaPi0C-vwvy-UudI-aUJQ-mFqx-rIhZ-rT7uHH</span></p>
<p class="Code"><span class="koboSpan" id="kobo.101.1">  LV Write Access        read/write</span></p>
<p class="Code"><span class="koboSpan" id="kobo.102.1">  LV Creation host, time ubuntu, 2023-07-26 15:42:23 -0400</span></p>
<p class="Code"><span class="koboSpan" id="kobo.103.1">  LV Status              available</span></p>
<p class="Code"><span class="koboSpan" id="kobo.104.1">  # open                 1</span></p>
<p class="Code"><span class="koboSpan" id="kobo.105.1">  LV Size                &lt;295.04 GiB</span></p>
<p class="Code"><span class="koboSpan" id="kobo.106.1">  Current LE             75529</span></p>
<p class="Code"><span class="koboSpan" id="kobo.107.1">  Segments               1</span></p>
<p class="Code"><span class="koboSpan" id="kobo.108.1">  Allocation             inherit</span></p>
<p class="Code"><span class="koboSpan" id="kobo.109.1">  Read ahead sectors     auto</span></p>
<p class="Code"><span class="koboSpan" id="kobo.110.1">  - currently set to     256</span></p>
<p class="Code"><span class="koboSpan" id="kobo.111.1">  Block device           253:0</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.112.1">As shown in the above example, 295.04 GiB of the space in volume group </span><span class="My-Italic CharOverride-1"><span class="koboSpan" id="kobo.113.1">ubuntu-vg</span></span><span class="koboSpan" id="kobo.114.1"> is allocated to logical volume </span><span class="My-Italic CharOverride-1"><span class="koboSpan" id="kobo.115.1">ubuntu-lv</span></span><span class="koboSpan" id="kobo.116.1"> (for the / file system). </span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.117.1">Now that we know what space is being used, it is often helpful to understand which devices are providing the space (in other words, which devices are being used as physical volumes). </span><span class="koboSpan" id="kobo.117.2">To obtain this information, we need to run the </span><a id="_idIndexMarker792"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.118.1">pvdisplay</span></span><span class="koboSpan" id="kobo.119.1"> command: </span></p>
<p class="Code"><span class="koboSpan" id="kobo.120.1"># pvdisplay</span></p>
<p class="Code"><span class="koboSpan" id="kobo.121.1">  --- Physical volume ---</span></p>
<p class="Code"><span class="koboSpan" id="kobo.122.1">  PV Name               /dev/sda3</span></p>
<p class="Code"><span class="koboSpan" id="kobo.123.1">  VG Name               ubuntu-vg</span></p>
<p class="Code"><span class="koboSpan" id="kobo.124.1">  PV Size               &lt;295.04 GiB / not usable 4.00 MiB</span></p>
<p class="Code"><span class="koboSpan" id="kobo.125.1">  Allocatable           yes (but full)</span></p>
<p class="Code"><span class="koboSpan" id="kobo.126.1">  PE Size               4.00 MiB</span></p>
<p class="Code"><span class="koboSpan" id="kobo.127.1">  Total PE              75529</span></p>
<p class="Code"><span class="koboSpan" id="kobo.128.1">  Free PE               0</span></p>
<p class="Code"><span class="koboSpan" id="kobo.129.1">  Allocated PE          75529</span></p>
<p class="Code"><span class="koboSpan" id="kobo.130.1">  PV UUID               mdde89-ZZS8-6ila-qoZy-ofLp-zxEq-dhifen</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.131.1">Clearly, the space controlled by logical volume </span><span class="My-Italic CharOverride-1"><span class="koboSpan" id="kobo.132.1">ubuntu-vg</span></span><span class="koboSpan" id="kobo.133.1"> is provided via a physical volume located on </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.134.1">/dev/sda2</span></span><span class="koboSpan" id="kobo.135.1">. </span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.136.1">Now that we know more about our LVM configuration, we can add space to the volume group and the logical volume contained within. </span></p>
<p class="Heading-1-1" id="_idParaDest-321" lang="en-US" xml:lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.137.1">34.3 </span></span><a id="_idTextAnchor514"/><span class="koboSpan" id="kobo.138.1">Adding Additional Space to a Volume Group from the Command-Line </span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.139.1">Just as with the previous steps to gather information about the current Logical Volume Management configuration of an Ubuntu system, changes to this configuration can be made from the command line. </span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.140.1">In the remainder of this chapter, we will assume that a new disk has been added to the system and that the operating system sees it as </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.141.1">/dev/sdb</span></span><span class="koboSpan" id="kobo.142.1">. </span><span class="koboSpan" id="kobo.142.2">We shall also assume this is a new disk with no existing partitions. </span><span class="koboSpan" id="kobo.142.3">If existing partitions are present, they should be backed up, and then the partitions should be deleted from the disk using the </span><a id="_idIndexMarker793"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.143.1">fdisk</span></span><span class="koboSpan" id="kobo.144.1"> utility. </span><span class="koboSpan" id="kobo.144.2">For example, assuming a device represented by </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.145.1">/dev/sdb</span></span><span class="koboSpan" id="kobo.146.1"> containing two partitions as follows:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.147.1"># fdisk -l /dev/sdb</span></p>
<p class="Code"><span class="koboSpan" id="kobo.148.1">Disk /dev/sdb: 14.46 GiB, 15525216256 bytes, 30322688 sectors</span></p>
<p class="Code"><span class="koboSpan" id="kobo.149.1">Disk model: USB 2.0 FD      </span></p>
<p class="Code"><span class="koboSpan" id="kobo.150.1">Units: sectors of 1 * 512 = 512 bytes</span></p>
<p class="Code"><span class="koboSpan" id="kobo.151.1">Sector size (logical/physical): 512 bytes / 512 bytes</span></p>
<p class="Code"><span class="koboSpan" id="kobo.152.1">I/O size (minimum/optimal): 512 bytes / 512 bytes</span></p>
<p class="Code"><span class="koboSpan" id="kobo.153.1">Disklabel type: dos</span></p>
<p class="Code"><span class="koboSpan" id="kobo.154.1">Disk identifier: 0x4c33060b</span></p>
<p class="Code"><span class="koboSpan" id="kobo.155.1">Device     Boot Start      End  Sectors  Size Id Type</span></p>
<p class="Code"><span class="koboSpan" id="kobo.156.1">/dev/sdb1        2048 30322687 30320640 14.5G 83 Linux</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.157.1">Once any filesystems on these partitions have been unmounted, they can be deleted as follows:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.158.1"># fdisk /dev/sdb</span></p>
<p class="Code"><span class="koboSpan" id="kobo.159.1">Welcome to fdisk (util-linux 2.37.4).</span></p>
<p class="Code"><span class="koboSpan" id="kobo.160.1">Changes will remain in memory only, until you decide to write them.</span></p>
<p class="Code"><span class="koboSpan" id="kobo.161.1">Be careful before using the write command.</span></p>
<p class="Code"><span class="koboSpan" id="kobo.162.1">Command (m for help): d</span></p>
<p class="Code"><span class="koboSpan" id="kobo.163.1">Selected partition 1</span></p>
<p class="Code"><span class="koboSpan" id="kobo.164.1">Partition 1 has been deleted.</span></p>
<p class="Code"><span class="koboSpan" id="kobo.165.1">Command (m for help): w</span></p>
<p class="Code"><span class="koboSpan" id="kobo.166.1">The partition table has been altered.</span></p>
<p class="Code"><span class="koboSpan" id="kobo.167.1">Calling ioctl() to re-read partition table.</span></p>
<p class="Code"><span class="koboSpan" id="kobo.168.1">Syncing disks.</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.169.1">Before moving to the next step, remove any entries in the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.170.1">/etc/fstab</span></span><span class="koboSpan" id="kobo.171.1"> file for these filesystems so that the system does not attempt to mount them on the next reboot.</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.172.1">Once the disk is ready, the next step is to convert this disk into a physical volume using the </span><a id="_idIndexMarker794"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.173.1">pvcreate</span></span><span class="koboSpan" id="kobo.174.1"> command (also wiping the dos signature if one exists): </span></p>
<p class="Code"><span class="koboSpan" id="kobo.175.1"># pvcreate /dev/sdb</span></p>
<p class="Code"><span class="koboSpan" id="kobo.176.1">WARNING: dos signature detected on /dev/sdb at offset 510. </span><span class="koboSpan" id="kobo.176.2">Wipe it? </span><span class="koboSpan" id="kobo.176.3">[y/n]: y</span></p>
<p class="Code"><span class="koboSpan" id="kobo.177.1">  Wiping dos signature on /dev/sdb.</span></p>
<p class="Code"><span class="koboSpan" id="kobo.178.1">  Physical volume "/dev/sdb" successfully created.</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.179.1">If the creation fails with a message that reads “Device /dev/&lt;device&gt; excluded by a filter”, it may be necessary to wipe the disk using the </span><a id="_idIndexMarker795"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.180.1">wipefs</span></span><span class="koboSpan" id="kobo.181.1"> command before creating the physical volume:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.182.1"># wipefs -a /dev/sdb</span></p>
<p class="Code"><span class="koboSpan" id="kobo.183.1">/dev/sdb: 8 bytes were erased at offset 0x00000200 (gpt): 45 46 49 20 50 41 52 54</span></p>
<p class="Code"><span class="koboSpan" id="kobo.184.1">/dev/sdb: 8 bytes were erased at offset 0x1fffffe00 (gpt): 45 46 49 20 50 41 52 54</span></p>
<p class="Code"><span class="koboSpan" id="kobo.185.1">/dev/sdb: 2 bytes were erased at offset 0x000001fe (PMBR): 55 aa</span></p>
<p class="Code"><span class="koboSpan" id="kobo.186.1">/dev/sdb: calling ioctl to re-read partition table: Success</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.187.1">With the physical volume created, we now need to add it to the volume group (in this case, </span><span class="My-Italic CharOverride-1"><span class="koboSpan" id="kobo.188.1">ubuntu-vg</span></span><span class="koboSpan" id="kobo.189.1">) using the </span><a id="_idIndexMarker796"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.190.1">vgextend</span></span><span class="koboSpan" id="kobo.191.1"> command: </span></p>
<p class="Code"><span class="koboSpan" id="kobo.192.1"># vgextend ubuntu-vg /dev/sdb</span></p>
<p class="Code"><span class="koboSpan" id="kobo.193.1">  Volume group "ubuntu-vg" successfully extended</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.194.1">The new physical volume has now been added to the volume group and is ready to be allocated to a logical volume. </span><span class="koboSpan" id="kobo.194.2">To do this, we run the </span><a id="_idIndexMarker797"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.195.1">lvextend</span></span><span class="koboSpan" id="kobo.196.1"> tool providing the size by which we wish to extend the volume. </span><span class="koboSpan" id="kobo.196.2">In this case, we want to extend the size of the </span><span class="My-Italic CharOverride-1"><span class="koboSpan" id="kobo.197.1">root</span></span><span class="My-Italic _idGenCharOverride-1"> </span><span class="koboSpan" id="kobo.198.1">logical volume by 14 GB. </span><span class="koboSpan" id="kobo.198.2">Note that we need to provide the path to the logical volume, which can be obtained from the </span><a id="_idIndexMarker798"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.199.1">lvdisplay</span></span><span class="koboSpan" id="kobo.200.1"> command (in this case, </span><span class="My-Italic CharOverride-1"><span class="koboSpan" id="kobo.201.1">/dev/ubuntu-vg/ubuntu-lv</span></span><span class="koboSpan" id="kobo.202.1">): </span></p>
<p class="Code"><span class="koboSpan" id="kobo.203.1"># lvextend -L+14G /dev/ubuntu-vg/ubuntu-lv</span></p>
<p class="Code"><span class="koboSpan" id="kobo.204.1">  Size of logical volume ubuntu-vg/ubuntu-lv changed from &lt;295.04 GiB (75529 extents) to &lt;309.04 GiB (79113 extents).</span></p>
<p class="Code"><span class="koboSpan" id="kobo.205.1">  Logical volume ubuntu-vg/ubuntu-lv successfully resized.</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.206.1">The last step is to resize the file system residing on the logical volume to use the additional space. </span><span class="koboSpan" id="kobo.206.2">The way this is performed will depend on the filesystem type, which can be identified using the following </span><a id="_idIndexMarker799"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.207.1">df</span></span><span class="koboSpan" id="kobo.208.1"> command and checking the Type column:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.209.1"># df -T /</span></p>
<p class="Code"><span class="koboSpan" id="kobo.210.1">Filesystem                        Type 1K-blocks     Used Available Use% Mounted</span></p>
<p class="Code"><span class="koboSpan" id="kobo.211.1">/dev/mapper/ubuntu--vg-ubuntu--lv ext4 303396024 22139044 265772260   8% /</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.212.1">If </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.213.1">/</span></span><span class="koboSpan" id="kobo.214.1"> is formatted using the </span><a id="_idIndexMarker800"/><span class="koboSpan" id="kobo.215.1">XFS filesystem, it can be resized using the </span><a id="_idIndexMarker801"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.216.1">xfs_growfs</span></span><span class="koboSpan" id="kobo.217.1"> utility:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.218.1"># xfs_growfs /</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.219.1">If, on the other hand, the filesystem is of type </span><a id="_idIndexMarker802"/><span class="koboSpan" id="kobo.220.1">ext2, </span><a id="_idIndexMarker803"/><span class="koboSpan" id="kobo.221.1">ext3, or </span><a id="_idIndexMarker804"/><span class="koboSpan" id="kobo.222.1">ext4, the </span><a id="_idIndexMarker805"/><a id="_idIndexMarker806"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.223.1">resize2fs</span></span><span class="koboSpan" id="kobo.224.1"> utility should be used instead when performing the filesystem resize:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.225.1"># resize2fs /dev/ubuntu-vg/ubuntu-lv</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.226.1">Once the resize completes, the file system will have been extended to use the additional space provided by the new disk drive. </span><span class="koboSpan" id="kobo.226.2">All this has been achieved without moving a single file or restarting the server. </span><span class="koboSpan" id="kobo.226.3">As far as users on the system are concerned, nothing has changed (except that there is now more disk space). </span></p>
<p class="Heading-1-1" id="_idParaDest-322" lang="en-US" xml:lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.227.1">34.4 </span></span><a id="_idTextAnchor515"/><span class="koboSpan" id="kobo.228.1">Summary</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.229.1">Volume groups and logical volumes provide an abstract layer on top of the physical storage devices on an Ubuntu system to provide a flexible way to allocate the space provided by multiple disk drives. </span><span class="koboSpan" id="kobo.229.2">This allows disk space allocations to be made and changed dynamically without the need to repartition disk drives and move data between filesystems. </span><span class="koboSpan" id="kobo.229.3">This chapter has outlined the basic concepts of volume groups and logical and physical volumes while demonstrating how to manage these using command-line tools.</span></p>
</div>
</body></html>