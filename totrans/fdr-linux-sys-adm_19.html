<html><head></head><body>
<div id="_idContainer538" class="calibre2">
<h1 class="chapter-number" id="_idParaDest-188"><a id="_idTextAnchor253" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1.1">13</span></h1>
<h1 id="_idParaDest-189" class="calibre5"><a id="_idTextAnchor254" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.2.1">Virtualization and Containers</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.3.1">Going back to the 1990s, most companies had physical servers and IT stacks from a single vendor that did not allow </span><em class="italic"><span class="kobospan" id="kobo.4.1">legacy applications</span></em><span class="kobospan" id="kobo.5.1"> to run on another vendor’s hardware. </span><span class="kobospan" id="kobo.5.2">This led to large, multi-service server environments that were very complex </span><span><span class="kobospan" id="kobo.6.1">to manage.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.7.1">As companies upgraded their IT environments with less expensive servers, operating systems, and applications from a variety of vendors, they began to underutilize physical hardware. </span><span class="kobospan" id="kobo.7.2">Each server could only run one specific task from </span><span><span class="kobospan" id="kobo.8.1">one vendor.</span></span></p>
<p class="calibre3"><strong class="bold"><span class="kobospan" id="kobo.9.1">Virtualization</span></strong><span class="kobospan" id="kobo.10.1"> was the </span><a id="_idIndexMarker994" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.11.1">natural solution to two problems: companies could partition their servers and run legacy applications on multiple types and versions of operating systems and servers began to be used more efficiently, reducing the costs associated with purchasing, installation, cooling, </span><span><span class="kobospan" id="kobo.12.1">and maintenance.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.13.1">The next step was the containerization </span><a id="_idIndexMarker995" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.14.1">of these services. </span><strong class="bold"><span class="kobospan" id="kobo.15.1">Containerization</span></strong><span class="kobospan" id="kobo.16.1"> is a form of virtualization. </span><span class="kobospan" id="kobo.16.2">The goal of virtualization is to run multiple instances of the operating system on a single server, while containerization runs a single instance of the operating system, with multiple user spaces to isolate the processes from each other and provide </span><span><span class="kobospan" id="kobo.17.1">the service.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.18.1">In this chapter, we will take a brief tour of </span><em class="italic"><span class="kobospan" id="kobo.19.1">virtualization</span></em><span class="kobospan" id="kobo.20.1"> and </span><em class="italic"><span class="kobospan" id="kobo.21.1">containerization</span></em><span class="kobospan" id="kobo.22.1"> by covering the following </span><span><span class="kobospan" id="kobo.23.1">main topics:</span></span></p>
<ul class="calibre15">
<li class="calibre14"><span class="kobospan" id="kobo.24.1">Virtualization with QEMU, KVM, </span><span><span class="kobospan" id="kobo.25.1">and </span></span><span><strong class="source-inline1"><span class="kobospan" id="kobo.26.1">libvirt</span></strong></span></li>
<li class="calibre14"><span class="kobospan" id="kobo.27.1">Using </span><span><span class="kobospan" id="kobo.28.1">GNOME Boxes</span></span></li>
<li class="calibre14"><span class="kobospan" id="kobo.29.1">Discovering OCI containers </span><span><span class="kobospan" id="kobo.30.1">with Podman</span></span></li>
</ul>
<h1 id="_idParaDest-190" class="calibre5"><a id="_idTextAnchor255" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.31.1">Technical requirements</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.32.1">To complete the topics mentioned in this chapter, you must install the packages indicated in each section. </span><span class="kobospan" id="kobo.32.2">In each section, you will find instructions for the different types of installation for each package </span><span><span class="kobospan" id="kobo.33.1">as required.</span></span></p>
<h1 id="_idParaDest-191" class="calibre5"><a id="_idTextAnchor256" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.34.1">Virtualization with QEMU, KVM, and libvirt</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.35.1">Fedora Linux comes with native support for virtualization extensions. </span><span class="kobospan" id="kobo.35.2">This support is provided by </span><strong class="bold"><span class="kobospan" id="kobo.36.1">Kernel-based Virtual Machine</span></strong><span class="kobospan" id="kobo.37.1"> (</span><strong class="bold"><span class="kobospan" id="kobo.38.1">KVM</span></strong><span class="kobospan" id="kobo.39.1">) and is available as a </span><em class="italic"><span class="kobospan" id="kobo.40.1">kernel module</span></em><span class="kobospan" id="kobo.41.1">. </span><strong class="bold"><span class="kobospan" id="kobo.42.1">QEMU/KVM</span></strong><span class="kobospan" id="kobo.43.1"> in combination with the </span><strong class="bold"><span class="kobospan" id="kobo.44.1">Libvirt management toolkit</span></strong><span class="kobospan" id="kobo.45.1"> is the standard virtualization method in</span><a id="_idIndexMarker996" class="pcalibre1 calibre6 pcalibre"/> <span><span class="kobospan" id="kobo.46.1">Fedora Linux.</span></span></p>
<p class="calibre3"><strong class="bold"><span class="kobospan" id="kobo.47.1">Quick Emulator</span></strong><span class="kobospan" id="kobo.48.1"> (</span><strong class="bold"><span class="kobospan" id="kobo.49.1">QEMU</span></strong><span class="kobospan" id="kobo.50.1">) is a full </span><a id="_idIndexMarker997" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.51.1">system emulator that works together with KVM and allows you to create virtual machines with hardware </span><span><span class="kobospan" id="kobo.52.1">and peripherals.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.53.1">Finally, </span><strong class="source-inline"><span class="kobospan" id="kobo.54.1">libvirt</span></strong><span class="kobospan" id="kobo.55.1"> is the API layer</span><a id="_idIndexMarker998" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.56.1"> and allows you to manage the infrastructure – that is, create and run virtual machines. </span><span class="kobospan" id="kobo.56.2">It includes a local virtual network that enables secure communication between virtual guest systems with each other and with the host. </span><span class="kobospan" id="kobo.56.3">libvirt’s default configuration also allows </span><em class="italic"><span class="kobospan" id="kobo.57.1">NAT access</span></em><span class="kobospan" id="kobo.58.1"> to the public network, which is useful for virtual machines or containers that don’t have direct access to the </span><span><span class="kobospan" id="kobo.59.1">public interface.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.60.1">The following figure illustrates the QEMU/KVM architecture </span><span><span class="kobospan" id="kobo.61.1">with </span></span><span><strong class="source-inline"><span class="kobospan" id="kobo.62.1">libvirt</span></strong></span><span><span class="kobospan" id="kobo.63.1">:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer494">
<span class="kobospan" id="kobo.64.1"><img alt="Figure 13.1 – The QEMU/KVM architecture" src="image/B19121_13_1.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.65.1">Figure 13.1 – The QEMU/KVM architecture</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.66.1">Let’s take a brief look at the </span><span><span class="kobospan" id="kobo.67.1">management tools.</span></span></p>
<h2 id="_idParaDest-192" class="calibre7"><a id="_idTextAnchor257" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.68.1">Management tools</span></h2>
<p class="calibre3"><strong class="source-inline"><span class="kobospan" id="kobo.69.1">libvirt</span></strong><span class="kobospan" id="kobo.70.1"> is a C toolkit that</span><a id="_idIndexMarker999" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.71.1"> interacts with the virtualization capabilities of Fedora Linux. </span><span class="kobospan" id="kobo.71.2">The main package includes the </span><strong class="source-inline"><span class="kobospan" id="kobo.72.1">libvirtd</span></strong><span class="kobospan" id="kobo.73.1"> server for exporting </span><span><span class="kobospan" id="kobo.74.1">virtualization support.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.75.1">The basic management tools are </span><span><span class="kobospan" id="kobo.76.1">as follows:</span></span></p>
<ul class="calibre15">
<li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.77.1">virsh</span></strong><span class="kobospan" id="kobo.78.1">: This is the main interface for managing </span><strong class="source-inline1"><span class="kobospan" id="kobo.79.1">virsh</span></strong><span class="kobospan" id="kobo.80.1"> guest domains. </span><span class="kobospan" id="kobo.80.2">The program can </span><em class="italic"><span class="kobospan" id="kobo.81.1">create</span></em><span class="kobospan" id="kobo.82.1">, </span><em class="italic"><span class="kobospan" id="kobo.83.1">pause</span></em><span class="kobospan" id="kobo.84.1">, and </span><em class="italic"><span class="kobospan" id="kobo.85.1">shutdown</span></em><span class="kobospan" id="kobo.86.1"> domains. </span><span class="kobospan" id="kobo.86.2">It also </span><em class="italic"><span class="kobospan" id="kobo.87.1">lists</span></em><span class="kobospan" id="kobo.88.1"> the current domains and </span><span><span class="kobospan" id="kobo.89.1">their status.</span></span></li>
<li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.90.1">Virt-manager</span></strong><span class="kobospan" id="kobo.91.1">: This is a desktop tool for managing virtual machines. </span><span class="kobospan" id="kobo.91.2">It provides </span><em class="italic"><span class="kobospan" id="kobo.92.1">life cycle control</span></em><span class="kobospan" id="kobo.93.1"> of current virtual machines (startup/shutdown, pause/resume, and suspend/restore), provisions new virtual machines and various types of storage, manages virtual networks, gives access to the graphical console of virtual machines, and generates performance statistics locally </span><span><span class="kobospan" id="kobo.94.1">or remotely:</span></span></li>
</ul>
<div class="calibre2">
<div class="img---figure" id="_idContainer495">
<span class="kobospan" id="kobo.95.1"><img alt="Figure 13.2 – Virtual Machine Manager" src="image/B19121_13_2.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.96.1">Figure 13.2 – Virtual Machine Manager</span></p>
<ul class="calibre15">
<li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.97.1">virt-viewer</span></strong><span class="kobospan" id="kobo.98.1">: This is a minimal tool for displaying the graphical console of a virtual machine. </span><span class="kobospan" id="kobo.98.2">It accesses the console using the </span><strong class="source-inline1"><span class="kobospan" id="kobo.99.1">VNC</span></strong><span class="kobospan" id="kobo.100.1"> or </span><strong class="source-inline1"><span class="kobospan" id="kobo.101.1">SPICE</span></strong><span class="kobospan" id="kobo.102.1"> protocol. </span><span class="kobospan" id="kobo.102.2">Refer to the virtual guest based on its </span><em class="italic"><span class="kobospan" id="kobo.103.1">name</span></em><span class="kobospan" id="kobo.104.1">, </span><em class="italic"><span class="kobospan" id="kobo.105.1">ID</span></em><span class="kobospan" id="kobo.106.1">, or </span><em class="italic"><span class="kobospan" id="kobo.107.1">UUID</span></em><span class="kobospan" id="kobo.108.1">. </span><span class="kobospan" id="kobo.108.2">If the guest is not running yet, the viewer could wait until it starts before attempting to connect to the console. </span><span class="kobospan" id="kobo.108.3">The viewer</span><a id="_idIndexMarker1000" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.109.1"> could connect to remote hosts to look up console information, as well as connect to the remote console using the same </span><span><span class="kobospan" id="kobo.110.1">network transport.</span></span></li>
<li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.111.1">virt-install</span></strong><span class="kobospan" id="kobo.112.1">: This is a command-line tool for creating new KVM, Xen, or Linux container guests using the </span><strong class="source-inline1"><span class="kobospan" id="kobo.113.1">libvirt</span></strong><span class="kobospan" id="kobo.114.1"> hypervisor management library. </span><span class="kobospan" id="kobo.114.2">The </span><strong class="source-inline1"><span class="kobospan" id="kobo.115.1">virt-install</span></strong><span class="kobospan" id="kobo.116.1"> tool supports graphical installations that use </span><strong class="source-inline1"><span class="kobospan" id="kobo.117.1">VNC</span></strong><span class="kobospan" id="kobo.118.1"> or </span><strong class="source-inline1"><span class="kobospan" id="kobo.119.1">SPICE</span></strong><span class="kobospan" id="kobo.120.1"> protocols, as well as text mode installations via serial console. </span><span class="kobospan" id="kobo.120.2">The guest could be configured to use one or more virtual disks, network interfaces, audio devices, and physical USB or PCI devices, </span><span><span class="kobospan" id="kobo.121.1">among others.</span></span><p class="calibre3"><span class="kobospan" id="kobo.122.1">The installation</span><a id="_idIndexMarker1001" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.123.1"> media could include local </span><strong class="bold"><span class="kobospan" id="kobo.124.1">ISOs</span></strong><span class="kobospan" id="kobo.125.1"> or </span><strong class="bold"><span class="kobospan" id="kobo.126.1">CDROMs</span></strong><span class="kobospan" id="kobo.127.1">, or a </span><em class="italic"><span class="kobospan" id="kobo.128.1">distribution installation tree</span></em><span class="kobospan" id="kobo.129.1"> hosted </span><a id="_idIndexMarker1002" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.130.1">remotely via </span><strong class="bold"><span class="kobospan" id="kobo.131.1">HTTP</span></strong><span class="kobospan" id="kobo.132.1">, </span><strong class="bold"><span class="kobospan" id="kobo.133.1">FTP</span></strong><span class="kobospan" id="kobo.134.1">, or in a local directory. </span><span class="kobospan" id="kobo.134.2">In the case of the installation tree, </span><strong class="source-inline"><span class="kobospan" id="kobo.135.1">virt-install</span></strong><span class="kobospan" id="kobo.136.1"> obtains the minimum files necessary to start the installation process, allowing the guest to get the rest of the operating system distribution as needed. </span><span class="kobospan" id="kobo.136.2">PXE booting and importing an existing disk image (thus skipping the installation phase) are </span><span><span class="kobospan" id="kobo.137.1">also supported.</span></span></p><p class="calibre3"><span class="kobospan" id="kobo.138.1">With the proper command-line arguments, </span><strong class="source-inline"><span class="kobospan" id="kobo.139.1">virt-install</span></strong><span class="kobospan" id="kobo.140.1"> can run completely unattended, with the guest “booting” itself. </span><span class="kobospan" id="kobo.140.2">This allows for easy automation of the </span><span><span class="kobospan" id="kobo.141.1">guest installation.</span></span></p></li>
</ul>
<p class="calibre3"><span class="kobospan" id="kobo.142.1">Using </span><strong class="source-inline"><span class="kobospan" id="kobo.143.1">virt-install</span></strong><span class="kobospan" id="kobo.144.1"> capabilities enables you to streamline the process of creating virtual machines, minimizing the installation time. </span><span class="kobospan" id="kobo.144.2">Let’s learn how to perform </span><span><span class="kobospan" id="kobo.145.1">this procedure.</span></span></p>
<h2 id="_idParaDest-193" class="calibre7"><a id="_idTextAnchor258" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.146.1">Streamlining the creation of virtual machines</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.147.1">QEMU uses the </span><strong class="source-inline"><span class="kobospan" id="kobo.148.1">qcow</span></strong><span class="kobospan" id="kobo.149.1"> file format for disk image files. </span><span class="kobospan" id="kobo.149.2">It stands for </span><em class="italic"><span class="kobospan" id="kobo.150.1">QEMU Copy On Write</span></em><span class="kobospan" id="kobo.151.1">. </span><span class="kobospan" id="kobo.151.2">The </span><strong class="source-inline"><span class="kobospan" id="kobo.152.1">qcow</span></strong><span class="kobospan" id="kobo.153.1"> format uses a disk storage optimization strategy that delays the allocation of storage until it is</span><a id="_idIndexMarker1003" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.154.1"> needed. </span><span class="kobospan" id="kobo.154.2">Files within the </span><strong class="source-inline"><span class="kobospan" id="kobo.155.1">qcow</span></strong><span class="kobospan" id="kobo.156.1"> format could contain a variety of disk images that are generally associated with specific guest operating systems. </span><span class="kobospan" id="kobo.156.2">There are three versions of the format: </span><strong class="source-inline"><span class="kobospan" id="kobo.157.1">qcow</span></strong><span class="kobospan" id="kobo.158.1">, </span><strong class="source-inline"><span class="kobospan" id="kobo.159.1">qcow2</span></strong><span class="kobospan" id="kobo.160.1">, </span><span><span class="kobospan" id="kobo.161.1">and </span></span><span><strong class="source-inline"><span class="kobospan" id="kobo.162.1">qcow3</span></strong></span><span><span class="kobospan" id="kobo.163.1">.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.164.1">At the time of writing, the vast majority of distributions, including Fedora Linux, offer a </span><em class="italic"><span class="kobospan" id="kobo.165.1">cloud-ready</span></em><span class="kobospan" id="kobo.166.1"> downloadable version. </span><span class="kobospan" id="kobo.166.2">One</span><a id="_idIndexMarker1004" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.167.1"> of the available options is the </span><strong class="source-inline"><span class="kobospan" id="kobo.168.1">qcow2</span></strong><span class="kobospan" id="kobo.169.1"> image </span><span><span class="kobospan" id="kobo.170.1">disk format.</span></span></p>
<p class="calibre3"><strong class="bold"><span class="kobospan" id="kobo.171.1">OpenStack</span></strong><span class="kobospan" id="kobo.172.1">, an </span><em class="italic"><span class="kobospan" id="kobo.173.1">open standard cloud computing platform</span></em><span class="kobospan" id="kobo.174.1">, provides a web page that references cloud images for many distributions and operating systems (which you’ll find in the </span><span><span class="kobospan" id="kobo.175.1">next example).</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.176.1">Using the </span><strong class="source-inline"><span class="kobospan" id="kobo.177.1">virt-customize</span></strong><span class="kobospan" id="kobo.178.1"> command-line tool, you can modify the downloadable disk image to import it as a </span><em class="italic"><span class="kobospan" id="kobo.179.1">ready-to-use</span></em> <span><span class="kobospan" id="kobo.180.1">virtual machine.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.181.1">Follow these steps to create a virtual machine in a short time with these </span><span><span class="kobospan" id="kobo.182.1">three tools:</span></span></p>
<ol class="calibre13">
<li class="calibre14"><span class="kobospan" id="kobo.183.1">Before starting, verify that your workstation runs virtualization-enabled from </span><span><span class="kobospan" id="kobo.184.1">the </span></span><span><strong class="bold"><span class="kobospan" id="kobo.185.1">BIOS</span></strong></span><span><span class="kobospan" id="kobo.186.1">/</span></span><span><strong class="bold"><span class="kobospan" id="kobo.187.1">UEFI</span></strong></span><span><span class="kobospan" id="kobo.188.1">.</span></span></li>
</ol>
<p class="calibre3"><span class="kobospan" id="kobo.189.1">Note</span></p>
<p class="callout"><span class="kobospan" id="kobo.190.1">This process depends on the manufacturer of your workstation. </span><span class="kobospan" id="kobo.190.2">Please refer to the manufacturer’s documentation to confirm that they have virtualization capability enabled in </span><span><span class="kobospan" id="kobo.191.1">the BIOS/UEFI.</span></span></p>
<ol class="calibre13">
<li value="2" class="calibre14"><span class="kobospan" id="kobo.192.1">Confirm that the processor of your workstation has the flags that </span><span><span class="kobospan" id="kobo.193.1">support virtualization:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.194.1">
$ </span><strong class="bold1"><span class="kobospan1" id="kobo.195.1">sudo grep -E 'svm|vmx' /proc/cpuinfo</span></strong></pre></li> <li class="calibre14"><span class="kobospan" id="kobo.196.1">Use the </span><strong class="source-inline1"><span class="kobospan" id="kobo.197.1">sudo</span></strong><span class="kobospan" id="kobo.198.1"> command to install the packages required </span><span><span class="kobospan" id="kobo.199.1">for virtualization:</span></span><ul class="calibre17"><li class="calibre14"><span><strong class="source-inline1"><span class="kobospan" id="kobo.200.1">qemu-kvm</span></strong></span></li><li class="calibre14"><span><strong class="source-inline1"><span class="kobospan" id="kobo.201.1">virt-manager</span></strong></span></li><li class="calibre14"><span><strong class="source-inline1"><span class="kobospan" id="kobo.202.1">virt-viewer</span></strong></span></li><li class="calibre14"><span><strong class="source-inline1"><span class="kobospan" id="kobo.203.1">guestfs-tools</span></strong></span></li><li class="calibre14"><span><strong class="source-inline1"><span class="kobospan" id="kobo.204.1">virt-install</span></strong></span></li><li class="calibre14"><span><strong class="source-inline1"><span class="kobospan" id="kobo.205.1">genisoimage</span></strong></span><span><span class="kobospan" id="kobo.206.1">:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.207.1">
$ </span><strong class="bold1"><span class="kobospan1" id="kobo.208.1">sudo dnf install qemu-kvm virt-manager virt-viewer guestfs-tools virt-install genisoimage</span></strong></pre></li></ul></li> <li class="calibre14"><span class="kobospan" id="kobo.209.1">Use your browser to</span><a id="_idIndexMarker1005" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.210.1"> navigate to </span><a href="https://docs.openstack.org/image-guide/obtain-images.html" class="pcalibre1 calibre6 pcalibre"><span class="kobospan" id="kobo.211.1">https://docs.openstack.org/image-guide/obtain-images.html</span></a><span class="kobospan" id="kobo.212.1"> and download the </span><strong class="source-inline1"><span class="kobospan" id="kobo.213.1">qcow2</span></strong><span class="kobospan" id="kobo.214.1"> disk image of the chosen </span><span><span class="kobospan" id="kobo.215.1">distribution/operating system:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer496">
<span class="kobospan" id="kobo.216.1"><img alt="Figure 13.3 – OpenStack – Get images" src="image/B19121_13_3.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.217.1">Figure 13.3 – OpenStack – Get images</span></p>
<ol class="calibre13">
<li value="5" class="calibre14"><span class="kobospan" id="kobo.218.1">For this example, download the Fedora Linux image. </span><span class="kobospan" id="kobo.218.2">Use your browser to navigate </span><span><span class="kobospan" id="kobo.219.1">to </span></span><a href="https://fedoraproject.org/cloud/download/" class="pcalibre1 calibre6 pcalibre"><span><span class="kobospan" id="kobo.220.1">https://fedoraproject.org/cloud/download/</span></span></a><span><span class="kobospan" id="kobo.221.1">:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer497">
<span class="kobospan" id="kobo.222.1"><img alt="Figure 13.4 – The Fedora Cloud download page" src="image/B19121_13_4.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.223.1">Figure 13.4 – The Fedora Cloud download page</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.224.1">Download the </span><strong class="source-inline"><span class="kobospan" id="kobo.225.1">qcow2</span></strong><span class="kobospan" id="kobo.226.1"> image for </span><span><strong class="source-inline"><span class="kobospan" id="kobo.227.1">x86_64</span></strong></span><span><span class="kobospan" id="kobo.228.1"> architectures.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.229.1">Note</span></p>
<p class="callout"><span class="kobospan" id="kobo.230.1">Each image requires about 400 MB of disk space. </span><span class="kobospan" id="kobo.230.2">Ensure that you have enough storage space to store them and let them grow as they </span><span><span class="kobospan" id="kobo.231.1">get used.</span></span></p>
<ol class="calibre13">
<li value="6" class="calibre14"><span class="kobospan" id="kobo.232.1">Move the </span><a id="_idIndexMarker1006" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.233.1">downloaded </span><strong class="source-inline1"><span class="kobospan" id="kobo.234.1">qcow2</span></strong><span class="kobospan" id="kobo.235.1"> image to the </span><strong class="bold"><span class="kobospan" id="kobo.236.1">KVM</span></strong><span class="kobospan" id="kobo.237.1"> working directory </span><span><span class="kobospan" id="kobo.238.1">in </span></span><span><strong class="source-inline1"><span class="kobospan" id="kobo.239.1">/var/lib/libvirt/images</span></strong></span><span><span class="kobospan" id="kobo.240.1">:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.241.1">
$ </span><strong class="bold1"><span class="kobospan1" id="kobo.242.1">sudo mv Fedora-Cloud-Base-38-1.6.x86_64.qcow2 /var/lib/libvirt/images/</span></strong></pre></li> </ol>
<p class="calibre3"><span class="kobospan" id="kobo.243.1">Note</span></p>
<p class="callout"><span class="kobospan" id="kobo.244.1">A best practice is to copy the </span><strong class="source-inline1"><span class="kobospan" id="kobo.245.1">qcow2</span></strong><span class="kobospan" id="kobo.246.1"> image with the virtual machine name instead of moving it. </span><span class="kobospan" id="kobo.246.2">Reuse the original downloaded image to create many </span><span><span class="kobospan" id="kobo.247.1">virtual machines:</span></span></p>
<p class="callout"><strong class="source-inline1"><span class="kobospan" id="kobo.248.1">$ sudo cp </span></strong><span><strong class="source-inline1"><span class="kobospan" id="kobo.249.1">Fedora-Cloud-Base-38-1.6.x86_64.qcow2 /var/lib/</span></strong></span><strong class="source-inline1">
</strong><span><strong class="source-inline1"><span class="kobospan" id="kobo.250.1">libvirt/images/vmtest01.qcow2</span></strong></span></p>
<ol class="calibre13">
<li value="7" class="calibre14"><span class="kobospan" id="kobo.251.1">Use the </span><strong class="source-inline1"><span class="kobospan" id="kobo.252.1">virt-customize</span></strong><span class="kobospan" id="kobo.253.1"> command to modify the </span><span><span class="kobospan" id="kobo.254.1">downloaded image:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.255.1">
$ </span><strong class="bold1"><span class="kobospan1" id="kobo.256.1">sudo virt-customize \</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.257.1">-a /var/lib/libvirt/images/vmtest01.qcow2 \</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.258.1">--hostname vmtest01.packt.lab \</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.259.1">--root-password password:rootpw \</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.260.1">--ssh-inject 'root:file:labkey.pub' \</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.261.1">--uninstall cloud-init \</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.262.1">--selinux-relabel</span></strong></pre><p class="calibre3"><span class="kobospan" id="kobo.263.1">Let’s look at each of the options that we used </span><span><span class="kobospan" id="kobo.264.1">in detail:</span></span></p><ul class="calibre17"><li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.265.1">virt-customize</span></strong><span class="kobospan" id="kobo.266.1"> modifies the guest or disk image in place. </span><span class="kobospan" id="kobo.266.2">The guest must power off to modify the disk</span><a id="_idIndexMarker1007" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.267.1"> image. </span><span class="kobospan" id="kobo.267.2">There’s no need to run </span><strong class="source-inline1"><span class="kobospan" id="kobo.268.1">virt-customize</span></strong><span class="kobospan" id="kobo.269.1"> as </span><strong class="source-inline1"><span class="kobospan" id="kobo.270.1">root</span></strong><span class="kobospan" id="kobo.271.1"> user. </span><span class="kobospan" id="kobo.271.2">In this case, use the </span><strong class="source-inline1"><span class="kobospan" id="kobo.272.1">sudo</span></strong><span class="kobospan" id="kobo.273.1"> command since there are no access rights to the path where this </span><span><span class="kobospan" id="kobo.274.1">image resides.</span></span></li><li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.275.1">-a</span></strong><span class="kobospan" id="kobo.276.1"> indicates the path of the disk </span><span><span class="kobospan" id="kobo.277.1">to customize.</span></span></li><li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.278.1">--hostname</span></strong><span class="kobospan" id="kobo.279.1"> sets the virtual </span><span><span class="kobospan" id="kobo.280.1">machine hostname.</span></span></li><li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.281.1">--root-password</span></strong><span class="kobospan" id="kobo.282.1"> sets the new </span><strong class="source-inline1"><span class="kobospan" id="kobo.283.1">root</span></strong><span class="kobospan" id="kobo.284.1"> password, which in this case </span><span><span class="kobospan" id="kobo.285.1">is </span></span><span><strong class="source-inline1"><span class="kobospan" id="kobo.286.1">rootpw</span></strong></span><span><span class="kobospan" id="kobo.287.1">.</span></span></li><li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.288.1">--ssh-inject</span></strong><span class="kobospan" id="kobo.289.1"> allows you to inject an SSH key to some user. </span><span class="kobospan" id="kobo.289.2">In this case, this is </span><strong class="source-inline1"><span class="kobospan" id="kobo.290.1">labkey</span></strong><span class="kobospan" id="kobo.291.1"> for the </span><span><strong class="source-inline1"><span class="kobospan" id="kobo.292.1">root</span></strong></span><span><span class="kobospan" id="kobo.293.1"> user.</span></span></li></ul><p class="calibre3"><span class="kobospan" id="kobo.294.1">To generate the SSH key, use </span><a id="_idIndexMarker1008" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.295.1">the </span><span><strong class="source-inline"><span class="kobospan" id="kobo.296.1">ssh-keygen</span></strong></span><span><span class="kobospan" id="kobo.297.1"> command:</span></span></p><pre class="source-code"><span class="kobospan1" id="kobo.298.1">$ </span><strong class="bold1"><span class="kobospan1" id="kobo.299.1">ssh-keygen -t ecdsa -b 521 -f labkey</span></strong></pre></li> </ol>
<p class="calibre3"><span class="kobospan" id="kobo.300.1">Note</span></p>
<p class="callout"><span class="kobospan" id="kobo.301.1">For more information on the </span><strong class="source-inline1"><span class="kobospan" id="kobo.302.1">ssh-keygen</span></strong><span class="kobospan" id="kobo.303.1"> command, refer to the command manual: </span><span><strong class="source-inline1"><span class="kobospan" id="kobo.304.1">man ssh-keygen</span></strong></span><span><span class="kobospan" id="kobo.305.1">.</span></span></p>
<ul class="calibre15">
<li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.306.1">--uninstall</span></strong><span class="kobospan" id="kobo.307.1"> allows us to uninstall the software contained by default in the </span><span><span class="kobospan" id="kobo.308.1">downloaded image.</span></span></li>
</ul>
<p class="calibre3"><strong class="bold"><span class="kobospan" id="kobo.309.1">cloud-init</span></strong><span class="kobospan" id="kobo.310.1"> is a suite that helps initialize an</span><a id="_idIndexMarker1009" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.311.1"> image for use in OpenStack. </span><span class="kobospan" id="kobo.311.2">In this case, it is not necessary </span><a id="_idIndexMarker1010" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.312.1">since a basic functional level of customization works </span><span><span class="kobospan" id="kobo.313.1">best here.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.314.1">Note</span></p>
<p class="callout"><span class="kobospan" id="kobo.315.1">If the </span><strong class="source-inline1"><span class="kobospan" id="kobo.316.1">cloud-init</span></strong><span class="kobospan" id="kobo.317.1"> package is not uninstalled, the VM will take a long time to boot as it waits for the parameters for initialization with </span><span><strong class="source-inline1"><span class="kobospan" id="kobo.318.1">cloud-init scripts</span></strong></span><span><span class="kobospan" id="kobo.319.1">.</span></span></p>
<ul class="calibre15">
<li class="calibre14"><span class="kobospan" id="kobo.320.1">Since it is a Fedora Linux image, the SELinux contexts must </span><em class="italic"><span class="kobospan" id="kobo.321.1">relabel</span></em><span class="kobospan" id="kobo.322.1"> with the </span><strong class="source-inline1"><span class="kobospan" id="kobo.323.1">--selinux-relabel</span></strong><span class="kobospan" id="kobo.324.1"> option as several files must be changed </span><span><span class="kobospan" id="kobo.325.1">or removed:</span></span></li>
</ul>
<div class="calibre2">
<div class="img---figure" id="_idContainer498">
<span class="kobospan" id="kobo.326.1"><img alt="Figure 13.5 – Customizing the qcow2 image" src="image/B19121_13_5.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.327.1">Figure 13.5 – Customizing the qcow2 image</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.328.1">Now that we’ve finished customizing, let’s import the disk image as a new </span><span><span class="kobospan" id="kobo.329.1">virtual machine.</span></span></p>
<ol class="calibre13">
<li value="8" class="calibre14"><span class="kobospan" id="kobo.330.1">To import the disk </span><a id="_idIndexMarker1011" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.331.1">image as a new virtual machine, use the </span><span><strong class="source-inline1"><span class="kobospan" id="kobo.332.1">virt-install</span></strong></span><span><span class="kobospan" id="kobo.333.1"> command:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.334.1">
$ </span><strong class="bold1"><span class="kobospan1" id="kobo.335.1">sudo virt-install \</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.336.1">--name vmtest01 \</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.337.1">--memory 1024 \</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.338.1">--vcpus 1 \</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.339.1">--disk /var/lib/libvirt/images/vmtest01.qcow2 \</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.340.1">--import \</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.341.1">--osinfo fedora38 \</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.342.1">--noautoconsole</span></strong></pre><p class="calibre3"><span class="kobospan" id="kobo.343.1">Let’s look at each of the options we used </span><span><span class="kobospan" id="kobo.344.1">in detail:</span></span></p><ul class="calibre17"><li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.345.1">virt-install</span></strong><span class="kobospan" id="kobo.346.1"> is the command-line tool for creating </span><span><span class="kobospan" id="kobo.347.1">new VMs.</span></span></li><li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.348.1">--name</span></strong><span class="kobospan" id="kobo.349.1"> sets the name of the new guest VM instance. </span><span class="kobospan" id="kobo.349.2">The name must remain </span><em class="italic"><span class="kobospan" id="kobo.350.1">unique</span></em><span class="kobospan" id="kobo.351.1"> among all guests known to the hypervisor on the connection, including those not </span><span><span class="kobospan" id="kobo.352.1">currently active.</span></span></li><li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.353.1">--memory</span></strong><span class="kobospan" id="kobo.354.1"> indicates the memory to allocate for the guest </span><span><span class="kobospan" id="kobo.355.1">in MiB.</span></span></li><li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.356.1">--vcpus</span></strong><span class="kobospan" id="kobo.357.1"> indicates the number of </span><strong class="source-inline1"><span class="kobospan" id="kobo.358.1">vcpus</span></strong><span class="kobospan" id="kobo.359.1"> to configure for </span><span><span class="kobospan" id="kobo.360.1">the guest.</span></span></li><li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.361.1">–disk</span></strong><span class="kobospan" id="kobo.362.1"> specifies the device to use as storage for the guest. </span><span class="kobospan" id="kobo.362.2">In this case, this is the path to the </span><span><span class="kobospan" id="kobo.363.1">disk image.</span></span></li><li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.364.1">--import</span></strong><span class="kobospan" id="kobo.365.1"> indicates that the disk image gets imported as a new VM building a guest around this </span><span><span class="kobospan" id="kobo.366.1">disk image.</span></span></li><li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.367.1">--osinfo</span></strong><span class="kobospan" id="kobo.368.1"> optimizes the guest configuration for a specific operating system version or distribution. </span><span class="kobospan" id="kobo.368.2">In this case, </span><strong class="source-inline1"><span class="kobospan" id="kobo.369.1">fedora38</span></strong> <span><span class="kobospan" id="kobo.370.1">is indicated.</span></span></li></ul></li> </ol>
<p class="calibre3"><span class="kobospan" id="kobo.371.1">Note</span></p>
<p class="callout"><span class="kobospan" id="kobo.372.1">To find the list of supported operating system name values, use the </span><strong class="source-inline1"><span class="kobospan" id="kobo.373.1">virt-install</span></strong><span class="kobospan" id="kobo.374.1"> command – that is, </span><strong class="source-inline1"><span class="kobospan" id="kobo.375.1">virt-install --</span></strong><span><strong class="source-inline1"><span class="kobospan" id="kobo.376.1">osinfo list</span></strong></span><span><span class="kobospan" id="kobo.377.1">.</span></span></p>
<ul class="calibre15">
<li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.378.1">--noautoconsole</span></strong><span class="kobospan" id="kobo.379.1"> specifies not to try to connect to the guest </span><span><span class="kobospan" id="kobo.380.1">console automatically:</span></span></li>
</ul>
<div class="calibre2">
<div class="img---figure" id="_idContainer499">
<span class="kobospan" id="kobo.381.1"><img alt="Figure 13.6 – Creating a new virtual machine" src="image/B19121_13_6.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.382.1">Figure 13.6 – Creating a new virtual machine</span></p>
<ol class="calibre13">
<li value="9" class="calibre14"><span class="kobospan" id="kobo.383.1">Verify the status of the </span><a id="_idIndexMarker1012" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.384.1">created </span><span><span class="kobospan" id="kobo.385.1">virtual machine:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.386.1">
$ </span><strong class="bold1"><span class="kobospan1" id="kobo.387.1">sudo virsh list</span></strong></pre><p class="calibre3"><span class="kobospan" id="kobo.388.1">Here’s </span><span><span class="kobospan" id="kobo.389.1">the output:</span></span></p></li> </ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer500">
<span class="kobospan" id="kobo.390.1"><img alt="Figure 13.7 – Verifying the new virtual machine’s status" src="image/B19121_13_7.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.391.1">Figure 13.7 – Verifying the new virtual machine’s status</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.392.1">Now, let’s connect to the virtual machine </span><span><span class="kobospan" id="kobo.393.1">via SSH.</span></span></p>
<ol class="calibre13">
<li value="10" class="calibre14"><span class="kobospan" id="kobo.394.1">Use the </span><strong class="source-inline1"><span class="kobospan" id="kobo.395.1">virsh</span></strong><span class="kobospan" id="kobo.396.1"> command to</span><a id="_idIndexMarker1013" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.397.1"> find the IP address that was assigned by the virtualization </span><span><strong class="bold"><span class="kobospan" id="kobo.398.1">DHCP</span></strong></span><span><span class="kobospan" id="kobo.399.1"> service:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.400.1">
$ </span><strong class="bold1"><span class="kobospan1" id="kobo.401.1">sudo virsh domifaddr vmtest01</span></strong></pre><p class="calibre3"><span class="kobospan" id="kobo.402.1">Here’s </span><span><span class="kobospan" id="kobo.403.1">the output:</span></span></p></li> </ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer501">
<span class="kobospan" id="kobo.404.1"><img alt="Figure 13.8 – Finding the VM’s IP address" src="image/B19121_13_8.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.405.1">Figure 13.8 – Finding the VM’s IP address</span></p>
<ol class="calibre13">
<li value="11" class="calibre14"><span class="kobospan" id="kobo.406.1">Use the </span><strong class="source-inline1"><span class="kobospan" id="kobo.407.1">ssh</span></strong><span class="kobospan" id="kobo.408.1"> command and the SSH key to access the </span><span><span class="kobospan" id="kobo.409.1">virtual machine:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.410.1">
$ </span><strong class="bold1"><span class="kobospan1" id="kobo.411.1">ssh –i labkey root@192.168.124.225</span></strong></pre><p class="calibre3"><span class="kobospan" id="kobo.412.1">You will get the </span><span><span class="kobospan" id="kobo.413.1">following output:</span></span></p></li> </ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer502">
<span class="kobospan" id="kobo.414.1"><img alt="Figure 13.9 – Accessing the VM" src="image/B19121_13_9.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.415.1">Figure 13.9 – Accessing the VM</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.416.1">With that, you can get a working virtual machine up and running in a short time. </span><span class="kobospan" id="kobo.416.2">Mastering these commands speeds up </span><span><span class="kobospan" id="kobo.417.1">this task.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.418.1">Before moving on to containerization, which is virtualization in miniature form, let’s look at the tool that GNOME includes as part of its </span><span><span class="kobospan" id="kobo.419.1">desktop suite.</span></span></p>
<h1 id="_idParaDest-194" class="calibre5"><a id="_idTextAnchor259" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.420.1">Using GNOME Boxes</span></h1>
<p class="calibre3"><strong class="bold"><span class="kobospan" id="kobo.421.1">GNOME Boxes</span></strong><span class="kobospan" id="kobo.422.1"> is an application of</span><a id="_idIndexMarker1014" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.423.1"> the GNOME desktop environment that’s used to access remote or virtual systems. </span><span class="kobospan" id="kobo.423.2">Boxes uses the QEMU, KVM, and Libvirt </span><span><span class="kobospan" id="kobo.424.1">virtualization technologies.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.425.1">Besides the virtualization extensions seen in the previous section, Boxes requires at least </span><em class="italic"><span class="kobospan" id="kobo.426.1">20 GB of storage space</span></em><span class="kobospan" id="kobo.427.1"> and </span><em class="italic"><span class="kobospan" id="kobo.428.1">500 MB of RAM</span></em><span class="kobospan" id="kobo.429.1"> to allocate to virtual machines. </span><span class="kobospan" id="kobo.429.2">GNOME recommends at least 8 GB of RAM and 20 GB of storage on the workstation to run Boxes efficiently. </span><span class="kobospan" id="kobo.429.3">Boxes assigns resources to virtual machines </span><em class="italic"><span class="kobospan" id="kobo.430.1">automatically</span></em><span class="kobospan" id="kobo.431.1"> and </span><em class="italic"><span class="kobospan" id="kobo.432.1">dynamically</span></em><span class="kobospan" id="kobo.433.1"> based on the </span><span><span class="kobospan" id="kobo.434.1">vendor’s recommendations.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.435.1">Let’s review the process of creating a virtual machine </span><span><span class="kobospan" id="kobo.436.1">with </span></span><span><strong class="bold"><span class="kobospan" id="kobo.437.1">Boxes</span></strong></span><span><span class="kobospan" id="kobo.438.1">:</span></span></p>
<ol class="calibre13">
<li class="calibre14"><span class="kobospan" id="kobo.439.1">To access Boxes, open </span><em class="italic"><span class="kobospan" id="kobo.440.1">Activities Overview</span></em><span class="kobospan" id="kobo.441.1"> and </span><span><span class="kobospan" id="kobo.442.1">type </span></span><span><strong class="source-inline1"><span class="kobospan" id="kobo.443.1">Boxes</span></strong></span><span><span class="kobospan" id="kobo.444.1">:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer503">
<span class="kobospan" id="kobo.445.1"><img alt="Figure 13.10 – GNOME Boxes via Activities Overview" src="image/B19121_13_10.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.446.1">Figure 13.10 – GNOME Boxes via Activities Overview</span></p>
<ol class="calibre13">
<li value="2" class="calibre14"><span class="kobospan" id="kobo.447.1">The main Boxes window will appear. </span><span class="kobospan" id="kobo.447.2">To create a new virtual machine, click on the </span><em class="italic"><span class="kobospan" id="kobo.448.1">plus</span></em><span class="kobospan" id="kobo.449.1"> (</span><strong class="bold"><span class="kobospan" id="kobo.450.1">+</span></strong><span class="kobospan" id="kobo.451.1">) button in the </span><span><span class="kobospan" id="kobo.452.1">top-left corner:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer504">
<span class="kobospan" id="kobo.453.1"><img alt="Figure 13.11 – GNOME Boxes main window" src="image/B19121_13_11.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.454.1">Figure 13.11 – GNOME Boxes main window</span></p>
<ol class="calibre13">
<li value="3" class="calibre14"><span class="kobospan" id="kobo.455.1">Boxes offers two </span><a id="_idIndexMarker1015" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.456.1">options for creating a new </span><span><span class="kobospan" id="kobo.457.1">virtual machine:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer505">
<span class="kobospan" id="kobo.458.1"><img alt="Figure 13.12 – Creating a new virtual machine with Boxes" src="image/B19121_13_12.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.459.1">Figure 13.12 – Creating a new virtual machine with Boxes</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.460.1">They are </span><span><span class="kobospan" id="kobo.461.1">as follows:</span></span></p>
<ul class="calibre15">
<li class="calibre14"><strong class="bold"><span class="kobospan" id="kobo.462.1">Install from File</span></strong><span class="kobospan" id="kobo.463.1">: When</span><a id="_idIndexMarker1016" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.464.1"> using this option, you must state the location of the </span><strong class="bold"><span class="kobospan" id="kobo.465.1">ISO</span></strong><span class="kobospan" id="kobo.466.1"> image of the operating system to install in the new </span><span><span class="kobospan" id="kobo.467.1">virtual machine</span></span></li>
<li class="calibre14"><strong class="bold"><span class="kobospan" id="kobo.468.1">Download OS</span></strong><span class="kobospan" id="kobo.469.1">: This option selects an operating system version or distribution and downloads the corresponding image for installation in the new </span><span><span class="kobospan" id="kobo.470.1">virtual machine:</span></span></li>
</ul>
<div class="calibre2">
<div class="img---figure" id="_idContainer506">
<span class="kobospan" id="kobo.471.1"><img alt="Figure 13.13 – Selecting an operating system image" src="image/B19121_13_13.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.472.1">Figure 13.13 – Selecting an operating system image</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.473.1">For this example, let’s </span><a id="_idIndexMarker1017" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.474.1">download the ISO image </span><span><span class="kobospan" id="kobo.475.1">by ourselves.</span></span></p>
<ol class="calibre13">
<li value="4" class="calibre14"><span class="kobospan" id="kobo.476.1">Use your browser to navigate </span><span><span class="kobospan" id="kobo.477.1">to </span></span><a href="https://fedoraproject.org/workstation/download/" class="pcalibre1 calibre6 pcalibre"><span><span class="kobospan" id="kobo.478.1">https://fedoraproject.org/workstation/download/</span></span></a><span><span class="kobospan" id="kobo.479.1">:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer507">
<span class="kobospan" id="kobo.480.1"><img alt="Figure 13.14 – Fedora Workstation download page" src="image/B19121_13_14.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.481.1">Figure 13.14 – Fedora Workstation download page</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.482.1">Download the </span><strong class="bold"><span class="kobospan" id="kobo.483.1">ISO</span></strong><span class="kobospan" id="kobo.484.1"> image for </span><span><strong class="source-inline"><span class="kobospan" id="kobo.485.1">x86_64</span></strong></span><span><span class="kobospan" id="kobo.486.1"> architectures.</span></span></p>
<ol class="calibre13">
<li value="5" class="calibre14"><span class="kobospan" id="kobo.487.1">In </span><strong class="bold"><span class="kobospan" id="kobo.488.1">Boxes</span></strong><span class="kobospan" id="kobo.489.1">, click on</span><a id="_idIndexMarker1018" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.490.1"> the </span><em class="italic"><span class="kobospan" id="kobo.491.1">plus</span></em><span class="kobospan" id="kobo.492.1"> sign (</span><strong class="bold"><span class="kobospan" id="kobo.493.1">+</span></strong><span class="kobospan" id="kobo.494.1">) and select the </span><strong class="bold"><span class="kobospan" id="kobo.495.1">Install from File</span></strong><span class="kobospan" id="kobo.496.1"> option. </span><span class="kobospan" id="kobo.496.2">Navigate to the location of the downloaded </span><strong class="bold"><span class="kobospan" id="kobo.497.1">ISO</span></strong><span class="kobospan" id="kobo.498.1"> image and click the </span><span><strong class="bold"><span class="kobospan" id="kobo.499.1">Open</span></strong></span><span><span class="kobospan" id="kobo.500.1"> button:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer508">
<span class="kobospan" id="kobo.501.1"><img alt="Figure 13.15 – Creating a new virtual machine" src="image/B19121_13_15.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.502.1">Figure 13.15 – Creating a new virtual machine</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.503.1">Boxes will display the virtual</span><a id="_idIndexMarker1019" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.504.1"> machine creation options. </span><span class="kobospan" id="kobo.504.2">Use the default options and click the </span><span><strong class="bold"><span class="kobospan" id="kobo.505.1">Create</span></strong></span><span><span class="kobospan" id="kobo.506.1"> button.</span></span></p>
<ol class="calibre13">
<li value="6" class="calibre14"><span class="kobospan" id="kobo.507.1">The installation of the downloaded image – in this case, Fedora Workstation – starts on a </span><span><span class="kobospan" id="kobo.508.1">bare-metal machine:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer509">
<span class="kobospan" id="kobo.509.1"><img alt="Figure 13.16 – Fedora Workstation live image" src="image/B19121_13_16.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.510.1">Figure 13.16 – Fedora Workstation live image</span></p>
<ol class="calibre13">
<li value="7" class="calibre14"><span class="kobospan" id="kobo.511.1">In the Fedora</span><a id="_idIndexMarker1020" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.512.1"> Workstation installation window, click the </span><strong class="bold"><span class="kobospan" id="kobo.513.1">Install Fedora</span></strong><span class="kobospan" id="kobo.514.1"> button and continue installing the </span><span><span class="kobospan" id="kobo.515.1">operating system:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer510">
<span class="kobospan" id="kobo.516.1"><img alt="Figure 13.17 – Fedora Linux installation window" src="image/B19121_13_17.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.517.1">Figure 13.17 – Fedora Linux installation window</span></p>
<ol class="calibre13">
<li value="8" class="calibre14"><span class="kobospan" id="kobo.518.1">Once the installation</span><a id="_idIndexMarker1021" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.519.1"> has finished, click on the </span><strong class="bold"><span class="kobospan" id="kobo.520.1">Finish installation</span></strong><span class="kobospan" id="kobo.521.1"> button and restart the </span><span><span class="kobospan" id="kobo.522.1">virtual machine:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer511">
<span class="kobospan" id="kobo.523.1"><img alt="Figure 13.18 – Finishing virtual machine installation" src="image/B19121_13_18.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.524.1">Figure 13.18 – Finishing virtual machine installation</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.525.1">Upon restarting the</span><a id="_idIndexMarker1022" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.526.1"> virtual machine, it will appear in the main </span><span><strong class="bold"><span class="kobospan" id="kobo.527.1">Boxes</span></strong></span><span><span class="kobospan" id="kobo.528.1"> window:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer512">
<span class="kobospan" id="kobo.529.1"><img alt="Figure 13.19 – The Boxes main window" src="image/B19121_13_19.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.530.1">Figure 13.19 – The Boxes main window</span></p>
<ol class="calibre13">
<li value="9" class="calibre14"><span class="kobospan" id="kobo.531.1">Click on the virtual</span><a id="_idIndexMarker1023" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.532.1"> machine icon to </span><span><span class="kobospan" id="kobo.533.1">access it:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer513">
<span class="kobospan" id="kobo.534.1"><img alt="Figure 13.20 – Accessing the virtual machine" src="image/B19121_13_191.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.535.1">Figure 13.20 – Accessing the virtual machine</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.536.1">The virtual</span><a id="_idIndexMarker1024" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.537.1"> machine window takes up the space of the main </span><strong class="bold"><span class="kobospan" id="kobo.538.1">Boxes</span></strong><span class="kobospan" id="kobo.539.1"> window and allows us to use it graphically, as a </span><span><span class="kobospan" id="kobo.540.1">remote session:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer514">
<span class="kobospan" id="kobo.541.1"><img alt="Figure 13.21 – Fedora Workstation virtual machine" src="image/B19121_13_20.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.542.1">Figure 13.21 – Fedora Workstation virtual machine</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.543.1">Now, use the</span><a id="_idIndexMarker1025" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.544.1"> virtual machine for the tasks assigned </span><span><span class="kobospan" id="kobo.545.1">to it.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.546.1">If the virtual machine gets turned off, it will appear in the main window, as shown in the </span><span><span class="kobospan" id="kobo.547.1">following figure:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer515">
<span class="kobospan" id="kobo.548.1"><img alt="Figure 13.22 – The virtual machine turned off in Boxes" src="image/B19121_13_21.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.549.1">Figure 13.22 – The virtual machine turned off in Boxes</span></p>
<ol class="calibre13">
<li value="10" class="calibre14"><span class="kobospan" id="kobo.550.1">Right-click on the </span><a id="_idIndexMarker1026" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.551.1">virtual machine icon to access the </span><span><span class="kobospan" id="kobo.552.1">administration options:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer516">
<span class="kobospan" id="kobo.553.1"><img alt="Figure 13.23 – Virtual machine management options" src="image/B19121_13_22.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.554.1">Figure 13.23 – Virtual machine management options</span></p>
<ol class="calibre13">
<li value="11" class="calibre14"><span class="kobospan" id="kobo.555.1">To turn on the virtual machine, double-click </span><span><span class="kobospan" id="kobo.556.1">its icon.</span></span></li>
</ol>
<p class="calibre3"><span class="kobospan" id="kobo.557.1">GNOME Boxes is a simple application for accessing and managing virtual machines. </span><span class="kobospan" id="kobo.557.2">It does not provide </span><em class="italic"><span class="kobospan" id="kobo.558.1">granular management</span></em><span class="kobospan" id="kobo.559.1"> and </span><em class="italic"><span class="kobospan" id="kobo.560.1">automation facilities</span></em><span class="kobospan" id="kobo.561.1"> of </span><strong class="source-inline"><span class="kobospan" id="kobo.562.1">virsh</span></strong><span class="kobospan" id="kobo.563.1">, but it is a good tool to become familiar with the use of </span><span><span class="kobospan" id="kobo.564.1">virtual machines.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.565.1">A more granular </span><a id="_idIndexMarker1027" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.566.1">method, with less creation time and better optimization of host resources, is to </span><span><span class="kobospan" id="kobo.567.1">use containers.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.568.1">Now, let’s learn how Fedora Linux implements the use of </span><span><span class="kobospan" id="kobo.569.1">open containers.</span></span></p>
<h1 id="_idParaDest-195" class="calibre5"><a id="_idTextAnchor260" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.570.1">Discovering OCI containers with Podman</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.571.1">A Linux container, roughly speaking, works</span><a id="_idIndexMarker1028" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.572.1"> like the virtualization</span><a id="_idIndexMarker1029" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.573.1"> process, where we import a </span><em class="italic"><span class="kobospan" id="kobo.574.1">pre-built image</span></em><span class="kobospan" id="kobo.575.1"> of an operating system and create a virtual machine from it. </span><span class="kobospan" id="kobo.575.2">In the case of containers, the image only packages the </span><em class="italic"><span class="kobospan" id="kobo.576.1">programs and their minimal dependencies</span></em><span class="kobospan" id="kobo.577.1"> needed for the operation of </span><span><span class="kobospan" id="kobo.578.1">an application.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.579.1">A container is a set of one or more processes that stand isolated from the rest of </span><span><span class="kobospan" id="kobo.580.1">the system.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.581.1">The kernel provides the following </span><span><span class="kobospan" id="kobo.582.1">main components:</span></span></p>
<ul class="calibre15">
<li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.583.1">namespaces</span></strong><span class="kobospan" id="kobo.584.1"> to ensure </span><span><span class="kobospan" id="kobo.585.1">process isolation</span></span></li>
<li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.586.1">cgroups</span></strong><span class="kobospan" id="kobo.587.1"> to control </span><span><span class="kobospan" id="kobo.588.1">system resources</span></span></li>
<li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.589.1">SELinux</span></strong><span class="kobospan" id="kobo.590.1"> to ensure separation </span><a id="_idIndexMarker1030" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.591.1">between the host and container, as well as </span><span><span class="kobospan" id="kobo.592.1">between containers</span></span></li>
</ul>
<p class="calibre3"><span class="kobospan" id="kobo.593.1">The administration interface interacts </span><a id="_idIndexMarker1031" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.594.1">with the kernel components and provides tools for </span><em class="italic"><span class="kobospan" id="kobo.595.1">building and managing</span></em><span class="kobospan" id="kobo.596.1"> containers. </span><span class="kobospan" id="kobo.596.2">All the files needed to run a container come from </span><span><span class="kobospan" id="kobo.597.1">an image.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.598.1">Container images live in an external</span><a id="_idIndexMarker1032" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.599.1"> repository called a </span><strong class="bold"><span class="kobospan" id="kobo.600.1">registry</span></strong><span class="kobospan" id="kobo.601.1">. </span><span class="kobospan" id="kobo.601.2">To create a container, download the registry image and generate a runnable copy of the application on the host. </span><span class="kobospan" id="kobo.601.3">These processes require a runtime and the image needs to be in a specific format </span><span><span class="kobospan" id="kobo.602.1">to run.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.603.1">The Linux Foundation</span><a id="_idIndexMarker1033" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.604.1"> sponsors the </span><strong class="bold"><span class="kobospan" id="kobo.605.1">Open Container Initiative</span></strong><span class="kobospan" id="kobo.606.1"> (</span><strong class="bold"><span class="kobospan" id="kobo.607.1">OCI</span></strong><span class="kobospan" id="kobo.608.1">) project with the purpose of creating open industry standards around container formats </span><span><span class="kobospan" id="kobo.609.1">and runtimes.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.610.1">The OCI currently contains </span><span><span class="kobospan" id="kobo.611.1">three specifications:</span></span></p>
<ul class="calibre15">
<li class="calibre14"><span class="kobospan" id="kobo.612.1">The </span><strong class="bold"><span class="kobospan" id="kobo.613.1">Runtime Specification</span></strong><span class="kobospan" id="kobo.614.1"> (</span><strong class="source-inline1"><span class="kobospan" id="kobo.615.1">runtime-spec</span></strong><span class="kobospan" id="kobo.616.1">). </span><span class="kobospan" id="kobo.616.2">This </span><a id="_idIndexMarker1034" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.617.1">specifies how to run a filesystem bundle that is unpacked </span><span><span class="kobospan" id="kobo.618.1">on disk.</span></span></li>
<li class="calibre14"><span class="kobospan" id="kobo.619.1">The </span><strong class="bold"><span class="kobospan" id="kobo.620.1">Image Specification</span></strong> <strong class="source-inline1"><span class="kobospan" id="kobo.621.1">(image-spec</span></strong><span class="kobospan" id="kobo.622.1">). </span><span class="kobospan" id="kobo.622.2">This provides</span><a id="_idIndexMarker1035" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.623.1"> interoperable tools for building, transporting, and preparing a container image </span><span><span class="kobospan" id="kobo.624.1">for running.</span></span></li>
<li class="calibre14"><span class="kobospan" id="kobo.625.1">The </span><strong class="bold"><span class="kobospan" id="kobo.626.1">Distribution Specification</span></strong><span class="kobospan" id="kobo.627.1"> (</span><strong class="source-inline1"><span class="kobospan" id="kobo.628.1">distribution-spec</span></strong><span class="kobospan" id="kobo.629.1">). </span><span class="kobospan" id="kobo.629.2">This </span><a id="_idIndexMarker1036" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.630.1">defines an API protocol to ease and standardize </span><span><span class="kobospan" id="kobo.631.1">content distribution.</span></span></li>
</ul>
<p class="calibre3"><span class="kobospan" id="kobo.632.1">An OCI implementation would download an OCI image and then unpack that image into an OCI runtime </span><span><span class="kobospan" id="kobo.633.1">filesystem bundle.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.634.1">Fedora Linux implements </span><strong class="bold"><span class="kobospan" id="kobo.635.1">Podman</span></strong><span class="kobospan" id="kobo.636.1"> for OCI </span><span><span class="kobospan" id="kobo.637.1">container management.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.638.1">Podman relies on an </span><em class="italic"><span class="kobospan" id="kobo.639.1">OCI-compliant container runtime</span></em><span class="kobospan" id="kobo.640.1"> (</span><strong class="source-inline"><span class="kobospan" id="kobo.641.1">runc</span></strong><span class="kobospan" id="kobo.642.1">, </span><strong class="source-inline"><span class="kobospan" id="kobo.643.1">crun</span></strong><span class="kobospan" id="kobo.644.1">, </span><strong class="source-inline"><span class="kobospan" id="kobo.645.1">runv</span></strong><span class="kobospan" id="kobo.646.1">, and so on) to interact with the operating system and create the running containers via the </span><span><span class="kobospan" id="kobo.647.1">command line:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer517">
<span class="kobospan" id="kobo.648.1"><img alt="Figure 13.24 – Podman interaction" src="image/B19121_13_23.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.649.1">Figure 13.24 – Podman interaction</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.650.1">Containers controlled </span><a id="_idIndexMarker1037" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.651.1">with Podman can be run by </span><strong class="source-inline"><span class="kobospan" id="kobo.652.1">root</span></strong><span class="kobospan" id="kobo.653.1"> or an </span><em class="italic"><span class="kobospan" id="kobo.654.1">unprivileged user</span></em><span class="kobospan" id="kobo.655.1">. </span><span class="kobospan" id="kobo.655.2">Podman manages the entire container ecosystem, including</span><a id="_idIndexMarker1038" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.656.1"> pods, containers, container images, and container volumes, using the </span><span><strong class="source-inline"><span class="kobospan" id="kobo.657.1">libpod</span></strong></span><span><span class="kobospan" id="kobo.658.1"> library.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.659.1">To run containers as a non-root user, you must have some considerations about the resources </span><span><span class="kobospan" id="kobo.660.1">you use:</span></span></p>
<ul class="calibre15">
<li class="calibre14"><span class="kobospan" id="kobo.661.1">The container images get stored in the user’s home directory (</span><strong class="source-inline1"><span class="kobospan" id="kobo.662.1">$HOME/.local/share/containers/storage/</span></strong><span class="kobospan" id="kobo.663.1">) instead </span><span><span class="kobospan" id="kobo.664.1">of </span></span><span><strong class="source-inline1"><span class="kobospan" id="kobo.665.1">/var/lib/containers</span></strong></span></li>
<li class="calibre14"><span class="kobospan" id="kobo.666.1">Due to not having </span><strong class="source-inline1"><span class="kobospan" id="kobo.667.1">root</span></strong><span class="kobospan" id="kobo.668.1"> privileges, these rules must </span><span><span class="kobospan" id="kobo.669.1">be followed:</span></span><ul class="calibre17"><li class="calibre14"><span class="kobospan" id="kobo.670.1">No capability to access a port less </span><span><span class="kobospan" id="kobo.671.1">than </span></span><span><strong class="source-inline1"><span class="kobospan" id="kobo.672.1">1024</span></strong></span></li><li class="calibre14"><span class="kobospan" id="kobo.673.1">Storage must live on a </span><span><span class="kobospan" id="kobo.674.1">local filesystem</span></span></li></ul></li>
</ul>
<p class="calibre3"><span class="kobospan" id="kobo.675.1">Let’s start by installing </span><span><span class="kobospan" id="kobo.676.1">the utility.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.677.1">Installing Podman requires </span><a id="_idIndexMarker1039" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.678.1">administrator privileges. </span><span class="kobospan" id="kobo.678.2">As the </span><strong class="source-inline"><span class="kobospan" id="kobo.679.1">root</span></strong><span class="kobospan" id="kobo.680.1"> user, run the </span><span><strong class="source-inline"><span class="kobospan" id="kobo.681.1">dnf</span></strong></span><span><span class="kobospan" id="kobo.682.1"> command:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.683.1">
# </span><strong class="bold1"><span class="kobospan1" id="kobo.684.1">dnf install podman</span></strong></pre> <p class="calibre3"><span class="kobospan" id="kobo.685.1">Now, let’s create an example </span><a id="_idIndexMarker1040" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.686.1">container to exemplify the scope of the utility as a </span><span><em class="italic"><span class="kobospan" id="kobo.687.1">non-root user</span></em></span><span><span class="kobospan" id="kobo.688.1">:</span></span></p>
<ol class="calibre13">
<li class="calibre14"><span class="kobospan" id="kobo.689.1">Verify </span><span><span class="kobospan" id="kobo.690.1">rootless configuration:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.691.1">
$ </span><strong class="bold1"><span class="kobospan1" id="kobo.692.1">podman unshare cat /proc/self/uid_map</span></strong></pre><p class="calibre3"><span class="kobospan" id="kobo.693.1">You should see the </span><span><span class="kobospan" id="kobo.694.1">following output:</span></span></p></li> </ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer518">
<span class="kobospan" id="kobo.695.1"><img alt="Figure 13.25 – Podman rootless configuration" src="image/B19121_13_24.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.696.1">Figure 13.25 – Podman rootless configuration</span></p>
<ol class="calibre13">
<li value="2" class="calibre14"><span class="kobospan" id="kobo.697.1">Create a base container. </span><span class="kobospan" id="kobo.697.2">Use the </span><strong class="source-inline1"><span class="kobospan" id="kobo.698.1">podman pull</span></strong><span class="kobospan" id="kobo.699.1"> command to download </span><span><span class="kobospan" id="kobo.700.1">the image:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.701.1">
$ </span><strong class="bold1"><span class="kobospan1" id="kobo.702.1">podman pull ubi9/ubi</span></strong></pre></li> </ol>
<p class="calibre3"><span class="kobospan" id="kobo.703.1">Note</span></p>
<p class="callout"><span class="kobospan" id="kobo.704.1">The Red Hat </span><strong class="bold"><span class="kobospan" id="kobo.705.1">Universal Base Image</span></strong><span class="kobospan" id="kobo.706.1"> (</span><strong class="bold"><span class="kobospan" id="kobo.707.1">UBI</span></strong><span class="kobospan" id="kobo.708.1">) enables you to build, share, and collaborate with </span><span><span class="kobospan" id="kobo.709.1">containerized</span></span><span><a id="_idIndexMarker1041" class="pcalibre1 calibre6 pcalibre"/></span><span><span class="kobospan" id="kobo.710.1"> applications.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.711.1">Here’s </span><span><span class="kobospan" id="kobo.712.1">the output:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer519">
<span class="kobospan" id="kobo.713.1"><img alt="Figure 13.26 – Obtaining the container image" src="image/B19121_13_25.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.714.1">Figure 13.26 – Obtaining the container image</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.715.1">After the download is </span><a id="_idIndexMarker1042" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.716.1">complete, verify and inspect </span><span><span class="kobospan" id="kobo.717.1">the</span></span><span><a id="_idIndexMarker1043" class="pcalibre1 calibre6 pcalibre"/></span><span><span class="kobospan" id="kobo.718.1"> image.</span></span></p>
<ol class="calibre13">
<li value="3" class="calibre14"><span class="kobospan" id="kobo.719.1">Use the </span><strong class="source-inline1"><span class="kobospan" id="kobo.720.1">podman images</span></strong><span class="kobospan" id="kobo.721.1"> command to list the </span><span><span class="kobospan" id="kobo.722.1">downloaded images:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.723.1">
$ </span><strong class="bold1"><span class="kobospan1" id="kobo.724.1">podman images</span></strong></pre><p class="calibre3"><span class="kobospan" id="kobo.725.1">Here’s </span><span><span class="kobospan" id="kobo.726.1">the output:</span></span></p></li> </ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer520">
<span class="kobospan" id="kobo.727.1"><img alt="Figure 13.27 – Listing container images" src="image/B19121_13_26.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.728.1">Figure 13.27 – Listing container images</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.729.1">Use </span><strong class="source-inline"><span class="kobospan" id="kobo.730.1">image ID</span></strong><span class="kobospan" id="kobo.731.1"> to </span><span><span class="kobospan" id="kobo.732.1">inspect it.</span></span></p>
<ol class="calibre13">
<li value="4" class="calibre14"><span class="kobospan" id="kobo.733.1">Inspecting the downloaded image provides us with information on the creation and use of the image, besides the available variables to use on it. </span><span class="kobospan" id="kobo.733.2">Use the </span><strong class="source-inline1"><span class="kobospan" id="kobo.734.1">podman inspect</span></strong><span class="kobospan" id="kobo.735.1"> command with the name of the image or </span><span><span class="kobospan" id="kobo.736.1">its ID:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.737.1">
$ </span><strong class="bold1"><span class="kobospan1" id="kobo.738.1">podman inspect 05936a40cfa4</span></strong></pre><p class="calibre3"><span class="kobospan" id="kobo.739.1">You will see the </span><span><span class="kobospan" id="kobo.740.1">following output:</span></span></p></li> </ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer521">
<span class="kobospan" id="kobo.741.1"><img alt="Figure 13.28 – Inspecting the UBI image" src="image/B19121_13_27.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.742.1">Figure 13.28 – Inspecting the UBI image</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.743.1">Now, let’s create </span><a id="_idIndexMarker1044" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.744.1">a container from the </span><span><span class="kobospan" id="kobo.745.1">downloaded</span></span><span><a id="_idIndexMarker1045" class="pcalibre1 calibre6 pcalibre"/></span><span><span class="kobospan" id="kobo.746.1"> image.</span></span></p>
<ol class="calibre13">
<li value="5" class="calibre14"><span class="kobospan" id="kobo.747.1">Run a container of the UBI image to display the operating </span><span><span class="kobospan" id="kobo.748.1">system version:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.749.1">
$ </span><strong class="bold1"><span class="kobospan1" id="kobo.750.1">podman run ubi9/ubi cat /etc/os-release</span></strong></pre><p class="calibre3"><span class="kobospan" id="kobo.751.1">Here’s </span><span><span class="kobospan" id="kobo.752.1">the output:</span></span></p></li> </ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer522">
<span class="kobospan" id="kobo.753.1"><img alt="Figure 13.29 – Running a container" src="image/B19121_13_28.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.754.1">Figure 13.29 – Running a container</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.755.1">The container is a base image of RHEL9 that’s running on </span><span><span class="kobospan" id="kobo.756.1">Fedora Linux.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.757.1">Now, let’s create an example of a containerized service. </span><span class="kobospan" id="kobo.757.2">Follow </span><span><span class="kobospan" id="kobo.758.1">these steps:</span></span></p>
<ol class="calibre13">
<li class="calibre14"><span class="kobospan" id="kobo.759.1">Use your browser to navigate </span><span><span class="kobospan" id="kobo.760.1">to </span></span><a href="https://registry.fedoraproject.org/" class="pcalibre1 calibre6 pcalibre"><span><span class="kobospan" id="kobo.761.1">https://registry.fedoraproject.org/</span></span></a><span><span class="kobospan" id="kobo.762.1">:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer523">
<span class="kobospan" id="kobo.763.1"><img alt="Figure 13.30 – Fedora Project container image registry" src="image/B19121_13_29.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.764.1">Figure 13.30 – Fedora Project container image registry</span></p>
<ol class="calibre13">
<li value="2" class="calibre14"><span class="kobospan" id="kobo.765.1">Find the</span><a id="_idIndexMarker1046" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.766.1"> latest </span><em class="italic"><span class="kobospan" id="kobo.767.1">web server image</span></em><span class="kobospan" id="kobo.768.1"> (</span><strong class="source-inline1"><span class="kobospan" id="kobo.769.1">httpd</span></strong><span class="kobospan" id="kobo.770.1">) and </span><a id="_idIndexMarker1047" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.771.1">copy its </span><span><strong class="source-inline1"><span class="kobospan" id="kobo.772.1">pull</span></strong></span><span><span class="kobospan" id="kobo.773.1"> command:</span></span><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.774.1">docker pull registry.fedoraproject.org/f29/httpd</span></strong></pre></li> </ol>
<p class="calibre3"><span class="kobospan" id="kobo.775.1">Note</span></p>
<p class="callout"><span class="kobospan" id="kobo.776.1">Change the </span><strong class="source-inline1"><span class="kobospan" id="kobo.777.1">pull</span></strong><span class="kobospan" id="kobo.778.1"> command so that it uses </span><strong class="source-inline1"><span class="kobospan" id="kobo.779.1">podman</span></strong><span class="kobospan" id="kobo.780.1"> instead </span><span><span class="kobospan" id="kobo.781.1">of </span></span><span><strong class="source-inline1"><span class="kobospan" id="kobo.782.1">docker</span></strong></span><span><span class="kobospan" id="kobo.783.1">.</span></span></p>
<ol class="calibre13">
<li value="3" class="calibre14"><span class="kobospan" id="kobo.784.1">Download the container image and </span><span><span class="kobospan" id="kobo.785.1">verify it:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.786.1">
$ </span><strong class="bold1"><span class="kobospan1" id="kobo.787.1">podman pull registry.fedoraproject.org/f29/httpd</span></strong><span class="kobospan1" id="kobo.788.1">
$ </span><strong class="bold1"><span class="kobospan1" id="kobo.789.1">podman images</span></strong></pre><p class="calibre3"><span class="kobospan" id="kobo.790.1">You should get the</span><a id="_idIndexMarker1048" class="pcalibre1 calibre6 pcalibre"/> <span><span class="kobospan" id="kobo.791.1">following output:</span></span></p></li> </ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer524">
<span class="kobospan" id="kobo.792.1"><img alt="Figure 13.31 – Getting the httpd image" src="image/B19121_13_30.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.793.1">Figure 13.31 – Getting the httpd image</span></p>
<ol class="calibre13">
<li value="4" class="calibre14"><span class="kobospan" id="kobo.794.1">Test run the </span><a id="_idIndexMarker1049" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.795.1">container for the </span><span><strong class="source-inline1"><span class="kobospan" id="kobo.796.1">httpd</span></strong></span><span><span class="kobospan" id="kobo.797.1"> image:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.798.1">
$ </span><strong class="bold1"><span class="kobospan1" id="kobo.799.1">podman run httpd</span></strong></pre><p class="calibre3"><span class="kobospan" id="kobo.800.1">Here’s </span><span><span class="kobospan" id="kobo.801.1">the output:</span></span></p></li> </ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer525">
<span class="kobospan" id="kobo.802.1"><img alt="Figure 13.32 – Running the httpd image container" src="image/B19121_13_31.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.803.1">Figure 13.32 – Running the httpd image container</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.804.1">Running the </span><strong class="source-inline"><span class="kobospan" id="kobo.805.1">httpd</span></strong><span class="kobospan" id="kobo.806.1"> image</span><a id="_idIndexMarker1050" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.807.1"> container in this way inhibits</span><a id="_idIndexMarker1051" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.808.1"> the use of the Terminal. </span><span class="kobospan" id="kobo.808.2">Let’s run it with a custom name and in </span><span><span class="kobospan" id="kobo.809.1">the background.</span></span></p>
<ol class="calibre13">
<li value="5" class="calibre14"><span class="kobospan" id="kobo.810.1">Run the </span><strong class="source-inline1"><span class="kobospan" id="kobo.811.1">httpd</span></strong><span class="kobospan" id="kobo.812.1"> image container as </span><strong class="source-inline1"><span class="kobospan" id="kobo.813.1">myapache</span></strong><span class="kobospan" id="kobo.814.1"> and in the background. </span><span class="kobospan" id="kobo.814.2">Use the </span><strong class="source-inline1"><span class="kobospan" id="kobo.815.1">--name</span></strong><span class="kobospan" id="kobo.816.1"> and </span><strong class="source-inline1"><span class="kobospan" id="kobo.817.1">-d</span></strong><span class="kobospan" id="kobo.818.1"> options with the </span><strong class="source-inline1"><span class="kobospan" id="kobo.819.1">podman </span></strong><span><strong class="source-inline1"><span class="kobospan" id="kobo.820.1">run</span></strong></span><span><span class="kobospan" id="kobo.821.1"> command:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.822.1">
$ </span><strong class="bold1"><span class="kobospan1" id="kobo.823.1">podman run --name myapache -d httpd</span></strong></pre><p class="calibre3"><span class="kobospan" id="kobo.824.1">Verify the container’s status with the </span><strong class="source-inline"><span class="kobospan" id="kobo.825.1">podman </span></strong><span><strong class="source-inline"><span class="kobospan" id="kobo.826.1">ps</span></strong></span><span><span class="kobospan" id="kobo.827.1"> command:</span></span></p><pre class="source-code"><span class="kobospan1" id="kobo.828.1">$ </span><strong class="bold1"><span class="kobospan1" id="kobo.829.1">podman ps</span></strong></pre><p class="calibre3"><span class="kobospan" id="kobo.830.1">You should see the </span><span><span class="kobospan" id="kobo.831.1">following output:</span></span></p></li> </ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer526">
<span class="kobospan" id="kobo.832.1"><img alt="Figure 13.33 – Running the container and verifying its status" src="image/B19121_13_32.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.833.1">Figure 13.33 – Running the container and verifying its status</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.834.1">Inspect the running </span><a id="_idIndexMarker1052" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.835.1">container to find information you can use to</span><a id="_idIndexMarker1053" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.836.1"> access </span><span><span class="kobospan" id="kobo.837.1">the service.</span></span></p>
<ol class="calibre13">
<li value="6" class="calibre14"><span class="kobospan" id="kobo.838.1">Use the </span><strong class="source-inline1"><span class="kobospan" id="kobo.839.1">podman </span></strong><span><strong class="source-inline1"><span class="kobospan" id="kobo.840.1">inspect</span></strong></span><span><span class="kobospan" id="kobo.841.1"> command:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.842.1">
$ </span><strong class="bold1"><span class="kobospan1" id="kobo.843.1">podman inspect myapache | grep IPAddress</span></strong><span class="kobospan1" id="kobo.844.1">
$ </span><strong class="bold1"><span class="kobospan1" id="kobo.845.1">podman inspect myapache | grep expose-service</span></strong></pre><p class="calibre3"><span class="kobospan" id="kobo.846.1">You should see </span><span><span class="kobospan" id="kobo.847.1">the following:</span></span></p></li> </ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer527">
<span class="kobospan" id="kobo.848.1"><img alt="Figure 13.34 – Looking for access to the containerized service" src="image/B19121_13_33.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.849.1">Figure 13.34 – Looking for access to the containerized service</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.850.1">The containerized service has no </span><strong class="source-inline"><span class="kobospan" id="kobo.851.1">IPAddress</span></strong><span class="kobospan" id="kobo.852.1"> assigned to it but opens ports </span><strong class="source-inline"><span class="kobospan" id="kobo.853.1">8080</span></strong><span class="kobospan" id="kobo.854.1"> and </span><strong class="source-inline"><span class="kobospan" id="kobo.855.1">8443</span></strong><span class="kobospan" id="kobo.856.1">. </span><span class="kobospan" id="kobo.856.2">Check the logs for </span><span><span class="kobospan" id="kobo.857.1">more information.</span></span></p>
<ol class="calibre13">
<li value="7" class="calibre14"><span class="kobospan" id="kobo.858.1">Use the </span><strong class="source-inline1"><span class="kobospan" id="kobo.859.1">podman logs</span></strong><span class="kobospan" id="kobo.860.1"> command to review </span><span><span class="kobospan" id="kobo.861.1">the logs:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.862.1">
$ </span><strong class="bold1"><span class="kobospan1" id="kobo.863.1">podman logs myapache</span></strong></pre><p class="calibre3"><span class="kobospan" id="kobo.864.1">Here’s </span><span><span class="kobospan" id="kobo.865.1">the output:</span></span></p></li> </ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer528">
<span class="kobospan" id="kobo.866.1"><img alt="Figure 13.35 – Reviewing service logs" src="image/B19121_13_34.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.867.1">Figure 13.35 – Reviewing service logs</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.868.1">In the logs of the </span><a id="_idIndexMarker1054" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.869.1">containerized service, find the IP address that </span><a id="_idIndexMarker1055" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.870.1">opens port </span><strong class="source-inline"><span class="kobospan" id="kobo.871.1">8443</span></strong><span class="kobospan" id="kobo.872.1">. </span><span class="kobospan" id="kobo.872.2">Verify access to the service with </span><span><span class="kobospan" id="kobo.873.1">this information.</span></span></p>
<ol class="calibre13">
<li value="8" class="calibre14"><span class="kobospan" id="kobo.874.1">Verify access to the containerized service. </span><span class="kobospan" id="kobo.874.2">Use the following </span><span><strong class="source-inline1"><span class="kobospan" id="kobo.875.1">curl</span></strong></span><span><span class="kobospan" id="kobo.876.1"> command:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.877.1">
$ </span><strong class="bold1"><span class="kobospan1" id="kobo.878.1">curl 10.0.2.100:8443</span></strong></pre><p class="calibre3"><span class="kobospan" id="kobo.879.1">Here’s </span><span><span class="kobospan" id="kobo.880.1">the output:</span></span></p></li> </ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer529">
<span class="kobospan" id="kobo.881.1"><img alt="Figure 13.36 – Verifying access to the web service" src="image/B19121_13_35.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.882.1">Figure 13.36 – Verifying access to the web service</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.883.1">The service fails to answer on port </span><strong class="source-inline"><span class="kobospan" id="kobo.884.1">8443</span></strong> <span><span class="kobospan" id="kobo.885.1">or </span></span><span><strong class="source-inline"><span class="kobospan" id="kobo.886.1">8080</span></strong></span><span><span class="kobospan" id="kobo.887.1">.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.888.1">This is due to the container port not referring to a host port. </span><span class="kobospan" id="kobo.888.2">Delete the container and recreate </span><a id="_idIndexMarker1056" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.889.1">it with the reference to a </span><span><span class="kobospan" id="kobo.890.1">local port.</span></span></p>
<ol class="calibre13">
<li value="9" class="calibre14"><span class="kobospan" id="kobo.891.1">Remove the</span><a id="_idIndexMarker1057" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.892.1"> container. </span><span class="kobospan" id="kobo.892.2">First, use the </span><strong class="source-inline1"><span class="kobospan" id="kobo.893.1">stop</span></strong><span class="kobospan" id="kobo.894.1"> option to interrupt the container run and then the </span><strong class="source-inline1"><span class="kobospan" id="kobo.895.1">rm</span></strong><span class="kobospan" id="kobo.896.1"> option to delete the container with the </span><span><strong class="source-inline1"><span class="kobospan" id="kobo.897.1">podman</span></strong></span><span><span class="kobospan" id="kobo.898.1"> command:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.899.1">
$ </span><strong class="bold1"><span class="kobospan1" id="kobo.900.1">podman stop myapache</span></strong><span class="kobospan1" id="kobo.901.1">
$ </span><strong class="bold1"><span class="kobospan1" id="kobo.902.1">podman rm myapache</span></strong></pre><p class="calibre3"><span class="kobospan" id="kobo.903.1">You should see the </span><span><span class="kobospan" id="kobo.904.1">following output:</span></span></p></li> </ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer530">
<span class="kobospan" id="kobo.905.1"><img alt="Figure 13.37 – Removing the container" src="image/B19121_13_36.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.906.1">Figure 13.37 – Removing the container</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.907.1">Verify that the </span><strong class="source-inline"><span class="kobospan" id="kobo.908.1">myapache</span></strong><span class="kobospan" id="kobo.909.1"> container is not running anymore. </span><span class="kobospan" id="kobo.909.2">Use the </span><strong class="source-inline"><span class="kobospan" id="kobo.910.1">podman ps</span></strong><span class="kobospan" id="kobo.911.1"> command to </span><span><span class="kobospan" id="kobo.912.1">do so.</span></span></p>
<ol class="calibre13">
<li value="10" class="calibre14"><span class="kobospan" id="kobo.913.1">Recreate the </span><strong class="source-inline1"><span class="kobospan" id="kobo.914.1">myapache</span></strong><span class="kobospan" id="kobo.915.1"> container by mapping the container’s port, </span><strong class="source-inline1"><span class="kobospan" id="kobo.916.1">8080</span></strong><span class="kobospan" id="kobo.917.1">, to local port </span><strong class="source-inline1"><span class="kobospan" id="kobo.918.1">8080</span></strong><span class="kobospan" id="kobo.919.1">. </span><span class="kobospan" id="kobo.919.2">Add the </span><strong class="source-inline1"><span class="kobospan" id="kobo.920.1">-p</span></strong><span class="kobospan" id="kobo.921.1"> option to the </span><strong class="source-inline1"><span class="kobospan" id="kobo.922.1">podman run</span></strong><span class="kobospan" id="kobo.923.1"> command that we ran in </span><span><em class="italic"><span class="kobospan" id="kobo.924.1">step 4</span></em></span><span><span class="kobospan" id="kobo.925.1">:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.926.1">
$ </span><strong class="bold1"><span class="kobospan1" id="kobo.927.1">podman run --name myapache -d -p 8080:8080 httpd</span></strong></pre><p class="calibre3"><span class="kobospan" id="kobo.928.1">Here’s </span><span><span class="kobospan" id="kobo.929.1">the output:</span></span></p></li> </ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer531">
<span class="kobospan" id="kobo.930.1"><img alt="Figure 13.38 – Mapping the container port to the local port" src="image/B19121_13_37.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.931.1">Figure 13.38 – Mapping the container port to the local port</span></p>
<ol class="calibre13">
<li value="11" class="calibre14"><span class="kobospan" id="kobo.932.1">Use the </span><strong class="source-inline1"><span class="kobospan" id="kobo.933.1">podman ps</span></strong><span class="kobospan" id="kobo.934.1"> command </span><a id="_idIndexMarker1058" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.935.1">to confirm that the port was </span><span><span class="kobospan" id="kobo.936.1">mapped correctly.</span></span></li>
<li class="calibre14"><span class="kobospan" id="kobo.937.1">Test the service </span><a id="_idIndexMarker1059" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.938.1">again but on local </span><span><span class="kobospan" id="kobo.939.1">port </span></span><span><strong class="source-inline1"><span class="kobospan" id="kobo.940.1">8080</span></strong></span><span><span class="kobospan" id="kobo.941.1">:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.942.1">
$ </span><strong class="bold1"><span class="kobospan1" id="kobo.943.1">curl localhost:8080</span></strong></pre><p class="calibre3"><span class="kobospan" id="kobo.944.1">You should see the </span><span><span class="kobospan" id="kobo.945.1">following output:</span></span></p></li> </ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer532">
<span class="kobospan" id="kobo.946.1"><img alt="Figure 13.39 – Testing service access" src="image/B19121_13_38.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.947.1">Figure 13.39 – Testing service access</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.948.1">Now that the service is accessible, it shows the Apache </span><span><span class="kobospan" id="kobo.949.1">test page.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.950.1">An application that always runs on a single host accesses local disk storage to get the information it needs while running. </span><span class="kobospan" id="kobo.950.2">These storage volumes remain both </span><em class="italic"><span class="kobospan" id="kobo.951.1">logically</span></em><span class="kobospan" id="kobo.952.1"> and </span><em class="italic"><span class="kobospan" id="kobo.953.1">physically</span></em><span class="kobospan" id="kobo.954.1"> persistent. </span><span class="kobospan" id="kobo.954.2">Containerized </span><a id="_idIndexMarker1060" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.955.1">dynamic and elastic deployments separate the logical and physical </span><a id="_idIndexMarker1061" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.956.1">states of </span><span><span class="kobospan" id="kobo.957.1">application storage.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.958.1">A containerized application could be </span><em class="italic"><span class="kobospan" id="kobo.959.1">logically resident but physically transient</span></em><span class="kobospan" id="kobo.960.1"> due to the redistribution and scaling capabilities inherent in </span><span><span class="kobospan" id="kobo.961.1">OCI technologies.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.962.1">If a container resides on a host, but that container stops working, the container manager could start a new instance on another host. </span><span class="kobospan" id="kobo.962.2">The application may need some data available when it is</span><a id="_idIndexMarker1062" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.963.1"> running; this is known as logical persistence. </span><span class="kobospan" id="kobo.963.2">Since container information is ephemeral by default, the storage is </span><span><span class="kobospan" id="kobo.964.1">physically transient.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.965.1">In containerized storage in </span><a id="_idIndexMarker1063" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.966.1">general, the trend is to integrate </span><em class="italic"><span class="kobospan" id="kobo.967.1">persistent storage</span></em><span class="kobospan" id="kobo.968.1"> with </span><em class="italic"><span class="kobospan" id="kobo.969.1">ephemeral containers</span></em><span class="kobospan" id="kobo.970.1"> as best </span><span><span class="kobospan" id="kobo.971.1">as possible.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.972.1">Now, let’s learn how to add persistent </span><a id="_idIndexMarker1064" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.973.1">storage to our containerized service. </span><span class="kobospan" id="kobo.973.2">Follow </span><span><span class="kobospan" id="kobo.974.1">these steps:</span></span></p>
<ol class="calibre13">
<li class="calibre14"><span class="kobospan" id="kobo.975.1">Stop and remove the </span><span><strong class="source-inline1"><span class="kobospan" id="kobo.976.1">myapache</span></strong></span><span><span class="kobospan" id="kobo.977.1"> container:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.978.1">
$ </span><strong class="bold1"><span class="kobospan1" id="kobo.979.1">podman stop myapache</span></strong><span class="kobospan1" id="kobo.980.1">
$ </span><strong class="bold1"><span class="kobospan1" id="kobo.981.1">podman rm myapache</span></strong></pre></li> <li class="calibre14"><span class="kobospan" id="kobo.982.1">In the user’s home directory, create the working directory for persistent storage of the </span><span><strong class="source-inline1"><span class="kobospan" id="kobo.983.1">myapache</span></strong></span><span><span class="kobospan" id="kobo.984.1"> container:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.985.1">
$ </span><strong class="bold1"><span class="kobospan1" id="kobo.986.1">mkdir –p ~/containers/myapache/var/www/html</span></strong></pre><p class="calibre3"><span class="kobospan" id="kobo.987.1">Now, let’s create a custom home page for </span><span><span class="kobospan" id="kobo.988.1">our service.</span></span></p></li> <li class="calibre14"><span class="kobospan" id="kobo.989.1">Create the </span><strong class="source-inline1"><span class="kobospan" id="kobo.990.1">index.html</span></strong><span class="kobospan" id="kobo.991.1"> file inside the persistent storage directory we created for the </span><span><strong class="source-inline1"><span class="kobospan" id="kobo.992.1">myapache</span></strong></span><span><span class="kobospan" id="kobo.993.1"> container:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.994.1">
$ </span><strong class="bold1"><span class="kobospan1" id="kobo.995.1">echo "Hello from myapache container!" </span><span class="kobospan1" id="kobo.995.2">&gt; ~/containers/myapache/var/www/html/index.html</span></strong></pre></li> <li class="calibre14"><span class="kobospan" id="kobo.996.1">Regenerate the </span><strong class="source-inline1"><span class="kobospan" id="kobo.997.1">myapache</span></strong><span class="kobospan" id="kobo.998.1"> container with the </span><strong class="source-inline1"><span class="kobospan" id="kobo.999.1">-v</span></strong><span class="kobospan" id="kobo.1000.1"> option to add persistent storage as a volume of the </span><span><strong class="source-inline1"><span class="kobospan" id="kobo.1001.1">myapache</span></strong></span><span><span class="kobospan" id="kobo.1002.1"> container.</span></span></li>
<li class="calibre14"><span class="kobospan" id="kobo.1003.1">Run the container again with the option to attach the volume mentioned previously. </span><span class="kobospan" id="kobo.1003.2">As with the port, the local directory must be mapped to the container directory. </span><span class="kobospan" id="kobo.1003.3">In this case, since it deals with files, add the </span><strong class="source-inline1"><span class="kobospan" id="kobo.1004.1">-Z</span></strong><span class="kobospan" id="kobo.1005.1"> option to apply the SELinux policy from the container directory to the </span><span><span class="kobospan" id="kobo.1006.1">local directory:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.1007.1">
$ </span><strong class="bold1"><span class="kobospan1" id="kobo.1008.1">podman run --name myapache -d -p 8080:8080 -v ~/containers/myapache/var/www/html:/var/www/html:Z httpd</span></strong></pre></li> <li class="calibre14"><span class="kobospan" id="kobo.1009.1">Verify that the container is running, as well as that you have access to </span><span><span class="kobospan" id="kobo.1010.1">the service:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer533">
<span class="kobospan" id="kobo.1011.1"><img alt="Figure 13.40 – Testing the container with persistent storage" src="image/B19121_13_39.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1012.1">Figure 13.40 – Testing the container with persistent storage</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1013.1">Now, our web service has persistent storage. </span><span class="kobospan" id="kobo.1013.2">This can be managed locally or independently of the</span><a id="_idIndexMarker1065" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1014.1"> container instance(s) running with </span><span><span class="kobospan" id="kobo.1015.1">the content.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1016.1">This service could </span><a id="_idIndexMarker1066" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1017.1">manage itself as a container and give this management to </span><strong class="source-inline"><span class="kobospan" id="kobo.1018.1">systemd</span></strong><span class="kobospan" id="kobo.1019.1"> as part of the system. </span><span class="kobospan" id="kobo.1019.2">Let’s learn how set up self-management. </span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1020.1">Using the same </span><strong class="source-inline"><span class="kobospan" id="kobo.1021.1">myapache</span></strong><span class="kobospan" id="kobo.1022.1"> container from the previous example, follow </span><span><span class="kobospan" id="kobo.1023.1">these steps:</span></span></p>
<ol class="calibre13">
<li class="calibre14"><span class="kobospan" id="kobo.1024.1">Stop and remove the </span><span><strong class="source-inline1"><span class="kobospan" id="kobo.1025.1">myapache</span></strong></span><span><span class="kobospan" id="kobo.1026.1"> container:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.1027.1">
$ </span><strong class="bold1"><span class="kobospan1" id="kobo.1028.1">podman stop myapache</span></strong><span class="kobospan1" id="kobo.1029.1">
$ </span><strong class="bold1"><span class="kobospan1" id="kobo.1030.1">podman rm myapache</span></strong></pre></li> <li class="calibre14"><span class="kobospan" id="kobo.1031.1">To make the </span><strong class="source-inline1"><span class="kobospan" id="kobo.1032.1">myapache</span></strong><span class="kobospan" id="kobo.1033.1"> container self-managed, add a command that determines the health of the container. </span><span class="kobospan" id="kobo.1033.2">In our case, we will use the </span><strong class="source-inline1"><span class="kobospan" id="kobo.1034.1">curl</span></strong><span class="kobospan" id="kobo.1035.1"> command from the previous example. </span><span class="kobospan" id="kobo.1035.2">Use the </span><strong class="source-inline1"><span class="kobospan" id="kobo.1036.1">--health-cmd</span></strong><span class="kobospan" id="kobo.1037.1"> and </span><strong class="source-inline1"><span class="kobospan" id="kobo.1038.1">--health-interval</span></strong><span class="kobospan" id="kobo.1039.1"> options to define them in </span><span><span class="kobospan" id="kobo.1040.1">the container:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.1041.1">
$ </span><strong class="bold1"><span class="kobospan1" id="kobo.1042.1">podman run --name myapache -d -p 8080:8080 -v ~/containers/myapache/var/www/html:/var/www/html:Z --health-cmd="curl localhost:8080 || exit 1" --health-interval=0 httpd</span></strong></pre><p class="calibre3"><span class="kobospan" id="kobo.1043.1">Here’s </span><span><span class="kobospan" id="kobo.1044.1">the output:</span></span></p></li> </ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer534">
<span class="kobospan" id="kobo.1045.1"><img alt="Figure 13.41 – Making the container self-managed" src="image/B19121_13_40.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1046.1">Figure 13.41 – Making the container self-managed</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1047.1">Verify the creation </span><a id="_idIndexMarker1067" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1048.1">of the container. </span><span class="kobospan" id="kobo.1048.2">Then, use the </span><strong class="source-inline"><span class="kobospan" id="kobo.1049.1">podman </span></strong><span><strong class="source-inline"><span class="kobospan" id="kobo.1050.1">ps</span></strong></span><span><span class="kobospan" id="kobo.1051.1"> command.</span></span></p>
<ol class="calibre13">
<li value="3" class="calibre14"><span class="kobospan" id="kobo.1052.1">To check the</span><a id="_idIndexMarker1068" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1053.1"> health of the container, run the </span><strong class="source-inline1"><span class="kobospan" id="kobo.1054.1">podman healthcheck </span></strong><span><strong class="source-inline1"><span class="kobospan" id="kobo.1055.1">run</span></strong></span><span><span class="kobospan" id="kobo.1056.1"> command:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.1057.1">
$ </span><strong class="bold1"><span class="kobospan1" id="kobo.1058.1">podman healthcheck run myapache</span></strong></pre><p class="calibre3"><span class="kobospan" id="kobo.1059.1">Here’s </span><span><span class="kobospan" id="kobo.1060.1">the output:</span></span></p></li> </ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer535">
<span class="kobospan" id="kobo.1061.1"><img alt="Figure 13.42 – Reviewing the health of the container" src="image/B19121_13_41.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1062.1">Figure 13.42 – Reviewing the health of the container</span></p>
<ol class="calibre13">
<li value="4" class="calibre14"><span class="kobospan" id="kobo.1063.1">The output of the preceding command should return nothing. </span><span class="kobospan" id="kobo.1063.2">Run an </span><strong class="source-inline1"><span class="kobospan" id="kobo.1064.1">echo</span></strong><span class="kobospan" id="kobo.1065.1"> command on the special variable, </span><strong class="source-inline1"><span class="kobospan" id="kobo.1066.1">$?</span></strong><span class="kobospan" id="kobo.1067.1">, to get the output of </span><span><span class="kobospan" id="kobo.1068.1">the command:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.1069.1">
$ </span><strong class="bold1"><span class="kobospan1" id="kobo.1070.1">echo $?</span></strong></pre><p class="calibre3"><span class="kobospan" id="kobo.1071.1">If it is equal to zero (</span><strong class="source-inline"><span class="kobospan" id="kobo.1072.1">0</span></strong><span class="kobospan" id="kobo.1073.1">), the command ran </span><em class="italic"><span class="kobospan" id="kobo.1074.1">successfully</span></em><span class="kobospan" id="kobo.1075.1">, which means that the health of the container </span><span><span class="kobospan" id="kobo.1076.1">is good.</span></span></p></li> </ol>
<p class="calibre3"><span class="kobospan" id="kobo.1077.1">Thus, the </span><strong class="source-inline"><span class="kobospan" id="kobo.1078.1">myapache</span></strong><span class="kobospan" id="kobo.1079.1"> container indicates when it is working correctly – that is, it is self-managing. </span><span class="kobospan" id="kobo.1079.2">This management could delegate to the operating system as part of one of its services. </span><span class="kobospan" id="kobo.1079.3">For this, </span><strong class="source-inline"><span class="kobospan" id="kobo.1080.1">systemd</span></strong><span class="kobospan" id="kobo.1081.1"> must be set up to support services that are started from the user session. </span><span class="kobospan" id="kobo.1081.2">Follow </span><span><span class="kobospan" id="kobo.1082.1">these steps:</span></span></p>
<ol class="calibre13">
<li class="calibre14"><span class="kobospan" id="kobo.1083.1">As </span><strong class="source-inline1"><span class="kobospan" id="kobo.1084.1">root</span></strong><span class="kobospan" id="kobo.1085.1">, enable user lingering by running the </span><span><strong class="source-inline1"><span class="kobospan" id="kobo.1086.1">loginctl</span></strong></span><span><span class="kobospan" id="kobo.1087.1"> command:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.1088.1">
# </span><strong class="bold1"><span class="kobospan1" id="kobo.1089.1">loginctl enable-linger acallejas</span></strong></pre></li> <li class="calibre14"><span class="kobospan" id="kobo.1090.1">Create a</span><a id="_idIndexMarker1069" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1091.1"> directory to host the containerized services </span><a id="_idIndexMarker1070" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1092.1">and change to </span><span><span class="kobospan" id="kobo.1093.1">that directory:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.1094.1">
$ </span><strong class="bold1"><span class="kobospan1" id="kobo.1095.1">mkdir -p ~/.config/systemd/containerized-services</span></strong><span class="kobospan1" id="kobo.1096.1">
$ </span><strong class="bold1"><span class="kobospan1" id="kobo.1097.1">cd ~/.config/systemd/containerized-services</span></strong></pre></li> <li class="calibre14"><span class="kobospan" id="kobo.1098.1">Build the configuration files for </span><strong class="source-inline1"><span class="kobospan" id="kobo.1099.1">systemd</span></strong><span class="kobospan" id="kobo.1100.1"> using the </span><strong class="source-inline1"><span class="kobospan" id="kobo.1101.1">podman </span></strong><span><strong class="source-inline1"><span class="kobospan" id="kobo.1102.1">generate</span></strong></span><span><span class="kobospan" id="kobo.1103.1"> command:</span></span><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.1104.1">podman generate systemd --name myapache --files</span></strong></pre><p class="calibre3"><span class="kobospan" id="kobo.1105.1">Here’s </span><span><span class="kobospan" id="kobo.1106.1">the output:</span></span></p></li> </ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer536">
<span class="kobospan" id="kobo.1107.1"><img alt="Figure 13.43 – Containerized service configuration file" src="image/B19121_13_42.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1108.1">Figure 13.43 – Containerized service configuration file</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1109.1">The preceding command creates the </span><strong class="source-inline"><span class="kobospan" id="kobo.1110.1">container-myapache.service</span></strong><span class="kobospan" id="kobo.1111.1"> unit file with the configuration for </span><strong class="source-inline"><span class="kobospan" id="kobo.1112.1">systemd</span></strong> <span><span class="kobospan" id="kobo.1113.1">to manage.</span></span></p>
<ol class="calibre13">
<li value="4" class="calibre14"><span class="kobospan" id="kobo.1114.1">Reload the user’s daemons by running the following </span><span><strong class="source-inline1"><span class="kobospan" id="kobo.1115.1">systemctl</span></strong></span><span><span class="kobospan" id="kobo.1116.1"> command:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.1117.1">
$ </span><strong class="bold1"><span class="kobospan1" id="kobo.1118.1">systemctl --user daemon-reload</span></strong></pre></li> <li class="calibre14"><span class="kobospan" id="kobo.1119.1">Enable the user’s containerized service by running the following </span><span><strong class="source-inline1"><span class="kobospan" id="kobo.1120.1">systemctl</span></strong></span><span><span class="kobospan" id="kobo.1121.1"> command:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.1122.1">
$ </span><strong class="bold1"><span class="kobospan1" id="kobo.1123.1">systemctl --user enable --now ~/.config/systemd/containerized-services/container-myapache.service</span></strong></pre></li> <li class="calibre14"><span class="kobospan" id="kobo.1124.1">Verify the status </span><a id="_idIndexMarker1071" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1125.1">of the containerized service by running the following </span><span><strong class="source-inline1"><span class="kobospan" id="kobo.1126.1">systemctl</span></strong></span><span><span class="kobospan" id="kobo.1127.1"> command:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.1128.1">
$ </span><strong class="bold1"><span class="kobospan1" id="kobo.1129.1">systemctl --user status container-myapache</span></strong></pre><p class="calibre3"><span class="kobospan" id="kobo.1130.1">You should</span><a id="_idIndexMarker1072" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1131.1"> see the </span><span><span class="kobospan" id="kobo.1132.1">following output:</span></span></p></li> </ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer537">
<span class="kobospan" id="kobo.1133.1"><img alt="Figure 13.44 – Verifying the containerized service" src="image/B19121_13_43.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1134.1">Figure 13.44 – Verifying the containerized service</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1135.1">Finally, verify that the containerized service continues to operate. </span><span class="kobospan" id="kobo.1135.2">Use the </span><strong class="source-inline"><span class="kobospan" id="kobo.1136.1">curl</span></strong><span class="kobospan" id="kobo.1137.1"> command we </span><span><span class="kobospan" id="kobo.1138.1">used previously.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1139.1">With that, we’ve learned how to use OCI containers, from their simple use to creating a containerized service that’s managed by the </span><span><span class="kobospan" id="kobo.1140.1">operating system.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1141.1">Fedora Linux implements the use of OCI containers as a way to ease service management. </span><span class="kobospan" id="kobo.1141.2">With this bouquet of possibilities, depending on the workload, we can choose a virtual machine, either created with a cloud-based image or created with its installation image traditionally. </span><span class="kobospan" id="kobo.1141.3">Alternatively, we can use containers if we only need to deploy a simple service </span><a id="_idIndexMarker1073" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1142.1">such </span><span><span class="kobospan" id="kobo.1143.1">as </span></span><span><strong class="source-inline"><span class="kobospan" id="kobo.1144.1">myapache</span></strong></span><span><span class="kobospan" id="kobo.1145.1">.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1146.1">I hope these options can help you improve</span><a id="_idIndexMarker1074" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1147.1"> the performance of your day-to-day tasks as a Linux </span><span><span class="kobospan" id="kobo.1148.1">system administrator.</span></span></p>
<h1 id="_idParaDest-196" class="calibre5"><a id="_idTextAnchor261" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1149.1">Summary</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.1150.1">In this chapter, we provided a quick overview of the methods for creating a virtual machine. </span><span class="kobospan" id="kobo.1150.2">In my opinion, the easiest and fastest way is to rely on the use of pre-built cloud images. </span><span class="kobospan" id="kobo.1150.3">In a couple of steps, and with enough practice, we can have them working in a matter </span><span><span class="kobospan" id="kobo.1151.1">of minutes.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1152.1">Besides that, we used Gnome Boxes as a traditional method of creating virtual machines with an installation image. </span><span class="kobospan" id="kobo.1152.2">This method is a bit slower but allows us to customize the guest operating </span><span><span class="kobospan" id="kobo.1153.1">system installation.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1154.1">Next, we looked at services, where we learned how to use OCI containers implemented by Fedora Linux. </span><span class="kobospan" id="kobo.1154.2">This is a simple option for creating containerized services because it gives us the power to customize them so that they meet our needs. </span><span class="kobospan" id="kobo.1154.3">For example, we can use them for persistent storage, self-management, or even to delegate a containerized service as a system service managed </span><span><span class="kobospan" id="kobo.1155.1">by </span></span><span><strong class="source-inline"><span class="kobospan" id="kobo.1156.1">systemd</span></strong></span><span><span class="kobospan" id="kobo.1157.1">.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1158.1">All these tools make up an arsenal that could ease the performance of a Linux system administrator’s day-to-day tasks. </span><span class="kobospan" id="kobo.1158.2">As we mentioned in </span><a href="B19121_10_split_000.xhtml#_idTextAnchor208" class="pcalibre1 calibre6 pcalibre"><span><em class="italic"><span class="kobospan" id="kobo.1159.1">Chapter 10</span></em></span></a><span class="kobospan" id="kobo.1160.1">, “</span><em class="italic"><span class="kobospan" id="kobo.1161.1">a good system administrator backs up, automates, and studies in their </span></em><span><em class="italic"><span class="kobospan" id="kobo.1162.1">spare time</span></em></span><span><span class="kobospan" id="kobo.1163.1">.”</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1164.1">Congratulations on making it to the end of this book! </span><span class="kobospan" id="kobo.1164.2">I hope you found </span><span><span class="kobospan" id="kobo.1165.1">it useful.</span></span></p>
<h1 id="_idParaDest-197" class="calibre5"><a id="_idTextAnchor262" class="pcalibre1 calibre6 pcalibre"/><span class="kobospan" id="kobo.1166.1">Further reading</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.1167.1">To learn more about the topics covered in this chapter, you can visit the </span><span><span class="kobospan" id="kobo.1168.1">following link:</span></span></p>
<ul class="calibre15">
<li class="calibre14"><em class="italic"><span class="kobospan" id="kobo.1169.1">Build a lab in 5 minutes with three simple </span></em><span><em class="italic"><span class="kobospan" id="kobo.1170.1">commands</span></em></span><span><span class="kobospan" id="kobo.1171.1">: </span></span><a href="https://www.redhat.com/sysadmin/build-lab-quickly" class="pcalibre1 calibre6 pcalibre"><span><span class="kobospan" id="kobo.1172.1">https://www.redhat.com/sysadmin/build-lab-quickly</span></span></a></li>
</ul>
</div>
</body></html>