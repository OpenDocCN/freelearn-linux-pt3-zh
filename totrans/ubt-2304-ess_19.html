<html><head></head><body>
<div class="_idGenObjectStyleOverride-1" id="_idContainer266">
<p class="Chapter-Title" id="_idParaDest-185" lang="en-US"><span class="ChapterMarker"><span class="koboSpan" id="kobo.1.1">20. </span></span><a id="_idTextAnchor327"/><span class="koboSpan" id="kobo.2.1">Using NFS on Ubuntu 23.04 to Share Files with Remote Systems</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.3.1">Ubuntu provides two mechanisms for sharing files and folders with other systems on a network. </span><span class="koboSpan" id="kobo.3.2">One approach is to use a technology called Samba. </span><span class="koboSpan" id="kobo.3.3">Samba is based on Microsoft Windows Folder Sharing and allows Linux systems to make folders accessible to Windows systems and access Windows-based folder shares from Linux. </span><span class="koboSpan" id="kobo.3.4">This approach can also be used to share folders between other Linux and UNIX-based systems if they have Samba support installed and configured. </span><span class="koboSpan" id="kobo.3.5">This is the most popular approach to sharing folders in heterogeneous network environments. </span><span class="koboSpan" id="kobo.3.6">Folder sharing using Samba is covered in </span><a href="Samba_File_Sharing.xhtml#_idTextAnchor340"><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.4.1">“Sharing Files between Ubuntu 23.04 and Windows with Samba”</span></span></a><span class="koboSpan" id="kobo.5.1">. </span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.6.1">Another option, explicitly targeted at sharing folders between Linux and UNIX-based systems, uses Network File System (NFS). </span><span class="koboSpan" id="kobo.6.2">NFS allows the file system on one Linux computer to be accessed over a network connection by another Linux or UNIX system. </span><span class="koboSpan" id="kobo.6.3">NFS was originally developed by Sun Microsystems (now part of Oracle Corporation) in the 1980s and remains the standard mechanism for sharing remote Linux/UNIX file systems. </span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.7.1">NFS is very different from the Windows SMB resource-sharing technology used by </span><a id="_idIndexMarker472"/><span class="koboSpan" id="kobo.8.1">Samba. </span><span class="koboSpan" id="kobo.8.2">This chapter will look at the network-based sharing of folders between Ubuntu and other UNIX/Linux-based systems using NFS. </span></p>
<p class="Heading-1-1" id="_idParaDest-186" lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.9.1">20.1 </span></span><a id="_idTextAnchor328"/><span class="koboSpan" id="kobo.10.1">Ensuring NFS Services are running on Ubuntu</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.11.1">The first task is to verify that the NFS services are installed and running on your Ubuntu system. </span><span class="koboSpan" id="kobo.11.2">This can be achieved from the command line or the Cockpit interface.</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.12.1">Begin by installing the NFS service by running the following command from a terminal window:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.13.1"># apt install nfs-kernel-server</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.14.1">Next, configure the service to automatically start at boot time:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.15.1"># systemctl enable nfs-kernel-server</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.16.1">Once the service has been enabled, start it as follows:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.17.1"># systemctl start nfs-kernel-server</span></p>
<p class="Heading-1-1" id="_idParaDest-187" lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.18.1">20.2 </span></span><a id="_idTextAnchor329"/><a id="_idTextAnchor330"/><span class="koboSpan" id="kobo.19.1">Configuring the Firewall to Allow </span><a id="_idIndexMarker473"/><span class="koboSpan" id="kobo.20.1">NFS Traffic </span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.21.1">Next, the firewall needs to be configured to allow NFS traffic. </span><span class="koboSpan" id="kobo.21.2">If the Uncomplicated Firewall is enabled, run the following command to add a rule to allow NFS traffic:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.22.1"># ufw allow nfs</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.23.1">If, on the other hand, you are using firewalld, run the following </span><a id="_idIndexMarker475"/><span class="My-Italic CharOverride-1"><span class="koboSpan" id="kobo.24.1">firewall-cmd </span></span><span class="koboSpan" id="kobo.25.1">commands where &lt;zone&gt; is replaced by the appropriate zone for your firewall and system configuration:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.26.1"># firewall-cmd --zone=</span><span class="My-Italic CharOverride-2"><span class="koboSpan" id="kobo.27.1">&lt;zone&gt;</span></span><span class="koboSpan" id="kobo.28.1"> --permanent --add-service=mountd</span></p>
<p class="Code"><span class="koboSpan" id="kobo.29.1"># firewall-cmd --zone=</span><span class="My-Italic CharOverride-2"><span class="koboSpan" id="kobo.30.1">&lt;zone&gt;</span></span><span class="koboSpan" id="kobo.31.1"> --permanent --add-service=nfs</span></p>
<p class="Code"><span class="koboSpan" id="kobo.32.1"># firewall-cmd --zone=</span><span class="My-Italic CharOverride-2"><span class="koboSpan" id="kobo.33.1">&lt;zone&gt;</span></span><span class="koboSpan" id="kobo.34.1"> --permanent --add-service=rpc-bind</span></p>
<p class="Code"><span class="koboSpan" id="kobo.35.1"># firewall-cmd --reload</span></p>
<p class="Heading-1-1" id="_idParaDest-188" lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.36.1">20.3 </span></span><a id="_idTextAnchor331"/><span class="koboSpan" id="kobo.37.1">Specifying the Folders to be Shared </span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.38.1">Now that NFS is running and the firewall has been configured, we need to specify which parts of the Ubuntu file system may be accessed by remote Linux or UNIX systems. </span><span class="koboSpan" id="kobo.38.2">These settings can be declared in the </span><a id="_idIndexMarker476"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.39.1">/etc/exports</span></span><span class="koboSpan" id="kobo.40.1"> file, which must be modified to export the directories for remote access via NFS. </span><span class="koboSpan" id="kobo.40.2">The syntax for an export line in this file is as follows:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.41.1">&lt;export&gt; &lt;host1&gt;(&lt;options&gt;) &lt;host2&gt;(&lt;options&gt;)...</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.42.1">In the above line, &lt;export&gt; is replaced by the directory to be exported, &lt;host1&gt; is the name or IP address of the system to which access is being granted, and &lt;options&gt; represents the restrictions that are to be imposed on that access (read-only, read-write, etc.). </span><span class="koboSpan" id="kobo.42.2">Multiple host and options entries may be placed on the same line if required. </span><span class="koboSpan" id="kobo.42.3">For example, the following line grants read-only permission to the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.43.1">/datafiles</span></span><span class="koboSpan" id="kobo.44.1"> directory to a host with the IP address 192.168.2.38:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.45.1">/datafiles 192.168.2.38(ro,no_subtree_check)</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.46.1">The use of wildcards is permitted to apply an export to multiple hosts. </span><span class="koboSpan" id="kobo.46.2">For example, the following line permits read-write access to </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.47.1">/home/demo</span></span><span class="koboSpan" id="kobo.48.1"> to all external hosts:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.49.1">/home/demo *(rw,no_subtree_check)</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.50.1">While most Linux distributions default to the recommended </span><span class="My-Italic CharOverride-1"><span class="koboSpan" id="kobo.51.1">no_subtree_check</span></span><span class="koboSpan" id="kobo.52.1"> setting, the Ubuntu implementation of NFS requires that either the </span><span class="My-Italic CharOverride-1"><span class="koboSpan" id="kobo.53.1">no_subtree_check or subtree_check</span></span><span class="koboSpan" id="kobo.54.1"> is included in all export directives.</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.55.1">For this chapter, we will configure the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.56.1">/etc/exports</span></span><span class="koboSpan" id="kobo.57.1"> file as follows:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.58.1">/tmp       *(rw,sync,no_subtree_check)</span></p>
<p class="Code"><span class="koboSpan" id="kobo.59.1">/vol1      192.168.86.42(ro,sync,no_subtree_check)</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.60.1">Once configured, the table of exported file systems maintained by the NFS server needs to be updated with the latest</span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.61.1"> /etc/exports</span></span><span class="koboSpan" id="kobo.62.1"> settings using the </span><a id="_idIndexMarker477"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.63.1">exportfs</span></span><span class="koboSpan" id="kobo.64.1"> command as follows:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.65.1"># exportfs -a</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.66.1">It is also possible to view the current share settings from the command line using the</span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.67.1"> exportfs </span></span><span class="koboSpan" id="kobo.68.1">tool: </span></p>
<p class="Code"><span class="koboSpan" id="kobo.69.1"># exportfs</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.70.1">The above command will generate the following output: </span></p>
<p class="Code"><span class="koboSpan" id="kobo.71.1">/vol1         	192.168.86.42</span></p>
<p class="Code"><span class="koboSpan" id="kobo.72.1">/tmp          	&lt;world&gt;</span></p>
<p class="Heading-1-1" id="_idParaDest-189" lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.73.1">20.4 </span></span><a id="_idTextAnchor332"/><span class="koboSpan" id="kobo.74.1">Accessing Shared Folders </span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.75.1">The shared folders may be accessed from a client system by mounting them manually from the command line. </span><span class="koboSpan" id="kobo.75.2">However, before attempting to mount a remote NFS folder, the </span><a id="_idIndexMarker478"/><span class="My-Italic CharOverride-1"><span class="koboSpan" id="kobo.76.1">nfs-common</span></span><span class="koboSpan" id="kobo.77.1"> package must first be installed on the client system:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.78.1"># apt install nfs-common</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.79.1">To mount a remote folder from the command line, open a terminal window and create a directory where you would like the remote shared folder to be mounted:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.80.1">$ mkdir /home/demo/tmp</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.81.1">Next, enter the command to </span><a id="_idIndexMarker479"/><span class="koboSpan" id="kobo.82.1">mount the remote folder using either the IP address or hostname of the remote NFS server, for example: </span></p>
<p class="Code"><span class="koboSpan" id="kobo.83.1">$ sudo mount -t nfs 192.168.86.24:/tmp /home/demo/tmp</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.84.1">The remote /tmp folder will then be mounted on the local system. </span><span class="koboSpan" id="kobo.84.2">Once mounted, the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.85.1">/home/demo/tmp</span></span><span class="koboSpan" id="kobo.86.1"> folder will contain the remote folder and all its contents. </span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.87.1">Options may also be specified when mounting a remote NFS filesystem. </span><span class="koboSpan" id="kobo.87.2">The following command, for example, mounts the same folder but configures it to be read-only:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.88.1">$ sudo mount -t nfs -o ro 192.168.86.24:/tmp /home/demo/tmp</span></p>
<p class="Heading-1-1" id="_idParaDest-190" lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.89.1">20.5 </span></span><a id="_idTextAnchor333"/><span class="koboSpan" id="kobo.90.1">Mounting an NFS Filesystem on System Startup </span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.91.1">It is also possible to configure an Ubuntu system to automatically mount a remote file system each time it starts up by editing the </span><a id="_idIndexMarker480"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.92.1">/etc/fstab</span></span><span class="koboSpan" id="kobo.93.1"> file. </span><span class="koboSpan" id="kobo.93.2">When loaded into an editor, it will likely resemble the following: </span></p>
<p class="Code"><span class="koboSpan" id="kobo.94.1">/dev/disk/by-id/dm-uuid-LVM-Qv7p2RxcHOSG6RjnkgR21xkhaCQ9NC / ext4 defaults 0 1</span></p>
<p class="Code"><span class="koboSpan" id="kobo.95.1"># /boot was on /dev/nvme0n1p2 during curtin installation</span></p>
<p class="Code"><span class="koboSpan" id="kobo.96.1">/dev/disk/by-uuid/aa49b362-6c42-49a6-98ba-7a256a96b4b8 /boot ext4 defaults 0 1</span></p>
<p class="Code"><span class="koboSpan" id="kobo.97.1"># /boot/efi was on /dev/nvme0n1p1 during curtin installation</span></p>
<p class="Code"><span class="koboSpan" id="kobo.98.1">/dev/disk/by-uuid/576B-B5F5 /boot/efi vfat defaults 0 1</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.99.1">To mount, for example, a folder with the path </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.100.1">/tmp</span></span><span class="koboSpan" id="kobo.101.1">, which resides on a system with the IP address 192.168.86.24 in the local folder with the path </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.102.1">/home/demo/tmp</span></span><span class="koboSpan" id="kobo.103.1"> (note that this folder must already exist), add the following line to the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.104.1">/etc/</span></span><span class="My-Italic CharOverride-1"><a id="_idIndexMarker481"/></span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.105.1">fstab </span></span><span class="koboSpan" id="kobo.106.1">file: </span></p>
<p class="Code"><span class="koboSpan" id="kobo.107.1">192.168.86.24:/tmp      /home/demo/tmp           nfs     rw              0 0</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.108.1">Next time the system reboots, the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.109.1">/tmp</span></span><span class="koboSpan" id="kobo.110.1"> folder on the remote system will be mounted on the local </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.111.1">/home/demo/tmp</span></span><span class="koboSpan" id="kobo.112.1"> mount point. </span><span class="koboSpan" id="kobo.112.2">All the files in the remote folder can then be accessed as if they reside on the local hard disk drive. </span></p>
<p class="Heading-1-1" id="_idParaDest-191" lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.113.1">20.6 </span></span><a id="_idTextAnchor334"/><span class="koboSpan" id="kobo.114.1">Unmounting an NFS Mount Point </span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.115.1">Once a remote file system is mounted using NFS, it can be unmounted using the </span><a id="_idIndexMarker482"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.116.1">umount </span></span><span class="koboSpan" id="kobo.117.1">command with the local mount point as the command-line argument. </span><span class="koboSpan" id="kobo.117.2">The following command, for example, will unmount our example filesystem mount point: </span></p>
<p class="Code"><span class="koboSpan" id="kobo.118.1">$ sudo umount /home/demo/tmp</span></p>
<p class="Heading-1-1" id="_idParaDest-192" lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.119.1">20.7 </span></span><a id="_idTextAnchor335"/><span class="koboSpan" id="kobo.120.1">Accessing </span><a id="_idIndexMarker483"/><a id="_idIndexMarker484"/><span class="koboSpan" id="kobo.121.1">NFS Filesystems in Cockpit</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.122.1">In addition to mounting a remote NFS file system on a client using the command line, it is also possible to perform mount operations from within the Cockpit web interface. </span><span class="koboSpan" id="kobo.122.2">Assuming that Cockpit has been installed and configured on the client system, log into the Cockpit interface from within a web browser and select the Storage option from the left-hand navigation panel. </span><span class="koboSpan" id="kobo.122.3">If the Storage option is not listed, the </span><a id="_idIndexMarker485"/><a id="_idIndexMarker486"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.123.1">cockpit-storaged</span></span><span class="koboSpan" id="kobo.124.1"> package will need to be installed:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.125.1"># apt install cockpit-storaged</span></p>
<p class="Code"><span class="koboSpan" id="kobo.126.1"># systemctl restart cockpit.socket</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.127.1">Once the Cockpit service has restarted, log back into the Cockpit interface, at which point the Storage option should now be visible.</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.128.1">Once selected, the main storage page will include a section listing any currently mounted NFS file systems, as illustrated in </span><a href="NFS_File_Sharing.xhtml#_idTextAnchor336"><span class="koboSpan" id="kobo.129.1">Figure 20-1</span></a><span class="koboSpan" id="kobo.130.1">:</span></p>
<p class="My-Basic-Paragraph ParaOverride-1" lang="en-US"><span class="koboSpan" id="kobo.131.1"><img alt="" class="_idGenObjectAttribute-1" src="image/rhel_cockpit_nfs.jpg"/></span></p>
<p class="Figure-Caption" lang="en-US"><span class="FigureCaptionMarker"><span class="koboSpan" id="kobo.132.1">Figure 20-1</span></span><a id="_idTextAnchor336"/></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.133.1">To mount a remote filesystem, click on the ‘+’ button highlighted above and enter information about the remote NFS server and file system share together with the local mount point and any necessary options into the resulting dialog before clicking on the Add button:</span></p>
<p class="My-Basic-Paragraph ParaOverride-1" lang="en-US"><span class="koboSpan" id="kobo.134.1"><img alt="" class="_idGenObjectAttribute-2" src="image/rhel_cockpit_nfs_new.jpg"/></span></p>
<p class="Figure-Caption" lang="en-US"><span class="FigureCaptionMarker"><span class="koboSpan" id="kobo.135.1">Figure 20-2</span></span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.136.1">To modify, unmount or remove an NFS filesystem share, select the corresponding mount in the NFS Mounts list (</span><a href="NFS_File_Sharing.xhtml#_idTextAnchor336"><span class="koboSpan" id="kobo.137.1">Figure 20-1</span></a><span class="koboSpan" id="kobo.138.1"> above) to display the page shown in </span><a href="NFS_File_Sharing.xhtml#_idTextAnchor337"><span class="koboSpan" id="kobo.139.1">Figure 20-3</span></a><span class="koboSpan" id="kobo.140.1"> below:</span></p>
<p class="My-Basic-Paragraph ParaOverride-1" lang="en-US"><span class="koboSpan" id="kobo.141.1"><img alt="" class="_idGenObjectAttribute-3" src="image/rhel_cockpit_nfs_modify.jpg"/></span></p>
<p class="Figure-Caption" lang="en-US"><span class="FigureCaptionMarker"><span class="koboSpan" id="kobo.142.1">Figure 20-3</span></span><a id="_idTextAnchor337"/><a id="_idTextAnchor338"/></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.143.1">Within this screen, perform tasks such as changing the server or mount points or unmounting the file system. </span><span class="koboSpan" id="kobo.143.2">For example, the Remove option unmounts the file system and deletes the entry from the</span><a id="_idIndexMarker487"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.144.1"> /etc/fstab</span></span><span class="koboSpan" id="kobo.145.1"> file so that it does not re-mount the next time the system reboots.</span></p>
<p class="Heading-1-1" id="_idParaDest-193" lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.146.1">20.8 </span></span><a id="_idTextAnchor339"/><span class="koboSpan" id="kobo.147.1">Summary</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.148.1">The Network File System (NFS) is a client/server-based system, originally developed by Sun Microsystems, which provides a way for Linux and Unix systems to share filesystems over a network. </span><span class="koboSpan" id="kobo.148.2">NFS allows a client system to access and (subject to permissions) modify files located on a remote server as though those files are stored on a local filesystem. </span><span class="koboSpan" id="kobo.148.3">This chapter has provided an overview of NFS and outlined the options for configuring client and server systems using the command line or the Cockpit web interface.</span></p>
</div>
</body></html>