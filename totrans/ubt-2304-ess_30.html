<html><head></head><body>
<div class="_idGenObjectStyleOverride-1" id="_idContainer376">
<p class="Chapter-Title" id="_idParaDest-274" lang="en-US" xml:lang="en-US"><span class="ChapterMarker"><span class="koboSpan" id="kobo.1.1">31. </span></span><a id="_idTextAnchor463"/><span class="koboSpan" id="kobo.2.1">Setting Up an Ubuntu 23.04 </span><a id="_idIndexMarker689"/><span class="koboSpan" id="kobo.3.1">Web Server</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.4.1">The </span><a id="_idIndexMarker690"/><span class="koboSpan" id="kobo.5.1">Apache web server is among the many packages that make up the Ubuntu operating system. </span><span class="koboSpan" id="kobo.5.2">The scalability and resilience of Ubuntu make it an ideal platform for hosting even the most heavily trafficked websites. </span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.6.1">This chapter will explain how to configure an Ubuntu system using Apache to act as a web server, including secure (HTTPS) and insecure (HTTP) configurations. </span></p>
<p class="Heading-1-1" id="_idParaDest-275" lang="en-US" xml:lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.7.1">31.1 </span></span><a id="_idTextAnchor464"/><span class="koboSpan" id="kobo.8.1">Requirements for Configuring an Ubuntu Web Server </span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.9.1">To set up your own website, you need a computer (or cloud server instance), an operating system, a web server, a domain name, a name server, and an IP address. </span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.10.1">As previously mentioned, Ubuntu supports the Apache web server, which can easily be installed once the operating system is up and running. </span><span class="koboSpan" id="kobo.10.2">In addition, a domain name can be registered with any domain name registration service. </span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.11.1">If you are running Ubuntu on a cloud instance, the IP address assigned by the provider will be listed in the server overview information. </span><span class="koboSpan" id="kobo.11.2">However, if you are hosting your own server and your </span><a id="_idIndexMarker691"/><span class="koboSpan" id="kobo.12.1">internet service provider (</span><a id="_idIndexMarker692"/><span class="koboSpan" id="kobo.13.1">ISP) has assigned a static IP address, you must associate your domain with that address. </span><span class="koboSpan" id="kobo.13.2">This is achieved using a name server, and all domain registration services will provide this service.</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.14.1">If you do not have a static IP address (i.e., your ISP provides you with a dynamic address that changes frequently), you can use one of several free </span><a id="_idIndexMarker693"/><span class="koboSpan" id="kobo.15.1">Dynamic DNS (</span><a id="_idIndexMarker694"/><span class="koboSpan" id="kobo.16.1">DDNS or </span><a id="_idIndexMarker695"/><span class="koboSpan" id="kobo.17.1">DynDNS for short) services to map your dynamic IP address to your domain name. </span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.18.1">Once you have configured your domain name and your name server, the next step is to install and configure your web server.</span></p>
<p class="Heading-1-1" id="_idParaDest-276" lang="en-US" xml:lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.19.1">31.2 </span></span><a id="_idTextAnchor465"/><span class="koboSpan" id="kobo.20.1">Installing the Apache Web Server Packages</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.21.1">The current release of Ubuntu typically does not install the Apache web server by default. </span><span class="koboSpan" id="kobo.21.2">To check whether the server is already installed, run the following command: </span></p>
<p class="Code"><span class="koboSpan" id="kobo.22.1"># apt -qq list apache2</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.23.1">If apt generates output similar to the following, the apache server is already installed:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.24.1">apache2/lunar,now 2.4.55-1ubuntu2 amd64 [installed]</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.25.1">If the apt output does not list the package or include the [installed] status, run the following command at the command prompt to perform the Apache installation:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.26.1"># apt install apache2</span></p>
<p class="Heading-1-1" id="_idParaDest-277" lang="en-US" xml:lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.27.1">31.3 </span></span><a id="_idTextAnchor466"/><span class="koboSpan" id="kobo.28.1">Configuring the </span><a id="_idIndexMarker697"/><span class="koboSpan" id="kobo.29.1">Firewall</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.30.1">Before starting and testing the Apache webserver, the firewall will need to be modified to allow the web server to communicate with the outside world. </span><span class="koboSpan" id="kobo.30.2">By default, the HTTP and HTTPS protocols use ports 80 and 443 respectively so, depending on which protocols are being used, either one or both of these ports will need to be opened. </span><span class="koboSpan" id="kobo.30.3">If your Ubuntu system is being protected by the Uncomplicated Firewall, the following command can be used to enable only insecure web traffic (HTTP):</span></p>
<p class="Code"><span class="koboSpan" id="kobo.31.1"># ufw allow Apache</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.32.1">To enable only secure (HTTPS) traffic:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.33.1"># ufw allow 'Apache Secure'</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.34.1">Alternatively, enable both secure and insecure web traffic as follows:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.35.1"># ufw allow 'Apache Full'</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.36.1">If you are using firewalld, the following commands can be used to open the HTTP and HTTPS ports. </span><span class="koboSpan" id="kobo.36.2">When opening the ports, be sure to specify the firewall zone that applies to the internet-facing network connection:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.37.1"># firewall-cmd --permanent --zone=&lt;zone&gt; --add-port=80/tcp</span></p>
<p class="Code"><span class="koboSpan" id="kobo.38.1"># firewall-cmd --permanent --zone=&lt;zone&gt; --add-port=443/tcp</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.39.1">After opening the necessary ports, be sure to reload the firewall settings:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.40.1"># firewall-cmd --reload</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.41.1">On cloud-hosted servers, enabling the appropriate port for the server instance within the cloud console may also be necessary. </span><span class="koboSpan" id="kobo.41.2">Check the documentation for the cloud provider for steps to do this.</span></p>
<p class="Heading-1-1" id="_idParaDest-278" lang="en-US" xml:lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.42.1">31.4 </span></span><a id="_idTextAnchor467"/><a id="_idIndexMarker699"/><span class="koboSpan" id="kobo.43.1">Port Forwarding </span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.44.1">Suppose the Ubuntu system hosting the web server sits on a network protected by a firewall (another computer running a firewall, router, or wireless base station containing built-in firewall protection). </span><span class="koboSpan" id="kobo.44.2">In that case, you must configure the firewall to forward ports 80 and 443 to your web server system. </span><span class="koboSpan" id="kobo.44.3">The mechanism for performing this differs between firewalls and devices, so check your documentation to find out how to configure port forwarding. </span></p>
<p class="Heading-1-1" id="_idParaDest-279" lang="en-US" xml:lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.45.1">31.5 </span></span><a id="_idTextAnchor468"/><span class="koboSpan" id="kobo.46.1">Starting the Apache Web Server </span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.47.1">Once the Apache server is installed and the firewall configured, the next step is to verify that the server is running and start it if necessary. </span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.48.1">To check the status of the Apache service from the command line, enter the following at the command prompt: </span></p>
<p class="Code"><span class="koboSpan" id="kobo.49.1"># systemctl status apache2</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.50.1">If the above command indicates that the apache2 service is not running, it can be launched from the command line as follows: </span></p>
<p class="Code"><span class="koboSpan" id="kobo.51.1"># systemctl start apache2</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.52.1">If you would like the Apache httpd service to start automatically when the system boots, run the following command: </span></p>
<p class="Code"><span class="koboSpan" id="kobo.53.1"># systemctl enable apache2</span></p>
<p class="Heading-1-1" id="_idParaDest-280" lang="en-US" xml:lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.54.1">31.6 </span></span><a id="_idTextAnchor469"/><span class="koboSpan" id="kobo.55.1">Testing the </span><a id="_idIndexMarker700"/><span class="koboSpan" id="kobo.56.1">Web Server </span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.57.1">Once the installation is complete, the next step is verifying the web server is running. </span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.58.1">If you have access (either locally or remotely) to the desktop environment of the server, start up a web browser and enter http://127.0.0.1 in the address bar (127.0.0.1 is the loop-back network address that tells the system to connect to the local machine). </span><span class="koboSpan" id="kobo.58.2">If everything is set up correctly, the browser should load the test page shown in </span><a href="Web_Server.xhtml#_idTextAnchor470"><span class="koboSpan" id="kobo.59.1">Figure 31-1</span></a><span class="koboSpan" id="kobo.60.1">:</span></p>
<p class="My-Basic-Paragraph ParaOverride-1" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.61.1"><img alt="" class="_idGenObjectAttribute-1" src="image/ubuntu_website.jpg"/></span></p>
<p class="Figure-Caption" lang="en-US" xml:lang="en-US"><span class="FigureCaptionMarker"><span class="koboSpan" id="kobo.62.1">Figure 31-1</span></span><a id="_idTextAnchor470"/></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.63.1">If the desktop environment is unavailable, connect either from another system on the same local network as the server, or use the external IP address assigned to the system if it is hosted remotely.</span></p>
<p class="Heading-1-1" id="_idParaDest-281" lang="en-US" xml:lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.64.1">31.7 </span></span><a id="_idTextAnchor471"/><span class="koboSpan" id="kobo.65.1">Configuring the Apache Web Server for Your Domain </span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.66.1">The next step in setting up your web server is configuring it for your domain name. </span><span class="koboSpan" id="kobo.66.2">To configure the web server, begin by changing directory to</span><span class="My-Italic _idGenCharOverride-1"> </span><span class="My-Italic CharOverride-1"><a id="_idIndexMarker701"/></span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.67.1">/etc/</span></span><span class="My-Italic CharOverride-1"><span class="koboSpan" id="kobo.68.1">apache2</span></span><span class="koboSpan" id="kobo.69.1">, which, in turn, contains several files and sub-directories. </span><span class="koboSpan" id="kobo.69.2">The main configuration file is named </span><span class="My-Italic CharOverride-1"><span class="koboSpan" id="kobo.70.1">apache2.conf</span></span><span class="koboSpan" id="kobo.71.1"> and serves as the central point for organizing the modular configuration files located in the sub-directories. </span><span class="koboSpan" id="kobo.71.2">For example, the </span><span class="My-Italic CharOverride-1"><span class="koboSpan" id="kobo.72.1">apache2.conf</span></span><span class="koboSpan" id="kobo.73.1"> file includes a line to import the configuration settings declared in the files located in the </span><span class="My-Italic CharOverride-1"><span class="koboSpan" id="kobo.74.1">sites-enabled</span></span><span class="koboSpan" id="kobo.75.1"> folder:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.76.1"># Include the virtual host configurations:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.77.1">IncludeOptional sites-enabled/*.conf</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.78.1">Similarly, the </span><span class="My-Italic CharOverride-1"><span class="koboSpan" id="kobo.79.1">apache2.conf</span></span><span class="koboSpan" id="kobo.80.1"> file imports the </span><span class="My-Italic CharOverride-1"><span class="koboSpan" id="kobo.81.1">ports.conf</span></span><span class="koboSpan" id="kobo.82.1"> file, which defines the ports on which the Apache server listens for network traffic. </span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.83.1">To configure a website domain on Ubuntu, begin by changing directory to </span><span class="My-Italic CharOverride-1"><span class="koboSpan" id="kobo.84.1">/etc/apache2</span></span><span class="koboSpan" id="kobo.85.1">. </span><span class="koboSpan" id="kobo.85.2">In this directory, you will find two sub-directories, </span><span class="My-Italic CharOverride-1"><span class="koboSpan" id="kobo.86.1">sites-available</span></span><span class="koboSpan" id="kobo.87.1"> and </span><span class="My-Italic CharOverride-1"><span class="koboSpan" id="kobo.88.1">sites-enabled</span></span><span class="koboSpan" id="kobo.89.1">. </span><span class="koboSpan" id="kobo.89.2">Change directory into sites-available. </span><span class="koboSpan" id="kobo.89.3">In this directory you will find a default file which may be used as a template for your own site. </span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.90.1">Copy the default file to a new file with a name that matches your domain name. </span><span class="koboSpan" id="kobo.90.2">For example: </span></p>
<p class="Code"><span class="koboSpan" id="kobo.91.1"># cp 000-default.conf myexample.conf</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.92.1">Edit your myexample.com file using your favorite editor where it will appear as follows: </span></p>
<p class="Code"><span class="koboSpan" id="kobo.93.1">&lt;VirtualHost *:80&gt;</span></p>
<p class="Code"><span class="koboSpan" id="kobo.94.1">        # The ServerName directive sets the request scheme, hostname and port that</span></p>
<p class="Code"><span class="koboSpan" id="kobo.95.1">        # the server uses to identify itself. </span><span class="koboSpan" id="kobo.95.2">This is used when creating</span></p>
<p class="Code"><span class="koboSpan" id="kobo.96.1">        # redirection URLs. </span><span class="koboSpan" id="kobo.96.2">In the context of virtual hosts, the ServerName</span></p>
<p class="Code"><span class="koboSpan" id="kobo.97.1">        # specifies what hostname must appear in the request’s Host: header to</span></p>
<p class="Code"><span class="koboSpan" id="kobo.98.1">        # match this virtual host. </span><span class="koboSpan" id="kobo.98.2">For the default virtual host (this file) this</span></p>
<p class="Code"><span class="koboSpan" id="kobo.99.1">        # value is not decisive as it is used as a last resort host regardless.</span></p>
<p class="Code"><span class="koboSpan" id="kobo.100.1">        # However, you must set it for any further virtual host explicitly.</span></p>
<p class="Code"><span class="koboSpan" id="kobo.101.1">        #ServerName www.example.com</span></p>
<p class="Code"><span class="koboSpan" id="kobo.102.1">        ServerAdmin webmaster@localhost</span></p>
<p class="Code"><span class="koboSpan" id="kobo.103.1">        DocumentRoot /var/www/html</span></p>
<p class="Code"><span class="koboSpan" id="kobo.104.1">        # Available loglevels: trace8, ..., trace1, debug, info, notice, warn,</span></p>
<p class="Code"><span class="koboSpan" id="kobo.105.1">        # error, crit, alert, emerg.</span></p>
<p class="Code"><span class="koboSpan" id="kobo.106.1">        # It is also possible to configure the loglevel for particular</span></p>
<p class="Code"><span class="koboSpan" id="kobo.107.1">        # modules, e.g.</span></p>
<p class="Code"><span class="koboSpan" id="kobo.108.1">        #LogLevel info ssl:warn</span></p>
<p class="Code"><span class="koboSpan" id="kobo.109.1">        ErrorLog ${APACHE_LOG_DIR}/error.log</span></p>
<p class="Code"><span class="koboSpan" id="kobo.110.1">        CustomLog ${APACHE_LOG_DIR}/access.log combined</span></p>
<p class="Code"><span class="koboSpan" id="kobo.111.1">        # For most configuration files from conf-available/, which are</span></p>
<p class="Code"><span class="koboSpan" id="kobo.112.1">        # enabled or disabled at a global level, it is possible to</span></p>
<p class="Code"><span class="koboSpan" id="kobo.113.1">        # include a line for only one particular virtual host. </span><span class="koboSpan" id="kobo.113.2">For example the</span></p>
<p class="Code"><span class="koboSpan" id="kobo.114.1">        # following line enables the CGI configuration for this host only</span></p>
<p class="Code"><span class="koboSpan" id="kobo.115.1">        # after it has been globally disabled with “a2disconf”.</span></p>
<p class="Code"><span class="koboSpan" id="kobo.116.1">        #Include conf-available/serve-cgi-bin.conf</span></p>
<p class="Code"><span class="koboSpan" id="kobo.117.1">&lt;/VirtualHost&gt;</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.118.1">The ServerAdmin directive defines an administrative email address for people wishing to contact the webmaster for your site. </span><span class="koboSpan" id="kobo.118.2">Change this to an appropriate email address where you can be contacted: </span></p>
<p class="Code"><span class="koboSpan" id="kobo.119.1">ServerAdmin webmaster@myexample.com</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.120.1">Next, the ServerName directive needs to be uncommented (in other words remove the ‘#’ character prefix) and defined so that the web server knows which virtual host this configuration file refers to: </span></p>
<p class="Code"><span class="koboSpan" id="kobo.121.1">ServerName myexample.com</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.122.1">In the next stage, we need to define where the website files are going to be located using the DocumentRoot directive. </span><span class="koboSpan" id="kobo.122.2">The tradition is to use </span><span class="My-Italic CharOverride-1"><span class="koboSpan" id="kobo.123.1">/var/www/domain-name</span></span><span class="koboSpan" id="kobo.124.1">: </span></p>
<p class="Code"><span class="koboSpan" id="kobo.125.1">DocumentRoot /var/www/myexample.com</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.126.1">Having completed the changes, we now need to enable the site as follows:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.127.1"># a2ensite myexample.conf</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.128.1">This command creates a symbolic link from the </span><span class="My-Italic CharOverride-1"><span class="koboSpan" id="kobo.129.1">myexample.conf</span></span><span class="koboSpan" id="kobo.130.1"> file in the </span><span class="My-Italic CharOverride-1"><span class="koboSpan" id="kobo.131.1">sites-available</span></span><span class="koboSpan" id="kobo.132.1"> directory to the sites-enabled folder.</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.133.1">With the site enabled, run the following command to disable the default test site:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.134.1"># a2dissite 000-default.conf</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.135.1">Next, create the </span><span class="My-Italic CharOverride-1"><span class="koboSpan" id="kobo.136.1">/var/www/myexample.com</span></span><span class="koboSpan" id="kobo.137.1"> directory and place an </span><span class="My-Italic CharOverride-1"><span class="koboSpan" id="kobo.138.1">index.html</span></span><span class="koboSpan" id="kobo.139.1"> file in it. </span><span class="koboSpan" id="kobo.139.2">For example: </span></p>
<p class="Code"><span class="koboSpan" id="kobo.140.1">&lt;html&gt;</span></p>
<p class="Code"><span class="koboSpan" id="kobo.141.1">&lt;title&gt;Sample Web Page&lt;/title&gt;</span></p>
<p class="Code"><span class="koboSpan" id="kobo.142.1">&lt;body&gt;</span></p>
<p class="Code"><span class="koboSpan" id="kobo.143.1">Welcome to MyExample.com</span></p>
<p class="Code"><span class="koboSpan" id="kobo.144.1">&lt;/body&gt;</span></p>
<p class="Code"><span class="koboSpan" id="kobo.145.1">&lt;/html&gt;</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.146.1">With these changes made, run the apache2ctl command to check the configuration files for errors:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.147.1"># apache2ctl configtest</span></p>
<p class="Code"><span class="koboSpan" id="kobo.148.1">Syntax OK</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.149.1">If no errors are reported, reload the Apache web server to make sure it picks up our new settings: </span></p>
<p class="Code"><span class="koboSpan" id="kobo.150.1"># systemctl reload apache2</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.151.1">Finally, check that the server configuration works by opening a browser window and navigating to the site using the domain name instead of the IP address. </span><span class="koboSpan" id="kobo.151.2">The web page that loads should be the one defined in the </span><span class="My-Italic CharOverride-1"><span class="koboSpan" id="kobo.152.1">index.html</span></span><span class="koboSpan" id="kobo.153.1"> file created above.</span></p>
<p class="Heading-1-1" id="_idParaDest-282" lang="en-US" xml:lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.154.1">31.8 </span></span><a id="_idTextAnchor472"/><span class="koboSpan" id="kobo.155.1">The Basics of a Secure Website</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.156.1">The web server and website created in this chapter use the </span><a id="_idIndexMarker705"/><span class="koboSpan" id="kobo.157.1">HTTP protocol on port 80 and, as such, are considered to be insecure. </span><span class="koboSpan" id="kobo.157.2">The problem is that the traffic between the web server and the client (typically a user’s web browser) is transmitted in clear text. </span><span class="koboSpan" id="kobo.157.3">In other words, the data is unencrypted and susceptible to interception. </span><span class="koboSpan" id="kobo.157.4">While not a problem for general web browsing, this is a severe weakness when performing tasks such as logging into websites or transferring sensitive information such as identity or credit card details.</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.158.1">These days, websites are expected to use </span><a id="_idIndexMarker706"/><span class="koboSpan" id="kobo.159.1">HTTPS, which uses either </span><a id="_idIndexMarker707"/><a id="_idIndexMarker708"/><span class="koboSpan" id="kobo.160.1">Secure Socket Layer (</span><a id="_idIndexMarker709"/><span class="koboSpan" id="kobo.161.1">SSL) or </span><a id="_idIndexMarker710"/><span class="koboSpan" id="kobo.162.1">Transport Layer Security (</span><a id="_idIndexMarker711"/><span class="koboSpan" id="kobo.163.1">TLS) to establish secure, encrypted communication between a web server and a client. </span><span class="koboSpan" id="kobo.163.2">This security is established through the use of public, private, and session encryption together with certificates.</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.164.1">To support HTTPS, a website must have a certificate issued by a trusted authority known as a </span><a id="_idIndexMarker712"/><span class="koboSpan" id="kobo.165.1">Certificate Authority (</span><a id="_idIndexMarker713"/><span class="koboSpan" id="kobo.166.1">CA). </span><span class="koboSpan" id="kobo.166.2">When a browser connects to a secure website, the web server sends back a copy of the website’s </span><a id="_idIndexMarker714"/><span class="koboSpan" id="kobo.167.1">SSL certificate, which also contains a copy of the site’s public key. </span><span class="koboSpan" id="kobo.167.2">The browser then validates the authenticity of the certificate with trusted certificate authorities.</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.168.1">If the certificate is valid, the browser uses the public key sent by the server to encrypt a session key and pass it to the server. </span><span class="koboSpan" id="kobo.168.2">The server decrypts the session key using the private key to send an encrypted acknowledgment to the browser. </span><span class="koboSpan" id="kobo.168.3">Once this process is complete, the browser and server use the session key to encrypt all subsequent data transmissions until the session ends.</span></p>
<p class="Heading-1-1" id="_idParaDest-283" lang="en-US" xml:lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.169.1">31.9 </span></span><a id="_idTextAnchor473"/><span class="koboSpan" id="kobo.170.1">Configuring Apache for HTTPS</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.171.1">By default, the Apache server does not include the necessary module to implement a secure HTTPS website. </span><span class="koboSpan" id="kobo.171.2">The first step, therefore, is to enable the </span><a id="_idIndexMarker715"/><span class="koboSpan" id="kobo.172.1">Apache </span><a id="_idIndexMarker716"/><span class="koboSpan" id="kobo.173.1">mod_ssl module on the server system as follows:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.174.1"># a2enmod ssl</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.175.1">Restart apache2 after the installation completes to load the new module into the Apache server:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.176.1"># systemctl restart apache2</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.177.1">Check that the module has loaded into the server using the following command:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.178.1"># apache2ctl -M | grep ssl_module</span></p>
<p class="Code"><span class="koboSpan" id="kobo.179.1"> ssl_module (shared)</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.180.1">Once the ssl module is installed, repeat the steps from the previous section of this chapter to create a configuration file for the website, this time using the </span><span class="My-Italic CharOverride-1"><span class="koboSpan" id="kobo.181.1">sites-available/default-ssl.conf </span></span><span class="koboSpan" id="kobo.182.1">file as the template for the site configuration file. </span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.183.1">Assuming the module is installed, the next step is to generate an SSL certificate for the website.</span></p>
<p class="Heading-1-1" id="_idParaDest-284" lang="en-US" xml:lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.184.1">31.10 </span></span><a id="_idTextAnchor474"/><span class="koboSpan" id="kobo.185.1">Obtaining an </span><a id="_idIndexMarker718"/><span class="koboSpan" id="kobo.186.1">SSL Certificate</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.187.1">The certificate for a website must be obtained from a Certificate Authority. </span><span class="koboSpan" id="kobo.187.2">Several options are available at a range of prices. </span><span class="koboSpan" id="kobo.187.3">By far the best option, however, is to obtain a free certificate from </span><a id="_idIndexMarker719"/><span class="koboSpan" id="kobo.188.1">Let’s Encrypt at the following URL:</span></p>
<p class="Basic-Paragraph" lang="en-US" xml:lang="en-US"><a href="https://letsencrypt.org/"><span class="Hyperlink _idGenCharOverride-1"><span class="koboSpan" id="kobo.189.1">https://letsencrypt.org/</span></span></a></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.190.1">Obtaining a certificate from Let’s Encrypt involves installing and running the Certbot tool. </span><span class="koboSpan" id="kobo.190.2">This tool will scan the Apache configuration files on the server and provides the option to generate certificates for any virtual hosts configured on the system. </span><span class="koboSpan" id="kobo.190.3">It will then generate the certificate and add virtual host entries to the Apache configuration for the corresponding websites.</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.191.1">Follow the steps on the Let’s Encrypt website to download and install Certbot on your Ubuntu system, then run the </span><a id="_idIndexMarker720"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.192.1">certbot</span></span><span class="koboSpan" id="kobo.193.1"> tool as follows to generate and install the certificate:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.194.1"># certbot --apache</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.195.1">After requesting an email address and seeking terms of service acceptance, Certbot will list the domains found in the </span><a id="_idIndexMarker721"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.196.1">httpd.conf</span></span><span class="koboSpan" id="kobo.197.1"> file and allow the selection of one or more sites for which a certificate will be installed. </span><span class="koboSpan" id="kobo.197.2">Certbot will then perform some checks before obtaining and installing the certificate on the system:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.198.1">Which names would you like to activate HTTPS for?</span></p>
<p class="Code"><span class="koboSpan" id="kobo.199.1">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span></p>
<p class="Code"><span class="koboSpan" id="kobo.200.1">1: www.myexample.com</span></p>
<p class="Code"><span class="koboSpan" id="kobo.201.1">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span></p>
<p class="Code"><span class="koboSpan" id="kobo.202.1">Select the appropriate numbers separated by commas and/or spaces, or leave input</span></p>
<p class="Code"><span class="koboSpan" id="kobo.203.1">blank to select all options shown (Enter ‘c’ to cancel): 1</span></p>
<p class="Code"><span class="koboSpan" id="kobo.204.1">Obtaining a new certificate</span></p>
<p class="Code"><span class="koboSpan" id="kobo.205.1">Performing the following challenges:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.206.1">http-01 challenge for www.myexample.com</span></p>
<p class="Code"><span class="koboSpan" id="kobo.207.1">Waiting for verification...</span></p>
<p class="Code"><span class="koboSpan" id="kobo.208.1">Cleaning up challenges</span></p>
<p class="Code"><span class="koboSpan" id="kobo.209.1">Created an SSL vhost at /etc/httpd/conf/httpd-le-ssl.conf</span></p>
<p class="Code"><span class="koboSpan" id="kobo.210.1">Deploying Certificate to VirtualHost /etc/httpd/conf/httpd-le-ssl.conf</span></p>
<p class="Code"><span class="koboSpan" id="kobo.211.1">Enabling site /etc/httpd/conf/httpd-le-ssl.conf by adding Include to root configuration</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.212.1">Certbot will also create a new file named </span><a id="_idIndexMarker722"/><span class="My-Italic CharOverride-1"><span class="koboSpan" id="kobo.213.1">myexample-le-ssl.conf</span></span><span class="koboSpan" id="kobo.214.1"> in the </span><span class="My-Italic CharOverride-1"><span class="koboSpan" id="kobo.215.1">/etc/apache2/sites-available</span></span><span class="koboSpan" id="kobo.216.1"> directory containing a secure virtual host entry for each domain name for which a certificate has been generated and enabled the site so that a link to the file is made in the </span><span class="My-Italic CharOverride-1"><span class="koboSpan" id="kobo.217.1">/etc/apache2/sites-enabled </span></span><span class="koboSpan" id="kobo.218.1">directory. </span><span class="koboSpan" id="kobo.218.2">These entries will be similar to the following:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.219.1">&lt;IfModule mod_ssl.c&gt;</span></p>
<p class="Code"><span class="koboSpan" id="kobo.220.1">&lt;VirtualHost *:443&gt;</span></p>
<p class="Code"><span class="koboSpan" id="kobo.221.1">    ServerAdmin feedback@myexample.com</span></p>
<p class="Code"><span class="koboSpan" id="kobo.222.1">    ServerName www.myexample.com</span></p>
<p class="Code"><span class="koboSpan" id="kobo.223.1">    DocumentRoot /var/www/myexample</span></p>
<p class="Code"><span class="koboSpan" id="kobo.224.1">    ErrorLog logs/myexample_error_log</span></p>
<p class="Code"><span class="koboSpan" id="kobo.225.1">    CustomLog logs/myexample_access_log combined</span></p>
<p class="Code"><span class="koboSpan" id="kobo.226.1"> </span></p>
<p class="Code"><span class="koboSpan" id="kobo.227.1">SSLCertificateFile /etc/letsencrypt/live/www.myexample.com/fullchain.pem</span></p>
<p class="Code"><span class="koboSpan" id="kobo.228.1">SSLCertificateKeyFile /etc/letsencrypt/live/www.myexample.com/privkey.pem</span></p>
<p class="Code"><span class="koboSpan" id="kobo.229.1">Include /etc/letsencrypt/options-ssl-apache.conf</span></p>
<p class="Code"><span class="koboSpan" id="kobo.230.1">&lt;/VirtualHost&gt;</span></p>
<p class="Code"><span class="koboSpan" id="kobo.231.1">&lt;/IfModule&gt;</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.232.1">Finally, Certbot will ask whether the server should redirect future HTTP web requests to HTTPS. </span><span class="koboSpan" id="kobo.232.2">In other words, if a user attempts to access http://www.myexample.com, the web server will redirect the user to https://www.myexample.com:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.233.1">Please choose whether or not to redirect HTTP traffic to HTTPS, removing HTTP access.</span></p>
<p class="Code"><span class="koboSpan" id="kobo.234.1">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span></p>
<p class="Code"><span class="koboSpan" id="kobo.235.1">1: No redirect - Make no further changes to the webserver configuration.</span></p>
<p class="Code"><span class="koboSpan" id="kobo.236.1">2: Redirect - Make all requests redirect to secure HTTPS access. </span><span class="koboSpan" id="kobo.236.2">Choose this for</span></p>
<p class="Code"><span class="koboSpan" id="kobo.237.1">new sites, or if you’re confident your site works on HTTPS. </span><span class="koboSpan" id="kobo.237.2">You can undo this</span></p>
<p class="Code"><span class="koboSpan" id="kobo.238.1">change by editing your web server’s configuration.</span></p>
<p class="Code"><span class="koboSpan" id="kobo.239.1">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span></p>
<p class="Code"><span class="koboSpan" id="kobo.240.1">Select the appropriate number [1-2] then [enter] (press ‘c’ to cancel): 2</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.241.1">If you are currently testing the HTTPS configuration and would like to keep the HTTP version live until later, select the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.242.1">No redirect</span></span><span class="koboSpan" id="kobo.243.1"> option. </span><span class="koboSpan" id="kobo.243.2">Otherwise, redirecting to HTTPS is generally recommended.</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.244.1">Once the certificate has been installed, test it in a browser at the following URL (replacing myexample.com with your own domain name):</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><a href="https://www.ssllabs.com/ssltest/analyze.html?d=www.myexample.com"><span class="Hyperlink _idGenCharOverride-1"><span class="koboSpan" id="kobo.245.1">https://www.ssllabs.com/ssltest/analyze.html?d=www.myexample.com</span></span></a></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.246.1">If the certificate configuration is successful, the </span><a id="_idIndexMarker723"/><span class="koboSpan" id="kobo.247.1">SSL Labs report will provide a high rating, as shown in </span><a href="Web_Server.xhtml#_idTextAnchor475"><span class="koboSpan" id="kobo.248.1">Figure 31-2</span></a><span class="koboSpan" id="kobo.249.1">:</span></p>
<p class="My-Basic-Paragraph ParaOverride-1" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.250.1"><img alt="" class="_idGenObjectAttribute-2" src="image/rhel_8_ssl_labs_report.jpg"/></span></p>
<p class="Figure-Caption" lang="en-US" xml:lang="en-US"><span class="FigureCaptionMarker"><span class="koboSpan" id="kobo.251.1">Figure 31-2</span></span><a id="_idTextAnchor475"/></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.252.1">As a final test, open a browser window and navigate to your domain using the https:// prefix. </span><span class="koboSpan" id="kobo.252.2">The page should load as before, and the browser should indicate that the connection between the browser and server is secure (usually indicated by a padlock icon in the address bar, which can be clicked for additional information):</span></p>
<p class="My-Basic-Paragraph ParaOverride-1" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.253.1"><img alt="" class="_idGenObjectAttribute-3" src="image/ubuntu_secure_site.jpg"/></span></p>
<p class="Figure-Caption" lang="en-US" xml:lang="en-US"><span class="FigureCaptionMarker"><span class="koboSpan" id="kobo.254.1">Figure 31-3</span></span></p>
<p class="Heading-1-1" id="_idParaDest-285" lang="en-US" xml:lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.255.1">31.11 </span></span><a id="_idTextAnchor476"/><span class="koboSpan" id="kobo.256.1">Summary</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.257.1">An Ubuntu system can host websites by installing the Apache web server. </span><span class="koboSpan" id="kobo.257.2">Insecure (HTTP) and secure (HTTPS) websites can be deployed on Ubuntu. </span><span class="koboSpan" id="kobo.257.3">Secure websites use either Secure Socket Layer (SSL) or Transport Layer Security (TLS) to establish encrypted communication between the web server and client through public, private, and session encryption, together with a certificate issued by a trusted Certificate Authority.</span></p>
</div>
</body></html>