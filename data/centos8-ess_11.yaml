- en: 13\. Basic CentOS 8 Firewall Configuration with firewalld
  id: totrans-0
  prefs: []
  type: TYPE_NORMAL
  zh: 13. 基本的 CentOS 8 防火墙配置与 firewalld
- en: A firewall is a vital component in protecting a computer system or network of
    computers from external attack (typically from an external source via an internet
    connection). Any computer connected directly to an internet connection must run
    a firewall to protect against malicious activity. Similarly, any internal network
    must have some form of firewall between it and an external internet connection.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 防火墙是保护计算机系统或计算机网络免受外部攻击（通常是通过互联网连接的外部来源）至关重要的组成部分。任何直接连接到互联网的计算机都必须运行防火墙以防止恶意活动。类似地，任何内部网络必须在与外部互联网连接之间安装某种形式的防火墙。
- en: All Linux distributions are provided with a firewall solution of some form.
    In the case of CentOS 8 this takes the form of a service named firewalld.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 所有 Linux 发行版都提供某种形式的防火墙解决方案。在 CentOS 8 中，防火墙解决方案以一个名为 firewalld 的服务形式提供。
- en: While the subject of firewall configuration can be complex, fortunately CentOS
    8 provides command-line, web-based and graphical tools that ease the firewall
    configuration process. This chapter will introduce the basic concepts of firewalld
    and cover the steps necessary to configure a firewall using the tools provided
    with the operating system.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然防火墙配置的话题可能比较复杂，但幸运的是 CentOS 8 提供了命令行、基于 Web 的以及图形化工具来简化防火墙配置过程。本章将介绍 firewalld
    的基本概念，并涵盖使用操作系统提供的工具配置防火墙的必要步骤。
- en: 13.1 An Introduction to firewalld
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 13.1 firewalld 简介
- en: The firewalld service uses a set a rules to control incoming network traffic
    and define which traffic is to be blocked and which is to be allowed to pass through
    to the system and is built on top of a more complex firewall tool named iptables.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: firewalld 服务使用一套规则来控制进入的网络流量，并定义哪些流量应该被阻止，哪些流量可以通过系统。它建立在一个更复杂的防火墙工具 iptables
    之上。
- en: The firewalld system provides a flexible way to manage incoming traffic. The
    firewall could, for example, be configured to block traffic arriving from a specific
    external IP address, or to prevent all traffic arriving on a particular TCP/IP
    port. Rules may also be defined to forward incoming traffic to different systems
    or to act as an internet gateway to protect other computers on a network.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: firewalld 系统提供了一种灵活的方式来管理进入流量。例如，可以配置防火墙阻止来自特定外部 IP 地址的流量，或者阻止所有到达特定 TCP/IP
    端口的流量。还可以定义规则，将进入的流量转发到不同的系统，或者充当互联网网关来保护网络上的其他计算机。
- en: In keeping with common security practices, a default firewalld installation
    is configured to block all access with the exception of SSH remote login and the
    DHCP service used by the system to obtain a dynamic IP address (both of which
    are essential if the system administrator is to be able to gain access to the
    system after completing the installation).
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 按照常见的安全实践，默认的 firewalld 安装会配置为阻止所有访问，除了 SSH 远程登录和系统用于获取动态 IP 地址的 DHCP 服务（这两者对系统管理员在完成安装后能够访问系统是至关重要的）。
- en: The key elements of firewall configuration on CentOS 8 are zones, interfaces,
    services and ports.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: CentOS 8 上防火墙配置的关键元素包括区域（zones）、接口（interfaces）、服务（services）和端口（ports）。
- en: 13.1.1 Zones
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 13.1.1 区域
- en: 'By default, firewalld is installed with a range of pre-configured zones. A
    zone is a preconfigured set of rules which can be applied to the system at any
    time to quickly implement firewall configurations for specific scenarios. The
    block zone, for example, blocks all incoming traffic, while the home zone imposes
    less strict rules on the assumption that the system is running in a safer environment
    where a greater level of trust is expected. New zones may be added to the system,
    and existing zones modified to add or remove rules. Zones may also be deleted
    entirely from the system. [Table 13-1](../Text/Firewall_Configuration.xhtml#_idTextAnchor161)
    lists the set of zones available by default on a CentOS 8 system:'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，firewalld 安装时会包含一系列预配置的区域。区域是一组可以随时应用于系统的预配置规则，用于快速实现特定场景下的防火墙配置。例如，block
    区域会阻止所有进入流量，而 home 区域则假设系统运行在一个更安全的环境中，因此会施加较少的严格规则，并期望有更高的信任级别。新区域可以添加到系统中，现有区域可以修改以添加或移除规则。区域也可以完全从系统中删除。[表
    13-1](../Text/Firewall_Configuration.xhtml#_idTextAnchor161)列出了 CentOS 8 系统默认提供的区域集：
- en: '| Zone | Description |'
  id: totrans-11
  prefs: []
  type: TYPE_TB
  zh: '| 区域 | 描述 |'
- en: '| --- | --- |'
  id: totrans-12
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| drop | The most secure zone. Only outgoing connections are permitted and
    all incoming connections are dropped without any notification to the connecting
    client. |'
  id: totrans-13
  prefs: []
  type: TYPE_TB
  zh: '| drop | 最安全的区域。仅允许传出连接，所有传入连接都会被丢弃，并且不会向连接的客户端发送任何通知。 |'
- en: '| block | Similar to the drop zone with the exception that incoming connections
    are rejected with an icmp-host-prohibited or icmp6-adm-prohibited notification.
    |'
  id: totrans-14
  prefs: []
  type: TYPE_TB
  zh: '| block | 类似于丢弃区，不同之处在于，传入连接会被icmp-host-prohibited或icmp6-adm-prohibited通知拒绝。
    |'
- en: '| public | Intended for use when connected to public networks or the internet
    where other computers are not known to be trustworthy. Allows select incoming
    connections. |'
  id: totrans-15
  prefs: []
  type: TYPE_TB
  zh: '| public | 当连接到公共网络或互联网，且其他计算机不被认为是可信的时使用。允许选择性地接受传入连接。 |'
- en: '| external | When a system is acting as the internet gateway for a network
    of computers, the external zone is applied to the interface that is connected
    to the internet.This zone is used in conjunction with the internal zone when implementing
    masquerading or network address translation (NAT) as outlined later in this chapter.
    Allows select incoming connections |'
  id: totrans-16
  prefs: []
  type: TYPE_TB
  zh: '| external | 当系统充当网络中计算机的互联网网关时，外部区域应用于连接到互联网的接口。本区域与内部区域一起使用，用于实现伪装或网络地址转换（NAT），如本章后续部分所述。允许选择性地接受传入连接。
    |'
- en: '| internal | Used with the external zone and applied to the interface that
    is connected to the internal network. Assumes that the computers on the internal
    network are trusted. Allows select incoming connections. |'
  id: totrans-17
  prefs: []
  type: TYPE_TB
  zh: '| internal | 与外部区域一起使用，并应用于连接到内部网络的接口。假设内部网络中的计算机是可信的。允许选择性地接受传入连接。 |'
- en: '| dmz | For use when the system is running in the demilitarized zone (DMZ).
    These are generally computers that are publicly accessible but isolated from other
    parts of your internal network. Allows select incoming connections. |'
  id: totrans-18
  prefs: []
  type: TYPE_TB
  zh: '| dmz | 当系统运行在隔离区（DMZ）时使用。这些通常是可以公开访问但与内部网络其他部分隔离的计算机。允许选择性地接受传入连接。 |'
- en: '| work | For use when running a system on a network in a work environment where
    other computers are trusted. Allows select incoming connections. |'
  id: totrans-19
  prefs: []
  type: TYPE_TB
  zh: '| work | 当在工作环境中的网络上运行系统，且其他计算机被信任时使用。允许选择性地接受传入连接。 |'
- en: '| home | For use when running a system on a home network where other computers
    are trusted. Allows select incoming connections. |'
  id: totrans-20
  prefs: []
  type: TYPE_TB
  zh: '| home | 当在家庭网络中运行系统，且其他计算机被信任时使用。允许选择性地接受传入连接。 |'
- en: '| trusted | The least secure zone. All incoming connections are accepted. |'
  id: totrans-21
  prefs: []
  type: TYPE_TB
  zh: '| trusted | 最不安全的区域。所有传入连接都会被接受。 |'
- en: Table 13-1
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 表13-1
- en: 13.1.2 Interfaces
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 13.1.2 接口
- en: Any CentOS 8 system connected to the internet or a network (or both) will contain
    at least one interface in the form of either a physical or virtual network device.
    When firewalld is active, each of these interfaces is assigned to a zone allowing
    different levels of firewall security to be assigned to different interfaces.
    Consider a server containing two interfaces, one connected externally to the internet
    and the other to an internal network. In such a scenario, the external facing
    interface would most likely be assigned to the more restrictive external zone
    while the internal interface might use the internal zone.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 任何连接到互联网或网络（或两者）的CentOS 8系统都会包含至少一个接口，可能是物理的或虚拟的网络设备。当firewalld处于活动状态时，这些接口中的每一个都会分配到一个区域，从而允许为不同的接口分配不同级别的防火墙安全。考虑一台包含两个接口的服务器，一个接口连接到外部互联网，另一个接口连接到内部网络。在这种情况下，面向外部的接口很可能会分配到更严格的外部区域，而内部接口可能会使用内部区域。
- en: 13.1.3 Services
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 13.1.3 服务
- en: TCP/IP defines a set of services that communicate on standard ports. Secure
    HTTPS web connections, for example, use port 443, while the SMTP email service
    uses port 25\. To selectively enable incoming traffic for specific services, firewalld
    rules can be added to zones. The home zone, for example, does not permit incoming
    HTTPS connections by default. This traffic can be enabled by adding rules to a
    zone to allow incoming HTTPS connections without having to reference the specific
    port number.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: TCP/IP定义了一组在标准端口上进行通信的服务。例如，安全的HTTPS web连接使用端口443，而SMTP邮件服务使用端口25。为了选择性地启用特定服务的传入流量，可以向区域添加firewalld规则。例如，home区域默认不允许传入HTTPS连接。可以通过向区域添加规则来启用此流量，从而无需引用特定端口号即可允许传入HTTPS连接。
- en: 13.1.4 Ports
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 13.1.4 端口
- en: Although common TCP/IP services can be referenced when adding firewalld rules,
    situations will arise where incoming connections need to be allowed on a specific
    port that is not allocated to a service. This can be achieved by adding rules
    that reference specific ports instead of services. This technique was used in
    the chapter entitled [“An Overview of the CentOS 8 Cockpit Web Interface”](../Text/Cockpit_Overview.xhtml#_idTextAnchor081)
    when port 9090 was opened to allow access to the Cockpit web interface.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管可以在添加 firewalld 规则时引用常见的 TCP/IP 服务，但会出现需要在未分配给服务的特定端口上允许传入连接的情况。这可以通过添加引用特定端口的规则来实现，而不是服务。这种技术在名为
    [“CentOS 8 Cockpit Web 界面概述”](../Text/Cockpit_Overview.xhtml#_idTextAnchor081)
    的章节中使用，当时打开了 9090 端口以允许访问 Cockpit Web 界面。
- en: 13.2 Checking firewalld Status
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 13.2 检查 firewalld 状态
- en: 'The firewalld service is installed and enabled by default on all CentOS 8 installations.
    The status of the service can be checked via the following command:'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: firewalld 服务在所有 CentOS 8 安装中默认已安装并启用。可以通过以下命令检查服务的状态：
- en: systemctl status firewalld
  id: totrans-31
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: systemctl status firewalld
- en: firewalld.service - firewalld - dynamic firewall daemon
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: firewalld.service - firewalld - 动态防火墙守护进程
- en: 'Loaded: loaded (/usr/lib/systemd/system/firewalld.service; enabled; vendor
    preset: enabled)'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 已加载：已加载 (/usr/lib/systemd/system/firewalld.service; 启用; 供应商预设：启用)
- en: 'Active: active (running) since Thu 2019-02-14 14:24:31 EST; 3 days ago'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 活动状态：活动（运行中），自 2019-02-14 14:24:31 EST 起；3 天前
- en: 'Docs: man:firewalld(1)'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 文档：man:firewalld(1)
- en: 'Main PID: 816 (firewalld)'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 主 PID：816 (firewalld)
- en: 'Tasks: 2 (limit: 25026)'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 任务：2（限制：25026）
- en: 'Memory: 30.6M'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 内存：30.6M
- en: 'CGroup: /system.slice/firewalld.service'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 'CGroup: /system.slice/firewalld.service'
- en: 816 /usr/libexec/platform-python -s /usr/sbin/firewalld --nofork --nopid
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 816 /usr/libexec/platform-python -s /usr/sbin/firewalld --nofork --nopid
- en: 'If necessary, the firewalld service may be installed as follows:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 如果需要，可以按照以下方式安装 firewalld 服务：
- en: dnf install firewalld
  id: totrans-42
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: dnf 安装 firewalld
- en: The firewalld service is enabled by default so will start automatically both
    after installation is complete and each time the system boots.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: firewalld 服务默认启用，因此在安装完成后以及每次系统启动时都会自动启动。
- en: 13.3 Configuring Firewall Rules with firewall-cmd
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 13.3 使用 firewall-cmd 配置防火墙规则
- en: The firewall-cmd command-line utility allows information about the firewalld
    configuration to be viewed and changes to be made to zones and rules from within
    a terminal window.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: firewall-cmd 命令行工具允许查看 firewalld 配置的信息，并从终端窗口中更改区域和规则。
- en: 'When making changes to the firewall settings, it is important to be aware of
    the concepts of runtime and permanent configurations. By default, any rule changes
    are considered to be runtime configuration changes. This means that while the
    changes will take effect immediately, they will be lost next time the system restarts
    or the firewalld service reloads, for example by issuing the following command:'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 在更改防火墙设置时，重要的是要理解运行时配置和永久配置的概念。默认情况下，任何规则更改都被视为运行时配置更改。这意味着，虽然更改会立即生效，但它们将在系统下次重启或
    firewalld 服务重新加载时丢失，例如通过执行以下命令：
- en: firewall-cmd --reload
  id: totrans-47
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: firewall-cmd --reload
- en: To make a change permanent, the --permanent command-line option must be used.
    Permanent changes do not take effect until the firewalld service reloads but will
    remain in place until manually changed.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 要使更改永久生效，必须使用 --permanent 命令行选项。永久更改不会立即生效，直到 firewalld 服务重新加载，但会保持有效，直到手动更改。
- en: 13.3.1 Identifying and Changing the Default Zone
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 13.3.1 确定和更改默认区域
- en: 'To identify the default zone (in other words the zone to which all interfaces
    will be assigned unless a different zone is specifically selected) use the firewall-cmd
    tool as follows:'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 要识别默认区域（换句话说，所有接口将在没有特别选择其他区域时分配到该区域），可以使用 firewall-cmd 工具，如下所示：
- en: firewall-cmd --get-default-zone
  id: totrans-51
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: firewall-cmd --get-default-zone
- en: public
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: public
- en: 'To change the default to a different zone:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 要将默认设置更改为其他区域：
- en: firewall-cmd --set-default-zone=home
  id: totrans-54
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: firewall-cmd --set-default-zone=home
- en: success
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 成功
- en: 13.3.2 Displaying Zone Information
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 13.3.2 显示区域信息
- en: 'To list all of the zones available on the system:'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 列出系统上所有可用的区域：
- en: firewall-cmd --get-zones
  id: totrans-58
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: firewall-cmd --get-zones
- en: block dmz drop external home internal libvirt public trusted work
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: block dmz drop external home internal libvirt public trusted work
- en: 'Obtain a list of zones currently active together with the interfaces to which
    they are assigned as follows:'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 获取当前活动区域的列表，并查看它们分配的接口，如下所示：
- en: firewall-cmd --get-active-zones
  id: totrans-61
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: firewall-cmd --get-active-zones
- en: external
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: external
- en: 'interfaces: eth0'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 网络接口：eth0
- en: internal
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: internal
- en: 'interfaces: eth1'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 网络接口：eth1
- en: 'All of the rules currently configured for a specific zone may be listed as
    follows:'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 可以通过以下方式列出当前为特定区域配置的所有规则：
- en: firewall-cmd --zone=home --list-all
  id: totrans-67
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: firewall-cmd --zone=home --list-all
- en: home (active)
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: home (active)
- en: 'target: default'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 'target: default'
- en: 'icmp-block-inversion: no'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 'icmp-block-inversion: no'
- en: 'interfaces: eth0'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 'interfaces: eth0'
- en: 'sources:'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 'sources:'
- en: 'services: cockpit dhcpv6-client http mdns samba-client ssh'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 'services: cockpit dhcpv6-client http mdns samba-client ssh'
- en: 'ports:'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 'ports:'
- en: 'protocols:'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 'protocols:'
- en: 'masquerade: no'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 'masquerade: no'
- en: 'forward-ports:'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 'forward-ports:'
- en: 'source-ports:'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 'source-ports:'
- en: 'icmp-blocks:'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 'icmp-blocks:'
- en: 'rich rules:'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 'rich rules:'
- en: 'Use the following command to list the services currently available for inclusion
    in a firewalld rule:'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 使用以下命令列出当前可用于包含在 firewalld 规则中的服务：
- en: firewall-cmd --get-services
  id: totrans-82
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: firewall-cmd --get-services
- en: RH-Satellite-6 amanda-client amanda-k5-client amqp amqps apcupsd audit bacula
    bacula-client bgp bitcoin bitcoin-rpc bitcoin-testnet bitcoin-testnet-rpc ceph
    ceph-mon cfengine cockpit ...
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: RH-Satellite-6 amanda-client amanda-k5-client amqp amqps apcupsd audit bacula
    bacula-client bgp bitcoin bitcoin-rpc bitcoin-testnet bitcoin-testnet-rpc ceph
    ceph-mon cfengine cockpit ...
- en: 'To list the services currently enabled for a zone:'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 要列出当前为某个区域启用的服务：
- en: firewall-cmd --zone=public --list-services
  id: totrans-85
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: firewall-cmd --zone=public --list-services
- en: cockpit dhcpv6-client ssh
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: cockpit dhcpv6-client ssh
- en: 'A list of port rules can be obtained as follows:'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 可以通过以下方式获取端口规则列表：
- en: firewall-cmd --zone=public --list-ports
  id: totrans-88
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: firewall-cmd --zone=public --list-ports
- en: 9090/tcp
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 9090/tcp
- en: 13.3.3 Adding and Removing Zone Services
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 13.3.3 添加和移除区域服务
- en: 'To add a service to a zone, in this case adding HTTPS to the public zone, the
    following command would be used:'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 要向区域添加服务，在本例中将 HTTPS 添加到公共区域，可使用以下命令：
- en: firewall-cmd --zone=public --add-service=https
  id: totrans-92
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: firewall-cmd --zone=public --add-service=https
- en: success
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: success
- en: 'By default this is a runtime change, so the added rule will be lost after a
    system reboot. To add a service permanently so that it remains in effect next
    time the system restarts, use the --permanent flag:'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，这是一个运行时更改，因此添加的规则将在系统重启后丢失。要永久添加服务，以便下次系统重启时生效，请使用 --permanent 标志：
- en: firewall-cmd --zone=public --permanent --add-service=https
  id: totrans-95
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: firewall-cmd --zone=public --permanent --add-service=https
- en: success
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: success
- en: 'To verify that a service has been added permanently, be sure to include the
    --permanent flag when requesting the service list:'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 要验证某个服务是否已永久添加，确保在请求服务列表时包含 --permanent 标志：
- en: firewall-cmd --zone=public --permanent --list-services
  id: totrans-98
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: firewall-cmd --zone=public --permanent --list-services
- en: cockpit dhcpv6-client http https ssh
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: cockpit dhcpv6-client http https ssh
- en: 'Note that as a permanent change, this new rule will not take effect until the
    system restarts or firewalld reloads:'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，作为永久更改，此新规则将直到系统重启或 firewalld 重新加载后才会生效：
- en: firewall-cmd --reload
  id: totrans-101
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: firewall-cmd --reload
- en: 'Remove a service from a zone using the --remove-service option. Since this
    is a runtime change, the rule will be re-instated the next time the system restarts:'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 --remove-service 选项从区域中移除服务。由于这是一个运行时更改，因此规则将在系统重启后重新应用：
- en: firewall-cmd --zone=public --remove-service=https
  id: totrans-103
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: firewall-cmd --zone=public --remove-service=https
- en: 'To remove a service permanently use the --permanent flag, remembering to reload
    firewalld if the change is required to take immediate effect.:'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 要永久移除服务，请使用 --permanent 标志，并记得在更改需要立即生效时重新加载 firewalld：
- en: firewall-cmd --zone=public --permanent --remove-service=https
  id: totrans-105
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: firewall-cmd --zone=public --permanent --remove-service=https
- en: 13.3.4 Working with Port-based Rules
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 13.3.4 使用基于端口的规则
- en: 'To enable a specific port, use the --add-port option. Note that when manually
    defining the port, both the port number and protocol (TCP or UDP) will need to
    be provided:'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 要启用特定端口，请使用 --add-port 选项。请注意，在手动定义端口时，需要提供端口号和协议（TCP 或 UDP）：
- en: firewall-cmd --zone=public --permanent --add-port=5000/tcp
  id: totrans-108
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: firewall-cmd --zone=public --permanent --add-port=5000/tcp
- en: 'It is also possible to specify a range of ports when adding a rule to a zone:'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 也可以在向区域添加规则时指定端口范围：
- en: firewall-cmd --zone=public --permanent --add-port=5900-5999/udp
  id: totrans-110
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: firewall-cmd --zone=public --permanent --add-port=5900-5999/udp
- en: 13.3.5 Creating a New Zone
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 13.3.5 创建新区域
- en: 'An entirely new zone may be created by running the following command. Once
    created, the zone may be managed in the same way as any of the predefined zones:'
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 可以通过运行以下命令创建一个全新的区域。创建后，可以像管理任何预定义区域一样管理该区域：
- en: firewall-cmd --permanent --new-zone=myoffice
  id: totrans-113
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: firewall-cmd --permanent --new-zone=myoffice
- en: success
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: success
- en: 'After adding a new zone, firewalld will need to be restarted before the zone
    becomes available:'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 在添加新区域后，需要重新启动 firewalld 才能使区域生效：
- en: firewall-cmd --reload
  id: totrans-116
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: firewall-cmd --reload
- en: success
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: success
- en: 13.3.6 Changing Zone/Interface Assignments
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 13.3.6 更改区域/接口分配
- en: 'As previously discussed, each interface on the system must be assigned to a
    zone. The zone to which an interface is assigned can also be changed using the
    firewall-cmd tool. In the following example, the eth0 interface is assigned to
    the public zone:'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，系统上的每个接口必须分配到一个区域。可以使用 firewall-cmd 工具更改接口的区域分配。在以下示例中，eth0 接口被分配到公共区域：
- en: firewall-cmd --zone=public --change-interface=eth0
  id: totrans-120
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: firewall-cmd --zone=public --change-interface=eth0
- en: success
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 成功
- en: 13.3.7 Masquerading
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 13.3.7 伪装
- en: Masquerading is better known in networking administration circles as Network
    Address Translation (NAT). When using a CentOS 8 system as a gateway to the internet
    for a network of computers, masquerading allows all of the internal systems to
    use the IP address of that CentOS 8 system when communicating over the internet.
    This has the advantage of hiding the internal IP addresses of any systems from
    malicious external entities and also avoids the necessity to allocate a public
    IP address to every computer on the network.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 伪装（Masquerading）在网络管理领域更为人熟知，它也叫做网络地址转换（NAT）。当使用 CentOS 8 系统作为网络内计算机的互联网网关时，伪装允许所有内部系统在通过互联网通信时使用该
    CentOS 8 系统的 IP 地址。这有助于隐藏内部系统的 IP 地址，避免恶意外部实体的攻击，并且还避免了为网络上每台计算机分配公共 IP 地址的需要。
- en: 'Use the following command to check whether masquerading is already enabled
    on the firewall:'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 使用以下命令检查防火墙上是否已经启用伪装：
- en: firewall-cmd --zone=external --query-masquerade
  id: totrans-125
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: firewall-cmd --zone=external --query-masquerade
- en: 'Use the following command to enable masquerading (remembering to use the --permanent
    flag if the change is to be permanent):'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 使用以下命令启用伪装（如果需要永久更改，记得使用 --permanent 标志）：
- en: firewall-cmd --zone=external --add-masquerade
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: firewall-cmd --zone=external --add-masquerade
- en: 13.3.8 Adding ICMP Rules
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 13.3.8 添加 ICMP 规则
- en: The Internet Control Message Protocol (ICMP) is used by client systems on networks
    to send information such as error messages to each other. It is also the foundation
    of the ping command which is used by network administrators and users alike to
    detect whether a particular client is alive on a network. The ICMP category allows
    for the blocking of specific ICMP message types. For example, an administrator
    might choose to block incoming ping (Echo Request) ICMP messages to prevent the
    possibility of a ping based denial of service (DoS) attack (where a server is
    maliciously bombarded with so many ping messages that it becomes unable to respond
    to legitimate requests).
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 网络控制消息协议（ICMP）用于网络中的客户端系统之间发送信息，如错误消息。它也是 ping 命令的基础，网络管理员和用户都使用该命令来检测特定客户端是否在线。ICMP
    类别允许阻止特定的 ICMP 消息类型。例如，管理员可能会选择阻止传入的 ping（回显请求）ICMP 消息，以防止基于 ping 的拒绝服务（DoS）攻击（即服务器被恶意发送大量
    ping 消息，导致其无法响应合法请求）。
- en: 'To view the ICMP types available for inclusion in firewalld rules, run the
    following command:'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 要查看 firewalld 规则中可包含的 ICMP 类型，请运行以下命令：
- en: firewall-cmd --get-icmptypes
  id: totrans-131
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: firewall-cmd --get-icmptypes
- en: address-unreachable bad-header beyond-scope communication-prohibited destination-unreachable
    echo-reply ...
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: address-unreachable bad-header beyond-scope communication-prohibited destination-unreachable
    echo-reply ...
- en: 'The following command, for example, permanently adds a rule to block echo-reply
    (ping request) messages for the public zone:'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 以下命令例如，永久添加一条规则，用于阻止公共区域的回显应答（ping请求）消息：
- en: firewall-cmd --zone=public --permanent --add-icmp-block=echo-reply
  id: totrans-134
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: firewall-cmd --zone=public --permanent --add-icmp-block=echo-reply
- en: 13.3.9 Implementing Port Forwarding
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 13.3.9 实现端口转发
- en: Port forwarding is used in conjunction with masquerading when the CentOS 8 system
    is acting as a gateway to the internet for an internal network of computer systems.
    Port forwarding allows traffic arriving at the firewall via the internet on a
    specific port to be forwarded to a particular system on the internal network.
    This is perhaps best described by way of an example.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 端口转发与伪装一起使用，当 CentOS 8 系统作为内部计算机网络的互联网网关时。端口转发允许通过互联网到达防火墙的特定端口的流量被转发到内部网络中的特定系统。这可以通过以下示例来更好地说明。
- en: Suppose that a CentOS 8 system is acting as the firewall for an internal network
    of computers and one of the systems on the network is configured as a web server.
    Let’s assume the web server system has an IP address of 192.168.2.20\. The domain
    record for the web site hosted on this system is configured with the public IP
    address behind which the CentOS 8 firewall system sits. When an HTTP web page
    request arrives on port 80 the CentOS 8 system acting as the firewall needs to
    know what to do with it. By configuring port forwarding it is possible to direct
    all web traffic to the internal system hosting the web server (in this case, IP
    address 192.168.2.20), either continuing to use port 80 or diverting the traffic
    to a different port on the destination server. In fact, port forwarding can even
    be configured to forward the traffic to a different port on the same system as
    the firewall (a concept known as local forwarding).
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 假设CentOS 8系统作为内部计算机网络的防火墙，并且网络中的一台系统被配置为Web服务器。假设该Web服务器系统的IP地址为192.168.2.20。托管在该系统上的网站的域名记录配置了位于CentOS
    8防火墙系统后面的公共IP地址。当一个HTTP网页请求到达端口80时，作为防火墙的CentOS 8系统需要知道如何处理它。通过配置端口转发，可以将所有Web流量定向到托管Web服务器的内部系统（在此案例中为IP地址192.168.2.20），可以继续使用端口80，或将流量重定向到目标服务器的不同端口。实际上，端口转发甚至可以配置为将流量转发到与防火墙相同系统上的不同端口（这种概念称为本地转发）。
- en: 'To use port forwarding, begin by enabling masquerading as follows (in this
    case the assumption is made that the interface connected to the internet has been
    assigned to the external zone):'
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用端口转发，首先启用伪装，如下所示（此处假设连接到互联网的接口已被分配到外部区域）：
- en: firewall-cmd --zone=external --add-masquerade
  id: totrans-139
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: firewall-cmd --zone=external --add-masquerade
- en: 'To forward from a port to a different local port, a command similar to the
    following would be used:'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 要将端口转发到不同的本地端口，可以使用类似于以下的命令：
- en: firewall-cmd --zone=external --add-forward-port=port=22:proto=tcp:toport=2750
  id: totrans-141
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: firewall-cmd --zone=external --add-forward-port=port=22:proto=tcp:toport=2750
- en: 'In the above example, any TCP traffic arriving on port 22 will be forwarded
    to port 2750 on the local system. The following command, on the other hand, forwards
    port 20 on the local system to port 22 on the system with the IP address of 192.168.0.19:'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 在上面的例子中，任何到达端口22的TCP流量都将被转发到本地系统的端口2750。另一方面，以下命令将本地系统的端口20转发到IP地址为192.168.0.19的系统上的端口22：
- en: firewall-cmd --zone=external \
  id: totrans-143
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: firewall-cmd --zone=external \
- en: --add-forward-port=port=20:proto=tcp:toport=22:toaddr=192.168.0.19
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: --add-forward-port=port=20:proto=tcp:toport=22:toaddr=192.168.0.19
- en: 'Similarly, the following command forwards local port 20 to port 2750 on the
    system with IP address 192.168.0.18:'
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 类似地，以下命令将本地端口20转发到IP地址为192.168.0.18的系统上的端口2750：
- en: firewall-cmd --zone=external --add-forward-port=port=20:proto=tcp:toport=2750:toaddr=192.168.0.18
  id: totrans-146
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: firewall-cmd --zone=external --add-forward-port=port=20:proto=tcp:toport=2750:toaddr=192.168.0.18
- en: 13.4 Managing firewalld from the Cockpit Interface
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 13.4 从Cockpit界面管理firewalld
- en: So far this chapter has provided an overview of firewalld and explored the use
    of the firewall-cmd command-line tool to manage firewall zones and interfaces.
    While firewall-cmd provides the most flexible way to manage the firewalld configuration,
    it is also possible to view and manage the services for the default zone within
    the Cockpit web console.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，本章已概述了firewalld并探讨了使用firewall-cmd命令行工具来管理防火墙区域和接口。虽然firewall-cmd提供了最灵活的方式来管理firewalld配置，但也可以通过Cockpit
    Web控制台查看和管理默认区域的服务。
- en: 'To access the firewalld settings, sign into the Cockpit interface and select
    Networking from the navigation panel. On the networking page, select the Firewall
    option as highlighted in [Figure 13-1](../Text/Firewall_Configuration.xhtml#_idTextAnchor177)
    below:'
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 要访问firewalld设置，请登录到Cockpit界面并从导航面板选择“Networking”。在网络页面上，选择防火墙选项，具体如[图13-1](../Text/Firewall_Configuration.xhtml#_idTextAnchor177)所示：
- en: '![](img/rhel_8_firewall_link_cockpit.png)'
  id: totrans-150
  prefs: []
  type: TYPE_IMG
  zh: '![](img/rhel_8_firewall_link_cockpit.png)'
- en: Figure 13-1
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 图13-1
- en: 'The Firewall page displays the current service rules configured for the default
    zone (and allows services to be removed using the trash can buttons), new services
    to be added to the zone and for the firewall to be turned on and off:'
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 防火墙页面显示了为默认区域配置的当前服务规则（并允许使用垃圾桶按钮删除服务），可以向区域添加新服务，并可打开或关闭防火墙：
- en: '![](img/rhel_8_firewall_cockpit_page.png)'
  id: totrans-153
  prefs: []
  type: TYPE_IMG
  zh: '![](img/rhel_8_firewall_cockpit_page.png)'
- en: Figure 13-2
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 图13-2
- en: 13.5 Managing firewalld using firewall-config
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 13.5 使用firewall-config管理firewalld
- en: 'If you have access to the graphical desktop environment, the firewall may also
    be configured using the firewall-config tool. Though not installed by default,
    firewall-config may be installed as follows:'
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你可以访问图形桌面环境，也可以使用 firewall-config 工具来配置防火墙。虽然它默认没有安装，但可以通过以下方式安装 firewall-config：
- en: dnf install firewall-config
  id: totrans-157
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: dnf install firewall-config
- en: 'When launched, the main firewall-config screen appears as illustrated in [Figure
    13-3](../Text/Firewall_Configuration.xhtml#_idTextAnchor179):'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 启动时，主 firewall-config 屏幕如 [图 13-3](../Text/Firewall_Configuration.xhtml#_idTextAnchor179)
    所示：
- en: '![](img/rhel_8_firewall-config.png)'
  id: totrans-159
  prefs: []
  type: TYPE_IMG
  zh: '![](img/rhel_8_firewall-config.png)'
- en: Figure 13-3
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 图 13-3
- en: 'The key areas of the tool can be summarized as follows:'
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 工具的关键区域可以总结如下：
- en: A - Displays all of the currently active interfaces and the zones to which they
    are assigned. To assign an interface to a different zone, select it from this
    panel, click on the Change Zone button and select the required zone from the resulting
    dialog.
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: A - 显示当前所有活动的接口及其分配的区域。要将接口分配到另一个区域，从此面板中选择接口，点击更改区域按钮，并从弹出的对话框中选择所需的区域。
- en: B - Controls whether the information displayed and any changes made within the
    tool apply to the runtime or permanent rules.
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: B - 控制工具内显示的信息以及所做的更改是否适用于运行时或永久规则。
- en: C - The list of zones, services or IPSets configured on the system. The information
    listed in this panel depends on the selection made from toolbar F. Selecting an
    item from the list in this panel updates the main panel marked D.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: C - 系统上配置的区域、服务或 IPSets 的列表。此面板中列出的信息取决于工具栏 F 中所做的选择。从此面板中的列表中选择项目会更新标记为 D 的主面板。
- en: D - The main panel containing information about the current category selection
    in toolbar E. In this example, the panel is displaying services for the public
    zone. The checkboxes next to each service control whether the service is enabled
    or not within the firewall. It is within these category panels that new rules
    can be added or existing rules configured or removed.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: D - 主面板，包含有关工具栏 E 中当前类别选择的信息。在此示例中，面板显示的是公共区域的服务。每个服务旁边的复选框控制该服务是否在防火墙中启用。可以在这些类别面板中添加新规则、配置现有规则或删除规则。
- en: E - Controls the content displayed in panel D. Selecting items from this bar
    displays the current rule for the chosen category.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: E - 控制面板 D 中显示的内容。从此栏中选择项目会显示所选类别的当前规则。
- en: F - Controls the list displayed in panel C.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: F - 控制面板 C 中显示的列表。
- en: The firewall-config tool is straightforward and intuitive to use and allows
    many of the tasks available with firewall-cmd to be performed in a visual environment.
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: firewall-config 工具直观易用，允许在可视化环境中执行 firewall-cmd 提供的许多任务。
- en: 13.6 Summary
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 13.6 小结
- en: A carefully planned and implemented firewall is a vital component of any secure
    system. In the case of CentOS 8, the firewalld service provides a firewall system
    that is both flexible and easy to administer.
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 精心规划和实施的防火墙是任何安全系统的重要组成部分。以 CentOS 8 为例，firewalld 服务提供了一个既灵活又易于管理的防火墙系统。
- en: The firewalld service uses the concept of zones to group together sets of firewall
    rules and includes a suite of pre-defined zones designed to meet a range of firewall
    protection requirements. These zones may be modified to add or remove rules, or
    entirely new zones created and configured. The network devices on the system that
    connect to networks or the internet are referred to as interfaces. Each interface,
    in turn, is assigned to a zone. The primary tools for working with firewalld are
    the firewall-cmd command-line tool and the firewall-config graphical utility.
    Minimal firewall management options are also available via the Cockpit web interface.
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: firewalld 服务使用区域的概念来将一组防火墙规则进行分组，并包括一套预定义的区域，旨在满足各种防火墙保护要求。这些区域可以修改以添加或删除规则，或者完全创建并配置新的区域。系统中连接到网络或互联网的网络设备被称为接口。每个接口都会被分配到一个区域。与
    firewalld 一起工作的主要工具是 firewall-cmd 命令行工具和 firewall-config 图形工具。通过 Cockpit Web 界面，还可以使用最小的防火墙管理选项。
