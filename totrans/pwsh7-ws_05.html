<html><head></head><body>
		<div id="_idContainer113">
			<h1 id="_idParaDest-95" class="chapter-number"><a id="_idTextAnchor096"/>5</h1>
			<h1 id="_idParaDest-96"><a id="_idTextAnchor097"/>PowerShell Control Flow – Conditionals and Loops</h1>
			<p>So far, everything we have done has been one thing after another, to paraphrase Arnold Toynbee. That’s fine, but it doesn’t reflect how we want things to happen in the real world. Most of the time, we want our code to do different things depending on the circumstances, and sometimes we want it to do something a number of times. This is where control flow is necessary. In this chapter, we are going to look at how to make PowerShell do different things in a script, depending on what it finds – these are called <strong class="bold">conditionals</strong>. Then<a id="_idIndexMarker314"/> we are going to look at how to make PowerShell repeat a process, both for a predetermined number of times and for an indefinite number. Because an indefinite number may be effectively infinite, we are going to look at how to break out of and continue <span class="No-Break">looping behavior.</span></p>
			<p>Doing this effectively requires writing multiple lines of code, so first, we are going to talk about <strong class="bold">Integrated Development Environments</strong> (<strong class="bold">IDEs</strong>) and then install the one that is<a id="_idIndexMarker315"/> recommended for PowerShell 7, Visual <span class="No-Break">Studio Code.</span></p>
			<p>In this chapter, we are going to cover the following <span class="No-Break">main topics:</span></p>
			<ul>
				<li>An introduction to IDEs and <span class="No-Break">VS Code</span></li>
				<li>Conditional control – <strong class="source-inline">if</strong>, <strong class="source-inline">else</strong>, <strong class="source-inline">elseif</strong>, <span class="No-Break">and </span><span class="No-Break"><strong class="source-inline">switch</strong></span></li>
				<li>Loops – <strong class="source-inline">foreach</strong>, <strong class="source-inline">do while</strong>, <strong class="source-inline">do until</strong>, <strong class="source-inline">while</strong>, <span class="No-Break">and </span><span class="No-Break"><strong class="source-inline">for</strong></span></li>
				<li>Breaking <span class="No-Break">and continuing</span></li>
				<li>Let’s play <span class="No-Break">a game</span></li>
			</ul>
			<h1 id="_idParaDest-97"><a id="_idTextAnchor098"/>An introduction to IDEs and VS Code</h1>
			<p>The console is <a id="_idIndexMarker316"/>great for running a line or two of <a id="_idIndexMarker317"/>code or for quickly checking whether an idea will work, but it cannot save our code, and we can’t edit it. We need an editor. The simplest editor is whichever text editor we have installed on our machine, for instance, Notepad on Windows or Vi on Linux. These will do the bare minimum in that we can write our code, save it, and come back and edit it. They won’t do any more than that, though, and there are much better <span class="No-Break">options available.</span></p>
			<p>An IDE will highlight commands and keywords and do some syntax checking, and the good ones will also come with a built-in console to allow us to test our code by running short sections of it, sometimes just a line or the whole thing at once. They also usually have some sort of debugging facility, allowing us to stop our code at certain points and check the contents of variables. Most languages come with some form of IDE, for instance, Python has <strong class="bold">IDLE</strong>, the <strong class="bold">Integrated Development and Learning Environment</strong>, but I don’t know many people who use it for their work, and Windows PowerShell has the <strong class="bold">Integrated Scripting Environment</strong>, or <strong class="bold">ISE</strong>, which is excellent, but has not been made<a id="_idIndexMarker318"/> available for PowerShell 7. Instead, the recommended IDE for PowerShell 7 is <strong class="bold">Visual Studio Code</strong> (<strong class="bold">VS Code</strong>), an open source JavaScript-based environment <span class="No-Break">from Microsoft.</span></p>
			<p>VS Code is highly extensible (translation – lots of people have written add-ons for it) and can be used with a wide range of languages. All we need to do is download our choice of language modules. There are also add-ons that check syntax, allow us to use code snippets, connect <a id="_idIndexMarker319"/>us to code repositories, such <a id="_idIndexMarker320"/>as Git, integrate testing, and generally do anything we could do with a far more expensive IDE, such as Eclipse. Rather than talk about it, let’s get <span class="No-Break">it installed.</span></p>
			<h2 id="_idParaDest-98"><a id="_idTextAnchor099"/>Installing VS Code</h2>
			<p>VS Code can be <a id="_idIndexMarker321"/>installed on Windows, Linux, macOS, and Raspberry Pi – that’s right, there’s a Raspbian install. It’s pretty simple. Go to the VS Code download page at <a href="https://code.visualstudio.com/download">https://code.visualstudio.com/download</a>, and click on the relevant package for the machine and operating system we are working on; so for a Raspberry Pi, we would select the <strong class="source-inline">.deb</strong> ARM download. Once it’s downloaded, change to the folder or directory where we’ve saved <span class="No-Break">the package.</span></p>
			<h3>Linux</h3>
			<p>VS Code is a <a id="_idIndexMarker322"/>graphical tool, so we need to use a desktop <a id="_idIndexMarker323"/>environment with Linux. For Ubuntu and other Debian-based versions, we just need to run the <span class="No-Break">following commands:</span></p>
			<pre class="console">
sudo apt update
sudo apt install ./&lt;filename&gt;.deb</pre>			<p>For Raspbian, it’s <span class="No-Break">easier still:</span></p>
			<pre class="console">
sudo apt update
sudo apt install code</pre>			<p>These commands will <span class="No-Break">do it.</span></p>
			<p>Things are a little more complicated for Red Hat distros. The easiest way is probably with snapd, in<a id="_idIndexMarker324"/> which case the following <span class="No-Break">will work:</span></p>
			<pre class="console">
sudo snap install code –classic</pre>			<p>There are more detailed instructions on installing VS Code for Linux <span class="No-Break">at </span><a href="https://code.visualstudio.com/docs/setup/linux"><span class="No-Break">https://code.visualstudio.com/docs/setup/linux</span></a><span class="No-Break">.</span></p>
			<h3>macOS</h3>
			<p>To install VS <a id="_idIndexMarker325"/>Code on macOS, download the relevant Mac<a id="_idIndexMarker326"/> installer <strong class="source-inline">.zip</strong> file and extract the contents. Drag the <strong class="source-inline">Visual Studio Code.app</strong> to the <strong class="source-inline">Applications</strong> folder, which will make VS Code available <span class="No-Break">in </span><span class="No-Break"><strong class="bold">Launchpad</strong></span><span class="No-Break">.</span></p>
			<h3>Windows</h3>
			<p>In Windows, we <a id="_idIndexMarker327"/>have a choice of user or system installations. If <a id="_idIndexMarker328"/>we follow the user install option, the application gets installed by default in <strong class="source-inline">C:\Users\&lt;username&gt;\AppData\Local\Programs\Microsoft VS Code</strong> and is only available for the user who installed it. If we use the system installer, then it gets installed in <strong class="source-inline">C:\Program Files\Microsoft VS Code</strong> and requires administrator privileges to install. Automatic updates are easier if we install the user installation package, so let’s go ahead and download <span class="No-Break">that one:</span></p>
			<ol>
				<li>Once it’s downloaded, browse to the <strong class="source-inline">Download</strong> location and double-click the <strong class="source-inline">.</strong><span class="No-Break"><strong class="source-inline">exe</strong></span><span class="No-Break"> file.</span></li>
				<li>Accept <a id="_idIndexMarker329"/>the <strong class="bold">End-User License Agreement</strong> (<strong class="bold">EULA</strong>) and <span class="No-Break">click </span><span class="No-Break"><strong class="bold">Next</strong></span><span class="No-Break">.</span></li>
				<li>Change the installation location if you want, and <span class="No-Break">click </span><span class="No-Break"><strong class="bold">Next</strong></span><span class="No-Break">.</span></li>
				<li>Decide whether you want a <em class="italic">Start</em> menu folder, and <span class="No-Break">click </span><span class="No-Break"><strong class="bold">Next</strong></span><span class="No-Break">.</span></li>
				<li>On the <strong class="bold">Select Additional Tasks</strong> dialog, decide whether you want a desktop icon and file and directory context menu options, enabling you to open files and folders directly in VS Code. I’d recommend you accept the defaults of adding VS Code to your <strong class="source-inline">PATH</strong> environment variable and registering code as an editor for supported <a id="_idIndexMarker330"/>file <a id="_idIndexMarker331"/>types. <span class="No-Break">Click </span><span class="No-Break"><strong class="bold">Next</strong></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer092" class="IMG---Figure">
					<img src="image/B17600_05_01.jpg" alt="Figure 5.1 – Select Additional Tasks for the VS Code installation"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.1 – Select Additional Tasks for the VS Code installation</p>
			<ol>
				<li value="6">Review<a id="_idIndexMarker332"/> the<a id="_idIndexMarker333"/> installation options and <span class="No-Break">click </span><span class="No-Break"><strong class="bold">Install</strong></span><span class="No-Break">.</span></li>
				<li>Click <strong class="bold">Finish</strong> and admire your new VS <span class="No-Break">Code installation.</span></li>
			</ol>
			<h4>A really quick way for Windows</h4>
			<p>If we’ve got <a id="_idIndexMarker334"/>the <strong class="source-inline">PowerShellGet</strong> module installed, then we can run <span class="No-Break">the following:</span></p>
			<pre class="console">
Install-Script Install-VSCode -Scope CurrentUser ; Install-VSCode.PS1</pre>			<p>Press <strong class="source-inline">Y</strong> to agree <strong class="source-inline">Yes</strong>, and that’s it. This method is great for when we know what we’re doing with VS Code, but if this is our first time with it, let’s do things manually so we can see exactly what’s <span class="No-Break">going on.</span></p>
			<h2 id="_idParaDest-99"><a id="_idTextAnchor100"/>Configuring VS Code for PowerShell</h2>
			<p>Now we’ve got<a id="_idIndexMarker335"/> VS Code installed, we need to tell it to<a id="_idIndexMarker336"/> recognize the PowerShell language. On installation VS Code has no idea about PowerShell. We need to install an extension. Open VS Code, if it isn’t already open, by typing <strong class="source-inline">Code</strong> in the search bar and selecting the application in the results. In the main window, click on the <em class="italic">Extensions</em> icon on the far-left edge of the window – it looks like a pile <span class="No-Break">of boxes:</span></p>
			<div>
				<div id="_idContainer093" class="IMG---Figure">
					<img src="image/B17600_05_02.jpg" alt="Figure 5.2 – Finding the PowerShell extension for VS Code"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.2 – Finding the PowerShell extension for VS Code</p>
			<p>Type <strong class="source-inline">powershell</strong> in the<a id="_idIndexMarker337"/> extensions search bar. We<a id="_idIndexMarker338"/> want the PowerShell extension by Microsoft; it’s the first result, as shown in the following screenshot. Click on it, and then click the blue <strong class="bold">Install</strong> button in the <span class="No-Break">main pane:</span></p>
			<div>
				<div id="_idContainer094" class="IMG---Figure">
					<img src="image/B17600_05_03.jpg" alt="Figure 5.3 – Installing the PowerShell extension for VS Code"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.3 – Installing the PowerShell extension for VS Code</p>
			<p>Let’s get <a id="_idIndexMarker339"/>started. Press <em class="italic">Ctrl</em> +<em class="italic"> N</em> to open a new file. We’ll be<a id="_idIndexMarker340"/> asked to select a language. We don’t have to do this, but doing so means we have assistance ready from the start; we can type without specifying a language, but the syntax checking and highlighting won’t be available until we save our file as a PowerShell script by using the <strong class="source-inline">.ps1</strong> file extension. Go ahead and click to select <strong class="bold">PowerShell</strong> from the dropdown. We can change the language at any time by clicking on the language name in the bottom-right corner; if we haven’t selected a language then it says <span class="No-Break"><strong class="bold">Plain Text</strong></span><span class="No-Break">.</span></p>
			<p>The first thing we should see after selecting PowerShell is that the PowerShell integrated terminal has started at the bottom of the screen. We can run PowerShell cmdlets in there, and when we run our code from the top window, the results will appear in the terminal. Try this – in the top window, <span class="No-Break">type </span><span class="No-Break"><strong class="source-inline">write-outp</strong></span><span class="No-Break">.</span></p>
			<p>You should see VS Code give you a helpful autocomplete option <span class="No-Break">like this:</span></p>
			<div>
				<div id="_idContainer095" class="IMG---Figure">
					<img src="image/B17600_05_04.jpg" alt="Figure 5.4 – Autocomplete in VS Code"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.4 – Autocomplete in VS Code</p>
			<p>Not only does it <a id="_idIndexMarker341"/>autocomplete for you, but it also gives hints <a id="_idIndexMarker342"/>about how the cmdlet is used; if you hover over the suggestion, you will see a <strong class="bold">&gt;</strong> to the right of it. Click on that to read more about the cmdlet. Complete the cmdlet with some suitable text string, and press <em class="italic">Ctrl</em> + <em class="italic">S</em> to save it – give it a suitable filename ending in <strong class="source-inline">.ps1</strong>; I’ve used <strong class="source-inline">HelloWorld.ps1</strong>. Now click the play icon (arrow) at the top right of the window to run the code. It should look something <span class="No-Break">like this:</span></p>
			<div>
				<div id="_idContainer096" class="IMG---Figure">
					<img src="image/B17600_05_05.jpg" alt="Figure 5.5 – Running PowerShell in VS Code"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.5 – Running PowerShell in VS Code</p>
			<p>If you get an <a id="_idIndexMarker343"/>output that looks like the preceding<a id="_idIndexMarker344"/> screenshot, congratulations. You’ve run your <span class="No-Break">first script!</span></p>
			<p class="callout-heading">Top tip for switching terminal environments</p>
			<p class="callout">If you’re running on Windows, you’ve probably got at least two different versions of PowerShell installed – PowerShell 7 and Windows PowerShell. How do you swap between them? Click on the curly braces (<strong class="bold">{}</strong>) next to the word <strong class="bold">PowerShell</strong> in the bottom right of the screen. Open <strong class="bold">PowerShell Session Menu</strong>, and you’ll be given the option to switch between the different versions of PowerShell you have installed and registered in your <strong class="source-inline">PATH</strong> environment variable. You can use the <strong class="source-inline">$PSVersionTable</strong> variable to check which version <span class="No-Break">you’re running.</span></p>
			<p>VS Code is incredibly powerful and has hundreds of features and extensions, meaning we can spend a good chunk of our day using it, but this has a few drawbacks to be <span class="No-Break">aware of:</span></p>
			<ul>
				<li>Because it is open source and frequently updated, blog articles and tutorials on the internet (or, heaven forfend, a book on PowerShell programming) can become rapidly out of date. We need to carefully research how to use a feature or understand why something doesn’t work and be wary of any source more than a year or <span class="No-Break">two old.</span></li>
				<li>Because it is open source and extensible, there can be quite a steep learning curve. As we go through the book, we’ll cover quite a few of the common use cases and features, but we’ll barely scratch the surface of the things we can do with this software. The official Microsoft documentation is up to date, if not particularly user-friendly. We should supplement our reading with trustworthy articles and useful websites, such as Stack Overflow <span class="No-Break">and Spiceworks.</span></li>
				<li>Because it is open source and extensible, anyone can write extensions for it. This means that sometimes extensions will be brilliant, and sometimes they will be less useful. It can also be the case that an extension that was marvelous two years ago has now fallen into disrepair because the author wrote it as a fun project and is now concentrating on <span class="No-Break">other things.</span></li>
			</ul>
			<p>These drawbacks aside, VS Code is incredibly useful. When we come across something that makes us wince in frustration, we should pause, be kind, and work around it. Better still, fix it; that<a id="_idIndexMarker345"/> is <a id="_idIndexMarker346"/>part of the joy of open <span class="No-Break">source software.</span></p>
			<p>Now we have VS Code installed and ready to use, let’s move on to the actual topic of the chapter; PowerShell control flow. We are going to start <span class="No-Break">with conditionals.</span></p>
			<h1 id="_idParaDest-100"><a id="_idTextAnchor101"/>Conditional control – if, else, elseif, and switch</h1>
			<p>Conditional control<a id="_idIndexMarker347"/> flow is based on a simple statement. If this thing is true, then do that thing. The first part is a Boolean expression. The second part is an action based on the resolution of the Boolean. A Boolean expression will resolve to one of two values: true or false. We discussed Boolean operators in <a href="B17600_03.xhtml#_idTextAnchor049"><span class="No-Break"><em class="italic">Chapter 3</em></span></a>, <em class="italic">The PowerShell Pipeline – How to String Cmdlets Together</em>, in the <em class="italic">Understanding Where-Object advanced syntax</em> section. Consider the following <span class="No-Break">two statements:</span></p>
			<pre class="source-code">
1 -eq 1
1 -eq 2</pre>			<p>The first one resolves to the Boolean-type object true. The second one resolves to false. Try it if you don’t believe me. It’s not often that we need to check whether 1 is the same as 2, but we frequently need to <span class="No-Break">compare variables:</span></p>
			<div>
				<div id="_idContainer097" class="IMG---Figure">
					<img src="image/B17600_05_06.jpg" alt="Figure 5.6 – Just checking"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.6 – Just checking</p>
			<p>That covers the first <a id="_idIndexMarker348"/>part of our logic; next, we need to be able to perform an action based on the result of our test. Let’s get VS Code ready for some fun. Let’s close VS Code <span class="No-Break">for now.</span></p>
			<p>Go to your PowerShell prompt (not the one in VS Code) and type the following to create a working directory, move to it, and start VS Code <span class="No-Break">inside it:</span></p>
			<pre class="console">
New-Item -Path C:\Temp\Poshbook -ItemType Directory
Set-Location -Path C:\Temp\Poshbook
Code .</pre>			<p>The period after <strong class="source-inline">Code</strong> is important. Don’t miss it, or you will be working in the wrong location. VS Code will start and ask whether you want to trust the authors of the files in this folder. We probably do, as we are going to be the authors. We’re going to need a new file to work in, so press <em class="italic">Ctrl</em> + <em class="italic">N</em> to create a new file and select <strong class="bold">PowerShell</strong> as the language. Press <em class="italic">Ctrl</em> + <em class="italic">S</em> to save it as <strong class="source-inline">Conditionals.ps1</strong>. We have our blank canvas. Let’s go <span class="No-Break">to work.</span></p>
			<h2 id="_idParaDest-101"><a id="_idTextAnchor102"/>The if statement</h2>
			<p>The first conditional <a id="_idIndexMarker349"/>we’ll look at is the simplest – the <strong class="source-inline">if</strong> statement. We can use this <a id="_idIndexMarker350"/>to perform an action based on whether an expression is true or false. Type this in the <span class="No-Break">script pane:</span></p>
			<pre class="source-code">
$x = 5
if ($X -gt 4) {
    Write-Output '$x is bigger than 4'
}</pre>			<p>The brackets contain an expression that needs to be evaluated. The curly braces contain a scriptblock that will run if the expression resolves to true. Now, highlight your lines and press <em class="italic">F8</em>. Your code will run, and you should see the output in the <span class="No-Break">terminal window:</span></p>
			<div>
				<div id="_idContainer098" class="IMG---Figure">
					<img src="image/B17600_05_07.jpg" alt="Figure 5.7 – The if statement"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.7 – The if statement</p>
			<p>Be careful to use single quotes; review <a href="B17600_04.xhtml#_idTextAnchor071"><span class="No-Break"><em class="italic">Chapter 4</em></span></a>, <em class="italic">PowerShell Variables and Data Structures</em>, to understand why. If you use double quotes in the action, then you will see the output <strong class="source-inline">5 is bigger than 4</strong>, because you’ve expanded the <strong class="source-inline">$</strong><span class="No-Break"><strong class="source-inline">x</strong></span><span class="No-Break"> variable.</span></p>
			<p class="callout-heading">Top tip</p>
			<p class="callout">After you type <strong class="source-inline">if</strong>, pause for a second to let VS Code catch up. It will offer you a choice of cmdlets and keywords. Click on <strong class="source-inline">if</strong> in the list, and it will construct the statement for you, as shown in lines 7 to 9 in <span class="No-Break"><em class="italic">Figure 5</em></span><em class="italic">.7</em>. All you need to do is fill in the condition and <span class="No-Break">the action.</span></p>
			<p>Look at the green text on lines 3 and 8. Those are comments. We use them to make our code more readable and to clarify what we are doing. A single-line comment is started with <strong class="source-inline">#</strong>; everything after the <strong class="source-inline">#</strong> will be ignored by PowerShell. A multi-line comment starts with <strong class="source-inline">&lt;#</strong> and ends with <strong class="source-inline">#&gt;</strong>. These comments were autogenerated by VS Code; we can leave them in or delete them. It makes no difference to how the <span class="No-Break">code runs.</span></p>
			<p>We can test <a id="_idIndexMarker351"/>whether<a id="_idIndexMarker352"/> a statement is false as well. Type this below <span class="No-Break">line 9:</span></p>
			<pre class="source-code">
if (!($x -lt 4)) {
    Write-Output ' $x is bigger than 4'
}</pre>			<p>We’re using<strong class="source-inline">!</strong> as a <strong class="source-inline">-not</strong> operator there. We could write line 11 <span class="No-Break">as follows:</span></p>
			<pre class="source-code">
for (-not($x -lt 4)) {</pre>			<p>But you won’t see the <strong class="source-inline">-not</strong> operator written out like that very often – most people use <strong class="source-inline">!</strong>. If you highlight that code and press <em class="italic">F8</em> then you get the output <strong class="source-inline">$x is bigger than </strong><span class="No-Break"><strong class="source-inline">4</strong></span><span class="No-Break">, again:</span></p>
			<div>
				<div id="_idContainer099" class="IMG---Figure">
					<img src="image/B17600_05_08.jpg" alt="Figure 5.8 – Reversing a condition with the -not operator"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.8 – Reversing a condition with the -not operator</p>
			<p>If <strong class="source-inline">$x</strong> is smaller than 4, we will get no output, and the script will move on to the next line after the <strong class="source-inline">if</strong> statement – we <a id="_idIndexMarker353"/>don’t need to do anything else. What happens if we want the <a id="_idIndexMarker354"/>script to do one thing if a statement is true and something else if a statement <span class="No-Break">is false?</span></p>
			<h3>The else statement</h3>
			<p>We can <a id="_idIndexMarker355"/>use<a id="_idIndexMarker356"/> the <strong class="source-inline">else</strong> statement to specify a second action if the test condition for the <strong class="source-inline">if</strong> statement isn’t true. Type this starting on line 15 – use the autocomplete for the <strong class="source-inline">else</strong> statement and notice we are using <strong class="source-inline">-lt</strong> in the condition, <span class="No-Break">not </span><span class="No-Break"><strong class="source-inline">-gt</strong></span><span class="No-Break">:</span></p>
			<pre class="source-code">
if ($x -lt 4) {
    Write-Output '$x is smaller than 4'
}
else {
    &lt;# Action when all if and elseif conditions are false #&gt;
    Write-Output '$x is not smaller than 4'
}</pre>			<p>Now select lines 15-22 and <span class="No-Break">hit </span><span class="No-Break"><em class="italic">F8</em></span><span class="No-Break">:</span></p>
			<div>
				<div id="_idContainer100" class="IMG---Figure">
					<img src="image/B17600_05_09.jpg" alt="Figure 5.9 – Using the else statement"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.9 – Using the else statement</p>
			<p>Notice the remark on line 20 from autocompleting the <strong class="source-inline">else</strong> statement: <strong class="source-inline">Action when all if and elseif conditions are false</strong>. The <strong class="source-inline">else</strong> statement is a catch-all if no conditions are true. But how do we test for multiple conditions? We could write multiple <strong class="source-inline">if</strong> statements, one after another, but each statement would execute<a id="_idIndexMarker357"/> regardless <a id="_idIndexMarker358"/>of the statement before. We could nest <strong class="source-inline">if</strong> statements inside each other, but that would be a lot <span class="No-Break">of work.</span></p>
			<h3>The elseif statement</h3>
			<p>We can use <strong class="source-inline">elseif</strong> to <a id="_idIndexMarker359"/>specify <a id="_idIndexMarker360"/>multiple conditions to test for multiple conditions within a single <strong class="source-inline">if</strong> statement. Type this on line 24. Use autocomplete to help get <span class="No-Break">everything right:</span></p>
			<pre class="source-code">
if ($x -lt 5) {
    Write-Output '$x is less than 5'
}
elseif ($x -gt 5) {
    Write-Output '$x is bigger than 5'
}
else {
    Write-Output '$x is 5'
}</pre>			<p>Highlight the code<a id="_idIndexMarker361"/> you’ve just <a id="_idIndexMarker362"/>entered and hit <em class="italic">F8</em>. You should see the output <span class="No-Break">as follows:</span></p>
			<div>
				<div id="_idContainer101" class="IMG---Figure">
					<img src="image/B17600_05_10.jpg" alt="Figure 5.10 – Using the elseif statement"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.10 – Using the elseif statement</p>
			<p>You can have as many <strong class="source-inline">elseif</strong> statements as you need, but once one is true, the parent <strong class="source-inline">if</strong> statement will exit. <span class="No-Break">Try this:</span></p>
			<pre class="source-code">
if ($x -lt 5) {
    Write-Output '$x is less than 5'
}
elseif ($x -lt 6) {
    Write-Output '$x is less than 6'
}
else {
    Write-Output '$x is 5'
}</pre>			<p>We get the<a id="_idIndexMarker363"/> output <strong class="source-inline">$x is less than 6</strong>. The <strong class="source-inline">else</strong> statement<a id="_idIndexMarker364"/> never gets <span class="No-Break">to run.</span></p>
			<h3>The ternary operator</h3>
			<p>PowerShell 7 has a<a id="_idIndexMarker365"/> new<a id="_idIndexMarker366"/> operator that allows us to construct simple <strong class="source-inline">if</strong>/<strong class="source-inline">else</strong> statement pairs in a single line. On line 15 of our code, we have the <span class="No-Break">following example:</span></p>
			<pre class="source-code">
if ($x -lt 4) {
    Write-Output ' $x is smaller than 4'
}
else {
    &lt;# Action when all if and elseif conditions are false #&gt;
    Write-Output '$x is not smaller than 4'
}</pre>			<p>We can rewrite this with the ternary operator <span class="No-Break">like so:</span></p>
			<pre class="source-code">
($x -lt 4) ? '$x is smaller than 4' : '$x is not smaller than 4'</pre>			<p>This is great and will save a lot of typing, but it’s also less readable. The question mark character (<strong class="source-inline">?)</strong> can also be used as an alias for the <strong class="source-inline">Where-Object</strong> cmdlet, but it’s not being used that way here. Remember that our code will be read many more times than it <span class="No-Break">is written.</span></p>
			<p>What happens if <a id="_idIndexMarker367"/>multiple <a id="_idIndexMarker368"/>statements are true? Let’s look at a way we can <span class="No-Break">handle that.</span></p>
			<h2 id="_idParaDest-102"><a id="_idTextAnchor103"/>The switch statement</h2>
			<p>We could test for <a id="_idIndexMarker369"/>multiple <a id="_idIndexMarker370"/>conditions with multiple <strong class="source-inline">if</strong> statements, but that might get complicated, so there is a special statement to test for multiple true conditions – <strong class="source-inline">switch</strong>. The <strong class="source-inline">switch</strong> statement tests each condition and executes the associated scriptblock for that condition. Every condition that is true will execute. Let’s see how it works. On a new line, type <span class="No-Break">the following:</span></p>
			<pre class="source-code">
$Array  = 1,2,3,4,5
switch ($Array) {
    1 {Write-Output '$Array contains 1'}
    3 {Write-Output '$Array contains 3'}
    6 {Write-Output '$Array contains 6'}
}</pre>			<p>If you select the code and press <em class="italic">F8</em> you should see the <span class="No-Break">following output:</span></p>
			<div>
				<div id="_idContainer102" class="IMG---Figure">
					<img src="image/B17600_05_11.jpg" alt="Figure 5.11 – Using the switch statement"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.11 – Using the switch statement</p>
			<p>There are lots of <a id="_idIndexMarker371"/>things we can do with the <strong class="source-inline">switch</strong> statement. Consider <a id="_idIndexMarker372"/>the <span class="No-Break">following example:</span></p>
			<pre class="source-code">
$String = "Powershell 7"
Switch -Wildcard -CaseSensitive ($String) {
    7 { Write-Output 'contains 7' }
    "Pow*" { Write-Output 'contains Pow'}
    'pow*' { Write-Output 'contains pow'}
    '*she*' { Write-Output 'contains she'}
    {$String.Length -gt 7} { Write-Output "long string"}
    Default {Write-Output "No powershell here"}
}</pre>			<p>Here, we are running through a string. We’ve used the <strong class="source-inline">-Wildcard</strong> and <strong class="source-inline">-CaseSensitive</strong> parameters to check for matching portions of the string and make sure that the cases match as well. We’re evaluating a property of the string, not just the content, and finally, we are setting a <span class="No-Break">default output:</span></p>
			<div>
				<div id="_idContainer103" class="IMG---Figure">
					<img src="image/B17600_05_12.jpg" alt="Figure 5.12 – Switch options"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.12 – Switch options</p>
			<p>Let’s have a<a id="_idIndexMarker373"/> look <a id="_idIndexMarker374"/>at the lines of code in <span class="No-Break">the screenshot:</span></p>
			<ul>
				<li>In line 75, we’re setting parameters for the <strong class="source-inline">switch</strong> statement – notice they have to come before the expression to be evaluated that is enclosed <span class="No-Break">in brackets.</span></li>
				<li>In line 76, we’re asking whether the string contains the integer <strong class="source-inline">7</strong>. In lines 77 and 78, we’re demonstrating the use of the <strong class="source-inline">-</strong><span class="No-Break"><strong class="source-inline">CaseSensitive</strong></span><span class="No-Break"> parameter.</span></li>
				<li>In line 80, we’re evaluating a property of the string, its length. Notice that this has to go in a scriptblock, so it needs curly braces, <span class="No-Break">not brackets.</span></li>
				<li>Finally, on line 81, we are setting a default output – this will only be produced if no other conditions <a id="_idTextAnchor104"/>in the <strong class="source-inline">switch</strong> statement <span class="No-Break">get matched.</span></li>
			</ul>
			<p class="callout-heading">Activity 1</p>
			<p class="callout">Why doesn’t the output produce the line <span class="No-Break"><strong class="source-inline">contains 7</strong></span><span class="No-Break">?</span></p>
			<p>We can also<a id="_idIndexMarker375"/> use a <strong class="source-inline">-Regex</strong> parameter to evaluate against a regular expression. This <a id="_idIndexMarker376"/>can’t be used with the <strong class="source-inline">-Wildcard</strong> or <strong class="source-inline">-Exact</strong> parameter. The <strong class="source-inline">-Exact</strong> parameter is the opposite of <strong class="source-inline">-Wildcard</strong> and is <span class="No-Break">the default.</span></p>
			<h1 id="_idParaDest-103"><a id="_idTextAnchor105"/>Loops – foreach, do while, do until, while, for</h1>
			<p>Automation theory tells us that machines are better than people at performing repetitive tasks; they will perform the task any number of times in exactly the same way each time. When we are writing code, we call this iteration or looping. We’re going to look at four examples of looping in PowerShell that are relatively common. We’ll start with the <strong class="source-inline">foreach</strong> loop, before looking at <strong class="source-inline">do while</strong> and its counterpart, <strong class="source-inline">do until</strong>. We’ll then look at the more generalized <strong class="source-inline">while</strong> statement and finish with a look at the <strong class="source-inline">for</strong> statement and see how it differs from <strong class="source-inline">foreach</strong>. Let’s get started by creating a new file, setting it as a PowerShell file, and saving it <span class="No-Break">as </span><span class="No-Break"><strong class="source-inline">loops.ps1</strong></span><span class="No-Break">.</span></p>
			<h2 id="_idParaDest-104"><a id="_idTextAnchor106"/>The foreach loop statement</h2>
			<p>This is the most<a id="_idIndexMarker377"/> common loop statement. We’ve seen <strong class="source-inline">foreach</strong> before, when we looked at the <strong class="source-inline">Foreach-Object</strong> cmdlet in <a href="B17600_03.xhtml#_idTextAnchor049"><span class="No-Break"><em class="italic">Chapter 3</em></span></a>, <em class="italic">The PowerShell Pipeline – How to String Cmdlets Together</em>. They’re similar in function, but not the same, and have very different syntax. <strong class="source-inline">foreach</strong> loops have the <span class="No-Break">following syntax:</span></p>
			<pre class="source-code">
foreach ( $element in &lt;expression&gt; ) {&lt;scriptblock&gt;}</pre>			<p>If <strong class="source-inline">foreach</strong> is at the start of a statement, then PowerShell will treat it as the <strong class="source-inline">foreach</strong> loop statement, not an alias for <strong class="source-inline">ForEach-Object</strong>. We can see this happening in the <span class="No-Break">following screenshot:</span></p>
			<div>
				<div id="_idContainer104" class="IMG---Figure">
					<img src="image/B17600_05_13.jpg" alt="Figure 5.13 – The foreach statement and foreach as an alias for ForEach-Object"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.13 – The foreach statement and foreach as an alias for ForEach-Object</p>
			<p>In line 1, <strong class="source-inline">foreach</strong> is at the start of the line, or statement, and in line 2 it comes after a pipeline character. <strong class="source-inline">PSScriptAnalyzer</strong>, part of the PowerShell extension for VS Code, has recognized <strong class="source-inline">foreach</strong> as an alias of <strong class="source-inline">ForEach-Object</strong> in line 2 and given it a wavy yellow underline to denote poor practice, but not in line 1. If we hover the mouse over <strong class="source-inline">foreach</strong> in line 2, we can see that it is moaning because we have used an alias, and it’s right. What else is going on in <span class="No-Break">that image?</span></p>
			<p>In line 1, we’ve <a id="_idIndexMarker378"/>got a <strong class="source-inline">foreach</strong> statement – it consists of the <strong class="source-inline">foreach</strong> keyword, a grouped expression in brackets, and a scriptblock in curly braces. The grouped expression takes the format <strong class="source-inline">($element</strong> <strong class="source-inline">in [expression])</strong> and produces a collection of objects. Once the collection is complete, the scriptblock operates on each object in turn. In this case, we are collecting all the objects in the current directory that end in <strong class="source-inline">.ps1</strong>. We then perform an operation on them – we get their length (<strong class="source-inline">$f.length</strong>) and add it to the <strong class="source-inline">$l</strong> variable using the compound operator, <strong class="source-inline">+=</strong>. It doesn’t matter what variable we use to denote the elements in the collection so long as it isn’t an automatic variable or a variable we are <span class="No-Break">using elsewhere.</span></p>
			<p>In the second line, we are using the <strong class="source-inline">ForEach-Object</strong> cmdlet to do exactly the same thing. What’s <span class="No-Break">the difference?</span></p>
			<p>When we use the <strong class="source-inline">foreach</strong> keyword to create a loop, the expression is run to produce an array, which is held in memory. Each element is then run into the scriptblock one at a time. If your expression creates a very large array then you may experience <span class="No-Break">memory issues.</span></p>
			<p>When we use the <strong class="source-inline">ForEach-Object</strong> cmdlet as part of a pipeline, each element in the array created by <strong class="source-inline">Get-ChildItem *.ps1</strong> passes through the entire pipeline one at a time; this means it uses a lot less memory, as the whole array doesn’t exist in memory, just single elements. The downside is it may well take longer <span class="No-Break">to process.</span></p>
			<p>Let’s try a <strong class="source-inline">foreach</strong> loop for ourselves. Type <span class="No-Break">the following:</span></p>
			<pre class="source-code">
$l = 0 ; foreach ($f in Get-ChildItem *.ps1) {$l += $f.length} ; $l</pre>			<p>That’s not quite the same as the line in <span class="No-Break"><em class="italic">Figure 5</em></span><em class="italic">.13</em>. We’re using a semicolon (<strong class="source-inline">;</strong>) as a statement separator; this allows us to put multiple statements on one line instead of splitting it over multiple lines. This is easier to type but not easier to read. Let’s go through <span class="No-Break">the command;</span></p>
			<ul>
				<li>Our first<a id="_idIndexMarker379"/> statement is <strong class="source-inline">$l = 0 ;</strong>. This creates the <strong class="source-inline">$l</strong> variable and sets it to <strong class="source-inline">0</strong>. This means each time we run the whole line, it will reset <strong class="source-inline">$l</strong> <span class="No-Break">to </span><span class="No-Break"><strong class="source-inline">0</strong></span><span class="No-Break">.</span></li>
				<li>The second statement is <strong class="source-inline">Foreach ($i in Get-ChildItem *.ps1) {$l += $i.length} ;</strong>. This is where we create our array and loop through each element <span class="No-Break">of it.</span></li>
				<li>Our final statement is just <strong class="source-inline">$l</strong> – this returns the value of <strong class="source-inline">$l</strong> at the end of <span class="No-Break">the loop.</span></li>
			</ul>
			<p>We can see how this looks in the <span class="No-Break">following screenshot:</span></p>
			<div>
				<div id="_idContainer105" class="IMG---Figure">
					<img src="image/B17600_05_14.jpg" alt="Figure 5.14 – The foreach loop and statement separator"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.14 – The foreach loop and statement separator</p>
			<p>We’ll be using <strong class="source-inline">foreach</strong> loops quite a lot, as they are the most common type of loop. Let’s move on <a id="_idIndexMarker380"/>to the next types, <strong class="source-inline">do while</strong> and <span class="No-Break"><strong class="source-inline">do until</strong></span><span class="No-Break">.</span></p>
			<h2 id="_idParaDest-105"><a id="_idTextAnchor107"/>The do while and do until loop statements</h2>
			<p>The <strong class="source-inline">do while</strong> and <strong class="source-inline">do until</strong> loops <a id="_idIndexMarker381"/>share<a id="_idIndexMarker382"/> the same syntax, which puts the <span class="No-Break">scriptblock first:</span></p>
			<pre class="source-code">
do {&lt;scriptblock&gt;} until/while (&lt;condition&gt; is true)</pre>			<p>Because the condition is last, they will always execute the scriptblock at <span class="No-Break">least once.</span></p>
			<p>Try this. Type <span class="No-Break">the following:</span></p>
			<pre class="source-code">
$number = 0
do { $number ++
Write-Output "The number is $number"
} while ($number -ne 5)</pre>			<p>Let’s take a closer look at what we’ve <span class="No-Break">just done:</span></p>
			<ul>
				<li>In the first line, we’re creating a <strong class="source-inline">$number</strong> variable and setting it <span class="No-Break">to </span><span class="No-Break"><strong class="source-inline">0</strong></span><span class="No-Break">.</span></li>
				<li>In the second line, we are starting a <strong class="source-inline">do while</strong> loop with the <strong class="source-inline">do</strong> keyword, opening a scriptblock with a curly brace, <strong class="source-inline">{</strong>, and incrementing by 1 the <strong class="source-inline">$number</strong> variable using the <strong class="source-inline">++</strong> <span class="No-Break">increment operator.</span></li>
				<li>In the third line, we’re performing another operation, writing output to <span class="No-Break">the screen.</span></li>
				<li>In the final line, we are closing the scriptblock with a curly brace, <strong class="source-inline">}</strong>, then using the <strong class="source-inline">while</strong> keyword to supply the condition, in brackets. In this case, it is while <strong class="source-inline">$number</strong> is not equal <span class="No-Break">to </span><span class="No-Break"><strong class="source-inline">5</strong></span><span class="No-Break">.</span></li>
			</ul>
			<p>What is your last line of output? For me, it is <strong class="source-inline">The number is 5</strong>. This is because the scriptblock is run before the condition is evaluated. <span class="No-Break">Try this:</span></p>
			<pre class="source-code">
$number = 0
Do {Write-Host "The number is not Zero"}
While ($number -ne 0)</pre>			<p>As we can see in the following screenshot, the scriptblock has been executed even though the condition <span class="No-Break">is false.</span></p>
			<div>
				<div id="_idContainer106" class="IMG---Figure">
					<img src="image/B17600_05_15.jpg" alt="Figure 5.15 – The computer is lying to you"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.15 – The computer is lying to you</p>
			<p>The <strong class="source-inline">do until</strong> loop<a id="_idIndexMarker383"/> works the same way, but until the condition <a id="_idIndexMarker384"/><span class="No-Break">is true:</span></p>
			<pre class="source-code">
$number = 0
do { $number ++
Write-Host "The number is $number"
} until ($number -eq 5)</pre>			<p>Let’s see how those loops look next to <span class="No-Break">each other:</span></p>
			<div>
				<div id="_idContainer107" class="IMG---Figure">
					<img src="image/B17600_05_16.jpg" alt="Figure 5.16 – do while and do until"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.16 – do while and do until</p>
			<p>Generally, we use <strong class="source-inline">do until</strong> loops when the test condition is expected to be positive and <strong class="source-inline">do while</strong> loops when the test condition is expected to be negative. It is not <strong class="source-inline">while</strong> or <strong class="source-inline">until</strong> that determines true or false, but the condition associated with it. You can just as easily have “not equals” (negative) with <strong class="source-inline">until</strong> and “equals” (positive) with <strong class="source-inline">while</strong>. Remember, though, that<a id="_idIndexMarker385"/> the scriptblock will execute the first time <a id="_idIndexMarker386"/>the condition is not met. What can we do <span class="No-Break">about that?</span></p>
			<h2 id="_idParaDest-106"><a id="_idTextAnchor108"/>The while loop</h2>
			<p>The <strong class="source-inline">while</strong> loop turns<a id="_idIndexMarker387"/> the <strong class="source-inline">do while</strong> loop back to front and puts the condition before <span class="No-Break">the scriptblock:</span></p>
			<pre class="source-code">
while (&lt;condition&gt; is true) {&lt;scriptblock&gt;}</pre>			<p>This means if the condition is not true, then the scriptblock never executes. There is no <span class="No-Break"><strong class="source-inline">until</strong></span><span class="No-Break"> statement.</span></p>
			<p>Try it. <span class="No-Break">Type this:</span></p>
			<pre class="source-code">
$number = 0
while ( $number -ne 5) { $number ++
Write-Host "The number is $number"}</pre>			<p class="callout-heading">Activity 2</p>
			<p class="callout">This produces the same output as our <strong class="source-inline">do while</strong> example. Why? How would you prove that the scriptblock doesn’t execute when the condition <span class="No-Break">is true?</span></p>
			<p>Let’s look at our<a id="_idIndexMarker388"/> final loop next, the <span class="No-Break"><strong class="source-inline">for</strong></span><span class="No-Break"> loop.</span></p>
			<h2 id="_idParaDest-107"><a id="_idTextAnchor109"/>The for loop</h2>
			<p>Despite its <a id="_idIndexMarker389"/>name, the <strong class="source-inline">for</strong> loop is more like a <strong class="source-inline">while</strong> loop than a <strong class="source-inline">foreach</strong> loop. It’s a counting loop that depends on a condition being true, like <strong class="source-inline">while</strong>, but it is much more flexible. The syntax is more complicated <span class="No-Break">as well:</span></p>
			<pre class="source-code">
for (&lt;Iterator&gt; ; &lt;condition&gt; ; &lt;iteration&gt;) { &lt;scriptblock&gt; }</pre>			<p>The iterator is the variable we’re going to iterate, similar to the <strong class="source-inline">$number</strong> variable we used previously when we looked at the <strong class="source-inline">while</strong> loop. The condition is the same as the <strong class="source-inline">while</strong> loop condition, and the iteration is the action we perform on the iterator each time we go round the loop. <span class="No-Break">Try this:</span></p>
			<pre class="source-code">
for ($i = 0 ; $i -lt 5 ; $i ++) {Write-Host $i}</pre>			<p>That’s not hugely exciting; it just looks like a complicated way to do exactly the same as the <strong class="source-inline">while</strong> loop previously. However, the <strong class="source-inline">for</strong> loop allows us to index the element of the loop and move around based on that index. <span class="No-Break">Try this:</span></p>
			<pre class="source-code">
$fruits = @('banana', 'apple', 'pear', 'plum')
for ($i = 1 ; $i -lt ($fruits.length) ; $i ++) {
    Write-Host $fruits[$i] "is after"  $fruits[$i-1]
}</pre>			<p>You should see the output shown in the <span class="No-Break">following screenshot:</span></p>
			<div>
				<div id="_idContainer108" class="IMG---Figure">
					<img src="image/B17600_05_17.jpg" alt="Figure 5.17 – Ordering fruit around with a for loop"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.17 – Ordering fruit around with a for loop</p>
			<p>Here’s another thing<a id="_idIndexMarker390"/> we can do with a <strong class="source-inline">for</strong> loop that makes it special. We can change the contents of our array. <span class="No-Break">Try this:</span></p>
			<pre class="source-code">
$fruits = @('banana', 'apple', 'pear', 'plum')
foreach ($fruit in $fruits) {$fruit = "tasty $fruit"}
Write-Host $fruits</pre>			<p>Well, that didn’t work. We might have hoped that by changing <strong class="source-inline">$fruit</strong> it would affect the original array, but it doesn’t, because the <strong class="source-inline">foreach</strong> loop operates on copies of the elements in the array. We can use the <strong class="source-inline">for</strong> loop to do <span class="No-Break">it though:</span></p>
			<pre class="source-code">
$fruits = @('banana', 'apple', 'pear', 'plum')
for ($i = 0 ; $i -lt ($fruits.length) ; $i ++) {
    $fruits[$i] = "tasty $($fruits[$i])"
}
Write-Host $fruits</pre>			<p>And we should see the output <span class="No-Break">as follows:</span></p>
			<div>
				<div id="_idContainer109" class="IMG---Figure">
					<img src="image/B17600_05_18.jpg" alt="Figure 5.18 – Using a for loop to make fruit tasty"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.18 – Using a for loop to make fruit tasty</p>
			<p>We’re doing something new in line 50, there. We’re using <strong class="source-inline">$()</strong>, the sub-expression symbol, to make<a id="_idIndexMarker391"/> sure PowerShell correctly interprets what we mean. While we can expand simple variables inside double quotes, more complex expressions need a little more. Without wrapping <strong class="source-inline">$fruits[$i]</strong> in a pair of brackets preceded by a dollar sign, PowerShell won’t correctly <span class="No-Break">unpack it.</span></p>
			<p>We’re nearly done with loops. We’ve looked at the <strong class="source-inline">foreach</strong> loop, which performs an operation for each element in an array. We’ve looked at <strong class="source-inline">do while</strong> and <strong class="source-inline">while</strong>, which repeat an operation while a condition is true. Then we looked at <strong class="source-inline">do until</strong>, which performs an operation until a condition becomes true. Finally, we looked at the more complicated <strong class="source-inline">for</strong> loop, which repeats an operation a predetermined number of times. What we need next is a way of controlling our loops. What happens if the condition in a <strong class="source-inline">while</strong> loop never becomes false? Let’s look at loop control with <strong class="source-inline">break</strong> <span class="No-Break">and </span><span class="No-Break"><strong class="source-inline">continue</strong></span><span class="No-Break">.</span></p>
			<h1 id="_idParaDest-108"><a id="_idTextAnchor110"/>Breaking and continuing</h1>
			<p>The <strong class="source-inline">break</strong> and <strong class="source-inline">continue</strong> statements are related and allow us to control how our loops behave. We can also use them in <strong class="source-inline">switch</strong> statements. It’s important not to use them outside of loops or <strong class="source-inline">switch</strong> statements as they can lead to unpredictable behavior. A <strong class="source-inline">break</strong> statement can be used to stop a loop iterating altogether, while <strong class="source-inline">continue</strong> can be used to stop an iteration and move on to the next one. Let’s look at <span class="No-Break"><strong class="source-inline">break</strong></span><span class="No-Break"> first.</span></p>
			<h2 id="_idParaDest-109"><a id="_idTextAnchor111"/>The break statement</h2>
			<p>Let’s play <a id="_idIndexMarker392"/>with the trusty <strong class="source-inline">while</strong> loop. <span class="No-Break">Type this:</span></p>
			<pre class="source-code">
$number = 0
while ( $number -ne 5) { $number ++
if ($number -eq 3) {
    break
    }
    Write-Host "The number is $number"
}</pre>			<p>Hopefully, you’ll see that the last number printed is <strong class="source-inline">2</strong>. The conditional <strong class="source-inline">if</strong> statement says to stop looping if <strong class="source-inline">$number</strong> is <strong class="source-inline">3</strong>. The <strong class="source-inline">break</strong> statement only acts on the loop it is <span class="No-Break">nested inside.</span></p>
			<h2 id="_idParaDest-110"><a id="_idTextAnchor112"/>The continue statement</h2>
			<p>The <strong class="source-inline">continue</strong> statement<a id="_idIndexMarker393"/> stops the current iteration of the loop, not the whole loop, and moves on to the next iteration. <span class="No-Break">Try this:</span></p>
			<pre class="source-code">
$number = 0
while ( $number -ne 5) { $number ++
if ($number -eq 3) {
    continue
    }
    Write-Host "The number is $number"
}</pre>			<p>This time, the loop prints out the numbers <strong class="source-inline">1</strong> to <strong class="source-inline">5</strong>, but omits <strong class="source-inline">3</strong>. It breaks out of the current iteration before it reaches the <strong class="source-inline">Write-Host</strong> statement, and starts the next one. You should see <a id="_idIndexMarker394"/>the result in the <span class="No-Break">following screenshot:</span></p>
			<div>
				<div id="_idContainer110" class="IMG---Figure">
					<img src="image/B17600_05_19.jpg" alt="Figure 5.19 – Using continue"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.19 – Using continue</p>
			<p>We can also use <strong class="source-inline">break</strong> and <strong class="source-inline">continue</strong> in <strong class="source-inline">switch</strong> statements, <span class="No-Break">like this:</span></p>
			<pre class="source-code">
$String = "Powershell 7", "python"
switch -Wildcard -CaseSensitive ($String) {
    {$_} {Write-output "processing $_ :"}
    '*7' { Write-Output 'contains 7'}
    "Pow*" { Write-Output 'contains Pow'}
    'pow*' {Write-Output 'contains pow'}
    '*she*' { Write-Output 'contains she'; continue}
    {$String.Length -gt 7} { Write-Output "long string"}
    {$String.Length -lt 7} {Write-Output "No powershell here"}
}</pre>			<p>This is similar to the <strong class="source-inline">switch</strong> block we used earlier in the chapter, in the <em class="italic">The switch statement</em> section. The difference is we are now passing an array of strings, not a single one. The <strong class="source-inline">continue</strong> statement in line 7 means that the <strong class="source-inline">long string</strong> and <strong class="source-inline">No powershell here</strong> outputs are never executed; instead, the <strong class="source-inline">switch</strong> statement moves on to the next element in the array, <strong class="source-inline">python</strong>. Now replace <strong class="source-inline">continue</strong> with <strong class="source-inline">break</strong>. We can see <a id="_idIndexMarker395"/>that the entire <strong class="source-inline">switch</strong> statement stops – <strong class="source-inline">python</strong> is <span class="No-Break">never processed.</span></p>
			<p>That’s enough for now on loops. We’ll be using them a lot in the rest of the book. Let’s have some fun <span class="No-Break">now, instead.</span></p>
			<h1 id="_idParaDest-111"><a id="_idTextAnchor113"/>Let’s play a game</h1>
			<p>We’re all familiar with<a id="_idIndexMarker396"/> number-guessing games. Let’s use what we’ve learned in this chapter to write a game in PowerShell. This is a common challenge set in many programming tutorials, so we’re not going to be any different. In the UK, it is sometimes called the Brucie Game because of its similarity to the popular UK TV gameshow Bruce Forsyth’s Play Your Cards Right. The Brucie bonus here is that we get to <span class="No-Break">learn something.</span></p>
			<p>The program generates a random integer between 1 and 100. We then need to get user input in the form of another integer. We compare the guess with the hidden number and decide whether it’s right. If it is, we go to the end of the program. If it isn’t, then we need to decide whether it is too high or too low and output an appropriate message before going back and asking for another guess. We can represent this as a flow chart, which will be helpful when it comes to writing <span class="No-Break">our code:</span></p>
			<div>
				<div id="_idContainer111" class="IMG---Figure">
					<img src="image/B17600_05_20.jpg" alt="Figure 5.20 – Flow chart for the Brucie game"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.20 – Flow chart for the Brucie game</p>
			<p>The first thing we<a id="_idIndexMarker397"/> need to do is open a new file; mine is called <strong class="source-inline">Brucie.ps1</strong>. Let’s go <span class="No-Break">to work.</span></p>
			<p>The first box calls for a random integer between 1 and 100. <span class="No-Break">That’s easy:</span></p>
			<pre class="source-code">
[int]$Hidden = Get-Random -Minimum 1 -Maximum 101</pre>			<p>Now we need to tell the player what to do, and get an input <span class="No-Break">from them:</span></p>
			<pre class="source-code">
Write-Host "Let's play the Brucie Game! Guess the hidden number between 1 and 100. give me a number below"
$guess = [int] (Read-Host)</pre>			<p>Now we have our two numbers in variables called <strong class="source-inline">$Hidden</strong> and <strong class="source-inline">$guess</strong>. We need to compare them. The best way to do this is to use an <strong class="source-inline">if</strong>-<strong class="source-inline">else</strong> statement. If the number is wrong, we do one thing, else we print <span class="No-Break"><strong class="source-inline">You Win!</strong></span><span class="No-Break">:</span></p>
			<pre class="source-code">
[int]$Hidden = Get-Random -Minimum 1 -Maximum 101
Write-Host "Let's play the Brucie Game! Guess the hidden number between 1 and 100. give me a number below"
$guess = [int] (Read-Host)
if ($guess -ne $hidden) {
    &lt;# Action to perform if the condition is true #&gt;
} else {Write-Host "You Win"}</pre>			<p>What action do we <a id="_idIndexMarker398"/>need to perform? We need to see whether it is higher or lower. We’ll need another <span class="No-Break"><strong class="source-inline">if</strong></span><span class="No-Break">-</span><span class="No-Break"><strong class="source-inline">else</strong></span><span class="No-Break"> there:</span></p>
			<pre class="source-code">
if ($guess -ne $hidden) {
    &lt;# Action to perform if the condition is true #&gt;
<strong class="bold">    if ($guess -lt $hidden) {</strong>
<strong class="bold">        Write-Host "Higher!"</strong>
<strong class="bold">    } else { Write-Host "Lower!"}</strong>
} else {Write-Host "You Win!"}</pre>			<p>And that is that. Wait, no it isn’t. We need to give them multiple guesses. We need a loop. We could use all sorts of loops here, but probably the easiest is a <strong class="source-inline">while</strong> loop. Have a think about how you might do it before moving on and seeing how I <span class="No-Break">did it.</span></p>
			<p>Don’t <span class="No-Break">peek. Think.</span></p>
			<p>OK. Here’s <span class="No-Break">my solution:</span></p>
			<pre class="source-code">
[int]$Hidden = Get-Random -Minimum 1 -Maximum 101
Write-Host "Let's play the Brucie Game! Guess the hidden number between 1 and 100.
give me a number below"
$guess = 0
while ($guess -ne $hidden) {
    $guess = [int] (Read-Host)
    if ($guess -lt $hidden) {
        Write-Host "Higher!"
    } elseif ( $guess -gt $hidden) { Write-Host "Lower!"}
}
Write-Host "You Win"</pre>			<p>Here’s the<a id="_idIndexMarker399"/> whole <span class="No-Break">thing working:</span></p>
			<div>
				<div id="_idContainer112" class="IMG---Figure">
					<img src="image/B17600_05_21.jpg" alt="Figure 5.21 – The Brucie game"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.21 – The Brucie game</p>
			<p>On line 4, I’ve<a id="_idIndexMarker400"/> initialized <strong class="source-inline">$guess</strong> as <strong class="source-inline">0</strong> so that the loop has something to <span class="No-Break">work with.</span></p>
			<p>On line 5, I’ve changed my first <strong class="source-inline">if</strong> statement to a <strong class="source-inline">while</strong> statement. I’ve also closed the loop with a curly brace and made <strong class="source-inline">Write-Host "You Win"</strong> the final statement of <span class="No-Break">the program.</span></p>
			<p>On line 6, I’ve brought my input-gathering statement inside the loop. Try leaving it outside. That gets old quickly because we’re never changing the value of <strong class="source-inline">$guess</strong> <span class="No-Break">from 0.</span></p>
			<p>The only other change I made was on line 9, where I replaced <strong class="source-inline">else</strong> with an <strong class="source-inline">elseif</strong> statement, otherwise the loop prints <strong class="source-inline">Lower!</strong> even when <span class="No-Break">we’re right.</span></p>
			<p>And that’s it. Make<a id="_idIndexMarker401"/> sure you save a working copy of the game so we can work with it later. We’ve covered a lot of ground in this chapter; <span class="No-Break">let’s summarize.</span></p>
			<h1 id="_idParaDest-112"><a id="_idTextAnchor114"/>Summary</h1>
			<p>We started the chapter by looking at IDEs and installing the recommended environment for PowerShell 7, VS Code. VS Code is a large and ever-changing application. We need to spend time familiarizing ourselves with it and keep regularly updated as the features and capabilities change frequently. We have seen that it is easy to use and <span class="No-Break">very powerful.</span></p>
			<p>We then looked at the two main ways of controlling flow within a program: conditionals and loops. We spent a lot of time on the <strong class="source-inline">if</strong>, <strong class="source-inline">else</strong>, and <strong class="source-inline">elseif</strong> conditional statements and then looked at the related <span class="No-Break"><strong class="source-inline">switch</strong></span><span class="No-Break"> statement.</span></p>
			<p>After that, we looked at loops. We started with a loop that will iterate through all the elements in an array – the <strong class="source-inline">foreach</strong> loop – and explored how it differs from the <strong class="source-inline">ForEach-Object</strong> cmdlet. We looked at <strong class="source-inline">do while</strong> and <strong class="source-inline">do until</strong>, which will repeat a loop while a condition is true or false, and then we looked at the <strong class="source-inline">while</strong> loop, which swaps the position of the condition and the scriptblock. The last loop we looked at in this section was a counting loop – <span class="No-Break"><strong class="source-inline">for</strong></span><span class="No-Break">.</span></p>
			<p>Finally, we finished this chapter by writing a short number-guessing game in PowerShell, the Brucie game. I hope you enjoyed doing this, as this sort of exercise will really cement how to write code <span class="No-Break">in PowerShell.</span></p>
			<p>In the next chapter, we’re going to be looking at how PowerShell can be used to interact with files. We’re going to be reading content, writing content, and generally <span class="No-Break">playing around.</span></p>
			<h1 id="_idParaDest-113"><a id="_idTextAnchor115"/>Exercises</h1>
			<ol>
				<li>What output will <strong class="source-inline">$x = 4 ; IF ($x -gt 4) {Write-Host '$x is larger than </strong><span class="No-Break"><strong class="source-inline">4'}</strong></span><span class="No-Break"> produce?</span></li>
				<li>Write a statement that will produce an output for the line <strong class="source-inline">$x = 4 ; IF ($x -gt 4) {Write-Host '$x is larger than 4'}</strong> when <strong class="source-inline">$x</strong> is not larger <span class="No-Break">than 4.</span></li>
				<li>Write a statement that will produce output from <strong class="source-inline">$x = 4 ; IF ($x -gt 4) {Write-Host '$x is larger than 4'}</strong> when <strong class="source-inline">$x</strong> is <span class="No-Break">exactly 4.</span></li>
				<li>Write a statement that will produce an output for the line <strong class="source-inline">$x = 4 ; IF ($x -gt 4) {Write-Host '$x is larger than 4'}</strong> when <strong class="source-inline">$x</strong> is not larger than 4, as in question 2, but this time use the <span class="No-Break"><strong class="source-inline">ternary</strong></span><span class="No-Break"> operator.</span></li>
				<li>What is going <span class="No-Break">wrong here?</span><pre class="source-code">
$processes = Get-process | foreach ($process in $processes) {$process.name}</pre></li>				<li>Rewrite <strong class="source-inline">$number = 0 ; Do {$number ++ ; Write-Host "Number is $number"} While ($number -eq 5)</strong> so that it works, but without using a d<strong class="source-inline">o </strong><span class="No-Break"><strong class="source-inline">until</strong></span><span class="No-Break"> loop.</span></li>
				<li>Make this statement work: <strong class="source-inline">For ($i = 0 ; $i -lt 5 ) {</strong><span class="No-Break"><strong class="source-inline">Write-Host $i}</strong></span><span class="No-Break">.</span></li>
				<li>We should only use <strong class="source-inline">break</strong> and <strong class="source-inline">continue</strong> statements in loops and one other <span class="No-Break">place. Where?</span></li>
				<li>How would you make it so the Brucie game limits the number of guesses a user <span class="No-Break">could make?</span></li>
			</ol>
			<h1 id="_idParaDest-114"><a id="_idTextAnchor116"/>Further reading</h1>
			<p>This was a big chapter, so there is plenty of further <span class="No-Break">reading here:</span></p>
			<ul>
				<li>Developing PowerShell with VS <span class="No-Break">Code: </span><a href="https://docs.microsoft.com/en-us/powershell/scripting/dev-cross-plat/vscode/using-vscode"><span class="No-Break">https://docs.microsoft.com/en-us/powershell/scripting/dev-cross-plat/vscode/using-vscode</span></a></li>
				<li>About <span class="No-Break"><strong class="source-inline">if</strong></span><span class="No-Break">: </span><a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_if"><span class="No-Break">https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_if</span></a></li>
				<li>About <span class="No-Break"><strong class="source-inline">switch</strong></span><span class="No-Break">: </span><a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_switch"><span class="No-Break">https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_switch</span></a></li>
				<li>About <span class="No-Break"><strong class="source-inline">foreach</strong></span><span class="No-Break">: </span><a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_foreach"><span class="No-Break">https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_foreach</span></a></li>
				<li>About <span class="No-Break"><strong class="source-inline">do</strong></span><span class="No-Break">: </span><a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_do"><span class="No-Break">https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_do</span></a></li>
				<li>About <span class="No-Break"><strong class="source-inline">while</strong></span><span class="No-Break">: </span><a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_while"><span class="No-Break">https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_while</span></a></li>
				<li>About <span class="No-Break"><strong class="source-inline">for</strong></span><span class="No-Break">: </span><a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_for"><span class="No-Break">https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_for</span></a></li>
				<li>About <span class="No-Break"><strong class="source-inline">break</strong></span><span class="No-Break">: </span><a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_break"><span class="No-Break">https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_break</span></a></li>
				<li>About <span class="No-Break"><strong class="source-inline">continue</strong></span><span class="No-Break">: </span><a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_continue"><span class="No-Break">https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_continue</span></a></li>
			</ul>
		</div>
	</body></html>