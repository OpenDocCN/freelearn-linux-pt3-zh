<html><head></head><body>
<div class="_idGenObjectStyleOverride-1" id="_idContainer368">
<p class="Chapter-Title" id="_idParaDest-264" lang="en-US" xml:lang="en-US"><span class="ChapterMarker"><span class="koboSpan" id="kobo.1.1">30. </span></span><a id="_idTextAnchor448"/><span class="koboSpan" id="kobo.2.1">Working with Containers on Ubuntu</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.3.1">Now that the basics of Linux Containers have been covered in the previous chapter, this chapter will demonstrate how to create and manage containers using the Podman, Skopeo, and Buildah tools on Ubuntu. </span><span class="koboSpan" id="kobo.3.2">It is intended that by the end of this chapter, you will have a clearer understanding of how to create and manage containers on Ubuntu and will have gained a knowledge foundation on which to continue exploring the power of Linux Containers.</span></p>
<p class="Heading-1-1" id="_idParaDest-265" lang="en-US" xml:lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.4.1">30.1 </span></span><a id="_idTextAnchor449"/><span class="koboSpan" id="kobo.5.1">Installing the Container Tools</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.6.1">Before starting with containers, the first step is to install all of the container tools outlined in the previous chapter using the following commands:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.7.1"># apt install curl</span></p>
<p class="Code"><span class="koboSpan" id="kobo.8.1"># . </span><span class="koboSpan" id="kobo.8.2">/etc/os-release</span></p>
<p class="Code"><span class="koboSpan" id="kobo.9.1"># sh -c "echo 'deb https://download.opensuse.org/repositories/devel:/kubic:/libcontainers:/stable/xUbuntu_${VERSION_ID}/ /' &gt; /etc/apt/sources.list.d/devel:kubic:libcontainers:stable.list"</span></p>
<p class="Code"><span class="koboSpan" id="kobo.10.1"># curl -L https://download.opensuse.org/repositories/devel:/kubic:/libcontainers:/stable/xUbuntu_${VERSION_ID}/Release.key | sudo apt-key add -</span></p>
<p class="Code"><span class="koboSpan" id="kobo.11.1"># apt update</span></p>
<p class="Code"><span class="koboSpan" id="kobo.12.1"># apt install podman skopeo buildah</span></p>
<p class="Heading-1-1" id="_idParaDest-266" lang="en-US" xml:lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.13.1">30.2 </span></span><a id="_idTextAnchor450"/><a id="_idTextAnchor452"/><span class="koboSpan" id="kobo.14.1">Pulling a </span><a id="_idIndexMarker670"/><a id="_idIndexMarker671"/><span class="koboSpan" id="kobo.15.1">Container Image</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.16.1">For this example, the most recent Ubuntu release will be pulled from the registry. </span><span class="koboSpan" id="kobo.16.2">Before pulling an image, however, information about the image repository can be obtained using the </span><a id="_idIndexMarker672"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.17.1">skopeo</span></span><span class="koboSpan" id="kobo.18.1"> tool, for example:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.19.1">$ skopeo inspect docker://docker.io/ubuntu</span></p>
<p class="Code"><span class="koboSpan" id="kobo.20.1">{</span></p>
<p class="Code"><span class="koboSpan" id="kobo.21.1">    "Name": "docker.io/library/ubuntu",</span></p>
<p class="Code"><span class="koboSpan" id="kobo.22.1">    "Digest": "sha256:bec5a2727be7fff3d308193cfde3491f8fba1a2ba392b7546b43a051853a341d",</span></p>
<p class="Code"><span class="koboSpan" id="kobo.23.1">    "RepoTags": [</span></p>
<p class="Code"><span class="koboSpan" id="kobo.24.1">        "10.04",</span></p>
<p class="Code"><span class="koboSpan" id="kobo.25.1">        "12.04.5",</span></p>
<p class="Code"><span class="koboSpan" id="kobo.26.1">        "12.04",</span></p>
<p class="Code"><span class="koboSpan" id="kobo.27.1">        "12.10",</span></p>
<p class="Code"><span class="koboSpan" id="kobo.28.1">        "13.04",</span></p>
<p class="Code"><span class="koboSpan" id="kobo.29.1">        "13.10",</span></p>
<p class="Code"><span class="koboSpan" id="kobo.30.1">        "14.04.1",</span></p>
<p class="Code"><span class="koboSpan" id="kobo.31.1">        "14.04.2",</span></p>
<p class="Code"><span class="koboSpan" id="kobo.32.1">        "14.04.3",</span></p>
<p class="Code"><span class="koboSpan" id="kobo.33.1">        "14.04.4",</span></p>
<p class="Code"><span class="koboSpan" id="kobo.34.1">        "14.04.5",</span></p>
<p class="Code"><span class="koboSpan" id="kobo.35.1">        "14.04",</span></p>
<p class="Code"><span class="koboSpan" id="kobo.36.1">        "14.10",</span></p>
<p class="Code"><span class="koboSpan" id="kobo.37.1">        "15.04",</span></p>
<p class="Code"><span class="koboSpan" id="kobo.38.1">.</span></p>
<p class="Code"><span class="koboSpan" id="kobo.39.1">.</span></p>
<p class="Code"><span class="koboSpan" id="kobo.40.1">    ],</span></p>
<p class="Code"><span class="koboSpan" id="kobo.41.1">    "Created": "2023-06-28T08:42:50.42500211Z",</span></p>
<p class="Code"><span class="koboSpan" id="kobo.42.1">    "DockerVersion": "20.10.21",</span></p>
<p class="Code"><span class="koboSpan" id="kobo.43.1">    "Labels": {</span></p>
<p class="Code"><span class="koboSpan" id="kobo.44.1">        "org.opencontainers.image.ref.name": "ubuntu",</span></p>
<p class="Code"><span class="koboSpan" id="kobo.45.1">        "org.opencontainers.image.version": "22.04"</span></p>
<p class="Code"><span class="koboSpan" id="kobo.46.1">    },</span></p>
<p class="Code"><span class="koboSpan" id="kobo.47.1">    "Architecture": "arm64",</span></p>
<p class="Code"><span class="koboSpan" id="kobo.48.1">    "Os": "linux",</span></p>
<p class="Code"><span class="koboSpan" id="kobo.49.1">    "Layers": [</span></p>
<p class="Code"><span class="koboSpan" id="kobo.50.1">        "sha256:5af00eab97847634d0b3b8a5933f52ca8378f5f30a2949279d682de1e210d78b"</span></p>
<p class="Code"><span class="koboSpan" id="kobo.51.1">    ],</span></p>
<p class="Code"><span class="koboSpan" id="kobo.52.1">    "Env": [</span></p>
<p class="Code"><span class="koboSpan" id="kobo.53.1">        "PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"</span></p>
<p class="Code"><span class="koboSpan" id="kobo.54.1">    ]</span></p>
<p class="Code"><span class="koboSpan" id="kobo.55.1">}</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.56.1">For example, to pull the latest Ubuntu image:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.57.1">$ podman pull docker://docker.io/ubuntu:latest</span></p>
<p class="Code"><span class="koboSpan" id="kobo.58.1">Trying to pull docker.io/library/ubuntu:latest...</span></p>
<p class="Code"><span class="koboSpan" id="kobo.59.1">Getting image source signatures</span></p>
<p class="Code"><span class="koboSpan" id="kobo.60.1">Copying blob 5af00eab9784 done  </span></p>
<p class="Code"><span class="koboSpan" id="kobo.61.1">Copying config 37f7489146 done  </span></p>
<p class="Code"><span class="koboSpan" id="kobo.62.1">Writing manifest to image destination</span></p>
<p class="Code"><span class="koboSpan" id="kobo.63.1">Storing signatures</span></p>
<p class="Code"><span class="koboSpan" id="kobo.64.1">37f74891464b2067aacbde60d9e2888e002af047a0d5dfc0b06b701928e0b473</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.65.1">Verify that the image has been stored by asking </span><a id="_idIndexMarker673"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.66.1">podman</span></span><span class="koboSpan" id="kobo.67.1"> to list all local images:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.68.1">$ podman images</span></p>
<p class="Code"><span class="koboSpan" id="kobo.69.1">REPOSITORY                 TAG      IMAGE ID       CREATED       SIZE</span></p>
<p class="Code"><span class="koboSpan" id="kobo.70.1">docker.io/library/ubuntu   latest   4e5021d210f6   3 weeks ago   66.6 MB</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.71.1">Details about a local image may be obtained by running the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.72.1">podman inspect</span></span><span class="koboSpan" id="kobo.73.1"> command:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.74.1">$ podman inspect ubuntu:latest</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><a id="_idTextAnchor453"/><span class="koboSpan" id="kobo.75.1">This command should output the same information as the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.76.1">skopeo</span></span><span class="koboSpan" id="kobo.77.1"> command performed on the remote image earlier in this chapter.</span></p>
<p class="Heading-1-1" id="_idParaDest-267" lang="en-US" xml:lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.78.1">30.3 </span></span><a id="_idTextAnchor454"/><span class="koboSpan" id="kobo.79.1">Running the Image in a </span><a id="_idIndexMarker674"/><span class="koboSpan" id="kobo.80.1">Container</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.81.1">The image pulled from the registry is a fully operational image that is ready to run in a container without modification. </span><span class="koboSpan" id="kobo.81.2">To run the image, use the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.82.1">podman run</span></span><span class="koboSpan" id="kobo.83.1"> command. </span><span class="koboSpan" id="kobo.83.2">In this case, the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.84.1">–rm</span></span><span class="koboSpan" id="kobo.85.1"> option will be specified to indicate that we want to run the image in a container, execute one command and then have the container exit. </span><span class="koboSpan" id="kobo.85.2">In this case, the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.86.1">cat</span></span><span class="koboSpan" id="kobo.87.1"> tool will be used to output the content of the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.88.1">/etc/passwd</span></span><span class="koboSpan" id="kobo.89.1"> file located on the container root filesystem:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.90.1">$ podman run --rm ubuntu:latest cat /etc/passwd</span></p>
<p class="Code"><span class="koboSpan" id="kobo.91.1">root:x:0:0:root:/root:/bin/bash</span></p>
<p class="Code"><span class="koboSpan" id="kobo.92.1">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span></p>
<p class="Code"><span class="koboSpan" id="kobo.93.1">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span></p>
<p class="Code"><span class="koboSpan" id="kobo.94.1">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span></p>
<p class="Code"><span class="koboSpan" id="kobo.95.1">sync:x:4:65534:sync:/bin:/bin/sync</span></p>
<p class="Code"><span class="koboSpan" id="kobo.96.1">games:x:5:60:games:/usr/games:/usr/sbin/nologin</span></p>
<p class="Code"><span class="koboSpan" id="kobo.97.1">man:x:6:12:man:/var/cache/man:/usr/sbin/nologin</span></p>
<p class="Code"><span class="koboSpan" id="kobo.98.1">lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin</span></p>
<p class="Code"><span class="koboSpan" id="kobo.99.1">mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</span></p>
<p class="Code"><span class="koboSpan" id="kobo.100.1">news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</span></p>
<p class="Code"><span class="koboSpan" id="kobo.101.1">uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin</span></p>
<p class="Code"><span class="koboSpan" id="kobo.102.1">proxy:x:13:13:proxy:/bin:/usr/sbin/nologin</span></p>
<p class="Code"><span class="koboSpan" id="kobo.103.1">www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</span></p>
<p class="Code"><span class="koboSpan" id="kobo.104.1">backup:x:34:34:backup:/var/backups:/usr/sbin/nologin</span></p>
<p class="Code"><span class="koboSpan" id="kobo.105.1">list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin</span></p>
<p class="Code"><span class="koboSpan" id="kobo.106.1">irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin</span></p>
<p class="Code"><span class="koboSpan" id="kobo.107.1">gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin</span></p>
<p class="Code"><span class="koboSpan" id="kobo.108.1">nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin</span></p>
<p class="Code"><span class="koboSpan" id="kobo.109.1">_apt:x:100:65534::/nonexistent:/usr/sbin/nologin</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.110.1">Compare the content of the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.111.1">/etc/passwd</span></span><span class="koboSpan" id="kobo.112.1"> file within the container with the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.113.1">/etc/passwd</span></span><span class="koboSpan" id="kobo.114.1"> file on the host system and note that it lacks all of the additional users that are present on the host confirming that the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.115.1">cat</span></span><span class="koboSpan" id="kobo.116.1"> command was executed within the container environment. </span><span class="koboSpan" id="kobo.116.2">Also note that the container started, ran the command and exited all within a matter of seconds. </span><span class="koboSpan" id="kobo.116.3">Compare this to the amount of time it takes to start a full operating system, perform a task, and shutdown a virtual machine, and you begin to appreciate the speed and efficiency of containers.</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.117.1">To launch a container, keep it running, and access the shell, the following command can be used:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.118.1">$ podman run --name=mycontainer -it ubuntu:latest /bin/bash</span></p>
<p class="Code"><span class="koboSpan" id="kobo.119.1">root@4b49ddeb2987:/#</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.120.1">In this case, an additional command-line option has been used to assign the name “mycontainer” to the container. </span><span class="koboSpan" id="kobo.120.2">Though optional, this makes the container easier to recognize and reference as an alternative to using the automatically generated container ID.</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.121.1">While the container is running, run </span><a id="_idIndexMarker675"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.122.1">podman</span></span><span class="koboSpan" id="kobo.123.1"> in a different terminal window to see the status of all containers on the system</span></p>
<p class="Code"><span class="koboSpan" id="kobo.124.1">$ podman ps -a</span></p>
<p class="Code"><span class="koboSpan" id="kobo.125.1">CONTAINER ID  IMAGE                            COMMAND    CREATED             STATUS                 PORTS  NAMES</span></p>
<p class="Code"><span class="koboSpan" id="kobo.126.1">4b49ddeb2987  docker.io/library/ubuntu:latest  /bin/bash  About a minute ago  Up About a minute ago         mycontainer</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.127.1">To execute a command in a running container from the host, simply use the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.128.1">podman exec</span></span><span class="koboSpan" id="kobo.129.1"> command, referencing the name of the running container and the command to be executed. </span><span class="koboSpan" id="kobo.129.2">The following command, for example, starts up a second bash session in the container named </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.130.1">mycontainer</span></span><span class="koboSpan" id="kobo.131.1">:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.132.1">$ podman exec -it mycontainer /bin/bash</span></p>
<p class="Code"><span class="koboSpan" id="kobo.133.1">root@4b49ddeb2987:/#</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.134.1">Note that though the above example referenced the container name the same result can be achieved using the container ID as listed by the </span><a id="_idIndexMarker676"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.135.1">podman ps -a</span></span><span class="koboSpan" id="kobo.136.1"> command:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.137.1">$ podman exec -it 4b49ddeb2987 /bin/bash</span></p>
<p class="Code"><span class="koboSpan" id="kobo.138.1">root@4b49ddeb2987:/#</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.139.1">Alternatively, the</span><a id="_idIndexMarker677"/> <span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.140.1">podman attach</span></span><span class="koboSpan" id="kobo.141.1"> command will also attach to a running container and access the shell prompt:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.142.1">$ podman attach mycontainer</span></p>
<p class="Code"><span class="koboSpan" id="kobo.143.1">root@4b49ddeb2987:/#</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.144.1">Once the container is up and running, any additional configuration changes can be made, and packages installed just like any other Ubuntu system.</span></p>
<p class="Heading-1-1" id="_idParaDest-268" lang="en-US" xml:lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.145.1">30.4 </span></span><a id="_idTextAnchor455"/><span class="koboSpan" id="kobo.146.1">Managing a Container</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.147.1">Once launched, a container will continue to run until it is stopped via </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.148.1">podman</span></span><span class="koboSpan" id="kobo.149.1">, or the command that was launched when the container was run exits. </span><span class="koboSpan" id="kobo.149.2">Running the following command on the host, for example, will cause the container to exit:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.150.1">$ podman stop mycontainer</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.151.1">Alternatively, pressing the Ctrl-D keyboard sequence within the last remaining bash shell of the container would cause both the shell and container to exit. </span><span class="koboSpan" id="kobo.151.2">Once it has exited, the status of the container will change accordingly:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.152.1">$ podman ps -a</span></p>
<p class="Code"><span class="koboSpan" id="kobo.153.1">CONTAINER ID  IMAGE                            COMMAND    CREATED        STATUS                           PORTS  NAMES</span></p>
<p class="Code"><span class="koboSpan" id="kobo.154.1">4b49ddeb2987  docker.io/library/ubuntu:latest  /bin/bash  6 minutes ago  Exited (127) About a minute ago         mycontainer</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.155.1">Although the container is no longer running, it still exists and contains all of the changes that were made to the configuration and file system. </span><span class="koboSpan" id="kobo.155.2">If you installed packages, made configuration changes or added files, these changes will persist within “mycontainer”. </span><span class="koboSpan" id="kobo.155.3">To verify this, simply restart the container as follows:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.156.1">$ </span><a id="_idIndexMarker679"/><span class="koboSpan" id="kobo.157.1">podman start mycontainer</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.158.1">After starting the container, use the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.159.1">podman exec</span></span><span class="koboSpan" id="kobo.160.1"> command once again to execute commands within the container as outlined previously. </span><span class="koboSpan" id="kobo.160.2">For example, to once again gain access to a shell prompt:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.161.1">$ podman exec -it mycontainer /bin/bash</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.162.1">A running container may also be paused and resumed using the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.163.1">podman pause</span></span><span class="koboSpan" id="kobo.164.1"> and </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.165.1">unpause</span></span><span class="koboSpan" id="kobo.166.1"> commands as follows:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.167.1">$ </span><a id="_idIndexMarker680"/><a id="_idIndexMarker681"/><span class="koboSpan" id="kobo.168.1">podman pause mycontainer</span></p>
<p class="Code"><span class="koboSpan" id="kobo.169.1">$ podman unpause mycontainer</span></p>
<p class="Heading-1-1" id="_idParaDest-269" lang="en-US" xml:lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.170.1">30.5 </span></span><a id="_idTextAnchor456"/><span class="koboSpan" id="kobo.171.1">Saving a </span><a id="_idIndexMarker682"/><span class="koboSpan" id="kobo.172.1">Container to an Image</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.173.1">Once the container guest system is configured to your requirements there is a good chance that you will want to create and run more than one container of this particular type. </span><span class="koboSpan" id="kobo.173.2">To do this, the container needs to be saved as an image to local storage so that it can be used as the basis for additional container instances. </span><span class="koboSpan" id="kobo.173.3">This is achieved using the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.174.1">podman commit</span></span><span class="koboSpan" id="kobo.175.1"> command combined with the name or ID of the container and the name by which the image will be stored, for example:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.176.1">$ podman commit mycontainer  myubuntu_image</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.177.1">Once the image has been saved, check that it now appears in the list of images in the local repository:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.178.1">$ podman images</span></p>
<p class="Code"><span class="koboSpan" id="kobo.179.1">REPOSITORY                 TAG      IMAGE ID       CREATED              SIZE</span></p>
<p class="Code"><span class="koboSpan" id="kobo.180.1">localhost/myubuntu_image   latest   8ad685d49482   47 seconds ago       66.6 MB</span></p>
<p class="Code"><span class="koboSpan" id="kobo.181.1">docker.io/library/ubuntu   latest   4e5021d210f6   3 weeks ago          66.6 MB</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.182.1">The saved image can now be used to create additional containers identical to the original:</span></p>
<p class="Code"><a id="_idTextAnchor457"/><span class="koboSpan" id="kobo.183.1">$ podman run --name=mycontainer2 -it localhost/myubuntu_image /bin/bash</span></p>
<p class="Heading-1-1" id="_idParaDest-270" lang="en-US" xml:lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.184.1">30.6 </span></span><a id="_idTextAnchor458"/><span class="koboSpan" id="kobo.185.1">Removing an Image from Local Storage</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.186.1">To remove an image from local storage once it is no longer needed, simply run the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.187.1">podman rmi </span></span><span class="koboSpan" id="kobo.188.1">command, referencing either the image name or ID as output by the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.189.1">podman images</span></span><span class="koboSpan" id="kobo.190.1"> command. </span><span class="koboSpan" id="kobo.190.2">For example, to remove the image named </span><span class="My-Italic CharOverride-1"><span class="koboSpan" id="kobo.191.1">myubuntu_image</span></span><span class="koboSpan" id="kobo.192.1"> created in the previous section, run </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.193.1">podman</span></span><span class="koboSpan" id="kobo.194.1"> as follows:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.195.1">$ podman rmi localhost/myubuntu_image</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.196.1">Note before an image can be removed, any containers based on that image must first be removed. </span></p>
<p class="Heading-1-1" id="_idParaDest-271" lang="en-US" xml:lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.197.1">30.7 </span></span><a id="_idTextAnchor459"/><span class="koboSpan" id="kobo.198.1">Removing Containers</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.199.1">Even when a container has exited or been stopped, it still exists and can be restarted at any time. </span><span class="koboSpan" id="kobo.199.2">If a container is no longer needed, it can be deleted using the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.200.1">podman rm</span></span><span class="koboSpan" id="kobo.201.1"> command as follows after the container has been stopped:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.202.1"># </span><a id="_idIndexMarker688"/><span class="koboSpan" id="kobo.203.1">podman rm mycontainer2</span></p>
<p class="Heading-1-1" id="_idParaDest-272" lang="en-US" xml:lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.204.1">30.8 </span></span><a id="_idTextAnchor460"/><span class="koboSpan" id="kobo.205.1">Building a Container with Buildah</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.206.1">Buildah allows new containers to be built either from existing containers, an image or entirely from scratch. </span><span class="koboSpan" id="kobo.206.2">Buildah also includes the ability to mount the file system of a container so that it can be accessed and modified from the host.</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.207.1">The following </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.208.1">buildah</span></span><span class="koboSpan" id="kobo.209.1"> command, for example, will build a container from the Ubuntu Base image (if the image has not already been pulled from the registry, </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.210.1">buildah</span></span><span class="koboSpan" id="kobo.211.1"> will download it before creating the container):</span></p>
<p class="Code"><span class="koboSpan" id="kobo.212.1">$ buildah from docker://docker.io/library/ubuntu:latest</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.213.1">The result of running this command will be a container named </span><span class="My-Italic CharOverride-1"><span class="koboSpan" id="kobo.214.1">ubuntu-working-container</span></span><span class="koboSpan" id="kobo.215.1"> that is ready to run:</span></p>
<p class="Code"><a id="_idTextAnchor461"/><span class="koboSpan" id="kobo.216.1">$ buildah run ubuntu-working-container cat /etc/passwd</span></p>
<p class="Heading-1-1" id="_idParaDest-273" lang="en-US" xml:lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.217.1">30.9 </span></span><a id="_idTextAnchor462"/><span class="koboSpan" id="kobo.218.1">Summary</span></p>
<p class="My-Basic-Paragraph" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.219.1">This chapter has worked through the creation and management of Linux Containers on Ubuntu using the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.220.1">podman</span></span><span class="koboSpan" id="kobo.221.1">, </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.222.1">skopeo</span></span><span class="koboSpan" id="kobo.223.1"> and </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.224.1">buildah</span></span><span class="koboSpan" id="kobo.225.1"> tools.</span></p>
</div>
</body></html>