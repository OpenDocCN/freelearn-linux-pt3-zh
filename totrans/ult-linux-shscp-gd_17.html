<html><head></head><body>
  <div id="_idContainer232" class="Basic-Text-Frame">
    <h1 class="chapterNumber"><span class="koboSpan" id="kobo.1.1">17</span></h1>
    <h1 id="_idParaDest-354" class="chapterTitle"><span class="koboSpan" id="kobo.2.1">Using Shell Script Options with getops</span></h1>
    <p class="normal"><span class="koboSpan" id="kobo.3.1">Often, an administrator will need to pass both arguments and options to a shell script. </span><span class="koboSpan" id="kobo.3.2">That’s easily done by passing positional parameters to the script, as we’ve seen in previous chapters. </span><span class="koboSpan" id="kobo.3.3">But, if you need to use normal Linux/Unix-style option switches, and you need to use arguments for certain options, then you’ll need a helper program. </span><span class="koboSpan" id="kobo.3.4">In this chapter, I’ll show you how to use </span><code class="inlineCode"><span class="koboSpan" id="kobo.4.1">getops</span></code><span class="koboSpan" id="kobo.5.1"> to pass options, arguments, and options with arguments to a script.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.6.1">Topics in this chapter include:</span></p>
    <ul>
      <li class="bulletList"><span class="koboSpan" id="kobo.7.1">Understanding the need for </span><code class="inlineCode"><span class="koboSpan" id="kobo.8.1">getopts</span></code></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.9.1">Understanding </span><code class="inlineCode"><span class="koboSpan" id="kobo.10.1">getopt</span></code><span class="koboSpan" id="kobo.11.1"> versus </span><code class="inlineCode"><span class="koboSpan" id="kobo.12.1">getopts</span></code></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.13.1">Using </span><code class="inlineCode"><span class="koboSpan" id="kobo.14.1">getopts</span></code></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.15.1">Looking at real-world examples</span></li>
    </ul>
    <p class="normal"><span class="koboSpan" id="kobo.16.1">So, if you’re ready, let’s dig in.</span></p>
    <h1 id="_idParaDest-355" class="heading 1"><span class="koboSpan" id="kobo.17.1">Technical Requirements</span></h1>
    <p class="normal"><span class="koboSpan" id="kobo.18.1">You can use either your Fedora or your Debian virtual machine for this chapter. </span><span class="koboSpan" id="kobo.18.2">And, as always, you can grab the scripts by running:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.19.1">git clone https://github.com/PacktPublishing/The-Ultimate-Linux-Shell-Scripting-Guide.git
</span></code></pre>
    <h1 id="_idParaDest-356" class="heading 1"><span class="koboSpan" id="kobo.20.1">Understanding the Need for getopts</span></h1>
    <p class="normal"><span class="koboSpan" id="kobo.21.1">Before we do</span><a id="_idIndexMarker1038"/><span class="koboSpan" id="kobo.22.1"> anything else, let’s review the difference between </span><strong class="keyWord"><span class="koboSpan" id="kobo.23.1">options</span></strong><span class="koboSpan" id="kobo.24.1"> and </span><strong class="keyWord"><span class="koboSpan" id="kobo.25.1">arguments</span></strong><span class="koboSpan" id="kobo.26.1">.</span></p>
    <ul>
      <li class="bulletList"><span class="koboSpan" id="kobo.27.1">Options modify the behavior of a program or script.</span></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.28.1">Arguments are the objects upon which a program or script will act.</span></li>
    </ul>
    <p class="normal"><span class="koboSpan" id="kobo.29.1">The simplest way to demonstrate the difference is with the humble </span><code class="inlineCode"><span class="koboSpan" id="kobo.30.1">ls</span></code><span class="koboSpan" id="kobo.31.1"> command. </span><span class="koboSpan" id="kobo.31.2">If you want to see if a particular file is present, just use </span><code class="inlineCode"><span class="koboSpan" id="kobo.32.1">ls</span></code><span class="koboSpan" id="kobo.33.1"> and the filename as an argument, like this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.34.1">donnie@fedora:~$ ls coingecko.sh
coingecko.sh
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.35.1">If you want to see the details about the file, you’ll need to add an option, like this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.36.1">donnie@fedora:~$ ls -l coingecko.sh
-rwxr--r--. </span><span class="koboSpan" id="kobo.36.2">1 donnie donnie 842 Jan 12 13:11 coingecko.sh
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.37.1">You see how the </span><code class="inlineCode"><span class="koboSpan" id="kobo.38.1">-l</span></code><span class="koboSpan" id="kobo.39.1"> option modifies the behavior of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.40.1">ls</span></code><span class="koboSpan" id="kobo.41.1"> command.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.42.1">You’ve already seen how to use normal positional parameters to pass options and arguments into a script. </span><span class="koboSpan" id="kobo.42.2">A lot of the time, this will work sufficiently well, and you won’t need anything more. </span><span class="koboSpan" id="kobo.42.3">However, without some sort of helper utility, creating scripts that can properly parse a set of single-letter options that are combined with a single dash, or that have options with their arguments is very unwieldy. </span><span class="koboSpan" id="kobo.42.4">This is where </span><code class="inlineCode"><span class="koboSpan" id="kobo.43.1">getopts</span></code><span class="koboSpan" id="kobo.44.1"> comes in. </span><span class="koboSpan" id="kobo.44.2">You can use it in a script to simplify the process. </span><span class="koboSpan" id="kobo.44.3">Before we talk about that though, I want to quickly cover something that might be a point of confusion for you.</span></p>
    <h1 id="_idParaDest-357" class="heading 1"><span class="koboSpan" id="kobo.45.1">Understanding getopt versus getopts</span></h1>
    <p class="normal"><span class="koboSpan" id="kobo.46.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.47.1">getopt</span></code><span class="koboSpan" id="kobo.48.1"> utility, which </span><a id="_idIndexMarker1039"/><span class="koboSpan" id="kobo.49.1">has its own executable file, has been around forever, since the early days of Unix. </span><span class="koboSpan" id="kobo.49.2">Its big advantage is that it can handle long options. </span><span class="koboSpan" id="kobo.49.3">In other words, in addition to feeding it single-letter options, such as </span><code class="inlineCode"><span class="koboSpan" id="kobo.50.1">-a</span></code><span class="koboSpan" id="kobo.51.1"> or </span><code class="inlineCode"><span class="koboSpan" id="kobo.52.1">-b</span></code><span class="koboSpan" id="kobo.53.1">, you can also feed it whole-word options such as </span><code class="inlineCode"><span class="koboSpan" id="kobo.54.1">--alpha</span></code><span class="koboSpan" id="kobo.55.1"> or </span><code class="inlineCode"><span class="koboSpan" id="kobo.56.1">--beta</span></code><span class="koboSpan" id="kobo.57.1">. </span><span class="koboSpan" id="kobo.57.2">And, that’s it. </span><span class="koboSpan" id="kobo.57.3">That’s really its only advantage.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.58.1">It also has some disadvantages. </span><span class="koboSpan" id="kobo.58.2">The original implementation of </span><code class="inlineCode"><span class="koboSpan" id="kobo.59.1">getopt</span></code><span class="koboSpan" id="kobo.60.1"> can’t handle arguments that have blank spaces in their text strings. </span><span class="koboSpan" id="kobo.60.2">So, for example, if you need to work with a file that has a blank space in its filename, you can’t specify that filename as an argument for a shell script that uses the original </span><code class="inlineCode"><span class="koboSpan" id="kobo.61.1">getopt</span></code><span class="koboSpan" id="kobo.62.1">. </span><span class="koboSpan" id="kobo.62.2">Also, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.63.1">getopt</span></code><span class="koboSpan" id="kobo.64.1"> syntax is a bit trickier than that of </span><code class="inlineCode"><span class="koboSpan" id="kobo.65.1">getopts</span></code><span class="koboSpan" id="kobo.66.1">, which makes </span><code class="inlineCode"><span class="koboSpan" id="kobo.67.1">getopts</span></code><span class="koboSpan" id="kobo.68.1"> somewhat easier to use.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.69.1">At some point in time, I’m not sure when, some random Linux developers decided to create a new implementation of </span><code class="inlineCode"><span class="koboSpan" id="kobo.70.1">getopt</span></code><span class="koboSpan" id="kobo.71.1"> that would fix some of these deficiencies. </span><span class="koboSpan" id="kobo.71.2">(This is known as the </span><strong class="keyWord"><span class="koboSpan" id="kobo.72.1">util-linux</span></strong><span class="koboSpan" id="kobo.73.1"> implementation.) That would be great, except that it’s still </span><em class="italic"><span class="koboSpan" id="kobo.74.1">only</span></em><span class="koboSpan" id="kobo.75.1"> in Linux. </span><span class="koboSpan" id="kobo.75.2">All of the Unix and Unix-like operating systems still have the original, unenhanced </span><code class="inlineCode"><span class="koboSpan" id="kobo.76.1">getopt</span></code><span class="koboSpan" id="kobo.77.1">. </span><span class="koboSpan" id="kobo.77.2">So, if you were to create a script on a Linux machine that uses the cool features of the enhanced </span><code class="inlineCode"><span class="koboSpan" id="kobo.78.1">getopt</span></code><span class="koboSpan" id="kobo.79.1">, you won’t be able to run it on any Unix or Unix-like operating system, such as FreeBSD or OpenIndiana.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.80.1">The newer </span><code class="inlineCode"><span class="koboSpan" id="kobo.81.1">getopts</span></code><span class="koboSpan" id="kobo.82.1"> command, which is a shell builtin command that doesn’t have its own executable, can work with arguments that contain blank spaces. </span><span class="koboSpan" id="kobo.82.2">The trade-off is that it can only work with single-letter options, and can’t work with long options. </span><span class="koboSpan" id="kobo.82.3">The biggest advantage is that it’s portable across Linux, Unix, and Unix-like operating systems, regardless of which shell you’re using. </span><span class="koboSpan" id="kobo.82.4">So, if portability is one of your goals, your best bet is to just say </span><em class="italic"><span class="koboSpan" id="kobo.83.1">No</span></em><span class="koboSpan" id="kobo.84.1"> to </span><code class="inlineCode"><span class="koboSpan" id="kobo.85.1">getopt</span></code><span class="koboSpan" id="kobo.86.1">, and </span><em class="italic"><span class="koboSpan" id="kobo.87.1">Yes</span></em><span class="koboSpan" id="kobo.88.1"> to </span><code class="inlineCode"><span class="koboSpan" id="kobo.89.1">getopts</span></code><span class="koboSpan" id="kobo.90.1">. </span></p>
    <p class="normal"><span class="koboSpan" id="kobo.91.1">For that reason, I’ll only cover </span><code class="inlineCode"><span class="koboSpan" id="kobo.92.1">getopts</span></code><span class="koboSpan" id="kobo.93.1"> in this chapter, and won’t say anything more about the creaky old </span><code class="inlineCode"><span class="koboSpan" id="kobo.94.1">getopt</span></code><span class="koboSpan" id="kobo.95.1">.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.96.1">With that out of the way, let’s get down to the meat of the matter.</span></p>
    <h1 id="_idParaDest-358" class="heading 1"><span class="koboSpan" id="kobo.97.1">Using getopts</span></h1>
    <p class="normal"><span class="koboSpan" id="kobo.98.1">We’ll begin </span><a id="_idIndexMarker1040"/><span class="koboSpan" id="kobo.99.1">with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.100.1">getopts-demo1.sh</span></code><span class="koboSpan" id="kobo.101.1"> script, which is the world’s simplest </span><code class="inlineCode"><span class="koboSpan" id="kobo.102.1">getopts</span></code><span class="koboSpan" id="kobo.103.1"> script. </span><span class="koboSpan" id="kobo.103.2">Here’s how it looks:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.104.1">#!/bin/bash
while getopts ab options; do
        case $options in
                a) echo "You chose Option A";;
                b) echo "You chose Option B";;
        esac
done
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.105.1">We’re using a </span><code class="inlineCode"><span class="koboSpan" id="kobo.106.1">while</span></code><span class="koboSpan" id="kobo.107.1"> loop to pass the chosen option or options into a </span><code class="inlineCode"><span class="koboSpan" id="kobo.108.1">case</span></code><span class="koboSpan" id="kobo.109.1"> statement. </span><span class="koboSpan" id="kobo.109.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.110.1">ab</span></code><span class="koboSpan" id="kobo.111.1"> after the </span><code class="inlineCode"><span class="koboSpan" id="kobo.112.1">getopts</span></code><span class="koboSpan" id="kobo.113.1"> command means that we’re defining </span><code class="inlineCode"><span class="koboSpan" id="kobo.114.1">a</span></code><span class="koboSpan" id="kobo.115.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.116.1">b</span></code><span class="koboSpan" id="kobo.117.1"> as options that we can choose. </span><span class="koboSpan" id="kobo.117.2">(This list of allowable options is referred to as the </span><strong class="keyWord"><span class="koboSpan" id="kobo.118.1">optstring</span></strong><span class="koboSpan" id="kobo.119.1">.) You can use any alpha-numeric character as an option. </span><span class="koboSpan" id="kobo.119.2">It’s possible to use certain other characters as well, but it’s not recommended. </span><span class="koboSpan" id="kobo.119.3">For reasons that will become clear later, you definitely </span><em class="italic"><span class="koboSpan" id="kobo.120.1">cannot</span></em><span class="koboSpan" id="kobo.121.1"> use either a </span><code class="inlineCode"><span class="koboSpan" id="kobo.122.1">?</span></code><span class="koboSpan" id="kobo.123.1"> or a </span><code class="inlineCode"><span class="koboSpan" id="kobo.124.1">:</span></code><span class="koboSpan" id="kobo.125.1"> as an option. </span><span class="koboSpan" id="kobo.125.2">After the </span><code class="inlineCode"><span class="koboSpan" id="kobo.126.1">ab</span></code><span class="koboSpan" id="kobo.127.1">, you see </span><code class="inlineCode"><span class="koboSpan" id="kobo.128.1">options</span></code><span class="koboSpan" id="kobo.129.1">, which is just the name of the variable that we’ll use in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.130.1">case</span></code><span class="koboSpan" id="kobo.131.1"> construct. </span><span class="koboSpan" id="kobo.131.2">(You can name the variable whatever you want.) Anyway, running the script looks like this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.132.1">donnie@fedora:~$ ./getopts-demo1.sh -a
You chose Option A
donnie@fedora:~$ ./getopts-demo1.sh -b
You chose Option B
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.133.1">Okay, </span><em class="italic"><span class="koboSpan" id="kobo.134.1">big deal</span></em><span class="koboSpan" id="kobo.135.1">, you’re saying. </span><span class="koboSpan" id="kobo.135.2">We can do this sort of thing with just normal positional parameters. </span><span class="koboSpan" id="kobo.135.3">Ah, but here’s something that you can’t do with normal positional parameters:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.136.1">donnie@fedora:~$ ./getopts-demo1.sh -ab
You chose Option A
You chose Option B
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.137.1">So, you see how </span><code class="inlineCode"><span class="koboSpan" id="kobo.138.1">getopts</span></code><span class="koboSpan" id="kobo.139.1"> allows you to combine options with a single dash, just as you’re used to doing with normal Linux and Unix utilities. </span><span class="koboSpan" id="kobo.139.2">Something else that you can’t do </span><a id="_idIndexMarker1041"/><span class="koboSpan" id="kobo.140.1">with normal positional parameters, at least not easily, is to have options that require their own arguments. </span><span class="koboSpan" id="kobo.140.2">Here’s the </span><code class="inlineCode"><span class="koboSpan" id="kobo.141.1">getopts-demo2.sh</span></code><span class="koboSpan" id="kobo.142.1"> script that shows how that’s done:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.143.1">#!/bin/bash
while getopts a:b: options; do
        case $options in
                a) var1=$OPTARG;;
                b) var2=$OPTARG;;
        esac
done
echo "Option A is $var1 and Option B is $var2"
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.144.1">When you place a colon after an allowable option in the optstring, you’ll need to supply an argument for that option when you run the script. </span><span class="koboSpan" id="kobo.144.2">The argument for each option is stored in </span><code class="inlineCode"><span class="koboSpan" id="kobo.145.1">OPTARG</span></code><span class="koboSpan" id="kobo.146.1">, which is a variable that’s built into the shell and that works with </span><code class="inlineCode"><span class="koboSpan" id="kobo.147.1">getopts</span></code><span class="koboSpan" id="kobo.148.1">. </span><span class="koboSpan" id="kobo.148.2">(Note that this variable name must consist of nothing but upper-case letters.) The </span><code class="inlineCode"><span class="koboSpan" id="kobo.149.1">while</span></code><span class="koboSpan" id="kobo.150.1"> loop runs once for each option that is used, which means that the same </span><code class="inlineCode"><span class="koboSpan" id="kobo.151.1">OPTARG</span></code><span class="koboSpan" id="kobo.152.1"> variable can be used for multiple option arguments. </span><span class="koboSpan" id="kobo.152.2">Just for fun, let’s try this with my first name as the argument for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.153.1">-a</span></code><span class="koboSpan" id="kobo.154.1"> option, and my last name as the argument for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.155.1">-b</span></code><span class="koboSpan" id="kobo.156.1"> option. </span><span class="koboSpan" id="kobo.156.2">Here’s how it looks:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.157.1">donnie@fedora:~$ ./getopts-demo2.sh -a Donnie -b Tevault
Option A is Donnie and Option B is Tevault
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.158.1">As it is now, the shell will return its own error message if you run the script with an invalid option, which looks like this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.159.1">donnie@fedora:~$ ./getopts-demo2.sh -x
./getopts-demo2.sh: illegal option -- x
Option A is  and Option B is
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.160.1">In this case, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.161.1">./getopts-demo2.sh: illegal option -- x</span></code><span class="koboSpan" id="kobo.162.1"> line is the error message that was generated by </span><code class="inlineCode"><span class="koboSpan" id="kobo.163.1">bash</span></code><span class="koboSpan" id="kobo.164.1">. </span><span class="koboSpan" id="kobo.164.2">You can suppress that error message by placing another colon at the beginning of the optstring. </span><span class="koboSpan" id="kobo.164.3">Optionally, you can add a </span><code class="inlineCode"><span class="koboSpan" id="kobo.165.1">\?</span></code><span class="koboSpan" id="kobo.166.1"> choice to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.167.1">case</span></code><span class="koboSpan" id="kobo.168.1"> structure </span><a id="_idIndexMarker1042"/><span class="koboSpan" id="kobo.169.1">that will display your own custom error message for invalid choices, and a </span><code class="inlineCode"><span class="koboSpan" id="kobo.170.1">: </span></code><span class="koboSpan" id="kobo.171.1">choice to alert you if you try to run the script without supplying the required option arguments. </span><span class="koboSpan" id="kobo.171.2">Another problem is that if I don’t supply the required option arguments, the final </span><code class="inlineCode"><span class="koboSpan" id="kobo.172.1">echo</span></code><span class="koboSpan" id="kobo.173.1"> command still runs, when it really shouldn’t. </span><span class="koboSpan" id="kobo.173.2">Anyway, here’s how all of the fixes look in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.174.1">getopts-demo3.sh</span></code><span class="koboSpan" id="kobo.175.1"> script:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.176.1">#!/bin/bash
while getopts :a:b: options; do
        case $options in
                a) var1=$OPTARG;;
                b) var2=$OPTARG;;
                \?) echo "I don't know the $OPTARG option";;
                :) echo "Both options require an argument.";;
        esac
done
[[ -z $var1 ]] || echo "Option A is $var1"
[[ -z $var2 ]] || echo "Option B is $var2"
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.177.1">Here’s what happens when I run it with all of the necessary arguments:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.178.1">donnie@fedora:~$ ./getopts-demo3.sh -a Donnie -b Tevault
Option A is Donnie
Option B is Tevault
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.179.1">And here’s how it looks if I either don’t use all of the options or if I use an option without providing an argument:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.180.1">donnie@fedora:~$ ./getopts-demo3.sh -a Donnie
Option A is Donnie
donnie@fedora:~$ ./getopts-demo3.sh -a
Both options require an argument.
</span><span class="koboSpan" id="kobo.180.2">donnie@fedora:~$ ./getopts-demo3.sh -a Donnie -b
Both options require an argument.
</span><span class="koboSpan" id="kobo.180.3">Option A is Donnie
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.181.1">What we’ve done so far works perfectly with options that require arguments. </span><span class="koboSpan" id="kobo.181.2">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.182.1">getopts-demo4.sh</span></code><span class="koboSpan" id="kobo.183.1"> script, I’ll introduce two new concepts. </span><span class="koboSpan" id="kobo.183.2">You’ll see how to require arguments</span><a id="_idIndexMarker1043"/><span class="koboSpan" id="kobo.184.1"> for some options but not for others, and how to use non-option arguments. </span><span class="koboSpan" id="kobo.184.2">Here’s how that looks:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.185.1">#!/bin/bash
while getopts :a:b:c options; do
        case $options in
                a) var1=$OPTARG;;
                b) var2=$OPTARG;;
                c) echo "This option doesn't require an argument.";;
                \?) echo "I don't know the $OPTARG option";;
                :) echo "Both options require an argument.";;
        esac
done
[[ -z $var1 ]] || echo "Option A is $var1"
[[ -z $var2 ]] || echo "Option B is $var2"
shift $((OPTIND-1))
[[ -z $1 ]] || ls -l "$1"
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.186.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.187.1">:a:b:c</span></code><span class="koboSpan" id="kobo.188.1"> optstring, without a colon after the </span><code class="inlineCode"><span class="koboSpan" id="kobo.189.1">c</span></code><span class="koboSpan" id="kobo.190.1">, says that an argument is required for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.191.1">-a</span></code><span class="koboSpan" id="kobo.192.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.193.1">-b</span></code><span class="koboSpan" id="kobo.194.1"> options, but not for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.195.1">-c</span></code><span class="koboSpan" id="kobo.196.1"> option. </span><span class="koboSpan" id="kobo.196.2">If any filenames are provided as non-option arguments, the last line at the bottom will perform an </span><code class="inlineCode"><span class="koboSpan" id="kobo.197.1">ls -l</span></code><span class="koboSpan" id="kobo.198.1"> command on those files. </span><span class="koboSpan" id="kobo.198.2">(Note that the </span><code class="inlineCode"><span class="koboSpan" id="kobo.199.1">[[ -z $@ ]]</span></code><span class="koboSpan" id="kobo.200.1"> structure will return an exit code of 0 if there are no non-option arguments. </span><span class="koboSpan" id="kobo.200.2">If there is a non-option argument, it will return an exit code of 1, which will trigger the </span><code class="inlineCode"><span class="koboSpan" id="kobo.201.1">ls -l</span></code><span class="koboSpan" id="kobo.202.1"> command.) But, here’s the trick. </span></p>
    <p class="normal"><span class="koboSpan" id="kobo.203.1">When you run this script, you’ll need to specify the options and option arguments first. </span><span class="koboSpan" id="kobo.203.2">Then, at the end of the command, specify the filenames that will be the non-option arguments. </span><span class="koboSpan" id="kobo.203.3">Or, if you desire, just specify a non-option argument without using any of the options. </span><span class="koboSpan" id="kobo.203.4">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.204.1">shift $((OPTIND-1))</span></code><span class="koboSpan" id="kobo.205.1"> line is necessary to make the script recognize non-option arguments.</span></p>
    <p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.206.1">OPTIND</span></code><span class="koboSpan" id="kobo.207.1"> is another variable that’s built into the shell and that is meant to hold the number of </span><code class="inlineCode"><span class="koboSpan" id="kobo.208.1">getopts</span></code><span class="koboSpan" id="kobo.209.1"> options that have been processed. </span><span class="koboSpan" id="kobo.209.2">The simplest way to understand what the </span><code class="inlineCode"><span class="koboSpan" id="kobo.210.1">shift $((OPTIND-1))</span></code><span class="koboSpan" id="kobo.211.1"> command does is to think of it as a clearing mechanism. </span><span class="koboSpan" id="kobo.211.2">In </span><a id="_idIndexMarker1044"/><span class="koboSpan" id="kobo.212.1">other words, it clears away all of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.213.1">getopts</span></code><span class="koboSpan" id="kobo.214.1"> options that have been used and makes way for the non-option arguments. </span><span class="koboSpan" id="kobo.214.2">Another way to think of it is that it resets the positional parameter count back to </span><code class="inlineCode"><span class="koboSpan" id="kobo.215.1">$1</span></code><span class="koboSpan" id="kobo.216.1">. </span><span class="koboSpan" id="kobo.216.2">That way, you can access your non-option arguments the way you normally would, as you see on the final line. </span><span class="koboSpan" id="kobo.216.3">Also, note the </span><code class="inlineCode"><span class="koboSpan" id="kobo.217.1">ls -l "$1"</span></code><span class="koboSpan" id="kobo.218.1"> command in the final line. </span><span class="koboSpan" id="kobo.218.2">This is a case where you absolutely </span><em class="italic"><span class="koboSpan" id="kobo.219.1">must</span></em><span class="koboSpan" id="kobo.220.1"> surround the positional parameter (</span><code class="inlineCode"><span class="koboSpan" id="kobo.221.1">$1</span></code><span class="koboSpan" id="kobo.222.1">, in this case) with a pair of double quotes. </span><span class="koboSpan" id="kobo.222.2">Otherwise, you’ll get an error message if you try to access a file that has a blank space in its filename. </span><span class="koboSpan" id="kobo.222.3">Finally, note that you can list multiple positional parameters so that you can have multiple arguments, just as you’ve done before. </span><span class="koboSpan" id="kobo.222.4">Or, you can replace the </span><code class="inlineCode"><span class="koboSpan" id="kobo.223.1">"$1"</span></code><span class="koboSpan" id="kobo.224.1"> parameter with </span><code class="inlineCode"><span class="koboSpan" id="kobo.225.1">"$@"</span></code><span class="koboSpan" id="kobo.226.1"> so that you can use an unlimited number of non-option arguments.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.227.1">So, running this script with no options, and with just a non-option argument, looks like this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.228.1">donnie@fedora:~$ ./getopts-demo4.sh "my new file.txt"
-rw-r--r--. </span><span class="koboSpan" id="kobo.228.2">1 donnie donnie 0 Feb 25 13:00 'my new file.txt'
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.229.1">If I were to remove the double quotes from around the positional parameter in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.230.1">ls -l</span></code><span class="koboSpan" id="kobo.231.1"> command, I would receive an error whenever I try to access a file with blank spaces in the filename. </span><span class="koboSpan" id="kobo.231.2">Here’s how that looks:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.232.1">donnie@fedora:~$ ./getopts-demo4.sh "my new file.txt"
ls: cannot access 'my': No such file or directory
ls: cannot access 'new': No such file or directory
ls: cannot access 'file.txt': No such file or directory
donnie@fedora:~$
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.233.1">So, remember to use those double quotes.</span></p>
    <div class="note">
      <p class="normal"><span class="koboSpan" id="kobo.234.1">When I told you about the disadvantages of using </span><code class="inlineCode"><span class="koboSpan" id="kobo.235.1">getopt</span></code><span class="koboSpan" id="kobo.236.1">, I mentioned that the </span><code class="inlineCode"><span class="koboSpan" id="kobo.237.1">getopt</span></code><span class="koboSpan" id="kobo.238.1"> syntax is trickier to use than that of </span><code class="inlineCode"><span class="koboSpan" id="kobo.239.1">getopts</span></code><span class="koboSpan" id="kobo.240.1">. </span><span class="koboSpan" id="kobo.240.2">If I were using </span><code class="inlineCode"><span class="koboSpan" id="kobo.241.1">getopt</span></code><span class="koboSpan" id="kobo.242.1"> for these scripts, I would need to place one or more </span><code class="inlineCode"><span class="koboSpan" id="kobo.243.1">shift</span></code><span class="koboSpan" id="kobo.244.1"> commands after each item in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.245.1">case</span></code><span class="koboSpan" id="kobo.246.1"> construct, so that the script would properly recognize the options. </span><span class="koboSpan" id="kobo.246.2">With </span><code class="inlineCode"><span class="koboSpan" id="kobo.247.1">getopts</span></code><span class="koboSpan" id="kobo.248.1">, this shifting is done automatically. </span><span class="koboSpan" id="kobo.248.2">The only place where I’ve had to use </span><code class="inlineCode"><span class="koboSpan" id="kobo.249.1">shift</span></code><span class="koboSpan" id="kobo.250.1"> is in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.251.1">shift $((OPTIND-1))</span></code><span class="koboSpan" id="kobo.252.1"> command at the end. </span><span class="koboSpan" id="kobo.252.2">So you can see where </span><code class="inlineCode"><span class="koboSpan" id="kobo.253.1">getopts</span></code><span class="koboSpan" id="kobo.254.1"> is much simpler.</span></p>
      <p class="normal"><span class="koboSpan" id="kobo.255.1">Also, if you want to learn more about how to use </span><code class="inlineCode"><span class="koboSpan" id="kobo.256.1">OPTIND</span></code><span class="koboSpan" id="kobo.257.1"> with </span><code class="inlineCode"><span class="koboSpan" id="kobo.258.1">getops</span></code><span class="koboSpan" id="kobo.259.1">, I’ve placed some references in the </span><em class="chapterRef"><span class="koboSpan" id="kobo.260.1">Further Reading</span></em><span class="koboSpan" id="kobo.261.1"> section.</span></p>
    </div>
    <p class="normal"><span class="koboSpan" id="kobo.262.1">And really, this is </span><a id="_idIndexMarker1045"/><span class="koboSpan" id="kobo.263.1">pretty much it for the basic usage of </span><code class="inlineCode"><span class="koboSpan" id="kobo.264.1">getopts</span></code><span class="koboSpan" id="kobo.265.1">. </span><span class="koboSpan" id="kobo.265.2">So, let’s move on.</span></p>
    <h1 id="_idParaDest-359" class="heading 1"><span class="koboSpan" id="kobo.266.1">Looking at Real-world Examples</span></h1>
    <p class="normal"><span class="koboSpan" id="kobo.267.1">Now that I’ve demonstrated the theory of using </span><code class="inlineCode"><span class="koboSpan" id="kobo.268.1">getopts</span></code><span class="koboSpan" id="kobo.269.1">, it’s time to get down to business with a couple of real-world examples. </span><span class="koboSpan" id="kobo.269.2">Enjoy!</span></p>
    <h2 id="_idParaDest-360" class="heading 2"><span class="koboSpan" id="kobo.270.1">The Modified Coingecko Script</span></h2>
    <p class="normal"><span class="koboSpan" id="kobo.271.1">In </span><em class="chapterRef"><span class="koboSpan" id="kobo.272.1">Chapter 10, Understanding Functions</span></em><span class="koboSpan" id="kobo.273.1">, I showed you a pair of cool scripts that I created </span><a id="_idIndexMarker1046"/><span class="koboSpan" id="kobo.274.1">for my own use. </span><span class="koboSpan" id="kobo.274.2">To review, these scripts use the Coingecko API to automatically fetch information about cryptocurrencies.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.275.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.276.1">coingecko.sh</span></code><span class="koboSpan" id="kobo.277.1"> script uses an </span><code class="inlineCode"><span class="koboSpan" id="kobo.278.1">if. </span><span class="koboSpan" id="kobo.278.2">.elif. </span><span class="koboSpan" id="kobo.278.3">.else</span></code><span class="koboSpan" id="kobo.279.1"> construct to allow me to choose the function that I want to perform. </span><span class="koboSpan" id="kobo.279.2">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.280.1">coingecko-case.sh</span></code><span class="koboSpan" id="kobo.281.1"> script, I use a </span><code class="inlineCode"><span class="koboSpan" id="kobo.282.1">case. </span><span class="koboSpan" id="kobo.282.2">.esac</span></code><span class="koboSpan" id="kobo.283.1"> construct to achieve the same thing. </span><span class="koboSpan" id="kobo.283.2">Now, I present the third incarnation of the script, which uses </span><code class="inlineCode"><span class="koboSpan" id="kobo.284.1">getopts</span></code><span class="koboSpan" id="kobo.285.1">.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.286.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.287.1">coingecko-getopts.sh</span></code><span class="koboSpan" id="kobo.288.1"> script is too large to reproduce here, so you’ll need to grab it from GitHub. </span><span class="koboSpan" id="kobo.288.2">I do need to point out a few things about it, so I’ll just show the relevant snippets here.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.289.1">At the beginning of the script, I added the </span><code class="inlineCode"><span class="koboSpan" id="kobo.290.1">gecko_usage()</span></code><span class="koboSpan" id="kobo.291.1"> function, which looks like this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.292.1">gecko_usage() {
        echo "Usage:"
        echo "To create a list of coins, do:"
        echo "./coingecko.sh -l"
        echo
        echo "To create a list of reference currencies, do:"
        echo "./coingecko.sh -c"
        echo
        echo "To get current coin prices, do:"
        echo "./coingecko.sh coin_name(s) currency"
}
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.293.1">Next, I deleted the </span><code class="inlineCode"><span class="koboSpan" id="kobo.294.1">coin=$1</span></code><span class="koboSpan" id="kobo.295.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.296.1">currency=$2</span></code><span class="koboSpan" id="kobo.297.1"> variable definitions from within the </span><code class="inlineCode"><span class="koboSpan" id="kobo.298.1">gecko_api()</span></code><span class="koboSpan" id="kobo.299.1"> function, because we no longer need them.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.300.1">Then, I added</span><a id="_idIndexMarker1047"/><span class="koboSpan" id="kobo.301.1"> an error-checking option to the existing case structure, modified the </span><strong class="screenText"><span class="koboSpan" id="kobo.302.1">Usage </span></strong><span class="koboSpan" id="kobo.303.1">option to call the </span><code class="inlineCode"><span class="koboSpan" id="kobo.304.1">gecko_usage()</span></code><span class="koboSpan" id="kobo.305.1"> function, and then surrounded it with a </span><code class="inlineCode"><span class="koboSpan" id="kobo.306.1">while</span></code><span class="koboSpan" id="kobo.307.1"> loop, which looks like this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.308.1">while getopts :hlc options; do
        case $options in
                h)
                        gecko_usage
l)
        curl -X 'GET' \
        "https://api.coingecko.com/api/v3/coins/list?include_platform=true" \
         -H 'accept: application/json' | jq | tee coinlist.txt
         ;;
. </span><span class="koboSpan" id="kobo.308.2">. </span><span class="koboSpan" id="kobo.308.3">.
</span><span class="koboSpan" id="kobo.308.4">. </span><span class="koboSpan" id="kobo.308.5">. </span><span class="koboSpan" id="kobo.308.6">.
 </span><span class="koboSpan" id="kobo.308.7">\?) echo "I don't know this $OPTARG option"
                        ;;
                esac
                done
</span></code></pre>
    <div class="note">
      <p class="normal"><span class="koboSpan" id="kobo.309.1">Remember to install the </span><code class="inlineCode"><span class="koboSpan" id="kobo.310.1">jq</span></code><span class="koboSpan" id="kobo.311.1"> package, as I showed you in </span><em class="chapterRef"><span class="koboSpan" id="kobo.312.1">Chapter 10</span></em><span class="koboSpan" id="kobo.313.1">.</span></p>
    </div>
    <p class="normal"><span class="koboSpan" id="kobo.314.1">At first, I also had a </span><code class="inlineCode"><span class="koboSpan" id="kobo.315.1">p:</span></code><span class="koboSpan" id="kobo.316.1"> option to obtain the current coin prices. </span><span class="koboSpan" id="kobo.316.2">That didn’t work though, because this command requires two arguments, which are the comma-separated</span><a id="_idIndexMarker1048"/><span class="koboSpan" id="kobo.317.1"> list of coins and the reference currency. </span><span class="koboSpan" id="kobo.317.2">But, </span><code class="inlineCode"><span class="koboSpan" id="kobo.318.1">getopts</span></code><span class="koboSpan" id="kobo.319.1"> only allows you to use one argument per option. </span><span class="koboSpan" id="kobo.319.2">To fix that, I moved the coin price command out of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.320.1">gecko_api()</span></code><span class="koboSpan" id="kobo.321.1"> function, and placed it at the end of the file, like this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.322.1">gecko_api $1
shift $((OPTIND-1))
[[ -n $1 ]] &amp;&amp; [[ -n $2 ]] &amp;&amp; curl -X 'GET' \
  "https://api.coingecko.com/api/v3/simple/price?ids=$1&amp;vs_currencies=$2&amp;include_market_cap=true&amp;include_24hr_vol=true&amp;include_24hr_change=true&amp;include_last_updated_at=true&amp;precision=true" \
  -H 'accept: application/json' | jq
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.323.1">The call to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.324.1">gecko_api() </span></code><span class="koboSpan" id="kobo.325.1">function now only requires one positional parameter, which will be the selected </span><code class="inlineCode"><span class="koboSpan" id="kobo.326.1">-h</span></code><span class="koboSpan" id="kobo.327.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.328.1">-l</span></code><span class="koboSpan" id="kobo.329.1">, or </span><code class="inlineCode"><span class="koboSpan" id="kobo.330.1">-c</span></code><span class="koboSpan" id="kobo.331.1"> option, or the combined </span><code class="inlineCode"><span class="koboSpan" id="kobo.332.1">-hlc</span></code><span class="koboSpan" id="kobo.333.1"> set of options. </span><span class="koboSpan" id="kobo.333.2">If you want to use each option separately, rather than combining them, you’ll need to change </span><code class="inlineCode"><span class="koboSpan" id="kobo.334.1">gecko_api $1</span></code><span class="koboSpan" id="kobo.335.1"> to either </span><code class="inlineCode"><span class="koboSpan" id="kobo.336.1">gecko_api $1 $2 $3</span></code><span class="koboSpan" id="kobo.337.1"> or </span><code class="inlineCode"><span class="koboSpan" id="kobo.338.1">gecko_api $@</span></code><span class="koboSpan" id="kobo.339.1">.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.340.1">So, adapting the original Coingecko scripts to use </span><code class="inlineCode"><span class="koboSpan" id="kobo.341.1">getopts</span></code><span class="koboSpan" id="kobo.342.1"> was really quite easy. </span><span class="koboSpan" id="kobo.342.2">But, what’s the advantage? </span><span class="koboSpan" id="kobo.342.3">Well, in this case, there’s really only one. </span><span class="koboSpan" id="kobo.342.4">That is, by using </span><code class="inlineCode"><span class="koboSpan" id="kobo.343.1">getopts</span></code><span class="koboSpan" id="kobo.344.1"> option switches, you can now perform more than one task by running this script just a single time. </span><span class="koboSpan" id="kobo.344.2">That’s something that you can’t do with the original scripts. </span><span class="koboSpan" id="kobo.344.3">Regardless, you can use this as a template for your own scripts in which using </span><code class="inlineCode"><span class="koboSpan" id="kobo.345.1">getopts</span></code><span class="koboSpan" id="kobo.346.1"> might be more advantageous.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.347.1">Now, let’s check out a cool system monitoring script.</span></p>
    <h2 id="_idParaDest-361" class="heading 2"><span class="koboSpan" id="kobo.348.1">The Tecmint Monitor Script</span></h2>
    <p class="normal"><span class="koboSpan" id="kobo.349.1">I borrowed</span><a id="_idIndexMarker1049"/><span class="koboSpan" id="kobo.350.1"> this handy Linux-only </span><code class="inlineCode"><span class="koboSpan" id="kobo.351.1">tecmint_monitor.sh</span></code><span class="koboSpan" id="kobo.352.1"> script from the Tecmint website, and tweaked it a bit to make it work better on newer Linux systems. </span><span class="koboSpan" id="kobo.352.2">The author released it under the Apache 2.0 free software license, so I was able to upload the tweaked version to GitHub for your convenience. </span><span class="koboSpan" id="kobo.352.3">(I’ve also provided a link to the original Tecmint article in the </span><em class="chapterRef"><span class="koboSpan" id="kobo.353.1">Further Reading</span></em><span class="koboSpan" id="kobo.354.1"> section.) </span></p>
    <p class="normal"><span class="koboSpan" id="kobo.355.1">I’m not going to explain the whole script here, because the author has done a stellar job of explaining it by inserting comments everywhere. </span><span class="koboSpan" id="kobo.355.2">But, I will point out a few things about it.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.356.1">The first thing to note is that the author has done things a bit differently with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.357.1">case</span></code><span class="koboSpan" id="kobo.358.1"> construct. </span><span class="koboSpan" id="kobo.358.2">Instead of placing all of the code that he wants to execute into the </span><code class="inlineCode"><span class="koboSpan" id="kobo.359.1">case</span></code><span class="koboSpan" id="kobo.360.1"> options, he instead just uses the </span><code class="inlineCode"><span class="koboSpan" id="kobo.361.1">case</span></code><span class="koboSpan" id="kobo.362.1"> options to set either the </span><code class="inlineCode"><span class="koboSpan" id="kobo.363.1">iopt</span></code><span class="koboSpan" id="kobo.364.1"> or </span><code class="inlineCode"><span class="koboSpan" id="kobo.365.1">vopt</span></code><span class="koboSpan" id="kobo.366.1"> variable, depending upon whether the </span><code class="inlineCode"><span class="koboSpan" id="kobo.367.1">-i</span></code><span class="koboSpan" id="kobo.368.1"> or the </span><code class="inlineCode"><span class="koboSpan" id="kobo.369.1">-v</span></code><span class="koboSpan" id="kobo.370.1"> option was chosen. </span><span class="koboSpan" id="kobo.370.2">Here’s how it looks:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.371.1">while getopts iv name
do
        case $name in
          i)iopt=1;;
          v)vopt=1;;
          *)echo "Invalid arg";;
        esac
done
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.372.1">The executable code is placed within a pair of </span><code class="inlineCode"><span class="koboSpan" id="kobo.373.1">if. </span><span class="koboSpan" id="kobo.373.2">.then</span></code><span class="koboSpan" id="kobo.374.1"> constructs. </span><span class="koboSpan" id="kobo.374.2">Here’s the first one:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.375.1">if [[ ! </span><span class="koboSpan" id="kobo.375.2">-z $iopt ]]
then
{
wd=$(pwd)
basename "$(test -L "$0" &amp;&amp; readlink "$0" || echo "$0")" &gt; /tmp/scriptname
scriptname=$(echo -e -n $wd/ &amp;&amp; cat /tmp/scriptname)
su -c "cp $scriptname /usr/bin/monitor" root &amp;&amp; echo "Congratulations! </span><span class="koboSpan" id="kobo.375.3">Script Installed, now run monitor Command" || echo "Installation failed"
}
fi
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.376.1">So, if the </span><a id="_idIndexMarker1050"/><span class="koboSpan" id="kobo.377.1">value of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.378.1">iopt</span></code><span class="koboSpan" id="kobo.379.1"> variable is not of zero length, meaning that the </span><code class="inlineCode"><span class="koboSpan" id="kobo.380.1">-i</span></code><span class="koboSpan" id="kobo.381.1"> option was chosen, then this script installation routine will run. </span><span class="koboSpan" id="kobo.381.2">It’s not a very complex command. </span><span class="koboSpan" id="kobo.381.3">All it does is prompt you to enter the root user’s password, copy the </span><code class="inlineCode"><span class="koboSpan" id="kobo.382.1">techmint-monitor.sh</span></code><span class="koboSpan" id="kobo.383.1"> script to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.384.1">/usr/bin/</span></code><span class="koboSpan" id="kobo.385.1"> directory, and change its name to </span><code class="inlineCode"><span class="koboSpan" id="kobo.386.1">monitor</span></code><span class="koboSpan" id="kobo.387.1">.</span></p>
    <div class="note">
      <p class="normal"><span class="koboSpan" id="kobo.388.1">Now, there is a slight problem here that I haven’t fixed. </span><span class="koboSpan" id="kobo.388.2">It’s just since the author created this script in 2016, it’s become more common for Linux users to not assign a password to the root user account. </span><span class="koboSpan" id="kobo.388.3">In fact, that’s the default behavior for the Ubuntu distros, and it’s optional for many other distros. </span><span class="koboSpan" id="kobo.388.4">(In fact, I’ve never assigned a root user password here on this Fedora workstation.) So, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.389.1">su -c</span></code><span class="koboSpan" id="kobo.390.1"> command here won’t work, because it expects you to enter the root user password when it prompts you to. </span><span class="koboSpan" id="kobo.390.2">So, if you haven’t assigned a password to the root account, you’ll always get an authentication failure if you run the script without using </span><code class="inlineCode"><span class="koboSpan" id="kobo.391.1">sudo</span></code><span class="koboSpan" id="kobo.392.1">. </span><span class="koboSpan" id="kobo.392.2">But, the script works fine when I do run it with </span><code class="inlineCode"><span class="koboSpan" id="kobo.393.1">sudo</span></code><span class="koboSpan" id="kobo.394.1">, so I didn’t bother to change this.</span></p>
    </div>
    <p class="normal"><span class="koboSpan" id="kobo.395.1">Next, we have the </span><code class="inlineCode"><span class="koboSpan" id="kobo.396.1">if. </span><span class="koboSpan" id="kobo.396.2">.then</span></code><span class="koboSpan" id="kobo.397.1"> construct for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.398.1">vopt</span></code><span class="koboSpan" id="kobo.399.1"> variable, which looks like this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.400.1">if [[ ! </span><span class="koboSpan" id="kobo.400.2">-z $vopt ]]
then
{
#echo -e "tecmint_monitor version 0.1\nDesigned by Tecmint.com\nReleased Under Apache 2.0 License"
echo -e "tecmint_monitor version 0.1\nDesigned by Tecmint.com\nTweaked by Donnie for more modern systems\nReleased Under Apache 2.0 License"
}
fi
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.401.1">All this option does is show version information about the script. </span><span class="koboSpan" id="kobo.401.2">At the bottom, I added the </span><code class="inlineCode"><span class="koboSpan" id="kobo.402.1">Tweaked by Donnie</span></code><span class="koboSpan" id="kobo.403.1"> line to show that I modified the original script. </span><span class="koboSpan" id="kobo.403.2">(You might say that I made a tweak here to show that I made some tweaks.)</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.404.1">Next, we see a long </span><code class="inlineCode"><span class="koboSpan" id="kobo.405.1">if. </span><span class="koboSpan" id="kobo.405.2">.then</span></code><span class="koboSpan" id="kobo.406.1"> construct that does the real work. </span><span class="koboSpan" id="kobo.406.2">It begins with </span><code class="inlineCode"><span class="koboSpan" id="kobo.407.1">if [[ $# -eq 0 ]]</span></code><span class="koboSpan" id="kobo.408.1">, which </span><a id="_idIndexMarker1051"/><span class="koboSpan" id="kobo.409.1">means that if no options were chosen, the code in this </span><code class="inlineCode"><span class="koboSpan" id="kobo.410.1">if. </span><span class="koboSpan" id="kobo.410.2">.then</span></code><span class="koboSpan" id="kobo.411.1"> construct will execute.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.412.1">Within this big, long </span><code class="inlineCode"><span class="koboSpan" id="kobo.413.1">if. </span><span class="koboSpan" id="kobo.413.2">.then</span></code><span class="koboSpan" id="kobo.414.1"> block are the commands that obtain various types of system information. </span><span class="koboSpan" id="kobo.414.2">I had to tweak the command for checking DNS server information because the author made it look for the IP address of the DNS server on a specific line of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.415.1">resolv.conf</span></code><span class="koboSpan" id="kobo.416.1"> file. </span><span class="koboSpan" id="kobo.416.2">I changed it so that it will look for any lines that begin with the text string </span><code class="inlineCode"><span class="koboSpan" id="kobo.417.1">nameserver</span></code><span class="koboSpan" id="kobo.418.1">, which looks like this:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.419.1"># Check DNS
#nameservers=$(cat /etc/resolv.conf | sed '1 d' | awk '{print $2}')
nameservers=$(cat /etc/resolv.conf | grep -w ^nameserver | awk '{print $2}')
echo -e '\E[32m'"Name Servers :" $tecreset $nameservers
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.420.1">I also tweaked the Check Disk Usages command, in order to make it more portable. </span><span class="koboSpan" id="kobo.420.2">Here’s how it looks:</span></p>
    <pre class="programlisting gen"><code class="hljs-con"><span class="koboSpan" id="kobo.421.1"># Check Disk Usages
#df -h| grep 'Filesystem\|/dev/sda*' &gt; /tmp/diskusage
df -Ph| grep 'Filesystem\|/dev/sda*' &gt; /tmp/diskusage
echo -e '\E[32m'"Disk Usages :" $tecreset
cat /tmp/diskusage
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.422.1">All I did here was to add the </span><code class="inlineCode"><span class="koboSpan" id="kobo.423.1">-P</span></code><span class="koboSpan" id="kobo.424.1"> option to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.425.1">df</span></code><span class="koboSpan" id="kobo.426.1"> command, so that the </span><code class="inlineCode"><span class="koboSpan" id="kobo.427.1">df</span></code><span class="koboSpan" id="kobo.428.1"> output will always be POSIX-compliant. </span><span class="koboSpan" id="kobo.428.2">Of course, you can also add more drives to this if you need to.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.429.1">Finally, at the very end, we have the </span><code class="inlineCode"><span class="koboSpan" id="kobo.430.1">shift $(($OPTIND -1))</span></code><span class="koboSpan" id="kobo.431.1"> command. </span><span class="koboSpan" id="kobo.431.2">The script will actually run just fine if you comment this line out, because we don’t have to deal with any non-option arguments. </span><span class="koboSpan" id="kobo.431.3">Still though, a lot of people believe that it’s good form to always add this line to the end of a script that uses </span><code class="inlineCode"><span class="koboSpan" id="kobo.432.1">getopts</span></code><span class="koboSpan" id="kobo.433.1">, just to ensure </span><a id="_idIndexMarker1052"/><span class="koboSpan" id="kobo.434.1">that all option information is cleared out when the script exits.</span></p>
    <div class="note">
      <p class="normal"><span class="koboSpan" id="kobo.435.1">In all of these examples, you’ve seen me use </span><code class="inlineCode"><span class="koboSpan" id="kobo.436.1">while</span></code><span class="koboSpan" id="kobo.437.1"> loops to implement </span><code class="inlineCode"><span class="koboSpan" id="kobo.438.1">getopts</span></code><span class="koboSpan" id="kobo.439.1">, because that’s my own personal preference. </span><span class="koboSpan" id="kobo.439.2">However, if you prefer to use a </span><code class="inlineCode"><span class="koboSpan" id="kobo.440.1">for</span></code><span class="koboSpan" id="kobo.441.1"> loop instead, that’s also perfectly fine. </span><span class="koboSpan" id="kobo.441.2">The choice is yours.</span></p>
    </div>
    <p class="normal"><span class="koboSpan" id="kobo.442.1">All right, I think that just about does it for our discussion of </span><code class="inlineCode"><span class="koboSpan" id="kobo.443.1">getopts</span></code><span class="koboSpan" id="kobo.444.1">. </span><span class="koboSpan" id="kobo.444.2">Let’s summarize and move on.</span></p>
    <h1 id="_idParaDest-362" class="heading 1"><span class="koboSpan" id="kobo.445.1">Summary</span></h1>
    <p class="normal"><span class="koboSpan" id="kobo.446.1">In this chapter, we’ve looked at </span><code class="inlineCode"><span class="koboSpan" id="kobo.447.1">getopts</span></code><span class="koboSpan" id="kobo.448.1">, which gives us a cool and easy way to create scripts that recognize Linux and Unix-style option switches that might have their own arguments. </span><span class="koboSpan" id="kobo.448.2">We began with a review of what command options and arguments are, and then cleared up a possible point of confusion about </span><code class="inlineCode"><span class="koboSpan" id="kobo.449.1">getopt</span></code><span class="koboSpan" id="kobo.450.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.451.1">getopts</span></code><span class="koboSpan" id="kobo.452.1">. </span><span class="koboSpan" id="kobo.452.2">After a presentation about how to use </span><code class="inlineCode"><span class="koboSpan" id="kobo.453.1">getopts</span></code><span class="koboSpan" id="kobo.454.1">, we wrapped up with a review of a couple of real-world scripts that use it.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.455.1">In the next chapter, we’ll look at how shell scripting can be a big help to security professionals. </span><span class="koboSpan" id="kobo.455.2">I’ll see you there.</span></p>
    <h1 id="_idParaDest-363" class="heading 1"><span class="koboSpan" id="kobo.456.1">Questions</span></h1>
    <ol>
      <li class="numberedList" value="1"><span class="koboSpan" id="kobo.457.1">Which of the following statements is true?</span><ol>
          <li class="alphabeticList level 2" value="1"><span class="koboSpan" id="kobo.458.1">You should always use </span><code class="inlineCode"><span class="koboSpan" id="kobo.459.1">getopt</span></code><span class="koboSpan" id="kobo.460.1">, because it’s easier to use than </span><code class="inlineCode"><span class="koboSpan" id="kobo.461.1">getopts</span></code><span class="koboSpan" id="kobo.462.1">.</span></li>
          <li class="alphabeticList level 2"><code class="inlineCode"><span class="koboSpan" id="kobo.463.1">getopt</span></code><span class="koboSpan" id="kobo.464.1"> can handle arguments that contain blank spaces, but </span><code class="inlineCode"><span class="koboSpan" id="kobo.465.1">getopts</span></code><span class="koboSpan" id="kobo.466.1"> can’t.</span></li>
          <li class="alphabeticList level 2"><code class="inlineCode"><span class="koboSpan" id="kobo.467.1">getopt</span></code><span class="koboSpan" id="kobo.468.1"> requires you to use one or more shift commands with every option, but </span><code class="inlineCode"><span class="koboSpan" id="kobo.469.1">getopts</span></code><span class="koboSpan" id="kobo.470.1"> doesn’t.</span></li>
          <li class="alphabeticList level 2"><code class="inlineCode"><span class="koboSpan" id="kobo.471.1">getopts</span></code><span class="koboSpan" id="kobo.472.1"> can handle long options, but </span><code class="inlineCode"><span class="koboSpan" id="kobo.473.1">getopt</span></code><span class="koboSpan" id="kobo.474.1"> can’t.</span></li>
        </ol>
      </li>
      <li class="numberedList"><span class="koboSpan" id="kobo.475.1">In this </span><code class="inlineCode"><span class="koboSpan" id="kobo.476.1">while getopts :a:b:c options; do</span></code><span class="koboSpan" id="kobo.477.1"> line, what does the first colon do?</span><ol>
          <li class="alphabeticList level 2" value="1"><span class="koboSpan" id="kobo.478.1">It suppresses error messages from the shell.</span></li>
          <li class="alphabeticList level 2"><span class="koboSpan" id="kobo.479.1">It causes the </span><code class="inlineCode"><span class="koboSpan" id="kobo.480.1">-a</span></code><span class="koboSpan" id="kobo.481.1"> option to require an argument.</span></li>
          <li class="alphabeticList level 2"><span class="koboSpan" id="kobo.482.1">It doesn’t do anything.</span></li>
          <li class="alphabeticList level 2"><span class="koboSpan" id="kobo.483.1">The colons cause the options to be separated from each other.</span></li>
        </ol>
      </li>
      <li class="numberedList"><span class="koboSpan" id="kobo.484.1">You need to create a script that accepts options, options with arguments, and non-option arguments. </span><span class="koboSpan" id="kobo.484.2">Which of the following commands must you insert into the script to make non-option arguments work?</span><ol>
          <li class="alphabeticList level 2" value="1"> <code class="inlineCode"><span class="koboSpan" id="kobo.485.1">shift $(($OPTARG -1))</span></code></li>
          <li class="alphabeticList level 2"><code class="inlineCode"><span class="koboSpan" id="kobo.486.1">shift $(($OPTIND +1))</span></code></li>
          <li class="alphabeticList level 2"><code class="inlineCode"><span class="koboSpan" id="kobo.487.1">shift $(($OPTIND -1))</span></code></li>
          <li class="alphabeticList level 2"><code class="inlineCode"><span class="koboSpan" id="kobo.488.1">shift $(($OPTARG +1))</span></code></li>
        </ol>
      </li>
    </ol>
    <h1 id="_idParaDest-364" class="heading 1"><span class="koboSpan" id="kobo.489.1">Further Reading</span></h1>
    <ul>
      <li class="bulletList"><span class="koboSpan" id="kobo.490.1">Small getopts Tutorial: </span><a href="http://web.archive.org/web/20190509023321/https://wiki.bash-hackers.org/howto/getopts_tutorial"><span class="url"><span class="koboSpan" id="kobo.491.1">http://web.archive.org/web/20190509023321/https://wiki.bash-hackers.org/howto/getopts_tutorial</span></span></a> </li>
      <li class="bulletList"><span class="koboSpan" id="kobo.492.1">How can I handle command-line options and arguments in my script easily?: </span><a href="http://mywiki.wooledge.org/BashFAQ/035"><span class="url"><span class="koboSpan" id="kobo.493.1">http://mywiki.wooledge.org/BashFAQ/035</span></span></a></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.494.1">How to Use OPTARG in Bash: </span><a href="https://linuxsimply.com/bash-scripting-tutorial/functions/script-argument/bash-optarg/"><span class="url"><span class="koboSpan" id="kobo.495.1">https://linuxsimply.com/bash-scripting-tutorial/functions/script-argument/bash-optarg/</span></span></a></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.496.1">A Shell Script to Monitor Network, Disk Usage, Uptime, Load Average and RAM Usage in Linux: </span><a href="https://www.tecmint.com/linux-server-health-monitoring-script/"><span class="url"><span class="koboSpan" id="kobo.497.1">https://www.tecmint.com/linux-server-health-monitoring-script/</span></span></a></li>
    </ul>
    <div class="note one">
      <p class="normal"><span class="koboSpan" id="kobo.498.1">Note: The following links contain extra information about </span><code class="inlineCode"><span class="koboSpan" id="kobo.499.1">OPTIND</span></code><span class="koboSpan" id="kobo.500.1">.</span></p>
    </div>
    <ul>
      <li class="bulletList"><span class="koboSpan" id="kobo.501.1">How to Use getopts to Parse Linux Shellscript Otions: </span><a href="https://www.howtogeek.com/778410/how-to-use-getopts-to-parse-linux-shell-script-options/"><span class="url"><span class="koboSpan" id="kobo.502.1">https://www.howtogeek.com/778410/how-to-use-getopts-to-parse-linux-shell-script-options/</span></span></a></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.503.1">How does the OPTIND variable work in the shell builtin getopts: </span><a href="https://stackoverflow.com/questions/14249931/how-does-the-optind-variable-work-in-the-shell-builtin-getopts"><span class="url"><span class="koboSpan" id="kobo.504.1">https://stackoverflow.com/questions/14249931/how-does-the-optind-variable-work-in-the-shell-builtin-getopts</span></span></a></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.505.1">How to Use “getopts” in Bash: </span><a href="https://linuxsimply.com/bash-scripting-tutorial/functions/script-argument/bash-getopts/"><span class="url"><span class="koboSpan" id="kobo.506.1">https://linuxsimply.com/bash-scripting-tutorial/functions/script-argument/bash-getopts/</span></span></a></li>
    </ul>
    <h1 id="_idParaDest-365" class="heading 1"><span class="koboSpan" id="kobo.507.1">Answers</span></h1>
    <ol>
      <li class="numberedList" value="1"><span class="koboSpan" id="kobo.508.1">c</span></li>
      <li class="numberedList"><span class="koboSpan" id="kobo.509.1">a.</span></li>
      <li class="numberedList"><span class="koboSpan" id="kobo.510.1">c</span></li>
    </ol>
    <h1 id="_idParaDest-366" class="heading 1"><span class="koboSpan" id="kobo.511.1">Join our community on Discord!</span></h1>
    <p class="normal"><span class="koboSpan" id="kobo.512.1">Read this book alongside other users, Linux experts, and the author himself. </span></p>
    <p class="normal"><span class="koboSpan" id="kobo.513.1">Ask questions, provide solutions to other readers, chat with the author via Ask Me Anything sessions, and much more. </span><span class="koboSpan" id="kobo.513.2">Scan the QR code or visit the link to join the community.</span></p>
    <p class="normal"><a href="https://packt.link/SecNet"><span class="url"><span class="koboSpan" id="kobo.514.1">https://packt.link/SecNet</span></span></a></p>
    <p class="normal"><span class="koboSpan" id="kobo.515.1"><img src="../Images/QR_Code10596186092701843.png" alt=""/></span></p>
  </div>
</body></html>