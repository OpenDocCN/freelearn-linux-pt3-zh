<html><head></head><body>
<div class="_idGenObjectStyleOverride-1" id="_idContainer237">
<p class="Chapter-Title" id="_idParaDest-160" lang="en-US"><span class="ChapterMarker"><span class="koboSpan" id="kobo.1.1">17. </span></span><a id="_idTextAnchor281"/><span class="koboSpan" id="kobo.2.1">Configuring SSH Key-based Authentication on Ubuntu 23.04</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.3.1">When an Ubuntu system is first installed, it is configured by default to allow remote command-line access via Secure Shell (SSH) connections. </span><span class="koboSpan" id="kobo.3.2">SSH provides password-protected and encrypted access to the system for the root account and any other users added during the installation phase. </span><span class="koboSpan" id="kobo.3.3">However, this level of security is inadequate and should be upgraded to SSH key-based authentication as soon as possible.</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.4.1">This chapter will outline the steps to increase the security of an Ubuntu system by implementing key-based SSH authentication.</span></p>
<p class="Heading-1-1" id="_idParaDest-161" lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.5.1">17.1 </span></span><a id="_idTextAnchor282"/><span class="koboSpan" id="kobo.6.1">An Overview of </span><a id="_idIndexMarker404"/><span class="koboSpan" id="kobo.7.1">Secure Shell (</span><a id="_idIndexMarker405"/><span class="koboSpan" id="kobo.8.1">SSH)</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.9.1">SSH allows secure remote access to systems to gain shell access and transfer files and data. </span><span class="koboSpan" id="kobo.9.2">A basic SSH configuration consists of a client (used on the computer establishing the connection) and a server (running on the system to which the connection is to be established). </span><span class="koboSpan" id="kobo.9.3">A user might, for example, use an SSH client running on a Linux, Windows, or macOS system to connect to the SSH server running on an Ubuntu system to gain access to a shell command-line prompt or to perform file transfers. </span><span class="koboSpan" id="kobo.9.4">All communications between the client and server, including the password entered to gain access, are encrypted to prevent outside parties from intercepting the data. </span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.10.1">The inherent weakness in a basic SSH implementation is that it depends entirely on the strength of the passwords assigned to the accounts on the system. </span><span class="koboSpan" id="kobo.10.2">If a malicious party is able to identify the password for an account (either through guesswork, deception, or a brute force attack), the system becomes vulnerable. </span><span class="koboSpan" id="kobo.10.3">This weakness can be addressed by implementing SSH key-based authentication.</span></p>
<p class="Heading-1-1" id="_idParaDest-162" lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.11.1">17.2 </span></span><a id="_idTextAnchor283"/><span class="koboSpan" id="kobo.12.1">SSH Key-based Authentication</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.13.1">SSH key-based authentication uses asymmetric public key encryption to add an extra layer of security to remote system access. </span><span class="koboSpan" id="kobo.13.2">The concept of</span><a id="_idIndexMarker406"/><span class="koboSpan" id="kobo.14.1"> public key encryption was devised in 1975 by </span><a id="_idIndexMarker407"/><span class="koboSpan" id="kobo.15.1">Whitfield Diffie and </span><a id="_idIndexMarker408"/><span class="koboSpan" id="kobo.16.1">Martin Hellman and is based on using a pair of private and public keys.</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.17.1">In a public key encryption system, the </span><a id="_idIndexMarker409"/><span class="koboSpan" id="kobo.18.1">public key is used to encrypt data that can only be decrypted by the owner of the </span><a id="_idIndexMarker410"/><span class="koboSpan" id="kobo.19.1">private key.</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.20.1">In the case of SSH key-based authentication, the host holds the private key on which the SSH client is located, while the corresponding public key resides on the system on which the SSH server is running. </span><span class="koboSpan" id="kobo.20.2">Therefore, it is vital to protect the private key since ownership of the key will allow anyone to log into the remote system. </span><span class="koboSpan" id="kobo.20.3">As an added layer of protection, the private key may also be encrypted and protected by a password which must be entered each time a connection is established to the server.</span></p>
<p class="Heading-1-1" id="_idParaDest-163" lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.21.1">17.3 </span></span><a id="_idTextAnchor284"/><span class="koboSpan" id="kobo.22.1">Setting Up Key-based Authentication</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.23.1">There are four steps to setting up key-based SSH authentication, which can be summarized as follows:</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.24.1">1. </span><span class="koboSpan" id="kobo.24.2">Generate the public and private keys.</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.25.1">2. </span><span class="koboSpan" id="kobo.25.2">Install the public key on the server.</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.26.1">3. </span><span class="koboSpan" id="kobo.26.2">Test authentication.</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.27.1">4. </span><span class="koboSpan" id="kobo.27.2">Disable password-based authentication on the server.</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.28.1">The remainder of this chapter will outline these steps in greater detail for Linux, macOS, and Windows-based client operating systems.</span></p>
<p class="Heading-1-1" id="_idParaDest-164" lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.29.1">17.4 </span></span><a id="_idTextAnchor285"/><span class="koboSpan" id="kobo.30.1">Installing and Starting the </span><a id="_idIndexMarker411"/><a id="_idIndexMarker412"/><span class="koboSpan" id="kobo.31.1">SSH Service</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.32.1">If the SSH server is not already installed and running on the system, it can be added using the following commands:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.33.1"># apt install openssh-server</span></p>
<p class="Code"><span class="koboSpan" id="kobo.34.1"># systemctl start ssh.service</span></p>
<p class="Code"><span class="koboSpan" id="kobo.35.1"># systemctl enable ssh.service</span></p>
<p class="Heading-1-1" id="_idParaDest-165" lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.36.1">17.5 </span></span><a id="_idTextAnchor286"/><span class="koboSpan" id="kobo.37.1">SSH Key-based Authentication from Linux and macOS Clients</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.38.1">The first step in setting up SSH key-based authentication is to generate the key pairs on the client system. </span><span class="koboSpan" id="kobo.38.2">If the client system is running Linux or macOS, this is achieved using the </span><a id="_idIndexMarker413"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.39.1">ssh-keygen </span></span><span class="koboSpan" id="kobo.40.1">utility:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.41.1"># ssh-keygen</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.42.1">This command will result in output similar to the following:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.43.1">Generating public/private rsa key pair.</span></p>
<p class="Code"><span class="koboSpan" id="kobo.44.1">Enter file in which to save the key (/home/&lt;username&gt;/.ssh/id_rsa):</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.45.1">Press the Enter key to accept the default location for the key files. </span><span class="koboSpan" id="kobo.45.2">This will place two files in the </span><a id="_idIndexMarker414"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.46.1">.ssh</span></span><span class="koboSpan" id="kobo.47.1"> sub-directory of the current user’s home directory. </span><span class="koboSpan" id="kobo.47.2">The private key will be stored in a file named </span><a id="_idIndexMarker415"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.48.1">id_rsa</span></span><span class="koboSpan" id="kobo.49.1"> while the public key will reside in the file named </span><a id="_idIndexMarker416"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.50.1">id_rsa.pub</span></span><span class="koboSpan" id="kobo.51.1">.</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.52.1">Next, </span><a id="_idIndexMarker417"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.53.1">ssh-keygen</span></span><span class="koboSpan" id="kobo.54.1"> will prompt for a passphrase with which to protect the private key. </span><span class="koboSpan" id="kobo.54.2">If a passphrase is provided, the private key will be encrypted on the local disk, and the passphrase will be required to access the remote system. </span><span class="koboSpan" id="kobo.54.3">Therefore, for better security, the use of a passphrase is recommended.</span></p>
<p class="Code"><span class="koboSpan" id="kobo.55.1">Enter passphrase (empty for no passphrase):</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.56.1">Finally, the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.57.1">ssh-keygen </span></span><span class="koboSpan" id="kobo.58.1">tool will generate the following output indicating that the keys have been generated:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.59.1">Your identification has been saved in /home/neil/.ssh/id_rsa.</span></p>
<p class="Code"><span class="koboSpan" id="kobo.60.1">Your public key has been saved in /home/neil/.ssh/id_rsa.pub.</span></p>
<p class="Code"><span class="koboSpan" id="kobo.61.1">The key fingerprint is:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.62.1">SHA256:FOLGWEEGFIjWnCT5wtTOv5VK4hdimzWghZizUEMYbfo &lt;username&gt;@&lt;hostname&gt;</span></p>
<p class="Code"><span class="koboSpan" id="kobo.63.1">The key’s randomart image is:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.64.1">+---[RSA 2048]----+</span></p>
<p class="Code"><span class="koboSpan" id="kobo.65.1">|.BB+=+*..        </span><span class="koboSpan" id="kobo.65.2">|</span></p>
<p class="Code"><span class="koboSpan" id="kobo.66.1">|o+B= * . </span><span class="koboSpan" id="kobo.66.2">.       </span><span class="koboSpan" id="kobo.66.3">|</span></p>
<p class="Code"><span class="koboSpan" id="kobo.67.1">|===.. </span><span class="koboSpan" id="kobo.67.2">+ .        </span><span class="koboSpan" id="kobo.67.3">|</span></p>
<p class="Code"><span class="koboSpan" id="kobo.68.1">|*+ * . </span><span class="koboSpan" id="kobo.68.2">.         </span><span class="koboSpan" id="kobo.68.3">|</span></p>
<p class="Code"><span class="koboSpan" id="kobo.69.1">|.++ o   S        |</span></p>
<p class="Code"><span class="koboSpan" id="kobo.70.1">|..E+ * o         |</span></p>
<p class="Code"><span class="koboSpan" id="kobo.71.1">|  o B *          |</span></p>
<p class="Code"><span class="koboSpan" id="kobo.72.1">|   + +           |</span></p>
<p class="Code"><span class="koboSpan" id="kobo.73.1">|    .            </span><span class="koboSpan" id="kobo.73.2">|</span></p>
<p class="Code"><span class="koboSpan" id="kobo.74.1">+----[SHA256]-----+</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.75.1">The next step is to install the public key onto the remote server system. </span><span class="koboSpan" id="kobo.75.2">This can be achieved using the </span><a id="_idIndexMarker418"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.76.1">ssh-copy-id</span></span><span class="koboSpan" id="kobo.77.1"> utility as follows:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.78.1">$ ssh-copy-id username@remote_hostname</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.79.1">For example:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.80.1">$ ssh-copy-id neil@192.168.1.100</span></p>
<p class="Code"><span class="koboSpan" id="kobo.81.1">/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: "/home/neil/.ssh/id_rsa.pub"</span></p>
<p class="Code"><span class="koboSpan" id="kobo.82.1">/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed</span></p>
<p class="Code"><span class="koboSpan" id="kobo.83.1">/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys</span></p>
<p class="Code"><span class="koboSpan" id="kobo.84.1">neil@192.168.1.100’s password: </span></p>
<p class="Code"><span class="koboSpan" id="kobo.85.1"> </span></p>
<p class="Code"><span class="koboSpan" id="kobo.86.1">Number of key(s) added: 1</span></p>
<p class="Code"><span class="koboSpan" id="kobo.87.1"> </span></p>
<p class="Code"><span class="koboSpan" id="kobo.88.1">Now try logging into the machine, with:   "ssh 'neil@192.168.1.100'"</span></p>
<p class="Code"><span class="koboSpan" id="kobo.89.1">and check to make sure that only the key(s) you wanted were added.</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.90.1">Once the key is installed, test that the authentication works by attempting a remote login using the </span><a id="_idIndexMarker419"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.91.1">ssh</span></span><span class="koboSpan" id="kobo.92.1"> client:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.93.1">$ ssh -l &lt;username&gt; &lt;hostname&gt;</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.94.1">If the private key is encrypted and protected with a passphrase, enter the phrase when prompted to complete the authentication and establish remote access to the Ubuntu system:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.95.1">Enter passphrase for key '/home/neil/.ssh/id_rsa': </span></p>
<p class="Code"><span class="koboSpan" id="kobo.96.1">Last login: Fri Mar 31 14:29:28 2023 from 192.168.86.21</span></p>
<p class="Code"><span class="koboSpan" id="kobo.97.1">[neil@demosystem02 ~]$</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.98.1">Repeat these steps for any other accounts on the server for which remote access is required. </span><span class="koboSpan" id="kobo.98.2">If access is also required from other client systems, copy the </span><a id="_idIndexMarker420"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.99.1">id_rsa</span></span><span class="koboSpan" id="kobo.100.1"> private key file to the </span><a id="_idIndexMarker421"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.101.1">.ssh </span></span><span class="koboSpan" id="kobo.102.1">sub-directory of your home folder on the other systems.</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.103.1">As currently configured, access to the remote system can still be achieved using less secure password authentication. </span><span class="koboSpan" id="kobo.103.2">Once you have verified that key-based authentication works, password authentication will need to be disabled on the system. </span><span class="koboSpan" id="kobo.103.3">To understand how to change this setting, begin by opening the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.104.1">/etc/ssh/</span></span><span class="My-Italic CharOverride-1"><a id="_idIndexMarker422"/></span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.105.1">sshd_config</span></span><span class="koboSpan" id="kobo.106.1"> file and locating the following line:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.107.1">Include /etc/ssh/sshd_config.d/*.conf</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.108.1">This tells us that sshd configuration settings are controlled by files in the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.109.1">/etc/ssh/</span></span><span class="My-Italic CharOverride-1"><a id="_idIndexMarker423"/></span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.110.1">sshd_config.d </span></span><span class="koboSpan" id="kobo.111.1">directory. </span><span class="koboSpan" id="kobo.111.2">These filenames must be prefixed with a number and have a </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.112.1">.conf </span></span><span class="koboSpan" id="kobo.113.1">filename extension, for example:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.114.1">01-permitrootlogin.conf  </span></p>
<p class="Code"><span class="koboSpan" id="kobo.115.1">50-cloud.conf</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.116.1">The number prefix designates the priority assigned to the file relative to the other files in the folder, with 01 being the highest priority. </span><span class="koboSpan" id="kobo.116.2">This ensures that if a configuration file contains a setting conflicting with another file, the one with the highest priority will always take precedence. </span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.117.1">Within the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.118.1">/etc/ssh/sshd_config.d</span></span><span class="koboSpan" id="kobo.119.1"> folder, create a new file named </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.120.1">02-nopasswordlogin.conf</span></span><span class="koboSpan" id="kobo.121.1"> with content that reads as follows:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.122.1">PasswordAuthentication no</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.123.1">Save the file and restart the </span><a id="_idIndexMarker424"/><span class="koboSpan" id="kobo.124.1">sshd service to implement the change:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.125.1"># systemctl restart sshd.service</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.126.1">From this point on, it will only be possible to remotely access the system using SSH key-based authentication, and when doing so, you won’t be required to enter a password.</span></p>
<p class="Heading-1-1" id="_idParaDest-166" lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.127.1">17.6 </span></span><a id="_idTextAnchor287"/><span class="koboSpan" id="kobo.128.1">Managing </span><a id="_idIndexMarker425"/><span class="koboSpan" id="kobo.129.1">Multiple Keys</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.130.1">It is common for multiple private keys to reside on a client system, each providing access to a different server. </span><span class="koboSpan" id="kobo.130.2">As a result, several options exist for selecting a specific key when establishing a connection. </span><span class="koboSpan" id="kobo.130.3">It is possible, for example, to specify the private key file to be used when launching the ssh client as follows:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.131.1">$ ssh -l neilsmyth -i ~/.ssh/id_work 35.194.18.119</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.132.1">Alternatively, the SSH client user configuration file may associate key files with servers. </span><span class="koboSpan" id="kobo.132.2">The configuration file is named config, must reside in the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.133.1">.ssh</span></span><span class="koboSpan" id="kobo.134.1"> directory of the user’s home directory, and can be used to configure a wide range of options, including the private key file, the default port to use when connecting, the default user name, and an abbreviated nickname via which to reference the server. </span><span class="koboSpan" id="kobo.134.2">The following example config file defines different key files for two servers and allows them to be referenced by the nicknames home and work. </span><span class="koboSpan" id="kobo.134.3">In the case of the work system, the file also specifies the user name to be used when authenticating:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.135.1">Host work</span></p>
<p class="Code"><span class="koboSpan" id="kobo.136.1">  HostName 35.194.18.119</span></p>
<p class="Code"><span class="koboSpan" id="kobo.137.1">  IdentityFile ~/.ssh/id_work</span></p>
<p class="Code"><span class="koboSpan" id="kobo.138.1">  User neilsmyth</span></p>
<p class="Code"><span class="koboSpan" id="kobo.139.1"> </span></p>
<p class="Code"><span class="koboSpan" id="kobo.140.1">Host home</span></p>
<p class="Code"><span class="koboSpan" id="kobo.141.1">  HostName 192.168.0.21</span></p>
<p class="Code"><span class="koboSpan" id="kobo.142.1">  IdentityFile ~/.ssh/id_home</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.143.1">Before setting up the configuration file, the user would have used the following command to connect to the work system:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.144.1">$ ssh -l neilsmyth -i ~/.ssh/id_work 35.194.18.119</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.145.1">Now, however, the command can be shortened as follows:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.146.1">$ ssh work</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.147.1">A full listing of configuration file options can be found by running the following command:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.148.1">$ man ssh_config</span></p>
<p class="Heading-1-1" id="_idParaDest-167" lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.149.1">17.7 </span></span><a id="_idTextAnchor288"/><a id="_idIndexMarker426"/><span class="koboSpan" id="kobo.150.1">SSH Key-based Authentication from Windows Clients</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.151.1">Recent releases of Windows include a subset of the OpenSSH implementation used by most Linux and macOS systems as part of </span><a id="_idIndexMarker427"/><a id="_idIndexMarker428"/><span class="koboSpan" id="kobo.152.1">Windows </span><a id="_idIndexMarker429"/><span class="koboSpan" id="kobo.153.1">PowerShell. </span><span class="koboSpan" id="kobo.153.2">This allows SSH key-based authentication to be set up from a Windows client using similar steps to those outlined above for Linux and macOS.</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.154.1">On Windows, search for Windows PowerShell and select it from the results. </span><span class="koboSpan" id="kobo.154.2">Once running, the PowerShell window will appear, as shown in </span><a href="SSH_Authentication.xhtml#_idTextAnchor289"><span class="koboSpan" id="kobo.155.1">Figure 17-1</span></a><span class="koboSpan" id="kobo.156.1">:</span></p>
<p class="My-Basic-Paragraph ParaOverride-1" lang="en-US"><span class="koboSpan" id="kobo.157.1"><img alt="" class="_idGenObjectAttribute-1" src="image/windows_powershell.jpg"/></span></p>
<p class="Figure-Caption" lang="en-US"><span class="FigureCaptionMarker"><span class="koboSpan" id="kobo.158.1">Figure 17-1</span></span><a id="_idTextAnchor289"/></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.159.1">If you already have a private key from another client system, copy the</span><span class="My-Italic _idGenCharOverride-1"> </span><span class="My-Italic CharOverride-1"><a id="_idIndexMarker430"/></span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.160.1">id_rsa</span></span><span class="koboSpan" id="kobo.161.1"> file to a folder named </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.162.1">.ssh</span></span><span class="koboSpan" id="kobo.163.1"> on the Windows system. </span><span class="koboSpan" id="kobo.163.2">Once the file is in place, test the authentication within the PowerShell window as follows:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.164.1">$ ssh -l &lt;username&gt;@&lt;hostname&gt;</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.165.1">For example:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.166.1">PS C:\Users\neil&gt; ssh -l neil 192.168.1.101</span></p>
<p class="Code"><span class="koboSpan" id="kobo.167.1">Enter passphrase for key 'C:\Users\neil\.ssh\id_rsa':</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.168.1">Enter the passphrase when prompted and complete the authentication process.</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.169.1">If the private key does not yet exist, generate a new private and public key pair within the PowerShell window using the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.170.1">ssh-keygen</span></span><span class="koboSpan" id="kobo.171.1"> utility using the same steps outlined for Linux and macOS. </span><span class="koboSpan" id="kobo.171.2">Once the keys have been generated, they will again be located in the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.172.1">.ssh</span></span><span class="koboSpan" id="kobo.173.1"> directory of the current user’s home folder, and the public key file </span><a id="_idIndexMarker431"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.174.1">id_rsa.pub </span></span><span class="koboSpan" id="kobo.175.1">will need to be installed on the remote Ubuntu system. </span><span class="koboSpan" id="kobo.175.2">Unfortunately, Windows PowerShell does not include the </span><a id="_idIndexMarker432"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.176.1">ssh-copy-id</span></span><span class="koboSpan" id="kobo.177.1"> utility, so this task must be performed manually.</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.178.1">Within the PowerShell window, change directory into the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.179.1">.ssh</span></span><span class="koboSpan" id="kobo.180.1"> sub-directory and display the content of the public key</span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.181.1"> id_rsa.pub</span></span><span class="koboSpan" id="kobo.182.1"> file:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.183.1">PS C:\Users\neil&gt; cd .ssh</span></p>
<p class="Code"><span class="koboSpan" id="kobo.184.1">PS C:\Users\neil\.ssh&gt; type id_rsa.pub</span></p>
<p class="Code"><span class="koboSpan" id="kobo.185.1">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDFgx1vzu59lll6/uQw7FbmKVsQ3fzLz9MW1fgo4sdsxXp81wCHNAlqcjx1Pgr9BJPXWUMInQOi7BQ5I+vc2xQ2AS0kMq3ZH9ybWuQe/U2GjueXZd0FKrEXrT55wM36Rm6Ii3roUCoGCzGR8mn95JvRB3VtCyDdzTWSi8JBpK5gV5oOxNTNPsewlLzouBlCT1qW3CKwEiIwu8S9MTL7m3nrcaNeLewTTHevvHw4QDwzFQ+B0PDg96fzsYoTXVhzyHSWyo6H0gqrft7aK+gILBtEIhWTkSVEMAzy1piKtCr1IYTmVK6engv0aoGtMUq6FnOeGp5FjvKkF4aQkh1QR28r neil@DESKTOP-S8P8D3N</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.186.1">Highlight the file’s content and copy it using the Ctrl-C keyboard shortcut. </span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.187.1">Remaining within the PowerShell window, log into the remote system using password authentication:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.188.1">PS C:\Users\neil\.ssh&gt; ssh -l &lt;username&gt; &lt;hostname&gt;</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.189.1">Once signed in, check if the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.190.1">.ssh</span></span><span class="koboSpan" id="kobo.191.1"> sub-directory exists. </span><span class="koboSpan" id="kobo.191.2">If it does not, create it as follows:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.192.1">$ mkdir .ssh</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.193.1">Change directory into </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.194.1">.ssh</span></span><span class="koboSpan" id="kobo.195.1"> and check whether a file named </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.196.1">authorized_keys</span></span><span class="koboSpan" id="kobo.197.1"> already exists. </span><span class="koboSpan" id="kobo.197.2">If it does not, create it and paste the content of the public key file from the Windows system into it. </span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.198.1">If the </span><a id="_idIndexMarker433"/><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.199.1">authorized_keys</span></span><span class="koboSpan" id="kobo.200.1"> file already exists, it likely contains other keys. </span><span class="koboSpan" id="kobo.200.2">If this is the case, edit the file and paste the new public key at the end of the file. </span><span class="koboSpan" id="kobo.200.3">The following file, for example, contains two keys:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.201.1">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCzRWH27Xs8ZA5rIbZXKgxFY5XXauMv+6F5PljBLJ6j+9nkmykVe3GjZTp3oD+KMRbT2kTEPbDpFD67DNL0eiX2ZuEEiYsxZfGCRCPBGYmQttFRHEAFnlS1Jx/G4W5UNKvhAXWyMwDEKiWvqTVy6syB2Ritoak+D/Sc8nJflQ6dtw0jBs+S7Aim8TPfgpi4p5XJGruXNRScamk68NgnPfTL3vT726EuABCk6C934KARd+/AXa8/5rNOh4ETPstjBRfFJ0tpmsWWhhNEnwJRqS2LD0ug7E3yFI2qsNKGEzvAYUC8Up45MRP7liR3aMlCBil1tsy9R+IB7oMEycZAe/qj neil@localhost.localdomain</span></p>
<p class="Code"><span class="koboSpan" id="kobo.202.1">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDFgx1vzu59lll6/uQw7FbmKVsQ3fzLz9MW1fgo4sdsxXp81wCHNAlqcjx1Pgr9BJPXWUMInQOi7BQ5I+vc2xQ2AS0kMq3ZH9ybWuQe/U2GjueXZd0FKrEXrT55wM36Rm6Ii3roUCoGCzGR8mn95JvRB3VtCyDdzTWSi8JBpK5gV5oOxNTNPsewlLzouBlCT1qW3CKwEiIwu8S9MTL7m3nrcaNeLewTTHevvHw4QDwzFQ+B0PDg96fzsYoTXVhzyHSWyo6H0gqrft7aK+gILBtEIhWTkSVEMAzy1piKtCr1IYTmVK6engv0aoGtMUq6FnOeGp5FjvKkF4aQkh1QR28r neil@DESKTOP-S8P8D3N</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.203.1">Once the public key is installed on the server, test the authentication by logging in to the server from within the PowerShell window, for example:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.204.1">PS C:\Users\neil\.ssh&gt; ssh -l neil 192.168.1.100</span></p>
<p class="Code"><span class="koboSpan" id="kobo.205.1">Enter passphrase for key 'C:\Users\neil\.ssh\id_rsa':</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.206.1">When key-based authentication has been set up for all the accounts and verified, disable password authentication on the Ubuntu system as outlined at the end of the previous section.</span></p>
<p class="Heading-1-1" id="_idParaDest-168" lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.207.1">17.8 </span></span><a id="_idTextAnchor290"/><span class="koboSpan" id="kobo.208.1">SSH Key-based Authentication using </span><a id="_idIndexMarker434"/><span class="koboSpan" id="kobo.209.1">PuTTY</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.210.1">For Windows systems that do not have OpenSSH available or as a more flexible alternative to using PowerShell, the PuTTY tool is a widely used alternative. </span><span class="koboSpan" id="kobo.210.2">The first step in using PuTTY is downloading and installing it on any Windows system that needs an SSH client. </span><span class="koboSpan" id="kobo.210.3">PuTTY is a free utility and can be downloaded using the following link:</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><a href="https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html"><span class="Hyperlink _idGenCharOverride-1"><span class="koboSpan" id="kobo.211.1">https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html</span></span></a></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.212.1">Download the Windows installer executable that matches your Windows system (32-bit and 64-bit versions are available), then execute the installer to complete the installation.</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.213.1">If a private key already exists on another system, create the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.214.1">.ssh</span></span><span class="koboSpan" id="kobo.215.1"> folder in the current user’s home folder and copy the private</span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.216.1"> id_rsa</span></span><span class="koboSpan" id="kobo.217.1"> key into it.</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.218.1">Next, the private key file needs to be converted to a PuTTY private key format file using the </span><a id="_idIndexMarker435"/><span class="koboSpan" id="kobo.219.1">PuTTYgen tool. </span><span class="koboSpan" id="kobo.219.2">Locate this utility by typing “</span><a id="_idIndexMarker436"/><span class="koboSpan" id="kobo.220.1">PuTTY Key Generator” into the search bar of the Windows Start menu and launch it:</span></p>
<p class="My-Basic-Paragraph ParaOverride-1" lang="en-US"><span class="koboSpan" id="kobo.221.1"><img alt="" class="_idGenObjectAttribute-2" src="image/putty_key_generator.jpg"/></span></p>
<p class="Figure-Caption" lang="en-US"><span class="FigureCaptionMarker"><span class="koboSpan" id="kobo.222.1">Figure 17-2</span></span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.223.1">Once launched, click on the Load button located in the Actions section and navigate to the private key file previously copied to the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.224.1">.ssh</span></span><span class="koboSpan" id="kobo.225.1"> folder (note that it may be necessary to change the file type filter to All Files (*.*) for the key file to be visible). </span><span class="koboSpan" id="kobo.225.2">Once located, select the file and load it into PuttyGen. </span><span class="koboSpan" id="kobo.225.3">When prompted, enter the passphrase used initially to encrypt the file. </span><span class="koboSpan" id="kobo.225.4">Once the private key has been imported, save it as a PuTTY key file by clicking the Save Private Key button. </span><span class="koboSpan" id="kobo.225.5">For consistency, save the key file to the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.226.1">.ssh</span></span><span class="koboSpan" id="kobo.227.1"> folder but give it a different name to differentiate it from the original key file.</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.228.1">Launch PuTTY from the Start menu and enter the IP address or hostname of the remote server into the main screen before selecting the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.229.1">Connection -&gt; SSH -&gt; Auth -&gt; Credentials</span></span><span class="koboSpan" id="kobo.230.1"> category in the left-hand panel, as highlighted in </span><a href="SSH_Authentication.xhtml#_idTextAnchor291"><span class="koboSpan" id="kobo.231.1">Figure 17-3</span></a><span class="koboSpan" id="kobo.232.1">:</span></p>
<p class="My-Basic-Paragraph ParaOverride-1" lang="en-US"><span class="koboSpan" id="kobo.233.1"><img alt="" class="_idGenObjectAttribute-3" src="image/putty_credentials.jpg"/></span></p>
<p class="Figure-Caption" lang="en-US"><span class="FigureCaptionMarker"><span class="koboSpan" id="kobo.234.1">Figure 17-3</span></span><a id="_idTextAnchor291"/></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.235.1">Click the Browse button next to the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.236.1">Private key for authentication</span></span><span class="koboSpan" id="kobo.237.1"> field and navigate to and select the previously saved PuTTY private key file. </span><span class="koboSpan" id="kobo.237.2">Then, optionally, scroll to the top of the left-hand panel, select the Session entry, and enter a name for the session in the Saved Sessions field before clicking on the Save button. </span><span class="koboSpan" id="kobo.237.3">This will save the session configuration for future use without re-entering the settings each time.</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.238.1">Finally, click on the Open button to establish the connection to the remote server, entering the user name and passphrase when prompted to do so to complete the authentication.</span></p>
<p class="Heading-1-1" id="_idParaDest-169" lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.239.1">17.9 </span></span><a id="_idTextAnchor292"/><span class="koboSpan" id="kobo.240.1">Generating a Private Key with PuTTYgen</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.241.1">The previous section explored using existing private and public keys when working with PuTTY. </span><span class="koboSpan" id="kobo.241.2">If keys do not exist, they can be created using the PuTTYgen tool, which is included in the main PuTTY installation. </span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.242.1">To create new keys, launch PuttyGen and click on the Generate button highlighted in </span><a href="SSH_Authentication.xhtml#_idTextAnchor293"><span class="koboSpan" id="kobo.243.1">Figure 17-4</span></a><span class="koboSpan" id="kobo.244.1">:</span></p>
<p class="My-Basic-Paragraph ParaOverride-1" lang="en-US"><span class="koboSpan" id="kobo.245.1"><img alt="" class="_idGenObjectAttribute-4" src="image/putty_key_generator_generate.jpg"/></span></p>
<p class="Figure-Caption" lang="en-US"><span class="FigureCaptionMarker"><span class="koboSpan" id="kobo.246.1">Figure 17-4</span></span><a id="_idTextAnchor293"/></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.247.1">Move the mouse pointer to generate random data as instructed, then enter an optional passphrase to encrypt the private key. </span><span class="koboSpan" id="kobo.247.2">Once the keys have been generated, save the files to suitable locations using the Save public key and Save private key buttons. </span><span class="koboSpan" id="kobo.247.3">As outlined in the previous section, the private key can be used with PuTTY. </span><span class="koboSpan" id="kobo.247.4">To install the public key on the remote server, use the steps covered in the earlier section on SSH within PowerShell on Windows.</span></p>
<p class="Heading-1-1" id="_idParaDest-170" lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.248.1">17.10 </span></span><a id="_idTextAnchor294"/><span class="koboSpan" id="kobo.249.1">Summary</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.250.1">Any remote access to an Ubuntu system must be implemented in a way that provides a high level of security. </span><span class="koboSpan" id="kobo.250.2">By default, SSH allows remote system access using password-based authentication. </span><span class="koboSpan" id="kobo.250.3">However, this leaves the system vulnerable to anyone who can guess a password or find out the password through other means. </span><span class="koboSpan" id="kobo.250.4">For this reason, key-based authentication is recommended to protect system access. </span><span class="koboSpan" id="kobo.250.5">Key-based authentication uses public key encryption involving public and private keys. </span><span class="koboSpan" id="kobo.250.6">When implemented, users can only connect to a server if they are using a client with a private key that matches a public key on the server. </span><span class="koboSpan" id="kobo.250.7">As an added layer of security, the private key may also be encrypted and password protected. </span><span class="koboSpan" id="kobo.250.8">Once key-based encryption has been implemented, the server system is configured to disable support for the less secure password-based authentication.</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.251.1">This chapter has provided an overview of SSH key-based authentication and outlined the steps involved in generating keys and configuring clients on macOS, Linux, and Windows, as well as installing and managing public keys on an Ubuntu server.</span></p>
</div>
</body></html>