<html><head></head><body><div id="sbo-rt-content"><div id="_idContainer145">
			<h1 id="_idParaDest-103"><em class="italic"><a id="_idTextAnchor105"/>Chapter 5</em>: Using Commands for File, Directory, and Service Management</h1>
			<p>When working with files and folders, <strong class="bold">CLI</strong> is the most common way. It doesn't really matter if we're copying or moving content around, finding content, configuring file and folder security, or doing some basic text-based work – it's all about the command line. When we expand on that model, we usually start using archiving and compression to be more space-efficient. In terms of services, we need to learn some basics of how to manage them, which is commonly done by using the <strong class="source-inline">systemctl</strong> command. This is exactly what we're going to cover in this chapter, by covering the following recipes:</p>
			<ul>
				<li>Basic file and directory-based commands</li>
				<li>Additional commands for manipulating file/directory security aspects</li>
				<li>Finding files and folders</li>
				<li>Manipulating text files by using commands</li>
				<li>Archiving and compressing files and folders</li>
				<li>Managing services and targets</li>
			</ul>
			<h1 id="_idParaDest-104"><a id="_idTextAnchor106"/>Technical requirements </h1>
			<p>For these recipes, we're going to use one Linux machine – in our case, let's use <strong class="source-inline">cli1</strong>. We just need to make sure that it's powered on.</p>
			<h1 id="_idParaDest-105"><a id="_idTextAnchor107"/>Basic file and directory-based commands</h1>
			<p>Let's discuss various shell commands<a id="_idIndexMarker275"/> that can be used to work with files and directories. In a nutshell, what we're interested<a id="_idIndexMarker276"/> in are these commands:</p>
			<ul>
				<li><strong class="source-inline">ls</strong> – for listing folder contents</li>
				<li><strong class="source-inline">touch</strong> – for creating an empty text file</li>
				<li><strong class="source-inline">cd</strong> – for changing directories, both in absolute and relative terms</li>
				<li><strong class="source-inline">pwd</strong> – for showing the current directory</li>
				<li><strong class="source-inline">mkdir</strong> and <strong class="source-inline">rm</strong> – for creating and deleting a file or directory</li>
				<li><strong class="source-inline">cp</strong> and <strong class="source-inline">mv</strong> – for copying or moving a file or a directory</li>
				<li><strong class="source-inline">ln</strong> – for working with soft and hard links</li>
			</ul>
			<p>These commands are some of the most frequently used commands in the everyday life of a system administrator/engineer. Let's see what they are all about.</p>
			<h2 id="_idParaDest-106"><a id="_idTextAnchor108"/>Getting ready</h2>
			<p>We need to go through these commands to really understand what happens on the filesystem as we execute them. So, let's make sure that our <strong class="source-inline">cli1</strong> machine is running and let's do it!</p>
			<h2 id="_idParaDest-107"><a id="_idTextAnchor109"/>How to do it…</h2>
			<p>Starting with the simplest command of them all, <strong class="source-inline">ls</strong>, it's all about checking the content of a folder. So, if we want to check the content of a directory in a nice, readable format, we can do it like this:</p>
			<div>
				<div id="_idContainer124" class="IMG---Figure">
					<img src="Images/Figure_5.1_B16269.jpg" alt="Figure 5.1 – Using ls with the most common options&#13;&#10;" width="1212" height="768"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.1<a id="_idTextAnchor110"/> – Using ls with the most common options</p>
			<p>The <em class="italic">nice, readable</em> part is achieved by using <strong class="source-inline">-la</strong> options, where the <strong class="source-inline">l</strong> option stands for <em class="italic">long listing</em>, and the <strong class="source-inline">a</strong> option stands for <em class="italic">all files (including the ones starting with a dot)</em>. We can also<a id="_idIndexMarker277"/> see that, by default, the <strong class="source-inline">ls</strong> command colors<a id="_idIndexMarker278"/> its output. For example, folders are colored blue, while files marked in red are archive files (in this case, the <strong class="source-inline">tar.gz</strong> file). We will go into more detail regarding archive files a bit later, when we start dealing with archiving and compressing files and folders later in this chapter. There are other colors that <strong class="source-inline">ls</strong> uses in its default output. Here are a couple of examples:</p>
			<ul>
				<li>Green – executable file</li>
				<li>Cyan – symbolic link</li>
				<li>Red with black background – broken link</li>
			</ul>
			<p>The <strong class="source-inline">ls</strong> command can be used in a <strong class="bold">recursive</strong> mode, which means starting to list the content of a folder<a id="_idIndexMarker279"/> from that folder onward<a id="_idIndexMarker280"/> and going into all its subfolders. Here's an example of that, by using a common system directory in Ubuntu called <strong class="source-inline">/etc/network</strong>, and its recursive option (capital letter <strong class="source-inline">R</strong>):</p>
			<div>
				<div id="_idContainer125" class="IMG---Figure">
					<img src="Images/Figure_5.2_B16269.jpg" alt="Figure 5.2 – Using ls in recursive mode&#13;&#10;" width="1068" height="1019"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.2 – Using ls in recursive mode</p>
			<p>By using the <strong class="source-inline">R</strong> option, we instructed the <strong class="source-inline">ls</strong> command to do its job in recursive mode. </p>
			<p>We can also use <strong class="source-inline">ls</strong> to display<a id="_idIndexMarker281"/> the content of the folder and sort the output by using<a id="_idIndexMarker282"/> the last modified time:</p>
			<div>
				<div id="_idContainer126" class="IMG---Figure">
					<img src="Images/Figure_5.3_B16269.jpg" alt="Figure 5.3 – Sorting the ls output according to the last modification time&#13;&#10;" width="1212" height="768"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.3 – Sorting the ls output according to the last modification time</p>
			<p>The next command on our list is <strong class="source-inline">touch</strong>, and it's a simple one. We use the <strong class="source-inline">touch</strong> command to create an empty file, like this:</p>
			<div>
				<div id="_idContainer127" class="IMG---Figure">
					<img src="Images/Figure_5.4_B16269.jpg" alt="Figure 5.4 – Touching a file in Linux means creating an empty file&#13;&#10;" width="838" height="146"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.4 – Touching a file in Linux means creating an empty file</p>
			<p>Following that, it's time to explain two commands that are closely related – <strong class="source-inline">cd</strong> and <strong class="source-inline">pwd. cd</strong>, or the <em class="italic">change directory</em> command, is there so that we can leave one directory in the shell<a id="_idIndexMarker283"/> and go to another. In contrast, <strong class="source-inline">pwd</strong> is a command<a id="_idIndexMarker284"/> that tells us what our current directory is. Let's try that out by again using <strong class="source-inline">/etc/network</strong> as an example:</p>
			<div>
				<div id="_idContainer128" class="IMG---Figure">
					<img src="Images/Figure_5.5_B16269.jpg" alt="Figure 5.5 – Using cd and pwd to get our bearings in terms of directories&#13;&#10;" width="851" height="227"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.5 – Using cd and pwd to get our bearings in terms of directories</p>
			<p>The next two commands that we're going to deal with are <strong class="source-inline">mkdir</strong> and <strong class="source-inline">rm</strong>. We use <strong class="source-inline">mkdir</strong> to create a directory, while we use the <strong class="source-inline">rm</strong> command to remove a file or a folder. So, let's show how these commands are used by means of an example. First, we are going to create a directory called <strong class="source-inline">temporary</strong>. Then, we're going to create two files in that directory called <strong class="source-inline">tempfile</strong> and <strong class="source-inline">tempfile2</strong>. After that, we're going to remove <strong class="source-inline">tempfile2</strong>, and then remove the entire temporary directory with all its contents, recursively. Let's do that now:</p>
			<div>
				<div id="_idContainer129" class="IMG---Figure">
					<img src="Images/Figure_5.6_B16269.jpg" alt="Figure 5.6 – Working with mkdir and rm&#13;&#10;" width="1212" height="1044"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.6 – Working with mkdir and rm</p>
			<p>The next topic of our discussion is the <strong class="source-inline">cp</strong> and <strong class="source-inline">mv</strong> commands – they enable us to copy or move files and/or folders<a id="_idIndexMarker285"/> where we want to move them. So, let's copy a file<a id="_idIndexMarker286"/> and folder (recursively), and then let's move them someplace else. We're going to use the same example as with <strong class="source-inline">mkdir</strong> and <strong class="source-inline">rm</strong>, but we're going to adjust the example slightly to fit the purpose. Specifically, we're going to create a directory with two files, but this time these files are going to be in a subdirectory. Then, we're going to add additional files to the first folder, after which we're going to copy and move a single file to a new location, and then a folder to another<a id="_idIndexMarker287"/> location. Let's see how<a id="_idIndexMarker288"/> that's going to work:</p>
			<div>
				<div id="_idContainer130" class="IMG---Figure">
					<img src="Images/Figure_5.7_B16269.jpg" alt="Figure 5.7 – Copying and moving files and folders&#13;&#10;" width="1044" height="467"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.7 – Copying and moving files and folders</p>
			<p>The first two commands can be aggregated into one by executing <strong class="source-inline">mkdir -p temporary/tempdir2</strong>.</p>
			<p>This will create both of these directories in one command.</p>
			<p>And finally, let's discuss the <strong class="source-inline">ln</strong> command, which can be used to create hard links (pointers to the file content)  and soft links (pointers to the file/directory name, usually referred to as shortcuts). For hard links, we<a id="_idIndexMarker289"/> just use the <strong class="source-inline">ln</strong> command without any additional options, while soft links require us to use the <strong class="source-inline">ln</strong> command with the <strong class="source-inline">-s</strong> option. Let's create an example to drive the point of this home, and we'll explain how it works as soon as we're done with this example. The scenario is going to include the following:</p>
			<ul>
				<li>Copying a file with a bit of content to a new location so that we have a source file that's going to be used for hard and soft links</li>
				<li>Creating a hard link</li>
				<li>Creating a soft link</li>
				<li>Deleting the original file, and then checking what happens with the soft link and the hard link</li>
				<li>Copying the hard link to the original file, then checking what happens<a id="_idIndexMarker290"/> with soft link <a id="_idIndexMarker291"/>and hard link</li>
			</ul>
			<p>This is how it's done:</p>
			<div>
				<div id="_idContainer131" class="IMG---Figure">
					<img src="Images/Figure_5.8_B16269.jpg" alt="Figure 5.8 – Hard link and soft link operations&#13;&#10;" width="1188" height="636"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.8 – Hard link and soft link operations</p>
			<p>Now that we have gone through all the predetermined scenarios, let's explain some of the concepts behind these commands so that we can understand what happens on the filesystem as we execute them.</p>
			<h2 id="_idParaDest-108"><a id="_idTextAnchor111"/>How it works…</h2>
			<p>Some of these commands are very straightforward and don't necessarily require further explanation, such as <strong class="source-inline">ls</strong>, <strong class="source-inline">touch</strong>, <strong class="source-inline">cd</strong>, <strong class="source-inline">mkdir</strong>, and <strong class="source-inline">pwd</strong>. But others do require a bit of background and technical explanation, especially <strong class="source-inline">ln</strong>. So, let's build on that premise and go through how <strong class="source-inline">rm</strong>, <strong class="source-inline">cp</strong>, <strong class="source-inline">mv</strong>, and <strong class="source-inline">ln</strong> work.</p>
			<p>First, to cover basic file-related commands that we use the most often – <strong class="source-inline">rm</strong>, <strong class="source-inline">cp</strong>, and <strong class="source-inline">mv</strong>. These commands are straightforward, as we use them to remove files or folders (<strong class="source-inline">rm</strong>), copy files or folders (<strong class="source-inline">cp</strong>), or move files or folders (<strong class="source-inline">mv</strong>). Please note <em class="italic">remove</em> and <em class="italic">move</em> in our description of <strong class="source-inline">rm</strong> and <strong class="source-inline">mv</strong>, as those two things are different – removing is about deleting, while moving<a id="_idIndexMarker292"/> is about placing something<a id="_idIndexMarker293"/> someplace else. This sometimes confuses novice users, although it shouldn't.</p>
			<p>However, the most technically demanding command from the bunch is <strong class="source-inline">ln</strong>, which requires us to explain what soft links are, and what hard links are. So, let's do that first.</p>
			<p>Soft links are what we<a id="_idIndexMarker294"/> usually refer to as <em class="italic">shortcuts</em>, similarly to what we can<a id="_idIndexMarker295"/> do in Windows – create a shortcut to a file or a folder. As it's obvious from the picture of our scenario, when we removed the original file, the soft link stopped working. The reason for this is simple – soft links point to a <em class="italic">file or folder name</em>. If we delete a file or folder to which a soft link is pointing, that effectively means that the soft link points to nothing. And that's the reason why, in our scenario, we had a soft link turning red in color. </p>
			<p>Hard links are a completely different concept. They don't point to a filename – they point to <em class="italic">file content</em>.  When using hard<a id="_idIndexMarker296"/> links, try to think of them as two files pointing to the same content. If we delete the original file, the file content is still there, as that's the way modern filesystems work – they don't waste time deleting content, especially if another file is pointing to the same content. That would introduce a lot of latency into the process of deleting files if the files are big. A file delete operation therefore just deletes a pointer (filename) to the file content from a filesystem table. The filesystem takes care of the rest – when the time comes, if that file content is no longer used, the filesystem is going to use it to write new content over it.</p>
			<p>We could've deduced this much from checking the original scenario, where we can clearly see the <em class="italic">difference in size</em> between soft and hard links – the soft link points to a filename and is therefore related to the size of a filename (the number of characters in the filename). As we explained, the hard link points to the file content, which is why the hard link has the same size as the file that it's pointing to. </p>
			<p>There are two fundamental differences between these two concepts. Having in mind that the hard links point to <em class="italic">file content</em>, it's logical that they have two limitations – they can't point to a directory (just a file), and they can't go across partitions. So, if we have a disk partition mounted to <strong class="source-inline">/directory</strong> and another disk partition mounted to <strong class="source-inline">/home directory</strong>. We can't go to <strong class="source-inline">/home directory</strong> and create a hard link that points to a file that's located in <strong class="source-inline">/partition</strong>. One partition can't see the content of another partition, which is an important security concept. It also precludes any chance that hard links across partitions are going to work.</p>
			<p>The next recipe is going to go much deeper into file-directory<a id="_idIndexMarker297"/> security concepts, as we're going to discuss<a id="_idIndexMarker298"/> permissions, special permissions, and <strong class="bold">Access Control Lists</strong> (<strong class="bold">ACLs</strong>). These concepts are core concepts<a id="_idIndexMarker299"/> of IT security and something that we deal with daily. So, let's go through a scenario related to that next.</p>
			<h2 id="_idParaDest-109"><a id="_idTextAnchor112"/>See also</h2>
			<p>If you need more information about these commands, we suggest that you visit these links:</p>
			<ul>
				<li><strong class="source-inline">ls</strong> man<a id="_idIndexMarker300"/> page: <strong class="source-inline">https://man7.org/linux/man-pages/man1/ls.1.html</strong></li>
				<li><strong class="source-inline">touch</strong> man<a id="_idIndexMarker301"/> page: <strong class="source-inline">https://man7.org/linux/man-pages/man1/touch.1.html</strong></li>
				<li><strong class="source-inline">cd</strong> man<a id="_idIndexMarker302"/> page: <strong class="source-inline">https://linuxcommand.org/lc3_man_pages/cdh.html</strong> </li>
				<li><strong class="source-inline">pwd</strong> man<a id="_idIndexMarker303"/> page: <strong class="source-inline">https://man7.org/linux/man-pages/man1/pwd.1.html</strong></li>
				<li><strong class="source-inline">mkdir</strong> man<a id="_idIndexMarker304"/> page: <strong class="source-inline">https://man7.org/linux/man-pages/man1/mkdir.1.html</strong></li>
				<li><strong class="source-inline">rm</strong> man<a id="_idIndexMarker305"/> page: <strong class="source-inline">https://man7.org/linux/man-pages/man1/rm.1.html</strong></li>
				<li><strong class="source-inline">cp</strong> man<a id="_idIndexMarker306"/> page: <strong class="source-inline">https://man7.org/linux/man-pages/man1/cp.1.html</strong></li>
				<li><strong class="source-inline">mv</strong> man<a id="_idIndexMarker307"/> page: <strong class="source-inline">https://linux.die.net/man/1/mv</strong></li>
				<li><strong class="source-inline">ln</strong> man<a id="_idIndexMarker308"/> page: <strong class="source-inline">https://man7.org/linux/man-pages/man1/ln.1.html</strong></li>
			</ul>
			<h1 id="_idParaDest-110"><a id="_idTextAnchor113"/>Additional commands for manipulating file/directory security aspects</h1>
			<p>In this recipe, we're going to use our users – Jack, Joe, Jill, and Sarah – to create a specific scenario to explain<a id="_idIndexMarker309"/> permissions, ACLs, and umask usage. A short explanation of these<a id="_idIndexMarker310"/> concepts is as follows:  permissions are used to control access to files and folders in read, write, and execute mode. As they're limited in granularity, a concept of ACL was developed, to be able to manage permissions on a more finely grained level. Umask is a variable that pre-determines which permissions are going to be assigned to a newly created file or directory. </p>
			<p>The recipe will go like this:</p>
			<ul>
				<li>We need to create a collaborative directory for our students located at <strong class="source-inline">/share/students</strong></li>
				<li>We need to create a collaborative directory for our professors located at <strong class="source-inline">/share/professors</strong></li>
				<li>Members of the student group need to have access to <strong class="source-inline">/share/students</strong> to collaborate on project files</li>
				<li>Members of the student group can create new files, which need to be group-owned by group students, in their <strong class="source-inline">/share/students</strong> folder</li>
				<li>One member of the student group can't use the <strong class="source-inline">rm</strong> command to delete other members' files in their <strong class="source-inline">/share/students</strong> folder</li>
				<li>One member of the student group must have permission to edit other members' files in their <strong class="source-inline">/share/students</strong> folder</li>
				<li>Professors need to have read-write access to all the student files, and all of the newly created student files</li>
				<li>Only professors have access to their shared folder, <strong class="source-inline">/share/professors</strong>, where they can delete each other's files, read them, and edit them.</li>
			</ul>
			<p>Let's make this recipe happen.</p>
			<h2 id="_idParaDest-111"><a id="_idTextAnchor114"/>Getting ready</h2>
			<p>Let's use our <strong class="source-inline">cli2</strong> machine (CentOS) for this<a id="_idIndexMarker311"/> recipe, so make sure<a id="_idIndexMarker312"/> that it's powered on.</p>
			<h2 id="_idParaDest-112"><a id="_idTextAnchor115"/>How to do it…</h2>
			<p>We're going to first create our users and groups by using the <strong class="source-inline">useradd</strong> and <strong class="source-inline">groupadd</strong> commands by using a scenario. Let's say that our task is as follows:</p>
			<ul>
				<li>Create four users called <strong class="source-inline">jack</strong>, <strong class="source-inline">joe</strong>, <strong class="source-inline">jill</strong>, and <strong class="source-inline">sarah</strong></li>
				<li>Create two user groups called <strong class="source-inline">profs</strong> and <strong class="source-inline">pupils</strong></li>
				<li>Reconfigure the <strong class="source-inline">jack</strong> and <strong class="source-inline">jill</strong> user accounts to be members of the <strong class="source-inline">profs</strong> group</li>
				<li>Reconfigure the <strong class="source-inline">joe</strong> and <strong class="source-inline">sarah</strong> user accounts to be members of the <strong class="source-inline">students</strong> group</li>
				<li>Assign a standard password to all the accounts (we're going to use <strong class="source-inline">P@ckT2021</strong> for this purpose)</li>
				<li>Configure user accounts so that they must change their password when next logging in</li>
				<li>Set specific expiry data for the professors' user group – the minimum days before the password change should be set to <strong class="source-inline">15</strong>, the maximum days before a forced password change should be set to <strong class="source-inline">30</strong>, the warning regarding a password change needs to start a week before it expires, and the expiry date for accounts should be set to 2023/01/01 (January 1, 2023)</li>
				<li>Set specific expiry data for the students' user group – the minimum days before the password change should be set to <strong class="source-inline">7</strong>, the maximum days before a forced password change should be set to <strong class="source-inline">30</strong>, the warning regarding a password change needs to start 10 days before it expires, and the expiry date for accounts should be set to 2022/09/01 (September 1, 2022)</li>
				<li>Modify the <strong class="source-inline">profs</strong> group to be called <strong class="source-inline">professors</strong>, and the <strong class="source-inline">pupils</strong> group to be called <strong class="source-inline">students</strong><p class="callout-heading">Note</p><p class="callout">There are a lot of commands in this recipe, so make sure that you refer to the <em class="italic">How it works…</em> section of the recipe to understand everything about the new commands that we haven't used before.</p></li>
			</ul>
			<p>The first task<a id="_idIndexMarker313"/> is to create user accounts, with their unique<a id="_idIndexMarker314"/> home directories and the Bash shell as the default shell:</p>
			<p class="source-code">useradd -m -s /bin/bash jack</p>
			<p class="source-code">useradd -m -s /bin/bash joe</p>
			<p class="source-code">useradd -m -s /bin/bash jill</p>
			<p class="source-code">useradd -m -s /bin/bash sarah</p>
			<p>This will create entries for these four users in the <strong class="source-inline">/etc/passwd</strong> file (where most of the users' information is stored – username, user ID, group ID, default home directory, and default shell), and the <strong class="source-inline">/etc/shadow</strong> file (where users' passwords and aging information are stored). </p>
			<p>Then, we need to create groups:</p>
			<p class="source-code">groupadd profs</p>
			<p class="source-code">groupadd pupils</p>
			<p>This will create entries for these groups in the<strong class="source-inline">/etc/group</strong> file, where the system keeps all of the system groups.</p>
			<p>The next step is to manage the membership of the user groups, for both the professors and student user groups. Before we do that, we need to be aware of one fact. There are two distinctive local group types – <em class="italic">primary group</em> and <em class="italic">supplementary group</em>. The <em class="italic">primary group</em> is important in terms of being the key parameter used when creating new files and directories, as the users' primary group will be used by default for that (there are exceptions, as we'll mention in recipe #4 in this chapter, about umask, permissions, and ACLs). </p>
			<p>The <em class="italic">supplementary group</em> is important when dealing with sharing files and folders and related scenarios and exceptions. This is what's usually used for some additional settings for more advanced<a id="_idIndexMarker315"/> scenarios. These scenarios<a id="_idIndexMarker316"/> are going to be explained partially in the aforementioned recipe #4 in this chapter, as well as in recipes regarding NFS and Samba in <a href="B16269_09_Final_PD_ePub.xhtml#_idTextAnchor206"><em class="italic">Chapter 9</em></a><em class="italic">, An Introduction to Shell Scripting</em>. </p>
			<p>Primary and supplementary groups are stored in <strong class="source-inline">/etc/group</strong> file.</p>
			<p>Now that we've gotten that out of the way, let's modify our users' settings so that they belong to the <em class="italic">supplementary</em> groups as assigned by the scenario:</p>
			<p class="source-code">usermod -G profs jack</p>
			<p class="source-code">usermod -G profs jill</p>
			<p class="source-code">usermod -G pupils joe</p>
			<p class="source-code">usermod -G pupils sarah</p>
			<p>Let's now check how that changes the <strong class="source-inline">/etc/group</strong> file:</p>
			<div>
				<div id="_idContainer132" class="IMG---Figure">
					<img src="Images/Figure_5.9_B16269.jpg" alt="Figure 5.9 – Entries in the /etc/group file&#13;&#10;" width="744" height="316"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.9 – Entries in the /etc/group file</p>
			<p>The first four entries in the <strong class="source-inline">/etc/group</strong> file were actually created when we used the <strong class="source-inline">useradd</strong> command to create these user accounts. The next two entries (except for the last part, after the <strong class="source-inline">:</strong> sign), were created by <strong class="source-inline">groupadd</strong> commands, while entries after the <strong class="source-inline">:</strong> sign were created after the <strong class="source-inline">usermod</strong> commands.</p>
			<p>Let's now set their initial password and set a forced password change when next logging in. We can do it in a couple of different ways, but let's learn the more <em class="italic">programmatic</em> approach to doing this<a id="_idIndexMarker317"/> by echoing a string and using it as the plaintext<a id="_idIndexMarker318"/> password for a user account:</p>
			<p class="source-code">echo "jack:P@ckT2021" | chpasswd</p>
			<p class="source-code">echo "joe:P@ckT2021" | chpasswd</p>
			<p class="source-code">echo "jill:P@ckT2021" | chpasswd</p>
			<p class="source-code">echo "sarah:P@ckT2021" | chpasswd</p>
			<p>This is not necessarily something that we should recommend doing as it would leave these commands in the command history. We're just using this as an example.</p>
			<p>The <strong class="source-inline">echo</strong> part – without the rest of the command – would just type <strong class="source-inline">P@ckT2021</strong> to a terminal, like this:</p>
			<p class="source-code">echo "P@ckT2021"</p>
			<p class="source-code">P@ckT2021</p>
			<p>In CentOS and similar distributions, we could use the <strong class="source-inline">passwd</strong> command with the <strong class="source-inline">--stdin</strong> parameter, which would mean that we want to add a password for the user account via standard input (keyboard, variable, ...). In Ubuntu, this is not available. So, we can echo the <strong class="source-inline">username:P@ckT2021</strong> string to <strong class="source-inline">shell</strong> and pipe that to the <strong class="source-inline">chpasswd</strong> command, which achieves just that purpose – instead of outputting the string to our terminal, the <strong class="source-inline">chpasswd</strong> command uses it as standard input into itself.</p>
			<p>Let's set the expiry data for professors and students. For this purpose, we need to learn how to use the <strong class="source-inline">chage</strong> command and some of its parameters (<strong class="source-inline">-m</strong>, <strong class="source-inline">-M</strong>, <strong class="source-inline">-W</strong>, <strong class="source-inline">-E</strong>):</p>
			<ul>
				<li>If we use the <strong class="source-inline">-m</strong> parameter, this means that we want to assign the minimum number of days before a password change is allowed</li>
				<li>If we use the <strong class="source-inline">-M</strong> parameter, this means that we want to assign the maximum number of days before a password change is forced</li>
				<li>If we use the <strong class="source-inline">-W</strong> parameter, this means that we want to set the number of warning days prior to password expiration, which, in turn, means that the shell is going to start throwing us messages about needing to change our password before it expires</li>
				<li>If we use the <strong class="source-inline">-E</strong> parameter, this means that we want to set account expiration to a certain date (in YYYY-MM-DD format)</li>
			</ul>
			<p>Let's now translate that into commands:</p>
			<p class="source-code">chage -m 15 -M 30 -W 7 -E 2023-01-01 jack</p>
			<p class="source-code">chage -m 15 -M 30 -W 7 -E 2023-01-01 jill</p>
			<p class="source-code">chage -m 7 -M 30 -W 10 -E 2022-09-01 joe</p>
			<p class="source-code">chage -m 7 -M 30 -W 10 -E 2022-09-01 sarah</p>
			<p>And finally, let's modify<a id="_idIndexMarker319"/> the groups to their final settings<a id="_idIndexMarker320"/> by modifying the group name from <strong class="source-inline">professors</strong> to <strong class="source-inline">profs</strong> and from <strong class="source-inline">students</strong> to <strong class="source-inline">pupils</strong>:</p>
			<p class="source-code">groupmod -n professors profs</p>
			<p class="source-code">groupmod -n students pupils</p>
			<p>These commands will only change group names, not their other data (such as group ID), which is going to be reflected in our users' information as well:</p>
			<div>
				<div id="_idContainer133" class="IMG---Figure">
					<img src="Images/Figure_5.10_B16269.jpg" alt="Figure 5.10 – Checking created users' settings&#13;&#10;" width="1245" height="354"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.10 – Checking created users' settings</p>
			<p>As we can see, <strong class="source-inline">jack</strong> and <strong class="source-inline">jill</strong> are members of a group that's now called <strong class="source-inline">professors</strong>, while <strong class="source-inline">joe</strong> and <strong class="source-inline">sarah</strong> are now members of a group called <strong class="source-inline">students</strong>.</p>
			<p>We deliberately left the <strong class="source-inline">userdel</strong> and <strong class="source-inline">groupdel</strong> commands for last, as they come with some caveats and shouldn't be used lightly. Let's create a user called <strong class="source-inline">temp</strong> and a group called <strong class="source-inline">temporary</strong>, and then let's delete them:</p>
			<p class="source-code">useradd temp</p>
			<p class="source-code">groupadd temporary</p>
			<p class="source-code">userdel temp</p>
			<p class="source-code">groupdel temporary</p>
			<p>This will work just fine. The thing is, because we used the <strong class="source-inline">userdel</strong> command without any parameters, it will leave the user's home directory intact. Since users' home directories are usually stored in the <strong class="source-inline">/home</strong> directory, by default, this means that the <strong class="source-inline">/home/temp</strong> directory is still going to be there. When deleting users, this is sometimes something we want – to delete a user, but not to delete their files. If you specifically want to delete a user account and all the data from that user account, use the <strong class="source-inline">userdel -r username</strong> command. But think twice before doing it!</p>
			<p>Furthermore, we obviously<a id="_idIndexMarker321"/> need to create a bunch<a id="_idIndexMarker322"/> of directories and files and change a whole stack of permissions and ACLs. As a general note, the <strong class="source-inline">chmod</strong> command changes permissions, while the <strong class="source-inline">setfacl</strong> command modifies ACLs. This is the correct way to do it:</p>
			<p class="source-code">mkdir -p /share/students</p>
			<p class="source-code">mkdir /share/professors</p>
			<p class="source-code">chgrp students /share/students</p>
			<p class="source-code">chmod 3775 /share/students</p>
			<p class="source-code">setfacl -m g:professors:rwx /share/students</p>
			<p class="source-code">chgrp professors /share/professors</p>
			<p class="source-code">chmod 2770 /share/professors/</p>
			<p class="source-code">setfacl -m d:g:professors:rwx /share/students/</p>
			<p>Let's now test this to check whether it works. First, we're going to log in as our two students from the first recipe (<strong class="source-inline">joe</strong> and <strong class="source-inline">sarah</strong>) and create a couple of files. Then we're going to use joe's account to try to delete Sarah's files, and vice versa, so we should first use <strong class="source-inline">su</strong> to log in as <strong class="source-inline">joe</strong>, <strong class="source-inline">su - joe</strong>, and type in the root password.</p>
			<p>Let's see how that works out:</p>
			<div>
				<div id="_idContainer134" class="IMG---Figure">
					<img src="Images/Figure_5.11_B16269.jpg" alt="Figure 5.11 – The scenario works flawlessly from the students' perspective&#13;&#10;" width="1228" height="861"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.11 – The scenario works flawlessly from the students' perspective</p>
			<p>Part of our scenario <a id="_idIndexMarker323"/>required us to be able<a id="_idIndexMarker324"/> to edit each other's files, while not being able to delete them outright. Let's test that now:</p>
			<div>
				<div id="_idContainer135" class="IMG---Figure">
					<img src="Images/Figure_5.12_B16269.jpg" alt="Figure 5.12 – Changing the content of the file works, while removing the file doesn't&#13;&#10;" width="1650" height="320"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.12 – Changing the content of the file works, while removing the file doesn't</p>
			<p>There's a reason why we picked this type of scenario – this is a real-life scenario that file server administrators often encounter. It's basically the best of both worlds – collaboration works, but users can't delete each other's files by accident. Therefore, this recipe covers some of the most common<a id="_idIndexMarker325"/> things that happen<a id="_idIndexMarker326"/> on a file server, such as one user deleting another user's file by accident (the key point here being the <em class="italic">lack of intention</em> to delete a file). It has happened to all of us. On the other hand, changing a file's content is something that we can only do <em class="italic">intentionally</em>, <em class="italic">consciously</em>. This is also something that we can easily track by using filesystem auditing and file attributes, if we set up our system that way. </p>
			<p>Let's now review things from the professor's perspective. We'll use the <strong class="source-inline">jill</strong> account for this purpose:</p>
			<div>
				<div id="_idContainer136" class="IMG---Figure">
					<img src="Images/Figure_5.13_B16269.jpg" alt="Figure 5.13 – Checking whether our configuration works for Jill&#13;&#10;" width="1567" height="631"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.13 – Checking whether our configuration works for Jill</p>
			<p>We also need to check whether the professors' share works. Let's test it:</p>
			<div>
				<div id="_idContainer137" class="IMG---Figure">
					<img src="Images/Figure_5.14_B16269.jpg" alt="Figure 5.14 – From the professors' standpoint, their share works as requested&#13;&#10;" width="1552" height="898"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.14 – From the professors' standpoint, their share works as requested</p>
			<p>Let's try to use a student's account<a id="_idIndexMarker327"/> to get into the professors' shared<a id="_idIndexMarker328"/> folder:</p>
			<div>
				<div id="_idContainer138" class="IMG---Figure">
					<img src="Images/Figure_5.15_B16269.jpg" alt="Figure 5.15 – A student tries to get to the professors' share and is denied access&#13;&#10;" width="935" height="198"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.15 – A student tries to get to the professors' share and is denied access</p>
			<p>We can also see that these files created by users get the <strong class="source-inline">664</strong> default permission. That's what umask is all about. Check how umask works in the <em class="italic">How it works…</em> section of this recipe.</p>
			<p>So, the whole scenario works, but how exactly does it work? Let's check that out now. </p>
			<h2 id="_idParaDest-113"><a id="_idTextAnchor116"/>How it works…</h2>
			<p>Before we get to the detailed<a id="_idIndexMarker329"/> explanations of these commands, let's just cover<a id="_idIndexMarker330"/> the basics and describe the commands that we have used:</p>
			<ul>
				<li><strong class="source-inline">useradd</strong> – the command that's used to create a local user account</li>
				<li><strong class="source-inline">usermod</strong> – the command that's used to modify a local user account</li>
				<li><strong class="source-inline">userdel</strong> – the command that's used to delete a local user account</li>
				<li><strong class="source-inline">groupadd</strong> – the command that's used to create a local group</li>
				<li><strong class="source-inline">groupmod</strong> – the command that's used to modify a local group</li>
				<li><strong class="source-inline">groupdel</strong> – the command that's used to delete a local group</li>
				<li><strong class="source-inline">passwd</strong> – the command that's most often used to assign passwords to user accounts, but it can be used for some other scenarios (for example, locking user accounts)</li>
				<li><strong class="source-inline">chage</strong> – the command that's used to manage user password expiry</li>
				<li><strong class="source-inline">chgrp</strong> – the command that changes the group ownership of a file or folder</li>
				<li><strong class="source-inline">chmod</strong> – the command that changes the permission of a file or folder</li>
				<li><strong class="source-inline">setfacl</strong> – the command that changes the ACL of a file or folder</li>
			</ul>
			<p>Now that we have discussed these commands, let's explain the details.</p>
			<p>Every file or directory on a Linux filesystem has a number of attributes:</p>
			<ul>
				<li>Permissions</li>
				<li>Ownership</li>
				<li>File size</li>
				<li>Date of creation</li>
				<li>File/directory name</li>
			</ul>
			<p>We will focus on permissions and ownership in this recipe as that's the core of this specific recipe. When we issue<a id="_idIndexMarker331"/> a command such as <strong class="source-inline">ls -al</strong> in the <strong class="source-inline">/share/students</strong> directory, this<a id="_idIndexMarker332"/> is what we get:</p>
			<p class="source-code">[root@localhost students]# ls -al</p>
			<p class="source-code">total 4</p>
			<p class="source-code">drwxrwsr-t+ 2 root  students 66 Dec  6 21:12 .</p>
			<p class="source-code">drwxr-xr-x. 4 root  root     40 Dec  6 20:51 ..</p>
			<p class="source-code">-rw-rw-r--+ 1 joe   students  0 Dec  6 20:58 myfile1</p>
			<p class="source-code">-rw-rw-r--+ 1 joe   students  0 Dec  6 20:58 myfile2</p>
			<p class="source-code">-rw-rw-r--+ 1 sarah students 76 Dec  6 21:16 myfile3</p>
			<p class="source-code">-rw-rw-r--+ 1 sarah students  0 Dec  6 20:58 myfile4</p>
			<p>Let's now use the <strong class="source-inline">myfile1</strong> output as an example. Reading from left to right, the <strong class="source-inline">-rw-rw-r--+</strong> part is related to permissions on that specific file. The second part (<strong class="source-inline">joe</strong>, followed by <strong class="source-inline">students</strong>) is related to ownership of that specific file. </p>
			<p>Let's parse through this a bit, going with permissions first:</p>
			<ul>
				<li>The first <strong class="source-inline">–</strong> means that this is a file – this field is used for the type of content.</li>
				<li>The first <strong class="source-inline">rw-</strong> means that we have read and write permission for the file owner (<strong class="source-inline">joe</strong>) – which we refer to as the user class (u).</li>
				<li>The second <strong class="source-inline">rw-</strong> means that we have read and write permission for the group owner (<strong class="source-inline">students</strong>) – which we refer to as the group class (g).</li>
				<li><strong class="source-inline">R—</strong>means that all the other users have just read permissions – we refer to this class as <strong class="source-inline">others</strong> (o).</li>
				<li><strong class="source-inline">+</strong> at the end means that we have an active ACL on this specific file (to be discussed |a bit later in this explanation).</li>
			</ul>
			<p>We can assign numerical values (weights) to these permissions. The read permission has a weight of 4 (22), the write permission has a weight of 2 (21), and the execute permission has a weight of 1 (20). </p>
			<p>So, if we wanted to assign all permissions to all classes of users (user owner, group owner, others), we'd use the following:</p>
			<p class="source-code">chmod 777 file_name</p>
			<p>Why? If we add 4+2+1, that equals 7. That means read + write + execute. And we can use that on all three<a id="_idIndexMarker333"/> classes – u, g, and o – so that gives us 777. The first <strong class="source-inline">7</strong> refers to <strong class="source-inline">u</strong> (user owner), the second one to <strong class="source-inline">g</strong> (group owner), and the third<a id="_idIndexMarker334"/> one to everyone else (others). That simplifies the management of permissions significantly.</p>
			<p>If we're talking about files, the meaning of these permissions is straightforward – read means read, write means write, delete, and modify, and execute means the ability to start the file.</p>
			<p>With directories, it gets a bit trickier. Default permissions that we need in order to be able to read directory content and pass through it (folder traverse) are read and execute permissions. Write permission on a directory and read permission is needed to list the contents of the directory, while x permission is needed to traverse the directory (being able to go into subfolders of that directory). Write permission means write, delete, and modify on the folder level for the files in that folder (unless there are explicit denies, for example, set by ACL). </p>
			<p>As you can clearly see in the command output, files have two types of ownership:</p>
			<ul>
				<li><strong class="bold">user owner</strong> – in this specific<a id="_idIndexMarker335"/> example, <strong class="source-inline">joe</strong></li>
				<li><strong class="bold">group owner</strong> – in this specific<a id="_idIndexMarker336"/> example, <strong class="source-inline">students</strong></li>
			</ul>
			<p>What does that mean? </p>
			<p>It means that a <em class="italic">user called Joe</em> owns that file. At the same time, it means that a <em class="italic">group called students</em> own that file from the group perspective. </p>
			<p>Let's now add to that discussion by talking about the second line of this output, specifically:</p>
			<p class="source-code">drwxrwsr-t+ 2 root  students 66 Dec  6 21:12 .</p>
			<p>The same principles apply, it's just that we need to discuss a couple of new settings. We can clearly see a couple of letters that we didn't mention previously – <strong class="source-inline">s</strong> in the group ownership class, and <strong class="source-inline">t</strong> in the others class. What is that all about?</p>
			<p>The thing is, there are additional, special permissions<a id="_idIndexMarker337"/> on top of r(ead), w(rite), and (e)x(ecute). These are used<a id="_idIndexMarker338"/> for special use cases:</p>
			<ul>
				<li><strong class="source-inline">sticky bit</strong> – we set this special permission<a id="_idIndexMarker339"/> on a folder level. When enabled on a folder level, it's there to protect from accidental file deletion from our scenario. For example, <strong class="source-inline">myfile1</strong> is owned by the user <strong class="source-inline">joe</strong>. Although <strong class="source-inline">sarah</strong> is the member of the same group (students), which group-owns the file, she still can't delete that file. That's what the sticky bit is all about.</li>
				<li><strong class="source-inline">setgid</strong> – we set this special permission<a id="_idIndexMarker340"/> on the folder level as well. When set on the folder level, this special permission means that all of the newly created files (after <strong class="source-inline">setgid</strong> was set) are going to take their group ownership from the parent folder. In our scenario, that means that all of the newly created files are group-owned by the student group, as requested by the scenario. This is why we used the <strong class="source-inline">chgrp</strong> command on the folder level to set folder ownership to students.</li>
				<li><strong class="source-inline">setuid</strong> – almost never used<a id="_idIndexMarker341"/> now, as it's a security risk. It used to be used on files a bit, specifically, so that when files are started by a non-owner user, it seems that the user owning the file started it (similar to Run As IDEA in Windows).</li>
			</ul>
			<p>These permissions are also set by the <strong class="source-inline">chmod</strong> command, like the first number. That's why our <strong class="source-inline">chmod</strong> command had four numbers instead of three – the first number is all about special permissions. In general, when we use a three-digit number with <strong class="source-inline">chmod</strong>, it expands that to include a zero from the left side.</p>
			<p>Going back to our recipe, we issued the following command:</p>
			<p class="source-code">chmod 3775 /share/students</p>
			<p>That means that we used <strong class="source-inline">chmod</strong> to set the sticky bit and <strong class="source-inline">setgid</strong> (1+2 equals 3 on the first digit) on the folder, as well as <strong class="source-inline">rwx</strong> for user and group owners (77) and <strong class="source-inline">rx</strong> for others (5).</p>
			<p>The next, more complicated part relates to ACLs. ACLs are most commonly used to take care of <em class="italic">exceptions</em> (regular ACLs) or <em class="italic">permission inheritance</em> (default ACLs). Let's describe them in a bit more detail. We used the following command:</p>
			<p class="source-code">setfacl -m g:professors:rwx /share/students</p>
			<p>This means that we want to modify (the <strong class="source-inline">-m</strong> parameter) the ACL on the directory called <strong class="source-inline">/share/students</strong>. And we want to modify it so that the group called <strong class="source-inline">professors</strong> gets <strong class="source-inline">rwx</strong> (read-write-execute) permissions<a id="_idIndexMarker342"/> on that directory. You can clearly<a id="_idIndexMarker343"/> see why we said that ACLs are most commonly used to treat exceptions. Our scenario required that the <strong class="source-inline">/share/students</strong> folder has group ownership of students. We can't assign two users to be owners of a directory (there can be only one, (c) according to the Highlander movie). So, there's no direct way for us to do that, which means we have to use something else to create an exception. That's where ACL comes in.</p>
			<p>We could've done this differently (not that we should have). We could have issued two user-based ACLs for both members of our professors' group. Those two commands would be as follows:</p>
			<p class="source-code">setfacl -m u:jack:rwx /share/students</p>
			<p class="source-code">setfacl -m u:jill:rwx /share/students</p>
			<p>The trouble with that approach is really simple to understand. Let's say that we add five more professors to our system. We then need to issue five more <strong class="source-inline">setfacl</strong> commands to set the same ACLs to them. It's just easier to use a group and add users to a group. It's a well-known concept that everyone uses on all of the operating systems used today.</p>
			<p>If we wanted to set explicit deny ACL for <strong class="source-inline">others</strong>, we could have used this command:</p>
			<p class="source-code">setfacl -m o:--- /share/students</p>
			<p>This way, we make sure that all of the members of that <strong class="source-inline">others</strong> class don't get access to the folder.</p>
			<p>The second <strong class="source-inline">setfacl</strong> command that we used<a id="_idIndexMarker344"/> was as follows:</p>
			<p class="source-code">setfacl -m d:g:professors:rwx /share/students/</p>
			<p>This command sets a <em class="italic">default ACL</em>, which is a completely<a id="_idIndexMarker345"/> different concept to regular ACL we described just before this. Default ACLs are used so that every newly created file or folder under a directory (in this case, <strong class="source-inline">/share/students</strong>) automatically inherits permissions from the parent folder as set by the default ACL. In our scenario, this command means that every single file or folder that gets created after we set this default ACL is going to have an ACL set to <strong class="source-inline">g:professors:rwx</strong>. </p>
			<p>Clearly, you can see how ACLs<a id="_idIndexMarker346"/> and default ACLs are useful, as without<a id="_idIndexMarker347"/> them, we'd have way less scope to configure more advanced, finely-grained scenarios for data access.</p>
			<p>Let's now discuss the last important aspect of this scenario – default file permissions. We mentioned in the recipe that we need to cover the subject of <strong class="source-inline">umask</strong>. Let's do that now.</p>
			<p>If we check the output from one of the previous screenshots, we can see this:</p>
			<p class="source-code">-rw-rw-r--. 1 jill professors  0 Dec  6 21:22 prof2</p>
			<p class="source-code">-rw-rw-r--. 1 jack professors 36 Dec  6 21:23 prof3</p>
			<p>The question is, why are default permissions <strong class="source-inline">rw-rw-r--</strong>?</p>
			<p>The answer to this question is called <strong class="source-inline">umask</strong> (user mask). </p>
			<p>As a concept, <strong class="source-inline">umask</strong> is used specifically<a id="_idIndexMarker348"/> for that – to set default permissions for newly created files and directories. It can be set by shell configuration files, by a user profile, or by a command. Let's use the <strong class="source-inline">umask</strong> command to explain how it does what it does:</p>
			<p class="source-code">[jill@localhost professors]$ umask</p>
			<p class="source-code">0002</p>
			<p class="source-code">[jill@localhost professors]$ touch prof4</p>
			<p class="source-code">[jill@localhost professors]$ umask 0022</p>
			<p class="source-code">[jill@localhost professors]$ touch prof5</p>
			<p class="source-code">[jill@localhost professors]$ umask 0222</p>
			<p class="source-code">[jill@localhost professors]$ touch prof6</p>
			<p class="source-code">[jill@localhost professors]$ ls -al</p>
			<p class="source-code">total 8</p>
			<p class="source-code">drwxrws---. 2 root professors 84 Dec  6 22:32 .</p>
			<p class="source-code">drwxr-xr-x. 4 root root       40 Dec  6 20:51 ..</p>
			<p class="source-code">-rw-rw-r--. 1 jill professors 36 Dec  6 21:23 prof1</p>
			<p class="source-code">-rw-rw-r--. 1 jill professors  0 Dec  6 21:22 prof2</p>
			<p class="source-code">-rw-rw-r--. 1 jack professors 36 Dec  6 21:23 prof3</p>
			<p class="source-code">-rw-rw-r--. 1 jill professors  0 Dec  6 22:32 prof4</p>
			<p class="source-code">-rw-r--r--. 1 jill professors  0 Dec  6 22:32 prof5</p>
			<p class="source-code">-r--r--r--. 1 jill professors  0 Dec  6 22:32 prof6</p>
			<p>You can clearly see<a id="_idIndexMarker349"/> that as we change the <strong class="source-inline">umask</strong> variable for a user, the default permissions for newly created<a id="_idIndexMarker350"/> files change. When we used an <strong class="source-inline">umask</strong> value of <strong class="source-inline">0002</strong>, the <strong class="source-inline">prof4</strong> file was created with permission <strong class="source-inline">664</strong>. When we used an <strong class="source-inline">umask</strong> value of <strong class="source-inline">0022</strong>, the <strong class="source-inline">prof5</strong> file was created with permission <strong class="source-inline">644</strong>. Lastly, when we used an <strong class="source-inline">umask</strong> value of <strong class="source-inline">0222</strong>, the <strong class="source-inline">prof6</strong> file was created with permission <strong class="source-inline">444</strong>. We could also ignore the leading zero when assigning <strong class="source-inline">umask</strong> in accordance with the same principle we used for the <strong class="source-inline">chmod</strong> command. </p>
			<p>Mask for files is set to <strong class="source-inline">666</strong>, and for directories, it's set to <strong class="source-inline">777</strong>. So, if we want to calculate default permissions for newly created files or folders, we just need to subtract the <strong class="source-inline">umask</strong> value from these values (<strong class="source-inline">666</strong> or <strong class="source-inline">777</strong>) and get default permissions for files (or folders).</p>
			<p>If we don't resort to manual configuration, all users' umask values are set by the <strong class="source-inline">/etc/profile</strong> file, which is loaded by default when a user logs in. In that file, there's an <strong class="source-inline">if</strong> statement that looks like this:</p>
			<p class="source-code">if [ $UID -gt 199 ] &amp;&amp; [ "'/usr/bin/id -gn'" = "'/usr/bin/id -un'" ]; then</p>
			<p class="source-code">    umask 002</p>
			<p class="source-code">else</p>
			<p class="source-code">    umask 022</p>
			<p class="source-code">fi</p>
			<p>Basically, what this <strong class="source-inline">if</strong>-<strong class="source-inline">then</strong>-<strong class="source-inline">else</strong> structure does is, for all the UIDs that are greater than <strong class="source-inline">199</strong>, <strong class="source-inline">umask</strong> is set to <strong class="source-inline">002</strong>, otherwise, it's set to <strong class="source-inline">022</strong>. That's why regular users have <strong class="source-inline">umask 002</strong>, while the root user has <strong class="source-inline">umask 022</strong> (the root's UID is 0). </p>
			<p>Let's now move<a id="_idIndexMarker351"/> to our next recipe, which is all about using commands<a id="_idIndexMarker352"/> to manipulate text files – commands including <strong class="source-inline">cat</strong>, <strong class="source-inline">cut</strong>, <strong class="source-inline">more</strong>, <strong class="source-inline">less</strong>, <strong class="source-inline">head</strong>, and <strong class="source-inline">tail</strong>. </p>
			<h2 id="_idParaDest-114"><a id="_idTextAnchor117"/>See also</h2>
			<p>If you need more information about file permissions, special permissions, or ACLs, we suggest that you visit these links:</p>
			<ul>
				<li>Managing<a id="_idIndexMarker353"/> file permissions: <strong class="source-inline">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/configuring_basic_system_settings/assembly_managing-file-permissions_configuring-basic-system-settings</strong></li>
				<li>Linux<a id="_idIndexMarker354"/> permissions – SUID, SGID, and sticky bit: <strong class="source-inline">https://www.redhat.com/sysadmin/suid-sgid-sticky-bit</strong></li>
				<li>An introduction to<a id="_idIndexMarker355"/> Linux ACLs: <strong class="source-inline">https://www.redhat.com/sysadmin/linux-access-control-lists</strong></li>
			</ul>
			<h1 id="_idParaDest-115"><a id="_idTextAnchor118"/>Manipulating text files by using commands</h1>
			<p>Let's now switch our attention<a id="_idIndexMarker356"/> to learning about commands that enable us to manipulate<a id="_idIndexMarker357"/> text files – just for output reasons <strong class="source-inline">head</strong>, <strong class="source-inline">tail</strong>, <strong class="source-inline">more</strong>, <strong class="source-inline">less</strong>, <strong class="source-inline">cat</strong>. Some other commands related to the same concepts are going to be covered in later chapters, such as <a href="B16269_08_Final_PD_ePub.xhtml#_idTextAnchor178"><em class="italic">Chapter 8</em></a>, <em class="italic">Using the Command Line to Find, Extract, and Manipulate Text Content</em>, where we discuss more advanced scenarios with text files, such as merging, cutting, and using regular expressions with <strong class="source-inline">grep</strong> and <strong class="source-inline">sed</strong> to manipulate text content.</p>
			<h2 id="_idParaDest-116"><a id="_idTextAnchor119"/>Getting ready</h2>
			<p>We still need the same virtual machines as with our previous recipes. </p>
			<h2 id="_idParaDest-117"><a id="_idTextAnchor120"/>How to do it…</h2>
			<p>Let's start by using <strong class="source-inline">head</strong><a id="_idIndexMarker358"/> and <strong class="source-inline">tail</strong> command, commands<a id="_idIndexMarker359"/> that can be used to show the beginning and end of a text file. For example, let's use the <strong class="source-inline">/root/.bashrc</strong> file:</p>
			<p class="source-code">[student@cli1 22:28] head /root/.bashrc</p>
			<p class="source-code"># ~/.bashrc: executed by bash(1) for non-login shells.</p>
			<p class="source-code"># see /usr/share/doc/bash/examples/startup-files (in the package bash-doc)</p>
			<p class="source-code"># for examples</p>
			<p class="source-code"># If not running interactively, don't do anything</p>
			<p class="source-code">case $- in</p>
			<p class="source-code">    *i*) ;;</p>
			<p class="source-code">      *) return;;</p>
			<p class="source-code">esac</p>
			<p>Let's now check the tail end of the same file:</p>
			<p class="source-code">[student@cli1 22:29] tail /root/.bashrc</p>
			<p class="source-code">  if [ -f /usr/share/bash-completion/bash_completion ]; then</p>
			<p class="source-code">    . /usr/share/bash-completion/bash_completion</p>
			<p class="source-code">  elif [ -f /etc/bash_completion ]; then</p>
			<p class="source-code">    . /etc/bash_completion</p>
			<p class="source-code">  fi</p>
			<p class="source-code">fi</p>
			<p class="source-code">PS1="\e[0;31m[\u@\H \A] \e[0m"</p>
			<p class="source-code">export VISUAL=nano</p>
			<p class="source-code">export EDITOR=nano</p>
			<p>Unlike <strong class="source-inline">that</strong>, <strong class="source-inline">more</strong> and <strong class="source-inline">less</strong> are used to just display output, but in a page-by-page formatted<a id="_idIndexMarker360"/> fashion, making a long output much more humanly<a id="_idIndexMarker361"/> readable. So, when we execute the following command:</p>
			<p class="source-code">less /root/.bashrc</p>
			<p>Or we can execute this command:</p>
			<p class="source-code">more /root/.bashrc</p>
			<p>The expected output from these commands is something like this:</p>
			<div>
				<div id="_idContainer139" class="IMG---Figure">
					<img src="Images/Figure_5.16_B16269.jpg" alt="Figure 5.16 – Using the more and less commands looks very similar &#13;&#10;to this – page-by-page viewing of text content&#13;&#10;" width="1251" height="1322"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.16 – Using the more and less commands looks very similar to this – page-by-page viewing of text content</p>
			<p><strong class="source-inline">Cat</strong> (the command, not a feline) is completely<a id="_idIndexMarker362"/> opposite to the <em class="italic">discipline</em> of <strong class="source-inline">more</strong><a id="_idIndexMarker363"/> or <strong class="source-inline">less</strong> – it just displays the whole file content, without any stoppages. This is cool when a text file is short, but mostly useless if that file is long, and is one of the most common reasons why we use <strong class="source-inline">more</strong> or <strong class="source-inline">less</strong> commands. So, let's pick<a id="_idIndexMarker364"/> a short file and <strong class="source-inline">cat</strong> it, for<a id="_idIndexMarker365"/> example, the <strong class="source-inline">/root/.profile</strong> file:</p>
			<div>
				<div id="_idContainer140" class="IMG---Figure">
					<img src="Images/Figure_5.17_B16269.jpg" alt="Figure 5.17 – Using the cat command on an appropriate file – a text file &#13;&#10;that's not too big to fit on one terminal page&#13;&#10;" width="1402" height="1020"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.17 – Using the cat command on an appropriate file – a text file that's not too big to fit on one terminal page</p>
			<p><strong class="source-inline">Cat</strong> can be used for one more thing, which is to combine multiple text files into one. This operation is often used when combining multiple log files into one to concatenate them. We're going to discuss this scenario later in this book, in <a href="B16269_08_Final_PD_ePub.xhtml#_idTextAnchor178"><em class="italic">Chapter 8</em></a>, <em class="italic">Using the Command Line to Find, Extract, and Manipulate Text Content</em>.</p>
			<h2 id="_idParaDest-118"><a id="_idTextAnchor121"/>How it works…</h2>
			<p><strong class="source-inline">more</strong> and <strong class="source-inline">less</strong> are page viewers – they enable us to display content page by page. As we can see in the last<a id="_idIndexMarker366"/> line of our example, using these commands didn't <em class="italic">finish</em> – the command<a id="_idIndexMarker367"/> stopped showing the file content after displaying one page of that file. Now it's interactively waiting for us to either continue listing file content page by page, do something else (for example, searching by using the <strong class="source-inline">/</strong> sign), or quit by using the <strong class="source-inline">q</strong> key.</p>
			<p>The <strong class="source-inline">head</strong> and <strong class="source-inline">tail</strong> commands are named appropriately – they show the head (beginning) and the tail (end) of a text file. They can also be used with a variety of options to further parametrize the output that we want. For example, if we execute the following command:</p>
			<p class="source-code">tail -n 15 /root/.bashrc</p>
			<p>We're going to get the last 15 lines of that file. The same can be done with the <strong class="source-inline">head</strong> command.</p>
			<p>Our next topic of discussion is using the <strong class="source-inline">find</strong> command to find files and folders. Let's deal with that first and then move on to the next recipes, which are going to involve archiving, compression, and dealing with services via <strong class="source-inline">systemctl</strong>. </p>
			<h2 id="_idParaDest-119"><a id="_idTextAnchor122"/>There's more…</h2>
			<p>If we need to learn more about these commands, we can check the following links:</p>
			<ul>
				<li><strong class="source-inline">head</strong> man page: <a href="https://man7.org/linux/man-pages/man1/head.1.html">https://man7.org/linux/man-pages/man1/head.1.html</a></li>
				<li><strong class="source-inline">tail</strong> man page: <a href="https://man7.org/linux/man-pages/man1/tail.1.html">https://man7.org/linux/man-pages/man1/tail.1.html</a></li>
				<li><strong class="source-inline">more</strong> man page: <a href="https://man7.org/linux/man-pages/man1/more.1.html">https://man7.org/linux/man-pages/man1/more.1.html</a></li>
				<li><strong class="source-inline">less</strong> man page: <a href="https://man7.org/linux/man-pages/man1/less.1.html">https://man7.org/linux/man-pages/man1/less.1.html</a></li>
				<li><strong class="source-inline">cat</strong> man page: <a href="https://man7.org/linux/man-pages/man1/cat.1.html">https://man7.org/linux/man-pages/man1/cat.1.html</a></li>
			</ul>
			<h1 id="_idParaDest-120"><a id="_idTextAnchor123"/>Finding files and folders</h1>
			<p>Our next topic of the day is to learn<a id="_idIndexMarker368"/> to use the <strong class="source-inline">find</strong> command, an incredibly useful command. It can<a id="_idIndexMarker369"/> be used in a variety of different ways – to find files and folders according to specific<a id="_idIndexMarker370"/> criteria (permissions, ownership, modified date, and others), but also to <em class="italic">prepare data</em> to be further manipulated <em class="italic">after</em> the <strong class="source-inline">find</strong> command. We'll go through some examples of both principles in this recipe.</p>
			<h2 id="_idParaDest-121"><a id="_idTextAnchor124"/>Getting ready</h2>
			<p>We need to leave our <strong class="source-inline">cli1</strong> virtual machine running. If it's not powered on, we need to power it back on. </p>
			<h2 id="_idParaDest-122"><a id="_idTextAnchor125"/>How to do it…</h2>
			<p>Let's use a couple of examples to explain how the <strong class="source-inline">find</strong> command works. Here are some examples that we're going to use:</p>
			<ul>
				<li>Finding files in the <strong class="source-inline">/</strong> directory that have permission <strong class="source-inline">2755</strong></li>
				<li>Finding files in the <strong class="source-inline">/</strong> directory owned by the user <strong class="source-inline">jill</strong></li>
				<li>Finding files in the <strong class="source-inline">/</strong> directory owned by a group student</li>
				<li>Finding files in the <strong class="source-inline">/</strong> directory with a specific name (for example, <strong class="source-inline">network</strong>)</li>
				<li>Finding files of a specific type (for example, all files with the <strong class="source-inline">php</strong> extension)</li>
				<li>Finding all empty directories</li>
				<li>Finding files that have been modified in the past two hours (120 minutes)</li>
				<li>Finding files that are 100-200 MB in size</li>
			</ul>
			<p>Let's make these scenarios happen:</p>
			<p class="source-code">find / -type f -perm 2755</p>
			<p class="source-code">find / -type f -user jill</p>
			<p class="source-code">find / -type f -group student</p>
			<p class="source-code">find / -type f -name network</p>
			<p class="source-code">find / -type f -name "*.php"</p>
			<p class="source-code">find / -type d -empty</p>
			<p class="source-code">find / -mmin -120</p>
			<p class="source-code">find / -size +100M -size -200M</p>
			<p>To further drive home the importance of this command, let's use it, as we mentioned previously, to <em class="italic">prepare</em> data to do something <em class="italic">after</em> we find the necessary content. For example, let's find<a id="_idIndexMarker371"/> all files that have the <strong class="source-inline">.avi</strong> extension<a id="_idIndexMarker372"/> on the whole filesystem and remove them:</p>
			<p class="source-code">find / -type f -name "*.avi" -exec rm -f {} \;</p>
			<p>This command finds all files with the <strong class="source-inline">.avi</strong> extension, puts them in an array, and removes them, one by one, by using the <strong class="source-inline">rm -f</strong> command. This is very useful if you have users who are abusing corporate resources for unnecessary content. </p>
			<h2 id="_idParaDest-123"><a id="_idTextAnchor126"/>How it works…</h2>
			<p>Finding files and folders by name is something that we often do. For example, let's say that we have a rudimentary shell script that performs a backup and that it uses specific criteria to create a list of files that it's going to copy to a pre-determined backup folder. If we're doing this kind of operation on a large production server with hundreds of users, chances are that there will be a lot of new files daily. Using the <strong class="source-inline">find</strong> command makes a lot of sense in these sorts of scenarios.</p>
			<p>Most commonly, we use the <strong class="source-inline">find</strong> command<a id="_idIndexMarker373"/> to locate files (<strong class="source-inline">-type f</strong> option) or folders (<strong class="source-inline">-type d</strong> option), and then we narrow our search by using more criteria. Criteria such as modification date, user or group ownership, permissions – there are a lot of options available. If we look at the <strong class="source-inline">find</strong> command man page, we'll quickly become painfully aware of how many options and advanced scenarios can be covered by using the <strong class="source-inline">find</strong> command. This is why there's a common way of using <strong class="source-inline">find</strong>, which is to start with something such as a file type or extension, and then narrow it down further by using other options that we mentioned. If we start with that in mind, we'll get to our results quickly.</p>
			<p>The next recipe on our plate is related to archiving and compressing files and folders. So, let's learn how to use <strong class="source-inline">tar</strong> and its sidekicks, <strong class="source-inline">gzip</strong>, <strong class="source-inline">bzip</strong>, <strong class="source-inline">xzip</strong>, and commands alike.</p>
			<h2 id="_idParaDest-124"><a id="_idTextAnchor127"/>There's more…</h2>
			<p>If you need to learn more about Bash reserved variables and PS variables, refer to the <strong class="source-inline">Find</strong> command<a id="_idIndexMarker374"/> man page: <strong class="source-inline">https://man7.org/linux/man-pages/man1/find.1.html.</strong></p>
			<h1 id="_idParaDest-125"><a id="_idTextAnchor128"/>Archiving and compressing files and folders</h1>
			<p>Being efficient in terms of how we use<a id="_idIndexMarker375"/> disk space is nothing new – it's always<a id="_idIndexMarker376"/> been around. Yes, we're at a point<a id="_idIndexMarker377"/> in history where large capacity<a id="_idIndexMarker378"/> hard drives and other media is available, but that doesn't mean we can be reckless about it. This is the reason why we've been using archiving and compressing for decades, and it's a topic that we're going to cover now as well.</p>
			<h2 id="_idParaDest-126"><a id="_idTextAnchor129"/>Getting ready</h2>
			<p>We need to make sure that our <strong class="source-inline">cli1</strong> machine is ready to be used, which will make our work on this recipe easy.</p>
			<h2 id="_idParaDest-127"><a id="_idTextAnchor130"/>How to do it…</h2>
			<p>Let's go through another scenario-based example to cover all the necessary topics. So, this is what we're going to do in the first part of our recipe:</p>
			<ul>
				<li>Create a <strong class="source-inline">tar</strong> archive with the current folder content</li>
				<li>Create a <strong class="source-inline">tar.gz</strong> compressed archive with the current folder content</li>
				<li>Create a <strong class="source-inline">tar.bz2</strong> compressed archive with the current folder content</li>
				<li>Create a <strong class="source-inline">tar.xz</strong> compressed archive with the current folder content</li>
			</ul>
			<p>In the second part of our recipe, we're going to extract these archives:</p>
			<ul>
				<li>Extract a <strong class="source-inline">tar</strong>, <strong class="source-inline">tar.gz</strong>, <strong class="source-inline">tar.bz2</strong>, or <strong class="source-inline">tar.xz</strong> archive</li>
				<li>Extract a <strong class="source-inline">tar</strong>, <strong class="source-inline">tar.gz</strong>, <strong class="source-inline">tar.bz2</strong>, or <strong class="source-inline">tar.xz</strong> archive to a specific folder (let's say <strong class="source-inline">/tmp/extract</strong>)</li>
			</ul>
			<p>Let's say that we're located in the <strong class="source-inline">/root</strong> directory, and that<a id="_idIndexMarker379"/> we want to save<a id="_idIndexMarker380"/> all of our archives<a id="_idIndexMarker381"/> to the <strong class="source-inline">/tmp</strong> directory. This is how we'd do the first part<a id="_idIndexMarker382"/> of our scenario:</p>
			<p class="source-code">cd /root</p>
			<p class="source-code">tar cfp /tmp/root.tar .</p>
			<p>If we were creating the <strong class="source-inline">tar.gz</strong> archive, we'd do this: </p>
			<p class="source-code">tar cfpz /tmp/root.tar.gz .</p>
			<p>If we were creating the <strong class="source-inline">tar.bz2</strong> archive, we'd do this: </p>
			<p class="source-code">tar cfpj /tmp/root.tar.bz2 .</p>
			<p>If we were creating the <strong class="source-inline">tar.xz</strong> archive, we'd do this: </p>
			<p class="source-code">tar cfpJ /tmp/root.tar.xz .</p>
			<p>The second part of our scenario begins by opening an archive. We just need to change one <strong class="source-inline">tar</strong> parameter when compared to the first set of examples in our scenario and ditch the last part of our command (<strong class="source-inline">.</strong> for the current directory). So, we'd need to do this (don't do this in the real world; this is merely for illustration purposes):</p>
			<p class="source-code">tar fpx /tmp/root.tar</p>
			<p>Alternatively, we could need to do this:</p>
			<p class="source-code">tar zfpx /tmp/root.tar.gz</p>
			<p>Or we could do this:</p>
			<p class="source-code">tar jfpx /tmp/root.tar.bz2</p>
			<p>Or we could do this:</p>
			<p class="source-code">tar Jfpx /tmp/root.tar.xz</p>
			<p>The problem with this is the location of the output – where's the output of this extraction process going to go? So, the correct way to do this would be as follows:</p>
			<p class="source-code">cd /tmp</p>
			<p class="source-code">mkdir /tmp/extract</p>
			<p class="source-code">tar fpx /tmp/root.tar -C /tmp/extract</p>
			<p>Alternatively, we could do this:</p>
			<p class="source-code">tar zfpx /tmp/root.tar.gz -C /tmp/extract</p>
			<p>Or we could do this:</p>
			<p class="source-code">tar jfpx /tmp/root.tar.bz2 -C /tmp/extract</p>
			<p>Or we could do this:</p>
			<p class="source-code">tar Jfpx /tmp/root.tar.xz -C /tmp/extract</p>
			<p>Again, this depends<a id="_idIndexMarker383"/> on the archive<a id="_idIndexMarker384"/> type.</p>
			<p><strong class="source-inline">Tar</strong> has a myriad<a id="_idIndexMarker385"/> of other available<a id="_idIndexMarker386"/> options, for example, for<a id="_idIndexMarker387"/> manipulating ACLs and SELinux contexts such as the following:</p>
			<ul>
				<li><strong class="source-inline">--acls</strong> – Use ACLs when creating an archive</li>
				<li><strong class="source-inline">--no-acls</strong> – Ignore ACLs when creating an archive</li>
				<li><strong class="source-inline">--selinux</strong> – Use SELinux contexts when creating an archive</li>
				<li><strong class="source-inline">--noselinux</strong> – Ignore SELinux contexts when creating an archive</li>
			</ul>
			<p>We cannot stress how important it is to check the corresponding man page if we're looking for something specific. So, we need to make sure that we do.</p>
			<h2 id="_idParaDest-128"><a id="_idTextAnchor131"/>How it works…</h2>
			<p><strong class="source-inline">tar</strong>, or <strong class="source-inline">Tape ARchiver</strong>, has been around for decades now. Its original use case included archiving content on tape, which is how it got its name. Archiving, as the manual states, means storing multiple files in a single file. All the other options that we use are additional options that have been added over the past 40+ years, given that it was introduced way back in 1979.</p>
			<p>In terms of the parameters used in our examples, we have the following:</p>
			<ul>
				<li><strong class="source-inline">c</strong> – Create an archive</li>
				<li><strong class="source-inline">x</strong> – Extract an archive</li>
				<li><strong class="source-inline">f</strong> – Or <strong class="source-inline">--file</strong>, to select an output archive filename</li>
				<li><strong class="source-inline">p</strong> – Option to preserve permissions</li>
				<li><strong class="source-inline">C</strong> – Select an output folder</li>
				<li><strong class="source-inline">z</strong> – Use <strong class="source-inline">gzip</strong> to compress the <strong class="source-inline">tar</strong> archive</li>
				<li><strong class="source-inline">j</strong> – Use <strong class="source-inline">bzip2</strong> to compress the <strong class="source-inline">tar</strong> archive</li>
				<li><strong class="source-inline">J</strong> – Use <strong class="source-inline">xzip</strong> to compress the <strong class="source-inline">tar</strong> archive</li>
			</ul>
			<p>These are the most<a id="_idIndexMarker388"/> frequently used <strong class="source-inline">tar</strong> parameters, which<a id="_idIndexMarker389"/> is why we specifically<a id="_idIndexMarker390"/> selected those for<a id="_idIndexMarker391"/> our recipe. </p>
			<p>This concludes our <strong class="source-inline">tar</strong> recipe, and we're ready to move on to the final recipe in this chapter, which is all about managing services by using the <strong class="source-inline">systemctl</strong> command. Let's work on that for a bit.</p>
			<h2 id="_idParaDest-129"><a id="_idTextAnchor132"/>There's more…</h2>
			<p>If you want to learn more about the <strong class="source-inline">tar</strong> command, make sure that you refer to the <strong class="source-inline">tar</strong> command<a id="_idIndexMarker392"/> man page: <a href="https://man7.org/linux/man-pages/man1/tar.1.html">https://man7.org/linux/man-pages/man1/tar.1.html</a>.</p>
			<h1 id="_idParaDest-130"><a id="_idTextAnchor133"/>Managing services and targets</h1>
			<p>Managing services<a id="_idIndexMarker393"/> tends to be something that we need to do at times. For example, when we install<a id="_idIndexMarker394"/> a new piece of software that comes bundled as a service, we need to be able to manage it so that it can work properly. This is what we're going to work on as we go through this recipe. We're also going to give a short description of how <strong class="source-inline">systemctl</strong> configuration files work, but without going on a 100 mile-long journey, as it's the recipe that's the focus. However, we will make sure that we provide you with additional links where you can learn a whole lot more about <strong class="source-inline">systemd</strong> as it's a big topic and an important one.</p>
			<h2 id="_idParaDest-131"><a id="_idTextAnchor134"/>Getting ready</h2>
			<p>We're going to use our <strong class="source-inline">cli2</strong> CentOS for this recipe, just so that it doesn't feel left out.</p>
			<h2 id="_idParaDest-132"><a id="_idTextAnchor135"/>How to do it…</h2>
			<p>The basic idea behind managing services in practical terms is to have services start either at the point in time when we want them to be started, or to have them available after we boot our Linux server.</p>
			<p>The management of services<a id="_idIndexMarker395"/> and targets became quite a bit easier over the past couple<a id="_idIndexMarker396"/> of releases of any Linux distribution. If you've been using CentOS for an extended period, you will probably remember upstart, init, and all those beautiful things that will remain buried deep in our not-so-fond memories. In terms of the management of services, both from the administrative and <em class="italic">development</em> perspective (we'll get to that in a sec), things became much easier with CentOS 7. CentOS 8 follows the same path. There are, and always will be, differing opinions regarding the whole idea of <strong class="source-inline">systemd</strong>, but that's not the subject at hand here. So, let's focus on services and targets. First, we'll log in as root and type some commands, starting with the following:</p>
			<p class="source-code">systemctl set-default multi-user.target</p>
			<p>This is going to switch our default boot target to multi-user, which means that our CentOS machine is going to be booted to text mode by default. So, after we reboot the machine, it's going to be started in text mode. Then, we're going to switch to using text mode instantly:</p>
			<p class="source-code">systemctl isolate multi-user.target</p>
			<p>This is going to kill all the GUI processes, check the service delta between <strong class="source-inline">graphical.target</strong> and <strong class="source-inline">multi-user.target</strong>, and do its magic.</p>
			<p>The next thing that we're going to do is, we're going to pick a service (for example, <strong class="source-inline">sshd</strong>), and use the <strong class="source-inline">systemctl</strong> command to manage it – both momentarily (manage its state at the time of command execution) and permanently (manage what happens with the <strong class="source-inline">sshd</strong> service during system boot). Let's type in these commands:</p>
			<p class="source-code">systemctl stop sshd.service</p>
			<p class="source-code">systemctl status sshd.service</p>
			<p>The result of these two commands is going to be as follows:</p>
			<div>
				<div id="_idContainer141" class="IMG---Figure">
					<img src="Images/Figure_5.18_B16269.jpg" alt="Figure 5.18 – Using systemctl to manage a service – in this case, the SSH service&#13;&#10;" width="1577" height="714"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.18 – Using systemctl to manage a service – in this case, the SSH service</p>
			<p>It's telling us that <strong class="source-inline">sshd.service</strong> is disabled – Active: inactive (dead). We will enable it and check its state<a id="_idIndexMarker397"/> by typing the following<a id="_idIndexMarker398"/> command:</p>
			<p class="source-code">systemctl start sshd.service</p>
			<p class="source-code">systemctl status sshd.service</p>
			<p>Let's check the result of these last two commands:</p>
			<div>
				<div id="_idContainer142" class="IMG---Figure">
					<img src="Images/Figure_5.19_B16269.jpg" alt="Figure 5.19 – Checking the state of the SSH service following a configuration change&#13;&#10;" width="1580" height="675"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.19 – Checking the state of the SSH service following a configuration change</p>
			<p>We can see that <strong class="source-inline">sshd.service</strong> is now active and ready to accept network connections.</p>
			<p>There's another<a id="_idIndexMarker399"/> aspect of this, which is to configure a service so that it's enabled<a id="_idIndexMarker400"/> on system boot. If we use <strong class="source-inline">sshd.service</strong> as an example:</p>
			<p class="source-code">systemctl enable sshd.service</p>
			<p>Also, if we don't want <strong class="source-inline">sshd.service</strong> to be enabled on system boot, we can do the opposite:</p>
			<p class="source-code">systemctl disable sshd.service</p>
			<p>When we deploy a new service, we can start and enable it at the same time. For example, let's say that we just installed the <strong class="source-inline">sshd</strong> service from a package. Let's enable and start it by using one command:</p>
			<p class="source-code">systemctl enable --now sshd.service</p>
			<p>Of course, that pre-supposes that we know the name of any given service, which isn't always the case. Let's learn how to overcome this problem in a text mode-driven way before we wrap this scenario up with a summary table to make things easier.</p>
			<p>If we want to list all of the available services, we can use the following<a id="_idIndexMarker401"/> command, as <strong class="source-inline">systemd</strong> and <strong class="source-inline">systemctl</strong> <em class="italic">know</em> more objects<a id="_idIndexMarker402"/> than just services (not the topic of this scenario):</p>
			<p class="source-code">systemctl list-units --type=service</p>
			<p class="source-code">-----</p>
			<p class="source-code">.......</p>
			<p class="source-code">.... part of the output ommited ....</p>
			<p class="source-code">systemd-journal-flush.service loaded active exited  Flush Journal to Persistent Storage</p>
			<p class="source-code">systemd-journald.service      loaded active running Journal Service</p>
			<p class="source-code">systemd-logind.service        loaded active running Login Service</p>
			<p class="source-code">systemd-machined.service      loaded active running Virtual Machine and Container Registration Service</p>
			<p class="source-code">systemd-modules-load.service  loaded active exited  Load Kernel Modules</p>
			<p class="source-code">systemd-random-seed.service   loaded active exited  Load/Save Random Seed</p>
			<p class="source-code">systemd-remount-fs.service    loaded active exited  Remount Root and Kernel File Systems</p>
			<p class="source-code">systemd-sysctl.service        loaded active exited  Apply Kernel Variables</p>
			<p class="source-code">systemd-sysusers.service      loaded active exited  Create System Users</p>
			<p class="source-code">systemd-tmpfiles-setup-dev.service    loaded active exited  Create Static Device Nodes in /dev</p>
			<p class="source-code">systemd-tmpfiles-setup.service        loaded active exited  Create Volatile Files and Directories</p>
			<p class="source-code">systemd-udev-settle.service   loaded active exited  udev Wait for Complete Device Initialization</p>
			<p class="source-code">systemd-udev-trigger.service  loaded active exited  udev Coldplug all Devices</p>
			<p class="source-code">systemd-udevd.service         loaded active running udev Kernel Device Manager</p>
			<p class="source-code">systemd-update-done.service   loaded active exited  Update is Completed</p>
			<p class="source-code">systemd-update-utmp.service   loaded active exited  Update UTMP about System Boot/Shutdown</p>
			<p class="source-code">systemd-user-sessions.service loaded active exited  Permit User Sessions</p>
			<p class="source-code">tuned.service                 loaded active running Dynamic System Tuning Daemon</p>
			<p class="source-code">udisks2.service               loaded active running Disk Manager</p>
			<p class="source-code">upower.service                loaded active running Daemon for power management</p>
			<p class="source-code">user-runtime-dir@0.service    loaded active exited  /run/user/0 mount wrapper</p>
			<p class="source-code">user-runtime-dir@42.service   loaded active exited  /run/user/42 mount wrapper</p>
			<p class="source-code">user@0.service                loaded active running User Manager for UID 0</p>
			<p class="source-code">user@42.service               loaded active running User Manager for UID 42</p>
			<p class="source-code">vdo.service                   loaded active exited  VDO volume services</p>
			<p class="source-code">vgauthd.service               loaded active running VGAuth Service for open-vm-tools</p>
			<p class="source-code">vmtoolsd.service              loaded active running Service for virtual machines hosted on VMware</p>
			<p class="source-code">wpa_supplicant.service        loaded active running WPA supplicant</p>
			<p>When we were going through one of our previous<a id="_idIndexMarker403"/> recipes, we discussed <strong class="source-inline">vdo</strong>. We can clearly see the <strong class="source-inline">vdo</strong> service<a id="_idIndexMarker404"/> listed here. Remember that we started it by using the <strong class="source-inline">systemctl</strong> command?</p>
			<p>If we want to check the list of all enabled services, we can use the following command:</p>
			<p class="source-code">systemctl list-units --type=service --state=enabled</p>
			<p>If we need a list of services running currently, execute the following command:</p>
			<p class="source-code">systemctl list-units --type=service --state=running</p>
			<p>The <strong class="source-inline">systemctl</strong> command – because of how it works<a id="_idIndexMarker405"/> and the related config files (covered in the <em class="italic">How it works…</em> section a bit later) – can also list service dependencies. For example, the <strong class="source-inline">sshd</strong> service needs some other services to be started so that it can work. Let's list the <strong class="source-inline">sshd</strong> dependencies:</p>
			<p class="source-code">systemctl list-dependencies sshd</p>
			<p>Therefore, let's just create a table with some of the most common service names so that we can manage this problem more efficiently:</p>
			<div>
				<div id="_idContainer143" class="IMG---Figure">
					<img src="Images/B16269_05_Table1.jpg" alt="Table 5.1 – A table with details about services and systemd service names&#13;&#10;" width="1650" height="1149"/>
				</div>
			</div>
			<p class="figure-caption">Table 5.1 – A table with details about services and systemd service names</p>
			<p>We can use the short names<a id="_idIndexMarker406"/> of these services (without <strong class="source-inline">.service</strong>) as well as the <em class="italic">Tab</em> key to use Bash shell<a id="_idIndexMarker407"/> completion to scroll through options and service names in <strong class="source-inline">systemctl</strong>. We can also mask <strong class="source-inline">systemd</strong> services, and therefore make them invisible to the system, by linking them from the service start up perspective to <strong class="source-inline">/dev/null</strong>:</p>
			<p class="source-code">systemctl mask cups.service</p>
			<p class="source-code">Created symlink /etc/systemd/system/cups.service → /dev/null.</p>
			<p>Here, we can get an idea of how all of this works. The <strong class="source-inline">systemctl</strong> command obviously uses some configuration<a id="_idIndexMarker408"/> files to do its job. Let's now discuss how<a id="_idIndexMarker409"/> and what's done.</p>
			<p>We could write books about systemd, but having this specific scenario in mind, we need to stick to the job at hand. We used the <strong class="source-inline">systemctl</strong> command to manage a service – right now (start/stop/restart), and permanently (enable/disable).</p>
			<h2 id="_idParaDest-133"><a id="_idTextAnchor136"/>How it works…</h2>
			<p>From the perspective of purely managing services, the <strong class="source-inline">systemctl</strong> command looks by checking into its configuration files. So, let's check the anatomy of a service file for <strong class="source-inline">systemd</strong>, again, using <strong class="source-inline">sshd</strong> as an example:</p>
			<div>
				<div id="_idContainer144" class="IMG---Figure">
					<img src="Images/Figure_5.20_B16269.jpg" alt="Figure 5.20 – Systemd configuration file – in this example, SSHD&#13;&#10;" width="1341" height="681"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.20 – Systemd configuration file – in this example, SSHD</p>
			<p>It's almost readable without a lot of explanation, which is one of the big differences between these service files and what was used in the past. </p>
			<p>The first part, which starts with the <strong class="source-inline">[Unit]</strong> section, is related to the general settings of the service – with a description and man pages for documentation being the first part of that. Then a statement tells us the order; that is, after which services should this specific service be started. <strong class="source-inline">Wants</strong> is related<a id="_idIndexMarker410"/> to dependencies – in this case, which targets<a id="_idIndexMarker411"/> need to be enabled for this service to be successfully started.</p>
			<p>The <strong class="source-inline">[Service]</strong> section is a bit trickier, as it tells us basic configuration details and start up options (the <strong class="source-inline">EnvironmentFile</strong> option), which commands should be used for starting and reloading the service, how to kill the service, and details related to restarting. Restarting is for selecting if the service will be restarted when there's a timeout, kill, or exit from the process service. <strong class="source-inline">RestartSec</strong> is about sleep time before the service restart.</p>
			<p>The <strong class="source-inline">[Install]</strong> section is a bit more global and related to how <strong class="source-inline">systemd</strong> works with this unit. <strong class="source-inline">WantedBy</strong> is used in the sense of creating additional dependencies between this specific service and other services, completely opposite to what <strong class="source-inline">[Unit]</strong> statements do.</p>
			<p>This is why, when we change or create new systemd unit/service/whatever files, we have to use the <strong class="source-inline">systemctl daemon-reload</strong> command. That command specifies that <strong class="source-inline">systemctl</strong> goes through all the config files and treats them as <em class="italic">yes, the administrator might have changed something in any of these files, but this is on purpose and OK</em>. </p>
			<h2 id="_idParaDest-134"><a id="_idTextAnchor137"/>There's more…</h2>
			<p>Bearing in mind the importance of systemd and its internals, as promised, let's provide our readers with some additional content related to systemd:</p>
			<ul>
				<li>Introduction<a id="_idIndexMarker412"/> to systemd: <strong class="source-inline">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/configuring_basic_system_settings/introduction-to-systemd_configuring-basic-system-settings</strong></li>
				<li>Managing system<a id="_idIndexMarker413"/> services with systemctl: <strong class="source-inline">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/configuring_basic_system_settings/managing-system-services-with-systemctl_configuring-basic-system-settings</strong></li>
				<li>Working with<a id="_idIndexMarker414"/> systemd targets: <strong class="source-inline">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/configuring_basic_system_settings/working-with-systemd-targets_configuring-basic-system-settings</strong></li>
				<li>Working with<a id="_idIndexMarker415"/> systemd unit files: <strong class="source-inline">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/configuring_basic_system_settings/assembly_working-with-systemd-unit-files_configuring-basic-system-settings</strong></li>
				<li>Optimizing systemd to shorten<a id="_idIndexMarker416"/> the boot time: <strong class="source-inline">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/configuring_basic_system_settings/optimizing-systemd-to-shorten-the-boot-time_configuring-basic-system-settings</strong></li>
				<li>Demystifying systemd: <strong class="source-inline">https://www.youtube.com/watch?v=tY9GYsoxeLg</strong></li>
			</ul>
		</div>
	</div></body></html>