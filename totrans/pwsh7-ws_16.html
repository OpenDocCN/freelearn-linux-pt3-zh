<html><head></head><body>
		<div id="_idContainer297">
			<h1 id="_idParaDest-315" class="chapter-number"><a id="_idTextAnchor320"/>16</h1>
			<h1 id="_idParaDest-316"><a id="_idTextAnchor321"/>Working with PowerShell and .NET</h1>
			<p>Here we are then, the last chapter. We’re going to look at the product that PowerShell 7 is built on, .NET, and how we can use it to expand the range of things we can do in PowerShell. Note that this chapter can’t be anything more than a whistlestop tour; .NET is a huge subject, and there are many, many more books written for it than there are for PowerShell. PowerShell is just one application written on .NET, and it only touches a subset of the things that we can do with .NET. That being said, let’s have a look at how it works and some of the exciting things we can use <span class="No-Break">it for.</span></p>
			<p>The main topics we will cover in this chapter are <span class="No-Break">as follows:</span></p>
			<ul>
				<li><span class="No-Break">Exploring .NET</span></li>
				<li>The components <span class="No-Break">of .NET</span></li>
				<li>Working with .NET <span class="No-Break">in PowerShell</span></li>
				<li><span class="No-Break">Using .NET</span></li>
			</ul>
			<h1 id="_idParaDest-317"><a id="_idTextAnchor322"/>Exploring .NET</h1>
			<p><strong class="bold">.NET</strong> (<strong class="bold">dot-net</strong>) is a software<a id="_idIndexMarker1101"/> framework. It’s free and open source and can be used to write web applications, command-line applications, and applications that run in a <strong class="bold">Graphical User Interface</strong> (<strong class="bold">GUI</strong>). It is <a id="_idIndexMarker1102"/>based on the proprietary coded .NET Framework, which is the software framework that the Windows operating system uses. It can be used with a range of programming languages, including C#, F#, and Visual Basic .NET. Let’s unpack all that, <span class="No-Break">shall we?</span></p>
			<h2 id="_idParaDest-318"><a id="_idTextAnchor323"/>Software frameworks explained</h2>
			<p>A software framework <a id="_idIndexMarker1103"/>is a tool for constructing applications. Some frameworks are written for specific purposes and specific languages; AngularJS is a framework for developing the frontends of web applications in JavaScript. PhaserJS is a game development framework, again for JavaScript. While frameworks contain many libraries, they differ from libraries in that libraries provide tools for our code that we can use in any way we like; with a framework, we need to work within the structure. The basics of an application are provided; we need to provide <span class="No-Break">the specifics.</span></p>
			<p>.NET implements a <strong class="bold">Common Language Infrastructure</strong> (<strong class="bold">CLI</strong>) that allows different high-level languages (such as C#) to be used on multiple operating system platforms, without needing<a id="_idIndexMarker1104"/> to be rewritten for each architecture; this is how PowerShell 7 can work on Intel and ARM processors. By installing the correct version of .NET, our PowerShell code can then <span class="No-Break">run anywhere.</span></p>
			<p>A .NET component <a id="_idIndexMarker1105"/>called <strong class="bold">CoreFX</strong> houses the .NET libraries of classes, interfaces, and value types<a id="_idIndexMarker1106"/> in a <strong class="bold">Framework Class Library</strong>. .NET provides more than just libraries, though. .NET applications run in a virtual machine<a id="_idIndexMarker1107"/> called <strong class="bold">CoreCLR</strong>, in the same way that Java applications run inside the Java <span class="No-Break">Virtual Machine.</span></p>
			<h2 id="_idParaDest-319"><a id="_idTextAnchor324"/>Common language infrastructure</h2>
			<p>The <a id="_idIndexMarker1108"/>CLI is an open technical standard <a id="_idIndexMarker1109"/>developed by Microsoft and is largely only found in variations of .NET, although there is an open development platform called <strong class="bold">Mono</strong> that <a id="_idIndexMarker1110"/>uses it as well. The CLI specifies <span class="No-Break">five things:</span></p>
			<ul>
				<li><strong class="bold">Common Type System (CTS)</strong> – the set of types that can be accessed by programming <a id="_idIndexMarker1111"/>languages using <span class="No-Break">the framework.</span></li>
				<li><strong class="bold">Metadata</strong>, which <a id="_idIndexMarker1112"/>is used to describe the <span class="No-Break">program </span><span class="No-Break">structure.</span></li>
				<li><strong class="bold">Common Language Specification (CLS)</strong> – rules <a id="_idIndexMarker1113"/>for using <span class="No-Break">the </span><span class="No-Break">framework.</span></li>
				<li><strong class="bold">Virtual Execution System (VES)</strong> – this loads and executes applications. It uses <a id="_idIndexMarker1114"/>metadata to run code generated in compliant languages at runtime, compiling them into a platform-agnostic <strong class="bold">Common Intermediate Language</strong> (<strong class="bold">CIL</strong>), which is<a id="_idIndexMarker1115"/> then compiled to a platform-specific machine language in real time. In .NET, the VES is implemented in the <span class="No-Break">CoreCLR component.</span></li>
				<li><strong class="bold">Standard libraries</strong>, which<a id="_idIndexMarker1116"/> provide common functions, such as accessing networks <span class="No-Break">and files.</span></li>
			</ul>
			<p>Let’s look at the <span class="No-Break">CoreCLR component.</span></p>
			<h2 id="_idParaDest-320"><a id="_idTextAnchor325"/>Common language runtime – CoreCLR</h2>
			<p>CoreCLR <a id="_idIndexMarker1117"/>provides<a id="_idIndexMarker1118"/> a common language runtime, which is a layer that sits between the application and the operating system. It is similar in principle to the PowerShell program; .NET applications need .NET to be running on the machine to interpret the application code as machine code. This means PowerShell needs .NET to be running, as PowerShell is a .<span class="No-Break">NET application.</span></p>
			<p>However, CoreCLR doesn’t just provide a runtime. It also includes additional services such as memory management (allocating portions of virtual memory to applications), garbage collection (recovering unused memory that is no longer needed), and thread management. This means that when we use .NET to write applications, we don’t need to worry about memory leaks or memory addressing errors, as all that is handled for us <span class="No-Break">by CoreCLR.</span></p>
			<p>Happily, we don’t need to know much about how CoreCLR works to use .NET with PowerShell. Most of what we are interested in is held in the libraries – <span class="No-Break">CoreFX.</span></p>
			<h2 id="_idParaDest-321"><a id="_idTextAnchor326"/>Framework Class Library – CoreFX</h2>
			<p>CoreFX <a id="_idIndexMarker1119"/>contains <a id="_idIndexMarker1120"/>the class libraries that .NET uses, which include types, functions, and classes. All the PowerShell data types, for instance, are a subset of the available .NET types. We’ve seen this already; in <a href="B17600_04.xhtml#_idTextAnchor071"><span class="No-Break"><em class="italic">Chapter 4</em></span></a>, <em class="italic">PowerShell Variables and Data Structures</em>, we saw that changing the contents of a PowerShell array was resource-intensive because each time we change an array, we create a new one and delete the old one. We saw that one of the solutions to this was to use a .NET type that is not available natively inside PowerShell, <strong class="source-inline">ArrayList</strong>, <span class="No-Break">like this:</span></p>
			<pre class="console">
$ArrayList = [System.Collections.ArrayList]@()
1..10000 | ForEach-Object { $Null = $ArrayList.Add($_) }</pre>			<p>We use the <strong class="source-inline">[System.Collections.ArrayList]</strong> full .NET type to set the array as <strong class="source-inline">ArrayList</strong>. Sometimes, working with .NET really is <span class="No-Break">that easy.</span></p>
			<h2 id="_idParaDest-322"><a id="_idTextAnchor327"/>.NET history</h2>
			<p>.NET Framework<a id="_idIndexMarker1121"/> was first released in 2002 and was intended to create Windows applications. It introduced the Microsoft concept of <strong class="bold">managed code</strong>, code that <a id="_idIndexMarker1122"/>would only interact with the CLI. Managed code could be more tightly controlled, both in terms of resource use and security, and it was also less prone to causing system crashes – the dreaded Blue Screen of Death – because it only touched the CLR, not the underlying operating system. In time, many of Microsoft’s most popular applications, such as Microsoft Exchange Server, were written in managed code and required .NET Framework to run. .NET Framework will only run on Windows and contains many <span class="No-Break">Windows-specific features.</span></p>
			<p>In 2014, Microsoft released .NET Core, an open source, cross-platform implementation of the CLI. This shared many features of .NET Framework but not all of them, and similarly, it contained many features that were not implemented in .NET Framework, notably the ability to run on different operating systems. In 2022, Microsoft released a new version of .NET Core, simply called .NET 5; the intention was that .NET would eventually overtake .NET Framework. As happened with PowerShell and Windows PowerShell, in practice, both versions now exist side by side. The latest release of .NET Framework, at the time of writing, is version 4.8.1 in August 2022, whereas .NET is released annually, around November; the latest version is .NET 8.0, released in <span class="No-Break">November 2023.</span></p>
			<p>So, what can we use .NET for? Let’s take <span class="No-Break">a look.</span></p>
			<h2 id="_idParaDest-323"><a id="_idTextAnchor328"/>The uses of .NET</h2>
			<p>.NET Framework<a id="_idIndexMarker1123"/> was developed to create Windows applications – while we can use it for command-line programs, it<a id="_idIndexMarker1124"/> includes the <strong class="bold">Windows Presentation Foundation</strong> (<strong class="bold">WPF</strong>) framework, ASP.NET (for internet applications), and Windows Forms for <span class="No-Break">graphical applications.</span></p>
			<p>The current iteration of .NET includes libraries for cloud-native applications and serverless functions on Azure, cross-platform desktop applications and games, mobile apps <a id="_idIndexMarker1125"/>using .NET <strong class="bold">Multi Application User Interface</strong> (<strong class="bold">MAUI</strong>), machine learning applications with ML.NET, and Internet of Things applications with .<span class="No-Break">NET IoT.</span></p>
			<p>The most mature libraries, however, are for Windows, and they include libraries for Windows Desktop apps with WPF, Windows Forms, and the <strong class="bold">Universal Windows Platform</strong> (<strong class="bold">UWP</strong>) and <a id="_idIndexMarker1126"/>Windows services libraries that allow us to run applications <span class="No-Break">as services.</span></p>
			<p>It would be easy to write a whole series of books on .NET, and many people have. However, we are mostly interested in how we can use .NET with PowerShell. We are going to focus on the .NET libraries and how we can access their contents from PowerShell, accessing in turn the APIs we wish to work with. Let’s start by looking at the structure of the .<span class="No-Break">NET libraries.</span></p>
			<h1 id="_idParaDest-324"><a id="_idTextAnchor329"/>The components of .NET</h1>
			<p>Before <a id="_idIndexMarker1127"/>we can start using the .NET libraries, we need to understand how they are structured. <strong class="bold">Members</strong> (properties, methods, etc.) are contained inside <strong class="bold">types</strong>, which in turn are contained in <strong class="bold">namespaces</strong>. This is <strong class="bold">logical type containment</strong>. There is also <strong class="bold">physical type containment</strong>. These logical structures are physically held in <strong class="bold">assemblies</strong>. We’ve already seen many of these components in PowerShell. Let’s start <span class="No-Break">with assemblies.</span></p>
			<h2 id="_idParaDest-325"><a id="_idTextAnchor330"/>Assemblies</h2>
			<p>Assemblies are<a id="_idIndexMarker1128"/> collections of types and the resources needed to support them. They can be <a id="_idIndexMarker1129"/>either <strong class="bold">static</strong>, loaded from a file, or <strong class="bold">dynamic</strong>, existing <a id="_idIndexMarker1130"/>solely in memory. PowerShell will load a number of default <a id="_idIndexMarker1131"/>assemblies at startup, and then, as we import modules, that list will expand. We can see the list of assemblies we have loaded with <span class="No-Break">the following:</span></p>
			<pre class="console">
[System.AppDomain]::CurrentDomain.GetAssemblies()</pre>			<p>That will output a table <span class="No-Break">like this:</span></p>
			<div>
				<div id="_idContainer288" class="IMG---Figure">
					<img src="image/B17600_16_1.jpg" alt="Figure 16.1 – Enumerating assemblies"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 16.1 – Enumerating assemblies</p>
			<p>We can see <a id="_idIndexMarker1132"/>the version and the location of the files that these static assemblies <a id="_idIndexMarker1133"/>are stored in. There is another column, <strong class="source-inline">GAC</strong>, which refers to <a id="_idIndexMarker1134"/>the <strong class="bold">Global Assembly Cache</strong>; this is a storage area for assembly files that can be used by any .NET Framework application. Unfortunately, it only works in .NET Framework, so PowerShell 7 doesn’t reference it; all assemblies loaded in PowerShell 7 will show a GAC value of <strong class="source-inline">False</strong>. We can use assemblies that are usually stored in the GAC by installing them with NuGet, the .NET package manager; we just can’t access them from the GAC. We can also see that the assemblies are <strong class="source-inline">.dll</strong> files, which we talked about when discussing binary modules in <a href="B17600_11.xhtml#_idTextAnchor218"><span class="No-Break"><em class="italic">Chapter 11</em></span></a>, <em class="italic">Creating Our First Module</em>, and we also saw that binary modules are a type of .NET assembly. We can think of loading .NET assemblies as similar to loading binary modules. PowerShell loads a set of default assemblies when it starts, and these assemblies define the types that are available to us. To access other types, we need to load <span class="No-Break">further assemblies.</span></p>
			<h2 id="_idParaDest-326"><a id="_idTextAnchor331"/>Types</h2>
			<p>We first<a id="_idIndexMarker1135"/> encountered types in <a href="B17600_04.xhtml#_idTextAnchor071"><span class="No-Break"><em class="italic">Chapter 4</em></span></a>, <em class="italic">PowerShell Variables and Data Structures</em>. The<a id="_idIndexMarker1136"/> PowerShell types are a subset of the types found in .NET. We used a .NET type earlier in the chapter when we created an <strong class="source-inline">ArrayList</strong> object. Types are enclosed in <span class="No-Break">square brackets.</span></p>
			<p class="callout-heading">Type versus class</p>
			<p class="callout">In type theory, a type is an abstract concept, whereas a class is a set of instructions to create an object of a given type. An object is of a certain type – for example, a string or an imaginary bike. A class is an implementation of the type. An object is an instance of the class. For instance, we could have multiple different classes of an imaginary bike that would all be of type <strong class="source-inline">Imaginary.Bike</strong>, but they could all have different features – for example, ape hanger handlebars or drop handlebars. We could then create many instances of each class (i.e., objects) – in this case, <span class="No-Break">imaginary bikes.</span></p>
			<p class="callout">In practice, classes are user-defined in PowerShell, whereas types are provided by .NET – except, of course, where that <span class="No-Break">isn’t true.</span></p>
			<h2 id="_idParaDest-327"><a id="_idTextAnchor332"/>Enumerations</h2>
			<p>An<a id="_idIndexMarker1137"/> enumeration is a list of constant values. While we haven’t discussed<a id="_idIndexMarker1138"/> them before, we have certainly used them. In <a href="B17600_10.xhtml#_idTextAnchor201"><span class="No-Break"><em class="italic">Chapter 10</em></span></a>, <em class="italic">Error Handling – Oh No! It’s Gone Wrong!</em>, we saw the <strong class="source-inline">$ErrorActionPreference</strong> automatic variable and how, by changing the value of the variable, we could control how PowerShell handles errors temporarily. We can check the type of the <strong class="source-inline">$ErrorActionPreference</strong> variable by calling the variable <strong class="source-inline">GetType()</strong> method, and we can see that it is a <strong class="source-inline">System.Enum</strong> type in the <span class="No-Break">following screenshot:</span></p>
			<div>
				<div id="_idContainer289" class="IMG---Figure">
					<img src="image/B17600_16_2.jpg" alt="Figure 16.2 – How can I set thee? Let me count the ways"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 16.2 – How can I set thee? Let me count the ways</p>
			<p>We can list out the list of possible values with the <strong class="source-inline">GetEnumValues()</strong> method, and we can see the familiar list of possible values. <strong class="source-inline">$ErrorActionPreference</strong> can only have those values, and we can’t <span class="No-Break">change them.</span></p>
			<h2 id="_idParaDest-328"><a id="_idTextAnchor333"/>Classes</h2>
			<p>A <a id="_idIndexMarker1139"/>class <a id="_idIndexMarker1140"/>is a logical definition of an object that defines the properties and methods of the object – a recipe. It is an implementation of a type. Back in <a href="B17600_04.xhtml#_idTextAnchor071"><span class="No-Break"><em class="italic">Chapter 4</em></span></a>, <em class="italic">PowerShell Variables and Data Structures</em>, we created three objects of type <strong class="source-inline">Imaginary.Bike</strong>,  by creating the objects and their properties and labeling <a id="_idIndexMarker1141"/>them as <strong class="source-inline">Imaginary.Bike</strong>. We could also have <a id="_idIndexMarker1142"/>defined a class of objects called <strong class="source-inline">Imaginary.Bike</strong> with the same properties and methods, using a <strong class="bold">constructor</strong> to create actual instances of the class. We use classes when we want to be able to create objects easily <span class="No-Break">and repeatably.</span></p>
			<h2 id="_idParaDest-329"><a id="_idTextAnchor334"/>Namespaces</h2>
			<p>Namespaces <a id="_idIndexMarker1143"/>are analogous to folders in a filesystem; we <a id="_idIndexMarker1144"/>saw namespaces used in this context in <a href="B17600_13.xhtml#_idTextAnchor267"><span class="No-Break"><em class="italic">Chapter 13</em></span></a>, <em class="italic">Working With PowerShell 7 and Windows</em>, when we discussed CIM classes. Most PowerShell types and functions are found in the <strong class="source-inline">System.Management.Automation</strong> namespace. When we interact with the filesystem, we use the <strong class="source-inline">System.IO</strong> namespace. We don’t need to write <strong class="source-inline">System</strong> when we refer to a namespace in PowerShell, as the <strong class="source-inline">System</strong> namespace is automatically searched; <strong class="source-inline">Management.Automation</strong> is functionally the same as <strong class="source-inline">System.Management.Automation</strong>. Unfortunately, we need to specify the namespace of any type that isn’t immediately in the <strong class="source-inline">System</strong> namespace, <span class="No-Break">like this:</span></p>
			<div>
				<div id="_idContainer290" class="IMG---Figure">
					<img src="image/B17600_16_3.jpg" alt="Figure 16.3 – Accessing namespaces"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 16.3 – Accessing namespaces</p>
			<p>The <strong class="source-inline">Path</strong> type defines the file path of an object and is in the <strong class="source-inline">System.IO</strong> namespace. If we try to reference<a id="_idIndexMarker1145"/> it without specifying the namespace in line 1, we get an error. In line 2, we specify the full namespace, but in line 3, we can see that we don’t need to specify the <strong class="source-inline">System</strong> portion of the namespace, as it <span class="No-Break">is implied.</span></p>
			<p>We can also use the <strong class="source-inline">using</strong> keyword to load the namespace, <span class="No-Break">like this:</span></p>
			<pre class="console">
using namespace System.IO</pre>			<p>After running this, we can call the <strong class="source-inline">Path</strong> type without specifying the namespace, <span class="No-Break">like this:</span></p>
			<div>
				<div id="_idContainer291" class="IMG---Figure">
					<img src="image/B17600_16_4.jpg" alt="Figure 16.4 – The using keyword in action"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 16.4 – The using keyword in action</p>
			<p>We saw<a id="_idIndexMarker1146"/> the <strong class="source-inline">using</strong> keyword in <a href="B17600_11.xhtml#_idTextAnchor218"><span class="No-Break"><em class="italic">Chapter 11</em></span></a>, <em class="italic">Creating Our First Module</em>, where we learned it was the recommended way of loading modules inside a script. As we can see, we can also use it to load namespaces and assemblies. Unfortunately, in the console, only the most recent <strong class="source-inline">using</strong> statement is applied, so if we access another namespace with it in the current session, we will lose access to the <strong class="source-inline">System.IO</strong> namespace. Scripts allow multiple <strong class="source-inline">using</strong> statements, written at the start of the script; they can only be preceded by comments. We can load multiple namespaces in the console by using semicolons (<strong class="source-inline">;</strong>) to separate the <span class="No-Break"><strong class="source-inline">using</strong></span><span class="No-Break"> statements.</span></p>
			<h2 id="_idParaDest-330"><a id="_idTextAnchor335"/>Members</h2>
			<p>Types and classes <a id="_idIndexMarker1147"/>have members; throughout the book, we <a id="_idIndexMarker1148"/>have used the <strong class="source-inline">Get-Member</strong> command to examine the properties and methods available on objects, and we’ve seen that objects are instances of a specific type. .NET types have a member we have not seen before, the constructor. Constructors provide ways of instantiating objects of the given class and take the same name as the class. They don’t appear when we run <strong class="source-inline">Get-Member</strong> against the class and can’t be directly called. Constructors may have parameters that we can use to populate the data members of the new object, or they may not; the object is created with a set of null value properties. Constructors may have overloads, where different sets of arguments can be passed when constructing the object. Most .NET classes have an automatic constructor called <strong class="source-inline">new()</strong>, which is a static method added <span class="No-Break">by PowerShell.</span></p>
			<p>Let’s look at <a id="_idIndexMarker1149"/>an example. The <strong class="source-inline">[string]</strong> type is immutable; when we change a string, we destroy the old string and create a new one. If we need the string to change frequently, this can cause a performance problem, much the same as the issue we have seen with arrays. There is a class in .NET that defines mutable strings that get around this problem; it’s called the <strong class="source-inline">StringBuilder</strong> class, and objects of this class are of type <strong class="source-inline">System.Text.Stringbuilder</strong>. If we create a new <strong class="source-inline">StringBuilder</strong> object with the default automatic<a id="_idIndexMarker1150"/> constructor, we get an object with three properties, <strong class="source-inline">Capacity</strong>, <strong class="source-inline">MaxCapacity</strong>, and <strong class="source-inline">Length</strong>, in characters. If we call the <strong class="source-inline">new()</strong> method without the brackets, then we can see a list of the <span class="No-Break">possible overloads:</span></p>
			<div>
				<div id="_idContainer292" class="IMG---Figure">
					<img src="image/B17600_16_5.jpg" alt="Figure 16.5 – The overloads of the StringBuilder class"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 16.5 – The overloads of the StringBuilder class</p>
			<p>As we can see, we can pass different combinations of arguments to the <strong class="source-inline">new()</strong> method to construct <strong class="source-inline">StringBuilder</strong> objects with different properties. Let’s try it. Type <span class="No-Break">the following:</span></p>
			<pre class="console">
$string1 = ([System.Text.StringBuilder]::new(32))
$string2 = ([System.Text.StringBuilder]::new('32'))</pre>			<p>Now, if we call <strong class="source-inline">$string1</strong> and <strong class="source-inline">$string2</strong>, we can see that <strong class="source-inline">$string1</strong> is empty and has a capacity of 32. <strong class="source-inline">$string2</strong> has a length of 2 and a capacity of 16. That’s because we called the overload <strong class="source-inline">new(int capacity)</strong> for <strong class="source-inline">$string1</strong> and the overload <strong class="source-inline">new(string value)</strong> <span class="No-Break">for </span><span class="No-Break"><strong class="source-inline">$string2</strong></span><span class="No-Break">.</span></p>
			<p>We can use the <strong class="source-inline">ToString()</strong> method to see the contents, <span class="No-Break">like this:</span></p>
			<pre class="console">
$string1.tostring()
$string2.tostring()</pre>			<p><strong class="source-inline">$string1</strong> is empty, and <strong class="source-inline">$string2</strong> contains the <strong class="source-inline">'32'</strong> string. If we use the <strong class="source-inline">GetType()</strong> method, we can see that both are <strong class="source-inline">StringBuilder</strong> objects. If we pipe them to the <strong class="source-inline">Get-Member</strong> cmdlet, we can also see that the <strong class="source-inline">new()</strong> method isn’t listed because it’s <span class="No-Break">a constructor.</span></p>
			<h2 id="_idParaDest-331"><a id="_idTextAnchor336"/>Versioning</h2>
			<p>An <a id="_idIndexMarker1151"/>assembly<a id="_idIndexMarker1152"/> is a <strong class="source-inline">.dll</strong> file that contains metadata <a id="_idIndexMarker1153"/>called the assembly manifest, which lists the contents of the file, as well as the name and the version of the file. The concept of strong names was introduced in .NET; a strong name consists of the name of the module, the version, and also a cryptographic hash that validates the file author. When .NET programs are linked to a strong named assembly, then the name, version, and hash of the file must match the linked strong name. If we simply replace the <strong class="source-inline">.dll</strong> file with a later version, then the program will fail to load it. This leads to different versions of <strong class="source-inline">.dll</strong> that have the same version number to prevent introducing breaking <span class="No-Break">changes. Great.</span></p>
			<p>There are many other components, but these are the things we most need to be aware of when working with .NET and PowerShell. Let’s look now at how PowerShell makes use <span class="No-Break">of .NET.</span></p>
			<h1 id="_idParaDest-332"><a id="_idTextAnchor337"/>Working with .NET in PowerShell</h1>
			<p>In this section, we <a id="_idIndexMarker1154"/>are going to look at some of the details of how PowerShell accesses .NET libraries. We’ll look at the default assemblies, how PowerShell finds types, and another way of <span class="No-Break">creating objects.</span></p>
			<p class="callout-heading">Why bother?</p>
			<p class="callout">PowerShell and C# are part of the .NET family and thus work well together, as they are based on the same .NET foundation. They share many features, such as classes and libraries. We can call C# inside PowerShell by using <strong class="source-inline">Add-Type</strong>, allowing us to compile and run the C# code when we run the PowerShell script. This lets us take advantage of the simplicity and ease of PowerShell, but we have C# available whenever we need it, without having to write an <span class="No-Break">entire program.</span></p>
			<h2 id="_idParaDest-333"><a id="_idTextAnchor338"/>PowerShell assemblies</h2>
			<p>We saw at the <a id="_idIndexMarker1155"/>start of the chapter that we could list the loaded assemblies with <span class="No-Break">the statement:</span></p>
			<pre class="console">
[System.AppDomain]::CurrentDomain.GetAssemblies()</pre>			<p><strong class="source-inline">AppDomain</strong> is a class that encapsulates and isolates the execution environment; it’s a bit like <strong class="source-inline">PSSession</strong> but even more secure; each instance of <strong class="source-inline">PSSession</strong> shares a set of assemblies, whereas each instance of <strong class="source-inline">AppDomain</strong> loads its own assemblies. <strong class="source-inline">CurrentDomain</strong> gets the current execution environment. The double colon (<strong class="source-inline">::</strong>) represents the C# namespace alias operator; we need to use it to access a member of an aliased namespace, and it goes between two identifiers. Let’s run the statement again, <span class="No-Break">like this:</span></p>
			<pre class="console">
[System.AppDomain]::CurrentDomain.GetAssemblies() | select FullName</pre>			<p>Then, we can see a list of the strong names of the assemblies <span class="No-Break">we’ve loaded:</span></p>
			<div>
				<div id="_idContainer293" class="IMG---Figure">
					<img src="image/B17600_16_6.jpg" alt="Figure 16.6 – Default assemblies and their strong names"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 16.6 – Default assemblies and their strong names</p>
			<p>Note that each strong name contains a short name, a version, a culture identifier, and the cryptographic key that identifies <span class="No-Break">the author.</span></p>
			<h2 id="_idParaDest-334"><a id="_idTextAnchor339"/>Dynamic assembly loading</h2>
			<p>Automatic loading <a id="_idIndexMarker1156"/>works for compiled programs such as <strong class="source-inline">pwsh.exe</strong>, but it relies on the required assembly list in the executable. We can add required assemblies to a module manifest as well, in the <strong class="source-inline">RequiredAssemblies</strong> element. If we need to load non-default assemblies when writing scripts, we can use the preceding <strong class="source-inline">using</strong> keyword, the <strong class="source-inline">Add-Type</strong> cmdlet, or even the <strong class="source-inline">Import-Module</strong> cmdlet if the assembly is in a <strong class="source-inline">.</strong><span class="No-Break"><strong class="source-inline">dll</strong></span><span class="No-Break"> file.</span></p>
			<p>The <strong class="source-inline">Add-Type</strong> cmdlet<a id="_idIndexMarker1157"/> has five parameter sets; three of them are for defining new types, but we can also use it to import assemblies from a named path, or to just import the types we need from the assembly, such as <span class="No-Break">the following:</span></p>
			<pre class="console">
Add-Type -AssemblyName PresentationCore,PresentationFramework</pre>			<p>This will add the assemblies required to call simple Windows GUI elements from <span class="No-Break">within PowerShell.</span></p>
			<p>Once we’ve imported (or created) our new type, we can create instances of types with the <span class="No-Break"><strong class="source-inline">New-Object</strong></span><span class="No-Break"> cmdlet.</span></p>
			<h2 id="_idParaDest-335"><a id="_idTextAnchor340"/>Creating instances of types</h2>
			<p>The <strong class="source-inline">New-Object</strong> cmdlet <a id="_idIndexMarker1158"/>creates an instance of a type. Either the type must exist inside the PowerShell default assemblies, or we must import it first with <strong class="source-inline">Add-Type</strong>. <strong class="source-inline">New-Object</strong> is easy to use. All we need to provide is <strong class="source-inline">TypeName</strong> and a list of arguments that matches one of the available overloads. For instance, one of the overloads on the <strong class="source-inline">StringBuilder</strong> type allows a string to define the value of the new object, and an integer to define the initial capacity. Note that it takes a string value, (<strong class="source-inline">System.Text.String.Builder</strong>), not a namespace and namespace alias qualifier (<strong class="source-inline">[System.Text.StringBuilder]::</strong>), so we can <span class="No-Break">do this:</span></p>
			<pre class="console">
$loveit = (New-Object -TypeName System.Text.StringBuilder -ArgumentList "i love powershell", 128)</pre>			<p>That will create a variable called <strong class="source-inline">$loveit</strong> that contains the <strong class="source-inline">"i love PowerShell"</strong> string and has an initial capacity of <span class="No-Break">128 characters:</span></p>
			<div>
				<div id="_idContainer294" class="IMG---Figure">
					<img src="image/B17600_16_7.jpg" alt="Figure 16.7 – Loving it"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 16.7 – Loving it</p>
			<p>We can see in the preceding screenshot that the initial capacity is 128, whereas we would expect it to be 17, the length of the string, if we had just passed a string value. Note that we have to understand the required arguments for the overload we wish to use as a constructor – in this instance, <strong class="source-inline">"i love powershell"</strong> and <strong class="source-inline">128</strong>. For instance, if we supply two strings, we will get <span class="No-Break">an error.</span></p>
			<p>An<a id="_idIndexMarker1159"/> alternative is to use the <strong class="source-inline">-Property</strong> parameter, which accepts a hashtable of property names and the required values. We’ll see how to use that in the next section, but note that if you misspell a property, PowerShell will simply add the misspelled property to the object, rather than tell you that you have <span class="No-Break">it wrong.</span></p>
			<p>Let’s try a couple of examples to get a feel for how we can use .NET <span class="No-Break">with PowerShell.</span></p>
			<h1 id="_idParaDest-336"><a id="_idTextAnchor341"/>Using .NET</h1>
			<p>We’ll try two examples in this section – an alternative way of getting an action to fire, such as a script, and how we can call Windows GUI elements <span class="No-Break">from PowerShell.</span></p>
			<h2 id="_idParaDest-337"><a id="_idTextAnchor342"/>An alternative to the Task Scheduler</h2>
			<p>In this <a id="_idIndexMarker1160"/>example, we’re going to create a timer object and then use the <strong class="source-inline">Register-Event</strong> cmdlet to fire an action at <span class="No-Break">regular intervals.</span></p>
			<p>First, let’s make <span class="No-Break">a timer:</span></p>
			<pre class="console">
$timer = (New-Object -TypeName System.Timers.Timer -Property @{
AutoReset = $true
Interval = 5000
Enabled = $true
}
)</pre>			<p>Now, we need to register the event and define <span class="No-Break">an action:</span></p>
			<pre class="console">
Register-ObjectEvent -InputObject $timer -EventName Elapsed -SourceIdentifier Test -Action {Write-Host "hello"}</pre>			<p>Now, let’s start the timer going with <span class="No-Break">the following:</span></p>
			<pre class="console">
$timer.start()</pre>			<p>Then, we<a id="_idIndexMarker1161"/> should see the <strong class="source-inline">hello</strong> string appear on the screen, every five seconds, until we type <span class="No-Break">the following:</span></p>
			<pre class="console">
$timer.stop()</pre>			<p>This is how it looks on <span class="No-Break">my machine:</span></p>
			<div>
				<div id="_idContainer295" class="IMG---Figure">
					<img src="image/B17600_16_8.jpg" alt="Figure 16.8 – hello"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 16.8 – hello</p>
			<p>We can see the command firing every time the timer reaches 5,000 milliseconds. <span class="No-Break">Cool, eh?</span></p>
			<p>Let’s try creating a GUI <span class="No-Break">message box.</span></p>
			<h2 id="_idParaDest-338"><a id="_idTextAnchor343"/>Creating GUI objects</h2>
			<p>This example <a id="_idIndexMarker1162"/>will create a pop-up message box in Windows with a pair of yes/no buttons. The value of the pressed button is recorded in the <span class="No-Break">PowerShell session:</span></p>
			<pre class="console">
Add-Type -AssemblyName PresentationCore,PresentationFramework
$Button = [System.Windows.MessageBoxButton]::YesNo
$Title = "PowerShell for Everyone"
$Body = "Do you love PowerShell?"
$Icon = [System.Windows.MessageBoxImage]::Warning
[System.Windows.MessageBox]::Show($Body,$Title,$Button,$Icon)</pre>			<p>We<a id="_idIndexMarker1163"/> could use this in conjunction with the preceding timer object to display a message box, allowing people to cancel a long-running script. This is how it looks on <span class="No-Break">my machine:</span></p>
			<div>
				<div id="_idContainer296" class="IMG---Figure">
					<img src="image/B17600_16_9.jpg" alt="Figure 16.9 – Of course you do"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 16.9 – Of course you do</p>
			<p>Note that the default answer is <strong class="bold">Yes</strong>. We could also use the response to set parameters, add an event, or trigger a <span class="No-Break">conditional statement.</span></p>
			<p>Let’s summarize what we’ve seen in <span class="No-Break">this chapter.</span></p>
			<h1 id="_idParaDest-339"><a id="_idTextAnchor344"/>Summary</h1>
			<p>We started out by understanding what .NET is – a software framework. We learned that it is based on the Common Language Infrastructure and is similar to .NET Framework in Windows, but it is not the same. We saw that it includes its own runtime, CoreCLR, and a set of libraries, CoreFX. We learned about the relationship between .NET and .NET Framework and how they co-exist. We saw that .NET can be used for many things, including machine learning and Internet of Things applications, but is mostly used for Azure <span class="No-Break">and Windows.</span></p>
			<p>We went through the components of .NET, and we understood how they are related to each other and are represented in PowerShell. We saw the constructor member, a special type of method for instantiating objects, and understood why versioning is <span class="No-Break">frequently confusing.</span></p>
			<p>We then looked at the specifics of how we access .NET libraries from PowerShell, learned about dynamic loading, and then saw how to use the <strong class="source-inline">New-Object</strong> cmdlet to create instances <span class="No-Break">of classes.</span></p>
			<p>Finally, we worked through two examples of things we can do using .NET – creating an event timer and a Windows <span class="No-Break">message box.</span></p>
			<p>What’s next? Well, it depends. If you want to learn more about PowerShell, then there are great books such as <em class="italic">Mastering PowerShell Scripting</em> by Chris Dent from Packt, or the absolute bible, <em class="italic">Windows PowerShell in Action</em> by Bruce Payette et al. Whichever you choose, what you need to do is practice, practice, practice. The best way to become confident with a language, any language, is to use it. If you are interested in .NET, then PowerShell is a good start, but sooner or later, you will want to use a compiled language with it, such as C#. While it’s technically possible to write a machine learning application in PowerShell, I think it would be a lot easier to do it <span class="No-Break">with C#.</span></p>
			<p>That’s it. That’s the end of the book. Thank you for sticking with it alongside me; I hope you enjoyed reading it as much as I enjoyed writing it. I can assure you I have learned a lot in the process, and hopefully, so have you. I hope you’ve enjoyed my company as much as I’ve <span class="No-Break">enjoyed yours.</span></p>
			<h1 id="_idParaDest-340"><a id="_idTextAnchor345"/>Exercises</h1>
			<ol>
				<li>How do you create a new instance of a .NET class <span class="No-Break">in PowerShell?</span></li>
				<li>What command in PowerShell is used to add a .NET assembly to <span class="No-Break">the session?</span></li>
				<li>How do you call a static method of a .NET class <span class="No-Break">in PowerShell?</span></li>
				<li>In PowerShell, how can you access a static property of a .<span class="No-Break">NET class?</span></li>
				<li>How can you invoke a .NET constructor with parameters <span class="No-Break">in PowerShell?</span></li>
				<li>What is the PowerShell cmdlet to load a .NET assembly from <span class="No-Break">a file?</span></li>
				<li>How can you determine the .NET type of an object <span class="No-Break">in PowerShell?</span></li>
				<li>In PowerShell, how do you list all the methods of a .<span class="No-Break">NET object?</span></li>
				<li>What is the syntax to invoke an instance method of a .NET object <span class="No-Break">in PowerShell?</span></li>
				<li>How do you access an instance property of a .NET object <span class="No-Break">in PowerShell?</span></li>
			</ol>
			<h1 id="_idParaDest-341"><a id="_idTextAnchor346"/>Further reading</h1>
			<ul>
				<li>What is .<span class="No-Break">NET?: </span><a href="https://dotnet.microsoft.com/en-us/learn/dotnet/what-is-dotnet"><span class="No-Break">https://dotnet.microsoft.com/en-us/learn/dotnet/what-is-dotnet</span></a></li>
				<li>The Microsoft .NET <span class="No-Break">documentation: </span><a href="https://learn.microsoft.com/en-us/dotnet/core/introduction"><span class="No-Break">https://learn.microsoft.com/en-us/dotnet/core/introduction</span></a></li>
				<li>The original .NET documentation; surprisingly <span class="No-Break">useful: </span><a href="https://learn.microsoft.com/en-us/previous-versions/tn-archive/bb496996(v=technet.10)"><span class="No-Break">https://learn.microsoft.com/en-us/previous-versions/tn-archive/bb496996(v=technet.10)</span></a></li>
				<li>The <strong class="source-inline">System.Management.Automation</strong> <span class="No-Break">namespace: </span><a href="https://learn.microsoft.com/en-gb/dotnet/api/system.management.automation"><span class="No-Break">https://learn.microsoft.com/en-gb/dotnet/api/system.management.automation</span></a></li>
				<li><span class="No-Break">Classes: </span><a href="https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_classes"><span class="No-Break">https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_classes</span></a></li>
				<li><span class="No-Break">Constructors: </span><a href="https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_classes_constructors"><span class="No-Break">https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_classes_constructors</span></a></li>
				<li>The <strong class="source-inline">StringBuilder</strong> <span class="No-Break">class: </span><a href="https://learn.microsoft.com/en-gb/dotnet/api/system.text.stringbuilder"><span class="No-Break">https://learn.microsoft.com/en-gb/dotnet/api/system.text.stringbuilder</span></a></li>
				<li><span class="No-Break"><strong class="source-inline">Add-Type</strong></span><span class="No-Break">: </span><a href="https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/add-type"><span class="No-Break">https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/add-type</span></a></li>
				<li><span class="No-Break"><strong class="source-inline">New-Object</strong></span><span class="No-Break">: </span><a href="https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/new-object"><span class="No-Break">https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/new-object</span></a></li>
				<li>The <strong class="source-inline">Timer</strong> <span class="No-Break">class: </span><a href="https://learn.microsoft.com/en-us/dotnet/api/system.timers.timer"><span class="No-Break">https://learn.microsoft.com/en-us/dotnet/api/system.timers.timer</span></a></li>
				<li><span class="No-Break"><strong class="source-inline">Register-ObjectEvent</strong></span><span class="No-Break">: </span><a href="https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/register-objectevent"><span class="No-Break">https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/register-objectevent</span></a></li>
				<li>PowerShell <span class="No-Break">Eventing: </span><a href="https://devblogs.microsoft.com/powershell/powershell-eventing-quickstart/"><span class="No-Break">https://devblogs.microsoft.com/powershell/powershell-eventing-quickstart/</span></a></li>
				<li>Learn <span class="No-Break">C#: </span><a href="https://dotnet.microsoft.com/en-us/learn/csharp"><span class="No-Break">https://dotnet.microsoft.com/en-us/learn/csharp</span></a></li>
			</ul>
		</div>
	

		<div id="_idContainer313">
			<h1 id="_idParaDest-342"><a id="_idTextAnchor347"/>Answers to Activities and Exercises</h1>
			<h1 id="_idParaDest-343"><a id="_idTextAnchor348"/><a href="B17600_01.xhtml#_idTextAnchor013">Chapter 1</a></h1>
			<h2 id="_idParaDest-344"><a id="_idTextAnchor349"/>Activities</h2>
			<ol>
				<li>You can use <strong class="source-inline">ADD_FILE_CONTEXT_MENU_RUNPOWERSHELL</strong>, <span class="No-Break">like this:</span><pre class="source-code">
<strong class="bold">msiexec.exe /package c:\Users\WDAGUtilityAccount\Downloads\PowerShell-7.2.1-win-x64.msi /quiet REGISTER_MANIFEST=1 USE_MU=1 ENABLE_MU=1 ADD_FILE_CONTEXT_MENU_RUNPOWERSHELL=1</strong></pre></li>				<li>By using <strong class="source-inline">kill()</strong>. Charming, right? <strong class="source-inline">CloseMainWindow(</strong><strong class="source-inline">)</strong> might work for a graphical process, and <strong class="source-inline">Close(</strong><strong class="source-inline">)</strong> will ask politely, but <strong class="source-inline">kill(</strong><strong class="source-inline">)</strong> should do it. Note that sometimes it won’t, for instance, if the process you are trying to kill is running with higher privileges than the account you are running <span class="No-Break">PowerShell with.</span><p class="list-inset">You can use it like this. Here’s my list of <span class="No-Break"><strong class="source-inline">pwsh</strong></span><span class="No-Break"> processes:</span></p></li>
			</ol>
			<div>
				<div id="_idContainer298" class="IMG---Figure">
					<img src="image/B17600_Assessments_001.jpg" alt="Figure A.1 – Some PowerShell processes"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure A.1 – Some PowerShell processes</p>
			<p class="list-inset">Let’s get rid <span class="No-Break">of </span><span class="No-Break"><strong class="source-inline">4052</strong></span><span class="No-Break">:</span></p>
			<div>
				<div id="_idContainer299" class="IMG---Figure">
					<img src="image/B17600_Assessments_002.jpg" alt="Figure A.2 – Fewer PowerShell processes"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure A.2 – Fewer PowerShell processes</p>
			<h2 id="_idParaDest-345"><a id="_idTextAnchor350"/>Exercises</h2>
			<ol>
				<li value="1"><span class="No-Break">Input </span><span class="No-Break"><strong class="source-inline">Get-Random</strong></span><span class="No-Break">.</span></li>
				<li>Input <strong class="source-inline">Get-Random -Minimum 1 -</strong><span class="No-Break"><strong class="source-inline">Maximum 11</strong></span><span class="No-Break">.</span></li>
				<li>Input <strong class="source-inline">Get-ChildItem -</strong><span class="No-Break"><strong class="source-inline">Path &lt;folderpath&gt;</strong></span><span class="No-Break">.</span></li>
				<li>Input <strong class="source-inline">Get-ChildItem -Path &lt;</strong><span class="No-Break"><strong class="source-inline">folderpath&gt; -Recurse</strong></span><span class="No-Break">.</span></li>
				<li>Input <strong class="source-inline">New-Item -Path &lt;folder path&gt; -Name &lt;item </strong><span class="No-Break"><strong class="source-inline">name&gt; -ItemType</strong></span><span class="No-Break">.</span></li>
				<li><span class="No-Break">Directory.</span></li>
				<li><span class="No-Break">Input </span><span class="No-Break"><strong class="source-inline">Get-Uptime</strong></span><span class="No-Break">.</span></li>
				<li><span class="No-Break">Input </span><span class="No-Break"><strong class="source-inline">Out-File</strong></span><span class="No-Break">.</span></li>
				<li>Store a username and password for use later in the shell or in <span class="No-Break">a script.</span></li>
				<li>This cmdlet converts the output of a previous cmdlet or pipeline to HTML, which can then be displayed in a web browser. Note that you might need to save it as a file using <strong class="source-inline">out-file</strong> as well, or it will just display the HTML code in <span class="No-Break">the shell.</span></li>
			</ol>
			<h1 id="_idParaDest-346"><a id="_idTextAnchor351"/><a href="B17600_02.xhtml#_idTextAnchor034">Chapter 2</a></h1>
			<h2 id="_idParaDest-347"><a id="_idTextAnchor352"/>Activities</h2>
			<ol>
				<li value="1"><strong class="source-inline">New</strong> creates a new object. For instance, <strong class="source-inline">New-Item C:\foo\bar.tx</strong><strong class="source-inline">t </strong>will create an empty text file called <strong class="source-inline">bar.txt</strong> in the <strong class="source-inline">C:\foo</strong> directory. Add will add things to the existing object, so <strong class="source-inline">Add-Content C:\foo\bar.txt "PowerShell rocks my world</strong><strong class="source-inline">"</strong><strong class="source-inline"> </strong>will add that string to the previously empty <span class="No-Break">text file.</span></li>
				<li>Just specify the <strong class="source-inline">-InputObject</strong> parameter like this: <strong class="source-inline">Get-Random -</strong><span class="No-Break"><strong class="source-inline">InputObject 20</strong></span><span class="No-Break">.</span></li>
				<li>Use the <strong class="source-inline">-Prefix</strong> parameter. This is particularly useful when using <span class="No-Break">remote sessions.</span></li>
			</ol>
			<h2 id="_idParaDest-348"><a id="_idTextAnchor353"/>Exercises</h2>
			<ol>
				<li value="1"><strong class="source-inline">Get-Content</strong> is correct. This is a bit of a trick question, as the <em class="italic">Approved Verbs for PowerShell Commands </em>web page says that <strong class="source-inline">Get</strong> should be reserved for getting information <em class="italic">about </em>an object, not its contents. Nonetheless, <strong class="source-inline">Get-Content</strong> is right, as we are getting the contents of a file and reserving it for future use <em class="italic">as an object</em>, as opposed to reading data from a remote resource such as a web page. <strong class="source-inline">Read-Host</strong> is an example of a cmdlet that reads things—in this case, information from <span class="No-Break">the shell.</span></li>
				<li>You should see the words <strong class="source-inline">alive alive</strong> printed on the screen. This is because <strong class="source-inline">oh</strong> is an alias for <strong class="source-inline">Out-Host</strong>, which takes an object—in this case, the string <strong class="source-inline">alive alive</strong>—and prints it to the default host, usually <span class="No-Break">the screen.</span></li>
				<li><strong class="source-inline">Get-ChildItem</strong> has two parameter sets. The parameter that determines which set you use <span class="No-Break">is </span><span class="No-Break"><strong class="source-inline">-LiteralPath</strong></span><span class="No-Break">.</span></li>
				<li><strong class="source-inline">*.exe</strong> is being passed to the <strong class="source-inline">-filter</strong> parameter. If you look at the help file, you can see that <strong class="source-inline">-filter</strong> is a positional parameter with a position of 1, so the second value without a specified parameter will be understood as a <span class="No-Break">filter argument.</span></li>
				<li>No. the <strong class="source-inline">-Filter</strong> parameter only takes a single argument. If you want this cmdlet to run, then <strong class="source-inline">Get-ChildItem c:\foo\* -include *.exe, *.txt</strong> <span class="No-Break">will work.</span></li>
				<li><strong class="source-inline">Find-module *aws*</strong> will find lots of official modules for working with AWS, provided <span class="No-Break">by Amazon.</span></li>
				<li>At the time of writing, there aren’t any on the PowerShell Gallery, but there are some on GitHub. I’m not sure how official they are, though. <span class="No-Break">Be wary.</span></li>
				<li>Holding the <em class="italic">Ctrl</em> key and scrolling the mouse wheel is the easiest temporary way of doing it. <em class="italic">Ctrl</em> and <em class="italic">+</em> (plus) or <em class="italic">Ctrl</em> and <em class="italic">-</em> (minus) will also do it. To change it permanently, open <strong class="bold">Settings</strong>, click on the profile you wish to change, and go into the <span class="No-Break"><strong class="bold">Appearance</strong></span><span class="No-Break"> subsection.</span></li>
			</ol>
			<h1 id="_idParaDest-349"><a id="_idTextAnchor354"/><a href="B17600_03.xhtml#_idTextAnchor049">Chapter 3</a></h1>
			<h2 id="_idParaDest-350"><a id="_idTextAnchor355"/>Activities</h2>
			<ol>
				<li value="1">We can combine <strong class="source-inline">-first</strong>, <strong class="source-inline">-last</strong>, and <strong class="source-inline">-skip</strong> to do this, <span class="No-Break">like so:</span><pre class="source-code">
<strong class="bold">1,2,3,4,5,6,7,8 | Select-Object -last 2 -First 3 -skip 1</strong></pre><p class="list-inset">If we read the help file carefully, we will see that the <strong class="source-inline">-skip</strong> parameter will skip from the start, unless it is combined with <strong class="source-inline">-last</strong>. However, it is not positional, so if we specify both the <strong class="source-inline">-first</strong> and <strong class="source-inline">-last</strong> parameters, <strong class="source-inline">-skip</strong> will always skip from the start of the array; it doesn’t matter where we put it in <span class="No-Break">the cmdlet:</span></p></li>			</ol>
			<div>
				<div id="_idContainer300" class="IMG---Figure">
					<img src="image/B17600_Assessments_003.jpg" alt="Figure A.3 – Output when we use first, last, and skip"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure A.3 – Output when we use first, last, and skip</p>
			<ol>
				<li value="2">This is because <strong class="source-inline">-contains</strong> doesn’t support wildcards. The value must match exactly, except that it is not <span class="No-Break">case sensitive.</span></li>
				<li><strong class="source-inline">Get-Command -ParameterName filter</strong> will do this for us. If you run it, you will see that there are lots of them. Most of them make use of the same <strong class="source-inline">filter</strong> block syntax we’ve been looking at in <span class="No-Break">this chapter.</span></li>
			</ol>
			<h2 id="_idParaDest-351"><a id="_idTextAnchor356"/>Exercises</h2>
			<ol>
				<li value="1"><strong class="bold">Get-Date | </strong><span class="No-Break"><strong class="bold">Select-Object DayOfWeek</strong></span><p class="list-inset">First, we need to know how to get today’s date; <strong class="source-inline">Get-Command</strong> will let us find the <strong class="source-inline">Get-Date</strong> cmdlet. Next, we need to use <strong class="source-inline">Get-Member</strong> to see the properties of the object that <strong class="source-inline">Get-Date</strong> produces. Finally, we need to use <strong class="source-inline">Select-Object</strong> to just show the <strong class="source-inline">DayOfWeek</strong> property – <strong class="bold">Day</strong> returns the day of <span class="No-Break">the month.</span></p></li>
				<li><strong class="bold">Get-Process | Select-Object name, </strong><span class="No-Break"><strong class="bold">cpu, path</strong></span><p class="list-inset"><strong class="source-inline">path</strong> isn’t a property that is displayed when we run <strong class="source-inline">Get-Process</strong>, so we will need to use <strong class="source-inline">Get-Member</strong> to <span class="No-Break">find it.</span></p></li>
				<li><strong class="bold">Get-Process | select-object name, cpu, path | sort-object </strong><span class="No-Break"><strong class="bold">path -descending</strong></span><p class="list-inset"><span class="No-Break">Simple.</span></p></li>
				<li><strong class="bold">Get-Process | Where-Object cpu -gt 5 | select-object name, path | sort-object </strong><span class="No-Break"><strong class="bold">path -descending</strong></span><p class="list-inset">The tricky bit here is remembering that <strong class="source-inline">Where-Object</strong> needs to come early. Remember, <span class="No-Break"><em class="italic">filter left</em></span><span class="No-Break">.</span></p></li>
				<li>It’s best to make use of the filtering properties of a cmdlet rather than passing everything through the pipeline to <strong class="source-inline">Where-Object</strong>, so the following code is the most <span class="No-Break">efficient way:</span><pre class="source-code">
<strong class="bold">Get-ChildItem -File -Attributes ReadOnly</strong></pre><p class="list-inset">However, the following will <span class="No-Break">also work:</span></p><pre class="source-code"><strong class="bold">Get-childitem -file | where {$_.isreadonly -eq 'true'}</strong></pre></li>				<li>This is a bit of a trick question; we could use <strong class="source-inline">ForEach-Object</strong> here, <span class="No-Break">like this:</span><pre class="source-code">
<strong class="bold">Get-ChildItem </strong><strong class="bold">-</strong><strong class="bold">File | ForEach-Object -Process {$_.Name + $_.length}</strong></pre><p class="list-inset">However, the output is horrible. It’s far better to do something <span class="No-Break">like this:</span></p><pre class="source-code"><strong class="bold">Get-ChildItem -File | Select-Object name, length</strong></pre><p class="list-inset">These days, it’s quite rare that there isn’t a better alternative to using <span class="No-Break"><strong class="source-inline">ForEach-Object</strong></span><span class="No-Break"> interactively.</span></p></li>				<li><strong class="bold">Get-Process (</strong><span class="No-Break"><strong class="bold">Get-Content ./processes.txt)</strong></span><p class="list-inset"><strong class="source-inline">Get-Content</strong> is the cmdlet you need, and we’ll be covering this in <a href="B17600_06.xhtml#_idTextAnchor117"><span class="No-Break"><em class="italic">Chapter 6</em></span></a>, <em class="italic">PowerShell and Files – Reading, Writing, and Manipulating Data</em>. You will remember from the work we have done earlier in this chapter that the <strong class="source-inline">-Name</strong> parameter for <strong class="source-inline">Get-Process</strong> doesn’t accept objects <strong class="source-inline">ByValue</strong>, only <strong class="source-inline">ByProcessName</strong>, so we can’t use <strong class="source-inline">Get-Content</strong> to grab the list of names. Instead, we must use parentheses and feed them directly to the <strong class="source-inline">-</strong><span class="No-Break"><strong class="source-inline">Name</strong></span><span class="No-Break"> parameter.</span></p></li>
				<li>It won’t run like that; although the <strong class="source-inline">-computername</strong> parameter accepts a <strong class="source-inline">system.string</strong> object, it does so <strong class="source-inline">ByPropertyName</strong>, not <strong class="source-inline">ByValue</strong>. The correct way to run this is <span class="No-Break">as follows:</span><pre class="source-code">
<strong class="bold">Stop-Computer 'bobscomputer'</strong></pre><p class="list-inset">This will pass the string to the <span class="No-Break">parameter correctly.</span></p><p class="list-inset">Unfortunately, this cmdlet is seriously deficient on Linux and macOS – it’s just a wrapper for the <strong class="source-inline">shutdown</strong> command and can’t work against remote machines. Hopefully, you followed the instructions not to try it, as it will ignore the <strong class="source-inline">bobscomputer</strong> string and shut down your local machine if you don’t include the <strong class="source-inline">-</strong><span class="No-Break"><strong class="source-inline">WhatIf</strong></span><span class="No-Break"> parameter.</span></p></li>			</ol>
			<h1 id="_idParaDest-352"><a id="_idTextAnchor357"/><a href="B17600_04.xhtml#_idTextAnchor071">Chapter 4</a></h1>
			<h2 id="_idParaDest-353"><a id="_idTextAnchor358"/>Activities</h2>
			<ol>
				<li value="1">It’s all about memory. As we mentioned, the stack has limited space, and value-type objects are held in the stack. Therefore, it makes sense to conserve memory as much as possible while being transparent to the human writing the code. <strong class="source-inline">[Int64]</strong> type objects take up twice as much space on the stack as <strong class="source-inline">[Int32]</strong> <span class="No-Break">type objects.</span></li>
				<li><strong class="source-inline">MyString</strong> has been told to take the contents of <strong class="source-inline">MyVariable</strong>, the integer <strong class="source-inline">42</strong>, and treat it as a string. We can subsequently put an integer in <strong class="source-inline">MyString</strong>, because we didn’t constrain it in any way when we <span class="No-Break">created it.</span><p class="list-inset">Doing it the other way around, with <strong class="source-inline">[string]$MyOtherString</strong>, constrains <strong class="source-inline">MyOtherString</strong> to only be able to <span class="No-Break">contain strings.</span></p></li>
			</ol>
			<h2 id="_idParaDest-354"><a id="_idTextAnchor359"/>Exercises</h2>
			<ol>
				<li value="1">There’s a space in there – spaces aren’t allowed. If we really must use a space in the variable name, then we must enclose it in curly braces – <strong class="source-inline">{My Variable}</strong>, which is arguably more work than using a variable name that doesn’t include <span class="No-Break">a space.</span></li>
				<li><strong class="source-inline">System.Management.Automation.PSVariable</strong>, <strong class="source-inline">PSVariable</strong>, or <span class="No-Break">even </span><span class="No-Break"><strong class="source-inline">Variable</strong></span><span class="No-Break">.</span></li>
				<li>Use the preference variable <strong class="source-inline">$ErrorView</strong>. By default, it is set to <strong class="source-inline">ConciseView</strong>, a shorter, reader-friendly message containing just the error. This was introduced in PowerShell 7.0 and replaced a slightly more oblique format. This old format can still be seen by setting <strong class="source-inline">$ErrorView </strong>to <strong class="source-inline">NormalView</strong>. Interestingly, the PowerShell documentation lists <strong class="source-inline">$ErrorView </strong>as both a preference and an automatic variable – I suspect this is wrong; I think it’s a <span class="No-Break">preference variable.</span></li>
				<li><strong class="source-inline">$Null</strong> will do this. <strong class="source-inline">$Null</strong> is different from 0 and is still a value; it’s just an <span class="No-Break">empty value.</span></li>
				<li>We can use the <strong class="source-inline">CompareTo()</strong> method. This will give us three possible outputs: <strong class="source-inline">0</strong> if the integers are the same, <strong class="source-inline">-1</strong> if the first integer is smaller than the second, or <strong class="source-inline">1</strong> if it is larger. Try <span class="No-Break">the following:</span><pre class="source-code">
$x = 42
$y = 23
$y.CompareTo($x)</pre><p class="list-inset">This sort of thing will come in handy in the next chapter, <a href="B17600_05.xhtml#_idTextAnchor096"><span class="No-Break"><em class="italic">Chapter 5</em></span></a>, <em class="italic">PowerShell Control Flow – Conditionals and Loops</em>, where we will be looking at <span class="No-Break">conditional statements.</span></p></li>				<li>It’s a <strong class="source-inline">System.Array</strong> object <span class="No-Break">or array.</span></li>
				<li><strong class="source-inline">MyString.ToCharArray()</strong> will output each <strong class="source-inline">char</strong> as an element of an array on a separate line.PowerShell Variables and Data <span class="No-Break">Structures 34</span></li>
				<li>Because we are only using single quote marks, the output will be <strong class="source-inline">My Name is $MyName</strong>. If we want the variable to be expanded, we must use <span class="No-Break">double quotes.</span></li>
				<li>This is the <strong class="source-inline">TypeName</strong> of an ordered hashtable, and we can create it using the <strong class="source-inline">[ordered] </strong>accelerator. Remember, this goes on the right-hand side of the statement, not the left, <span class="No-Break">like so:</span><pre class="source-code">
$OrderedHash = [ordered]@{a=10;b=20;c=30}</pre></li>			</ol>
			<h1 id="_idParaDest-355"><a id="_idTextAnchor360"/><a href="B17600_05.xhtml#_idTextAnchor096">Chapter 5</a></h1>
			<h2 id="_idParaDest-356"><a id="_idTextAnchor361"/>Activities</h2>
			<ol>
				<li value="1">Because the switch is <strong class="source-inline">7 { Write-Output 'contains 7' }</strong>, which is looking for an integer. The line it is searching is a string, and so contains no integers. If we replaced the <strong class="source-inline">7</strong> in the <strong class="source-inline">switch</strong> statement with <strong class="source-inline">'*7'</strong>, making it a string, then it <span class="No-Break">would work.</span></li>
				<li>It’s because we’re executing the increment statement before we write the output. Switching the two statements around would demonstrate that the scriptblock doesn’t execute when the condition <span class="No-Break">isn’t met.</span></li>
			</ol>
			<h2 id="_idParaDest-357"><a id="_idTextAnchor362"/>Exercises</h2>
			<ol>
				<li value="1">None. The statement only produces output if <strong class="source-inline">$x</strong> is larger than 4. There is no <strong class="source-inline">else</strong> statement here to produce alternative output. This is a true conditional statement, rather than a conditional that provides <span class="No-Break">alternate flows.</span></li>
				<li><strong class="source-inline">$x = 4 ; IF ($x -gt 4) {Write-Host '$x is larger than 4'}Else {Write-Host '$x is not larger </strong><span class="No-Break"><strong class="source-inline">than 4'}</strong></span></li>
				<li><strong class="source-inline">$x = 4 ; IF ($x -gt 4) {Write-Host '$x is larger than 4'}elseif ($x -lt 4) {Write-Host '$x is smaller than 4'} Else {Write-Host '$x </strong><span class="No-Break"><strong class="source-inline">is 4'}</strong></span></li>
				<li><strong class="source-inline">$x = 4 ; ($x -gt 4) ? (Write-Host '$x is larger than 4') : (Write-Host '$x is not larger </strong><span class="No-Break"><strong class="source-inline">than 4')</strong></span></li>
				<li>Because <strong class="source-inline">foreach</strong> is after a pipe character, there is only a single statement here, and <strong class="source-inline">foreach</strong> is interpreted as an alias of <strong class="source-inline">ForEach-Object</strong>, so the syntax is wrong. We can make it right by replacing the pipe character with a semicolon. This separates it into two statements, and <strong class="source-inline">foreach</strong> is <span class="No-Break">correctly interpreted:</span><pre class="source-code">
$processes = Get-process ; foreach ($process in $processes) {$process.name}</pre></li>				<li><strong class="source-inline">number = 0 ; Do {$number ++ ; Write-Host "Number is $number"} While (!($number -eq 5))</strong> will work. We’ll see that construction using the <strong class="source-inline">not</strong> operator alias (<strong class="source-inline">!</strong>) to reverse a statement <span class="No-Break">quite often.</span></li>
				<li>t’s missing the iterator. This will work: <strong class="source-inline">for ($i = 0 ; $i -lt 5 ; $i ++) {</strong><span class="No-Break"><strong class="source-inline">Write-Host $i}.</strong></span></li>
				<li><strong class="source-inline">switch</strong> statements. Using them outside loops and <strong class="source-inline">switch</strong> statements can lead to <span class="No-Break">unpredictable outcomes.</span></li>
				<li>There are a few ways to do this; any that work are right, but my solution involves substituting a <strong class="source-inline">for</strong> loop instead of the existing <strong class="source-inline">while</strong> loop to implement the counter. I’ve also added an extra <strong class="source-inline">elseif</strong> statement to handle a winning condition, <span class="No-Break">like this:</span></li>
			</ol>
			<div>
				<div id="_idContainer301" class="IMG---Figure">
					<img src="image/B17600_Assessments_004.jpg" alt="Figure A.4 – Guess limited Brucie"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure A.4 – Guess limited Brucie</p>
			<p class="list-inset">There are lots of ways of writing this on the internet – I’ve chosen this way just to use concepts that we’ve covered in <span class="No-Break">this chapter.</span></p>
			<h1 id="_idParaDest-358"><a id="_idTextAnchor363"/><a href="B17600_06.xhtml#_idTextAnchor117">Chapter 6</a></h1>
			<h2 id="_idParaDest-359"><a id="_idTextAnchor364"/>Activity</h2>
			<p>This is just one way of doing it. If you got something different that worked, well done. That’s the right way – one of them, anyway. According to <em class="italic">Exercises in Programming Style</em>, there are at least <span class="No-Break">41 others:</span></p>
			<pre class="source-code">
$TheTrial = Get-Content -Path .\thetrial.txt -Raw
$StopWords = Get-Content -Path .\stopwords.txt -Raw
$TrialWords = $TheTrial.Split(" ", "`t", "`n", ",","`"",".", [System. StringSplitOptions]::RemoveEmptyEntries)
$Words = [System.Collections.ArrayList]@()
Foreach ($Word in $TrialWords) {
$LWord = $Word.ToLower()
if (!($StopWords.Contains($LWord))) {
$Words.Add($Word)
}
}
$Grouped = ($Words | Group-Object | Sort-Object Count)
$Grouped[-1 .. -10]</pre>			<p>Here it <span class="No-Break">is running:</span></p>
			<div>
				<div id="_idContainer302" class="IMG---Figure">
					<img src="image/B17600_Assessments_005.jpg" alt="Figure A.5 – The ten most frequent words in an English translation of The Trial"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure A.5 – The ten most frequent words in an English translation of The Trial</p>
			<p>Let’s step through <span class="No-Break">it quickly:</span></p>
			<ul>
				<li>Lines 1 and 2 bring our two files into PowerShell using <strong class="source-inline">Get-Content</strong>, in <strong class="source-inline">Raw</strong> format as <span class="No-Break">single strings.</span></li>
				<li>Line 3 adds some extra delimiters and removes empty strings. I don’t expect you to know about the string split options, so I gave you this in <span class="No-Break">the hint.</span></li>
				<li>Line 5 creates an empty array list to hold interesting words; if we used a PowerShell array, this would be <span class="No-Break">painfully slow.</span></li>
				<li>Line 7 starts a <strong class="source-inline">Foreach</strong> loop to step through each word <span class="No-Break">in </span><span class="No-Break"><strong class="source-inline">$TrialWords</strong></span><span class="No-Break">.</span></li>
				<li>Line 8 creates a variable and casts each word to lowercase into it each time the <span class="No-Break">loop repeats.</span></li>
				<li>Line 9 starts an <strong class="source-inline">if</strong> statement matching the condition “<strong class="source-inline">$Lword</strong> is not in <strong class="source-inline">$StopWords</strong>.” Note we are using the <strong class="source-inline">-Contains</strong> method, which matches substrings in a single string, so it is searching the <strong class="source-inline">$StopWords</strong> string for substrings that <span class="No-Break">match </span><span class="No-Break"><strong class="source-inline">$LWord</strong></span><span class="No-Break">.</span></li>
				<li>Line 10 adds <strong class="source-inline">$Word</strong> to the <strong class="source-inline">$Words</strong> array list if the condition <span class="No-Break">is true.</span></li>
				<li>Line 13 groups and sorts the words <span class="No-Break">in </span><span class="No-Break"><strong class="source-inline">$Words</strong></span><span class="No-Break">.</span></li>
				<li>Line 14 returns the 10 most frequent words, in <span class="No-Break">descending order.</span></li>
			</ul>
			<h2 id="_idParaDest-360"><a id="_idTextAnchor365"/>Exercises</h2>
			<ol>
				<li><strong class="bold">Get-Childitem -Path C:\Temp -File | Format-Wide -</strong><span class="No-Break"><strong class="bold">Column 3</strong></span></li>
				<li><strong class="bold">Get-Process | Format-Wide -column 5 | Where-Object id -</strong><span class="No-Break"><strong class="bold">gt 100</strong></span><p class="list-inset">It will produce no output. Remember, <strong class="bold">Format Right</strong>. The correct code should be <span class="No-Break">as follows:</span></p><pre class="source-code">
<strong class="bold">Get-Process | Where-Object id -gt 100 | Format-Wide -column 5</strong></pre></li>				<li><strong class="bold">“I love PowerShell” | Out-File -</strong><span class="No-Break"><strong class="bold">Path Q3.txt</strong></span></li>
				<li><strong class="bold">“Sooo much” | Out-File -Path </strong><span class="No-Break"><strong class="bold">Q3.txt -Append</strong></span></li>
				<li><strong class="bold">Get-ChildItem | Export-Csv -Path items.csv -</strong><span class="No-Break"><strong class="bold">Delimiter “;”</strong></span></li>
				<li><strong class="bold">(</strong><span class="No-Break"><strong class="bold">Get-ChildItem Function:).count</strong></span></li>
				<li><strong class="bold">Get-Content Q3.txt -Delimiter “ “</strong> Or <strong class="bold">(Get-Content </strong><span class="No-Break"><strong class="bold">Q3.txt).Split(“ “)</strong></span></li>
				<li><strong class="bold">Import-Csv -Path items.csv -</strong><span class="No-Break"><strong class="bold">Delimiter “;”</strong></span><p class="list-inset">We will get an array <span class="No-Break">of </span><span class="No-Break"><strong class="source-inline">PSCustomObjects</strong></span><span class="No-Break">.</span></p></li>
				<li><strong class="bold">Import-Clixml: Element ‘Objs’ with namespace name ‘http:// schemas.microsoft.com/powershell/2004/04’ was </strong><span class="No-Break"><strong class="bold">not found.</strong></span><p class="list-inset">The XML file we are trying to import wasn’t formatted correctly for the cmdlet or it isn’t a <span class="No-Break">PowerShell object.</span></p></li>
			</ol>
			<h1 id="_idParaDest-361"><a id="_idTextAnchor366"/><a href="B17600_07.xhtml#_idTextAnchor140">Chapter 7</a></h1>
			<h2 id="_idParaDest-362"><a id="_idTextAnchor367"/>Activity</h2>
			<p>Here is <span class="No-Break">my solution:</span></p>
			<div>
				<div id="_idContainer303" class="IMG---Figure">
					<img src="image/B17600_Assessments_006.jpg" alt="Figure A.6 – One solution"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure A.6 – One solution</p>
			<p>Line 2 grabs the data in JSON format from the API and puts it in a variable. If we look at the <strong class="source-inline">$astronauts</strong> variable, we can see it has two key-value pairs, <strong class="source-inline">message</strong> and <strong class="source-inline">people</strong>. <strong class="source-inline">people</strong> contains an array of JSON objects, which themselves have two key-value pairs; <strong class="source-inline">name</strong> and <strong class="source-inline">craft</strong>. We can see this in the <span class="No-Break">following figure:</span></p>
			<div>
				<div id="_idContainer304" class="IMG---Figure">
					<img src="image/B17600_Assessments_007.jpg" alt="Figure A.7 – Getting the JSON data"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure A.7 – Getting the JSON data</p>
			<p>So, we know the data we need are in the <strong class="source-inline">$astronauts.people.name</strong> key-value pair. All we need to do now is display it in a pleasing manner. We covered how to use <strong class="source-inline">ConvertTo-Html</strong> in <a href="B17600_06.xhtml#_idTextAnchor117"><span class="No-Break"><em class="italic">Chapter 6</em></span></a>, <em class="italic">PowerShell and Files – Reading, Writing, and Manipulating Data</em>, and this is the way <span class="No-Break">I’ve chosen.</span></p>
			<p>On line 5, we set up a <strong class="source-inline">$params</strong> hashtable so we can splat all the parameters we need. I’ve chosen to include a CSS stylesheet that displays a lovely image, but that’s not necessary. This is <span class="No-Break">my CSS:</span></p>
			<pre class="source-code">
Table {
color: white;
text-align: left;
background-color: black;
}
Body {
background-image: url("iss.jpg");
background-size: cover;
background-repeat: no-repeat;
background-color: black;
font-family: 'Trebuchet MS';
color: yellow;
}</pre>			<p>Finally, the magic happens on line 12. We feed the values we are interested in into <strong class="source-inline">ConvertTo- Html</strong> via the pipeline and then use <strong class="source-inline">Out-File</strong> to write the HTML to a file. We can then open this file in the browser of <span class="No-Break">our choosing.</span></p>
			<p>Hopefully, this has shown you how easy it is to obtain, manipulate, and display data using <span class="No-Break">an API.</span></p>
			<h2 id="_idParaDest-363"><a id="_idTextAnchor368"/>Exercises</h2>
			<ol>
				<li><strong class="bold">Invoke-WebRequest -Uri ‘https://httpbin.org/delete’ -</strong><span class="No-Break"><strong class="bold">Method Delete</strong></span></li>
				<li>We use the <strong class="source-inline">-SessionVariable</strong> parameter in the first request (usually a login request) to supply a string, and then, in subsequent requests, we supply the session variable as a variable using the <strong class="source-inline">-</strong><span class="No-Break"><strong class="source-inline">WebSession</strong></span><span class="No-Break"> parameter.</span></li>
				<li>We can use the <strong class="source-inline">-SkipCertificateCheck</strong> parameter, but we should only do this if we’re really sure that the site is valid and <span class="No-Break">not malicious.</span></li>
				<li>The mistake we made is in encoding the token before supplying it via the header. Encode the token to supply it as a parameter and keep it in plain text for headers. This means that supplying it as a parameter is slightly more secure, but not all services will accept it <span class="No-Break">that way.</span></li>
				<li>WebSocket APIs are usually stateful. This means information about the requestor is persisted through multiple requests; this makes it more complicated to use, as we need to persist session information, and susceptible to <span class="No-Break">network conditions.</span></li>
				<li>There are lots of ways to do this, but the most straightforward is <span class="No-Break">probably this:</span><pre class="source-code">
<strong class="bold">Invoke-RestMethod 'http://api.open-notify.org/iss-now.json' | Format-List iss_position</strong></pre></li>				<li>This will get just the count: <strong class="source-inline">(Invoke-RestMethod 'http://universities. hipolabs.com/search?country=United+kingdom').name | Where-Object {$_ -like '*x*'} | Measure | select -</strong><span class="No-Break"><strong class="source-inline">Property 'count'</strong></span><span class="No-Break">.</span><p class="list-inset">I get <strong class="source-inline">8</strong>, but this is subject <span class="No-Break">to change.</span></p></li>
				<li>We can either pass it a long string describing the custom schema using the <strong class="source-inline">-Schema</strong> parameter, or we can pass it a file location using <strong class="source-inline">-SchemaFile</strong>. You’re right! This isn’t in the chapter. You hopefully read the help file to get <span class="No-Break">the answer.</span></li>
			</ol>
			<h1 id="_idParaDest-364"><a id="_idTextAnchor369"/><a href="B17600_08.xhtml#_idTextAnchor162">Chapter 8</a></h1>
			<h2 id="_idParaDest-365"><a id="_idTextAnchor370"/>Activities</h2>
			<ol>
				<li value="1">The easy way to do this is to create an <strong class="source-inline">$Output</strong> variable in the <strong class="source-inline">Param()</strong> block, and pass that as a parameter to the <strong class="source-inline">Out-File</strong> cmdlet in the script, <span class="No-Break">like this:</span><pre class="source-code">
[CmdletBinding()]
Param(
$City = "London",
$Output = "c:\temp\poshbook\ch8\WeatherData.html"
)
$headers = @{"key" = "&lt;Key&gt;"}
$uri = "https://api.weatherapi.com/v1/current.json?q=$($City)&amp;aqi=no"
$response = Invoke-RestMethod -Uri $uri -Method GET -Headers $headers
$response | Convertto-Html | Out-File $Output</pre><p class="list-inset">The trouble with that is if we want to change the filename, we need to type both the filename and the path each time. It’s likely that we will want to change the filename far more often than we want to change the path. Let’s separate out the path and the filename <span class="No-Break">like this:</span></p></li>			</ol>
			<div>
				<div id="_idContainer305" class="IMG---Figure">
					<img src="image/B17600_Assessments_008.jpg" alt="Figure A.8 – Separating the filename and file path"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure A.8 – Separating the filename and file path</p>
			<p class="list-inset">Now, we can just pass a different filename when we want to, and a different path if we want to, without having to type out the whole thing <span class="No-Break">each time.</span></p>
			<ol>
				<li value="2">From the help file of a cmdlet that has a parameter that takes multiple strings, we can see that the attribute contains an empty pair of square brackets, like this: <strong class="source-inline">[string[]]</strong>. That part is easy enough. We also need to process each element of the array that is then passed to the <strong class="source-inline">-City</strong> parameter. To do that, we’ll need a <strong class="source-inline">foreach</strong> loop as well, wrapped around the working part of <span class="No-Break">the script.</span><p class="list-inset">Finally, we’ll need some way of sending each city’s data to a separate output file. I’ve chosen to do that by passing the <strong class="source-inline">$item</strong> variable from the <strong class="source-inline">foreach</strong> loop. Here’s my solution. Yours may look different, but if it works, <span class="No-Break">that’s great.</span></p></li>
			</ol>
			<div>
				<div id="_idContainer306" class="IMG---Figure">
					<img src="image/B17600_Assessments_009.jpg" alt="Figure A.9 – Processing multiple cities"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure A.9 – Processing multiple cities</p>
			<p class="list-inset">In line <strong class="source-inline">3</strong>, I’ve added the <strong class="source-inline">[string[]]</strong> attribute to the <strong class="source-inline">-City</strong> parameter to allow it to take <span class="No-Break">multiple strings.</span></p>
			<p class="list-inset">I’ve opened a <strong class="source-inline">foreach</strong> loop on line <strong class="source-inline">9</strong> and closed it on line <strong class="source-inline">22</strong>. The lines in between will now be repeated for each <strong class="source-inline">$item</strong> in the array of strings held in the <strong class="source-inline">$City</strong> parameter. I’ve also indented the lines in between to make it easier <span class="No-Break">to read.</span></p>
			<p class="list-inset">I’ve changed line <strong class="source-inline">17</strong> so that it uses the <strong class="source-inline">$item</strong> variable (the current city) rather than the array in <strong class="source-inline">$City</strong> because that would cause an error – the API only accepts a single string at <span class="No-Break">a time.</span></p>
			<p class="list-inset">Finally, I’ve changed line <strong class="source-inline">11</strong> so that it sends each output to a file that includes the name of <span class="No-Break">the city.</span></p>
			<ol>
				<li value="3">Here’s my example. Yours may differ but, hopefully, you’ve included warnings about needing the API key <span class="No-Break">in advance:</span><pre class="source-code">
&lt;#
.SYNOPSIS
Gathers weather data for a number of cities and stores the API output.
.DESCRIPTION
This cmdlet will gather the current weather data from a number of cities from
the API endpoint at https://api.weatherapi.com and outputs the responses to a
set of named HTML files stored in the specified directory.
The -City parameter takes an array of strings, either explicitly or via the
pipeline (ByValue).
The -OutputFile parameter takes a single string specifying the filename and
suffix. This filename will be prefixed by the string provided in the -City
parameter, eg. London_WeatherData.html
The -OutptPath parameter specifies a location for the output file.
The -Key parameter specifies a txt file that contains the key from
weatherapi.com
.NOTES
This script requires a personal API key from https://weatherapi. com
The output path will need to exist before running the script
.LINK
No link, sorry.
.EXAMPLE
.\weatherdata.ps1 -City london,paris
This will generate two html files; one for London and one for Paris
#&gt;</pre></li>			</ol>
			<h2 id="_idParaDest-366"><a id="_idTextAnchor371"/>Exercises</h2>
			<ol>
				<li value="1">This might be because of a few settings, but let’s imagine it is the simplest; the execution policy is correct for you, but not for them. This implies that the <strong class="source-inline">CurrentUser</strong> policy is <span class="No-Break">restricting them.</span><p class="list-inset">Using the following should do it if the script was written on the local machine, or if we have signed it with a code-signing certificate on <span class="No-Break">another machine:</span></p><pre class="source-code">
<strong class="bold">Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser</strong></pre><p class="list-inset">If that’s not the case, then we’d need to set the execution policy <span class="No-Break">to </span><span class="No-Break"><strong class="source-inline">Unrestricted</strong></span><span class="No-Break">.</span></p></li>				<li>The <strong class="source-inline">-Maximum</strong> parameter. I’m not aware of any <em class="italic">Dungeons and Dragons </em>dice that start at a number other than 1 (except for the d100, but we’ll come to that in a <span class="No-Break">question shortly).</span></li>
				<li>Well, there are a few ways we could do it, but hopefully, you’ve come up with something <span class="No-Break">like this:</span><pre class="source-code">
[CmdletBinding()]
param(
$Sides = 20
)
get-random -minimum 1 -Maximum $Sides</pre><p class="list-inset">You don’t need to have the <strong class="source-inline">CmdletBinding()</strong> attribute in there, but I always put <span class="No-Break">it in.</span></p></li>				<li>It should be an integer, and we’d specify it with the <strong class="source-inline">[</strong><span class="No-Break"><strong class="source-inline">int]</strong></span><span class="No-Break"> attribute:</span><pre class="source-code">
[int]$Sides = 20</pre></li>				<li>So, if we read the link, we can see that we can assign the <strong class="source-inline">ValidateSet</strong> attribute to a parameter and pass it an array of legal values, which looks <span class="No-Break">like this:</span><pre class="source-code">
[CmdletBinding()]
param(
[ValidateSet(4,6,8,10,12,20)]
[int]$Sides = 20
)
get-random -minimum 1 -Maximum $Sides</pre></li>				<li>To do this, we’re going to need a loop and to specify the number of times we run the loop with a parameter, then add the output of each loop to a running total. It might look <span class="No-Break">like this:</span><pre class="source-code">
[CmdletBinding()]
param(
[ValidateSet(4,6,8,10,12,20)]
[int]$Sides = 20,
[int]$Dice
)
$total = 0
while ($Dice -gt 0) {
$result = (Get-Random -Minimum 1 -Maximum $Sides)
$Dice -= 1
$total += $result
write-output "die says $result"
}
Write-Output "The total is $total"</pre></li>				<li>This is because there is no default value assigned for <strong class="source-inline">$Dice</strong>. We could assign it a default, but it might be better to make it a mandatory parameter by adding <strong class="source-inline">[Parameter(Mandatory)]</strong> <span class="No-Break">like this:</span><pre class="source-code">
param(
[ValidateSet(4,6,8,10,12,20)]
[int]$Sides = 20,
[Parameter(Mandatory)]
[int]$Dice
)</pre></li>				<li>We could make both parameters mandatory and include a <strong class="source-inline">HelpMessage</strong> attribute that explains what to put for <span class="No-Break">each parameter.</span></li>
				<li>So, the first thing to do is to add the value of <strong class="source-inline">100</strong> to the <strong class="source-inline">ValidateSet</strong> attribute of the <strong class="source-inline">$</strong><span class="No-Break"><strong class="source-inline">sides</strong></span><span class="No-Break"> parameter.</span><p class="list-inset">Once that’s done, we need to treat the value of <strong class="source-inline">100</strong> differently, so we can’t just add it to the loop. I’ve used an <strong class="source-inline">if</strong> and an <strong class="source-inline">else</strong> statement. Here’s my <span class="No-Break">resulting script:</span></p></li>
			</ol>
			<div>
				<div id="_idContainer307" class="IMG---Figure">
					<img src="image/B17600_Assessments_010.jpg" alt="Figure A.10 – My level 15 paladin will crush your chaotic evil cleric"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure A.10 – My level 15 paladin will crush your chaotic evil cleric</p>
			<p class="list-inset">Remember, there are lots of ways to do this; if your code is completely different to mine but it works, <span class="No-Break">that’s fine.</span></p>
			<h1 id="_idParaDest-367"><a id="_idTextAnchor372"/><a href="B17600_09.xhtml#_idTextAnchor184">Chapter 9</a></h1>
			<h2 id="_idParaDest-368"><a id="_idTextAnchor373"/>Activities</h2>
			<ol>
				<li value="1">Nothing, because our parameter is not written to accept pipeline input. As we discovered in <a href="B17600_08.xhtml#_idTextAnchor162"><span class="No-Break"><em class="italic">Chapter 8</em></span></a>, <em class="italic">Writing Our First Script – Turning Simple Cmdlets into Reusable Code</em>, to allow a parameter to accept pipeline input, we must add a parameter argument, <span class="No-Break">like this:</span></li>
			</ol>
			<div>
				<div id="_idContainer308" class="IMG---Figure">
					<img src="image/B17600_Assessments_011.jpg" alt="Figure A.11 –  Accepting values from the pipeline"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure A.11 –  Accepting values from the pipeline</p>
			<p class="list-inset">On line <strong class="source-inline">9</strong>, we’ve added a <strong class="source-inline">ValueFromPipeline</strong> argument to the parameter, which allows it to accept values from the pipeline. We’ve also enclosed the function in a <strong class="source-inline">process</strong> block, opening on line <strong class="source-inline">12</strong> and closing on line <strong class="source-inline">20</strong>; if we don’t have a <strong class="source-inline">process</strong> block, then the function will only act on the last value in <span class="No-Break">the pipeline.</span></p>
			<ol>
				<li value="2">Because <strong class="source-inline">Get-Random</strong> only accepts one positional parameter, <strong class="source-inline">-Maximum</strong>. If we run it as previously, then the maximum will be set as <strong class="source-inline">15</strong>, and the cmdlet has no idea what to do with the <strong class="source-inline">20</strong> value. Similarly, <strong class="source-inline">Get-Fifteen20 15 -maximum 20</strong> won’t work because the <strong class="source-inline">-Maximum</strong> parameter is already filled by the named value, <strong class="source-inline">20</strong>, so it doesn’t know what to do with the <strong class="source-inline">15</strong> value. <strong class="source-inline">Get-Fifteen20 -minimum 15 20</strong> will <span class="No-Break">work, however.</span></li>
				<li>There are lots of ways to do this, as always. My method is <span class="No-Break">as follows:</span><pre class="source-code">
function Remove-Log {
$limit = (Get-Date).AddDays(-7)
Get-ChildItem -Path "C:\temp" -Include "MyLogFile*" -Recurse -Force |
Where-Object {$_.CreationTime -lt $limit} |
Remove-Item -Force
}</pre><p class="list-inset">I’ve created a function called <strong class="source-inline">Remove-Log</strong> that I can call in my script. I’ve created a variable called <strong class="source-inline">$limit</strong> that gets a date seven days less than when it is run. I then get all the items in the <strong class="source-inline">C:\temp</strong> directory that start with the string <strong class="source-inline">MyLogFile</strong>, using a wildcard. I’ve then filtered the list using <strong class="source-inline">Where-Object </strong>to select only the files older than my <strong class="source-inline">$limit</strong> date. Finally, I’ve piped that to <strong class="source-inline">Remove-Item</strong> with the <strong class="source-inline">-Force</strong> parameter to suppress <span class="No-Break">any confirmations.</span></p></li>			</ol>
			<h2 id="_idParaDest-369"><a id="_idTextAnchor374"/>Exercises</h2>
			<ol>
				<li value="1">Avoid Hasty Abstractions – it’s a software engineering principle that encourages us to only create an abstraction, such as a function, when we know we will need it and we know exactly what we need it <span class="No-Break">to do.</span></li>
				<li>Because dot sourcing causes whatever it is calling to be run in the local, or parent, scope rather than the appropriate <span class="No-Break">child scope.</span></li>
				<li>Because just calling the variable will produce the code in the scriptblock; it won’t run it. We need to use the <strong class="source-inline">invoke()</strong> method, the call operator, or the <strong class="source-inline">Invoke-Command</strong> cmdlet. What we shouldn’t do is dot source it without <span class="No-Break">careful consideration.</span></li>
				<li>The <strong class="source-inline">ValidatePattern</strong> validation attribute should do it, but we’d need to use a regular expression. Ugh! Hopefully, you looked this up in the help file mentioned in the <em class="italic">Further </em><span class="No-Break"><em class="italic">reading </em></span><span class="No-Break">section.</span></li>
				<li>Because filters expect pipeline input, and we haven’t supplied any. However, <strong class="source-inline">365 | get-square </strong><span class="No-Break">would work.</span></li>
				<li>We’re preventing the <strong class="source-inline">$number </strong>variable from being accessed from <span class="No-Break">another scope.</span></li>
				<li>A function is named, whereas a scriptblock <span class="No-Break">is anonymous.</span></li>
				<li>We’re trying to feed a value through the pipeline, but there’s no parameter that accepts pipeline input. We need to either make it an advanced function and create a parameter that accepts pipeline input, or we need to <span class="No-Break">use </span><span class="No-Break"><strong class="source-inline">$Args</strong></span><span class="No-Break">.</span></li>
				<li>We will write the function <span class="No-Break">as follows:</span><pre class="source-code">
Function get-root($a) {
&lt;what goes here?&gt;
}</pre><p class="list-inset">Probably the easiest way is to use <span class="No-Break">this line:</span></p><pre class="source-code">[math]::Sqrt($a)</pre><p class="list-inset">We can use it <span class="No-Break">like this:</span></p></li>			</ol>
			<div>
				<div id="_idContainer309" class="IMG---Figure">
					<img src="image/B17600_Assessments_012.jpg" alt="Figure A.12 – Getting a root the easy way"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure A.12 – Getting a root the easy way</p>
			<h1 id="_idParaDest-370"><a id="_idTextAnchor375"/><a href="B17600_10.xhtml#_idTextAnchor201">Chapter 10</a></h1>
			<h2 id="_idParaDest-371"><a id="_idTextAnchor376"/>Activities</h2>
			<ol>
				<li value="1">The <strong class="source-inline">-ErrorAction</strong> parameter will override the <strong class="source-inline">$ErrorActionPreference</strong> variable, and the <strong class="source-inline">nosuchfile</strong> string will cause a terminating error. Because it’s a terminating error, the cmdlet will not <span class="No-Break">process </span><span class="No-Break"><strong class="source-inline">bar.txt</strong></span><span class="No-Break">.</span></li>
				<li>Because if there is an error, then the error object is put into the pipeline, replacing the string that caused <span class="No-Break">the error.</span></li>
			</ol>
			<h2 id="_idParaDest-372"><a id="_idTextAnchor377"/>Exercises</h2>
			<ol>
				<li value="1">Terminating errors stop the script altogether. Non-terminating errors may stop the script from doing the current step, but PowerShell will move the script on to the <span class="No-Break">next step.</span></li>
				<li>Either with the <strong class="source-inline">Get-Error</strong> cmdlet, which displays the most recent error object, or with the <strong class="source-inline">$Error</strong> variable. This has an array of all the error objects created during a session up to a default maximum <span class="No-Break">of 256.</span></li>
				<li>The <strong class="source-inline">-ErrorActionPreference</strong> variable allows us to set the default error action preference for all cmdlets and scripts running in a specific PowerShell session. It determines whether errors should be displayed, ignored, or handled in a <span class="No-Break">specific way.</span></li>
				<li>The <strong class="source-inline">Write-Error</strong> cmdlet allows us to manually generate and display custom non-terminating error messages within a script. It is useful when we want to explicitly signal an error condition to the user or the <span class="No-Break">calling code.</span></li>
				<li>To generate a terminating error that can be handled by a <strong class="source-inline">try</strong>/<strong class="source-inline">catch</strong> <span class="No-Break">statement pair.</span></li>
				<li>By either using the <strong class="source-inline">-Debug</strong> parameter with a cmdlet or advanced script or by setting the <strong class="source-inline">$DebugPreference</strong> variable to <strong class="source-inline">Continue</strong>; the default <span class="No-Break">is </span><span class="No-Break"><strong class="source-inline">SilentlyContinue</strong></span><span class="No-Break">.</span></li>
				<li>By using the <strong class="source-inline">Write-Debug</strong> cmdlet in the script. Debug messages are for people who write code; error messages are for people who use code. As such, a debug message should include detailed information about what is going on in the script at that point, possibly including variable values and <span class="No-Break">step counts.</span></li>
				<li>A breakpoint is a marker set in the script to pause its execution at a specific line or condition. It allows us to inspect the state of the script and variables at that point. A break point in tennis is <span class="No-Break">quite different.</span></li>
				<li>It executes the current line of a script and moves on to the next line but treats whole functions as a single line. So, if the next line of code is a function, or we are currently in a function, then the whole function call will complete, rather than moving on to the next line in <span class="No-Break">the function.</span></li>
			</ol>
			<h1 id="_idParaDest-373"><a id="_idTextAnchor378"/><a href="B17600_11.xhtml#_idTextAnchor218">Chapter 11</a></h1>
			<h2 id="_idParaDest-374"><a id="_idTextAnchor379"/>Activity</h2>
			<p>Try running <strong class="source-inline">Remove-Module</strong> to get rid of the module we’ve just installed, and then running <strong class="source-inline">Get-Square</strong>. What happens? Why does <span class="No-Break">this happen?</span></p>
			<p>The <strong class="source-inline">Get-Square</strong> cmdlet is still available. This is because we saved the module in the module path correctly; this means that PowerShell will autoload the module when we call a function in the module. We can see it working in the <span class="No-Break">following screenshot:</span></p>
			<div>
				<div id="_idContainer310" class="IMG---Figure">
					<img src="image/B17600_Assessments_013.jpg" alt="Figure A.13 – Autoloading with PowerShell"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure A.13 – Autoloading with PowerShell</p>
			<p>In the first line, I list the loaded modules. Then, I run <strong class="source-inline">Get-Square 7</strong>, which autoloads <strong class="source-inline">MyFirstModule</strong>. After that, I confirm that’s what happened by running <strong class="source-inline">Get-Module</strong> again. We can see that <strong class="source-inline">Remove-Module</strong> removes the <strong class="source-inline">Get-Square</strong> cmdlet by running it with the <strong class="source-inline">-Verbose</strong> switch in the <span class="No-Break">last line.</span></p>
			<h2 id="_idParaDest-375"><a id="_idTextAnchor380"/>Exercises</h2>
			<ol>
				<li><span class="No-Break"><strong class="bold">Get-Module</strong></span></li>
				<li>It imports a module into the global scope. Note that when we import a module from the command prompt, it is already imported into the global scope – we use this when we’re importing a module from inside another module; a <span class="No-Break">nested module.</span></li>
				<li>We need to give the full path to the module in the <strong class="source-inline">-Name</strong> parameter <span class="No-Break">of </span><span class="No-Break"><strong class="source-inline">Import-Module</strong></span><span class="No-Break">.</span></li>
				<li>Either use the <strong class="source-inline">-NoClobber</strong> parameter if they are not functions we want to use or use the <strong class="source-inline">-Prefix</strong> parameter if <span class="No-Break">they are.</span></li>
				<li>Either with the <strong class="source-inline">Export-ModuleMembers</strong> cmdlet in the module file or with a <span class="No-Break">module manifest.</span></li>
				<li>It provides a link to the online documentation for the module, allowing the help to <span class="No-Break">be updated.</span></li>
				<li>In the context of a module, it might be either formatting information for function or cmdlet output, or it might be custom <span class="No-Break">type information.</span></li>
				<li>We’ll get cmdlets; a <strong class="source-inline">.dll</strong> extension signifies a binary module, so the commands inside it will be of the <strong class="source-inline">Cmdlet</strong> type. Script modules contain commands of the <span class="No-Break"><strong class="source-inline">Function</strong></span><span class="No-Break"> type.</span></li>
				<li>Because they are slow. The CDXML gets parsed to a PowerShell script, which then has to <span class="No-Break">be interpreted.</span></li>
			</ol>
			<h1 id="_idParaDest-376"><a id="_idTextAnchor381"/><a href="B17600_12.xhtml#_idTextAnchor236">Chapter 12</a></h1>
			<h2 id="_idParaDest-377"><a id="_idTextAnchor382"/>Exercises</h2>
			<ol>
				<li value="1"><strong class="source-inline">New-PSSession</strong> creates a persistent session, but an ad hoc session can be created with <span class="No-Break"><strong class="source-inline">Enter- PSSession</strong></span><span class="No-Break">.</span></li>
				<li>By <span class="No-Break">using SSH.</span></li>
				<li>The <strong class="source-inline">AllSigned</strong> execution policy only allows scripts signed by a trusted publisher <span class="No-Break">to run.</span></li>
				<li>The <strong class="source-inline">-ExecutionPolicy Bypass</strong> switch is used to temporarily bypass an execution policy when running <span class="No-Break">a script.</span></li>
				<li><span class="No-Break">PowerShell AMSI.</span></li>
				<li>The constrained language mode is used to restrict access to dangerous cmdlets and scripting features <span class="No-Break">in PowerShell.</span></li>
				<li>By <span class="No-Break">using JEA.</span></li>
				<li>Script block logging records the content of script blocks executed in PowerShell, providing visibility into potentially malicious actions. It records the contents in the <strong class="source-inline">PowerShellCore</strong> operational event log in Windows and in the systemd log <span class="No-Break">in Linux.</span></li>
				<li>A secure string is a PowerShell object of type <strong class="source-inline">System.Security.SecureString</strong>, and an encrypted string is a string object that has been encrypted with a key so that it cannot be read in <span class="No-Break">a file.</span></li>
			</ol>
			<h1 id="_idParaDest-378"><a id="_idTextAnchor383"/><a href="B17600_13.xhtml#_idTextAnchor267">Chapter 13</a></h1>
			<h2 id="_idParaDest-379"><a id="_idTextAnchor384"/>Activities</h2>
			<ol>
				<li value="1">We could write a fairly complicated cmdlet with <strong class="source-inline">Invoke-CimMethod</strong>, but that isn’t the best way to do it. Instead, we should use the cmdlet specifically written for this purpose, <strong class="source-inline">Stop- Process</strong>, with the <strong class="source-inline">ProcessId</strong> of the <span class="No-Break"><strong class="source-inline">notepad</strong></span><span class="No-Break"> process:</span><pre class="source-code">
<strong class="bold">Stop-Process -Id 8480</strong></pre></li>				<li>We can use <strong class="source-inline">Invoke-CimMethod</strong> <span class="No-Break">like this:</span></li>
			</ol>
			<div>
				<div id="_idContainer311" class="IMG---Figure">
					<img src="image/B17600_Assessments_014.jpg" alt="Figure A.14 – Setting a default printer with CIM commands"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure A.14 – Setting a default printer with CIM commands</p>
			<p class="list-inset">In the first command, I put the printer object into a variable, then I used that variable as the input object for <strong class="source-inline">Invoke-CimMethod</strong> and invoked the <strong class="source-inline">SetDefaultPrinter</strong> method. The return value of <strong class="source-inline">0</strong> <span class="No-Break">indicates success.</span></p>
			<p class="list-inset">Note that the <strong class="source-inline">SetDefaultPrinter</strong> method doesn’t appear on the <strong class="source-inline">$printer</strong> variable. Unfortunately, we need to read the documentation to discover <span class="No-Break">this method:</span></p>
			<ul>
				<li><a href="https://learn.microsoft.com/en-us/windows/win32/cimwin32prov/win32-printer-methods"><span class="No-Break">https://learn.microsoft.com/en-us/windows/win32/cimwin32prov/win32-printer-methods</span></a></li>
				<li><a href="https://learn.microsoft.com/en-us/windows/win32/cimwin32prov/setdefaultprinter-method-in-class-win32-printer"><span class="No-Break">https://learn.microsoft.com/en-us/windows/win32/cimwin32prov/setdefaultprinter-method-in-class-win32-printer</span></a></li>
			</ul>
			<h2 id="_idParaDest-380"><a id="_idTextAnchor385"/>Exercises</h2>
			<ol>
				<li value="1"><span class="No-Break">Manifest modules.</span></li>
				<li>It may have been written before PowerShell Core was released, the author may not have included compatibility information in the manifest, or it may not be a <span class="No-Break">manifest module.</span></li>
				<li>Windows <span class="No-Break">PowerShell 5.1.</span></li>
				<li><span class="No-Break">Deserialized ones.</span></li>
				<li>Use the <strong class="source-inline">-</strong><span class="No-Break"><strong class="source-inline">UseWindowsPowershell</strong></span><span class="No-Break"> parameter.</span></li>
				<li><span class="No-Break"><strong class="source-inline">__NAMESPACE</strong></span></li>
				<li>It allows us to specify a different timeout when querying remote machines, as the default is 3 minutes <span class="No-Break">per machine.</span></li>
				<li>Possibly we could use <strong class="source-inline">Set-CimInstance</strong>, but because many properties are not writable, we more likely will <span class="No-Break">use </span><span class="No-Break"><strong class="source-inline">Invoke-CimMethod</strong></span><span class="No-Break">.</span></li>
				<li>We pass them as an i<strong class="source-inline">Dictionary</strong> hash table to the <strong class="source-inline">-</strong><span class="No-Break"><strong class="source-inline">Arguments</strong></span><span class="No-Break"> parameter.</span></li>
			</ol>
			<h1 id="_idParaDest-381"><a id="_idTextAnchor386"/><a href="B17600_14.xhtml#_idTextAnchor280">Chapter 14</a></h1>
			<h2 id="_idParaDest-382"><a id="_idTextAnchor387"/>Activity</h2>
			<p>Because PowerShell is very forgiving about file path separators, the only bit of code that needs to be different depending on the platform is how we get the name of the machine. Everything else is straightforward. Here’s my solution; yours could be very different and still achieve <span class="No-Break">the task:</span></p>
			<pre class="source-code">
if ($IsWindows) {
$computername = $env:COMPUTERNAME
}
elseif ($IsLinux) {
$computername = (hostname)
}
Get-Process |
Sort-Object -Property CPU -Descending |
Select-Object -First 5 |
Out-File "$($computername)_processes.txt"</pre>			<p>Because we need to use different ways to get the machine name, those two lines are within <strong class="source-inline">if</strong> statements. Everything else works the same on Linux and Windows, so it’s very straightforward. This is how it looks running on my <span class="No-Break">CentOS box:</span></p>
			<div>
				<div id="_idContainer312" class="IMG---Figure">
					<img src="image/B17600_Assessments_015.jpg" alt="Figure A.15 – Running a cross-platform script on CentOS"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure A.15 – Running a cross-platform script on CentOS</p>
			<p>As we can see, it works just fine. The script would be better for some error checking; for instance, what if both automatic variables <span class="No-Break">are </span><span class="No-Break"><strong class="source-inline">false</strong></span><span class="No-Break">?</span></p>
			<h2 id="_idParaDest-383"><a id="_idTextAnchor388"/>Exercises</h2>
			<ol>
				<li>The internet. As with most Linux distributions, Kali Linux is not supported <span class="No-Break">by Microsoft.</span></li>
				<li>Trick question. We are actually calling the <strong class="source-inline">ls</strong> Bash command on Linux. When we type it on Windows, we are calling <strong class="source-inline">Get-ChildItem</strong> via the <span class="No-Break"><strong class="source-inline">ls</strong></span><span class="No-Break"> alias.</span></li>
				<li>Either <strong class="source-inline">\</strong> or <strong class="source-inline">/</strong>. It doesn’t matter, thankfully. This means it’s a lot easier to write <span class="No-Break">cross-platform scripts.</span></li>
				<li>By calling the <strong class="source-inline">$IsMacOS</strong> variable. If it returns <strong class="source-inline">true</strong>, then we are running <span class="No-Break">on macOS.</span></li>
				<li>By starting PowerShell with the <strong class="source-inline">sudo pwsh</strong> command. There is no way to elevate privilege during a <span class="No-Break">PowerShell session.</span></li>
				<li><strong class="source-inline">New-PSSession</strong> with the <strong class="source-inline">-</strong><span class="No-Break"><strong class="source-inline">HostName</strong></span><span class="No-Break"> parameter.</span></li>
				<li><strong class="source-inline">New-PSSession</strong> and the <strong class="source-inline">-</strong><span class="No-Break"><strong class="source-inline">KeyFilePath</strong></span><span class="No-Break"> parameter.</span></li>
				<li>It’s a file transfer program that is included in the PowerShell <span class="No-Break">7 packages.</span></li>
				<li>Ed25519 is a recent, more secure encryption algorithm for digital signatures based on <span class="No-Break">public/private keys.</span></li>
			</ol>
			<h1 id="_idParaDest-384"><a id="_idTextAnchor389"/><a href="B17600_15.xhtml#_idTextAnchor302">Chapter 15</a></h1>
			<h2 id="_idParaDest-385"><a id="_idTextAnchor390"/>Answers</h2>
			<ol>
				<li value="1">Because the Zero and Pico use an ARMv6 chip architecture, which isn’t compatible with .NET since it requires ARMv7 <span class="No-Break">or ARMv8.</span></li>
				<li>Either <strong class="source-inline">C:\Users\&lt;username&gt;\.sshconfig </strong><span class="No-Break">or </span><span class="No-Break"><strong class="source-inline">C:\ProgramData\ssh\ssh_config</strong></span><span class="No-Break">.</span></li>
				<li><span class="No-Break"><strong class="bold">Test-NetConnection</strong></span></li>
				<li><span class="No-Break"><strong class="bold">ssh &lt;username&gt;@&lt;hostname&gt;</strong></span></li>
				<li><strong class="bold">sudo </strong><span class="No-Break"><strong class="bold">bash ./install.sh</strong></span></li>
				<li>Because it’s a pain <span class="No-Break">typing </span><span class="No-Break"><strong class="source-inline">~/powershell/pwsh</strong></span><span class="No-Break">.</span></li>
				<li><strong class="bold">sudo ln -s ~/</strong><span class="No-Break"><strong class="bold">powershell/pwsh /usr/bin/pwsh</strong></span></li>
				<li>Use the <strong class="source-inline">-Raw</strong> switch parameter with the <span class="No-Break"><strong class="source-inline">Get-GpioPin</strong></span><span class="No-Break"> cmdlet.</span></li>
				<li>Debian Linux, similar <span class="No-Break">to Ubuntu.</span></li>
			</ol>
			<h1 id="_idParaDest-386"><a id="_idTextAnchor391"/><a href="B17600_16.xhtml#_idTextAnchor320">Chapter 16</a></h1>
			<h2 id="_idParaDest-387"><a id="_idTextAnchor392"/>Exercises</h2>
			<ol>
				<li value="1"><strong class="bold">$object = New-Object -</strong><span class="No-Break"><strong class="bold">TypeName Namespace.ClassName</strong></span></li>
				<li><strong class="bold">Add-Type -</strong><span class="No-Break"><strong class="bold">AssemblyName “AssemblyName”</strong></span></li>
				<li><strong class="bold">[</strong><span class="No-Break"><strong class="bold">Namespace.ClassName]::MethodName()</strong></span></li>
				<li><strong class="bold">[</strong><span class="No-Break"><strong class="bold">Namespace.ClassName]::PropertyName</strong></span></li>
				<li><strong class="bold">$object = New-Object -TypeName Namespace.ClassName -ArgumentList (arg1, </strong><span class="No-Break"><strong class="bold">arg2, ...)</strong></span></li>
				<li><strong class="bold">Add-Type -</strong><span class="No-Break"><strong class="bold">Path “Path\To\Assembly.dll”</strong></span></li>
				<li><span class="No-Break"><strong class="bold">Using $object.GetType()</strong></span></li>
				<li><strong class="bold">$object | Get-Member -</strong><span class="No-Break"><strong class="bold">MemberType Method</strong></span></li>
				<li><strong class="bold">$</strong><span class="No-Break"><strong class="bold">object.MethodName()</strong></span></li>
				<li><strong class="bold">$</strong><span class="No-Break"><strong class="bold">object.PropertyName</strong></span></li>
			</ol>
		</div>
	</body></html>