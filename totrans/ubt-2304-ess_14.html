<html><head></head><body>
<div class="_idGenObjectStyleOverride-1" id="_idContainer223">
<p class="Chapter-Title" id="_idParaDest-131" lang="en-US"><span class="ChapterMarker"><span class="koboSpan" id="kobo.1.1">15. </span></span><a id="_idTextAnchor240"/><a id="_idTextAnchor241"/><span class="koboSpan" id="kobo.2.1">Using gufw and ufw to Configure an Ubuntu Firewall</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><a id="_idIndexMarker340"/><a id="_idIndexMarker341"/><a id="_idIndexMarker342"/><span class="koboSpan" id="kobo.3.1">In the previous chapter, we looked at ports and services on an Ubuntu system. </span><span class="koboSpan" id="kobo.3.2">We also briefly looked at iptables firewall rules on Ubuntu including the creation of a few very simple rules from the command line. </span><span class="koboSpan" id="kobo.3.3">In this chapter, we will look at a more user-friendly approach to iptables configuration using two tools named gufw and ufw. </span><span class="koboSpan" id="kobo.3.4">As we will see, gufw and ufw provide a high level of control over both inbound and outbound network traffic and connections without the need to understand the lower-level iptables syntax. </span></p>
<p class="Heading-1-1" id="_idParaDest-132" lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.4.1">15.1 </span></span><a id="_idTextAnchor242"/><span class="koboSpan" id="kobo.5.1">An Overview of </span><a id="_idIndexMarker343"/><span class="koboSpan" id="kobo.6.1">gufw and </span><a id="_idIndexMarker344"/><span class="koboSpan" id="kobo.7.1">ufw</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.8.1">Included with Ubuntu is a package called ufw which is an acronym for Uncomplicated Firewall. </span><span class="koboSpan" id="kobo.8.2">This package provides a command line interface for managing and configuring rules for the Netfilter iptables-based firewall. </span><span class="koboSpan" id="kobo.8.3">The gufw tool provides a user-friendly graphical interface to ufw designed to make firewall management possible without the need to issue ufw commands at the command line.</span></p>
<p class="Heading-1-1" id="_idParaDest-133" lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.9.1">15.2 </span></span><a id="_idTextAnchor243"/><span class="koboSpan" id="kobo.10.1">Installing </span><a id="_idIndexMarker345"/><span class="koboSpan" id="kobo.11.1">gufw on Ubuntu </span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.12.1">Whilst ufw is installed on Ubuntu by default, the gufw package is not. </span><span class="koboSpan" id="kobo.12.2">To install gufw, therefore, open a Terminal window (Ctrl-Alt-T) and enter the following command at the resulting prompt:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.13.1"># apt install gufw</span></p>
<p class="Heading-1-1" id="_idParaDest-134" lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.14.1">15.3 </span></span><a id="_idTextAnchor244"/><span class="koboSpan" id="kobo.15.1">Running and Enabling </span><a id="_idIndexMarker346"/><a id="_idIndexMarker347"/><span class="koboSpan" id="kobo.16.1">gufw</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.17.1">Once installed, launch </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.18.1">gufw</span></span><span class="koboSpan" id="kobo.19.1"> by pressing Alt-F2 within the GNOME desktop and entering </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.20.1">gufw</span></span><span class="koboSpan" id="kobo.21.1"> into the Run a command text box. </span><span class="koboSpan" id="kobo.21.2">When invoked for the first time, it is likely that the firewall will be disabled, as illustrated in </span><a href="Ubuntu_ufw_Firewall.xhtml#_idTextAnchor245"><span class="koboSpan" id="kobo.22.1">Figure 15-1</span></a><span class="koboSpan" id="kobo.23.1">.</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.24.1">To enable the firewall, move the Status switch (A) to the on position. </span><span class="koboSpan" id="kobo.24.2">By default, the main panel (D) will be displaying the gufw home page containing some basic information about the tool. </span><span class="koboSpan" id="kobo.24.3">Selecting options from the row of buttons (C) will change the information displayed in the panel. </span><span class="koboSpan" id="kobo.24.4">For example, select the Rules button to add, remove and view rules.</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.25.1">The gufw tool is provided with a small set of pre-configured profiles for work, home, and public environments. </span><span class="koboSpan" id="kobo.25.2">To change the profile and view the settings, select the profile from the menu (B). </span><span class="koboSpan" id="kobo.25.3">To modify an existing profile, select it from the menu and use the Incoming and Outgoing menus to change the selections. </span><span class="koboSpan" id="kobo.25.4">To configure specific rules, display the Rules screen and add, remove, and modify rules as required. </span><span class="koboSpan" id="kobo.25.5">These will then be applied to the currently selected profile. </span></p>
<p class="My-Basic-Paragraph ParaOverride-1" lang="en-US"><span class="koboSpan" id="kobo.26.1"><img alt="" class="_idGenObjectAttribute-1" src="image/ubuntu_gufw.jpg"/></span></p>
<p class="Figure-Caption" lang="en-US"><span class="FigureCaptionMarker"><span class="koboSpan" id="kobo.27.1">Figure 15-1</span></span><a id="_idTextAnchor245"/></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.28.1">The currently selected profile dictates how the firewall handles traffic in the absence of any specific policy rules. </span><span class="koboSpan" id="kobo.28.2">By default, the Home profile, for example, is configured to deny all incoming traffic and allow all outgoing traffic. </span><span class="koboSpan" id="kobo.28.3">These default policy settings are changed using the Incoming: and Outgoing: menus (E).</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.29.1">Exceptions to the default policy are defined through the creation of additional rules. </span><span class="koboSpan" id="kobo.29.2">With the Home profile denying incoming traffic, for example, rules would need to be added to enable certain acceptable types of incoming connections. </span><span class="koboSpan" id="kobo.29.3">Such rules are referred to in the security community as a whitelist. </span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.30.1">If, on the other hand, the incoming policy was changed to Allow all traffic, then all incoming traffic would be permitted unless rules were created for specific types of connections that must be blocked. </span><span class="koboSpan" id="kobo.30.2">These rules, unsurprisingly, are referred to as a blacklist. </span><span class="koboSpan" id="kobo.30.3">The blacklist/whitelist approach applies equally to incoming and outgoing connections.</span></p>
<p class="Heading-1-1" id="_idParaDest-135" lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.31.1">15.4 </span></span><a id="_idTextAnchor246"/><span class="koboSpan" id="kobo.32.1">Creating a </span><a id="_idIndexMarker348"/><span class="koboSpan" id="kobo.33.1">New Profile</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.34.1">While it is possible to modify the pre-defined profiles, it will typically make more sense to create one or more profiles to configure the firewall for your specific needs. </span><span class="koboSpan" id="kobo.34.2">New profiles are created by selecting the </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.35.1">Edit -&gt; Preferences...</span></span><span class="koboSpan" id="kobo.36.1"> menu option to display the dialog shown in </span><a href="Ubuntu_ufw_Firewall.xhtml#_idTextAnchor247"><span class="koboSpan" id="kobo.37.1">Figure 15-2</span></a><span class="koboSpan" id="kobo.38.1">:</span></p>
<p class="My-Basic-Paragraph ParaOverride-1" lang="en-US"><span class="koboSpan" id="kobo.39.1"><img alt="" class="_idGenObjectAttribute-2" src="image/ubuntu_gufw_preferences.jpg"/></span></p>
<p class="Figure-Caption" lang="en-US"><span class="FigureCaptionMarker"><span class="koboSpan" id="kobo.40.1">Figure 15-2</span></span><a id="_idTextAnchor247"/></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.41.1">To add a new profile, click on the ‘+’ button located beneath the list of profiles. </span><span class="koboSpan" id="kobo.41.2">A new profile named Profile 1 will appear in the list. </span><span class="koboSpan" id="kobo.41.3">To give the profile a more descriptive name, double-click on the entry to enter edit mode and enter a new name:</span></p>
<p class="My-Basic-Paragraph ParaOverride-1" lang="en-US"><span class="koboSpan" id="kobo.42.1"><img alt="" class="_idGenObjectAttribute-3" src="image/ubuntu_gufw_new_profile.jpg"/></span></p>
<p class="Figure-Caption" lang="en-US"><span class="FigureCaptionMarker"><span class="koboSpan" id="kobo.43.1">Figure 15-3</span></span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.44.1">Once the profile has been created and named, click on the Close button to return to the main screen, select it from the Profile menu and turn on the Status switch:</span></p>
<p class="My-Basic-Paragraph ParaOverride-1" lang="en-US"><span class="koboSpan" id="kobo.45.1"><img alt="" class="_idGenObjectAttribute-4" src="image/ubuntu_gufw_enabled.jpg"/></span></p>
<p class="Figure-Caption" lang="en-US"><span class="FigureCaptionMarker"><span class="koboSpan" id="kobo.46.1">Figure 15-4</span></span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.47.1">With the custom profile selected, it is ready to set up some custom rules that override the default incoming and outgoing settings.</span></p>
<p class="Heading-1-1" id="_idParaDest-136" lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.48.1">15.5 </span></span><a id="_idTextAnchor248"/><span class="koboSpan" id="kobo.49.1">Adding </span><a id="_idIndexMarker349"/><span class="koboSpan" id="kobo.50.1">Preconfigured Firewall Rules</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.51.1">New rules are created by clicking on the Rules button followed by the + button located at the bottom of the rules panel, as highlighted in </span><a href="Ubuntu_ufw_Firewall.xhtml#_idTextAnchor249"><span class="koboSpan" id="kobo.52.1">Figure 15-5</span></a><span class="koboSpan" id="kobo.53.1">:</span></p>
<p class="My-Basic-Paragraph ParaOverride-1" lang="en-US"><span class="koboSpan" id="kobo.54.1"><img alt="" class="_idGenObjectAttribute-5" src="image/ubuntu_gufw_add_rule.jpg"/></span></p>
<p class="Figure-Caption" lang="en-US"><span class="FigureCaptionMarker"><span class="koboSpan" id="kobo.55.1">Figure 15-5</span></span><a id="_idTextAnchor249"/></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.56.1">Once selected, the dialog shown in </span><a href="Ubuntu_ufw_Firewall.xhtml#_idTextAnchor250"><span class="koboSpan" id="kobo.57.1">Figure 15-6</span></a><span class="koboSpan" id="kobo.58.1"> will appear with the Preconfigured tab selected.</span><span class="CharOverride-1"> </span><span class="koboSpan" id="kobo.59.1">The Preconfigured panel allows rules to be selected that match specific applications and services. </span><span class="koboSpan" id="kobo.59.2">For example, traffic from such tools as Skype and BitTorrent may be enabled by selecting the entry from the Application menu and the Policy and Direction menus accordingly to restrict or allow traffic.</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.60.1">To help find a specific application or service, use the Category and Subcategory menus to filter the items that appear in the Application menu. </span><span class="koboSpan" id="kobo.60.2">Alternatively, simply enter the application or service name in the Application Filter field to filter the menu items:</span></p>
<p class="My-Basic-Paragraph ParaOverride-1" lang="en-US"> <span class="koboSpan" id="kobo.61.1"><img alt="" class="_idGenObjectAttribute-6" src="image/ubuntu_gufw_preconfigured.jpg"/></span></p>
<p class="Figure-Caption" lang="en-US"><span class="FigureCaptionMarker"><span class="koboSpan" id="kobo.62.1">Figure 15-6</span></span><a id="_idTextAnchor250"/></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.63.1"> The Policy menu provides the following options for controlling traffic for the selected application or service:</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.64.1">• </span><a id="_idIndexMarker350"/><span class="My-Bold _idGenCharOverride-1"><span class="koboSpan" id="kobo.65.1">Allow</span></span><span class="koboSpan" id="kobo.66.1"> – Traffic is permitted on the port. </span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.67.1">• </span><a id="_idIndexMarker351"/><span class="My-Bold _idGenCharOverride-1"><span class="koboSpan" id="kobo.68.1">Deny</span></span><span class="koboSpan" id="kobo.69.1"> – Traffic is not permitted on the port. </span><span class="koboSpan" id="kobo.69.2">The requesting system is not notified of the denial. </span><span class="koboSpan" id="kobo.69.3">The data packet is simply dropped.</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.70.1">• </span><a id="_idIndexMarker352"/><span class="My-Bold _idGenCharOverride-1"><span class="koboSpan" id="kobo.71.1">Reject</span></span><span class="koboSpan" id="kobo.72.1"> - Traffic is not permitted on the port. </span><span class="koboSpan" id="kobo.72.2">The data packet is dropped, and the requesting system is notified of the rejection. </span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.73.1">• </span><a id="_idIndexMarker353"/><span class="My-Bold _idGenCharOverride-1"><span class="koboSpan" id="kobo.74.1">Limit</span></span><span class="koboSpan" id="kobo.75.1"> - Connections are denied if the same IP address has attempted to establish 6 or more connections over a 30-second time frame.</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.76.1">Once a rule has been defined, clicking the Add button will implement the rule, dismiss the Add Rule dialog and the new rule will be listed in the main screen of the gufw tool (with rules for both IPv4 and IPv6 protocols):</span></p>
<p class="My-Basic-Paragraph ParaOverride-1" lang="en-US"><span class="koboSpan" id="kobo.77.1"><img alt="" class="_idGenObjectAttribute-7" src="image/ubuntu_gufw_rule_added.jpg"/></span></p>
<p class="Figure-Caption" lang="en-US"><span class="FigureCaptionMarker"><span class="koboSpan" id="kobo.78.1">Figure 15-7</span></span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.79.1">To delete a rule, select it within the list and click on the ‘-’ button located at the bottom of the dialog. </span><span class="koboSpan" id="kobo.79.2">Similarly, edit an existing rule by selecting it and clicking on the gear button to the right of the ‘-’ button.</span></p>
<p class="Heading-1-1" id="_idParaDest-137" lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.80.1">15.6 </span></span><a id="_idTextAnchor251"/><a id="_idIndexMarker354"/><a id="_idTextAnchor252"/><span class="koboSpan" id="kobo.81.1">Adding Simple Firewall Rules</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.82.1">Whereas preconfigured rules allow the firewall to be configured based on well known services and applications, the Simple tab of the Add Rule dialog allows incoming and outgoing rules to be defined simply by referencing the corresponding TCP/IP port. </span><span class="koboSpan" id="kobo.82.2">The ports used by known applications and services represent only a small subset of the ports available for use by applications and for which firewall rules may need to be defined. </span><span class="koboSpan" id="kobo.82.3">A third-party application might, for example, use port 5700 to communicate with a remote server. </span><span class="koboSpan" id="kobo.82.4">That being the case, it may be necessary to allow traffic on this specific port using the Simple panel:</span></p>
<p class="My-Basic-Paragraph ParaOverride-1" lang="en-US"> <span class="koboSpan" id="kobo.83.1"><img alt="" class="_idGenObjectAttribute-8" src="image/ubuntu_gufw_simple.jpg"/></span></p>
<p class="Figure-Caption" lang="en-US"><span class="FigureCaptionMarker"><span class="koboSpan" id="kobo.84.1">Figure 15-8</span></span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.85.1">The rule may be configured to filter either TCP, UDP or both traffic types. </span><span class="koboSpan" id="kobo.85.2">In addition, the port may be specified as a single port number or as a range of ports with the start and end ports separated by a colon (1000:1500, for example, would apply the rule to all ports between 1000 and 1500). </span><span class="koboSpan" id="kobo.85.3">Alternatively, enter the name of the service associated with the port (for example, https or ssh)</span></p>
<p class="Heading-1-1" id="_idParaDest-138" lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.86.1">15.7 </span></span><a id="_idTextAnchor253"/><span class="koboSpan" id="kobo.87.1">Adding </span><a id="_idIndexMarker355"/><span class="koboSpan" id="kobo.88.1">Advanced Rules</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.89.1">So far, we have looked at rules to control only the type of traffic to block (incoming traffic on port 22, for example) regardless of the source or destination of the traffic. </span><span class="koboSpan" id="kobo.89.2">It is often the case, however, that rules will need to be defined to allow or deny traffic based on an IP address or range of IP addresses. </span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.90.1">For the purposes of an example, assume that the local system has an IP address of 192.168.0.102. </span><span class="koboSpan" id="kobo.90.2">The firewall may be configured to only allow access on port 22 from a system with the IP address of, for example, 192.168.0.105. </span><span class="koboSpan" id="kobo.90.3">To achieve this, the From: field of the Advanced settings panel should be set to the IP address of the system from which the connection request is originating (in this case 192.168.0.105).</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.91.1">The To: fields provide the option to specify the IP address and port of the system to which the connection is being made. </span><span class="koboSpan" id="kobo.91.2">In this example, this would be port 22 on the local system (192.168.0.102). </span><span class="koboSpan" id="kobo.91.3">The To: IP address is actually optional and may be left blank:</span></p>
<p class="My-Basic-Paragraph ParaOverride-1" lang="en-US"> <span class="koboSpan" id="kobo.92.1"><img alt="" class="_idGenObjectAttribute-9" src="image/ubuntu_gufw_advanced.jpg"/></span></p>
<p class="Figure-Caption" lang="en-US"><span class="FigureCaptionMarker"><span class="koboSpan" id="kobo.93.1">Figure 15-9</span></span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.94.1">Assuming that the incoming default policy is still set to Deny or Reject on the main screen, the above rule will allow SSH access via port 22 to the local system only from the remote system with the IP address of 192.168.0.105. </span><span class="koboSpan" id="kobo.94.2">SSH access attempts from systems with other IP addresses will fail. </span><span class="koboSpan" id="kobo.94.3">Note that if the target system is the local system the To: IP address field may be left blank.</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.95.1">The Insert field in the above dialog allows the new rule to be inserted at the specified position in the list of existing rules, thereby allowing you to control the order in which the rules are applied within the firewall.</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.96.1">It is also possible to specify a range of addresses by using the IP address bitmask. </span><span class="koboSpan" id="kobo.96.2">For example, to create a rule for a range of IP addresses from 192.168.0.1 to 192.168.0.255 the IP address should be entered into the From: field as 192.168.0.0/24.</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.97.1">Similarly, to specify a rule covering IP address range 192.168.0.1 to 192.168.0.30, a bitmask of 27 would be used, i.e. </span><span class="koboSpan" id="kobo.97.2">192.168.0.0/27. </span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.98.1">A useful calculator for identifying the address range covered by each bit mask value is available online at </span><a href="http://subnet-calculator.com"><span class="Hyperlink _idGenCharOverride-1"><span class="koboSpan" id="kobo.99.1">http://subnet-calculator.com</span></span></a><span class="koboSpan" id="kobo.100.1">.	 </span></p>
<p class="Heading-1-1" id="_idParaDest-139" lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.101.1">15.8 </span></span><a id="_idTextAnchor254"/><span class="koboSpan" id="kobo.102.1">Configuring the Firewall from the Command Line using </span><a id="_idIndexMarker356"/><span class="koboSpan" id="kobo.103.1">ufw</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.104.1">All of the firewall configuration options available through the graphical gufw tool are also available from the underlying command line using </span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.105.1">ufw</span></span><span class="koboSpan" id="kobo.106.1"> command.</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.107.1">To </span><a id="_idIndexMarker357"/><span class="koboSpan" id="kobo.108.1">enable or </span><a id="_idIndexMarker358"/><span class="koboSpan" id="kobo.109.1">disable the firewall:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.110.1"># ufw enable</span></p>
<p class="Code"><span class="koboSpan" id="kobo.111.1"># ufw disable</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.112.1">The current status of the firewall may be obtained using the</span><span class="My-Italic _idGenCharOverride-1"><span class="koboSpan" id="kobo.113.1"> status</span></span><span class="koboSpan" id="kobo.114.1"> option</span><a id="_idIndexMarker359"/><span class="koboSpan" id="kobo.115.1">:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.116.1"># ufw status</span></p>
<p class="Code"><span class="koboSpan" id="kobo.117.1">Status: active</span></p>
<p class="Code"><span class="koboSpan" id="kobo.118.1"> </span></p>
<p class="Code"><span class="koboSpan" id="kobo.119.1">To                         Action      From</span></p>
<p class="Code"><span class="koboSpan" id="kobo.120.1">--                         ------      ----</span></p>
<p class="Code"><span class="koboSpan" id="kobo.121.1">22                         ALLOW       192.168.86.30  </span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.122.1">For more details status information, combine the above command with the verbose option:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.123.1"># ufw status verbose</span></p>
<p class="Code"><span class="koboSpan" id="kobo.124.1">Status: active</span></p>
<p class="Code"><span class="koboSpan" id="kobo.125.1">Logging: on (full)</span></p>
<p class="Code"><span class="koboSpan" id="kobo.126.1">Default: deny (incoming), allow (outgoing), deny (routed)</span></p>
<p class="Code"><span class="koboSpan" id="kobo.127.1">New profiles: skip</span></p>
<p class="Code"><span class="koboSpan" id="kobo.128.1"> </span></p>
<p class="Code"><span class="koboSpan" id="kobo.129.1">To                         Action      From</span></p>
<p class="Code"><span class="koboSpan" id="kobo.130.1">--                         ------      ----</span></p>
<p class="Code"><span class="koboSpan" id="kobo.131.1">22                         ALLOW IN    192.168.86.30</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.132.1">The output in the above example shows that the default policy for the firewall is to deny all incoming and routed connections while allowing all outgoing connections. </span><span class="koboSpan" id="kobo.132.2">To change any of these default settings, use the ufw command with the default option using the following syntax:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.133.1"># ufw default &lt;policy&gt; &lt;direction&gt;</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><a id="_idIndexMarker360"/><span class="koboSpan" id="kobo.134.1">For example, to enable all incoming connections by default:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.135.1"># ufw default allow incoming</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.136.1">To allow or block traffic on a specific port, use the following syntax:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.137.1"># ufw &lt;policy&gt; &lt;port number&gt;/&lt;optional protocol&gt;</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.138.1">For example, to allow both TCP and UDP incoming traffic on port 30:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.139.1"># ufw allow 30</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.140.1">Similarly, to deny incoming TCP traffic on port 5700:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.141.1"># ufw deny 5700/tcp</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.142.1">Rules may also be declared by referencing the name of the service corresponding to the port. </span><span class="koboSpan" id="kobo.142.2">For example, to enable SSH access on port 22:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.143.1"># ufw allow ssh</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.144.1">As with the gufw tool, ufw also allows access to be controlled from specific external IP addresses. </span><span class="koboSpan" id="kobo.144.2">For example, to allow all incoming traffic from IP address 192.168.0.20:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.145.1"># ufw allow from 192.168.0.20</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.146.1">To specifically deny traffic from an IP address:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.147.1"># ufw deny 192.168.0.20</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.148.1">To limit access for IP address 192.168.0.20 to only port 22:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.149.1"># ufw allow from 192.168.0.22 to any port 22</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.150.1">To further restrict access for the IP address to only TCP packets, use the following syntax:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.151.1"># ufw allow from 192.168.0.20 to any port 22 proto tcp</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.152.1">The position of a new rule within the list of existing rules may be declared using the insert option. </span><span class="koboSpan" id="kobo.152.2">For example to create a new rule and insert it at position 3 in the rules list:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.153.1"># ufw insert 3 allow from 192.168.0.123 to any port 2</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.154.1">To display the list of rules with associated numbers:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.155.1"># ufw status numbered</span></p>
<p class="Code"><span class="koboSpan" id="kobo.156.1">Status: active</span></p>
<p class="Code"><span class="koboSpan" id="kobo.157.1"> </span></p>
<p class="Code"><span class="koboSpan" id="kobo.158.1">     To                         Action      From</span></p>
<p class="Code"><span class="koboSpan" id="kobo.159.1">     --                         ------      ----</span></p>
<p class="Code"><span class="koboSpan" id="kobo.160.1">[ 1] 22                         ALLOW IN    192.168.86.30             </span></p>
<p class="Code"><span class="koboSpan" id="kobo.161.1">[ 2] 30                         ALLOW IN    Anywhere                  </span></p>
<p class="Code"><span class="koboSpan" id="kobo.162.1">[ 3] 22                         ALLOW IN    192.168.0.123             </span></p>
<p class="Code"><span class="koboSpan" id="kobo.163.1">[ 4] 5700/tcp                   DENY IN     Anywhere                  </span></p>
<p class="Code"><span class="koboSpan" id="kobo.164.1">[ 5] 22/tcp                     ALLOW IN    Anywhere                  </span></p>
<p class="Code"><span class="koboSpan" id="kobo.165.1">[ 6] Anywhere                   ALLOW IN    192.168.0.20              </span></p>
<p class="Code"><span class="koboSpan" id="kobo.166.1">[ 7] 22                         ALLOW IN    192.168.0.4               </span></p>
<p class="Code"><span class="koboSpan" id="kobo.167.1">[ 8] 30 (v6)                    ALLOW IN    Anywhere (v6)             </span></p>
<p class="Code"><span class="koboSpan" id="kobo.168.1">[ 9] 5700/tcp (v6)              DENY IN     Anywhere (v6)             </span></p>
<p class="Code"><span class="koboSpan" id="kobo.169.1">[10] 22/tcp (v6)                ALLOW IN    Anywhere (v6)  </span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.170.1">Having identified the number assigned to a rule, that number may be used to remove the rule from the firewall:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.171.1"># ufw delete 4</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.172.1">To obtain a full listing of the capabilities of the ufw tool run the command with the –help argument:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.173.1"># ufw help</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><a id="_idIndexMarker361"/><span class="koboSpan" id="kobo.174.1">Logging of firewall activity can be enabled and disabled using the logging command-line option:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.175.1"># ufw logging on</span></p>
<p class="Code"><span class="koboSpan" id="kobo.176.1"># ufw logging off</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.177.1">The amount of logging performed by ufw may also be declared, including a low, medium, high, or full setting when turning on logging, for example:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.178.1"># ufw logging on low </span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.179.1">The ufw log file can be found at:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.180.1">/var/log/ufw.log</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.181.1">Use the reload option to restart the firewall and reload all current settings</span><a id="_idIndexMarker362"/><span class="koboSpan" id="kobo.182.1">:</span></p>
<p class="Code"><span class="koboSpan" id="kobo.183.1"># ufw reload</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.184.1">Finally, to reset the firewall to the default settings (thereby removing all existing rules and settings</span><a id="_idIndexMarker363"/><span class="koboSpan" id="kobo.185.1">):</span></p>
<p class="Code"><span class="koboSpan" id="kobo.186.1"># ufw reset</span></p>
<p class="Heading-1-1" id="_idParaDest-140" lang="en-US"><span class="Heading11Marker"><span class="koboSpan" id="kobo.187.1">15.9 </span></span><a id="_idTextAnchor255"/><span class="koboSpan" id="kobo.188.1">Summary</span></p>
<p class="My-Basic-Paragraph" lang="en-US"><span class="koboSpan" id="kobo.189.1">Any computer system that is connected to other systems, either via an internal network or through an internet connection should implement some form of firewall to mitigate the risk of attack. </span><span class="koboSpan" id="kobo.189.2">The Uncomplicated Firewall provided with Ubuntu provides a simple yet effective firewall that allows basic rules to be defined either using the command-line or the graphical gufw tool. </span><span class="koboSpan" id="kobo.189.3">This chapter has outlined the basics of enabling the firewall and configuring firewall rules.</span></p>
</div>
</body></html>