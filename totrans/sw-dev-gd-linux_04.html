<html><head></head><body>
<div class="Basic-Text-Frame" id="_idContainer043">
<h1 class="chapterNumber"><span class="koboSpan" id="kobo.1.1">4</span></h1>
<h1 class="chapterTitle" id="_idParaDest-72"><span class="koboSpan" id="kobo.2.1">Using Shell History</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.3.1">To become skilled at the command line, you have to use it regularly. </span><span class="koboSpan" id="kobo.3.2">There are no shortcuts to becoming comfortable, but there are a few high-value tricks that you can learn early on, which will save you time and frustration. </span><span class="koboSpan" id="kobo.3.3">The earlier you build them into your muscle memory, the better.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.4.1">In this chapter, you’ll learn how to leverage your shell history to avoid the tedious re-typing of commands you’ve already run. </span><span class="koboSpan" id="kobo.4.2">You’ll also see how to customize your shell’s behavior or appearance via the shell configuration file. </span><span class="koboSpan" id="kobo.4.3">Finally, we’ll show you the most useful shortcuts to edit and modify commands at the command prompt. </span><span class="koboSpan" id="kobo.4.4">All in all, this chapter will make you blazing fast on the command line.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.5.1">We will go about this by covering the following topics:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.6.1">Shell history</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.7.1">Executing previous commands with </span><code class="inlineCode"><span class="koboSpan" id="kobo.8.1">!</span></code></li>
<li class="bulletList"><span class="koboSpan" id="kobo.9.1">Jumping to the beginning or end of a line</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.10.1">Let’s begin by understanding shell history.</span></p>
<h1 class="heading-1" id="_idParaDest-73"><span class="koboSpan" id="kobo.11.1">Shell history</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.12.1">Most shells keep a </span><a id="_idIndexMarker129"/><span class="koboSpan" id="kobo.13.1">history of the commands you’ve run. </span><span class="koboSpan" id="kobo.13.2">This means that you can see every successful command that you’ve run just by pressing the arrow keys: the </span><em class="keystroke"><span class="koboSpan" id="kobo.14.1">Up-Arrow</span></em><span class="koboSpan" id="kobo.15.1"> key to go back one command and </span><em class="keystroke"><span class="koboSpan" id="kobo.16.1">Down-Arrow</span></em><span class="koboSpan" id="kobo.17.1"> to go forward one. </span><span class="koboSpan" id="kobo.17.2">Scrolling through your shell history like this can be very useful, especially if you find that you’re re-running similar commands frequently.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.18.1">Note that you can also edit commands that you find like this: use </span><em class="keystroke"><span class="koboSpan" id="kobo.19.1">Left-Arrow</span></em><span class="koboSpan" id="kobo.20.1"> and </span><em class="keystroke"><span class="koboSpan" id="kobo.21.1">Right-Arrow</span></em><span class="koboSpan" id="kobo.22.1"> to navigate to the line of text that is a command, and just type to edit the command. </span></p>
<p class="normal"><span class="koboSpan" id="kobo.23.1">An edited command is added to the end of your shell history (it doesn’t actually modify </span><a id="_idIndexMarker130"/><span class="koboSpan" id="kobo.24.1">the saved line in the history).</span></p>
<p class="normal"><span class="koboSpan" id="kobo.25.1">Together, these tricks allow you to easily go back and re-execute or modify previous commands.</span></p>
<h2 class="heading-2" id="_idParaDest-74"><span class="koboSpan" id="kobo.26.1">Shell configuration files</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.27.1">Some of the tricks we’ll talk </span><a id="_idIndexMarker131"/><span class="koboSpan" id="kobo.28.1">about require changes to your shell’s configuration file. </span><span class="koboSpan" id="kobo.28.2">The workflow is usually the following:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.29.1">Change the option you want to change in your shell’s config file.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.30.1">Save the file.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.31.1">Open a new shell session to see the changes.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.32.1">For existing shell sessions, re-read your shell config file by running a command to </span><code class="inlineCode"><span class="koboSpan" id="kobo.33.1">source</span></code><span class="koboSpan" id="kobo.34.1"> (execute) it: </span><code class="inlineCode"><span class="koboSpan" id="kobo.35.1">source ~/path/to/config/file</span></code><span class="koboSpan" id="kobo.36.1">.</span></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.37.1">Here are locations for the most common shells:</span></p>
<table class="table-container" id="table001-1">
<tbody>
<tr>
<td class="table-cell">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.38.1">Common shells</span></strong></p>
</td>
<td class="table-cell">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.39.1">Locations</span></strong></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.40.1">Bash</span></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.41.1">~/.bashrc</span></code><span class="koboSpan" id="kobo.42.1"> for interactive sessions, such as the one you get from opening a new terminal window in your graphical environment. </span><span class="koboSpan" id="kobo.42.2">You almost always want this one if you’re changing the configuration on your work machine. </span><span class="koboSpan" id="kobo.42.3">“Interactive” here refers to situations where you as a user make use of the shell in a terminal, not to a script running (for example, a script automatically invoked by a cron job). </span><span class="koboSpan" id="kobo.42.4">You’re in an “interactive shell” when you are in some form of terminal, manually being prompted for input and writing commands.</span></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.43.1">~/.bash_profile</span></code><span class="koboSpan" id="kobo.44.1"> for login shells – this might be a local login, but also what you get if you log in over SSH. </span><span class="koboSpan" id="kobo.44.2">Again this is in comparison to shell instances when running a script.</span></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.45.1">Zsh (the Z shell)</span></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.46.1">~/.zshrc</span></code></p>
</td>
</tr>
</tbody>
</table>
<h2 class="heading-2" id="_idParaDest-75"><span class="koboSpan" id="kobo.47.1">History files</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.48.1">Different shells keep</span><a id="_idIndexMarker132"/><span class="koboSpan" id="kobo.49.1"> history files in different places, and most can be configured to change the location. </span><span class="koboSpan" id="kobo.49.2">By default, you’ll almost always be using Bash, which, by default, keeps its history file at </span><code class="inlineCode"><span class="koboSpan" id="kobo.50.1">~/.bash_history</span></code><span class="koboSpan" id="kobo.51.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.52.1">If you’re ever unsure about where to find the shell history file, many shells have a shell configuration option named </span><code class="inlineCode"><span class="koboSpan" id="kobo.53.1">HISTFILE</span></code><span class="koboSpan" id="kobo.54.1"> that contains the history file’s location.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.55.1">Here, I’m checking to see where my history file is, while running the </span><code class="inlineCode"><span class="koboSpan" id="kobo.56.1">zsh</span></code><span class="koboSpan" id="kobo.57.1"> OS:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.58.1">% echo $HISTFILE
/home/dcohen/.zsh_history
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.59.1">Bash has two configuration options that prevent your history file from growing indefinitely, to keep its size manageable and your history searches fast:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.60.1">HISTSIZE</span></code><span class="koboSpan" id="kobo.61.1"> controls the maximum history kept in memory</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.62.1">HISTFILESIZE</span></code><span class="koboSpan" id="kobo.63.1"> controls the maximum size of the history file that’s saved between shell sessions</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.64.1">If you want to increase the amount of history that Bash keeps, increase both of the preceding in your shell’s configuration file.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.65.1">To do so open the shell’s configuration file (e.g., </span><code class="inlineCode"><span class="koboSpan" id="kobo.66.1">~/.bashrc</span></code><span class="koboSpan" id="kobo.67.1">) and set these variables by appending the following lines to the end of the file:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.68.1">export HISTSIZE=1000
export HISTFILESIZE=5000
</span></code></pre>
<h2 class="heading-2" id="_idParaDest-76"><span class="koboSpan" id="kobo.69.1">Searching through shell history</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.70.1">You will often find yourself looking for a command you ran a week (or a month) ago. </span><span class="koboSpan" id="kobo.70.2">That command will likely be further back in your history, and it would be a waste of time to hit </span><em class="keystroke"><span class="koboSpan" id="kobo.71.1">Up-Arrow</span></em><span class="koboSpan" id="kobo.72.1"> hundreds of times to get there. </span><span class="koboSpan" id="kobo.72.2">If you have at least </span><em class="italic"><span class="koboSpan" id="kobo.73.1">some</span></em><span class="koboSpan" id="kobo.74.1"> idea of what you’re looking for, an interactive shell history search is the trick that you’re looking for. </span><span class="koboSpan" id="kobo.74.2">Here’s how to </span><a id="_idIndexMarker133"/><span class="koboSpan" id="kobo.75.1">search your shell history:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.76.1">Press </span><em class="keystroke"><span class="koboSpan" id="kobo.77.1">CTRL</span></em><span class="koboSpan" id="kobo.78.1"> + </span><em class="keystroke"><span class="koboSpan" id="kobo.79.1">R</span></em><span class="koboSpan" id="kobo.80.1"> to invoke </span><code class="inlineCode"><span class="koboSpan" id="kobo.81.1">reverse-i-search</span></code><span class="koboSpan" id="kobo.82.1">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.83.1">Type a part of the command you are looking for.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.84.1">Your shell will try to match the characters you type against your command history and come up with the closest, most recent match.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.85.1">Repeatedly press </span><em class="keystroke"><span class="koboSpan" id="kobo.86.1">CTRL</span></em><span class="koboSpan" id="kobo.87.1"> + </span><em class="keystroke"><span class="koboSpan" id="kobo.88.1">R </span></em><span class="koboSpan" id="kobo.89.1">to step through the history. </span><span class="koboSpan" id="kobo.89.2">Press </span><em class="keystroke"><span class="koboSpan" id="kobo.90.1">ENTER</span></em><span class="koboSpan" id="kobo.91.1"> to select a command or </span><em class="keystroke"><span class="koboSpan" id="kobo.92.1">Esc</span></em><span class="koboSpan" id="kobo.93.1"> to exit this mode.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.94.1">If you accidentally skip backward past the command you wanted, </span><em class="keystroke"><span class="koboSpan" id="kobo.95.1">CTRL</span></em><span class="koboSpan" id="kobo.96.1"> + </span><em class="keystroke"><span class="koboSpan" id="kobo.97.1">SHIFT</span></em><span class="koboSpan" id="kobo.98.1"> + </span><em class="keystroke"><span class="koboSpan" id="kobo.99.1">R</span></em><span class="koboSpan" id="kobo.100.1"> will search forward to the</span><a id="_idIndexMarker134"/><span class="koboSpan" id="kobo.101.1"> next-most-recent match.</span></li>
</ol>
<h2 class="heading-2" id="_idParaDest-77"><span class="koboSpan" id="kobo.102.1">Exceptions</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.103.1">There are some exceptions</span><a id="_idIndexMarker135"/><span class="koboSpan" id="kobo.104.1"> to this feature depending on the shell and the configuration you are using.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.105.1">Some shells forget about commands that failed with an error (exited with a non-zero exit code). </span><span class="koboSpan" id="kobo.105.2">Many shells also forget commands starting with a space character – those won’t be added to the shell’s history. </span><span class="koboSpan" id="kobo.105.3">However, in both scenarios you are typically still able to reach the history entry if you go back (</span><em class="keystroke"><span class="koboSpan" id="kobo.106.1">Up-Arrow</span></em><span class="koboSpan" id="kobo.107.1">) right away, without executing any other commands.</span></p>
<h1 class="heading-1" id="_idParaDest-78"><span class="koboSpan" id="kobo.108.1">Executing previous commands with !</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.109.1">Executing previous commands is done with exclamation marks. </span><span class="koboSpan" id="kobo.109.2">There are various ways to use this trick, which we’ll look at now.</span></p>
<h2 class="heading-2" id="_idParaDest-79"><span class="koboSpan" id="kobo.110.1">Re-running a command with the same arguments</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.111.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.112.1">!</span></code><span class="koboSpan" id="kobo.113.1"> command will </span><a id="_idIndexMarker136"/><span class="koboSpan" id="kobo.114.1">execute the last command with the previous arguments. </span><span class="koboSpan" id="kobo.114.2">For example, </span><code class="inlineCode"><span class="koboSpan" id="kobo.115.1">!ssh</span></code><span class="koboSpan" id="kobo.116.1"> will go back and find the last </span><code class="inlineCode"><span class="koboSpan" id="kobo.117.1">ssh</span></code><span class="koboSpan" id="kobo.118.1"> command you ran and execute it with the same arguments. </span><span class="koboSpan" id="kobo.118.2">You can use this to re-run commands that you frequently use with the same arguments, such as to quickly re-connect to the SSH server you connect to every day.</span></p>
<h2 class="heading-2" id="_idParaDest-80"><span class="koboSpan" id="kobo.119.1">Prepending a command to something in your history</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.120.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.121.1">!!</span></code><span class="koboSpan" id="kobo.122.1"> command will </span><a id="_idIndexMarker137"/><span class="koboSpan" id="kobo.123.1">execute the last command you ran, but with some other command in front of it. </span><span class="koboSpan" id="kobo.123.2">This may sound strange, but it’s </span><em class="italic"><span class="koboSpan" id="kobo.124.1">very</span></em><span class="koboSpan" id="kobo.125.1"> useful for situations where you accidentally ran a command that requires root privileges without </span><code class="inlineCode"><span class="koboSpan" id="kobo.126.1">sudo</span></code><span class="koboSpan" id="kobo.127.1"> at the beginning.</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.128.1">apt-get install nginx # fails with a permission error
sudo !!
</span><span class="hljs-con-meta"><span class="koboSpan" id="kobo.129.1"># </span></span><span class="koboSpan" id="kobo.130.1">this is the </span><span class="hljs-con-built_in"><span class="koboSpan" id="kobo.131.1">command</span></span><span class="koboSpan" id="kobo.132.1"> that runs:
sudo apt-get install nginx
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.133.1">After that previous command fails due to a lack of permissions, simply running </span><code class="inlineCode"><span class="koboSpan" id="kobo.134.1">sudo !!</span></code><span class="koboSpan" id="kobo.135.1"> will re-run it with </span><code class="inlineCode"><span class="koboSpan" id="kobo.136.1">sudo</span></code><span class="koboSpan" id="kobo.137.1"> prepended to the beginning.</span></p>
<div class="note">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.138.1">Note</span></strong></p>
<p class="normal"><span class="koboSpan" id="kobo.139.1">For security, don’t make this an automatic habit: always make sure you know why a command needs more permissions and ask yourself whether you trust it enough to want to give it permission to do literally anything on your system. </span><span class="koboSpan" id="kobo.139.2">Careless misuse of </span><code class="inlineCode"><span class="koboSpan" id="kobo.140.1">sudo</span></code><span class="koboSpan" id="kobo.141.1"> can make it easy to break things or allow an attacker to gain a foothold on your system.</span></p>
</div>
<h1 class="heading-1" id="_idParaDest-81"><span class="koboSpan" id="kobo.142.1">Jumping to the beginning or end of the current line</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.143.1">It’s not uncommon to need to jump to the beginning of a line when editing, perhaps to correct the spelling of a command or add a required argument. </span><span class="koboSpan" id="kobo.143.2">To do this, press </span><em class="keystroke"><span class="koboSpan" id="kobo.144.1">CTRL</span></em><span class="koboSpan" id="kobo.145.1"> + </span><em class="keystroke"><span class="koboSpan" id="kobo.146.1">A</span></em><span class="koboSpan" id="kobo.147.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.148.1">Likewise, to jump back to the end of a line, use </span><em class="keystroke"><span class="koboSpan" id="kobo.149.1">CTRL</span></em><span class="koboSpan" id="kobo.150.1"> + </span><em class="keystroke"><span class="koboSpan" id="kobo.151.1">E</span></em><span class="koboSpan" id="kobo.152.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.153.1">These two will come in handy quite often.</span></p>
<h1 class="heading-1" id="_idParaDest-82"><span class="koboSpan" id="kobo.154.1">Conclusion</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.155.1">Working in a Linux shell environment entails a lot of typing. </span><span class="koboSpan" id="kobo.155.2">Making even the smallest improvements to your speed and accuracy as you construct and edit your commands can make the difference between feeling like basic tasks are taking forever and feeling like you’re speeding along like a seasoned Unix wizard.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.156.1">The tricks we’ve shared in this chapter are a few of the most common and most powerful shortcuts we use in our day-to-day work. </span><span class="koboSpan" id="kobo.156.2">Combining your new command-history-searching skills with the editing and command-modification shortcuts you just learned will have a massive impact on your comfort, efficiency, and speed on the command line.</span></p>
<h1 class="heading-1"><span class="koboSpan" id="kobo.157.1">Learn more on Discord</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.158.1">To join the Discord community for this book – where you can share feedback, ask questions to the author, and learn about new releases – follow the QR code below:</span></p>
<p class="normal"><a href="https://packt.link/SecNet"><span class="url"><span class="koboSpan" id="kobo.159.1">https://packt.link/SecNet</span></span></a></p>
<p class="normal"><span class="koboSpan" id="kobo.160.1"><img alt="" role="presentation" src="../Images/QR_Code1768422420210094187.png"/></span></p>
</div>
</body></html>