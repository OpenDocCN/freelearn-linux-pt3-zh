<html><head></head><body>
		<div id="_idContainer088">
			<h1 id="_idParaDest-48" class="chapter-number"><a id="_idTextAnchor049"/>4</h1>
			<h1 id="_idParaDest-49"><a id="_idTextAnchor050"/>Link Aggregation Creation – Creating Your Own Link and Mastering the Networking Domain </h1>
			<p>Network teaming is essential to <strong class="bold">High Availability</strong> (<strong class="bold">HA</strong>) and increasing throughput. HA<a id="_idIndexMarker173"/> is accomplished through normal teaming with nothing special needed from the switch. For more throughput, you need <strong class="bold">Link Aggregation Control Protocol</strong> (<strong class="bold">LACP</strong>) set up on the switch. Without the ability<a id="_idIndexMarker174"/> to have multiple network connectivity paths out of your systems to the internet, you are likely to get into an outage situation easily. Having multiple connectivity paths, such as with power being split between two providers, provides a better chance that you will not succumb to losing access to your application, thus alleviating some worry that the application that is presented to the world using what we learned earlier, in <a href="B18607_03.xhtml#_idTextAnchor039"><span class="No-Break"><em class="italic">Chapter 3</em></span></a>, <em class="italic">Network Services with Automation – Introduction to Red Hat Linux Networking</em>, will drop off the face of the planet and lose <span class="No-Break">you money.</span></p>
			<p>By utilizing network teaming in an HA function, if one connection goes down then the connectivity<a id="_idIndexMarker175"/> is not lost. When properly set up, such as having the two <strong class="bold">Network Interface Cards</strong> (<strong class="bold">NICs</strong>) going to different switches, it allows for fault tolerance. This is also a must when you are working on upgrades for the switches. If you don’t have any redundancy, you will be down if the switch is going through maintenance. The same can be said about having your application on a single server, but we are here to talk about networks <span class="No-Break">for now.</span></p>
			<p>In this chapter, we’re going to cover the following <span class="No-Break">main topics:</span></p>
			<ul>
				<li>Getting to know <span class="No-Break">link aggregation</span></li>
				<li>Creating different types of link <span class="No-Break">aggregation profiles</span></li>
				<li>Taking the headache out of setting up your link aggregation by using <span class="No-Break">Ansible Automation</span></li>
			</ul>
			<h1 id="_idParaDest-50"><a id="_idTextAnchor051"/>Technical requirements</h1>
			<p>The technical requirements for this chapter are covered in the following <span class="No-Break">two sections.</span></p>
			<h2 id="_idParaDest-51"><a id="_idTextAnchor052"/>Setting up GitHub access</h2>
			<p>Please refer to <a href="B18607_01.xhtml#_idTextAnchor016"><span class="No-Break"><em class="italic">Chapter 1</em></span></a>, <em class="italic">Block Storage – Learning How to Provision Block Storage on Red Hat Enterprise Linux</em>, to gain access to GitHub instructions and you will find the Ansible Automation playbooks for this chapter at the following link: <a href="https://github.com/PacktPublishing/Red-Hat-Certified-Specialist-in-Services-Management-and-Automation-EX358-Exam-Guide/tree/main/Chapter04">https://github.com/PacktPublishing/Red-Hat-Certified-Specialist-in-Services-Management-and-Automation-EX358-Exam-Guide/tree/main/Chapter04</a>. Remember these are suggested playbooks and are not the only way you can write them to make the playbooks work <span class="No-Break">for you.</span></p>
			<p>You can always change them up using raw, shell, or cmd to achieve the same results but we are demonstrating the best way to accomplish the goals. Also keep in mind we are not using the FCQN that is needed in future versions of Ansible as that will not be supported in the exam as it tests against <span class="No-Break">Ansible 2.9.</span></p>
			<h2 id="_idParaDest-52"><a id="_idTextAnchor053"/>Setting up your lab environment for Network Interface Card (NIC) teaming</h2>
			<p>This has to be done for at least two of your systems so that you can test the different scenarios. I have opted to use Rhel1 and Rhel2 as Rhel3 is more like my workstation and Ansible control station. This will become apparent in the testing section and the exam tips section of the book. Find the instructions on setting up interfaces in VirtualBox as shown in the <span class="No-Break">following screenshot.</span></p>
			<p>Please ensure you turn off your virtual machines first, <span class="No-Break">as follows:</span></p>
			<div>
				<div id="_idContainer064" class="IMG---Figure">
					<img src="image/Figure_4.01_B18607.jpg" alt="Figure 4.1 – Shutting down your VirtualBox VM"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.1 – Shutting down your VirtualBox VM</p>
			<p>Then, choose <strong class="bold">Settings</strong>, as shown in the <span class="No-Break">following screenshot:</span></p>
			<div>
				<div id="_idContainer065" class="IMG---Figure">
					<img src="image/Figure_4.02_B18607.jpg" alt="Figure 4.2 – Altering the settings of the VirtualBox VM"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.2 – Altering the settings of the VirtualBox VM</p>
			<p>Then, we are going to choose <strong class="bold">Network</strong> and add adapter number 2, <span class="No-Break">as follows:</span></p>
			<div>
				<div id="_idContainer066" class="IMG---Figure">
					<img src="image/Figure_4.03_B18607.jpg" alt="Figure 4.3 – Adding a second network adapter"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.3 – Adding a second network adapter</p>
			<p>We are going to ensure that the settings are as follows for the <span class="No-Break">new adapter:</span></p>
			<div>
				<div id="_idContainer067" class="IMG---Figure">
					<img src="image/Figure_4.04_B18607.jpg" alt="Figure 4.4 – The settings for the second network adapter"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.4 – The settings for the second network adapter</p>
			<p>Finally, we are going to add a third adapter <span class="No-Break">as follows:</span></p>
			<div>
				<div id="_idContainer068" class="IMG---Figure">
					<img src="image/Figure_4.05_B18607.jpg" alt="Figure 4.5 – The third and last network adapter added with the correct configuration"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.5 – The third and last network adapter added with the correct configuration</p>
			<p>The reason for the two additional adapters is to maintain SSH connectivity if you are not using the normal start of the VM, which opens a GUI, but instead headless VM startup, which does not open a GUI <span class="No-Break">in VirtualBox.</span></p>
			<h1 id="_idParaDest-53"><a id="_idTextAnchor054"/>Getting to know link aggregation</h1>
			<p>Teamd handles the control<a id="_idIndexMarker176"/> of network teaming. It uses runners for this purpose. The list of teamd runners<a id="_idIndexMarker177"/> can be found here: <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/configuring_and_managing_networking/configuring-network-teaming_configuring-and-managing-networking">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/configuring_and_managing_networking/configuring-network-teaming_configuring-and-managing-networking</a>. However, the ones we are going to concentrate on are <span class="No-Break">as follows:</span></p>
			<div>
				<div id="_idContainer069" class="IMG---Figure">
					<table id="table001-1" class="No-Table-Style">
						<colgroup>
							<col/>
							<col/>
						</colgroup>
						<tbody>
							<tr class="No-Table-Style">
								<td class="No-Table-Style T---Body">
									<p><span class="No-Break"><strong class="bold">Runner Type</strong></span></p>
								</td>
								<td class="No-Table-Style T---Body">
									<p><span class="No-Break"><strong class="bold">Description</strong></span></p>
								</td>
							</tr>
							<tr class="No-Table-Style">
								<td class="No-Table-Style T---Body">
									<p><span class="No-Break"><strong class="source-inline">lacp</strong></span></p>
								</td>
								<td class="No-Table-Style T---Body">
									<p>The runner uses <span class="No-Break">802.3ad LACP.</span></p>
								</td>
							</tr>
							<tr class="No-Table-Style">
								<td class="No-Table-Style T---Body">
									<p><span class="No-Break"><strong class="source-inline">loadbalance</strong></span></p>
								</td>
								<td class="No-Table-Style T---Body">
									<p>The ports use a hash function to attempt to reach a balance between <span class="No-Break">the ports.</span></p>
								</td>
							</tr>
							<tr class="No-Table-Style">
								<td class="No-Table-Style T---Body">
									<p><span class="No-Break"><strong class="source-inline">activebackup</strong></span></p>
								</td>
								<td class="No-Table-Style T---Body">
									<p>One port is set to active and the other is a backup <span class="No-Break">for failover.</span></p>
								</td>
							</tr>
							<tr class="No-Table-Style">
								<td class="No-Table-Style T---Body">
									<p><span class="No-Break"><strong class="source-inline">roundrobin</strong></span></p>
								</td>
								<td class="No-Table-Style T---Body">
									<p>In this state, the ports are utilized in a <span class="No-Break">round-robin state.</span></p>
								</td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Table 4.1 – Some link aggregation profile types</p>
			<p>For this task and to create network teams, we will be using the <strong class="source-inline">nmcli</strong> tool again, as we did in <a href="B18607_03.xhtml#_idTextAnchor039"><span class="No-Break"><em class="italic">Chapter 3</em></span></a>, <em class="italic">Network Services with Automation – Introduction to Red Hat </em><span class="No-Break"><em class="italic">Linux Networking</em></span><span class="No-Break">.</span></p>
			<p>There are many reasons<a id="_idIndexMarker178"/> to use the teaming of network interfaces – for redundancy, additional throughput, and so on. Depending on what your company needs and the switching it has set up, you can even go deeper into multiple teams. This would be, for instance, two LACP pairs put into a round-robin scenario in order to increase bandwidth while also introducing fault tolerance. Many large companies need to ensure that their applications are always up in order to reap the benefits from them, and by learning how to build a network team, your chances of success <span class="No-Break">are increased.</span></p>
			<h1 id="_idParaDest-54"><a id="_idTextAnchor055"/>Creating different types of link aggregation profiles</h1>
			<p>Keep in mind that the interfaces<a id="_idIndexMarker179"/> may differ in your lab setup than in mine – they are enp0s8 and enp0s9. We need to ensure that the interfaces are down when we set up the teams. This will be based on your lab and you should not choose to connect on startup for these two interfaces. We are going to start off by showing the connectivity of the interfaces that are up and the device status using the <span class="No-Break">following command:</span></p>
			<pre class="source-code">
[emcleroy@rhel1 ~]$ nmcli connection show</pre>
			<p>The output<a id="_idIndexMarker180"/> can be seen in the <span class="No-Break">following screenshot:</span></p>
			<div>
				<div id="_idContainer070" class="IMG---Figure">
					<img src="image/Figure_4.06_B18607.jpg" alt="Figure 4.6 – Network interface connectivity, both virtual and physical&#13;&#10;"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.6 – Network interface connectivity, both virtual and physical</p>
			<p>Next, we are going to start creating a team with the name <strong class="source-inline">bond1</strong>. We will use the <span class="No-Break">following command:</span></p>
			<pre class="source-code">
[root@rhel1 emcleroy]# nmcli connection add type team con-name bond1 ifname bond1 team.runner activebackup</pre>
			<p>This is illustrated in the <span class="No-Break">following screenshot:</span></p>
			<div>
				<div id="_idContainer071" class="IMG---Figure">
					<img src="image/Figure_4.07_B18607.jpg" alt="Figure 4.7 – Full team command to create a team with name bond1 and runner of activebackup&#13;&#10;"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.7 – Full team command to create a team with name bond1 and runner of activebackup</p>
			<p>Let’s break down the screenshot<a id="_idIndexMarker181"/> we just looked at further. First, <strong class="source-inline">nmcli</strong> is the tool used to create the team. The code snippet of <strong class="source-inline">connection add</strong> is showing we are adding a new connection or interface <strong class="source-inline">type</strong> is showing that we are making a <strong class="source-inline">team</strong> in this case. The connection name (<strong class="source-inline">con-name</strong>) is the name you give it, which can be of your choosing. The interface name (<strong class="source-inline">ifname</strong>) – <strong class="source-inline">bond1</strong>, in this use case – is the name you give the interface. <strong class="source-inline">team.runner</strong> is the type of team you are creating; in our case, we are using <strong class="source-inline">activebackup</strong>, which means that one interface is passing traffic and the other is standing by in case of a failover. This can be due to manual intervention or if the interface <span class="No-Break">loses connectivity.</span></p>
			<p>The physical interfaces are then needed to bring the team up. We are using additional commands and modifying the team after it has been created. This allows us to add the interfaces as slaves to the team. We will use the <span class="No-Break">following commands:</span></p>
			<pre class="console">
[root@rhel1 emcleroy]# nmcli connection add type team-slave con-name bond1-enp0s8 ifname enp0s8 master bond1
[root@rhel1 emcleroy]# nmcli connection add type team-slave con-name bond1-enp0s9 ifname enp0s9 master bond1</pre>
			<p>The following screenshot<a id="_idIndexMarker182"/> illustrates <span class="No-Break">those commands:</span></p>
			<div>
				<div id="_idContainer072" class="IMG---Figure">
					<img src="image/Figure_4.08_B18607.jpg" alt="Figure 4.8 – Adding physical interfaces to the virtual team&#13;&#10;"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.8 – Adding physical interfaces to the virtual team</p>
			<p>Additional items are needed to allow connectivity out to the world, as we learned in previous chapters. We will use the following commands to accomplish <span class="No-Break">this change:</span></p>
			<pre class="console">
[root@rhel1 emcleroy]# nmcli connection modify bond1 ipv4.addresses 192.168.1.233/24
[root@rhel1 emcleroy]# nmcli connection modify bond1 ipv4.gateway 192.168.1.1
[root@rhel1 emcleroy]# nmcli connection modify bond1 ipv4.dns 192.168.1.1
[root@rhel1 emcleroy]# nmcli connection modify bond1 ipv4.method manual</pre>
			<p>This is illustrated<a id="_idIndexMarker183"/> in the <span class="No-Break">following screenshot:</span></p>
			<div>
				<div id="_idContainer073" class="IMG---Figure">
					<img src="image/Figure_4.09_B18607.jpg" alt="Figure 4.9 – Adding the additional configuration needed to the team&#13;&#10;"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.9 – Adding the additional configuration needed to the team</p>
			<p>Finally, we want to ensure<a id="_idIndexMarker184"/> that after a reboot, the interface comes back up automatically so that you do not lose points in the exam. We will use this command to accomplish the task of ensuring the interface comes up after a <span class="No-Break">reboot automatically:</span></p>
			<pre class="console">
[root@rhel1 emcleroy]# nmcli connection modify bond1 connection.autoconnect yes</pre>
			<p>This is shown in the <span class="No-Break">following screenshot:</span></p>
			<div>
				<div id="_idContainer074" class="IMG---Figure">
					<img src="image/Figure_4.10_B18607.jpg" alt="Figure 4.10 – Ensure that connectivity persists through reboots&#13;&#10;"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.10 – Ensure that connectivity persists through reboots</p>
			<p>You can run the following command to turn up the connection and ensure that your team is up and <span class="No-Break">functioning correctly:</span></p>
			<pre class="console">
[root@rhel1 emcleroy]# nmcli con up bond1
[root@rhel1 emcleroy]# nmcli device status</pre>
			<p>In the following screen<a id="_idIndexMarker185"/> shot we can see the <span class="No-Break">device status:</span></p>
			<div>
				<div id="_idContainer075" class="IMG---Figure">
					<img src="image/Figure_4.11_B18607.jpg" alt="Figure 4.11 – Showing the device status of the team and team interfaces&#13;&#10;"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.11 – Showing the device status of the team and team interfaces</p>
			<p>The following command shows you what your team looks like, the connectivity, and which interface is <span class="No-Break">currently active:</span></p>
			<pre class="console">
[root@rhel1 emcleroy]# teamdctl bond1 state</pre>
			<p>The output of that command is shown in the <span class="No-Break">following screenshot:</span></p>
			<div>
				<div id="_idContainer076" class="IMG---Figure">
					<img src="image/Figure_4.12_B18607.jpg" alt="Figure 4.12 – Team information and which port is currently active&#13;&#10;"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.12 – Team information and which port is currently active</p>
			<p>Keep in mind<a id="_idIndexMarker186"/> if you are not able to access a server GUI, in most cases, you can install a GUI, but that will be discussed in later chapters. During your exam, you can use the <strong class="source-inline">nm-connection-editor</strong> command to launch a configurator. This can be seen <span class="No-Break">as follows:</span></p>
			<div>
				<div id="_idContainer077" class="IMG---Figure">
					<img src="image/Figure_4.13_B18607.jpg" alt="Figure 4.13 – Launching the command&#13;&#10;"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.13 – Launching the command</p>
			<p>After launching<a id="_idIndexMarker187"/> the command, you are then presented with a GUI that you can control. This allows you to choose a team and create all of the items you need for it without remembering the steps. First, choose a team, <span class="No-Break">as follows:</span></p>
			<div>
				<div id="_idContainer078" class="IMG---Figure">
					<img src="image/Figure_4.14_B18607.jpg" alt="Figure 4.14 – Choose Team from the dropdown&#13;&#10;"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.14 – Choose Team from the dropdown</p>
			<p>Next, you will start to set<a id="_idIndexMarker188"/> the normal information for a team. As shown in the following screenshot, you are going to set the <span class="No-Break">team name:</span></p>
			<div>
				<div id="_idContainer079" class="IMG---Figure">
					<img src="image/Figure_4.15_B18607.jpg" alt="Figure 4.15 – Name the team and the interface of the team&#13;&#10;"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.15 – Name the team and the interface of the team</p>
			<p>After you set the team name, you are going<a id="_idIndexMarker189"/> to choose which physical interfaces or virtual interfaces will be a part of the new team. This is illustrated <span class="No-Break">as follows:</span></p>
			<div>
				<div id="_idContainer080" class="IMG---Figure">
					<img src="image/Figure_4.16_B18607.jpg" alt="Figure 4.16 – Choose the interfaces to be a part of the team&#13;&#10;"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.16 – Choose the interfaces to be a part of the team</p>
			<p>You can even set different options<a id="_idIndexMarker190"/> for the interface you are adding to the team. For our purposes, we will not change anything and simply add it. This is illustrated in the <span class="No-Break">following screenshot:</span></p>
			<div>
				<div id="_idContainer081" class="IMG---Figure">
					<img src="image/Figure_4.17_B18607.jpg" alt="Figure 4.17 – The setting of interface settings at the slave interface level&#13;&#10;"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.17 – The setting of interface settings at the slave interface level</p>
			<p>You can see the outcome<a id="_idIndexMarker191"/> of adding both interfaces, or however many you would like to add to the team. This is shown <span class="No-Break">as follows:</span></p>
			<div>
				<div id="_idContainer082" class="IMG---Figure">
					<img src="image/Figure_4.18_B18607.jpg" alt="Figure 4.18 – Both interfaces after being added to the team&#13;&#10;"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.18 – Both interfaces after being added to the team</p>
			<p>Finally, we can set the IP<a id="_idIndexMarker192"/> of the interface, the gateway, the DNS, and so on. This allows us to ensure that the team is now able to connect to the world. This is illustrated in the <span class="No-Break">following screenshot:</span></p>
			<div>
				<div id="_idContainer083" class="IMG---Figure">
					<img src="image/Figure_4.19_B18607.jpg" alt="Figure 4.19 – Setting the information needed to talk to the world&#13;&#10;"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.19 – Setting the information needed to talk to the world</p>
			<p>That wraps up the manually<a id="_idIndexMarker193"/> configured way of doing things. Ne<a id="_idTextAnchor056"/>xt up, we will make things easier by using Ansible Automation. Through Automation, we will be able to achieve the same results time and time again while lowering the possible human error factor. This will help when doing this type of task over and <span class="No-Break">over again.</span></p>
			<h1 id="_idParaDest-55"><a id="_idTextAnchor057"/>Taking the headache out of setting up your link aggregation by using Ansible Automation</h1>
			<p>Now, we all know having something<a id="_idIndexMarker194"/> automated allows us to save time<a id="_idIndexMarker195"/> and effort. It also allows us to be consistent and that is necessary, especially when you are working on networking. We can build multiple different playbooks to set up different things or we can use variables. In this case, we are going to use variables as they are easiest to change around. With a variable, you can change the different settings easily while still only needing one playbook. An example of that would be when you have to choose between using round-robin and load balancing. This one variable can make sure that everything is set correctly. Along with other variables, such as the IP address and gateways, you can get away with only writing one playbook and then filling out the rest <span class="No-Break">with variables.</span></p>
			<p>Let’s start writing our playbook for network teaming using variables. These are a series of items that answer questions posed by the playbook needed to get the job done in <span class="No-Break">the end.</span></p>
			<p>We will then add our normal code that starts every Ansible playbook. This includes the hosts that we will be using from inventory that will be in the playbook. It also includes how we will escalate privileges to allow us to make the changes. This is a personal preference and you can leave it on if you like. Here is what the initial start of the playbook looks like, just like in <span class="No-Break">previous chapters:</span></p>
			<pre class="source-code">
---
- name: Automated Teaming Setup
  hosts: rhel1
  become: true
  become_method: sudo</pre>
			<p>After we have the initial setup, we are going to add the next items to start the network teaming functions. This will include choosing a variable for different interfaces to use. Also, the variables IPs should use, along with gateway and DNS information. It will also include a variable so you can set the type of teaming we are going to do. This will include using a role, as we did in <a href="B18607_03.xhtml#_idTextAnchor039"><span class="No-Break"><em class="italic">Chapter 3</em></span></a>, <em class="italic">Network Services with Automation – Introduction to Red Hat </em><span class="No-Break"><em class="italic">Linux Networking</em></span><span class="No-Break">:</span></p>
			<pre class="source-code">
  vars:
    network_connections:
      - name: bond1
        state: up
        type: team
        interface_name: bond1
  roles:
    - rhel-system-roles.network</pre>
			<p>You can see a man page<a id="_idIndexMarker196"/> about this role and how<a id="_idIndexMarker197"/> it works by going to <strong class="source-inline">/usr/share/doc/rhel-system-roles/network/example-team_simple-playbook.yml</strong> after you install the <strong class="source-inline">rhel-system-roles.y</strong>ml file using <strong class="source-inline">dnf install rhel-system-roles -y</strong>. This shows you the variables you will need to fill out in the playbook to make the system role <span class="No-Break">run correctly:</span></p>
			<div>
				<div id="_idContainer084" class="IMG---Figure">
					<img src="image/Figure_4.20_B18607.jpg" alt="Figure 4.20 – Rhel system role network teaming example&#13;&#10;"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.20 – Rhel system role network teaming example</p>
			<p>From here, we can use the information<a id="_idIndexMarker198"/> we gathered from the example<a id="_idIndexMarker199"/> to build the rest of our playbook. We will be inputting additional variables to be called by a variable file in the playbook directory instead of the <span class="No-Break">raw values.</span></p>
			<p>Here is the remaining code for the playbook to run successfully, and then we will see the variable file and hierarchy structure after the playbook code to ensure that the playbook can read the variables. This is shown in the following <span class="No-Break">code snippet:</span></p>
			<pre class="source-code">
  vars:
    network_connections:
      - name: "{{ team_name }}"
        state: up
        type: team
        interface_name: "{{ team_name }}"
        ip:
          address:
            - "{{ ipv4_team_address }}"
            - "{{ ipv6_team_address }}"
      - name: member1
        state: up
        type: ethernet
        interface_name: "{{ int1 }}"
        controller: "{{ team_name }}"
      - name: member2
        state: up
        type: ethernet
        interface_name: "{{ int2 }}"
        controller: "{{ team_name }}"
  roles:
    - rhel-system-roles.network</pre>
			<p>This playbook<a id="_idIndexMarker200"/> will now create the build<a id="_idIndexMarker201"/> of the network team automatically. We will then create the variable file to answer the variables we created, such <span class="No-Break">as </span><span class="No-Break"><strong class="source-inline">team_name</strong></span><span class="No-Break">:</span></p>
			<pre class="source-code">
---
team_name: team1
ipv4_team_address: 192.168.1.233/24
ipv6_team_address:  fe80::9029:1a51:454:c2bd/64
int1: enp0s8
int2: enp0s9</pre>
			<p>This allows us to answer<a id="_idIndexMarker202"/> the variables but keep<a id="_idIndexMarker203"/> the playbook ambiguous to be used for multiple different uses instead of a one-and-done mentality. We will put this file in the directory with the playbook in the <strong class="source-inline">vars</strong> folder and name it <strong class="source-inline">rhel1_team_vars.yml</strong>. We will need to add this to the <strong class="source-inline">vars list</strong> in the playbook as well, so the playbook will know where to grab the <span class="No-Break">information from:</span></p>
			<pre class="source-code">
  vars_files:
    - "{{ playbook_dir }}/vars/rhel1_team_vars.yml"
  vars:
    network_connections:
      - name: "{{ team_name }}"
        state: up
        type: team
        interface_name: "{{ team_name }}"
        ip:
          address:
            - "{{ ipv4_team_address }}"
            - "{{ ipv6_team_address }}"
      - name: member1
        state: up
        type: ethernet
        interface_name: "{{ int1 }}"
        controller: "{{ team_name }}"
      - name: member2
        state: up
        type: ethernet
        interface_name: "{{ int2 }}"
        controller: "{{ team_name }}"
  roles:
    - rhel-system-roles.network</pre>
			<p>Now, we can look at the layout<a id="_idIndexMarker204"/> of the playbook <a id="_idIndexMarker205"/>folder, which includes the inventory, <strong class="source-inline">vars</strong> file, <span class="No-Break">and playbook:</span></p>
			<div>
				<div id="_idContainer085" class="IMG---Figure">
					<img src="image/Figure_4.21_B18607.jpg" alt="Figure 4.21 – This shows the hierarchy of the playbook directory&#13;&#10;"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.21 – This shows the hierarchy of the playbook directory</p>
			<p>For this playbook, the inventory<a id="_idIndexMarker206"/> will simply be <strong class="source-inline">rhel1.example.com</strong> under <strong class="source-inline">defaults</strong>, but it may differ<a id="_idIndexMarker207"/> in your lab setup. Afte<a id="_idTextAnchor058"/>r that is set up, we will take a look at the interfaces before we set them up and then after the playbook <span class="No-Break">has run.</span></p>
			<p>Here, you can see that before we run the playbook, there are no teams <span class="No-Break">in place:</span></p>
			<div>
				<div id="_idContainer086" class="IMG---Figure">
					<img src="image/Figure_4.22_B18607.jpg" alt="Figure 4.22 – The connections of the interfaces currently configured&#13;&#10;"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.22 – The connections of the interfaces currently configured</p>
			<p>Having seen the preceding<a id="_idIndexMarker208"/> connections, we are going<a id="_idIndexMarker209"/> to next run the playbook with the <strong class="source-inline">ansible-playbook –i inventory team_network_interface.yml -u emcleroy -k --ask-become –v</strong> command and view the team that <span class="No-Break">was created:</span></p>
			<div>
				<div id="_idContainer087" class="IMG---Figure">
					<img src="image/Figure_4.23_B18607.jpg" alt="Figure 4.22 – Here, you can see the team was created&#13;&#10;"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.22 – Here, you can see the team was created</p>
			<p>As you have learned in this section, Ansible Automation can make setting up a network team a breeze. Along with the ability to save time for other more important projects, Ansible Automation lowers<a id="_idIndexMarker210"/> the human error factor. This allows<a id="_idIndexMarker211"/> users to be confident that the configuration on each server will match. This allows faster troubleshooting and ease <span class="No-Break">of deployment.</span></p>
			<h1 id="_idParaDest-56"><a id="_idTextAnchor059"/>Summary</h1>
			<p>In this chapter, we have learned about network teaming. We covered how it can be used for HA and for throughput advantages. We worked on ensuring that you understand the value behind using a network team and the importance it has in a production environment. When you have multiple paths, for instance, you have the ability to take down a switch for maintenance without causing an issue to your running applications. These are just some of the advantages of network teaming and there are many more. In the next chapter, we will be digging further into the networking space for Rhel 8, in which we will discuss DNS, DHCP, and IPs in further detail. We will learn how to set them up and enable servers to provide functions such as DNS and DHCP. Take a breather, and then let’s get ready to leap into more <span class="No-Break">networking fun.</span></p>
		</div>
	</body></html>